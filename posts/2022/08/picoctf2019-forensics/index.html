<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content="[map[name:MindYourPrivacy]]"><meta name=description content="Short description of your site here"><meta name=keywords content=",untagged"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://0xade1.github.io/posts/2022/08/picoctf2019-forensics/><title>PicoCTF2019 - Forensics :: Poney Island — Welcome to Pwnie Island</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=https://0xade1.github.io/main.d5b952c3b0131e8ecd6d80f97c5fae89d216a2c29dfa0754010b808bdb098871.css><link rel=apple-touch-icon sizes=180x180 href=https://0xade1.github.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://0xade1.github.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://0xade1.github.io/favicon-16x16.png><link rel=manifest href=https://0xade1.github.io/site.webmanifest><link rel=mask-icon href=https://0xade1.github.io/safari-pinned-tab.svg color=#1b1c1d><link rel="shortcut icon" href=https://0xade1.github.io/favicon.ico><meta name=msapplication-TileColor content="#1b1c1d"><meta name=theme-color content="#1b1c1d"><meta itemprop=name content="PicoCTF2019 - Forensics"><meta itemprop=description content="Short description of your site here"><meta itemprop=datePublished content="2022-08-17T03:42:29+08:00"><meta itemprop=dateModified content="2022-08-17T03:42:29+08:00"><meta itemprop=wordCount content="5222"><meta itemprop=image content="https://0xade1.github.io"><meta itemprop=keywords content="untagged,"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://0xade1.github.io"><meta name=twitter:title content="PicoCTF2019 - Forensics"><meta name=twitter:description content="Short description of your site here"><meta property="og:title" content="PicoCTF2019 - Forensics"><meta property="og:description" content="Short description of your site here"><meta property="og:type" content="article"><meta property="og:url" content="https://0xade1.github.io/posts/2022/08/picoctf2019-forensics/"><meta property="og:image" content="https://0xade1.github.io"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-17T03:42:29+08:00"><meta property="article:modified_time" content="2022-08-17T03:42:29+08:00"><meta property="og:see_also" content="https://0xade1.github.io/posts/2022/08/picoctf2019-cryptography/"><meta property="og:see_also" content="https://0xade1.github.io/posts/2022/08/picoctf2019-general-skills/"><meta property="og:see_also" content="https://0xade1.github.io/posts/2022/08/picoctf2019-reverse-engineering/"><meta property="og:see_also" content="https://0xade1.github.io/posts/2022/08/picoctf2019-web-exploitation/"><meta property="og:see_also" content="https://0xade1.github.io/posts/2021/08/picoctf-2021-binary-exploitation/"><meta property="article:section" content="picoCTF"><meta property="article:published_time" content="2022-08-17 03:42:29 +0800 +0800"></head><body><div class=container><header class=header><span class=header__inner><a href=https://0xade1.github.io/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text># cd /root/</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=https://0xade1.github.io/about/>About</a></li><li><a href=https://0xade1.github.io/categories/>Categories</a></li><li><a href=https://0xade1.github.io/posts/>Posts</a></li><li><a href=https://0xade1.github.io/series/>Series</a></li><li><a href=https://0xade1.github.io/tags/>Tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" ecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2022-08-16
|<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=https://0xade1.github.io/categories/picoctf/>picoCTF</a></span>
|
|<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=https://0xade1.github.io/series/picoctf/>picoCTF</a></span>
|</div><article><h1 class=post-title><a href=https://0xade1.github.io/posts/2022/08/picoctf2019-forensics/>PicoCTF2019 - Forensics</a></h1><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://0xade1.github.io/tags/untagged/>untagged</a></span></p></div><div class=post-excerpt>Short description of your site here</div><figure class=post-cover><img src=https://play.picoctf.org/static/media/picoctf-logo-horizontal-white.17fdf0dcdef08dc3396a195b95e3bc29.svg alt="PicoCTF2019 - Forensics"></figure><hr><aside id=toc><div class=toc-title></div><link rel=stylesheet href=https://0xade1.github.io/scss/_toc.min.381569c9197e6da109df728dd267dd570bde7f7e967b92d59404483a017f498b00b0434e20302334ff67d09c721024494068c58c94a8a44aa3128e5aef4ef8f0.css integrity="sha512-OBVpyRl+baEJ33KN0mfdVwvef36We5LVlARIOgF/SYsAsENOIDAjNP9n0JxyECRJQGjFjJSopEqjEo5a70748A=="><div class=toc><input id=_toc type=checkbox name=_toc>
<label class=collapse for=_toc>Table of Contents&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline class="chevron-down" points="6 10 14 18 22 10"/><polyline class="chevron-up" points="22 18 14 10 6 18"/></svg></label><nav id=TableOfContents><nav id=TableOfContents><ul><li><a href=#glory-of-the-garden>Glory of the Garden</a></li><li><a href=#so-meta>So Meta</a></li><li><a href=#shark-on-wire-1>shark on wire 1</a></li><li><a href=#shark-on-wire-2>shark on wire 2</a></li><li><a href=#extensions>extensions</a></li><li><a href=#what-lies-within>What Lies Within</a></li><li><a href=#m00nwalk>m00nwalk</a></li><li><a href=#m00nwalk-2>m00nwalk 2</a></li><li><a href=#whitepages>WhitePages</a></li><li><a href=#c0rrupt>c0rrupt</a></li><li><a href=#like1000>like1000</a></li><li><a href=#investigative-reversing-0>Investigative Reversing 0</a></li><li><a href=#investigative-reversing-1>investigative reversing 1</a></li><li><a href=#investigative-reversing-2>investigative reversing 2</a></li><li><a href=#investigative-reversing-3>investigative reversing 3</a></li><li><a href=#investigative-reversing-4>investigative reversing 4</a></li></ul></nav></nav></div></aside><hr><div class=post-content><h2 id=glory-of-the-garden>Glory of the Garden</h2><pre><code>strings garden.jpg | grep pico
xxd garden.jpg | tail
</code></pre><h2 id=so-meta>So Meta</h2><pre><code>curl -Ls https://jupiter.challenges.picoctf.org/static/916b07b4c87062c165ace1d3d31ef655/pico_img.png | exiftool  - | grep pico | awk '{print $3}'
</code></pre><h2 id=shark-on-wire-1>shark on wire 1</h2><ol><li>Download pcap</li><li>open with Wireshark</li><li>select filter <code>udp.stream eq 6</code></li><li>Follow UDP stream</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tshark -q -r capture.pcap -z follow,udp,raw,6 | egrep <span style=color:#f1fa8c>&#34;^[0-9]&#34;</span> | xxd -r -p
</span></span></code></pre></td></tr></table></div></div><p>We can also iterate over every udp streams:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>for</span> stream in <span style=color:#f1fa8c>`</span>tshark -q -r capture.pcap -T fields -e udp.stream | sort -n | uniq<span style=color:#f1fa8c>`</span> ;
</span></span><span style=display:flex><span><span style=color:#ff79c6>do</span>
</span></span><span style=display:flex><span>    tshark -q -r capture.pcap -z follow,udp,raw,<span style=color:#8be9fd;font-style:italic>$stream</span> | egrep <span style=color:#f1fa8c>&#34;^[0-9]&#34;</span> | xxd -r -p | grep picoCTF ;
</span></span><span style=display:flex><span><span style=color:#ff79c6>done</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=shark-on-wire-2>shark on wire 2</h2><p>There is a very Sick exfiltration technique:</p><ol><li>Follow UDP Stream and change stream until you find a stream that contains <strong>start</strong> (stream 32)</li><li>Note the ip address and investigate with <code>ip.src == 10.0.0.66 and udp</code></li><li>Note the port being used at each UDP packet is changing: [5112, 5105, 5099, 5111, 5067, 5084, 5070, &mldr;]</li><li>remove 5000 to those port numbers, and you get ascii: [p, i, c, o, C, T, F, {, &mldr;]</li></ol><p>extract all the ports:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>tshark  -r capture.pcap  <span style=color:#f1fa8c>&#34;ip.src == 10.0.0.66 and udp.port &gt; 5000&#34;</span> | awk <span style=color:#f1fa8c>&#39;{print $8}&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>then pass the output to a python console:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span>n <span style=color:#ff79c6>=</span> [<span style=color:#bd93f9>5112</span>,<span style=color:#bd93f9>5105</span>,<span style=color:#bd93f9>5099</span>,<span style=color:#bd93f9>5111</span>,<span style=color:#bd93f9>5067</span>,<span style=color:#bd93f9>5084</span>,<span style=color:#bd93f9>5070</span>,<span style=color:#bd93f9>5123</span>,<span style=color:#bd93f9>5112</span>,<span style=color:#bd93f9>5049</span>,<span style=color:#bd93f9>5076</span>,<span style=color:#bd93f9>5076</span>,<span style=color:#bd93f9>5102</span>,<span style=color:#bd93f9>5051</span>,<span style=color:#bd93f9>5114</span>,<span style=color:#bd93f9>5051</span>,<span style=color:#bd93f9>5100</span>,<span style=color:#bd93f9>5095</span>,<span style=color:#bd93f9>5100</span>,<span style=color:#bd93f9>5097</span>,<span style=color:#bd93f9>5116</span>,<span style=color:#bd93f9>5097</span>,<span style=color:#bd93f9>5095</span>,<span style=color:#bd93f9>5118</span>,<span style=color:#bd93f9>5049</span>,<span style=color:#bd93f9>5097</span>,<span style=color:#bd93f9>5095</span>,<span style=color:#bd93f9>5115</span>,<span style=color:#bd93f9>5116</span>,<span style=color:#bd93f9>5051</span>,<span style=color:#bd93f9>5103</span>,<span style=color:#bd93f9>5048</span>,<span style=color:#bd93f9>5125</span>]
</span></span><span style=display:flex><span>n <span style=color:#ff79c6>=</span> [<span style=color:#8be9fd;font-style:italic>chr</span>(x<span style=color:#ff79c6>-</span><span style=color:#bd93f9>5000</span>) <span style=color:#ff79c6>for</span> x <span style=color:#ff79c6>in</span> n]
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;&#34;</span><span style=color:#ff79c6>.</span>join(n))
</span></span></code></pre></td></tr></table></div></div><h2 id=extensions>extensions</h2><pre><code>curl -sLO https://jupiter.challenges.picoctf.org/static/e7e5d188621ee705ceeb0452525412ef/flag.txt
file flag.txt
</code></pre><p>According to <code>file</code> command, this is not a text file, but a png</p><pre><code>mv flag.txt flag.png
tesseract flag.png flag.txt
cat flag.txt.txt
</code></pre><h2 id=what-lies-within>What Lies Within</h2><pre><code>zsteg buildings.png | grep pico | cut -d'&quot;' -f2
</code></pre><h2 id=m00nwalk>m00nwalk</h2><blockquote><p>In 1996, NASA selected a RCA scan converter that provided input to convert its signals from eight Apollo missions, such as 7, 8, 9, 11, and 12.A camera on the Apollo TV television broadcast its raw unconverted SSTV signal, which is then passed along from one of the ground stations to another via the satellite phone.
<a href=https://www.eclipseaviation.com/how-nasa-transfered-data-from-moon-landing/#0>https://www.eclipseaviation.com/how-nasa-transfered-data-from-moon-landing/#0</a></p></blockquote><p>Resources:</p><ul><li><a href=https://www.esa.int/ESA_Multimedia/Videos/2020/07/Mac_OSX_tutorial_How_to_receive_SSTV_pictures_from_the_International_Space_Station>SSTV Tutorial from ESA to visualise images from ISS - International Space Station</a></li><li><a href=https://github.com/mattingalls/Soundflower/releases>Soundflower</a> gives the ability to your Macbook to listen to its own speaker to decode SSTV raw images</li></ul><p>Sadly, we cannot follow the tutorial because the software is no longer available, unless I purchase another software. This is why we need linux rather then MacOSX.
I found an alternative python script that can decode the image from the wav file, without playing it:</p><p>installation:</p><pre tabindex=0><code>git clone https://github.com/colaclanth/sstv
python3 setup.py install
</code></pre><p>Process the wav to extract the image:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://jupiter.challenges.picoctf.org/static/fc1edf07742e98a480c6aff7d2546107/message.wav
</span></span><span style=display:flex><span>sstv -d message.wav -o result.png
</span></span><span style=display:flex><span>open result.png
</span></span></code></pre></td></tr></table></div></div><p>output:</p><pre><code>[sstv] Searching for calibration header... Found!
[sstv] Detected SSTV mode Scottie 1
[sstv] Decoding image...
[####################################################################################################] 100%
[sstv] Drawing image data...
[sstv] ...Done!
</code></pre><p>flag: picoCTF{beep_boop_im_in_space}</p><h2 id=m00nwalk-2>m00nwalk 2</h2><p>Download the clues:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#ff79c6>for</span> i in <span style=color:#bd93f9>1</span> <span style=color:#bd93f9>2</span> 3; <span style=color:#ff79c6>do</span> curl -LO https://jupiter.challenges.picoctf.org/static/a33c9e5dae30c560704e6f2ffaba35c7/clue<span style=color:#8be9fd;font-style:italic>$i</span>.wav ; <span style=color:#ff79c6>done</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i in <span style=color:#bd93f9>1</span> <span style=color:#bd93f9>2</span> 3; <span style=color:#ff79c6>do</span> sstv -d clue<span style=color:#8be9fd;font-style:italic>$i</span>.wav -o clue<span style=color:#8be9fd;font-style:italic>$i</span>.png ; <span style=color:#ff79c6>done</span>
</span></span><span style=display:flex><span>open clue*png
</span></span></code></pre></td></tr></table></div></div><ul><li>clue1 = Password hidden_stegosaurus</li><li>clue2 = The quieter you are the more you can HEAR</li><li>clue3 = Alan Eliasen the FutureBoy</li></ul><p>Searching for Alan Eliasen, we find a topic about Steganography on <a href=https://futureboy.us/stegano/decinput.html>https://futureboy.us/stegano/decinput.html</a> with an online decoder compatible with <strong><code>steghide</code></strong>
These pages use the steghide program to perform steganography, and the files generated are fully compatible with steghide. If you really want to be secure, or do brute-force attacks, you&rsquo;ll want to use these programs on your own system.</p><p>process the message.wav with the password, and you get the Flag in plaintext.
Flag: picoCTF{the_answer_lies_hidden_in_plain_sight}</p><p>Extract the image from the transmission:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://jupiter.challenges.picoctf.org/static/a33c9e5dae30c560704e6f2ffaba35c7/message.wav
</span></span><span style=display:flex><span>sstv -d message.wav -o result.png
</span></span></code></pre></td></tr></table></div></div><h2 id=whitepages>WhitePages</h2><pre><code>file whitepages.txt
whitepages.txt: UTF-8 Unicode text, with very long lines, with no line terminators
</code></pre><p>We can note a pattern <code>e28083</code> and <code>e2808320</code>:</p><pre><code>cat whitepages.txt | xxd | head
00000000: e280 83e2 8083 e280 83e2 8083 20e2 8083  ............ ...
00000010: 20e2 8083 e280 83e2 8083 e280 83e2 8083   ...............
00000020: 20e2 8083 e280 8320 e280 83e2 8083 e280   ...... ........
00000030: 83e2 8083 20e2 8083 e280 8320 e280 8320  .... ...... ...
00000040: 2020 e280 83e2 8083 e280 83e2 8083 e280    ..............
00000050: 8320 20e2 8083 20e2 8083 e280 8320 e280  .  ... ...... ..
00000060: 8320 20e2 8083 e280 83e2 8083 2020 e280  .  .........  ..
00000070: 8320 20e2 8083 2020 2020 e280 8320 e280  .  ...    ... ..
00000080: 83e2 8083 e280 83e2 8083 2020 e280 8320  ..........  ...
00000090: e280 8320 e280 8320 e280 83e2 8083 e280  ... ... ........
</code></pre><p>Since there is only two values, maybe it&rsquo;s some kind of binary encoding.
I first tried with <code>\u2003</code> as binary 1 and <code>\x20</code> as binary 0, but it did not show anything readable.</p><p>Then I have rewritten the below code and switch 0 and 1 to see that the flag was indeed visible:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#6272a4>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> re
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>f <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#34;./whitepages.txt&#34;</span>, mode<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;r&#39;</span>, encoding<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;utf-8&#34;</span>)
</span></span><span style=display:flex><span>whitespace <span style=color:#ff79c6>=</span> f<span style=color:#ff79c6>.</span>read()
</span></span><span style=display:flex><span>binary <span style=color:#ff79c6>=</span> [<span style=color:#f1fa8c>&#39;0&#39;</span> <span style=color:#ff79c6>if</span> x <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\u2003</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#ff79c6>else</span> <span style=color:#f1fa8c>&#39;1&#39;</span> <span style=color:#ff79c6>for</span> x <span style=color:#ff79c6>in</span> whitespace]
</span></span><span style=display:flex><span>binary_str <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span><span style=color:#ff79c6>.</span>join(binary)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hex_str <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>hex</span>(<span style=color:#8be9fd;font-style:italic>int</span>(binary_str, <span style=color:#bd93f9>2</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>pad_hex</span>(some_hex_str):
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>if</span> <span style=color:#8be9fd;font-style:italic>len</span>(some_hex_str) <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>2</span>:
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;0&#34;</span> <span style=color:#ff79c6>+</span> hex_str[<span style=color:#bd93f9>2</span>:]
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> hex_str[<span style=color:#bd93f9>2</span>:]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>byte_array <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>bytes</span><span style=color:#ff79c6>.</span>fromhex(pad_hex(hex_str))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> re<span style=color:#ff79c6>.</span>findall(<span style=color:#f1fa8c>&#34;picoCTF{.*}&#34;</span>, byte_array<span style=color:#ff79c6>.</span>decode())[<span style=color:#bd93f9>0</span>]
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(flag)
</span></span></code></pre></td></tr></table></div></div><h2 id=c0rrupt>c0rrupt</h2><p>Unable to detect the file type</p><pre><code>file mystery
mystery: data
</code></pre><p>There is a Hint:</p><pre><code>Try fixing the file header
</code></pre><p>Examining the header, we can see words <code>gAMA</code>, <code>sRGB</code> and <code>pHYs</code> so perhaps it is an image?</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat mystery | xxd | head
</span></span><span style=display:flex><span>00000000: <span style=color:#bd93f9>8965</span> 4e34 0d0a b0aa <span style=color:#bd93f9>0000</span> 000d <span style=color:#bd93f9>4322</span> <span style=color:#bd93f9>4452</span>  .eN4........C<span style=color:#f1fa8c>&#34;DR
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000010: 0000 066a 0000 0447 0802 0000 007c 8bab  ...j...G.....|..
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000020: 7800 0000 0173 5247 4200 aece 1ce9 0000  x....sRGB.......
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000030: 0004 6741 4d41 0000 b18f 0bfc 6105 0000  ..gAMA......a...
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000040: 0009 7048 5973 aa00 1625 0000 1625 0149  ..pHYs...%...%.I
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000050: 5224 f0aa aaff a5ab 4445 5478 5eec bd3f  R</span>$<span style=color:#f1fa8c>......DETx^..?
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000060: 8e64 cd71 bd2d 8b20 2080 9041 8302 08d0  .d.q.-.  ..A....
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000070: f9ed 40a0 f36e 407b 9023 8f1e d720 8b3e  ..@..n@{.#... .&gt;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000080: b7c1 0d70 0374 b503 ae41 6bf8 bea8 fbdc  ...p.t...Ak.....
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>00000090: 3e7d 2a22 336f de5b 55dd 3d3d f920 9188  &gt;}*&#34;</span>3o.<span style=color:#ff79c6>[</span>U.<span style=color:#ff79c6>==</span>. ..
</span></span></code></pre></td></tr></table></div></div><p>I am examining another PNG file, and find A LOT of similarities:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat flag.png | xxd | head
</span></span><span style=display:flex><span>00000000: <span style=color:#bd93f9>8950</span> 4e47 0d0a 1a0a <span style=color:#bd93f9>0000</span> 000d <span style=color:#bd93f9>4948</span> <span style=color:#bd93f9>4452</span>  .PNG........IHDR
</span></span><span style=display:flex><span>00000010: <span style=color:#bd93f9>0000</span> 066a <span style=color:#bd93f9>0000</span> <span style=color:#bd93f9>0447</span> <span style=color:#bd93f9>0802</span> <span style=color:#bd93f9>0000</span> 007c 8bab  ...j...G.....|..
</span></span><span style=display:flex><span>00000020: <span style=color:#bd93f9>7800</span> <span style=color:#bd93f9>0000</span> <span style=color:#bd93f9>0173</span> <span style=color:#bd93f9>5247</span> <span style=color:#bd93f9>4200</span> aece 1ce9 <span style=color:#bd93f9>0000</span>  x....sRGB.......
</span></span><span style=display:flex><span>00000030: <span style=color:#bd93f9>0004</span> <span style=color:#bd93f9>6741</span> 4d41 <span style=color:#bd93f9>0000</span> b18f 0bfc <span style=color:#bd93f9>6105</span> <span style=color:#bd93f9>0000</span>  ..gAMA......a...
</span></span><span style=display:flex><span>00000040: <span style=color:#bd93f9>0009</span> <span style=color:#bd93f9>7048</span> <span style=color:#bd93f9>5973</span> <span style=color:#bd93f9>0000</span> <span style=color:#bd93f9>1625</span> <span style=color:#bd93f9>0000</span> <span style=color:#bd93f9>1625</span> <span style=color:#bd93f9>0149</span>  ..pHYs...%...%.I
</span></span><span style=display:flex><span>00000050: <span style=color:#bd93f9>5224</span> f000 00a8 8e49 <span style=color:#bd93f9>4441</span> <span style=color:#bd93f9>5478</span> 5eec dd2d  R$.....IDATx^..-
</span></span><span style=display:flex><span>00000060: 94dc 46da 30ec <span style=color:#bd93f9>0718</span> 0e34 0c34 0c0c dab3  ..F.0....4.4....
</span></span><span style=display:flex><span>00000070: <span style=color:#bd93f9>3030</span> 70e1 c23d 8b0c 0d0d 0d03 <span style=color:#bd93f9>1618</span> <span style=color:#bd93f9>0606</span>  00p..<span style=color:#ff79c6>=</span>..........
</span></span><span style=display:flex><span>00000080: 06e6 3cc8 e001 <span style=color:#bd93f9>8686</span> 666b <span style=color:#bd93f9>1868</span> e8f3 a29c  ..&lt;.....fk.h....
</span></span><span style=display:flex><span>00000090: f37d 25d5 8fee 2aa9 66ba 67ba c73f b9ae  .<span style=color:#ff79c6>}</span>%...*.f.g..?..
</span></span></code></pre></td></tr></table></div></div><p>As per the <a href=http://www.libpng.org/pub/png/spec/1.2/PNG-Rationale.html#R.PNG-file-signature>PNG specifications - 12.12. PNG file signature</a>,
the first eight bytes of a PNG file always contain the following values:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>(hexadecimal)</td><td>89 50 4e 47 0d 0a 1a 0a</td></tr><tr><td>(ASCII C notation)</td><td>\211 P N G \r \n \032 \n</td></tr></tbody></table><p>A decoder may further verify that the next eight bytes contain an IHDR chunk header.
According to <a href=http://www.libpng.org/pub/png/spec/1.2/PNG-Structure.html>PNG Structure - 3.2. Chunk layout</a>,
the Chunk structure is:</p><table><thead><tr><th></th><th>Length</th><th>Type</th><th>Data</th><th>CRC</th></tr></thead><tbody><tr><td>size</td><td>4 bytes</td><td>4 bytes</td><td>see Chunk Length</td><td>4 bytes</td></tr><tr><td>type</td><td>unsigned int</td><td>Ascii</td><td></td><td>Hex</td></tr></tbody></table><p>Let&rsquo;s verify the IHDR chunk:</p><table><thead><tr><th></th><th>Length</th><th>Type</th><th>Data</th><th>CRC</th></tr></thead><tbody><tr><td>we have</td><td>0xd (13)</td><td>C"DR</td><td>0000 066a 0000 0447 0802 0000 00</td><td>7c 8bab 78</td></tr><tr><td>we should have</td><td>0xd (13)</td><td>IHDR</td><td>0000 066a 0000 0447 0802 0000 00</td><td>7c 8bab 78</td></tr></tbody></table><p>Let&rsquo;s try to patch the first line (16 bytes) of this file header:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cp mystery mystery-patched
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># BEFORE seek 16 bytes at offset 0</span>
</span></span><span style=display:flex><span>xxd -s <span style=color:#bd93f9>0</span> -l <span style=color:#bd93f9>16</span> mystery-patched
</span></span><span style=display:flex><span><span style=color:#6272a4>#00000000: 8965 4e34 0d0a b0aa 0000 000d 4322 4452  .eN4........C&#34;DR</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># PATCH</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;00000000: 8950 4e47 0d0a 1a0a 0000 000d 4948 4452&#34;</span> | xxd -r - mystery-patched
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># AFTER show 16 bytes at offset 0</span>
</span></span><span style=display:flex><span>xxd -s <span style=color:#bd93f9>0</span> -l <span style=color:#bd93f9>16</span> mystery-patched
</span></span><span style=display:flex><span><span style=color:#6272a4>#00000000: 8950 4e47 0d0a 1a0a 0000 000d 4948 4452  .PNG........IHDR</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Check file</span>
</span></span><span style=display:flex><span>file mystery-patched
</span></span><span style=display:flex><span><span style=color:#6272a4>#mystery-patched: PNG image data, 1642 x 1095, 8-bit/color RGB, non-interlaced</span>
</span></span></code></pre></td></tr></table></div></div><p>The file can&rsquo;t be open so there may be another corruption. We can examine the PNG is valid with a small utility:</p><pre><code>sudo apt install pngcheck
pngcheck mystery-patched
mystery-patched  CRC error in chunk pHYs (computed 38d82c82, expected 495224f0
</code></pre><p>Lets examine the pHYs header:</p><table><thead><tr><th></th><th>Length</th><th>Type</th><th>Data</th><th>CRC</th></tr></thead><tbody><tr><td>we have</td><td>0x9</td><td>pHYs</td><td>aa00 1625 0000 1625 01</td><td>49 5224 f0</td></tr></tbody></table><p>Either the checksum or the Data is corrupted.
According to <a href=http://www.libpng.org/pub/png/spec/1.2/PNG-Chunks.html#C.pHYs>4.2.4.2. pHYs Physical pixel dimensions</a>,
this particular chunk has this structure:</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Pixels per unit, X axis: 4 bytes (unsigned integer)</td><td>aa00 1625</td></tr><tr><td>Pixels per unit, Y axis: 4 bytes (unsigned integer)</td><td>0000 1625</td></tr><tr><td>Unit specifier: 1 byte</td><td>0x1</td></tr></tbody></table><p>Pixels per unit on the X axis with value <code>aa001625</code> is a huge number which does not makes any sense,
it is more probable that the value should be same as for the Y axis with <code>0x1625</code></p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># BEFORE see byte at position 0x46</span>
</span></span><span style=display:flex><span>xxd -s 0x46 -l <span style=color:#bd93f9>1</span> mystery-patched
</span></span><span style=display:flex><span><span style=color:#6272a4># 00000046: aa                                       .</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># PATCH</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;00000046: 00&#34;</span> | xxd -r - mystery-patched
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># VERIFY PATCHING</span>
</span></span><span style=display:flex><span>xxd -s 0x46 -l <span style=color:#bd93f9>1</span> mystery-patched
</span></span><span style=display:flex><span><span style=color:#6272a4># 00000046: 00</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># CHECKSUM VERIFICATION</span>
</span></span><span style=display:flex><span>pngcheck -v mystery-patched
</span></span><span style=display:flex><span>File: mystery-patched <span style=color:#ff79c6>(</span><span style=color:#bd93f9>202940</span> bytes<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>  chunk IHDR at offset 0x0000c, length <span style=color:#bd93f9>13</span>
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>1642</span> x <span style=color:#bd93f9>1095</span> image, 24-bit RGB, non-interlaced
</span></span><span style=display:flex><span>  chunk sRGB at offset 0x00025, length <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>    rendering <span style=color:#8be9fd;font-style:italic>intent</span> <span style=color:#ff79c6>=</span> perceptual
</span></span><span style=display:flex><span>  chunk gAMA at offset 0x00032, length 4: 0.45455
</span></span><span style=display:flex><span>  chunk pHYs at offset 0x00042, length 9: 5669x5669 pixels/meter <span style=color:#ff79c6>(</span><span style=color:#bd93f9>144</span> dpi<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>:  invalid chunk length <span style=color:#ff79c6>(</span>too large<span style=color:#ff79c6>)</span>
</span></span></code></pre></td></tr></table></div></div><p>No more errors on <code>pHYs</code> chunk but an issue is detected on the following chunk <code>.DET</code> which is invalid (first character is not ascii)
and does not exist in the spec; The closest that comes to mind when comparing with other PNG is <code>IDAT</code>. Let&rsquo;s examine the Chunk</p><table><thead><tr><th></th><th>Length</th><th>Type</th><th>Data</th><th>CRC</th></tr></thead><tbody><tr><td>we have</td><td>0xaaaaffa5 ()</td><td>.DET</td><td>aa00 1625 0000 1625 01</td><td>49 5224 f0</td></tr></tbody></table><p>We can obtain the true size of the IDAT chunk if we can find the offset of the next chunk.
The next chunk is either another <code>IDAT</code> or an <code>IEND</code> chunk of size zero, which terminates the file:</p><pre tabindex=0><code>xxd mystery-patched | grep IDAT
00000050: 5224 f000 0318 4b49 4441 5478 5eec bd3f  R$....KIDATx^..?
00010000: 6927 db59 0000 fff4 4944 4154 3697 4678  i&#39;.Y....IDAT6.Fx
00020000: ba6b c1fa 0000 fff4 4944 4154 d5df c0b7  .k......IDAT....
00030000: 5997 d200 0000 18a0 4944 4154 bb9d f54c  Y.......IDAT...L
</code></pre><p>Because I am using grep to find IDAT chunks, I have to run the xxd command twice.
This is to avoid missing an IDAT chunk being split between two rows of the xxd output.</p><ul><li>The first xxd uses default 16 columns (see above)</li><li>The second uses 8 columns (see below)</li></ul><pre tabindex=0><code>xxd -c 8 mystery-patched | grep IDAT
00010008: 4944 4154 3697 4678  IDAT6.Fx
00020008: 4944 4154 d5df c0b7  IDAT....
00030008: 4944 4154 bb9d f54c  IDAT...L
</code></pre><p>Now it becomes simpler, and we can calculate the size with <code>0xffa5 = hex(0x10004 -4 -0x5b)</code></p><table><thead><tr><th>chunk</th><th>field</th><th>offset</th><th>size</th></tr></thead><tbody><tr><td>IDAT</td><td>length</td><td>0x53</td><td>4</td></tr><tr><td>IDAT</td><td>Type</td><td>0x57</td><td>4</td></tr><tr><td>IDAT</td><td>Data</td><td>0x5b</td><td><code>0x10004 -4 -0x5b</code></td></tr><tr><td>IDAT</td><td>CRC</td><td><code>0x10004 -4</code></td><td>4</td></tr><tr><td>next IDAT</td><td>length</td><td>0x10004</td><td>4</td></tr></tbody></table><p>Patching type</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># Before seek 4-bytes Type at offset 0x57</span>
</span></span><span style=display:flex><span>xxd -s 0x53 -l <span style=color:#bd93f9>8</span> mystery-patched
</span></span><span style=display:flex><span>00000053: aaaa ffa5 ab44 <span style=color:#bd93f9>4554</span>                                .....DET
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># PATCH</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>echo</span> <span style=color:#f1fa8c>&#34;00000053: 0000 ffa5 4944 4154&#34;</span> | xxd -r - mystery-patched
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># After</span>
</span></span><span style=display:flex><span>xxd -s 0x53 -l <span style=color:#bd93f9>8</span> mystery-patched
</span></span><span style=display:flex><span>00000053: <span style=color:#bd93f9>0000</span> ffa5 <span style=color:#bd93f9>4944</span> <span style=color:#bd93f9>4154</span>                      ....IDAT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># Verify header</span>
</span></span><span style=display:flex><span>pngcheck -v mystery-patched
</span></span><span style=display:flex><span>File: mystery-patched <span style=color:#ff79c6>(</span><span style=color:#bd93f9>202940</span> bytes<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>  chunk IHDR at offset 0x0000c, length <span style=color:#bd93f9>13</span>
</span></span><span style=display:flex><span>    <span style=color:#bd93f9>1642</span> x <span style=color:#bd93f9>1095</span> image, 24-bit RGB, non-interlaced
</span></span><span style=display:flex><span>  chunk sRGB at offset 0x00025, length <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>    rendering <span style=color:#8be9fd;font-style:italic>intent</span> <span style=color:#ff79c6>=</span> perceptual
</span></span><span style=display:flex><span>  chunk gAMA at offset 0x00032, length 4: 0.45455
</span></span><span style=display:flex><span>  chunk pHYs at offset 0x00042, length 9: 5669x5669 pixels/meter <span style=color:#ff79c6>(</span><span style=color:#bd93f9>144</span> dpi<span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>  chunk IDAT at offset 0x00057, length <span style=color:#bd93f9>65445</span>
</span></span><span style=display:flex><span>    zlib: deflated, 32K window, fast compression
</span></span><span style=display:flex><span>  chunk IDAT at offset 0x10008, length <span style=color:#bd93f9>65524</span>
</span></span><span style=display:flex><span>  chunk IDAT at offset 0x20008, length <span style=color:#bd93f9>65524</span>
</span></span><span style=display:flex><span>  chunk IDAT at offset 0x30008, length <span style=color:#bd93f9>6304</span>
</span></span><span style=display:flex><span>  chunk IEND at offset 0x318b4, length <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>No errors detected in mystery-patched <span style=color:#ff79c6>(</span><span style=color:#bd93f9>9</span> chunks, 96.3% compression<span style=color:#ff79c6>)</span>.
</span></span></code></pre></td></tr></table></div></div><p>Et voila! now the PNG files can be opened, but it seems all black image :/</p><p>picoCTF{c0rrupt10n_1847995}</p><h2 id=like1000>like1000</h2><pre><code>curl -LOs https://jupiter.challenges.picoctf.org/static/52084b5ad360b25f9af83933114324e0/1000.tar
for i in `seq 1000 -1 1`; do tar -xvf $i.tar ; rm $i.tar ; done
open flag.png
</code></pre><p>Flag: picoCTF{l0t5_0f_TAR5}</p><h2 id=investigative-reversing-0>Investigative Reversing 0</h2><p>We are being provided an ELF64 binary called <code>mystery</code> and a PNG image called <code>mystery.png</code></p><p>Simple check of the PNG reveals something wrong about it. There is something after the end of the image:</p><pre><code>pngcheck mystery.png
mystery.png  additional data after IEND chunk
ERROR: mystery.png
</code></pre><p>Using xxd or strings, we find something that the culprit looks like a corrupted flag: <code>picoCTK.k5zsid6q_3d659f57}</code></p><pre><code>xxd mystery.png | tail -4
0001e850: 8220 0882 2008 8220 6417 ffef fffd 7f5e  . .. .. d......^
0001e860: ed5a 9d38 d01f 5600 0000 0049 454e 44ae  .Z.8..V....IEND.
0001e870: 4260 8270 6963 6f43 544b 806b 357a 7369  B`.picoCTK.k5zsi
0001e880: 6436 715f 3364 3635 3966 3537 7d         d6q_3d659f57}
</code></pre><p>Because it does not looks like a flag, I can use radare2 to reverse engineer the binary:</p><pre><code>radare2 mystery
aaaa
afl
s main
pdf main
</code></pre><p>At the very beginning of the binary, we observe that the binary needs both the PNG and a <strong>flag.txt</strong> file.
My intuition is that the binary is used to store or retrieve the content of flag.txt into/from the PNG.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-asm data-lang=asm><span style=display:flex><span>|           0<span style=color:#50fa7b>x000011b3</span>      <span style=color:#bd93f9>488</span>d3d500e00.  lea rdi, str.flag.txt       <span style=color:#6272a4>; 0x200a ; &#34;flag.txt&#34;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>|           <span style=color:#bd93f9>0x000011ba</span>      e8c1feffff     call sym.imp.fopen
</span></span><span style=display:flex><span>|           0<span style=color:#50fa7b>x000011bf</span>      <span style=color:#bd93f9>488945</span>c0       mov qword [var_40h], rax
</span></span><span style=display:flex><span>|           0<span style=color:#50fa7b>x000011c3</span>      <span style=color:#bd93f9>488</span>d35490e00.  lea rsi, [<span style=color:#bd93f9>0x00002013</span>]       <span style=color:#6272a4>; &#34;a&#34;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>|           <span style=color:#bd93f9>0x000011ca</span>      <span style=color:#bd93f9>488</span>d3d440e00.  lea rdi, str.mystery.png    <span style=color:#6272a4>; 0x2015 ; &#34;mystery.png&#34;
</span></span></span></code></pre></td></tr></table></div></div><p>Instead of reverse engineering the code, let&rsquo;s play and manipulate the binary inputs by
creating a false flag.txt of same size with value: <code>picoCTF{aaaaaaaa_aaaaaaaa}</code></p><p>After we run the <code>./mystery</code> program, then examine the end of the PNG. We see: <code>picoCTK.fffffff^_aaaaaaaa}</code></p><p>So we can infer a transformation table:</p><table><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>false flag.txt</td><td>picoCT</td><td>F{</td><td>aaaaaaa</td><td>a</td><td>_aaaaaaaa}</td></tr><tr><td>PNG</td><td>picoCT</td><td>K.</td><td>fffffff</td><td>^</td><td>_aaaaaaaa}</td></tr><tr><td>transformation</td><td>identical</td><td>XX</td><td>ord(&lsquo;f&rsquo;) - ord(&lsquo;a&rsquo;) = +5</td><td>ord(&rsquo;^&rsquo;)-ord(&lsquo;a&rsquo;) = -3</td><td>identical</td></tr></tbody></table><p>With the above transformation rule in mind, we can infer the real flag:</p><table><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>reverse transformation</td><td>identical</td><td>XX</td><td>-5</td><td>+3</td><td>identical</td></tr><tr><td>PNG</td><td>picoCT</td><td>K.</td><td>k5zsid6</td><td>q</td><td>_3d659f57}</td></tr><tr><td>real flag.txt</td><td>picoCT</td><td>F{</td><td>f0und_1</td><td>t</td><td>_3d659f57}</td></tr></tbody></table><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#f1fa8c>&#39;&#39;</span><span style=color:#ff79c6>.</span>join([<span style=color:#8be9fd;font-style:italic>chr</span>(<span style=color:#8be9fd;font-style:italic>ord</span>(c)<span style=color:#ff79c6>-</span><span style=color:#bd93f9>5</span>) <span style=color:#ff79c6>for</span> c <span style=color:#ff79c6>in</span> <span style=color:#f1fa8c>&#34;k5zsid6&#34;</span>])     <span style=color:#6272a4># &#39;f0und_1</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>chr</span>(<span style=color:#8be9fd;font-style:italic>ord</span>(<span style=color:#f1fa8c>&#39;q&#39;</span>)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>3</span>)                                 <span style=color:#6272a4># &#39;t&#39;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=investigative-reversing-1>investigative reversing 1</h2><p>Download and launch ghidra</p><pre><code>curl -LO https://github.com/NationalSecurityAgency/ghidra/releases/download/Ghidra_10.1.5_build/ghidra_10.1.5_PUBLIC_20220726.zip
unzip ghidra_10.1.5_PUBLIC_20220726.zip
mv ghidra_10.1.5_PUBLIC_20220726.zip /opt
cd /opt &amp;&amp; ln -s ghidra_10.1.5_PUBLIC ghidra
export PATH=$PATH:/opt/ghidra
./ghidraRun
</code></pre><ol><li>Create a new project, import the mystery binary and analyze it.</li><li>On the symbol tree click on Functions then on main.</li><li>You will get a similar decompiled version as the below, apart that I have renamed few variables.</li></ol><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>void</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>flag_stream;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>m_stream;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>m2_stream;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>m3_stream;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>long</span> in_FS_OFFSET;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> local_6b;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_68;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_64;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_60;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> flag [<span style=color:#bd93f9>4</span>];    <span style=color:#6272a4>//4 first flag characters
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>char</span> local_34;    <span style=color:#6272a4>//flag[4] = 5th character
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>char</span> local_33;    <span style=color:#6272a4>//flag[5] = 6th character
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#8be9fd>long</span> local_10;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local_10 <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>long</span> <span style=color:#ff79c6>*</span>)(in_FS_OFFSET <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x28</span>);
</span></span><span style=display:flex><span>  flag_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;flag.txt&#34;</span>,<span style=color:#f1fa8c>&#34;r&#34;</span>);
</span></span><span style=display:flex><span>  m_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;mystery.png&#34;</span>,<span style=color:#f1fa8c>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>  m2_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;mystery2.png&#34;</span>,<span style=color:#f1fa8c>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>  m3_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;mystery3.png&#34;</span>,<span style=color:#f1fa8c>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (flag_stream <span style=color:#ff79c6>==</span> (FILE <span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x0</span>) {
</span></span><span style=display:flex><span>    puts(<span style=color:#f1fa8c>&#34;No flag found, please make sure this is run on the server&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (m_stream <span style=color:#ff79c6>==</span> (FILE <span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x0</span>) {
</span></span><span style=display:flex><span>    puts(<span style=color:#f1fa8c>&#34;mystery.png is missing, please run this on the server&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  fread(flag,<span style=color:#bd93f9>0x1a</span>,<span style=color:#bd93f9>1</span>,flag_stream);                 <span style=color:#6272a4>//read 28 bytes from flag.txt
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  fputc((<span style=color:#8be9fd>int</span>)flag[<span style=color:#bd93f9>1</span>],m3_stream);                  <span style=color:#6272a4>//append flag[1] at the end of mystery3.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  fputc((<span style=color:#8be9fd>int</span>)(<span style=color:#8be9fd>char</span>)(flag[<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;\x15&#39;</span>),m2_stream); <span style=color:#6272a4>//append flag[0]+21  at the end of mystery2.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  fputc((<span style=color:#8be9fd>int</span>)flag[<span style=color:#bd93f9>2</span>],m3_stream);                  <span style=color:#6272a4>//append flag[2] at the end of mystery3.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_6b <span style=color:#ff79c6>=</span> flag[<span style=color:#bd93f9>3</span>];
</span></span><span style=display:flex><span>  fputc((<span style=color:#8be9fd>int</span>)local_33,m3_stream);                 <span style=color:#6272a4>//append flag[5] char at the end of mystery3.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  fputc((<span style=color:#8be9fd>int</span>)local_34,m_stream);                  <span style=color:#6272a4>//append flag[4] char at the end of mystery.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>for</span> (local_68 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>6</span>; local_68 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>10</span>; local_68 <span style=color:#ff79c6>=</span> local_68 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) {  <span style=color:#6272a4>//for(i=6; i&lt;10; i++&gt;) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    local_6b <span style=color:#ff79c6>=</span> local_6b <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;\x01&#39;</span>;                               <span style=color:#6272a4>// flag[3] +=1
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    fputc((<span style=color:#8be9fd>int</span>)flag[local_68],m_stream);                        <span style=color:#6272a4>// append flag[6:10] at end of mystery.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  }                                                             <span style=color:#6272a4>//}
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  fputc((<span style=color:#8be9fd>int</span>)local_6b,m2_stream);                 <span style=color:#6272a4>// append flag[3]+4 at the end of mystery2.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>for</span> (local_64 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>10</span>; local_64 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0xf</span>; local_64 <span style=color:#ff79c6>=</span> local_64 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) {<span style=color:#6272a4>//for(i=10; i&lt;15 ;i++) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    fputc((<span style=color:#8be9fd>int</span>)flag[local_64],m3_stream);                       <span style=color:#6272a4>// append flag[i] at end of mystery3.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  }                                                             <span style=color:#6272a4>//}
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>for</span> (local_60 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xf</span>; local_60 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0x1a</span>; local_60 <span style=color:#ff79c6>=</span> local_60 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) {<span style=color:#6272a4>//for (i=15; i&lt;28; i++){
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    fputc((<span style=color:#8be9fd>int</span>)flag[local_60],m_stream);                          <span style=color:#6272a4>//append flag[15:28] end of mystery.png
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  }                                                               <span style=color:#6272a4>//}
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  fclose(m_stream);
</span></span><span style=display:flex><span>  fclose(flag_stream);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (local_10 <span style=color:#ff79c6>!=</span> <span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>long</span> <span style=color:#ff79c6>*</span>)(in_FS_OFFSET <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x28</span>)) {
</span></span><span style=display:flex><span>                    <span style=color:#6272a4>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>    __stack_chk_fail();
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>We can verify with xxd:</p><pre tabindex=0><code class=language-hex data-lang=hex>ctf@6590b95fa511:/tmp$ xxd -g 1 mystery.png | tail -3
0001e860: ed 5a 9d 38 d0 1f 56 00 00 00 00 49 45 4e 44 ae  .Z.8..V....IEND.
0001e870: 42 60 82 43 46 7b 41 6e 31 5f 65 32 36 33 30 37  B`.CF{An1_e26307
0001e880: 32 35 7d                                         25}
ctf@6590b95fa511:/tmp$ xxd -g 1 mystery2.png | tail -3
0001e850: 82 20 08 82 20 08 82 20 64 17 ff ef ff fd 7f 5e  . .. .. d......^
0001e860: ed 5a 9d 38 d0 1f 56 00 00 00 00 49 45 4e 44 ae  .Z.8..V....IEND.
0001e870: 42 60 82 85 73                                   B`..s
ctf@6590b95fa511:/tmp$ xxd -g 1 mystery3.png | tail -3
0001e850: 82 20 08 82 20 08 82 20 64 17 ff ef ff fd 7f 5e  . .. .. d......^
0001e860: ed 5a 9d 38 d0 1f 56 00 00 00 00 49 45 4e 44 ae  .Z.8..V....IEND.
0001e870: 42 60 82 69 63 54 30 74 68 61 5f                 B`.icT0tha_
</code></pre><p>We need first to retrieve the bytes appended at the end of every PNG images.
According to <a href=http://www.libpng.org/pub/png/spec/1.2/PNG-Structure.html#Chunk-layout>PNG specifications</a>, every PNG end with an <strong>IEND</strong> chunk followed with 4 bytes CRC</p><p>mystery1.png</p><table><thead><tr><th>flag position</th><th>4</th><th>6 to 9</th><th>15 to 27</th></tr></thead><tbody><tr><td>flag character</td><td>C</td><td>F{An</td><td>1_e2630725}</td></tr></tbody></table><p>mystery2.png</p><table><thead><tr><th>flag position</th><th>0</th><th>3</th></tr></thead><tbody><tr><td>flag character</td><td>chr(x85-x15)</td><td>chr(x73-4)</td></tr><tr><td>flag value</td><td>p</td><td>o</td></tr></tbody></table><p>mystery3.png</p><table><thead><tr><th>flag position</th><th>1</th><th>2</th><th>5</th><th>10 to 14</th></tr></thead><tbody><tr><td>flag character</td><td>i</td><td>c</td><td>T</td><td>0tha_</td></tr></tbody></table><p>So the flag is: picoCTF{An0tha_1_e2630725}</p><h2 id=investigative-reversing-2>investigative reversing 2</h2><p>Ghidra again, import and analyze the binary:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>undefined8 <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>void</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  size_t sVar1;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>long</span> in_FS_OFFSET;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> original_bmp;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> encoded_char;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_7c;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_78;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_74;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_70;
</span></span><span style=display:flex><span>  undefined4 local_6c;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_68;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> flag_len_is_50;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>flag_len_is_50_stream;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>original_stream;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>encoded_stream;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> flag [<span style=color:#bd93f9>56</span>];
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>long</span> local_10;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local_10 <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>long</span> <span style=color:#ff79c6>*</span>)(in_FS_OFFSET <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x28</span>);
</span></span><span style=display:flex><span>  local_6c <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>  flag_len_is_50_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;flag_len_is_50.txt&#34;</span>,<span style=color:#f1fa8c>&#34;r&#34;</span>);
</span></span><span style=display:flex><span>  original_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;original.bmp&#34;</span>,<span style=color:#f1fa8c>&#34;r&#34;</span>);
</span></span><span style=display:flex><span>  encoded_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;encoded.bmp&#34;</span>,<span style=color:#f1fa8c>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (flag_len_is_50_stream <span style=color:#ff79c6>==</span> (FILE <span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x0</span>) {
</span></span><span style=display:flex><span>    puts(<span style=color:#f1fa8c>&#34;No flag_len_is_50 found, please make sure this is run on the server&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (original_stream <span style=color:#ff79c6>==</span> (FILE <span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x0</span>) {
</span></span><span style=display:flex><span>    puts(<span style=color:#f1fa8c>&#34;original.bmp is missing, please run this on the server&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>original_bmp,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream); <span style=color:#6272a4>//read one byte from original.bmp
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_7c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>  local_68 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>2000</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> (local_78 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; local_78 <span style=color:#ff79c6>&lt;</span> local_68; local_78 <span style=color:#ff79c6>=</span> local_78 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span>    fputc((<span style=color:#8be9fd>int</span>)original_bmp,encoded_stream);           <span style=color:#6272a4>//This loop copy 2000 byte from original to encoded
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>original_bmp,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream);
</span></span><span style=display:flex><span>    local_7c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  sVar1 <span style=color:#ff79c6>=</span> fread(flag,<span style=color:#bd93f9>0x32</span>,<span style=color:#bd93f9>1</span>,flag_len_is_50_stream);    <span style=color:#6272a4>//read 50 char and put into flag``
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  flag_len_is_50 <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (flag_len_is_50 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>1</span>) {                            <span style=color:#6272a4>//verify len(flag) is a 50
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    puts(<span style=color:#f1fa8c>&#34;flag_len_is_50 is not 50 chars&#34;</span>);
</span></span><span style=display:flex><span>                    <span style=color:#6272a4>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>    exit(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> (local_74 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; local_74 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0x32</span>; local_74 <span style=color:#ff79c6>=</span> local_74 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) { <span style=color:#6272a4>//for i in len(flag) {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>for</span> (local_70 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; local_70 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>8</span>; local_70 <span style=color:#ff79c6>=</span> local_70 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) {  <span style=color:#6272a4>//  for j in 0..8 {
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      encoded_char <span style=color:#ff79c6>=</span> codedChar(local_70,(<span style=color:#8be9fd>int</span>)(<span style=color:#8be9fd>char</span>)(flag[local_74] <span style=color:#ff79c6>+</span> <span style=color:#ff79c6>-</span><span style=color:#bd93f9>5</span>),(<span style=color:#8be9fd>int</span>)original_bmp);
</span></span><span style=display:flex><span>      fputc((<span style=color:#8be9fd>int</span>)encoded_char,encoded_stream);        <span style=color:#6272a4>// encoded_char=codedChar(j, flag[i]-5, original)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      fread(<span style=color:#ff79c6>&amp;</span>original_bmp,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream);       <span style=color:#6272a4>// append encoded_char and get original next byte
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    }                                                            <span style=color:#6272a4>//  }
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  }                                                              <span style=color:#6272a4>//}
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>while</span> (local_7c <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span>    fputc((<span style=color:#8be9fd>int</span>)original_bmp,encoded_stream);            <span style=color:#6272a4>// This loop copy all remaining bytes
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>original_bmp,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream);   <span style=color:#6272a4>// from original to encoded
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    local_7c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  fclose(encoded_stream);
</span></span><span style=display:flex><span>  fclose(original_stream);
</span></span><span style=display:flex><span>  fclose(flag_len_is_50_stream);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (local_10 <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>long</span> <span style=color:#ff79c6>*</span>)(in_FS_OFFSET <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x28</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>                    <span style=color:#6272a4>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>  __stack_chk_fail();
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>In other word this is the structure of the encoded file, and only bytes 2001 to 2400 contains the encoded flag.</p><table><thead><tr><th>len</th><th>bytes</th></tr></thead><tbody><tr><td>2000</td><td>identical to original bmp bytes</td></tr><tr><td>50*8</td><td>codedChar(j, flag[i]-5, original)</td></tr><tr><td>anything remaining</td><td>identical to original bmp bytes</td></tr></tbody></table><p>codeChar function returns encoded bytes:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>byte <span style=color:#50fa7b>codedChar</span>(<span style=color:#8be9fd>int</span> j, byte flag_5, byte original)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  byte tmp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  tmp <span style=color:#ff79c6>=</span> flag_5;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (j <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>    tmp <span style=color:#ff79c6>=</span> (byte)((<span style=color:#8be9fd>int</span>)(<span style=color:#8be9fd>char</span>)flag_5 <span style=color:#ff79c6>&gt;&gt;</span> ((byte)j <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0x1f</span>)); <span style=color:#6272a4>// tmp last bit is flag_5 bit at position j
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> original <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0xfe</span> <span style=color:#ff79c6>|</span> tmp <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>;  <span style=color:#6272a4>//remove the very last original bit and replace it with last bit of tmp
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}                                    <span style=color:#6272a4>//this is Steganography
</span></span></span></code></pre></td></tr></table></div></div><p>We can now reverse the code:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> mmap
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>OFFSET<span style=color:#ff79c6>=</span><span style=color:#bd93f9>2000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>memory_map</span>(filename, access<span style=color:#ff79c6>=</span>mmap<span style=color:#ff79c6>.</span>ACCESS_READ):
</span></span><span style=display:flex><span>    size <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>getsize(filename)
</span></span><span style=display:flex><span>    fd <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>open(filename, os<span style=color:#ff79c6>.</span>O_RDONLY)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> mmap<span style=color:#ff79c6>.</span>mmap(fd, size, access<span style=color:#ff79c6>=</span>access)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>map</span> <span style=color:#ff79c6>=</span> memory_map(<span style=color:#f1fa8c>&#39;./encoded.bmp&#39;</span>)
</span></span><span style=display:flex><span>buffer <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>map</span>[<span style=color:#bd93f9>2000</span>:<span style=color:#bd93f9>2400</span>]
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>map</span><span style=color:#ff79c6>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag <span style=color:#ff79c6>=</span> [<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>50</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>50</span>, <span style=color:#bd93f9>1</span>):
</span></span><span style=display:flex><span>    byte <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>5</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> j <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>8</span>):
</span></span><span style=display:flex><span>        bit <span style=color:#ff79c6>=</span> buffer[i<span style=color:#ff79c6>*</span><span style=color:#bd93f9>8</span>:i<span style=color:#ff79c6>*</span><span style=color:#bd93f9>8</span><span style=color:#ff79c6>+</span><span style=color:#bd93f9>8</span>][j]
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> j:
</span></span><span style=display:flex><span>            bit <span style=color:#ff79c6>=</span> (bit <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>&lt;&lt;</span> j
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span>            bit <span style=color:#ff79c6>=</span> bit <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>        byte <span style=color:#ff79c6>+=</span> bit
</span></span><span style=display:flex><span>        flag[i] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(byte)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;&#39;</span><span style=color:#ff79c6>.</span>join(flag))
</span></span></code></pre></td></tr></table></div></div><p>We could have used stegsolve to immediately get the flag without any reversing.
But as this challenge is called Investigative Reversing, and just for the beauty of it, we reversed it.</p><h2 id=investigative-reversing-3>investigative reversing 3</h2><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>undefined8 <span style=color:#50fa7b>main</span>(<span style=color:#8be9fd>void</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  size_t sVar1;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>long</span> in_FS_OFFSET;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> original;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> local_7d;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_7c;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_78;
</span></span><span style=display:flex><span>  uint local_74;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_70;
</span></span><span style=display:flex><span>  undefined4 local_6c;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_68;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_64;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>flag_stream;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>original_stream;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>encoded_stream;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> flag [<span style=color:#bd93f9>56</span>];
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>long</span> local_10;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local_10 <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>long</span> <span style=color:#ff79c6>*</span>)(in_FS_OFFSET <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x28</span>);
</span></span><span style=display:flex><span>  local_6c <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>  flag_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;flag.txt&#34;</span>,<span style=color:#f1fa8c>&#34;r&#34;</span>);
</span></span><span style=display:flex><span>  original_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;original.bmp&#34;</span>,<span style=color:#f1fa8c>&#34;r&#34;</span>);
</span></span><span style=display:flex><span>  encoded_stream <span style=color:#ff79c6>=</span> fopen(<span style=color:#f1fa8c>&#34;encoded.bmp&#34;</span>,<span style=color:#f1fa8c>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (flag_stream <span style=color:#ff79c6>==</span> (FILE <span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x0</span>) {
</span></span><span style=display:flex><span>    puts(<span style=color:#f1fa8c>&#34;No flag found, please make sure this is run on the server&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (original_stream <span style=color:#ff79c6>==</span> (FILE <span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x0</span>) {
</span></span><span style=display:flex><span>    puts(<span style=color:#f1fa8c>&#34;No output found, please run this on the server&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>original,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream); <span style=color:#6272a4>// read 1 byte original[0]
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_7c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>  local_68 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x2d3</span>;                             <span style=color:#6272a4>// 723
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>for</span> (local_78 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; local_78 <span style=color:#ff79c6>&lt;</span> local_68; local_78 <span style=color:#ff79c6>=</span> local_78 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>    fputc((<span style=color:#8be9fd>int</span>)original,encoded_stream);            <span style=color:#6272a4>//in this block, we copy into encoded
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>original,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream);   <span style=color:#6272a4>//the first 723 bytes of original bmp
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    local_7c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  sVar1 <span style=color:#ff79c6>=</span> fread(flag,<span style=color:#bd93f9>0x32</span>,<span style=color:#bd93f9>1</span>,flag_stream);       <span style=color:#6272a4>//read 50 bytes of flag
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_64 <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (local_64 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span>    puts(<span style=color:#f1fa8c>&#34;Invalid Flag&#34;</span>);
</span></span><span style=display:flex><span>                    <span style=color:#6272a4>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>    exit(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> (local_74 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; (<span style=color:#8be9fd>int</span>)local_74 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>100</span>; local_74 <span style=color:#ff79c6>=</span> local_74 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) {<span style=color:#6272a4>//for i [0..100] :
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#ff79c6>if</span> ((local_74 <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>) {                                      <span style=color:#6272a4>//  if i % 2:
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      <span style=color:#ff79c6>for</span> (local_70 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; local_70 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>8</span>; local_70 <span style=color:#ff79c6>=</span> local_70 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) {   <span style=color:#6272a4>//    for j [0..8]:
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        local_7d <span style=color:#ff79c6>=</span> codedChar(local_70,(<span style=color:#8be9fd>int</span>)flag[(<span style=color:#8be9fd>int</span>)local_74 <span style=color:#ff79c6>/</span> <span style=color:#bd93f9>2</span>],(<span style=color:#8be9fd>int</span>)original);
</span></span><span style=display:flex><span>        fputc((<span style=color:#8be9fd>int</span>)local_7d,encoded_stream);                        <span style=color:#6272a4>//      copy codedChar(...)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        fread(<span style=color:#ff79c6>&amp;</span>original,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>else</span> {                                                          <span style=color:#6272a4>//  else:
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      fputc((<span style=color:#8be9fd>int</span>)original,encoded_stream);                          <span style=color:#6272a4>//    copy original into encoded
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      fread(<span style=color:#ff79c6>&amp;</span>original,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>while</span> (local_7c <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span>    fputc((<span style=color:#8be9fd>int</span>)original,encoded_stream);                            <span style=color:#6272a4>//all remaining chars copied from
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>original,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,original_stream);                   <span style=color:#6272a4>//original to encoded
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    local_7c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  fclose(encoded_stream);
</span></span><span style=display:flex><span>  fclose(original_stream);
</span></span><span style=display:flex><span>  fclose(flag_stream);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (local_10 <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>long</span> <span style=color:#ff79c6>*</span>)(in_FS_OFFSET <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>0x28</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>                    <span style=color:#6272a4>/* WARNING: Subroutine does not return */</span>
</span></span><span style=display:flex><span>  __stack_chk_fail();
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>In other word, we repeat 50 times the below:</p><ul><li>encode one flag char on 8 bytes</li><li>copy one original byte</li></ul><p>This is the structure of the encoded file, and only bytes 2001 to 2400 contains the encoded flag.</p><table><thead><tr><th>len</th><th>bytes</th></tr></thead><tbody><tr><td>723</td><td>identical to original bmp bytes</td></tr><tr><td>8*50 + 50</td><td>codedChar(j, flag[i/2], original) followed with original byte</td></tr><tr><td>anything remaining</td><td>identical to original bmp bytes</td></tr></tbody></table><p>codeChar function is rigorously the same as previous challenge; so this is steganography again, and we can reverse the transformation:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#ff79c6>import</span> os
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> mmap
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>OFFSET<span style=color:#ff79c6>=</span><span style=color:#bd93f9>723</span>
</span></span><span style=display:flex><span>LENGTH<span style=color:#ff79c6>=</span><span style=color:#bd93f9>450</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>memory_map</span>(filename, access<span style=color:#ff79c6>=</span>mmap<span style=color:#ff79c6>.</span>ACCESS_READ):
</span></span><span style=display:flex><span>    size <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>getsize(filename)
</span></span><span style=display:flex><span>    fd <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>open(filename, os<span style=color:#ff79c6>.</span>O_RDONLY)
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> mmap<span style=color:#ff79c6>.</span>mmap(fd, size, access<span style=color:#ff79c6>=</span>access)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>Buffer</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> __init__(self, filename, offset, length):
</span></span><span style=display:flex><span>        self<span style=color:#ff79c6>.</span>map <span style=color:#ff79c6>=</span> memory_map(filename)
</span></span><span style=display:flex><span>        self<span style=color:#ff79c6>.</span>buffer <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>map[offset: offset<span style=color:#ff79c6>+</span>length]
</span></span><span style=display:flex><span>        self<span style=color:#ff79c6>.</span>current <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>read_one_byte</span>(self):
</span></span><span style=display:flex><span>        byte <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>buffer[self<span style=color:#ff79c6>.</span>current]
</span></span><span style=display:flex><span>        self<span style=color:#ff79c6>.</span>current<span style=color:#ff79c6>+=</span><span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> byte
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> __del__(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff79c6>.</span>map<span style=color:#ff79c6>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> __name__ <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    buffer <span style=color:#ff79c6>=</span> Buffer(<span style=color:#f1fa8c>&#39;./encoded.bmp&#39;</span>, OFFSET, LENGTH)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    flag <span style=color:#ff79c6>=</span> [<span style=color:#bd93f9>0</span>] <span style=color:#ff79c6>*</span> <span style=color:#bd93f9>50</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>100</span>, <span style=color:#bd93f9>1</span>):
</span></span><span style=display:flex><span>        byte <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> i <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>2</span>:
</span></span><span style=display:flex><span>            buffer<span style=color:#ff79c6>.</span>read_one_byte()
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span>            i <span style=color:#ff79c6>=</span> i <span style=color:#ff79c6>//</span> <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>for</span> j <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>0</span>, <span style=color:#bd93f9>8</span>):
</span></span><span style=display:flex><span>                bit <span style=color:#ff79c6>=</span> buffer<span style=color:#ff79c6>.</span>read_one_byte()
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>if</span> j:
</span></span><span style=display:flex><span>                    bit <span style=color:#ff79c6>=</span> (bit <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>&lt;&lt;</span> j
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>else</span>:
</span></span><span style=display:flex><span>                    bit <span style=color:#ff79c6>=</span> bit <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>                byte <span style=color:#ff79c6>+=</span> bit
</span></span><span style=display:flex><span>                flag[i] <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>chr</span>(byte)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#39;&#39;</span><span style=color:#ff79c6>.</span>join(flag))
</span></span></code></pre></td></tr></table></div></div><h2 id=investigative-reversing-4>investigative reversing 4</h2><p>the main function read 50 bytes from flag.txt and store it in global variable <code>flag</code> before calling the <code>encodeAll</code> function:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>encodeAll</span>(<span style=color:#8be9fd>void</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  ulong local_48;
</span></span><span style=display:flex><span>  undefined8 local_40;
</span></span><span style=display:flex><span>  undefined4 local_38;
</span></span><span style=display:flex><span>  ulong local_28;
</span></span><span style=display:flex><span>  undefined8 local_20;
</span></span><span style=display:flex><span>  undefined4 local_18;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> c;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local_28 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x635f31306d657449</span>;        <span style=color:#6272a4>// &#39;Item01_c&#39;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_20 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x706d622e70</span>;              <span style=color:#6272a4>// &#39;p.bmp&#39;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_18 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>  local_48 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x622e31306d657449</span>;        <span style=color:#6272a4>// &#39;Item01.b&#39;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_40 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x706d</span>;                    <span style=color:#6272a4>// &#39;mp&#39;
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_38 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> (c <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;5&#39;</span>; <span style=color:#f1fa8c>&#39;0&#39;</span> <span style=color:#ff79c6>&lt;</span> c; c <span style=color:#ff79c6>=</span> c <span style=color:#ff79c6>-</span> <span style=color:#bd93f9>1</span>) {   <span style=color:#6272a4>// iterate over 5,4,3,2,1
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    local_48._0_6_ <span style=color:#ff79c6>=</span> CONCAT15(c,(undefined5)local_48);
</span></span><span style=display:flex><span>    local_48 <span style=color:#ff79c6>=</span> local_48 <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0xffff000000000000</span> <span style=color:#ff79c6>|</span> (ulong)(uint6)local_48;
</span></span><span style=display:flex><span>    local_28._0_6_ <span style=color:#ff79c6>=</span> CONCAT15(c,(undefined5)local_28);
</span></span><span style=display:flex><span>    local_28 <span style=color:#ff79c6>=</span> local_28 <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0xffff000000000000</span> <span style=color:#ff79c6>|</span> (ulong)(uint6)local_28;
</span></span><span style=display:flex><span>    encodeDataInFile(<span style=color:#ff79c6>&amp;</span>local_48,<span style=color:#ff79c6>&amp;</span>local_28);  <span style=color:#6272a4>//encodeAll(file_output, file_input)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>we can decode some of the locals ascii with the below code:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> local <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;0x635f31306d657449&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> local <span style=color:#ff79c6>=</span> local[<span style=color:#bd93f9>2</span>:]
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> [<span style=color:#8be9fd;font-style:italic>chr</span>(<span style=color:#8be9fd;font-style:italic>int</span>(local[i:i<span style=color:#ff79c6>+</span><span style=color:#bd93f9>2</span>], <span style=color:#bd93f9>16</span>)) <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span> (<span style=color:#bd93f9>0</span>,<span style=color:#8be9fd;font-style:italic>len</span>(local), <span style=color:#bd93f9>2</span>)]
</span></span><span style=display:flex><span>[<span style=color:#f1fa8c>&#39;c&#39;</span>, <span style=color:#f1fa8c>&#39;_&#39;</span>, <span style=color:#f1fa8c>&#39;1&#39;</span>, <span style=color:#f1fa8c>&#39;0&#39;</span>, <span style=color:#f1fa8c>&#39;m&#39;</span>, <span style=color:#f1fa8c>&#39;e&#39;</span>, <span style=color:#f1fa8c>&#39;t&#39;</span>, <span style=color:#f1fa8c>&#39;I&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> local <span style=color:#ff79c6>=</span> [<span style=color:#8be9fd;font-style:italic>chr</span>(<span style=color:#8be9fd;font-style:italic>int</span>(local[i:i<span style=color:#ff79c6>+</span><span style=color:#bd93f9>2</span>], <span style=color:#bd93f9>16</span>)) <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span> (<span style=color:#bd93f9>0</span>,<span style=color:#8be9fd;font-style:italic>len</span>(local), <span style=color:#bd93f9>2</span>)]
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> local<span style=color:#ff79c6>.</span>reverse()
</span></span><span style=display:flex><span><span style=color:#ff79c6>&gt;&gt;&gt;</span> <span style=color:#f1fa8c>&#39;&#39;</span><span style=color:#ff79c6>.</span>join(local)
</span></span><span style=display:flex><span><span style=color:#f1fa8c>&#39;Item01_c&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p><a href=https://stackoverflow.com/questions/69430800/what-does-concat15-and-concat412-means-in-ghidra>CONCAT15</a> to pronounce <strong>concat one five</strong>
will concatenate one byte of first argument with 5 bytes of second argument, and the result will occupy local_48._0_6 (bits 0 to 6);
in other words, taking <strong>c=&lsquo;5&rsquo;</strong> as an example, we obtain:</p><table><thead><tr><th>operation</th><th>result</th></tr></thead><tbody><tr><td>local_48</td><td>Item01.b</td></tr><tr><td>CONCAT15(c,(undefined5)local_48);</td><td>Item05.b</td></tr></tbody></table><p>When we look at the locals in the memory stack:</p><table><thead><tr><th>label</th><th>value</th><th>reversed endianness</th></tr></thead><tbody><tr><td>local_38</td><td>0000 0000</td><td>\x00</td></tr><tr><td>local_40</td><td>0x706d;</td><td>&lsquo;mp&rsquo;</td></tr><tr><td>local_48</td><td>0x622e31306d657449</td><td>&lsquo;Item01.b&rsquo;</td></tr><tr><td>local_18</td><td>0000 0000</td><td>\x00</td></tr><tr><td>local_20</td><td>0x706d622e70</td><td>&lsquo;p.bmp&rsquo;</td></tr><tr><td>local_28</td><td>0x635f31306d657449</td><td>&lsquo;Item01_c&rsquo;</td></tr></tbody></table><p>In other words, the program translates into a loop that will pass two file names to the encodeDataInFile function:</p><ol><li>iterate over the 5 files Item05_cp.bmp to Item01_cp.bmp (<strong>local_28</strong>)</li><li>for each file pass it as second argument to <strong>encodeDataInFile</strong> and pass as first argument (<strong>local_48</strong>) the files Item05.bmp to Item01.bmp</li><li>the second argument is likely the original file before encoding; the second argument the output file after encoding</li><li>encodeDataInFile(original_file, encoded_file)</li></ol><p>We can reverse engineer the encodeDataInFile function:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>encodeDataInFile</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>param_1,<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>param_2)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  size_t sVar1;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> local_2e;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>char</span> local_2d;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_2c;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>local_28;
</span></span><span style=display:flex><span>  FILE <span style=color:#ff79c6>*</span>local_20;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_18;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_14;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_10;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> local_c;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  local_20 <span style=color:#ff79c6>=</span> fopen(param_1,<span style=color:#f1fa8c>&#34;r&#34;</span>);            <span style=color:#6272a4>// the input bitmap is opened in read only
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  local_28 <span style=color:#ff79c6>=</span> fopen(param_2,<span style=color:#f1fa8c>&#34;a&#34;</span>);            <span style=color:#6272a4>// the ouput bitmap is opened in append mode
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>if</span> (local_20 <span style=color:#ff79c6>!=</span> (FILE <span style=color:#ff79c6>*</span>)<span style=color:#bd93f9>0x0</span>) {
</span></span><span style=display:flex><span>    sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>local_2e,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,local_20);
</span></span><span style=display:flex><span>    local_c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>    local_2c <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x7e3</span>;                       <span style=color:#6272a4>// 2019
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    <span style=color:#6272a4>/* this loop simply copy the first 2019 bytes of input bitmap without modification */</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (local_10 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; local_10 <span style=color:#ff79c6>&lt;</span> local_2c; local_10 <span style=color:#ff79c6>=</span> local_10 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) { <span style=color:#6272a4>// loop 2019 times
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      fputc((<span style=color:#8be9fd>int</span>)local_2e,local_28);        <span style=color:#6272a4>// copy one byte from input to output bitmap
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>local_2e,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,local_20);<span style=color:#6272a4>// read 1 byte of the input bitmap
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      local_c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (local_14 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; local_14 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>0x32</span>; local_14 <span style=color:#ff79c6>=</span> local_14 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) { <span style=color:#6272a4>// loop 50 times, over all flag char
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      <span style=color:#ff79c6>if</span> (local_14 <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>5</span> <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>) {  <span style=color:#6272a4>// every 5 flags characters, perform below steganographic transformation
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        <span style=color:#6272a4>/* steganographic transformation over 8 subsequent bytes */</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (local_18 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; local_18 <span style=color:#ff79c6>&lt;</span> <span style=color:#bd93f9>8</span>; local_18 <span style=color:#ff79c6>=</span> local_18 <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>) {
</span></span><span style=display:flex><span>          local_2d <span style=color:#ff79c6>=</span> codedChar(local_18,(<span style=color:#8be9fd>int</span>)<span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>)(<span style=color:#ff79c6>*</span>flag_index <span style=color:#ff79c6>+</span> flag),(<span style=color:#8be9fd>int</span>)local_2e);
</span></span><span style=display:flex><span>          fputc((<span style=color:#8be9fd>int</span>)local_2d,local_28);
</span></span><span style=display:flex><span>          fread(<span style=color:#ff79c6>&amp;</span>local_2e,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,local_20);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>*</span>flag_index <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>*</span>flag_index <span style=color:#ff79c6>+</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>else</span> {                    <span style=color:#6272a4>// otherwise, simply copy the byte
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>        fputc((<span style=color:#8be9fd>int</span>)local_2e,local_28);
</span></span><span style=display:flex><span>        fread(<span style=color:#ff79c6>&amp;</span>local_2e,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,local_20);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>while</span> (local_c <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>1</span>) {      <span style=color:#6272a4>// copy all remaining bytes
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>      fputc((<span style=color:#8be9fd>int</span>)local_2e,local_28);
</span></span><span style=display:flex><span>      sVar1 <span style=color:#ff79c6>=</span> fread(<span style=color:#ff79c6>&amp;</span>local_2e,<span style=color:#bd93f9>1</span>,<span style=color:#bd93f9>1</span>,local_20);
</span></span><span style=display:flex><span>      local_c <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>)sVar1;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    fclose(local_28);
</span></span><span style=display:flex><span>    fclose(local_20);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  puts(<span style=color:#f1fa8c>&#34;No output found, please run this on the server&#34;</span>);
</span></span><span style=display:flex><span>  exit(<span style=color:#bd93f9>0</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>We are only missing to reverse engineer the codedChar function, but it is very similar steganographic operation already observed in previous challenge.</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>byte <span style=color:#50fa7b>codedChar</span>(<span style=color:#8be9fd>int</span> i,byte flag_5,byte original_byte)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  byte tmp;
</span></span><span style=display:flex><span>  tmp <span style=color:#ff79c6>=</span> flag_5;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (i <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>    tmp <span style=color:#ff79c6>=</span> (byte)((<span style=color:#8be9fd>int</span>)(<span style=color:#8be9fd>char</span>)flag_5 <span style=color:#ff79c6>&gt;&gt;</span> ((byte)i <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0x1f</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> original_byte <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>0xfe</span> <span style=color:#ff79c6>|</span> tmp <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>The encoded flag is spread across the 5 output bitmap as follows:</p><ul><li>flag[0] to flag[9] in file &lsquo;Item05_cp.bmp&rsquo;</li><li>flag[10] to flag[19] in file &lsquo;Item04_cp.bmp&rsquo;</li><li>flag[20] to flag[29] in file &lsquo;Item03_cp.bmp&rsquo;</li><li>etc</li></ul><table><thead><tr><th style=text-align:left>Item05_cp.bmp</th><th>size (bytes)</th></tr></thead><tbody><tr><td style=text-align:left>leading 2019 bytes to be skipped</td><td>2019</td></tr><tr><td style=text-align:left>flag[0] encoded with steganography</td><td>8</td></tr><tr><td style=text-align:left>4 bytes to be skipped</td><td>4</td></tr><tr><td style=text-align:left>next flag char encoded</td><td>8</td></tr><tr><td style=text-align:left>etc &mldr; up to flag[9]</td><td>etc &mldr;</td></tr></tbody></table><p>We can reverse the transformation with this python script:</p><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python3 data-lang=python3><span style=display:flex><span><span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> unbits
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bin_str <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>5</span>, <span style=color:#bd93f9>0</span>, <span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>):                               <span style=color:#6272a4># iterate over 5 files</span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>with</span> <span style=color:#8be9fd;font-style:italic>open</span>(<span style=color:#f1fa8c>&#34;Item0</span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>_cp.bmp&#34;</span><span style=color:#ff79c6>.</span>format(i), <span style=color:#f1fa8c>&#34;rb&#34;</span>) <span style=color:#ff79c6>as</span> b:   <span style=color:#6272a4># open read-only as byte stream</span>
</span></span><span style=display:flex><span>        b<span style=color:#ff79c6>.</span>seek(<span style=color:#bd93f9>2019</span>)                                    <span style=color:#6272a4># skip first 2019 bits</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> j <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>50</span>):                             <span style=color:#6272a4># iterate over 50 flag characters</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>if</span> (j <span style=color:#ff79c6>%</span> <span style=color:#bd93f9>5</span> <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0</span>):                    <span style=color:#6272a4># if every 5 flag characters</span>
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>for</span> k <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>8</span>):              <span style=color:#6272a4>#     read 8 bytes of the bitmap</span>
</span></span><span style=display:flex><span>                    byte <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>ord</span>(b<span style=color:#ff79c6>.</span>read(<span style=color:#bd93f9>1</span>))       <span style=color:#6272a4>#</span>
</span></span><span style=display:flex><span>                    bit <span style=color:#ff79c6>=</span> byte <span style=color:#ff79c6>&amp;</span> <span style=color:#bd93f9>1</span>              <span style=color:#6272a4>#     reverse steganography using LSB-encoding</span>
</span></span><span style=display:flex><span>                    bin_str <span style=color:#ff79c6>+=</span> <span style=color:#8be9fd;font-style:italic>str</span>(bit)         <span style=color:#6272a4>#     append the obtained flag character</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>else</span>:                               <span style=color:#6272a4># otherwise, skip 4 next bytes</span>
</span></span><span style=display:flex><span>                b<span style=color:#ff79c6>.</span>read(<span style=color:#bd93f9>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>char_str <span style=color:#ff79c6>=</span> unbits(bin_str, endian<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;little&#39;</span>)     <span style=color:#6272a4># the reassembled flag is little-endian</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;Flag: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(char_str<span style=color:#ff79c6>.</span>decode(<span style=color:#f1fa8c>&#34;ascii&#34;</span>)))
</span></span></code></pre></td></tr></table></div></div></div></article><hr><div class=sharing-buttons><a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f" target=_blank rel=noopener aria-label title="Share on facebook"><div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f" target=_blank rel=noopener aria-label title="Share on twitter"><div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.tumblr.com/widgets/share/tool?posttype=link&title=PicoCTF2019%20-%20Forensics&caption=PicoCTF2019%20-%20Forensics&canonicalUrl=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f" target=_blank rel=noopener aria-label title="Share on tumblr"><div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093.0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941.0 9.999.0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg></div></div></a><a class=resp-sharing-button__link href="mailto:?subject=PicoCTF2019%20-%20Forensics&body=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f" target=_self rel=noopener aria-label title="Share via email"><div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div></div></a><a class=resp-sharing-button__link href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f&media=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f;description=PicoCTF2019%20-%20Forensics" target=_blank rel=noopener aria-label title="Share on pinterest"><div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12.017.0C5.396.0.029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024.0 1.518.769 1.518 1.688.0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128.0 3.768-2.245 3.768-5.487.0-2.861-2.063-4.869-5.008-4.869-3.41.0-5.409 2.562-5.409 5.199.0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646.0-3.776 2.748-7.252 7.92-7.252 4.158.0 7.392 2.967 7.392 6.923.0 4.135-2.607 7.462-6.233 7.462-1.214.0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607.0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017.0z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f&title=PicoCTF2019%20-%20Forensics&summary=PicoCTF2019%20-%20Forensics&source=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f" target=_blank rel=noopener aria-label title="Share on linkedin"><div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></div></div></a><a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f&resubmit=true&title=PicoCTF2019%20-%20Forensics" target=_blank rel=noopener aria-label title="Share on reddit"><div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f;title=PicoCTF2019%20-%20Forensics" target=_blank rel=noopener aria-label title="Share on xing"><div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg></div></div></a><a class=resp-sharing-button__link href="whatsapp://send?text=PicoCTF2019%20-%20Forensics%20https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f" target=_blank rel=noopener aria-label title="Share on whatsapp"><div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f&t=PicoCTF2019%20-%20Forensics" target=_blank rel=noopener aria-label title="Share on hacker news"><div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg></div></div></a><a class=resp-sharing-button__link href="https://telegram.me/share/url?text=PicoCTF2019%20-%20Forensics&url=https%3a%2f%2f0xade1.github.io%2fposts%2f2022%2f08%2fpicoctf2019-forensics%2f" target=_blank rel=noopener aria-label title="Share on telegram"><div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></div></div></a></div><hr><div class=pagination><div class=pagination__title><span class=pagination__title-h></span></div><div class=pagination__buttons><a href=https://0xade1.github.io/posts/2022/08/picoctf2019-general-skills/ class="button previous"><span class=button__icon>←</span>
<span class=button__text>PicoCTF2019 - General Skills</span></a>
<a href=https://0xade1.github.io/posts/2022/08/picoctf2019-cryptography/ class="button next"><span class=button__text>PicoCTF2019 - Cryptography</span>
<span class=button__icon>→</span></a></div></div><hr></main></div><footer class=footer><div class=footer__inner><div class=footer__content><span>&copy; 2023</span>
<span><a href=https://0xade1.github.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span></div></div><div class=footer__inner><div class=footer__content><span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084;</span></div></div></footer></div><script type=text/javascript src=https://0xade1.github.io/bundle.min.7015b843bafc394b6094818242f153559f5ca94b331b9faaf6132652c59619aefe60ae36e1637f7ee14fd953892639f466c25095c36d42203a1c195313e93212.js integrity="sha512-cBW4Q7r8OUtglIGCQvFTVZ9cqUszG5+q9hMmUsWWGa7+YK424WN/fuFP2VOJJjn0ZsJQlcNtQiA6HBlTE+kyEg=="></script></body></html>